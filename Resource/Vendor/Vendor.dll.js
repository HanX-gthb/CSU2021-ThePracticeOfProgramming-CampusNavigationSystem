/*! For license information please see Vendor.dll.js.LICENSE.txt */
var Vendor_dll;(()=>{var t={1618:function(t){"use strict";t.exports=function(){function t(t){var r=[];return t.AMapUI&&r.push(e(t.AMapUI)),t.Loca&&r.push(n(t.Loca)),Promise.all(r)}function e(t){return new Promise((function(e,n){var i=[];if(t.plugins)for(var u=0;u<t.plugins.length;u+=1)-1==o.AMapUI.plugins.indexOf(t.plugins[u])&&i.push(t.plugins[u]);if(a.AMapUI===r.failed)n("前次请求 AMapUI 失败");else if(a.AMapUI===r.notload){a.AMapUI=r.loading,o.AMapUI.version=t.version||o.AMapUI.version,u=o.AMapUI.version;var l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/ui/"+u+"/main.js",c.onerror=function(t){a.AMapUI=r.failed,n("请求 AMapUI 失败")},c.onload=function(){if(a.AMapUI=r.loaded,i.length)window.AMapUI.loadUI(i,(function(){for(var t=0,n=i.length;t<n;t++){var r=i[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}for(e();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(e();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},l.appendChild(c)}else a.AMapUI===r.loaded?t.version&&t.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):i.length?window.AMapUI.loadUI(i,(function(){for(var t=0,n=i.length;t<n;t++){var r=i[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}e()})):e():t.version&&t.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.AMapUI.push((function(t){t?n(t):i.length?window.AMapUI.loadUI(i,(function(){for(var t=0,n=i.length;t<n;t++){var r=i[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}e()})):e()}))}))}function n(t){return new Promise((function(e,n){if(o.AMap.version.startsWith("2.0"))n("Loca 暂不适配 JSAPI 2.0,请使用 1.4.15");else if(a.Loca===r.failed)n("前次请求 Loca 失败");else if(a.Loca===r.notload){a.Loca=r.loading,o.Loca.version=t.version||o.Loca.version;var i=o.Loca.version,u=o.key,l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/loca?v="+i+"&key="+u,c.onerror=function(t){a.Loca=r.failed,n("请求 AMapUI 失败")},c.onload=function(){for(a.Loca=r.loaded,e();s.Loca.length;)s.Loca.splice(0,1)[0]()},l.appendChild(c)}else a.Loca===r.loaded?t.version&&t.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):e():t.version&&t.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):s.Loca.push((function(t){t?n(t):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r,i;(i=r||(r={})).notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed";var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]},u=[];return{load:function(e){return new Promise((function(n,i){if(a.AMap==r.failed)i("");else if(a.AMap==r.notload){var s=e.key,l=e.version,c=e.plugins;s?(window.AMap&&"lbs.amap.com"!==location.host&&i("禁止多种API加载方式混用"),o.key=s,o.AMap.version=l||o.AMap.version,o.AMap.plugins=c||o.AMap.plugins,a.AMap=r.loading,l=document.body||document.head,window.___onAPILoaded=function(o){if(delete window.___onAPILoaded,o)a.AMap=r.failed,i(o);else for(a.AMap=r.loaded,t(e).then((function(){n(window.AMap)})).catch(i);u.length;)u.splice(0,1)[0]()},(c=document.createElement("script")).type="text/javascript",c.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+s+"&plugin="+o.AMap.plugins.join(","),c.onerror=function(t){a.AMap=r.failed,i(t)},l.appendChild(c)):i("请填写key")}else if(a.AMap==r.loaded)if(e.key&&e.key!==o.key)i("多个不一致的 key");else if(e.version&&e.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(s=[],e.plugins)for(l=0;l<e.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(e.plugins[l])&&s.push(e.plugins[l]);s.length?window.AMap.plugin(s,(function(){t(e).then((function(){n(window.AMap)})).catch(i)})):t(e).then((function(){n(window.AMap)})).catch(i)}else if(e.key&&e.key!==o.key)i("多个不一致的 key");else if(e.version&&e.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{var h=[];if(e.plugins)for(l=0;l<e.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(e.plugins[l])&&h.push(e.plugins[l]);!function(t){"function"==typeof t&&(a.AMap===r.loaded?t(window.AMap):u.push(t))}((function(){h.length?window.AMap.plugin(h,(function(){t(e).then((function(){n(window.AMap)})).catch(i)})):t(e).then((function(){n(window.AMap)})).catch(i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]}}}}()},2238:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=function(t,e){var n=t.nodes,r=t.edges,i=[],o={};if(!n)throw new Error("invalid nodes data!");return n&&n.forEach((function(t,e){o[t.id]=e,i.push([])})),r&&r.forEach((function(t){var n=t.source,r=t.target,a=o[n],s=o[r];!a&&0!==a||!s&&0!==s||(i[a][s]=1,e||(i[s][a]=1))})),i}},369:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"GADDIAsync",{enumerable:!0,get:function(){return r.GADDIAsync}}),Object.defineProperty(e,"connectedComponentAsync",{enumerable:!0,get:function(){return r.connectedComponentAsync}}),e.default=void 0,Object.defineProperty(e,"detectAllCyclesAsync",{enumerable:!0,get:function(){return r.detectAllCyclesAsync}}),Object.defineProperty(e,"detectAllDirectedCycleAsync",{enumerable:!0,get:function(){return r.detectAllDirectedCycleAsync}}),Object.defineProperty(e,"detectAllUndirectedCycleAsync",{enumerable:!0,get:function(){return r.detectAllUndirectedCycleAsync}}),Object.defineProperty(e,"detectCycleAsync",{enumerable:!0,get:function(){return r.detectCycleAsync}}),e.detectDirectedCycleAsync=void 0,Object.defineProperty(e,"dijkstraAsync",{enumerable:!0,get:function(){return r.dijkstraAsync}}),Object.defineProperty(e,"findAllPathAsync",{enumerable:!0,get:function(){return r.findAllPathAsync}}),Object.defineProperty(e,"findShortestPathAsync",{enumerable:!0,get:function(){return r.findShortestPathAsync}}),Object.defineProperty(e,"floydWarshallAsync",{enumerable:!0,get:function(){return r.floydWarshallAsync}}),Object.defineProperty(e,"getAdjMatrixAsync",{enumerable:!0,get:function(){return r.getAdjMatrixAsync}}),Object.defineProperty(e,"getDegreeAsync",{enumerable:!0,get:function(){return r.getDegreeAsync}}),Object.defineProperty(e,"getInDegreeAsync",{enumerable:!0,get:function(){return r.getInDegreeAsync}}),Object.defineProperty(e,"getNeighborsAsync",{enumerable:!0,get:function(){return r.getNeighborsAsync}}),Object.defineProperty(e,"getOutDegreeAsync",{enumerable:!0,get:function(){return r.getOutDegreeAsync}}),Object.defineProperty(e,"labelPropagationAsync",{enumerable:!0,get:function(){return r.labelPropagationAsync}}),Object.defineProperty(e,"louvainAsync",{enumerable:!0,get:function(){return r.louvainAsync}}),Object.defineProperty(e,"minimumSpanningTreeAsync",{enumerable:!0,get:function(){return r.minimumSpanningTreeAsync}}),Object.defineProperty(e,"pageRankAsync",{enumerable:!0,get:function(){return r.pageRankAsync}});var r=n(485),i=r.detectCycleAsync;e.detectDirectedCycleAsync=i;var o={getAdjMatrixAsync:r.getAdjMatrixAsync,connectedComponentAsync:r.connectedComponentAsync,getDegreeAsync:r.getDegreeAsync,getInDegreeAsync:r.getInDegreeAsync,getOutDegreeAsync:r.getOutDegreeAsync,detectCycleAsync:r.detectCycleAsync,detectDirectedCycleAsync:i,detectAllCyclesAsync:r.detectAllCyclesAsync,detectAllDirectedCycleAsync:r.detectAllDirectedCycleAsync,detectAllUndirectedCycleAsync:r.detectAllUndirectedCycleAsync,dijkstraAsync:r.dijkstraAsync,findAllPathAsync:r.findAllPathAsync,findShortestPathAsync:r.findShortestPathAsync,floydWarshallAsync:r.floydWarshallAsync,labelPropagationAsync:r.labelPropagationAsync,louvainAsync:r.louvainAsync,minimumSpanningTreeAsync:r.minimumSpanningTreeAsync,pageRankAsync:r.pageRankAsync,getNeighborsAsync:r.getNeighborsAsync,GADDIAsync:r.GADDIAsync};e.default=o},3764:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r,i=(r=n(3026))&&r.__esModule?r:{default:r},o=n(643);e.default=function(t,e,n,r){void 0===r&&(r=!0);var a=function(t){void 0===t&&(t={});var e,n=t,r=function(){},i=(e={},function(t){var n=t.next;return!e[n]&&(e[n]=!0,!0)});return n.allowTraversal=t.allowTraversal||i,n.enter=t.enter||r,n.leave=t.leave||r,n}(n),s=new i.default,u=t.edges,l=void 0===u?[]:u;s.enqueue(e);for(var c="",h=function(){var t=s.dequeue();a.enter({current:t,previous:c}),(0,o.getNeighbors)(t,l,r?"target":void 0).forEach((function(e){a.allowTraversal({previous:c,current:t,next:e})&&s.enqueue(e)})),a.leave({current:t,previous:c}),c=t};!s.isEmpty();)h()}},9527:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return e?o(t):i(t)},e.detectStrongConnectComponents=e.detectConnectedComponents=void 0;var r=n(643),i=function(t){for(var e=t.nodes,n=void 0===e?[]:e,i=t.edges,o=void 0===i?[]:i,a=[],s={},u=[],l=function t(e){u.push(e),s[e.id]=!0;for(var i=(0,r.getNeighbors)(e.id,o),a=function(e){var r=i[e];if(!s[r]){var o=n.filter((function(t){return t.id===r}));o.length>0&&t(o[0])}},l=0;l<i.length;++l)a(l)},c=0;c<n.length;c++){var h=n[c];if(!s[h.id]){l(h);for(var f=[];u.length>0;)f.push(u.pop());a.push(f)}}return a};e.detectConnectedComponents=i;var o=function(t){for(var e=t.nodes,n=void 0===e?[]:e,i=t.edges,o=void 0===i?[]:i,a=[],s={},u={},l={},c=[],h=0,f=function t(e){u[e.id]=h,l[e.id]=h,h+=1,a.push(e),s[e.id]=!0;for(var i=(0,r.getNeighbors)(e.id,o,"target").filter((function(t){return n.map((function(t){return t.id})).indexOf(t)>-1})),f=function(r){var o=i[r];if(u[o]||0===u[o])s[o]&&(l[e.id]=Math.min(l[e.id],u[o]));else{var a=n.filter((function(t){return t.id===o}));a.length>0&&t(a[0]),l[e.id]=Math.min(l[e.id],l[o])}},p=0;p<i.length;p++)f(p);if(l[e.id]===u[e.id]){for(var d=[];a.length>0;){var g=a.pop();if(s[g.id]=!1,d.push(g),g===e)break}d.length>0&&c.push(d)}},p=0,d=n;p<d.length;p++){var g=d[p];u[g.id]||0===u[g.id]||f(g)}return c};e.detectStrongConnectComponents=o},2935:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.secondReg=e.dateReg=void 0,e.secondReg=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/,e.dateReg=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/},2556:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getOutDegree=e.getInDegree=e.default=void 0;var n=function(t){var e={},n=t.nodes,r=void 0===n?[]:n,i=t.edges,o=void 0===i?[]:i;return r.forEach((function(t){e[t.id]={degree:0,inDegree:0,outDegree:0}})),o.forEach((function(t){e[t.source].degree++,e[t.source].outDegree++,e[t.target].degree++,e[t.target].inDegree++})),e},r=n;e.default=r,e.getInDegree=function(t,e){return n(t)[e]?n(t)[e].inDegree:0},e.getOutDegree=function(t,e){return n(t)[e]?n(t)[e].outDegree:0}},4282:(t,e,n)=>{"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.detectAllUndirectedCycle=e.detectAllDirectedCycle=e.detectAllCycles=e.default=void 0;var i,o=(i=n(5891))&&i.__esModule?i:{default:i},a=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var n=u(e);if(n&&n.has(t))return n.get(t);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if("default"!==a&&Object.prototype.hasOwnProperty.call(t,a)){var s=o?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(i,a,s):i[a]=t[a]}return i.default=t,n&&n.set(t,i),i}(n(9527)),s=n(643);function u(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(u=function(t){return t?n:e})(t)}var l=function(t,e,n){var r,i;void 0===n&&(n=!0);for(var o=[],u=0,l=(0,a.default)(t,!1);u<l.length;u++){var c=l[u];if(c.length)for(var h=c[0],f=h.id,p=[h],d=((r={})[f]=h,r),g=((i={})[f]=new Set,i);p.length>0;)for(var v=p.pop(),m=v.id,y=(0,s.getNeighbors)(m,t.edges),_=function(r){var i,a=y[r],s=t.nodes.find((function(t){return t.id===a}));if(a===m)o.push(((i={})[a]=v,i));else if(a in g){if(!g[m].has(s)){for(var u=!0,l=[s,v],c=d[m];g[a].size&&!g[a].has(c)&&(l.push(c),c!==d[c.id]);)c=d[c.id];if(l.push(c),e&&n?(u=!1,l.findIndex((function(t){return e.indexOf(t.id)>-1}))>-1&&(u=!0)):e&&!n&&l.findIndex((function(t){return e.indexOf(t.id)>-1}))>-1&&(u=!1),u){for(var h={},f=1;f<l.length;f+=1)h[l[f-1].id]=l[f];l.length&&(h[l[l.length-1].id]=l[0]),o.push(h)}g[a].add(v)}}else d[a]=v,p.push(s),g[a]=new Set([v])},b=0;b<y.length;b+=1)_(b)}return o};e.detectAllUndirectedCycle=l;var c=function(t,e,n){void 0===n&&(n=!0);for(var r=[],i=new Set,o=[],u=[],l={},c={},h=function t(a,s,c){var h=!1;if(e&&!1===n&&e.indexOf(a.id)>-1)return h;r.push(a),i.add(a);for(var f=c[a.id],p=0;p<f.length;p+=1)if((v=l[f[p]])===s){for(var d={},g=1;g<r.length;g+=1)d[r[g-1].id]=r[g];r.length&&(d[r[r.length-1].id]=r[0]),u.push(d),h=!0}else i.has(v)||t(v,s,c)&&(h=!0);if(h)!function(t){for(var e=[t];e.length>0;){var n=e.pop();i.has(n)&&(i.delete(n),o[n.id].forEach((function(t){e.push(t)})),o[n.id].clear())}}(a);else for(p=0;p<f.length;p+=1){var v=l[f[p]];o[v.id].has(a)||o[v.id].add(a)}return r.pop(),h},f=t.nodes,p=void 0===f?[]:f,d=0;d<p.length;d+=1){var g=p[d],v=g.id;c[v]=d,l[d]=g}if(e&&n){var m=function(t){var n=e[t];c[p[t].id]=c[n],c[n]=0,l[0]=p.find((function(t){return t.id===n})),l[c[p[t].id]]=p[t]};for(d=0;d<e.length;d++)m(d)}for(var y=function(r){for(var i,o,a=1/0,l=0;l<r.length;l+=1)for(var h=r[l],f=0;f<h.length;f++){var p=c[h[f].id];p<a&&(a=p,o=l)}var d=r[o],g=[];for(l=0;l<d.length;l+=1){var v=d[l];g[v.id]=[];for(var m=0,y=(0,s.getNeighbors)(v.id,t.edges,"target").filter((function(t){return d.map((function(t){return t.id})).indexOf(t)>-1}));m<y.length;m++){var _=y[m];_!==v.id||!1===n&&e.indexOf(v.id)>-1?g[v.id].push(c[_]):u.push(((i={})[v.id]=v,i))}}return{component:d,adjList:g,minIdx:a}},_=0;_<p.length;){var b=p.filter((function(t){return c[t.id]>=_})),x=(0,a.detectStrongConnectComponents)({nodes:b,edges:t.edges}).filter((function(t){return t.length>1}));if(0===x.length)break;var w=y(x),E=w.minIdx,S=w.adjList,C=w.component;if(!(C.length>1))break;C.forEach((function(t){o[t.id]=new Set}));var A=l[E];if(e&&n&&-1===e.indexOf(A.id))return u;h(A,A,S),_=E+1}return u};e.detectAllDirectedCycle=c,e.detectAllCycles=function(t,e,n,r){return void 0===r&&(r=!0),e?c(t,n,r):l(t,n,r)};e.default=function(t){var e=null,n=t.nodes,r={},i={},a={},s={};(void 0===n?[]:n).forEach((function(t){i[t.id]=t}));for(var u={enter:function(t){var n=t.current,o=t.previous;if(a[n]){e={};for(var s=n,u=o;u!==n;)e[s]=u,s=u,u=r[u];e[s]=u}else a[n]=n,delete i[n],r[n]=o},leave:function(t){var e=t.current;s[e]=e,delete a[e]},allowTraversal:function(t){var n=t.next;return!e&&!s[n]}};Object.keys(i).length;){var l=Object.keys(i)[0];(0,o.default)(t,l,u)}return e}},5891:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){i(t,e,"",function(t){void 0===t&&(t={});var e,n=t,r=function(){},i=(e={},function(t){var n=t.next;return!e[n]&&(e[n]=!0,!0)});return n.allowTraversal=t.allowTraversal||i,n.enter=t.enter||r,n.leave=t.leave||r,n}(n))};var r=n(643);function i(t,e,n,o){o.enter({current:e,previous:n});var a=t.edges,s=void 0===a?[]:a;(0,r.getNeighbors)(e,s,"target").forEach((function(r){o.allowTraversal({previous:n,current:e,next:r})&&i(t,r,e,o)})),o.leave({current:e,previous:n})}},8089:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(655),i=n(9242),o=n(643);function a(t,e,n,o){if(t===e)return[t];if(o[e])return o[e];for(var s=[],u=0,l=n[e];u<l.length;u++){var c=a(t,l[u],n,o);if(!c)return;for(var h=0,f=c;h<f.length;h++){var p=f[h];(0,i.isArray)(p)?s.push((0,r.__spreadArray)((0,r.__spreadArray)([],p,!0),[e],!1)):s.push([p,e])}}return o[e]=s,o[e]}e.default=function(t,e,n,r){var i=t.nodes,s=void 0===i?[]:i,u=t.edges,l=void 0===u?[]:u,c=[],h={},f={},p={};s.forEach((function(t,n){var r=t.id;c.push(r),f[r]=1/0,r===e&&(f[r]=0)}));for(var d=s.length,g=function(t){var e=function(t,e,n){for(var r,i=1/0,o=0;o<e.length;o++){var a=e[o].id;!n[a]&&t[a]<=i&&(i=t[a],r=e[o])}return r}(f,s,h),i=e.id;if(h[i]=!0,f[i]===1/0)return"continue";(n?(0,o.getOutEdgesNodeId)(i,l):(0,o.getEdgesByNodeId)(i,l)).forEach((function(t){var n=t.target,o=t.source,a=n===i?o:n,s=r&&t[r]?t[r]:1;f[a]>f[e.id]+s?(f[a]=f[e.id]+s,p[a]=[e.id]):f[a]===f[e.id]+s&&p[a].push(e.id)}))},v=0;v<d;v++)g();p[e]=[e];var m={};for(var y in f)f[y]!==1/0&&a(e,y,p,m);var _={};for(var y in m)_[y]=m[y][0];return{length:f,path:_,allPath:m}}},1727:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.findShortestPath=e.findAllPath=void 0;var r,i=(r=n(8089))&&r.__esModule?r:{default:r},o=n(643);e.findShortestPath=function(t,e,n,r,o){var a=(0,i.default)(t,e,r,o),s=a.length,u=a.path,l=a.allPath;return{length:s[n],path:u[n],allPath:l[n]}},e.findAllPath=function(t,e,n,r){var i;if(e===n)return[[e]];var a=t.edges,s=void 0===a?[]:a,u=[e],l=((i={})[e]=!0,i),c=[],h=[],f=r?(0,o.getNeighbors)(e,s,"target"):(0,o.getNeighbors)(e,s);for(c.push(f);u.length>0&&c.length>0;){var p=c[c.length-1];if(p.length){var d=p.shift();if(d&&(u.push(d),l[d]=!0,f=r?(0,o.getNeighbors)(d,s,"target"):(0,o.getNeighbors)(d,s),c.push(f.filter((function(t){return!l[t]})))),u[u.length-1]===n){var g=u.map((function(t){return t}));h.push(g),v=u.pop(),l[v]=!1,c.pop()}}else{var v=u.pop();l[v]=!1,c.pop()}}return h}},5033:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r,i=(r=n(2238))&&r.__esModule?r:{default:r};e.default=function(t,e){for(var n=(0,i.default)(t,e),r=[],o=n.length,a=0;a<o;a+=1){r[a]=[];for(var s=0;s<o;s+=1)a===s?r[a][s]=0:0!==n[a][s]&&n[a][s]?r[a][s]=n[a][s]:r[a][s]=1/0}for(var u=0;u<o;u+=1)for(a=0;a<o;a+=1)for(s=0;s<o;s+=1)r[a][s]>r[a][u]+r[u][s]&&(r[a][s]=r[a][u]+r[u][s]);return r}},1146:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(9242),i=n(8575),o=function(){function t(t,e,n,r,o){this.fromNode=t,this.toNode=e,this.nodeEdgeNodeLabel={nodeLabel1:n||i.VACANT_NODE_LABEL,edgeLabel:r||i.VACANT_EDGE_LABEL,nodeLabel2:o||i.VACANT_NODE_LABEL}}return t.prototype.equalTo=function(t){return this.fromNode===t.formNode&&this.toNode===t.toNode&&this.nodeEdgeNodeLabel===t.nodeEdgeNodeLabel},t.prototype.notEqualTo=function(t){return!this.equalTo(t)},t}(),a=function(){function t(){this.rmpath=[],this.dfsEdgeList=[]}return t.prototype.equalTo=function(t){var e=this.dfsEdgeList.length;if(e!==t.length)return!1;for(var n=0;n<e;n++)if(this.dfsEdgeList[n]!==t[n])return!1;return!0},t.prototype.notEqualTo=function(t){return!this.equalTo(t)},t.prototype.pushBack=function(t,e,n,r,i){return this.dfsEdgeList.push(new o(t,e,n,r,i)),this.dfsEdgeList},t.prototype.toGraph=function(t,e){void 0===t&&(t=i.VACANT_GRAPH_ID),void 0===e&&(e=!1);var n=new i.Graph(t,!0,e);return this.dfsEdgeList.forEach((function(t){var e=t.fromNode,r=t.toNode,o=t.nodeEdgeNodeLabel,a=o.nodeLabel1,s=o.edgeLabel,u=o.nodeLabel2;a!==i.VACANT_NODE_LABEL&&n.addNode(e,a),u!==i.VACANT_NODE_LABEL&&n.addNode(r,u),a!==i.VACANT_NODE_LABEL&&u!==a&&n.addEdge(void 0,e,r,s)})),n},t.prototype.buildRmpath=function(){this.rmpath=[];for(var t=void 0,e=this.dfsEdgeList.length-1;e>=0;e--){var n=this.dfsEdgeList[e],r=n.fromNode,i=n.toNode;r<i&&(void 0===t||i===t)&&(this.rmpath.push(e),t=r)}return this.rmpath},t.prototype.getNodeNum=function(){var t={};return this.dfsEdgeList.forEach((function(e){t[e.fromNode]||(t[e.fromNode]=!0),t[e.toNode]||(t[e.toNode]=!0)})),Object.keys(t).length},t}(),s=function(){function t(t){if(this.his={},this.nodesUsed={},this.edgesUsed={},this.edges=[],t){for(;t;){var e=t.edge;this.edges.push(e),this.nodesUsed[e.from]=1,this.nodesUsed[e.to]=1,this.edgesUsed[e.id]=1,t=t.preNode}this.edges=this.edges.reverse()}}return t.prototype.hasNode=function(t){return 1===this.nodesUsed[t.id]},t.prototype.hasEdge=function(t){return 1===this.edgesUsed[t.id]},t}(),u=function(){function t(t){var e=t.graphs,n=t.minSupport,r=void 0===n?2:n,i=t.minNodeNum,o=void 0===i?1:i,s=t.maxNodeNum,u=void 0===s?4:s,l=t.top,c=void 0===l?10:l,h=t.directed,f=void 0!==h&&h,p=t.verbose,d=void 0!==p&&p;this.graphs=e,this.dfsCode=new a,this.support=0,this.frequentSize1Subgraphs=[],this.frequentSubgraphs=[],this.minSupport=r,this.top=c,this.directed=f,this.counter=0,this.maxNodeNum=u,this.minNodeNum=o,this.verbose=d,this.maxNodeNum<this.minNodeNum&&(this.maxNodeNum=this.minNodeNum),this.reportDF=[]}return t.prototype.findForwardRootEdges=function(t,e){var n=this,r=[],i=t.nodeMap;return e.edges.forEach((function(t){(n.directed||e.label<=i[t.to].label)&&r.push(t)})),r},t.prototype.findBackwardEdge=function(t,e,n,r){if(!this.directed&&e===n)return null;for(var i=t.nodeMap,o=i[n.to].edges,a=o.length,s=0;s<a;s++){var u=o[s];if(!r.hasEdge(u)&&u.to===e.from)if(this.directed){if(i[e.from].label<i[n.to].label||i[e.from].label===i[n.to].label&&e.label<=u.label)return u}else if(e.label<u.label||e.label===u.label&&i[e.to].label<=i[n.to].label)return u}return null},t.prototype.findForwardPureEdges=function(t,e,n,r){for(var i=[],o=e.to,a=t.nodeMap[o].edges,s=a.length,u=0;u<s;u++){var l=a[u],c=t.nodeMap[l.to];n<=c.label&&!r.hasNode(c)&&i.push(l)}return i},t.prototype.findForwardRmpathEdges=function(t,e,n,r){for(var i=[],o=t.nodeMap,a=o[e.to].label,s=o[e.from].edges,u=s.length,l=0;l<u;l++){var c=s[l],h=o[c.to].label;e.to===c.to||n>h||r.hasNode(o[c.to])||(e.label<c.label||e.label===c.label&&a<=h)&&i.push(c)}return i},t.prototype.getSupport=function(t){var e={};return t.forEach((function(t){e[t.graphId]||(e[t.graphId]=!0)})),Object.keys(e).length},t.prototype.findMinLabel=function(t){var e=void 0;return Object.keys(t).forEach((function(n){var r=t[n],i=r.nodeLabel1,o=r.edgeLabel,a=r.nodeLabel2;e?(i<e.nodeLabel1||i===e.nodeLabel1&&o<e.edgeLabel||i===e.nodeLabel1&&o===e.edgeLabel&&a<e.nodeLabel2)&&(e={nodeLabel1:i,edgeLabel:o,nodeLabel2:a}):e={nodeLabel1:i,edgeLabel:o,nodeLabel2:a}})),e},t.prototype.isMin=function(){var t=this,e=this.dfsCode;if(this.verbose&&console.log("isMin checking",e),1===e.dfsEdgeList.length)return!0;var n=this.directed,r=e.toGraph(i.VACANT_GRAPH_ID,n),u=r.nodeMap,l=new a,c={};r.nodes.forEach((function(e){t.findForwardRootEdges(r,e).forEach((function(t){var n=u[t.to],i="".concat(e.label,"-").concat(t.label,"-").concat(n.label);c[i]||(c[i]={projected:[],nodeLabel1:e.label,edgeLabel:t.label,nodeLabel2:n.label});var o={graphId:r.id,edge:t,preNode:null};c[i].projected.push(o)}))}));var h=this.findMinLabel(c);if(h){l.dfsEdgeList.push(new o(0,1,h.nodeLabel1,h.edgeLabel,h.nodeLabel2));var f="".concat(h.nodeLabel1,"-").concat(h.edgeLabel,"-").concat(h.nodeLabel2);return function a(c){for(var h=l.buildRmpath(),f=l.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,p=l.dfsEdgeList[h[0]].toNode,d={},g=!1,v=0,m=n?-1:0,y=function(e){if(g)return"break";c.forEach((function(n){var i=new s(n),o=t.findBackwardEdge(r,i.edges[h[e]],i.edges[h[0]],i);o&&(d[o.label]||(d[o.label]={projected:[],edgeLabel:o.label}),d[o.label].projected.push({graphId:r.id,edge:d,preNode:n}),v=l.dfsEdgeList[h[e]].fromNode,g=!0)}))},_=h.length-1;_>m&&"break"!==y(_);_--);if(g){var b=t.findMinLabel(d);l.dfsEdgeList.push(new o(p,v,i.VACANT_NODE_LABEL,b.edgeLabel,i.VACANT_NODE_LABEL));var x=l.dfsEdgeList.length-1;return t.dfsCode.dfsEdgeList[x]===l.dfsEdgeList[x]&&a(d[b.edgeLabel].projected)}var w={};g=!1;var E=0;c.forEach((function(e){var n=new s(e),i=t.findForwardPureEdges(r,n.edges[h[0]],f,n);i.length>0&&(g=!0,E=p,i.forEach((function(t){var n="".concat(t.label,"-").concat(u[t.to].label);w[n]||(w[n]={projected:[],edgeLabel:t.label,nodeLabel2:u[t.to].label}),w[n].projected.push({graphId:r.id,edge:t,preNode:e})})))}));var S=h.length,C=function(e){if(g)return"break";var n=h[e];c.forEach((function(e){var i=new s(e),o=t.findForwardRmpathEdges(r,i.edges[n],f,i);o.length>0&&(g=!0,E=l.dfsEdgeList[n].fromNode,o.forEach((function(t){var n="".concat(t.label,"-").concat(u[t.to].label);w[n]||(w[n]={projected:[],edgeLabel:t.label,nodeLabel2:u[t.to].label}),w[n].projected.push({graphId:r.id,edge:t,preNode:e})})))}))};for(_=0;_<S&&"break"!==C(_);_++);if(!g)return!0;var A=t.findMinLabel(w);l.dfsEdgeList.push(new o(E,p+1,i.VACANT_NODE_LABEL,A.edgeLabel,A.nodeLabel2));var T=l.dfsEdgeList.length-1;return e.dfsEdgeList[T]===l.dfsEdgeList[T]&&a(w["".concat(A.edgeLabel,"-").concat(A.nodeLabel2)].projected)}(c[f].projected)}},t.prototype.report=function(){if(!(this.dfsCode.getNodeNum()<this.minNodeNum)){this.counter++;var t=this.dfsCode.toGraph(this.counter,this.directed);this.frequentSubgraphs.push((0,r.clone)(t))}},t.prototype.subGraphMining=function(t){var e=this;if(!(this.getSupport(t)<this.minSupport)&&this.isMin()){this.report();var n=this.dfsCode.getNodeNum(),r=this.dfsCode.buildRmpath(),a=this.dfsCode.dfsEdgeList[r[0]].toNode,u=this.dfsCode.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,l={},c={};t.forEach((function(t){for(var i=e.graphs[t.graphId],o=i.nodeMap,h=new s(t),f=r.length-1;f>=0;f--){var p=e.findBackwardEdge(i,h.edges[r[f]],h.edges[r[0]],h);if(p){var d="".concat(e.dfsCode.dfsEdgeList[r[f]].fromNode,"-").concat(p.label);c[d]||(c[d]={projected:[],toNodeId:e.dfsCode.dfsEdgeList[r[f]].fromNode,edgeLabel:p.label}),c[d].projected.push({graphId:t.graphId,edge:p,preNode:t})}}if(!(n>=e.maxNodeNum)){e.findForwardPureEdges(i,h.edges[r[0]],u,h).forEach((function(e){var n="".concat(a,"-").concat(e.label,"-").concat(o[e.to].label);l[n]||(l[n]={projected:[],fromNodeId:a,edgeLabel:e.label,nodeLabel2:o[e.to].label}),l[n].projected.push({graphId:t.graphId,edge:e,preNode:t})}));var g=function(n){e.findForwardRmpathEdges(i,h.edges[r[n]],u,h).forEach((function(i){var a="".concat(e.dfsCode.dfsEdgeList[r[n]].fromNode,"-").concat(i.label,"-").concat(o[i.to].label);l[a]||(l[a]={projected:[],fromNodeId:e.dfsCode.dfsEdgeList[r[n]].fromNode,edgeLabel:i.label,nodeLabel2:o[i.to].label}),l[a].projected.push({graphId:t.graphId,edge:i,preNode:t})}))};for(f=0;f<r.length;f++)g(f)}})),Object.keys(c).forEach((function(t){var n=c[t],r=n.toNodeId,i=n.edgeLabel;e.dfsCode.dfsEdgeList.push(new o(a,r,"-1",i,"-1")),e.subGraphMining(c[t].projected),e.dfsCode.dfsEdgeList.pop()})),Object.keys(l).forEach((function(t){var n=l[t],r=n.fromNodeId,s=n.edgeLabel,u=n.nodeLabel2;e.dfsCode.dfsEdgeList.push(new o(r,a+1,i.VACANT_NODE_LABEL,s,u)),e.subGraphMining(l[t].projected),e.dfsCode.dfsEdgeList.pop()}))}},t.prototype.generate1EdgeFrequentSubGraphs=function(){var t=this.graphs,e=this.directed,n=this.minSupport,r=this.frequentSize1Subgraphs,i={},o={},a={},s={};return Object.keys(t).forEach((function(n){var r=t[n],u=r.nodeMap;r.nodes.forEach((function(t,r){var l=t.label,c="".concat(n,"-").concat(l);if(!a[c]){var h=i[l]||0;h++,i[l]=h}a[c]={graphKey:n,label:l},t.edges.forEach((function(t){var r=l,i=u[t.to].label;if(!e&&r>i){var a=i;i=r,r=a}var c=t.label,h="".concat(n,"-").concat(r,"-").concat(c,"-").concat(i),f="".concat(r,"-").concat(c,"-").concat(i);if(!o[f]){var p=o[f]||0;p++,o[f]=p}s[h]={graphId:n,nodeLabel1:r,edgeLabel:c,nodeLabel2:i}}))}))})),Object.keys(i).forEach((function(t){if(!(i[t]<n)){var e={nodes:[],edges:[]};e.nodes.push({id:"0",label:t}),r.push(e)}})),r},t.prototype.run=function(){var t=this;if(this.frequentSize1Subgraphs=this.generate1EdgeFrequentSubGraphs(),!(this.maxNodeNum<2)){var e=this.graphs,n=(this.directed,{});Object.keys(e).forEach((function(r){var i=e[r],o=i.nodeMap;i.nodes.forEach((function(e){t.findForwardRootEdges(i,e).forEach((function(t){var i=o[t.to],a="".concat(e.label,"-").concat(t.label,"-").concat(i.label);n[a]||(n[a]={projected:[],nodeLabel1:e.label,edgeLabel:t.label,nodeLabel2:i.label});var s={graphId:r,edge:t,preNode:null};n[a].projected.push(s)}))}))})),Object.keys(n).forEach((function(e){var r=n[e],i=r.projected,a=r.nodeLabel1,s=r.edgeLabel,u=r.nodeLabel2;t.dfsCode.dfsEdgeList.push(new o(0,1,a,s,u)),t.subGraphMining(i),t.dfsCode.dfsEdgeList.pop()}))}},t}(),l="cluster";e.default=function(t){var e=t.graphs,n=t.directed,r=void 0!==n&&n,o=t.nodeLabelProp,a=void 0===o?l:o,s=t.edgeLabelProp,c=void 0===s?l:s,h=function(t,e,n,r){var o={};return Object.keys(t).forEach((function(a,s){var u=t[a],l=new i.Graph(s,!0,e),c={};u.nodes.forEach((function(t,e){l.addNode(e,t[n]),c[t.id]=e})),u.edges.forEach((function(t,e){var n=c[t.source],i=c[t.target];l.addEdge(-1,n,i,t[r])})),l&&l.getNodeNum()&&(o[l.id]=l)})),o}(e,r,a,c),f=t.minSupport,p=t.maxNodeNum,d=t.minNodeNum,g=t.verbose,v=t.top,m=new u({graphs:h,minSupport:f,maxNodeNum:p,minNodeNum:d,top:v,verbose:g,directed:r});m.run();var y=function(t,e,n){var r=[];return t.forEach((function(t){var i={nodes:[],edges:[]};t.nodes.forEach((function(t){var n;i.nodes.push(((n={id:"".concat(t.id)})[e]=t.label,n))})),t.edges.forEach((function(t){var e;i.edges.push(((e={source:"".concat(t.from),target:"".concat(t.to)})[n]=t.label,e))})),r.push(i)})),r}(m.frequentSubgraphs,a,c);return y}},8575:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VACANT_NODE_LABEL=e.VACANT_NODE_ID=e.VACANT_GRAPH_ID=e.VACANT_EDGE_LABEL=e.VACANT_EDGE_ID=e.Node=e.Graph=e.Edge=e.AUTO_EDGE_ID=void 0,e.VACANT_EDGE_ID=-1,e.VACANT_NODE_ID=-1,e.VACANT_EDGE_LABEL="-1",e.VACANT_NODE_LABEL="-1",e.VACANT_GRAPH_ID=-1,e.AUTO_EDGE_ID="-1";var n=function(t,e,n,r){void 0===t&&(t=-1),void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===r&&(r="-1"),this.id=t,this.from=e,this.to=n,this.label=r};e.Edge=n;var r=function(){function t(t,e){void 0===t&&(t=-1),void 0===e&&(e="-1"),this.id=t,this.label=e,this.edges=[],this.edgeMap={}}return t.prototype.addEdge=function(t){this.edges.push(t),this.edgeMap[t.id]=t},t}();e.Node=r;var i=function(){function t(t,e,n){void 0===t&&(t=-1),void 0===e&&(e=!0),void 0===n&&(n=!1),this.id=t,this.edgeIdAutoIncrease=e,this.edges=[],this.nodes=[],this.nodeMap={},this.edgeMap={},this.nodeLabelMap={},this.edgeLabelMap={},this.counter=0,this.directed=n}return t.prototype.getNodeNum=function(){return this.nodes.length},t.prototype.addNode=function(t,e){if(!this.nodeMap[t]){var n=new r(t,e);this.nodes.push(n),this.nodeMap[t]=n,this.nodeLabelMap[e]||(this.nodeLabelMap[e]=[]),this.nodeLabelMap[e].push(t)}},t.prototype.addEdge=function(t,e,r,i){if((this.edgeIdAutoIncrease||void 0===t)&&(t=this.counter++),!(this.nodeMap[e]&&this.nodeMap[r]&&this.nodeMap[r].edgeMap[t])){var o=new n(t,e,r,i);if(this.edges.push(o),this.edgeMap[t]=o,this.nodeMap[e].addEdge(o),this.edgeLabelMap[i]||(this.edgeLabelMap[i]=[]),this.edgeLabelMap[i].push(o),!this.directed){var a=new n(t,r,e,i);this.nodeMap[r].addEdge(a),this.edgeLabelMap[i].push(a)}}},t}();e.Graph=i},2812:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(655),i=u(n(5033)),o=u(n(1146)),a=u(n(8089)),s=n(643);function u(t){return t&&t.__esModule?t:{default:t}}var l=function(t,e,n,r){void 0===n&&(n="cluster"),void 0===r&&(r=2);var i=[],o=t.nodes;return e.forEach((function(t,e){i.push(c(o,t,e,n,r))})),i},c=function(t,e,n,r,i){var o=[n],a=[],s={};return e.forEach((function(e,u){if(e<=i&&n!==u){o.push(u),a.push(t[u]);var l=t[u][r];s[l]?(s[l].count++,s[l].dists.push(e)):s[l]={count:1,dists:[e]}}})),Object.keys(s).forEach((function(t){s[t].dists=s[t].dists.sort((function(t,e){return t-e}))})),{nodeIdx:n,nodeId:t[n].id,nodeIdxs:o,neighbors:a,neighborNum:o.length-1,nodeLabelCountMap:s}},h=function(t,e,n,r){var i=n.nodes;return r||(r={}),Object.keys(t).forEach((function(o){var a,s;if(!r||!r[o]){r[o]={nodes:[],edges:[]};var u=t[o],l=null===(a=e[u.start])||void 0===a?void 0:a.nodeIdxs,c=null===(s=e[u.end])||void 0===s?void 0:s.nodeIdxs;if(l&&c){var h=new Set(c),f=l.filter((function(t){return h.has(t)}));if(f&&f.length){for(var p={},d=f.length,g=0;g<d;g++){var v=i[f[g]];r[o].nodes.push(v),p[v.id]=!0}n.edges.forEach((function(t){p[t.source]&&p[t.target]&&r[o].edges.push(t)}))}}}})),r},f=function(t,e,n,r){var i,o,a={};t.nodes.forEach((function(t){a[t.id]=t}));var s=0;return!(null===(i=null==e?void 0:e.edges)||void 0===i?void 0:i.length)||(null===(o=null==e?void 0:e.nodes)||void 0===o?void 0:o.length)<2?0:(t.edges.forEach((function(t){var i=a[t.source][n],o=a[t.target][n],u=null==e?void 0:e.nodes[0][n],l=null==e?void 0:e.nodes[1][n],c=null==e?void 0:e.edges[0][r];t[r]===c&&(i===u&&o===l||i===l&&o===u)&&s++})),s)},p=function(t,e){var n={},r={};return t.forEach((function(t,i){n[t.id]={idx:i,node:t,degree:0,inDegree:0,outDegree:0};var o=t[e];r[o]||(r[o]=[]),r[o].push(t)})),{nodeMap:n,nodeLabelMap:r}},d=function(t,e,n){var r={},i={};return t.forEach((function(t,o){r["".concat(s.uniqueId)]={idx:o,edge:t};var a=t[e];i[a]||(i[a]=[]),i[a].push(t);var u=n[t.source];u&&(u.degree++,u.outDegree++);var l=n[t.target];l&&(l.degree++,l.inDegree++)})),{edgeMap:r,edgeLabelMap:i}},g=function(t,e,n){var r=e.length,i={};return e.forEach((function(e,o){for(var a=n?0:o+1,s=t[o].id,u=a;u<r;u++)if(o!==u){var l=t[u].id,c=e[u];i["".concat(s,"-").concat(l)]=c,n||(i["".concat(l,"-").concat(s)]=c)}})),i},v=function(t,e,n,r,i,o,a,s,u,l,c){var p,d="".concat(e.id,"-").concat(n.id);if(l&&l[d])return l[d];var g=c?c[d]:void 0;if(!g){var v=((p={})[d]={start:r[e.id].idx,end:r[n.id].idx,distance:i},p);g=(c=h(v,o,t,c))[d]}return f(g,a,s,u)},m=function(t,e,n,r){var i,o,a,s=null===(i=t[e])||void 0===i?void 0:i.degree,u=null===(o=t[e])||void 0===o?void 0:o.inDegree,l=null===(a=t[e])||void 0===a?void 0:a.outDegree;return void 0===t[e]&&(s=1/0,u=1/0,l=1/0,r[e].forEach((function(t){var e=n[t.id].degree;s>e&&(s=e);var r=n[t.id].inDegree;u>r&&(u=r);var i=n[t.id].outDegree;l>i&&(l=i)})),t[e]={degree:s,inDegree:u,outDegree:l}),{minPatternNodeLabelDegree:s,minPatternNodeLabelInDegree:u,minPatternNodeLabelOutDegree:l}};e.default=function(t,e,n,s,u,y,_){var b;if(void 0===n&&(n=!1),void 0===y&&(y="cluster"),void 0===_&&(_="cluster"),t&&t.nodes){var x=t.nodes.length;if(x){var w=(0,i.default)(t,n),E=(0,i.default)(e,n),S=g(t.nodes,w,n),C=g(e.nodes,E,n),A=p(t.nodes,y),T=A.nodeMap,k=A.nodeLabelMap,M=p(e.nodes,y),P=M.nodeMap,I=M.nodeLabelMap;d(t.edges,_,T);var O=d(e.edges,_,P).edgeLabelMap,R=[];null==E||E.forEach((function(t){R=R.concat(t)})),u||(u=Math.max.apply(Math,(0,r.__spreadArray)((0,r.__spreadArray)([],R,!1),[2],!1))),s||(s=u);var L=l(t,w,y,s),D=l(e,E,y,s),N=function(t,e,n,r,i){var o=Math.ceil(n/e),a={},s=0;return r.forEach((function(t,r){for(var u=0,l=0,c=t.nodeIdxs,h=t.neighborNum-1;u<o;){for(var f=c[1+Math.floor(Math.random()*h)],p=0;(a["".concat(r,"-").concat(f)]||a["".concat(f,"-").concat(r)])&&(f=Math.floor(Math.random()*e),!(++p>2*e)););if(p<2*e&&(a["".concat(r,"-").concat(f)]={start:r,end:f,distance:i[r][f]},u++,++s>=n))return a;if(++l>2*e)break}u<o&&(o=(o+(o-u))/(e-r-1))})),a}(0,x,Math.min(100,x*(x-1)/2),L,w),B=h(N,L,t),z={graphs:B,nodeLabelProp:y,edgeLabelProp:_,minSupport:1,minNodeNum:1,maxNodeNum:4,directed:n},F=(0,o.default)(z).slice(0,10),Z=F.length,j=[];F.forEach((function(t,e){j[e]={},Object.keys(B).forEach((function(n){var r=B[n],i=f(r,t,y,_);j[e][n]=i}))}));var U=function(t,e,n){for(var r=1/0,i=0,o=function(e){var n=t[e],o=Object.keys(n).sort((function(t,e){return n[t]-n[e]})),a=[];o.forEach((function(t,e){a[e%10]||(a[e%10]={graphs:[],totalCount:0,aveCount:0}),a[e%10].graphs.push(t),a[e%10].totalCount+=n[t]}));var s=0,u=[];a.forEach((function(t){var e=t.totalCount/t.graphs.length;t.aveCount=e,u.push(e);var r=0,i=t.length;t.graphs.forEach((function(e,i){var o=n[e];t.graphs.forEach((function(t,e){i!==e&&(r+=Math.abs(o-n[t]))}))})),s+=r/=i*(i-1)/2})),s/=a.length;var l=0;u.forEach((function(t,e){u.forEach((function(n,r){e!==r&&(l+=Math.abs(t-n))})),l/=u.length*(u.length-1)/2}));var c=l-s;r<c&&(r=c,i=e)},a=0;a<e;a++)o(a);return{structure:n[i],structureCountMap:t[i]}}(j,Z,F),G=U.structure,V=U.structureCountMap,W=e.nodes[0],H=[],X=null===(b=e.nodes[0])||void 0===b?void 0:b[y],Y=-1/0;e.nodes.forEach((function(t){var e=t[y],n=k[e];(null==n?void 0:n.length)>Y&&(Y=n.length,H=n,X=e,W=t)}));var q={},K={},Q={},J={},$={},tt={};Object.keys(I).forEach((function(r,i){$[r]=[],n&&(tt[r]=[]);var o=-1/0,a=I[r],s={};a.forEach((function(t){var e=C["".concat(W.id,"-").concat(t.id)];if(e&&$[r].push(e),o<e&&(o=e),s["".concat(W.id,"-").concat(t.id)]={start:0,end:P[t.id].idx,distance:e},n){var i=C["".concat(t.id,"-").concat(W.id)];i&&tt[r].push(i)}})),$[r]=$[r].sort((function(t,e){return t-e})),n&&(tt[r]=tt[r].sort((function(t,e){return t-e}))),K=h(s,D,e,K);var u=[];if(Object.keys(s).forEach((function(t){if(Q[t])u.push(Q[t]);else{var e=K[t];Q[t]=f(e,G,y,_),u.push(Q[t])}})),u=u.sort((function(t,e){return e-t})),J["".concat(W.id,"-").concat(r)]=u,r!==X)for(var l=function(e){var n=H[e],i=L[T[n.id].idx],o=i.nodeLabelCountMap[r],a=I[r].length;if(!o||o.count<a)return H.splice(e,1),"continue";for(var s=!1,l=0;l<a;l++)if(o.dists[l]>$[r][l]){s=!0;break}if(s)return H.splice(e,1),"continue";var c={};i.neighbors.forEach((function(t){var e=S["".concat(n.id,"-").concat(t.id)];c["".concat(n.id,"-").concat(t.id)]={start:T[n.id].idx,end:T[t.id].idx,distance:e}})),B=h(c,L,t,B);var p=[];Object.keys(c).forEach((function(t){if(V[t])p.push(V[t]);else{var e=B[t];V[t]=f(e,G,y,_),p.push(V[t])}})),p=p.sort((function(t,e){return e-t}));var d=!1;for(l=0;l<a;l++)if(p[l]<u[l]){d=!0;break}return d?(H.splice(e,1),"continue"):void 0},c=((null==H?void 0:H.length)||0)-1;c>=0;c--)l(c)}));var et=[];null==H||H.forEach((function(r){for(var i=T[r.id].idx,o=c(t.nodes,w[i],i,y,u).neighbors,a=!1,s=o.length-1;s>=0;s--){if(o.length+1<e.nodes.length)return void(a=!0);var l=o[s],h=l[y];if(I[h]&&I[h].length)if($[h]&&$[h].length){var f="".concat(r.id,"-").concat(l.id),p=S[f],d=$[h].length-1;if(p>$[h][d])o.splice(s,1);else{if(n){var g="".concat(l.id,"-").concat(r.id),b=S[g];if(d=tt[h].length-1,b>tt[h][d]){o.splice(s,1);continue}}var x=V[f]?V[f]:v(t,r,l,T,p,L,G,y,_,V,B),E="".concat(W.id,"-").concat(h);if(x<J[E][J[E].length-1])o.splice(s,1);else{var C=m(q,h,P,I),A=C.minPatternNodeLabelDegree;C.minPatternNodeLabelInDegree,C.minPatternNodeLabelOutDegree,T[l.id].degree<A&&o.splice(s,1)}}}else o.splice(s,1);else o.splice(s,1)}a||et.push({nodes:[r].concat(o)})}));var nt=(0,a.default)(e,W.id,!1).length,rt={};n?(Object.keys(nt).forEach((function(t){var e=P[t].node[y];rt[e]?rt[e].push(nt[t]):rt[e]=[nt[t]]})),Object.keys(rt).forEach((function(t){rt[t].sort((function(t,e){return t-e}))}))):rt=$;for(var it=function(r){var i=et[r],o=i.nodes[0],s={},u={};i.nodes.forEach((function(t,e){u[t.id]={idx:e,node:t,degree:0,inDegree:0,outDegree:0};var n=t[y];s[n]?s[n]++:s[n]=1}));var l=[],c={};t.edges.forEach((function(t){u[t.source]&&u[t.target]&&(l.push(t),c[t[_]]?c[t[_]]++:c[t[_]]=1,u[t.source].degree++,u[t.target].degree++,u[t.source].outDegree++,u[t.target].inDegree++)}));for(var h=Object.keys(O).length,f=!1,p=0;p<h;p++){var d=Object.keys(O)[p];if(!c[d]||c[d]<O[d].length){f=!0;break}}if(f)return et.splice(r,1),"continue";var g=l.length;if(g<e.edges.length)return et.splice(r,1),"break";var v=!1,b=function(t){var e=l[t],r=e[_],i=O[r];if(!i||!i.length)return c[r]--,i&&c[r]<i.length?(v=!0,"break"):(l.splice(t,1),u[e.source].degree--,u[e.target].degree--,u[e.source].outDegree--,u[e.target].inDegree--,"continue");var o=u[e.source].node[y],a=u[e.target].node[y],s=!1;return i.forEach((function(t){var e=P[t.source].node,r=P[t.target].node;e[y]===o&&r[y]===a&&(s=!0),n||e[y]!==a||r[y]!==o||(s=!0)})),s?void 0:(c[r]--,i&&c[r]<i.length?(v=!0,"break"):(l.splice(t,1),u[e.source].degree--,u[e.target].degree--,u[e.source].outDegree--,u[e.target].inDegree--,"continue"))};for(p=g-1;p>=0&&"break"!==b(p);p--);if(v)return et.splice(r,1),"continue";i.edges=l;var x=(0,a.default)(i,i.nodes[0].id,!1).length;if(Object.keys(x).reverse().forEach((function(t){if(t!==i.nodes[0].id&&!v){if(x[t]===1/0){var e=u[t].node[y];if(s[e]--,s[e]<I[e].length)return void(v=!0);var n=i.nodes.indexOf(u[t].node);return i.nodes.splice(n,1),void(u[t]=void 0)}var r=T[t].node[y];if(!rt[r]||!rt[r].length||x[t]>rt[r][rt[r].length-1]){if(e=u[t].node[y],s[e]--,s[e]<I[e].length)return void(v=!0);n=i.nodes.indexOf(u[t].node),i.nodes.splice(n,1),u[t]=void 0}}})),v)return et.splice(r,1),"continue";for(var w=!0,E=0;w&&!v;){if(w=!1,n?u[o.id].degree<P[W.id].degree||u[o.id].inDegree<P[W.id].inDegree||u[o.id].outDegree<P[W.id].outDegree:u[o.id].degree<P[W.id].degree){v=!0;break}if(s[o[y]]<I[o[y]].length){v=!0;break}for(var S=i.nodes.length-1;S>=0;S--){var C=i.nodes[S],A=u[C.id].degree,k=u[C.id].inDegree,M=u[C.id].outDegree,R=C[y],L=m(q,R,P,I),D=L.minPatternNodeLabelDegree,N=L.minPatternNodeLabelInDegree,B=L.minPatternNodeLabelOutDegree;if(n?A<D||k<N||M<B:A<D){if(s[C[y]]--,s[C[y]]<I[C[y]].length){v=!0;break}i.nodes.splice(S,1),u[C.id]=void 0,w=!0}}if(v||!w&&0!==E)break;for(var z=(g=l.length)-1;z>=0;z--){var F=l[z];if(!u[F.source]||!u[F.target]){l.splice(z,1);var Z=F[_];if(c[Z]--,u[F.source]&&(u[F.source].degree--,u[F.source].outDegree--),u[F.target]&&(u[F.target].degree--,u[F.target].inDegree--),O[Z]&&c[Z]<O[Z].length){v=!0;break}w=!0}}E++}return v||v||i.nodes.length<e.nodes.length||l.length<e.edges.length?(et.splice(r,1),"continue"):void 0},ot=et.length-1;ot>=0&&"break"!==it(ot);ot--);var at=et.length,st=function(t){var e=et[t],n={};e.edges.forEach((function(t){var e="".concat(t.source,"-").concat(t.target,"-").concat(t.label);n[e]?n[e]++:n[e]=1}));for(var r=function(t){var e=et[t],r={};e.edges.forEach((function(t){var e="".concat(t.source,"-").concat(t.target,"-").concat(t.label);r[e]?r[e]++:r[e]=1}));var i=!0;Object.keys(r).length!==Object.keys(n).length?i=!1:Object.keys(n).forEach((function(t){r[t]!==n[t]&&(i=!1)})),i&&et.splice(t,1)},i=at-1;i>t;i--)r(i);at=et.length};for(ot=0;ot<=at-1;ot++)st(ot);return et}}}},5170:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r,i=(r=n(2238))&&r.__esModule?r:{default:r},o=n(643);e.default=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n="weight"),void 0===r&&(r=1e3);var a=t.nodes,s=void 0===a?[]:a,u=t.edges,l=void 0===u?[]:u,c={},h={};s.forEach((function(t,e){var n=(0,o.uniqueId)();t.clusterId=n,c[n]={id:n,nodes:[t]},h[t.id]={node:t,idx:e}}));var f=(0,i.default)(t,e),p=[],d={};f.forEach((function(t,e){var n=0,r=s[e].id;d[r]={},t.forEach((function(t,e){if(t){n+=t;var i=s[e].id;d[r][i]=t}})),p.push(n)}));for(var g=0,v=function(){var t=!1;if(s.forEach((function(e){var n={};Object.keys(d[e.id]).forEach((function(t){var r=d[e.id][t],i=h[t].node.clusterId;n[i]||(n[i]=0),n[i]+=r}));var r=-1/0,i=[];if(Object.keys(n).forEach((function(t){r<n[t]?(r=n[t],i=[t]):r===n[t]&&i.push(t)})),1!==i.length||i[0]!==e.clusterId){var o=i.indexOf(e.clusterId);if(o>=0&&i.splice(o,1),i&&i.length){t=!0;var a=c[e.clusterId],s=a.nodes.indexOf(e);a.nodes.splice(s,1);var u=Math.floor(Math.random()*i.length),l=c[i[u]];l.nodes.push(e),e.clusterId=l.id}}})),!t)return"break";g++};g<r&&"break"!==v(););Object.keys(c).forEach((function(t){var e=c[t];e.nodes&&e.nodes.length||delete c[t]}));var m=[],y={};l.forEach((function(t){var e=t.source,r=t.target,i=t[n]||1,o=h[e].node.clusterId,a=h[r].node.clusterId,s="".concat(o,"---").concat(a);if(y[s])y[s].weight+=i,y[s].count++;else{var u={source:o,target:a,weight:i,count:1};y[s]=u,m.push(u)}}));var _=[];return Object.keys(c).forEach((function(t){_.push(c[t])})),{clusters:_,clusterEdges:m}}},5179:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(9242),i=u(n(2238)),o=u(n(9741)),a=n(3665),s=n(6838);function u(t){return t&&t.__esModule?t:{default:t}}var l=function(t,e,n,r){for(var i=e.length,o=2*r,a=0,s=0;s<i;s++)for(var u=t[s].clusterId,l=0;l<i;l++)u===t[l].clusterId&&(a+=(e[s][l]||0)-(n[s]||0)*(n[l]||0)/o);return a*(1/o)},c=function(t,e){void 0===t&&(t=[]);for(var n=t.length,r=new o.default([]),i=0;i<n;i++)r=r.add(new o.default(e[i]));var a=r.avg(n);a.normalize();var s=0;for(i=0;i<n;i++)s+=(l=new o.default(e[i])).squareEuclideanDistance(a);var u=[];for(t.forEach((function(){u.push([])})),i=0;i<n;i++){var l=new o.default(e[i]);t[i].clusterInertial=0;for(var c=0;c<n;c++)if(i!==c){var h=new o.default(e[c]);u[i][c]=l.squareEuclideanDistance(h),t[i].clusterInertial+=u[i][c]}else u[i][c]=0}var f=0,p=2*n*s;for(i=0;i<n;i++){var d=t[i].clusterId;for(c=0;c<n;c++){var g=t[c].clusterId;i!==c&&d===g&&(f+=t[i].clusterInertial*t[c].clusterInertial/Math.pow(p,2)-u[i][c]/p)}}return Number(f.toFixed(4))};e.default=function(t,e,n,o,u,h){void 0===e&&(e=!1),void 0===n&&(n="weight"),void 0===o&&(o=1e-4),void 0===u&&(u=!1),void 0===h&&(h=1);var f=t.nodes,p=void 0===f?[]:f,d=t.edges,g=void 0===d?[]:d,v=[];if(u){p.forEach((function(t,e){t.properties=t.properties||{},t.originIndex=e}));var m=[];p.every((function(t){return t.hasOwnProperty("nodeType")}))&&(m=Array.from(new Set(p.map((function(t){return t.nodeType})))),p.forEach((function(t){t.properties.nodeType=m.findIndex((function(e){return e===t.nodeType}))})));var y=(0,a.getAllProperties)(p);v=(0,s.oneHot)(y)}var _=1,b={},x={};p.forEach((function(t,e){var n=String(_++);t.clusterId=n,b[n]={id:n,nodes:[t]},x[t.id]={node:t,idx:e}}));var w=(0,i.default)(t,e),E=[],S={},C=0;w.forEach((function(t,e){var n=0,r=p[e].id;S[r]={},t.forEach((function(t,e){if(t){n+=t;var i=p[e].id;S[r][i]=t,C+=t}})),E.push(n)})),C/=2;for(var A=1/0,T=1/0,k=0,M=[],P={};;){A=u&&p.every((function(t){return t.hasOwnProperty("properties")}))?l(p,w,E,C)+c(p,v)*h:l(p,w,E,C),0===k&&(T=A,M=p,P=b);var I=A>0&&A>T&&A-T<o;if(A>T&&(M=p.map((function(t){return{node:t,clusterId:t.clusterId}})),P=(0,r.clone)(b),T=A),I||k>100)break;k++,Object.keys(b).forEach((function(t){var e=0;g.forEach((function(r){var i=r.source,o=r.target,a=x[i].node.clusterId,s=x[o].node.clusterId;(a===t&&s!==t||s===t&&a!==t)&&(e+=r[n]||1)})),b[t].sumTot=e})),p.forEach((function(t,e){var r,i=b[t.clusterId],o=0,a=E[e]/(2*C),s=0,l=i.nodes;l.forEach((function(t){var n=x[t.id].idx;s+=w[e][n]||0}));var f=s-i.sumTot*a,p=l.filter((function(e){return e.id!==t.id})),d=[];p.forEach((function(t,e){d[e]=v[t.originIndex]}));var m=c(p,v)*h,y=S[t.id];if(Object.keys(y).forEach((function(n){var i=x[n].node.clusterId;if(i!==t.clusterId){var s=b[i],l=s.nodes;if(l&&l.length){var p=0;l.forEach((function(t){var n=x[t.id].idx;p+=w[e][n]||0}));var d=p-s.sumTot*a,g=l.concat([t]),y=[];g.forEach((function(t,e){y[e]=v[t.originIndex]}));var _=c(g,v)*h,E=d-f;u&&(E=d+_-(f+m)),E>o&&(o=E,r=s)}}})),o>0){r.nodes.push(t);var _=t.clusterId;t.clusterId=r.id;var A=i.nodes.indexOf(t);i.nodes.splice(A,1);var T=0,k=0;g.forEach((function(t){var e=t.source,i=t.target,o=x[e].node.clusterId,a=x[i].node.clusterId;(o===r.id&&a!==r.id||a===r.id&&o!==r.id)&&(T+=t[n]||1),(o===_&&a!==_||a===_&&o!==_)&&(k+=t[n]||1)})),r.sumTot=T,i.sumTot=k}}))}var O={},R=0;Object.keys(P).forEach((function(t){var e=P[t];if(e.nodes&&e.nodes.length){var n=String(R+1);n!==t&&(e.id=n,e.nodes=e.nodes.map((function(t){return{id:t.id,clusterId:n}})),P[n]=e,O[t]=n,delete P[t],R++)}else delete P[t]})),M.forEach((function(t){var e=t.node,n=t.clusterId;e.clusterId=n,e.clusterId&&O[e.clusterId]&&(e.clusterId=O[e.clusterId])}));var L=[],D={};g.forEach((function(t){var e=t.source,r=t.target,i=t[n]||1,o=x[e].node.clusterId,a=x[r].node.clusterId,s="".concat(o,"---").concat(a);if(D[s])D[s].weight+=i,D[s].count++;else{var u={source:o,target:a,weight:i,count:1};D[s]=u,L.push(u)}}));var N=[];return Object.keys(P).forEach((function(t){N.push(P[t])})),{clusters:N,clusterEdges:L}}},5553:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=a(n(8823)),i=a(n(7085)),o=n(643);function a(t){return t&&t.__esModule?t:{default:t}}var s=function(t,e){var n=[],r=t.nodes,a=void 0===r?[]:r,s=t.edges,u=void 0===s?[]:s;if(0===a.length)return n;var l=a[0],c=new Set;c.add(l);var h=new i.default((function(t,n){return e?t.weight-n.weight:0}));for((0,o.getEdgesByNodeId)(l.id,u).forEach((function(t){h.insert(t)}));!h.isEmpty();){var f=h.delMin(),p=f.source,d=f.target;c.has(p)&&c.has(d)||(n.push(f),c.has(p)||(c.add(p),(0,o.getEdgesByNodeId)(p,u).forEach((function(t){h.insert(t)}))),c.has(d)||(c.add(d),(0,o.getEdgesByNodeId)(d,u).forEach((function(t){h.insert(t)}))))}return n},u=function(t,e){var n=[],i=t.nodes,o=void 0===i?[]:i,a=t.edges,s=void 0===a?[]:a;if(0===o.length)return n;var u=s.map((function(t){return t}));e&&u.sort((function(t,e){return t.weight-e.weight}));for(var l=new r.default(o.map((function(t){return t.id})));u.length>0;){var c=u.shift(),h=c.source,f=c.target;l.connected(h,f)||(n.push(c),l.union(h,f))}return n};e.default=function(t,e,n){return n?{prim:s,kruskal:u}[n](t,e):u(t,e)}},4926:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r,i=(r=n(2556))&&r.__esModule?r:{default:r},o=n(643);e.default=function(t,e,n){"number"!=typeof e&&(e=1e-6),"number"!=typeof n&&(n=.85);for(var r,a=1,s=0,u=1e3,l=t.nodes,c=void 0===l?[]:l,h=t.edges,f=void 0===h?[]:h,p=c.length,d={},g={},v=0;v<p;++v)d[y=(E=c[v]).id]=1/p,g[y]=1/p;for(var m=(0,i.default)(t);u>0&&a>e;){for(s=0,v=0;v<p;++v){var y=(E=c[v]).id;if(r=0,0===m[E.id].inDegree)d[y]=0;else{for(var _=(0,o.getNeighbors)(y,f,"source"),b=0;b<_.length;++b){var x=_[b],w=m[x].outDegree;w>0&&(r+=g[x]/w)}d[y]=n*r,s+=d[y]}}for(s=(1-s)/p,a=0,v=0;v<p;++v){var E;r=d[y=(E=c[v]).id]+s,a+=Math.abs(r-g[y]),g[y]=r}u-=1}return g}},7085:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(t,e){return t-e},r=function(){function t(t){void 0===t&&(t=n),this.compareFn=t,this.list=[]}return t.prototype.getLeft=function(t){return 2*t+1},t.prototype.getRight=function(t){return 2*t+2},t.prototype.getParent=function(t){return 0===t?null:Math.floor((t-1)/2)},t.prototype.isEmpty=function(){return this.list.length<=0},t.prototype.top=function(){return this.isEmpty()?void 0:this.list[0]},t.prototype.delMin=function(){var t=this.top(),e=this.list.pop();return this.list.length>0&&(this.list[0]=e,this.moveDown(0)),t},t.prototype.insert=function(t){if(null!==t){this.list.push(t);var e=this.list.length-1;return this.moveUp(e),!0}return!1},t.prototype.moveUp=function(t){for(var e=this.getParent(t);t&&t>0&&this.compareFn(this.list[e],this.list[t])>0;){var n=this.list[e];this.list[e]=this.list[t],this.list[t]=n,t=e,e=this.getParent(t)}},t.prototype.moveDown=function(t){var e,n=t,r=this.getLeft(t),i=this.getRight(t),o=this.list.length;null!==r&&r<o&&this.compareFn(this.list[n],this.list[r])>0?n=r:null!==i&&i<o&&this.compareFn(this.list[n],this.list[i])>0&&(n=i),t!==n&&(e=[this.list[n],this.list[t]],this.list[t]=e[0],this.list[n]=e[1],this.moveDown(n))},t}();e.default=r},8481:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.LinkedListNode=void 0;var n=function(t,e){return t===e},r=function(){function t(t,e){void 0===e&&(e=null),this.value=t,this.next=e}return t.prototype.toString=function(t){return t?t(this.value):"".concat(this.value)},t}();e.LinkedListNode=r;var i=function(){function t(t){void 0===t&&(t=n),this.head=null,this.tail=null,this.compare=t}return t.prototype.prepend=function(t){var e=new r(t,this.head);return this.head=e,this.tail||(this.tail=e),this},t.prototype.append=function(t){var e=new r(t);return this.head?(this.tail.next=e,this.tail=e,this):(this.head=e,this.tail=e,this)},t.prototype.delete=function(t){if(!this.head)return null;for(var e=null;this.head&&this.compare(this.head.value,t);)e=this.head,this.head=this.head.next;var n=this.head;if(null!==n)for(;n.next;)this.compare(n.next.value,t)?(e=n.next,n.next=n.next.next):n=n.next;return this.compare(this.tail.value,t)&&(this.tail=n),e},t.prototype.find=function(t){var e=t.value,n=void 0===e?void 0:e,r=t.callback,i=void 0===r?void 0:r;if(!this.head)return null;for(var o=this.head;o;){if(i&&i(o.value))return o;if(void 0!==n&&this.compare(o.value,n))return o;o=o.next}return null},t.prototype.deleteTail=function(){var t=this.tail;if(this.head===this.tail)return this.head=null,this.tail=null,t;for(var e=this.head;e.next;)e.next.next?e=e.next:e.next=null;return this.tail=e,t},t.prototype.deleteHead=function(){if(!this.head)return null;var t=this.head;return this.head.next?this.head=this.head.next:(this.head=null,this.tail=null),t},t.prototype.fromArray=function(t){var e=this;return t.forEach((function(t){return e.append(t)})),this},t.prototype.toArray=function(){for(var t=[],e=this.head;e;)t.push(e),e=e.next;return t},t.prototype.reverse=function(){for(var t=this.head,e=null,n=null;t;)n=t.next,t.next=e,e=t,t=n;this.tail=this.head,this.head=e},t.prototype.toString=function(t){return void 0===t&&(t=void 0),this.toArray().map((function(e){return e.toString(t)})).toString()},t}();e.default=i},3026:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r,i=(r=n(8481))&&r.__esModule?r:{default:r},o=function(){function t(){this.linkedList=new i.default}return t.prototype.isEmpty=function(){return!this.linkedList.head},t.prototype.peek=function(){return this.linkedList.head?this.linkedList.head.value:null},t.prototype.enqueue=function(t){this.linkedList.append(t)},t.prototype.dequeue=function(){var t=this.linkedList.deleteHead();return t?t.value:null},t.prototype.toString=function(t){return this.linkedList.toString(t)},t}();e.default=o},8823:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function t(t){this.count=t.length,this.parent={};for(var e=0,n=t;e<n.length;e++){var r=n[e];this.parent[r]=r}}return t.prototype.find=function(t){for(;this.parent[t]!==t;)t=this.parent[t];return t},t.prototype.union=function(t,e){var n=this.find(t),r=this.find(e);n!==r&&(n<r?(this.parent[e]!==e&&this.union(this.parent[e],t),this.parent[e]=this.parent[t]):(this.parent[t]!==t&&this.union(this.parent[t],e),this.parent[t]=this.parent[e]))},t.prototype.connected=function(t,e){return this.find(t)===this.find(e)},t}();e.default=n},7892:(t,e)=>{"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.DistanceType=void 0,e.DistanceType=n,function(t){t.EuclideanDistance="euclideanDistance"}(n||(e.DistanceType=n={}))},643:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.uniqueId=e.getOutEdgesNodeId=e.getNeighbors=e.getEdgesByNodeId=void 0,e.getNeighbors=function(t,e,n){void 0===e&&(e=[]);var r=e.filter((function(e){return e.source===t||e.target===t}));return"target"===n?r.filter((function(e){return e.source===t})).map((function(t){return t.target})):"source"===n?r.filter((function(e){return e.target===t})).map((function(t){return t.source})):r.map((function(e){return e.source===t?e.target:e.source}))},e.getOutEdgesNodeId=function(t,e){return e.filter((function(e){return e.source===t}))},e.getEdgesByNodeId=function(t,e){return e.filter((function(e){return e.source===t||e.target===t}))},e.uniqueId=function(t){void 0===t&&(t=0);var e="".concat(Math.random()).split(".")[1].substr(0,5),n="".concat(Math.random()).split(".")[1].substr(0,5);return"".concat(t,"-").concat(e).concat(n)}},6838:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.oneHot=e.getDistance=e.getAllKeyValueMap=e.default=void 0;var r,i=n(9242),o=n(7892),a=(r=n(9741))&&r.__esModule?r:{default:r},s=function(t,e,n){var r=[];(null==e?void 0:e.length)?r=e:(t.forEach((function(t){r=r.concat(Object.keys(t))})),r=(0,i.uniq)(r));var o={};return r.forEach((function(e){var r=[];t.forEach((function(t){void 0!==t[e]&&""!==t[e]&&r.push(t[e])})),r.length&&!(null==n?void 0:n.includes(e))&&(o[e]=(0,i.uniq)(r))})),o};e.getAllKeyValueMap=s;var u=function(t,e,n){var r=s(t,e,n),i=[];return t.forEach((function(t,e){var n=[];Object.keys(r).forEach((function(e){for(var i=t[e],o=r[e],a=o.findIndex((function(t){return i===t})),s=[],u=0;u<o.length;u++)u===a?s.push(1):s.push(0);n=n.concat(s)})),i[e]=n})),i};e.oneHot=u;var l=function(t,e,n,r){void 0===n&&(n=o.DistanceType.EuclideanDistance);var i=0;return n===o.DistanceType.EuclideanDistance&&(i=new a.default(t).euclideanDistance(new a.default(e))),i};e.getDistance=l;var c={getAllKeyValueMap:s,oneHot:u,getDistance:l};e.default=c},3665:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getPropertyWeight=e.getAllSortProperties=e.getAllProperties=e.default=void 0;var r=n(2935),i=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=100);var n={};t.forEach((function(t){t.properties&&Object.keys(t.properties).forEach((function(e){"id"===e||!"".concat(t.properties[e]).match(r.secondReg)&&!"".concat(t.properties[e]).match(r.dateReg)&&isNaN(Number(t.properties[e]))?n.hasOwnProperty(e)&&delete n[e]:n.hasOwnProperty(e)?n[e]+=1:n[e]=1}))}));var i=Object.keys(n).sort((function(t,e){return n[e]-n[t]}));return i.length<e?i:i.slice(0,e)};e.getAllSortProperties=i;var o=function(t,e){return e.map((function(e){if(t.hasOwnProperty(e)){if(!isNaN(Number(t[e])))return Number(t[e]);if(t[e].match(r.secondReg)||t[e].match(r.dateReg))return Number(Date.parse(new Date(t[e])))/1e3}return 0}))},a=function(t){for(var e=i(t),n=[],r=0;r<t.length;r++)n[r]=o(t[r].properties,e);return n};e.getPropertyWeight=a;var s=function(t,e){void 0===e&&(e="properties");var n=[];return t.forEach((function(t){t.properties&&n.push(t[e])})),n};e.getAllProperties=s;var u={getAllSortProperties:i,getPropertyWeight:a,getAllProperties:s};e.default=u},9741:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(9242),i=function(){function t(t){this.arr=t}return t.prototype.getArr=function(){return this.arr||[]},t.prototype.add=function(e){var n,r=e.arr;if(!(null===(n=this.arr)||void 0===n?void 0:n.length))return new t(r);if(!(null==r?void 0:r.length))return new t(this.arr);if(this.arr.length===r.length){var i=[];for(var o in this.arr)i[o]=this.arr[o]+r[o];return new t(i)}},t.prototype.subtract=function(e){var n,r=e.arr;if(!(null===(n=this.arr)||void 0===n?void 0:n.length))return new t(r);if(!(null==r?void 0:r.length))return new t(this.arr);if(this.arr.length===r.length){var i=[];for(var o in this.arr)i[o]=this.arr[o]-r[o];return new t(i)}},t.prototype.avg=function(e){var n=[];if(0!==e)for(var r in this.arr)n[r]=this.arr[r]/e;return new t(n)},t.prototype.negate=function(){var e=[];for(var n in this.arr)e[n]=-this.arr[n];return new t(e)},t.prototype.squareEuclideanDistance=function(t){var e,n=t.arr;if(!(null===(e=this.arr)||void 0===e?void 0:e.length)||!(null==n?void 0:n.length))return 0;if(this.arr.length===n.length){var r=0;for(var i in this.arr)r+=Math.pow(this.arr[i]-t.arr[i],2);return r}},t.prototype.euclideanDistance=function(t){var e,n=t.arr;if(!(null===(e=this.arr)||void 0===e?void 0:e.length)||!(null==n?void 0:n.length))return 0;if(this.arr.length===n.length){var r=0;for(var i in this.arr)r+=Math.pow(this.arr[i]-t.arr[i],2);return Math.sqrt(r)}console.error("The two vectors are unequal in length.")},t.prototype.normalize=function(){var e=[],n=(0,r.clone)(this.arr);n.sort((function(t,e){return t-e}));var i=n[n.length-1],o=n[0];for(var a in this.arr)e[a]=(this.arr[a]-o)/(i-o);return new t(e)},t.prototype.norm2=function(){var t;if(!(null===(t=this.arr)||void 0===t?void 0:t.length))return 0;var e=0;for(var n in this.arr)e+=Math.pow(this.arr[n],2);return Math.sqrt(e)},t.prototype.dot=function(t){var e,n=t.arr;if(!(null===(e=this.arr)||void 0===e?void 0:e.length)||!(null==n?void 0:n.length))return 0;if(this.arr.length===n.length){var r=0;for(var i in this.arr)r+=this.arr[i]*t.arr[i];return r}console.error("The two vectors are unequal in length.")},t.prototype.equal=function(t){var e,n=t.arr;if((null===(e=this.arr)||void 0===e?void 0:e.length)!==(null==n?void 0:n.length))return!1;for(var r in this.arr)if(this.arr[r]!==n[r])return!1;return!0},t}();e.default=i},1656:(t,e,n)=>{"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"GADDI",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(e,"breadthFirstSearch",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"connectedComponent",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"depthFirstSearch",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"detectCycle",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"dijkstra",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"findAllPath",{enumerable:!0,get:function(){return h.findAllPath}}),Object.defineProperty(e,"findShortestPath",{enumerable:!0,get:function(){return h.findShortestPath}}),Object.defineProperty(e,"floydWarshall",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(e,"getAdjMatrix",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"getDegree",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"getInDegree",{enumerable:!0,get:function(){return s.getInDegree}}),Object.defineProperty(e,"getNeighbors",{enumerable:!0,get:function(){return y.getNeighbors}}),Object.defineProperty(e,"getOutDegree",{enumerable:!0,get:function(){return s.getOutDegree}}),Object.defineProperty(e,"labelPropagation",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(e,"louvain",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"minimumSpanningTree",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(e,"pageRank",{enumerable:!0,get:function(){return v.default}});var i=b(n(2238)),o=b(n(3764)),a=b(n(9527)),s=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var n=_(e);if(n&&n.has(t))return n.get(t);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if("default"!==a&&Object.prototype.hasOwnProperty.call(t,a)){var s=o?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(i,a,s):i[a]=t[a]}return i.default=t,n&&n.set(t,i),i}(n(2556)),u=b(n(4282)),l=b(n(5891)),c=b(n(8089)),h=n(1727),f=b(n(5033)),p=b(n(5170)),d=b(n(5179)),g=b(n(5553)),v=b(n(4926)),m=b(n(2812)),y=n(643);function _(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(_=function(t){return t?n:e})(t)}function b(t){return t&&t.__esModule?t:{default:t}}},6044:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MESSAGE=e.ALGORITHM=void 0,e.ALGORITHM={pageRank:"pageRank",breadthFirstSearch:"breadthFirstSearch",connectedComponent:"connectedComponent",depthFirstSearch:"depthFirstSearch",detectCycle:"detectCycle",detectDirectedCycle:"detectDirectedCycle",detectAllCycles:"detectAllCycles",detectAllDirectedCycle:"detectAllDirectedCycle",detectAllUndirectedCycle:"detectAllUndirectedCycle",dijkstra:"dijkstra",findAllPath:"findAllPath",findShortestPath:"findShortestPath",floydWarshall:"floydWarshall",getAdjMatrix:"getAdjMatrix",getDegree:"getDegree",getInDegree:"getInDegree",getNeighbors:"getNeighbors",getOutDegree:"getOutDegree",labelPropagation:"labelPropagation",louvain:"louvain",GADDI:"GADDI",minimumSpanningTree:"minimumSpanningTree",SUCCESS:"SUCCESS",FAILURE:"FAILURE"},e.MESSAGE={SUCCESS:"SUCCESS",FAILURE:"FAILURE"}},585:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r,i=n(6044),o=(r=n(2067))&&r.__esModule?r:{default:r};e.default=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return new Promise((function(n,r){var a=new o.default;a.postMessage({_algorithmType:t,data:e}),a.onmessage=function(t){var e=t.data,o=e.data,s=e._algorithmType;i.MESSAGE.SUCCESS===s?n(o):r(),a.terminate()}}))}}},485:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.pageRankAsync=e.minimumSpanningTreeAsync=e.louvainAsync=e.labelPropagationAsync=e.getOutDegreeAsync=e.getNeighborsAsync=e.getInDegreeAsync=e.getDegreeAsync=e.getAdjMatrixAsync=e.floydWarshallAsync=e.findShortestPathAsync=e.findAllPathAsync=e.dijkstraAsync=e.detectCycleAsync=e.detectAllUndirectedCycleAsync=e.detectAllDirectedCycleAsync=e.detectAllCyclesAsync=e.connectedComponentAsync=e.GADDIAsync=void 0;var r,i=(r=n(585))&&r.__esModule?r:{default:r},o=n(6044);e.getAdjMatrixAsync=function(t,e){return(0,i.default)(o.ALGORITHM.getAdjMatrix).apply(void 0,[t,e])},e.connectedComponentAsync=function(t,e){return(0,i.default)(o.ALGORITHM.connectedComponent).apply(void 0,[t,e])},e.getDegreeAsync=function(t){return(0,i.default)(o.ALGORITHM.getDegree)(t)},e.getInDegreeAsync=function(t,e){return(0,i.default)(o.ALGORITHM.getInDegree)(t,e)},e.getOutDegreeAsync=function(t,e){return(0,i.default)(o.ALGORITHM.getOutDegree)(t,e)},e.detectCycleAsync=function(t){return(0,i.default)(o.ALGORITHM.detectCycle)(t)},e.detectAllCyclesAsync=function(t){return(0,i.default)(o.ALGORITHM.detectAllCycles)(t)},e.detectAllDirectedCycleAsync=function(t){return(0,i.default)(o.ALGORITHM.detectAllDirectedCycle)(t)},e.detectAllUndirectedCycleAsync=function(t){return(0,i.default)(o.ALGORITHM.detectAllUndirectedCycle)(t)},e.dijkstraAsync=function(t,e,n,r){return(0,i.default)(o.ALGORITHM.dijkstra).apply(void 0,[t,e,n,r])},e.findAllPathAsync=function(t,e,n,r){return(0,i.default)(o.ALGORITHM.findAllPath).apply(void 0,[t,e,n,r])},e.findShortestPathAsync=function(t,e,n,r,a){return(0,i.default)(o.ALGORITHM.findShortestPath).apply(void 0,[t,e,n,r,a])},e.floydWarshallAsync=function(t,e){return(0,i.default)(o.ALGORITHM.floydWarshall).apply(void 0,[t,e])},e.labelPropagationAsync=function(t,e,n,r){return void 0===r&&(r=1e3),(0,i.default)(o.ALGORITHM.labelPropagation)(t,e,n,r)},e.louvainAsync=function(t,e,n,r){return(0,i.default)(o.ALGORITHM.louvain)(t,e,n,r)},e.minimumSpanningTreeAsync=function(t,e,n){return(0,i.default)(o.ALGORITHM.minimumSpanningTree).apply(void 0,[t,e,n])},e.pageRankAsync=function(t,e,n){return(0,i.default)(o.ALGORITHM.pageRank).apply(void 0,[t,e,n])},e.getNeighborsAsync=function(t,e,n){return(0,i.default)(o.ALGORITHM.getNeighbors).apply(void 0,[t,e,n])},e.GADDIAsync=function(t,e,n,r,a,s,u){return void 0===n&&(n=!1),void 0===s&&(s="cluster"),void 0===u&&(u="cluster"),(0,i.default)(o.ALGORITHM.GADDI).apply(void 0,[t,e,n,r,a,s,u])}},2067:(t,e,n)=>{"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var n=a(e);if(n&&n.has(t))return n.get(t);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var u=o?Object.getOwnPropertyDescriptor(t,s):null;u&&(u.get||u.set)?Object.defineProperty(i,s,u):i[s]=t[s]}return i.default=t,n&&n.set(t,i),i}(n(1656)),o=n(6044);function a(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(a=function(t){return t?n:e})(t)}var s="undefined"!=typeof self?self:{};s.onmessage=function(t){var e=t.data,n=e._algorithmType,r=e.data;if(n)if("function"!=typeof i[n])s.postMessage({_algorithmType:o.MESSAGE.FAILURE});else{var a=i[n].apply(i,r);s.postMessage({_algorithmType:o.MESSAGE.SUCCESS,data:a})}},e.default=null},499:()=>{},4851:()=>{},9518:()=>{},6199:()=>{},4156:()=>{},1468:()=>{},8871:()=>{},9871:()=>{},5612:()=>{},2777:()=>{},159:()=>{},1622:()=>{},9307:(t,e,n)=>{"use strict";n.r(e),n.d(e,{AbstractEvent:()=>cu,AbstractGraph:()=>Fs,AbstractLayout:()=>lu,Algorithm:()=>HM,Arrow:()=>nu,BaseGlobal:()=>vu,Bundling:()=>qM,Combo:()=>os,Edge:()=>Ka,EdgeFilterLens:()=>nP,Fisheye:()=>QM,G6Event:()=>hu,G6GraphEvent:()=>ba,Global:()=>ih,Graph:()=>NS,Grid:()=>XM,Hull:()=>Ns,ImageMinimap:()=>eP,Layout:()=>nS,Legend:()=>iP,Marker:()=>ru,Menu:()=>KM,Minimap:()=>YM,Node:()=>$a,Shape:()=>iu,SnapLine:()=>rP,TimeBar:()=>tP,ToolBar:()=>JM,Tooltip:()=>$M,TreeGraph:()=>ZS,TreeLayout:()=>vS,Util:()=>dS,default:()=>oP,registerBehavior:()=>gu,registerCombo:()=>du,registerEdge:()=>pu,registerLayout:()=>mS,registerNode:()=>fu,version:()=>aP});var r={};n.r(r),n.d(r,{add:()=>Q,adjoint:()=>N,clone:()=>M,copy:()=>P,create:()=>T,determinant:()=>B,equals:()=>nt,exactEquals:()=>et,frob:()=>K,fromMat2d:()=>W,fromMat4:()=>k,fromQuat:()=>H,fromRotation:()=>G,fromScaling:()=>V,fromTranslation:()=>U,fromValues:()=>I,identity:()=>R,invert:()=>D,mul:()=>rt,multiply:()=>z,multiplyScalar:()=>$,multiplyScalarAndAdd:()=>tt,normalFromMat4:()=>X,projection:()=>Y,rotate:()=>Z,scale:()=>j,set:()=>O,str:()=>q,sub:()=>it,subtract:()=>J,translate:()=>F,transpose:()=>L});var i={};n.r(i),n.d(i,{GADDI:()=>Ce,Stack:()=>Te,breadthFirstSearch:()=>_t,connectedComponent:()=>xt,cosineSimilarity:()=>Kt,default:()=>Me,depthFirstSearch:()=>Tt,detectAllCycles:()=>Pt,detectAllDirectedCycle:()=>Mt,detectAllUndirectedCycle:()=>kt,detectCycle:()=>It,detectDirectedCycle:()=>ke,dijkstra:()=>Ot,findAllPath:()=>Dt,findShortestPath:()=>Lt,floydWarshall:()=>Nt,getAdjMatrix:()=>lt,getDegree:()=>Et,getInDegree:()=>St,getNeighbors:()=>vt,getOutDegree:()=>Ct,iLouvain:()=>Xt,kCore:()=>Yt,kMeans:()=>qt,labelPropagation:()=>Bt,louvain:()=>Ht,minimumSpanningTree:()=>oe,nodesCosineSimilarity:()=>Qt,pageRank:()=>ae});var o={};n.r(o),n.d(o,{Line:()=>en,applyMatrix:()=>Fe,compare:()=>Re,distance:()=>Ue,floydWarshall:()=>Ve,fractionToLine:()=>an,getAdjMatrix:()=>We,getBBoxBoundLine:()=>nn,getCircleCenterByPoints:()=>je,getCircleIntersectByPoint:()=>Be,getDegree:()=>Ke,getEllipseIntersectByPoint:()=>ze,getLineIntersect:()=>De,getPointsCenter:()=>sn,getRectIntersectByPoint:()=>Ne,intersectBBox:()=>$e,invertMatrix:()=>Ze,isPointInPolygon:()=>Je,isPointsOverlap:()=>cn,isPolygonsIntersect:()=>tn,itemIntersectByLine:()=>on,lerp:()=>pn,move:()=>Xe,pointLineDistance:()=>fn,pointLineSquareDist:()=>ln,pointRectSquareDist:()=>hn,rotate:()=>qe,scale:()=>Ye,scaleMatrix:()=>Ge,squareDist:()=>un,translate:()=>He});var a={};n.r(a),n.d(a,{cloneBesidesImg:()=>Un,getBBox:()=>Mn,getComboBBox:()=>Zn,getLabelPosition:()=>In,getLetterWidth:()=>Nn,getLoopCfgs:()=>Pn,getTextSize:()=>Bn,plainCombosToTrees:()=>zn,reconstructTree:()=>Fn,shouldRefreshEdge:()=>jn,traverseTree:()=>Ln,traverseTreeUp:()=>Dn});var s={};n.r(s),n.d(s,{catmullRomToBezier:()=>Kn,fillPath:()=>mr,fillPathByDiff:()=>br,formatPath:()=>Er,intersection:()=>gr,parsePathArray:()=>ir,parsePathString:()=>qn,pathToAbsolute:()=>Jn,pathToCurve:()=>nr,rectPath:()=>cr});var u={};n.r(u),n.d(u,{easeBack:()=>Ki,easeBackIn:()=>Yi,easeBackInOut:()=>Ki,easeBackOut:()=>qi,easeBounce:()=>Wi,easeBounceIn:()=>Vi,easeBounceInOut:()=>Hi,easeBounceOut:()=>Wi,easeCircle:()=>Ui,easeCircleIn:()=>Zi,easeCircleInOut:()=>Ui,easeCircleOut:()=>ji,easeCubic:()=>Ti,easeCubicIn:()=>Ci,easeCubicInOut:()=>Ti,easeCubicOut:()=>Ai,easeElastic:()=>$i,easeElasticIn:()=>Ji,easeElasticInOut:()=>to,easeElasticOut:()=>$i,easeExp:()=>Fi,easeExpIn:()=>Bi,easeExpInOut:()=>Fi,easeExpOut:()=>zi,easeLinear:()=>xi,easePoly:()=>Pi,easePolyIn:()=>ki,easePolyInOut:()=>Pi,easePolyOut:()=>Mi,easeQuad:()=>Si,easeQuadIn:()=>wi,easeQuadInOut:()=>Si,easeQuadOut:()=>Ei,easeSin:()=>Di,easeSinIn:()=>Ri,easeSinInOut:()=>Di,easeSinOut:()=>Li});var l={};n.r(l),n.d(l,{calculationItemsBBox:()=>Aa,cloneEvent:()=>Ea,formatPadding:()=>wa,isNaN:()=>Ca,isViewportChanged:()=>Sa,processParallelEdges:()=>Ta,uniqueId:()=>xa});var c={};n.r(c),n.d(c,{getClosedSpline:()=>xs,getControlPoint:()=>ys,getSpline:()=>ms,paddedHull:()=>As,pathToPoints:()=>bs,pointsToPolygon:()=>_s,roundedHull:()=>Cs});var h={};n.r(h),n.d(h,{defaultSubjectColors:()=>ou});var f={};n.r(f),n.d(f,{Base:()=>tl,Circle:()=>el,Ellipse:()=>rl,Image:()=>al,Line:()=>ll,Marker:()=>fl,Path:()=>wl,Polygon:()=>Sl,Polyline:()=>Al,Rect:()=>kl,Text:()=>Pl});var p={};n.r(p),n.d(p,{Base:()=>Yl,Circle:()=>Kl,Dom:()=>Jl,Ellipse:()=>tc,Image:()=>nc,Line:()=>ic,Marker:()=>uc,Path:()=>cc,Polygon:()=>fc,Polyline:()=>dc,Rect:()=>vc,Text:()=>xc});var d={};n.r(d),n.d(d,{getColorSetsBySubjectColors:()=>eh,getColorsWithSubjectColor:()=>th,mixColor:()=>$c});var g={};n.r(g),n.d(g,{arrayToTextureData:()=>hS,attributesToTextureData:()=>cS,buildTextureData:()=>sS,buildTextureDataWithOneEdgeAttr:()=>uS,buildTextureDataWithTwoEdgeAttr:()=>lS,proccessToFunc:()=>aS,radialLayout:()=>fS});var v={};n.r(v),n.d(v,{gpuDetector:()=>pS});var m={};n.r(m),n.d(m,{assign:()=>DC,default:()=>eA,defaultI18n:()=>FC,format:()=>$C,parse:()=>tA,setGlobalDateI18n:()=>jC,setGlobalDateMasks:()=>JC});var y=n(655),_=n(9242);const b={getDefaultCfg:function(){return{}},getEvents:function(){return{}},updateCfg:function(t){return Object.assign(this,t),!0},shouldBegin:function(){return!0},shouldUpdate:function(){return!0},shouldEnd:function(){return!0},bind:function(t){var e=this,n=this.events;this.graph=t,"drag-canvas"!==this.type&&"brush-select"!==this.type&&"lasso-select"!==this.type||t.get("canvas").set("draggable",!0),(0,_.each)(n,(function(e,n){t.on(n,e)})),document.addEventListener("visibilitychange",(function(){e.keydown=!1}))},unbind:function(t){var e=this.events,n=t.get("canvas").get("draggable");"drag-canvas"!==this.type&&"brush-select"!==this.type&&"lasso-select"!==this.type||t.get("canvas").set("draggable",!1),(0,_.each)(e,(function(e,n){t.off(n,e)})),t.get("canvas").set("draggable",n)},get:function(t){return this[t]},set:function(t,e){return this[t]=e,this}};var x=function(){function t(){}return t.registerBehavior=function(e,n){if(!n)throw new Error("please specify handler for this behavior: ".concat(e));var r=(0,_.clone)(b);Object.assign(r,n);var i=function(t){var e=this;Object.assign(this,this.getDefaultCfg(),t);var n=this.getEvents();this.events=null;var r={};n&&((0,_.each)(n,(function(t,n){r[n]=(0,_.wrapBehavior)(e,t)})),this.events=r)};i.prototype=r,t.types[e]=i},t.hasBehavior=function(e){return!!t.types[e]},t.getBehavior=function(e){return t.types[e]},t.types={},t}();const w=x,E=w;var S=function(){function t(){this._events={}}return t.prototype.on=function(t,e,n){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,once:!!n}),this},t.prototype.once=function(t,e){return this.on(t,e,!0),this},t.prototype.emit=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this._events[t]||[],o=this._events["*"]||[],a=function(r){for(var i=r.length,o=0;o<i;o++)if(r[o]){var a=r[o],s=a.callback;a.once&&(r.splice(o,1),0===r.length&&delete e._events[t],i--,o--),s.apply(e,n)}};a(i),a(o)},t.prototype.off=function(t,e){if(t)if(e){for(var n=this._events[t]||[],r=n.length,i=0;i<r;i++)n[i].callback===e&&(n.splice(i,1),r--,i--);0===n.length&&delete this._events[t]}else delete this._events[t];else this._events={};return this},t.prototype.getEvents=function(){return this._events},t}();const C=S;var A=n(9685);function T(){var t=new A.WT(9);return A.WT!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function k(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function M(t){var e=new A.WT(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function P(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function I(t,e,n,r,i,o,a,s,u){var l=new A.WT(9);return l[0]=t,l[1]=e,l[2]=n,l[3]=r,l[4]=i,l[5]=o,l[6]=a,l[7]=s,l[8]=u,l}function O(t,e,n,r,i,o,a,s,u,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t}function R(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function L(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function D(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=c*a-s*l,f=-c*o+s*u,p=l*o-a*u,d=n*h+r*f+i*p;return d?(d=1/d,t[0]=h*d,t[1]=(-c*r+i*l)*d,t[2]=(s*r-i*a)*d,t[3]=f*d,t[4]=(c*n-i*u)*d,t[5]=(-s*n+i*o)*d,t[6]=p*d,t[7]=(-l*n+r*u)*d,t[8]=(a*n-r*o)*d,t):null}function N(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8];return t[0]=a*c-s*l,t[1]=i*l-r*c,t[2]=r*s-i*a,t[3]=s*u-o*c,t[4]=n*c-i*u,t[5]=i*o-n*s,t[6]=o*l-a*u,t[7]=r*u-n*l,t[8]=n*a-r*o,t}function B(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8];return e*(l*o-a*u)+n*(-l*i+a*s)+r*(u*i-o*s)}function z(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=n[0],p=n[1],d=n[2],g=n[3],v=n[4],m=n[5],y=n[6],_=n[7],b=n[8];return t[0]=f*r+p*a+d*l,t[1]=f*i+p*s+d*c,t[2]=f*o+p*u+d*h,t[3]=g*r+v*a+m*l,t[4]=g*i+v*s+m*c,t[5]=g*o+v*u+m*h,t[6]=y*r+_*a+b*l,t[7]=y*i+_*s+b*c,t[8]=y*o+_*u+b*h,t}function F(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=n[0],p=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=f*r+p*a+l,t[7]=f*i+p*s+c,t[8]=f*o+p*u+h,t}function Z(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=Math.sin(n),p=Math.cos(n);return t[0]=p*r+f*a,t[1]=p*i+f*s,t[2]=p*o+f*u,t[3]=p*a-f*r,t[4]=p*s-f*i,t[5]=p*u-f*o,t[6]=l,t[7]=c,t[8]=h,t}function j(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function U(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function G(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function V(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function W(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function H(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,h=r*s,f=i*a,p=i*s,d=i*u,g=o*a,v=o*s,m=o*u;return t[0]=1-h-d,t[3]=c-m,t[6]=f+v,t[1]=c+m,t[4]=1-l-d,t[7]=p-g,t[2]=f-v,t[5]=p+g,t[8]=1-l-h,t}function X(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],p=e[11],d=e[12],g=e[13],v=e[14],m=e[15],y=n*s-r*a,_=n*u-i*a,b=n*l-o*a,x=r*u-i*s,w=r*l-o*s,E=i*l-o*u,S=c*g-h*d,C=c*v-f*d,A=c*m-p*d,T=h*v-f*g,k=h*m-p*g,M=f*m-p*v,P=y*M-_*k+b*T+x*A-w*C+E*S;return P?(P=1/P,t[0]=(s*M-u*k+l*T)*P,t[1]=(u*A-a*M-l*C)*P,t[2]=(a*k-s*A+l*S)*P,t[3]=(i*k-r*M-o*T)*P,t[4]=(n*M-i*A+o*C)*P,t[5]=(r*A-n*k-o*S)*P,t[6]=(g*E-v*w+m*x)*P,t[7]=(v*b-d*E-m*_)*P,t[8]=(d*w-g*b+m*y)*P,t):null}function Y(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function q(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function K(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Q(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function J(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function $(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function tt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function et(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function nt(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=e[0],f=e[1],p=e[2],d=e[3],g=e[4],v=e[5],m=e[6],y=e[7],_=e[8];return Math.abs(n-h)<=A.Ib*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-f)<=A.Ib*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-p)<=A.Ib*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-d)<=A.Ib*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-g)<=A.Ib*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-v)<=A.Ib*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-m)<=A.Ib*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(l-y)<=A.Ib*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-_)<=A.Ib*Math.max(1,Math.abs(c),Math.abs(_))}var rt=z,it=J;function ot(t,e,n){var r=[0,0,0,0,0,0,0,0,0];return G(r,n),z(t,r,e)}function at(t,e,n){var r=[0,0,0,0,0,0,0,0,0];return V(r,n),z(t,r,e)}function st(t,e,n){return z(t,n,e)}function ut(t,e){for(var n=t?[].concat(t):[1,0,0,0,1,0,0,0,1],r=0,i=e.length;r<i;r++){var o=e[r];switch(o[0]){case"t":a=n,s=n,u=[o[1],o[2]],l=void 0,U(l=[0,0,0,0,0,0,0,0,0],u),z(a,l,s);break;case"s":at(n,n,[o[1],o[2]]);break;case"r":ot(n,n,o[1]);break;case"m":st(n,n,o[1])}}var a,s,u,l;return n}const lt=function(t,e){var n=t.nodes,r=t.edges,i=[],o={};if(!n)throw new Error("invalid nodes data!");return n&&n.forEach((function(t,e){o[t.id]=e,i.push([])})),r&&r.forEach((function(t){var n=t.source,r=t.target,a=o[n],s=o[r];!a&&0!==a||!s&&0!==s||(i[a][s]=1,e||(i[s][a]=1))})),i};var ct=function(t,e){return t===e},ht=function(){function t(t,e){void 0===e&&(e=null),this.value=t,this.next=e}return t.prototype.toString=function(t){return t?t(this.value):"".concat(this.value)},t}(),ft=function(){function t(t){void 0===t&&(t=ct),this.head=null,this.tail=null,this.compare=t}return t.prototype.prepend=function(t){var e=new ht(t,this.head);return this.head=e,this.tail||(this.tail=e),this},t.prototype.append=function(t){var e=new ht(t);return this.head?(this.tail.next=e,this.tail=e,this):(this.head=e,this.tail=e,this)},t.prototype.delete=function(t){if(!this.head)return null;for(var e=null;this.head&&this.compare(this.head.value,t);)e=this.head,this.head=this.head.next;var n=this.head;if(null!==n)for(;n.next;)this.compare(n.next.value,t)?(e=n.next,n.next=n.next.next):n=n.next;return this.compare(this.tail.value,t)&&(this.tail=n),e},t.prototype.find=function(t){var e=t.value,n=void 0===e?void 0:e,r=t.callback,i=void 0===r?void 0:r;if(!this.head)return null;for(var o=this.head;o;){if(i&&i(o.value))return o;if(void 0!==n&&this.compare(o.value,n))return o;o=o.next}return null},t.prototype.deleteTail=function(){var t=this.tail;if(this.head===this.tail)return this.head=null,this.tail=null,t;for(var e=this.head;e.next;)e.next.next?e=e.next:e.next=null;return this.tail=e,t},t.prototype.deleteHead=function(){if(!this.head)return null;var t=this.head;return this.head.next?this.head=this.head.next:(this.head=null,this.tail=null),t},t.prototype.fromArray=function(t){var e=this;return t.forEach((function(t){return e.append(t)})),this},t.prototype.toArray=function(){for(var t=[],e=this.head;e;)t.push(e),e=e.next;return t},t.prototype.reverse=function(){for(var t=this.head,e=null,n=null;t;)n=t.next,t.next=e,e=t,t=n;this.tail=this.head,this.head=e},t.prototype.toString=function(t){return void 0===t&&(t=void 0),this.toArray().map((function(e){return e.toString(t)})).toString()},t}();const pt=ft;var dt=function(){function t(){this.linkedList=new pt}return t.prototype.isEmpty=function(){return!this.linkedList.head},t.prototype.peek=function(){return this.linkedList.head?this.linkedList.head.value:null},t.prototype.enqueue=function(t){this.linkedList.append(t)},t.prototype.dequeue=function(){var t=this.linkedList.deleteHead();return t?t.value:null},t.prototype.toString=function(t){return this.linkedList.toString(t)},t}();const gt=dt;var vt=function(t,e,n){void 0===e&&(e=[]);var r=e.filter((function(e){return e.source===t||e.target===t}));return"target"===n?r.filter((function(e){return e.source===t})).map((function(t){return t.target})):"source"===n?r.filter((function(e){return e.target===t})).map((function(t){return t.source})):r.map((function(e){return e.source===t?e.target:e.source}))},mt=function(t,e){return e.filter((function(e){return e.source===t||e.target===t}))},yt=function(t){void 0===t&&(t=0);var e="".concat(Math.random()).split(".")[1].substr(0,5),n="".concat(Math.random()).split(".")[1].substr(0,5);return"".concat(t,"-").concat(e).concat(n)};const _t=function(t,e,n,r){void 0===r&&(r=!0);var i=function(t){void 0===t&&(t={});var e,n=t,r=function(){},i=(e={},function(t){var n=t.next;return!e[n]&&(e[n]=!0,!0)});return n.allowTraversal=t.allowTraversal||i,n.enter=t.enter||r,n.leave=t.leave||r,n}(n),o=new gt,a=t.edges,s=void 0===a?[]:a;o.enqueue(e);for(var u="",l=function(){var t=o.dequeue();i.enter({current:t,previous:u}),vt(t,s,r?"target":void 0).forEach((function(e){i.allowTraversal({previous:u,current:t,next:e})&&o.enqueue(e)})),i.leave({current:t,previous:u}),u=t};!o.isEmpty();)l()};var bt=function(t){for(var e=t.nodes,n=void 0===e?[]:e,r=t.edges,i=void 0===r?[]:r,o=[],a={},s={},u={},l=[],c=0,h=function t(e){s[e.id]=c,u[e.id]=c,c+=1,o.push(e),a[e.id]=!0;for(var r=vt(e.id,i,"target").filter((function(t){return n.map((function(t){return t.id})).indexOf(t)>-1})),h=function(i){var o=r[i];if(s[o]||0===s[o])a[o]&&(u[e.id]=Math.min(u[e.id],s[o]));else{var l=n.filter((function(t){return t.id===o}));l.length>0&&t(l[0]),u[e.id]=Math.min(u[e.id],u[o])}},f=0;f<r.length;f++)h(f);if(u[e.id]===s[e.id]){for(var p=[];o.length>0;){var d=o.pop();if(a[d.id]=!1,p.push(d),d===e)break}p.length>0&&l.push(p)}},f=0,p=n;f<p.length;f++){var d=p[f];s[d.id]||0===s[d.id]||h(d)}return l};function xt(t,e){return e?bt(t):function(t){for(var e=t.nodes,n=void 0===e?[]:e,r=t.edges,i=void 0===r?[]:r,o=[],a={},s=[],u=function t(e){s.push(e),a[e.id]=!0;for(var r=vt(e.id,i),o=function(e){var i=r[e];if(!a[i]){var o=n.filter((function(t){return t.id===i}));o.length>0&&t(o[0])}},u=0;u<r.length;++u)o(u)},l=0;l<n.length;l++){var c=n[l];if(!a[c.id]){u(c);for(var h=[];s.length>0;)h.push(s.pop());o.push(h)}}return o}(t)}var wt=function(t){var e={},n=t.nodes,r=void 0===n?[]:n,i=t.edges,o=void 0===i?[]:i;return r.forEach((function(t){e[t.id]={degree:0,inDegree:0,outDegree:0}})),o.forEach((function(t){e[t.source].degree++,e[t.source].outDegree++,e[t.target].degree++,e[t.target].inDegree++})),e};const Et=wt;var St=function(t,e){return wt(t)[e]?wt(t)[e].inDegree:0},Ct=function(t,e){return wt(t)[e]?wt(t)[e].outDegree:0};function At(t,e,n,r){r.enter({current:e,previous:n});var i=t.edges;vt(e,void 0===i?[]:i,"target").forEach((function(i){r.allowTraversal({previous:n,current:e,next:i})&&At(t,i,e,r)})),r.leave({current:e,previous:n})}function Tt(t,e,n){At(t,e,"",function(t){void 0===t&&(t={});var e,n=t,r=function(){},i=(e={},function(t){var n=t.next;return!e[n]&&(e[n]=!0,!0)});return n.allowTraversal=t.allowTraversal||i,n.enter=t.enter||r,n.leave=t.leave||r,n}(n))}var kt=function(t,e,n){var r,i;void 0===n&&(n=!0);for(var o=[],a=0,s=xt(t,!1);a<s.length;a++){var u=s[a];if(u.length)for(var l=u[0],c=l.id,h=[l],f=((r={})[c]=l,r),p=((i={})[c]=new Set,i);h.length>0;)for(var d=h.pop(),g=d.id,v=vt(g,t.edges),m=function(r){var i,a=v[r],s=t.nodes.find((function(t){return t.id===a}));if(a===g)o.push(((i={})[a]=d,i));else if(a in p){if(!p[g].has(s)){for(var u=!0,l=[s,d],c=f[g];p[a].size&&!p[a].has(c)&&(l.push(c),c!==f[c.id]);)c=f[c.id];if(l.push(c),e&&n?(u=!1,l.findIndex((function(t){return e.indexOf(t.id)>-1}))>-1&&(u=!0)):e&&!n&&l.findIndex((function(t){return e.indexOf(t.id)>-1}))>-1&&(u=!1),u){for(var m={},y=1;y<l.length;y+=1)m[l[y-1].id]=l[y];l.length&&(m[l[l.length-1].id]=l[0]),o.push(m)}p[a].add(d)}}else f[a]=d,h.push(s),p[a]=new Set([d])},y=0;y<v.length;y+=1)m(y)}return o},Mt=function(t,e,n){void 0===n&&(n=!0);for(var r=[],i=new Set,o=[],a=[],s={},u={},l=function t(u,l,c){var h=!1;if(e&&!1===n&&e.indexOf(u.id)>-1)return h;r.push(u),i.add(u);for(var f=c[u.id],p=0;p<f.length;p+=1)if((v=s[f[p]])===l){for(var d={},g=1;g<r.length;g+=1)d[r[g-1].id]=r[g];r.length&&(d[r[r.length-1].id]=r[0]),a.push(d),h=!0}else i.has(v)||t(v,l,c)&&(h=!0);if(h)!function(t){for(var e=[t];e.length>0;){var n=e.pop();i.has(n)&&(i.delete(n),o[n.id].forEach((function(t){e.push(t)})),o[n.id].clear())}}(u);else for(p=0;p<f.length;p+=1){var v=s[f[p]];o[v.id].has(u)||o[v.id].add(u)}return r.pop(),h},c=t.nodes,h=void 0===c?[]:c,f=0;f<h.length;f+=1){var p=h[f],d=p.id;u[d]=f,s[f]=p}if(e&&n){var g=function(t){var n=e[t];u[h[t].id]=u[n],u[n]=0,s[0]=h.find((function(t){return t.id===n})),s[u[h[t].id]]=h[t]};for(f=0;f<e.length;f++)g(f)}for(var v=function(r){for(var i,o,s=1/0,l=0;l<r.length;l+=1)for(var c=r[l],h=0;h<c.length;h++){var f=u[c[h].id];f<s&&(s=f,o=l)}var p=r[o],d=[];for(l=0;l<p.length;l+=1){var g=p[l];d[g.id]=[];for(var v=0,m=vt(g.id,t.edges,"target").filter((function(t){return p.map((function(t){return t.id})).indexOf(t)>-1}));v<m.length;v++){var y=m[v];y!==g.id||!1===n&&e.indexOf(g.id)>-1?d[g.id].push(u[y]):a.push(((i={})[g.id]=g,i))}}return{component:p,adjList:d,minIdx:s}},m=0;m<h.length;){var y=h.filter((function(t){return u[t.id]>=m})),_=bt({nodes:y,edges:t.edges}).filter((function(t){return t.length>1}));if(0===_.length)break;var b=v(_),x=b.minIdx,w=b.adjList,E=b.component;if(!(E.length>1))break;E.forEach((function(t){o[t.id]=new Set}));var S=s[x];if(e&&n&&-1===e.indexOf(S.id))return a;l(S,S,w),m=x+1}return a},Pt=function(t,e,n,r){return void 0===r&&(r=!0),e?Mt(t,n,r):kt(t,n,r)};const It=function(t){var e=null,n=t.nodes,r={},i={},o={},a={};(void 0===n?[]:n).forEach((function(t){i[t.id]=t}));for(var s={enter:function(t){var n=t.current,a=t.previous;if(o[n]){e={};for(var s=n,u=a;u!==n;)e[s]=u,s=u,u=r[u];e[s]=u}else o[n]=n,delete i[n],r[n]=a},leave:function(t){var e=t.current;a[e]=e,delete o[e]},allowTraversal:function(t){var n=t.next;return!e&&!a[n]}};Object.keys(i).length;)Tt(t,Object.keys(i)[0],s);return e},Ot=function(t,e,n,r){var i=t.nodes,o=void 0===i?[]:i,a=t.edges,s=void 0===a?[]:a,u=[],l={},c={},h={};o.forEach((function(t,n){var r=t.id;u.push(r),c[r]=1/0,r===e&&(c[r]=0)}));for(var f=o.length,p=function(t){var e=function(t,e,n){for(var r,i=1/0,o=0;o<e.length;o++){var a=e[o].id;!n[a]&&t[a]<=i&&(i=t[a],r=e[o])}return r}(c,o,l),i=e.id;if(l[i]=!0,c[i]===1/0)return"continue";var a=[];a=n?function(t,e){return e.filter((function(e){return e.source===t}))}(i,s):mt(i,s),a.forEach((function(t){var n=t.target,o=t.source,a=n===i?o:n,s=r&&t[r]?t[r]:1;c[a]>c[e.id]+s?(c[a]=c[e.id]+s,h[a]=[e.id]):c[a]===c[e.id]+s&&h[a].push(e.id)}))},d=0;d<f;d++)p();h[e]=[e];var g={};for(var v in c)c[v]!==1/0&&Rt(e,v,h,g);var m={};for(var v in g)m[v]=g[v][0];return{length:c,path:m,allPath:g}};function Rt(t,e,n,r){if(t===e)return[t];if(r[e])return r[e];for(var i=[],o=0,a=n[e];o<a.length;o++){var s=Rt(t,a[o],n,r);if(!s)return;for(var u=0,l=s;u<l.length;u++){var c=l[u];(0,_.isArray)(c)?i.push((0,y.__spreadArray)((0,y.__spreadArray)([],c,!0),[e],!1)):i.push([c,e])}}return r[e]=i,r[e]}var Lt=function(t,e,n,r,i){var o=Ot(t,e,r,i),a=o.length,s=o.path,u=o.allPath;return{length:a[n],path:s[n],allPath:u[n]}},Dt=function(t,e,n,r){var i;if(e===n)return[[e]];var o=t.edges,a=void 0===o?[]:o,s=[e],u=((i={})[e]=!0,i),l=[],c=[],h=r?vt(e,a,"target"):vt(e,a);for(l.push(h);s.length>0&&l.length>0;){var f=l[l.length-1];if(f.length){var p=f.shift();if(p&&(s.push(p),u[p]=!0,h=r?vt(p,a,"target"):vt(p,a),l.push(h.filter((function(t){return!u[t]})))),s[s.length-1]===n){var d=s.map((function(t){return t}));c.push(d),g=s.pop(),u[g]=!1,l.pop()}}else{var g=s.pop();u[g]=!1,l.pop()}}return c};const Nt=function(t,e){for(var n=lt(t,e),r=[],i=n.length,o=0;o<i;o+=1){r[o]=[];for(var a=0;a<i;a+=1)o===a?r[o][a]=0:0!==n[o][a]&&n[o][a]?r[o][a]=n[o][a]:r[o][a]=1/0}for(var s=0;s<i;s+=1)for(o=0;o<i;o+=1)for(a=0;a<i;a+=1)r[o][a]>r[o][s]+r[s][a]&&(r[o][a]=r[o][s]+r[s][a]);return r},Bt=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n="weight"),void 0===r&&(r=1e3);var i=t.nodes,o=void 0===i?[]:i,a=t.edges,s=void 0===a?[]:a,u={},l={};o.forEach((function(t,e){var n=yt();t.clusterId=n,u[n]={id:n,nodes:[t]},l[t.id]={node:t,idx:e}}));var c=lt(t,e),h=[],f={};c.forEach((function(t,e){var n=0,r=o[e].id;f[r]={},t.forEach((function(t,e){if(t){n+=t;var i=o[e].id;f[r][i]=t}})),h.push(n)}));for(var p=0,d=function(){var t=!1;if(o.forEach((function(e){var n={};Object.keys(f[e.id]).forEach((function(t){var r=f[e.id][t],i=l[t].node.clusterId;n[i]||(n[i]=0),n[i]+=r}));var r=-1/0,i=[];if(Object.keys(n).forEach((function(t){r<n[t]?(r=n[t],i=[t]):r===n[t]&&i.push(t)})),1!==i.length||i[0]!==e.clusterId){var o=i.indexOf(e.clusterId);if(o>=0&&i.splice(o,1),i&&i.length){t=!0;var a=u[e.clusterId],s=a.nodes.indexOf(e);a.nodes.splice(s,1);var c=Math.floor(Math.random()*i.length),h=u[i[c]];h.nodes.push(e),e.clusterId=h.id}}})),!t)return"break";p++};p<r&&"break"!==d(););Object.keys(u).forEach((function(t){var e=u[t];e.nodes&&e.nodes.length||delete u[t]}));var g=[],v={};s.forEach((function(t){var e=t.source,r=t.target,i=t[n]||1,o=l[e].node.clusterId,a=l[r].node.clusterId,s="".concat(o,"---").concat(a);if(v[s])v[s].weight+=i,v[s].count++;else{var u={source:o,target:a,weight:i,count:1};v[s]=u,g.push(u)}}));var m=[];return Object.keys(u).forEach((function(t){m.push(u[t])})),{clusters:m,clusterEdges:g}};var zt=function(){function t(t){this.arr=t}return t.prototype.getArr=function(){return this.arr||[]},t.prototype.add=function(e){var n,r=e.arr;if(!(null===(n=this.arr)||void 0===n?void 0:n.length))return new t(r);if(!(null==r?void 0:r.length))return new t(this.arr);if(this.arr.length===r.length){var i=[];for(var o in this.arr)i[o]=this.arr[o]+r[o];return new t(i)}},t.prototype.subtract=function(e){var n,r=e.arr;if(!(null===(n=this.arr)||void 0===n?void 0:n.length))return new t(r);if(!(null==r?void 0:r.length))return new t(this.arr);if(this.arr.length===r.length){var i=[];for(var o in this.arr)i[o]=this.arr[o]-r[o];return new t(i)}},t.prototype.avg=function(e){var n=[];if(0!==e)for(var r in this.arr)n[r]=this.arr[r]/e;return new t(n)},t.prototype.negate=function(){var e=[];for(var n in this.arr)e[n]=-this.arr[n];return new t(e)},t.prototype.squareEuclideanDistance=function(t){var e,n=t.arr;if(!(null===(e=this.arr)||void 0===e?void 0:e.length)||!(null==n?void 0:n.length))return 0;if(this.arr.length===n.length){var r=0;for(var i in this.arr)r+=Math.pow(this.arr[i]-t.arr[i],2);return r}},t.prototype.euclideanDistance=function(t){var e,n=t.arr;if(!(null===(e=this.arr)||void 0===e?void 0:e.length)||!(null==n?void 0:n.length))return 0;if(this.arr.length===n.length){var r=0;for(var i in this.arr)r+=Math.pow(this.arr[i]-t.arr[i],2);return Math.sqrt(r)}console.error("The two vectors are unequal in length.")},t.prototype.normalize=function(){var e=[],n=(0,_.clone)(this.arr);n.sort((function(t,e){return t-e}));var r=n[n.length-1],i=n[0];for(var o in this.arr)e[o]=(this.arr[o]-i)/(r-i);return new t(e)},t.prototype.norm2=function(){var t;if(!(null===(t=this.arr)||void 0===t?void 0:t.length))return 0;var e=0;for(var n in this.arr)e+=Math.pow(this.arr[n],2);return Math.sqrt(e)},t.prototype.dot=function(t){var e,n=t.arr;if(!(null===(e=this.arr)||void 0===e?void 0:e.length)||!(null==n?void 0:n.length))return 0;if(this.arr.length===n.length){var r=0;for(var i in this.arr)r+=this.arr[i]*t.arr[i];return r}console.error("The two vectors are unequal in length.")},t.prototype.equal=function(t){var e,n=t.arr;if((null===(e=this.arr)||void 0===e?void 0:e.length)!==(null==n?void 0:n.length))return!1;for(var r in this.arr)if(this.arr[r]!==n[r])return!1;return!0},t}();const Ft=zt;var Zt,jt=function(t,e){void 0===e&&(e="properties");var n=[];return t.forEach((function(t){t.properties&&n.push(t[e])})),n};!function(t){t.EuclideanDistance="euclideanDistance"}(Zt||(Zt={}));var Ut=function(t,e,n){var r=function(t,e,n){var r=[];(null==e?void 0:e.length)?r=e:(t.forEach((function(t){r=r.concat(Object.keys(t))})),r=(0,_.uniq)(r));var i={};return r.forEach((function(e){var r=[];t.forEach((function(t){void 0!==t[e]&&""!==t[e]&&r.push(t[e])})),r.length&&!(null==n?void 0:n.includes(e))&&(i[e]=(0,_.uniq)(r))})),i}(t,e,n),i=[];return t.forEach((function(t,e){var n=[];Object.keys(r).forEach((function(e){for(var i=t[e],o=r[e],a=o.findIndex((function(t){return i===t})),s=[],u=0;u<o.length;u++)u===a?s.push(1):s.push(0);n=n.concat(s)})),i[e]=n})),i},Gt=function(t,e,n,r){void 0===n&&(n=Zt.EuclideanDistance);var i=0;return n===Zt.EuclideanDistance&&(i=new Ft(t).euclideanDistance(new Ft(e))),i},Vt=function(t,e,n,r){for(var i=e.length,o=2*r,a=0,s=0;s<i;s++)for(var u=t[s].clusterId,l=0;l<i;l++)u===t[l].clusterId&&(a+=(e[s][l]||0)-(n[s]||0)*(n[l]||0)/o);return a*(1/o)},Wt=function(t,e){void 0===t&&(t=[]);for(var n=t.length,r=new Ft([]),i=0;i<n;i++)r=r.add(new Ft(e[i]));var o=r.avg(n);o.normalize();var a=0;for(i=0;i<n;i++)a+=(u=new Ft(e[i])).squareEuclideanDistance(o);var s=[];for(t.forEach((function(){s.push([])})),i=0;i<n;i++){var u=new Ft(e[i]);t[i].clusterInertial=0;for(var l=0;l<n;l++)if(i!==l){var c=new Ft(e[l]);s[i][l]=u.squareEuclideanDistance(c),t[i].clusterInertial+=s[i][l]}else s[i][l]=0}var h=0,f=2*n*a;for(i=0;i<n;i++){var p=t[i].clusterId;for(l=0;l<n;l++){var d=t[l].clusterId;i!==l&&p===d&&(h+=t[i].clusterInertial*t[l].clusterInertial/Math.pow(f,2)-s[i][l]/f)}}return Number(h.toFixed(4))};const Ht=function(t,e,n,r,i,o){void 0===e&&(e=!1),void 0===n&&(n="weight"),void 0===r&&(r=1e-4),void 0===i&&(i=!1),void 0===o&&(o=1);var a=t.nodes,s=void 0===a?[]:a,u=t.edges,l=void 0===u?[]:u,c=[];if(i){s.forEach((function(t,e){t.properties=t.properties||{},t.originIndex=e}));var h=[];s.every((function(t){return t.hasOwnProperty("nodeType")}))&&(h=Array.from(new Set(s.map((function(t){return t.nodeType})))),s.forEach((function(t){t.properties.nodeType=h.findIndex((function(e){return e===t.nodeType}))})));var f=jt(s);c=Ut(f)}var p=1,d={},g={};s.forEach((function(t,e){var n=String(p++);t.clusterId=n,d[n]={id:n,nodes:[t]},g[t.id]={node:t,idx:e}}));var v=lt(t,e),m=[],y={},b=0;v.forEach((function(t,e){var n=0,r=s[e].id;y[r]={},t.forEach((function(t,e){if(t){n+=t;var i=s[e].id;y[r][i]=t,b+=t}})),m.push(n)})),b/=2;for(var x=1/0,w=1/0,E=0,S=[],C={};;){x=i&&s.every((function(t){return t.hasOwnProperty("properties")}))?Vt(s,v,m,b)+Wt(s,c)*o:Vt(s,v,m,b),0===E&&(w=x,S=s,C=d);var A=x>0&&x>w&&x-w<r;if(x>w&&(S=s.map((function(t){return{node:t,clusterId:t.clusterId}})),C=(0,_.clone)(d),w=x),A||E>100)break;E++,Object.keys(d).forEach((function(t){var e=0;l.forEach((function(r){var i=r.source,o=r.target,a=g[i].node.clusterId,s=g[o].node.clusterId;(a===t&&s!==t||s===t&&a!==t)&&(e+=r[n]||1)})),d[t].sumTot=e})),s.forEach((function(t,e){var r,a=d[t.clusterId],s=0,u=m[e]/(2*b),h=0,f=a.nodes;f.forEach((function(t){var n=g[t.id].idx;h+=v[e][n]||0}));var p=h-a.sumTot*u,_=f.filter((function(e){return e.id!==t.id})),x=[];_.forEach((function(t,e){x[e]=c[t.originIndex]}));var w=Wt(_,c)*o,E=y[t.id];if(Object.keys(E).forEach((function(n){var a=g[n].node.clusterId;if(a!==t.clusterId){var l=d[a],h=l.nodes;if(h&&h.length){var f=0;h.forEach((function(t){var n=g[t.id].idx;f+=v[e][n]||0}));var m=f-l.sumTot*u,y=h.concat([t]),_=[];y.forEach((function(t,e){_[e]=c[t.originIndex]}));var b=Wt(y,c)*o,x=m-p;i&&(x=m+b-(p+w)),x>s&&(s=x,r=l)}}})),s>0){r.nodes.push(t);var S=t.clusterId;t.clusterId=r.id;var C=a.nodes.indexOf(t);a.nodes.splice(C,1);var A=0,T=0;l.forEach((function(t){var e=t.source,i=t.target,o=g[e].node.clusterId,a=g[i].node.clusterId;(o===r.id&&a!==r.id||a===r.id&&o!==r.id)&&(A+=t[n]||1),(o===S&&a!==S||a===S&&o!==S)&&(T+=t[n]||1)})),r.sumTot=A,a.sumTot=T}}))}var T={},k=0;Object.keys(C).forEach((function(t){var e=C[t];if(e.nodes&&e.nodes.length){var n=String(k+1);n!==t&&(e.id=n,e.nodes=e.nodes.map((function(t){return{id:t.id,clusterId:n}})),C[n]=e,T[t]=n,delete C[t],k++)}else delete C[t]})),S.forEach((function(t){var e=t.node,n=t.clusterId;e.clusterId=n,e.clusterId&&T[e.clusterId]&&(e.clusterId=T[e.clusterId])}));var M=[],P={};l.forEach((function(t){var e=t.source,r=t.target,i=t[n]||1,o=g[e].node.clusterId,a=g[r].node.clusterId,s="".concat(o,"---").concat(a);if(P[s])P[s].weight+=i,P[s].count++;else{var u={source:o,target:a,weight:i,count:1};P[s]=u,M.push(u)}}));var I=[];return Object.keys(C).forEach((function(t){I.push(C[t])})),{clusters:I,clusterEdges:M}},Xt=function(t,e,n,r,i){return void 0===e&&(e=!1),void 0===n&&(n="weight"),void 0===r&&(r=1e-4),void 0===i&&(i=1),Ht(t,e,n,r,!0,i)},Yt=function(t,e){var n;void 0===e&&(e=1);for(var r=(0,_.clone)(t),i=r.nodes,o=void 0===i?[]:i,a=r.edges,s=void 0===a?[]:a,u=function(){var t=Et({nodes:o,edges:s}),r=Object.keys(t);r.sort((function(e,n){var r,i;return(null===(r=t[e])||void 0===r?void 0:r.degree)-(null===(i=t[n])||void 0===i?void 0:i.degree)}));var i=r[0];if(!o.length||(null===(n=t[i])||void 0===n?void 0:n.degree)>=e)return"break";var a=o.findIndex((function(t){return t.id===i}));o.splice(a,1),s=s.filter((function(t){return!(t.source===i||t.target===i)}))};"break"!==u(););return{nodes:o,edges:s}},qt=function(t,e,n,r,i,o){void 0===e&&(e=3),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i="properties"),void 0===o&&(o=Zt.EuclideanDistance);for(var a=t.nodes,s=t.edges,u=jt(a,i),l=Ut(u,n,r),c=0;c<a.length;c++)a[c].originIndex=c;var h=[],f=[],p=[];for(c=0;c<e;c++)if(0===c){var d=Math.floor(Math.random()*a.length);h[c]=l[d],f.push(d),p[c]=[a[d]],a[d].clusterId=String(c)}else{for(var g=-1/0,v=0,m=0;m<a.length;m++)if(!f.includes(m)){for(var y=0,_=0;_<h.length;_++)y+=S=Gt(l[a[m].originIndex],h[_],o);var b=y/h.length;b>g&&(g=b,v=m)}h[c]=l[v],f.push(v),p[c]=[a[v]],a[v].clusterId=String(c)}for(var x=0;;){for(c=0;c<a.length;c++){var w=0,E=1/0;if(0!==x||!f.includes(c)){for(_=0;_<h.length;_++){var S;(S=Gt(l[c],h[_],o))<E&&(E=S,w=_)}if(a[c].clusterId!==String(w)){for(var C=0;C<p[w].length;C++)p[w][C].id===a[c].id&&p[w].splice(C,1);p[w].push(a[c]),a[c].clusterId=String(w)}}}var A=!1;for(c=0;c<p.length;c++){var T=p[c],k=new Ft([]);for(_=0;_<T.length;_++)k=k.add(new Ft(l[T[_].originIndex]));var M=k.avg(T.length);M.equal(new Ft(h[c]))||(A=!0,h[c]=M.getArr())}if(x++,A||x>=1e3)break}var P=[],I={};return s.forEach((function(t){var e,n,r=t.source,i=t.target,o=null===(e=a.find((function(t){return t.id===r})))||void 0===e?void 0:e.clusterId,s=null===(n=a.find((function(t){return t.id===i})))||void 0===n?void 0:n.clusterId,u="".concat(o,"---").concat(s);if(I[u])I[u].count++;else{var l={source:o,target:s,count:1};I[u]=l,P.push(l)}})),{clusters:p,clusterEdges:P}},Kt=function(t,e){var n=new Ft(e),r=n.norm2(),i=new Ft(t),o=i.norm2(),a=n.dot(i),s=r*o;return s?a/s:0},Qt=function(t,e,n,r,i){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i="properties");var o=(0,_.clone)(t.filter((function(t){return t.id!==e.id}))),a=t.findIndex((function(t){return t.id===e.id})),s=jt(t,i),u=Ut(s,n,r),l=u[a],c=[];return o.forEach((function(t,n){if(t.id!==e.id){var r=u[n],i=Kt(r,l);c.push(i),t.cosineSimilarity=i}})),o.sort((function(t,e){return e.cosineSimilarity-t.cosineSimilarity})),{allCosineSimilarity:c,similarNodes:o}};var Jt=function(){function t(t){this.count=t.length,this.parent={};for(var e=0,n=t;e<n.length;e++){var r=n[e];this.parent[r]=r}}return t.prototype.find=function(t){for(;this.parent[t]!==t;)t=this.parent[t];return t},t.prototype.union=function(t,e){var n=this.find(t),r=this.find(e);n!==r&&(n<r?(this.parent[e]!==e&&this.union(this.parent[e],t),this.parent[e]=this.parent[t]):(this.parent[t]!==t&&this.union(this.parent[t],e),this.parent[t]=this.parent[e]))},t.prototype.connected=function(t,e){return this.find(t)===this.find(e)},t}();const $t=Jt;var te=function(t,e){return t-e},ee=function(){function t(t){void 0===t&&(t=te),this.compareFn=t,this.list=[]}return t.prototype.getLeft=function(t){return 2*t+1},t.prototype.getRight=function(t){return 2*t+2},t.prototype.getParent=function(t){return 0===t?null:Math.floor((t-1)/2)},t.prototype.isEmpty=function(){return this.list.length<=0},t.prototype.top=function(){return this.isEmpty()?void 0:this.list[0]},t.prototype.delMin=function(){var t=this.top(),e=this.list.pop();return this.list.length>0&&(this.list[0]=e,this.moveDown(0)),t},t.prototype.insert=function(t){if(null!==t){this.list.push(t);var e=this.list.length-1;return this.moveUp(e),!0}return!1},t.prototype.moveUp=function(t){for(var e=this.getParent(t);t&&t>0&&this.compareFn(this.list[e],this.list[t])>0;){var n=this.list[e];this.list[e]=this.list[t],this.list[t]=n,t=e,e=this.getParent(t)}},t.prototype.moveDown=function(t){var e,n=t,r=this.getLeft(t),i=this.getRight(t),o=this.list.length;null!==r&&r<o&&this.compareFn(this.list[n],this.list[r])>0?n=r:null!==i&&i<o&&this.compareFn(this.list[n],this.list[i])>0&&(n=i),t!==n&&(e=[this.list[n],this.list[t]],this.list[t]=e[0],this.list[n]=e[1],this.moveDown(n))},t}();const ne=ee;var re=function(t,e){var n=[],r=t.nodes,i=void 0===r?[]:r,o=t.edges,a=void 0===o?[]:o;if(0===i.length)return n;var s=i[0],u=new Set;u.add(s);var l=new ne((function(t,n){return e?t.weight-n.weight:0}));for(mt(s.id,a).forEach((function(t){l.insert(t)}));!l.isEmpty();){var c=l.delMin(),h=c.source,f=c.target;u.has(h)&&u.has(f)||(n.push(c),u.has(h)||(u.add(h),mt(h,a).forEach((function(t){l.insert(t)}))),u.has(f)||(u.add(f),mt(f,a).forEach((function(t){l.insert(t)}))))}return n},ie=function(t,e){var n=[],r=t.nodes,i=void 0===r?[]:r,o=t.edges,a=void 0===o?[]:o;if(0===i.length)return n;var s=a.map((function(t){return t}));e&&s.sort((function(t,e){return t.weight-e.weight}));for(var u=new $t(i.map((function(t){return t.id})));s.length>0;){var l=s.shift(),c=l.source,h=l.target;u.connected(c,h)||(n.push(l),u.union(c,h))}return n};const oe=function(t,e,n){return n?{prim:re,kruskal:ie}[n](t,e):ie(t,e)},ae=function(t,e,n){"number"!=typeof e&&(e=1e-6),"number"!=typeof n&&(n=.85);for(var r,i=1,o=0,a=1e3,s=t.nodes,u=void 0===s?[]:s,l=t.edges,c=void 0===l?[]:l,h=u.length,f={},p={},d=0;d<h;++d)f[v=(x=u[d]).id]=1/h,p[v]=1/h;for(var g=Et(t);a>0&&i>e;){for(o=0,d=0;d<h;++d){var v=(x=u[d]).id;if(r=0,0===g[x.id].inDegree)f[v]=0;else{for(var m=vt(v,c,"source"),y=0;y<m.length;++y){var _=m[y],b=g[_].outDegree;b>0&&(r+=p[_]/b)}f[v]=n*r,o+=f[v]}}for(o=(1-o)/h,i=0,d=0;d<h;++d){var x;r=f[v=(x=u[d]).id]+o,i+=Math.abs(r-p[v]),p[v]=r}a-=1}return p};var se="-1",ue=function(t,e,n,r){void 0===t&&(t=-1),void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===r&&(r="-1"),this.id=t,this.from=e,this.to=n,this.label=r},le=function(){function t(t,e){void 0===t&&(t=-1),void 0===e&&(e=se),this.id=t,this.label=e,this.edges=[],this.edgeMap={}}return t.prototype.addEdge=function(t){this.edges.push(t),this.edgeMap[t.id]=t},t}(),ce=function(){function t(t,e,n){void 0===t&&(t=-1),void 0===e&&(e=!0),void 0===n&&(n=!1),this.id=t,this.edgeIdAutoIncrease=e,this.edges=[],this.nodes=[],this.nodeMap={},this.edgeMap={},this.nodeLabelMap={},this.edgeLabelMap={},this.counter=0,this.directed=n}return t.prototype.getNodeNum=function(){return this.nodes.length},t.prototype.addNode=function(t,e){if(!this.nodeMap[t]){var n=new le(t,e);this.nodes.push(n),this.nodeMap[t]=n,this.nodeLabelMap[e]||(this.nodeLabelMap[e]=[]),this.nodeLabelMap[e].push(t)}},t.prototype.addEdge=function(t,e,n,r){if((this.edgeIdAutoIncrease||void 0===t)&&(t=this.counter++),!(this.nodeMap[e]&&this.nodeMap[n]&&this.nodeMap[n].edgeMap[t])){var i=new ue(t,e,n,r);if(this.edges.push(i),this.edgeMap[t]=i,this.nodeMap[e].addEdge(i),this.edgeLabelMap[r]||(this.edgeLabelMap[r]=[]),this.edgeLabelMap[r].push(i),!this.directed){var o=new ue(t,n,e,r);this.nodeMap[n].addEdge(o),this.edgeLabelMap[r].push(o)}}},t}(),he=function(){function t(t,e,n,r,i){this.fromNode=t,this.toNode=e,this.nodeEdgeNodeLabel={nodeLabel1:n||se,edgeLabel:r||"-1",nodeLabel2:i||se}}return t.prototype.equalTo=function(t){return this.fromNode===t.formNode&&this.toNode===t.toNode&&this.nodeEdgeNodeLabel===t.nodeEdgeNodeLabel},t.prototype.notEqualTo=function(t){return!this.equalTo(t)},t}(),fe=function(){function t(){this.rmpath=[],this.dfsEdgeList=[]}return t.prototype.equalTo=function(t){var e=this.dfsEdgeList.length;if(e!==t.length)return!1;for(var n=0;n<e;n++)if(this.dfsEdgeList[n]!==t[n])return!1;return!0},t.prototype.notEqualTo=function(t){return!this.equalTo(t)},t.prototype.pushBack=function(t,e,n,r,i){return this.dfsEdgeList.push(new he(t,e,n,r,i)),this.dfsEdgeList},t.prototype.toGraph=function(t,e){void 0===t&&(t=-1),void 0===e&&(e=!1);var n=new ce(t,!0,e);return this.dfsEdgeList.forEach((function(t){var e=t.fromNode,r=t.toNode,i=t.nodeEdgeNodeLabel,o=i.nodeLabel1,a=i.edgeLabel,s=i.nodeLabel2;o!==se&&n.addNode(e,o),s!==se&&n.addNode(r,s),o!==se&&s!==o&&n.addEdge(void 0,e,r,a)})),n},t.prototype.buildRmpath=function(){this.rmpath=[];for(var t=void 0,e=this.dfsEdgeList.length-1;e>=0;e--){var n=this.dfsEdgeList[e],r=n.fromNode,i=n.toNode;r<i&&(void 0===t||i===t)&&(this.rmpath.push(e),t=r)}return this.rmpath},t.prototype.getNodeNum=function(){var t={};return this.dfsEdgeList.forEach((function(e){t[e.fromNode]||(t[e.fromNode]=!0),t[e.toNode]||(t[e.toNode]=!0)})),Object.keys(t).length},t}(),pe=function(){function t(t){if(this.his={},this.nodesUsed={},this.edgesUsed={},this.edges=[],t){for(;t;){var e=t.edge;this.edges.push(e),this.nodesUsed[e.from]=1,this.nodesUsed[e.to]=1,this.edgesUsed[e.id]=1,t=t.preNode}this.edges=this.edges.reverse()}}return t.prototype.hasNode=function(t){return 1===this.nodesUsed[t.id]},t.prototype.hasEdge=function(t){return 1===this.edgesUsed[t.id]},t}(),de=function(){function t(t){var e=t.graphs,n=t.minSupport,r=void 0===n?2:n,i=t.minNodeNum,o=void 0===i?1:i,a=t.maxNodeNum,s=void 0===a?4:a,u=t.top,l=void 0===u?10:u,c=t.directed,h=void 0!==c&&c,f=t.verbose,p=void 0!==f&&f;this.graphs=e,this.dfsCode=new fe,this.support=0,this.frequentSize1Subgraphs=[],this.frequentSubgraphs=[],this.minSupport=r,this.top=l,this.directed=h,this.counter=0,this.maxNodeNum=s,this.minNodeNum=o,this.verbose=p,this.maxNodeNum<this.minNodeNum&&(this.maxNodeNum=this.minNodeNum),this.reportDF=[]}return t.prototype.findForwardRootEdges=function(t,e){var n=this,r=[],i=t.nodeMap;return e.edges.forEach((function(t){(n.directed||e.label<=i[t.to].label)&&r.push(t)})),r},t.prototype.findBackwardEdge=function(t,e,n,r){if(!this.directed&&e===n)return null;for(var i=t.nodeMap,o=i[n.to].edges,a=o.length,s=0;s<a;s++){var u=o[s];if(!r.hasEdge(u)&&u.to===e.from)if(this.directed){if(i[e.from].label<i[n.to].label||i[e.from].label===i[n.to].label&&e.label<=u.label)return u}else if(e.label<u.label||e.label===u.label&&i[e.to].label<=i[n.to].label)return u}return null},t.prototype.findForwardPureEdges=function(t,e,n,r){for(var i=[],o=e.to,a=t.nodeMap[o].edges,s=a.length,u=0;u<s;u++){var l=a[u],c=t.nodeMap[l.to];n<=c.label&&!r.hasNode(c)&&i.push(l)}return i},t.prototype.findForwardRmpathEdges=function(t,e,n,r){for(var i=[],o=t.nodeMap,a=o[e.to].label,s=o[e.from].edges,u=s.length,l=0;l<u;l++){var c=s[l],h=o[c.to].label;e.to===c.to||n>h||r.hasNode(o[c.to])||(e.label<c.label||e.label===c.label&&a<=h)&&i.push(c)}return i},t.prototype.getSupport=function(t){var e={};return t.forEach((function(t){e[t.graphId]||(e[t.graphId]=!0)})),Object.keys(e).length},t.prototype.findMinLabel=function(t){var e=void 0;return Object.keys(t).forEach((function(n){var r=t[n],i=r.nodeLabel1,o=r.edgeLabel,a=r.nodeLabel2;e?(i<e.nodeLabel1||i===e.nodeLabel1&&o<e.edgeLabel||i===e.nodeLabel1&&o===e.edgeLabel&&a<e.nodeLabel2)&&(e={nodeLabel1:i,edgeLabel:o,nodeLabel2:a}):e={nodeLabel1:i,edgeLabel:o,nodeLabel2:a}})),e},t.prototype.isMin=function(){var t=this,e=this.dfsCode;if(this.verbose&&console.log("isMin checking",e),1===e.dfsEdgeList.length)return!0;var n=this.directed,r=e.toGraph(-1,n),i=r.nodeMap,o=new fe,a={};r.nodes.forEach((function(e){t.findForwardRootEdges(r,e).forEach((function(t){var n=i[t.to],o="".concat(e.label,"-").concat(t.label,"-").concat(n.label);a[o]||(a[o]={projected:[],nodeLabel1:e.label,edgeLabel:t.label,nodeLabel2:n.label});var s={graphId:r.id,edge:t,preNode:null};a[o].projected.push(s)}))}));var s=this.findMinLabel(a);if(s){o.dfsEdgeList.push(new he(0,1,s.nodeLabel1,s.edgeLabel,s.nodeLabel2));var u="".concat(s.nodeLabel1,"-").concat(s.edgeLabel,"-").concat(s.nodeLabel2);return function a(s){for(var u=o.buildRmpath(),l=o.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,c=o.dfsEdgeList[u[0]].toNode,h={},f=!1,p=0,d=n?-1:0,g=function(e){if(f)return"break";s.forEach((function(n){var i=new pe(n),a=t.findBackwardEdge(r,i.edges[u[e]],i.edges[u[0]],i);a&&(h[a.label]||(h[a.label]={projected:[],edgeLabel:a.label}),h[a.label].projected.push({graphId:r.id,edge:h,preNode:n}),p=o.dfsEdgeList[u[e]].fromNode,f=!0)}))},v=u.length-1;v>d&&"break"!==g(v);v--);if(f){var m=t.findMinLabel(h);o.dfsEdgeList.push(new he(c,p,se,m.edgeLabel,se));var y=o.dfsEdgeList.length-1;return t.dfsCode.dfsEdgeList[y]===o.dfsEdgeList[y]&&a(h[m.edgeLabel].projected)}var _={};f=!1;var b=0;s.forEach((function(e){var n=new pe(e),o=t.findForwardPureEdges(r,n.edges[u[0]],l,n);o.length>0&&(f=!0,b=c,o.forEach((function(t){var n="".concat(t.label,"-").concat(i[t.to].label);_[n]||(_[n]={projected:[],edgeLabel:t.label,nodeLabel2:i[t.to].label}),_[n].projected.push({graphId:r.id,edge:t,preNode:e})})))}));var x=u.length,w=function(e){if(f)return"break";var n=u[e];s.forEach((function(e){var a=new pe(e),s=t.findForwardRmpathEdges(r,a.edges[n],l,a);s.length>0&&(f=!0,b=o.dfsEdgeList[n].fromNode,s.forEach((function(t){var n="".concat(t.label,"-").concat(i[t.to].label);_[n]||(_[n]={projected:[],edgeLabel:t.label,nodeLabel2:i[t.to].label}),_[n].projected.push({graphId:r.id,edge:t,preNode:e})})))}))};for(v=0;v<x&&"break"!==w(v);v++);if(!f)return!0;var E=t.findMinLabel(_);o.dfsEdgeList.push(new he(b,c+1,se,E.edgeLabel,E.nodeLabel2));var S=o.dfsEdgeList.length-1;return e.dfsEdgeList[S]===o.dfsEdgeList[S]&&a(_["".concat(E.edgeLabel,"-").concat(E.nodeLabel2)].projected)}(a[u].projected)}},t.prototype.report=function(){if(!(this.dfsCode.getNodeNum()<this.minNodeNum)){this.counter++;var t=this.dfsCode.toGraph(this.counter,this.directed);this.frequentSubgraphs.push((0,_.clone)(t))}},t.prototype.subGraphMining=function(t){var e=this;if(!(this.getSupport(t)<this.minSupport)&&this.isMin()){this.report();var n=this.dfsCode.getNodeNum(),r=this.dfsCode.buildRmpath(),i=this.dfsCode.dfsEdgeList[r[0]].toNode,o=this.dfsCode.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,a={},s={};t.forEach((function(t){for(var u=e.graphs[t.graphId],l=u.nodeMap,c=new pe(t),h=r.length-1;h>=0;h--){var f=e.findBackwardEdge(u,c.edges[r[h]],c.edges[r[0]],c);if(f){var p="".concat(e.dfsCode.dfsEdgeList[r[h]].fromNode,"-").concat(f.label);s[p]||(s[p]={projected:[],toNodeId:e.dfsCode.dfsEdgeList[r[h]].fromNode,edgeLabel:f.label}),s[p].projected.push({graphId:t.graphId,edge:f,preNode:t})}}if(!(n>=e.maxNodeNum)){e.findForwardPureEdges(u,c.edges[r[0]],o,c).forEach((function(e){var n="".concat(i,"-").concat(e.label,"-").concat(l[e.to].label);a[n]||(a[n]={projected:[],fromNodeId:i,edgeLabel:e.label,nodeLabel2:l[e.to].label}),a[n].projected.push({graphId:t.graphId,edge:e,preNode:t})}));var d=function(n){e.findForwardRmpathEdges(u,c.edges[r[n]],o,c).forEach((function(i){var o="".concat(e.dfsCode.dfsEdgeList[r[n]].fromNode,"-").concat(i.label,"-").concat(l[i.to].label);a[o]||(a[o]={projected:[],fromNodeId:e.dfsCode.dfsEdgeList[r[n]].fromNode,edgeLabel:i.label,nodeLabel2:l[i.to].label}),a[o].projected.push({graphId:t.graphId,edge:i,preNode:t})}))};for(h=0;h<r.length;h++)d(h)}})),Object.keys(s).forEach((function(t){var n=s[t],r=n.toNodeId,o=n.edgeLabel;e.dfsCode.dfsEdgeList.push(new he(i,r,"-1",o,"-1")),e.subGraphMining(s[t].projected),e.dfsCode.dfsEdgeList.pop()})),Object.keys(a).forEach((function(t){var n=a[t],r=n.fromNodeId,o=n.edgeLabel,s=n.nodeLabel2;e.dfsCode.dfsEdgeList.push(new he(r,i+1,se,o,s)),e.subGraphMining(a[t].projected),e.dfsCode.dfsEdgeList.pop()}))}},t.prototype.generate1EdgeFrequentSubGraphs=function(){var t=this.graphs,e=this.directed,n=this.minSupport,r=this.frequentSize1Subgraphs,i={},o={},a={},s={};return Object.keys(t).forEach((function(n){var r=t[n],u=r.nodeMap;r.nodes.forEach((function(t,r){var l=t.label,c="".concat(n,"-").concat(l);if(!a[c]){var h=i[l]||0;h++,i[l]=h}a[c]={graphKey:n,label:l},t.edges.forEach((function(t){var r=l,i=u[t.to].label;if(!e&&r>i){var a=i;i=r,r=a}var c=t.label,h="".concat(n,"-").concat(r,"-").concat(c,"-").concat(i),f="".concat(r,"-").concat(c,"-").concat(i);if(!o[f]){var p=o[f]||0;p++,o[f]=p}s[h]={graphId:n,nodeLabel1:r,edgeLabel:c,nodeLabel2:i}}))}))})),Object.keys(i).forEach((function(t){if(!(i[t]<n)){var e={nodes:[],edges:[]};e.nodes.push({id:"0",label:t}),r.push(e)}})),r},t.prototype.run=function(){var t=this;if(this.frequentSize1Subgraphs=this.generate1EdgeFrequentSubGraphs(),!(this.maxNodeNum<2)){var e=this.graphs,n=(this.directed,{});Object.keys(e).forEach((function(r){var i=e[r],o=i.nodeMap;i.nodes.forEach((function(e){t.findForwardRootEdges(i,e).forEach((function(t){var i=o[t.to],a="".concat(e.label,"-").concat(t.label,"-").concat(i.label);n[a]||(n[a]={projected:[],nodeLabel1:e.label,edgeLabel:t.label,nodeLabel2:i.label});var s={graphId:r,edge:t,preNode:null};n[a].projected.push(s)}))}))})),Object.keys(n).forEach((function(e){var r=n[e],i=r.projected,o=r.nodeLabel1,a=r.edgeLabel,s=r.nodeLabel2;t.dfsCode.dfsEdgeList.push(new he(0,1,o,a,s)),t.subGraphMining(i),t.dfsCode.dfsEdgeList.pop()}))}},t}(),ge="cluster";var ve=function(t,e,n,r){void 0===n&&(n="cluster"),void 0===r&&(r=2);var i=[],o=t.nodes;return e.forEach((function(t,e){i.push(me(o,t,e,n,r))})),i},me=function(t,e,n,r,i){var o=[n],a=[],s={};return e.forEach((function(e,u){if(e<=i&&n!==u){o.push(u),a.push(t[u]);var l=t[u][r];s[l]?(s[l].count++,s[l].dists.push(e)):s[l]={count:1,dists:[e]}}})),Object.keys(s).forEach((function(t){s[t].dists=s[t].dists.sort((function(t,e){return t-e}))})),{nodeIdx:n,nodeId:t[n].id,nodeIdxs:o,neighbors:a,neighborNum:o.length-1,nodeLabelCountMap:s}},ye=function(t,e,n,r){var i=n.nodes;return r||(r={}),Object.keys(t).forEach((function(o){var a,s;if(!r||!r[o]){r[o]={nodes:[],edges:[]};var u=t[o],l=null===(a=e[u.start])||void 0===a?void 0:a.nodeIdxs,c=null===(s=e[u.end])||void 0===s?void 0:s.nodeIdxs;if(l&&c){var h=new Set(c),f=l.filter((function(t){return h.has(t)}));if(f&&f.length){for(var p={},d=f.length,g=0;g<d;g++){var v=i[f[g]];r[o].nodes.push(v),p[v.id]=!0}n.edges.forEach((function(t){p[t.source]&&p[t.target]&&r[o].edges.push(t)}))}}}})),r},_e=function(t,e,n,r){var i,o,a={};t.nodes.forEach((function(t){a[t.id]=t}));var s=0;return!(null===(i=null==e?void 0:e.edges)||void 0===i?void 0:i.length)||(null===(o=null==e?void 0:e.nodes)||void 0===o?void 0:o.length)<2?0:(t.edges.forEach((function(t){var i=a[t.source][n],o=a[t.target][n],u=null==e?void 0:e.nodes[0][n],l=null==e?void 0:e.nodes[1][n],c=null==e?void 0:e.edges[0][r];t[r]===c&&(i===u&&o===l||i===l&&o===u)&&s++})),s)},be=function(t,e){var n={},r={};return t.forEach((function(t,i){n[t.id]={idx:i,node:t,degree:0,inDegree:0,outDegree:0};var o=t[e];r[o]||(r[o]=[]),r[o].push(t)})),{nodeMap:n,nodeLabelMap:r}},xe=function(t,e,n){var r={},i={};return t.forEach((function(t,o){r["".concat(yt)]={idx:o,edge:t};var a=t[e];i[a]||(i[a]=[]),i[a].push(t);var s=n[t.source];s&&(s.degree++,s.outDegree++);var u=n[t.target];u&&(u.degree++,u.inDegree++)})),{edgeMap:r,edgeLabelMap:i}},we=function(t,e,n){var r=e.length,i={};return e.forEach((function(e,o){for(var a=n?0:o+1,s=t[o].id,u=a;u<r;u++)if(o!==u){var l=t[u].id,c=e[u];i["".concat(s,"-").concat(l)]=c,n||(i["".concat(l,"-").concat(s)]=c)}})),i},Ee=function(t,e,n,r,i,o,a,s,u,l,c){var h,f="".concat(e.id,"-").concat(n.id);if(l&&l[f])return l[f];var p=c?c[f]:void 0;if(!p){var d=((h={})[f]={start:r[e.id].idx,end:r[n.id].idx,distance:i},h);p=(c=ye(d,o,t,c))[f]}return _e(p,a,s,u)},Se=function(t,e,n,r){var i,o,a,s=null===(i=t[e])||void 0===i?void 0:i.degree,u=null===(o=t[e])||void 0===o?void 0:o.inDegree,l=null===(a=t[e])||void 0===a?void 0:a.outDegree;return void 0===t[e]&&(s=1/0,u=1/0,l=1/0,r[e].forEach((function(t){var e=n[t.id].degree;s>e&&(s=e);var r=n[t.id].inDegree;u>r&&(u=r);var i=n[t.id].outDegree;l>i&&(l=i)})),t[e]={degree:s,inDegree:u,outDegree:l}),{minPatternNodeLabelDegree:s,minPatternNodeLabelInDegree:u,minPatternNodeLabelOutDegree:l}};const Ce=function(t,e,n,r,i,o,a){var s;if(void 0===n&&(n=!1),void 0===o&&(o="cluster"),void 0===a&&(a="cluster"),t&&t.nodes){var u=t.nodes.length;if(u){var l=Nt(t,n),c=Nt(e,n),h=we(t.nodes,l,n),f=we(e.nodes,c,n),p=be(t.nodes,o),d=p.nodeMap,g=p.nodeLabelMap,v=be(e.nodes,o),m=v.nodeMap,_=v.nodeLabelMap;xe(t.edges,a,d);var b=xe(e.edges,a,m).edgeLabelMap,x=[];null==c||c.forEach((function(t){x=x.concat(t)})),i||(i=Math.max.apply(Math,(0,y.__spreadArray)((0,y.__spreadArray)([],x,!1),[2],!1))),r||(r=i);var w=ve(t,l,o,r),E=ve(e,c,o,r),S=function(t,e,n,r,i){var o=Math.ceil(n/e),a={},s=0;return r.forEach((function(t,r){for(var u=0,l=0,c=t.nodeIdxs,h=t.neighborNum-1;u<o;){for(var f=c[1+Math.floor(Math.random()*h)],p=0;(a["".concat(r,"-").concat(f)]||a["".concat(f,"-").concat(r)])&&(f=Math.floor(Math.random()*e),!(++p>2*e)););if(p<2*e&&(a["".concat(r,"-").concat(f)]={start:r,end:f,distance:i[r][f]},u++,++s>=n))return a;if(++l>2*e)break}u<o&&(o=(o+(o-u))/(e-r-1))})),a}(0,u,Math.min(100,u*(u-1)/2),w,l),C=ye(S,w,t),A=function(t){var e=t.graphs,n=t.directed,r=void 0!==n&&n,i=t.nodeLabelProp,o=void 0===i?ge:i,a=t.edgeLabelProp,s=void 0===a?ge:a,u=function(t,e,n,r){var i={};return Object.keys(t).forEach((function(o,a){var s=t[o],u=new ce(a,!0,e),l={};s.nodes.forEach((function(t,e){u.addNode(e,t[n]),l[t.id]=e})),s.edges.forEach((function(t,e){var n=l[t.source],i=l[t.target];u.addEdge(-1,n,i,t[r])})),u&&u.getNodeNum()&&(i[u.id]=u)})),i}(e,r,o,s),l=t.minSupport,c=t.maxNodeNum,h=t.minNodeNum,f=t.verbose,p=t.top,d=new de({graphs:u,minSupport:l,maxNodeNum:c,minNodeNum:h,top:p,verbose:f,directed:r});d.run();var g=function(t,e,n){var r=[];return t.forEach((function(t){var i={nodes:[],edges:[]};t.nodes.forEach((function(t){var n;i.nodes.push(((n={id:"".concat(t.id)})[e]=t.label,n))})),t.edges.forEach((function(t){var e;i.edges.push(((e={source:"".concat(t.from),target:"".concat(t.to)})[n]=t.label,e))})),r.push(i)})),r}(d.frequentSubgraphs,o,s);return g}({graphs:C,nodeLabelProp:o,edgeLabelProp:a,minSupport:1,minNodeNum:1,maxNodeNum:4,directed:n}).slice(0,10),T=A.length,k=[];A.forEach((function(t,e){k[e]={},Object.keys(C).forEach((function(n){var r=C[n],i=_e(r,t,o,a);k[e][n]=i}))}));var M=function(t,e,n){for(var r=1/0,i=0,o=function(e){var n=t[e],o=Object.keys(n).sort((function(t,e){return n[t]-n[e]})),a=[];o.forEach((function(t,e){a[e%10]||(a[e%10]={graphs:[],totalCount:0,aveCount:0}),a[e%10].graphs.push(t),a[e%10].totalCount+=n[t]}));var s=0,u=[];a.forEach((function(t){var e=t.totalCount/t.graphs.length;t.aveCount=e,u.push(e);var r=0,i=t.length;t.graphs.forEach((function(e,i){var o=n[e];t.graphs.forEach((function(t,e){i!==e&&(r+=Math.abs(o-n[t]))}))})),s+=r/=i*(i-1)/2})),s/=a.length;var l=0;u.forEach((function(t,e){u.forEach((function(n,r){e!==r&&(l+=Math.abs(t-n))})),l/=u.length*(u.length-1)/2}));var c=l-s;r<c&&(r=c,i=e)},a=0;a<e;a++)o(a);return{structure:n[i],structureCountMap:t[i]}}(k,T,A),P=M.structure,I=M.structureCountMap,O=e.nodes[0],R=[],L=null===(s=e.nodes[0])||void 0===s?void 0:s[o],D=-1/0;e.nodes.forEach((function(t){var e=t[o],n=g[e];(null==n?void 0:n.length)>D&&(D=n.length,R=n,L=e,O=t)}));var N={},B={},z={},F={},Z={},j={};Object.keys(_).forEach((function(r,i){Z[r]=[],n&&(j[r]=[]);var s=-1/0,u=_[r],l={};u.forEach((function(t){var e=f["".concat(O.id,"-").concat(t.id)];if(e&&Z[r].push(e),s<e&&(s=e),l["".concat(O.id,"-").concat(t.id)]={start:0,end:m[t.id].idx,distance:e},n){var i=f["".concat(t.id,"-").concat(O.id)];i&&j[r].push(i)}})),Z[r]=Z[r].sort((function(t,e){return t-e})),n&&(j[r]=j[r].sort((function(t,e){return t-e}))),B=ye(l,E,e,B);var c=[];if(Object.keys(l).forEach((function(t){if(z[t])c.push(z[t]);else{var e=B[t];z[t]=_e(e,P,o,a),c.push(z[t])}})),c=c.sort((function(t,e){return e-t})),F["".concat(O.id,"-").concat(r)]=c,r!==L)for(var p=function(e){var n=R[e],i=w[d[n.id].idx],s=i.nodeLabelCountMap[r],u=_[r].length;if(!s||s.count<u)return R.splice(e,1),"continue";for(var l=!1,f=0;f<u;f++)if(s.dists[f]>Z[r][f]){l=!0;break}if(l)return R.splice(e,1),"continue";var p={};i.neighbors.forEach((function(t){var e=h["".concat(n.id,"-").concat(t.id)];p["".concat(n.id,"-").concat(t.id)]={start:d[n.id].idx,end:d[t.id].idx,distance:e}})),C=ye(p,w,t,C);var g=[];Object.keys(p).forEach((function(t){if(I[t])g.push(I[t]);else{var e=C[t];I[t]=_e(e,P,o,a),g.push(I[t])}})),g=g.sort((function(t,e){return e-t}));var v=!1;for(f=0;f<u;f++)if(g[f]<c[f]){v=!0;break}return v?(R.splice(e,1),"continue"):void 0},g=((null==R?void 0:R.length)||0)-1;g>=0;g--)p(g)}));var U=[];null==R||R.forEach((function(r){for(var s=d[r.id].idx,u=me(t.nodes,l[s],s,o,i).neighbors,c=!1,f=u.length-1;f>=0;f--){if(u.length+1<e.nodes.length)return void(c=!0);var p=u[f],g=p[o];if(_[g]&&_[g].length)if(Z[g]&&Z[g].length){var v="".concat(r.id,"-").concat(p.id),y=h[v],b=Z[g].length-1;if(y>Z[g][b])u.splice(f,1);else{if(n){var x="".concat(p.id,"-").concat(r.id),E=h[x];if(b=j[g].length-1,E>j[g][b]){u.splice(f,1);continue}}var S=I[v]?I[v]:Ee(t,r,p,d,y,w,P,o,a,I,C),A="".concat(O.id,"-").concat(g);if(S<F[A][F[A].length-1])u.splice(f,1);else{var T=Se(N,g,m,_),k=T.minPatternNodeLabelDegree;T.minPatternNodeLabelInDegree,T.minPatternNodeLabelOutDegree,d[p.id].degree<k&&u.splice(f,1)}}}else u.splice(f,1);else u.splice(f,1)}c||U.push({nodes:[r].concat(u)})}));var G=Ot(e,O.id,!1).length,V={};n?(Object.keys(G).forEach((function(t){var e=m[t].node[o];V[e]?V[e].push(G[t]):V[e]=[G[t]]})),Object.keys(V).forEach((function(t){V[t].sort((function(t,e){return t-e}))}))):V=Z;for(var W=function(r){var i=U[r],s=i.nodes[0],u={},l={};i.nodes.forEach((function(t,e){l[t.id]={idx:e,node:t,degree:0,inDegree:0,outDegree:0};var n=t[o];u[n]?u[n]++:u[n]=1}));var c=[],h={};t.edges.forEach((function(t){l[t.source]&&l[t.target]&&(c.push(t),h[t[a]]?h[t[a]]++:h[t[a]]=1,l[t.source].degree++,l[t.target].degree++,l[t.source].outDegree++,l[t.target].inDegree++)}));for(var f=Object.keys(b).length,p=!1,g=0;g<f;g++){var v=Object.keys(b)[g];if(!h[v]||h[v]<b[v].length){p=!0;break}}if(p)return U.splice(r,1),"continue";var y=c.length;if(y<e.edges.length)return U.splice(r,1),"break";var x=!1,w=function(t){var e=c[t],r=e[a],i=b[r];if(!i||!i.length)return h[r]--,i&&h[r]<i.length?(x=!0,"break"):(c.splice(t,1),l[e.source].degree--,l[e.target].degree--,l[e.source].outDegree--,l[e.target].inDegree--,"continue");var s=l[e.source].node[o],u=l[e.target].node[o],f=!1;return i.forEach((function(t){var e=m[t.source].node,r=m[t.target].node;e[o]===s&&r[o]===u&&(f=!0),n||e[o]!==u||r[o]!==s||(f=!0)})),f?void 0:(h[r]--,i&&h[r]<i.length?(x=!0,"break"):(c.splice(t,1),l[e.source].degree--,l[e.target].degree--,l[e.source].outDegree--,l[e.target].inDegree--,"continue"))};for(g=y-1;g>=0&&"break"!==w(g);g--);if(x)return U.splice(r,1),"continue";i.edges=c;var E=Ot(i,i.nodes[0].id,!1).length;if(Object.keys(E).reverse().forEach((function(t){if(t!==i.nodes[0].id&&!x){if(E[t]===1/0){var e=l[t].node[o];if(u[e]--,u[e]<_[e].length)return void(x=!0);var n=i.nodes.indexOf(l[t].node);return i.nodes.splice(n,1),void(l[t]=void 0)}var r=d[t].node[o];if(!V[r]||!V[r].length||E[t]>V[r][V[r].length-1]){if(e=l[t].node[o],u[e]--,u[e]<_[e].length)return void(x=!0);n=i.nodes.indexOf(l[t].node),i.nodes.splice(n,1),l[t]=void 0}}})),x)return U.splice(r,1),"continue";for(var S=!0,C=0;S&&!x;){if(S=!1,n?l[s.id].degree<m[O.id].degree||l[s.id].inDegree<m[O.id].inDegree||l[s.id].outDegree<m[O.id].outDegree:l[s.id].degree<m[O.id].degree){x=!0;break}if(u[s[o]]<_[s[o]].length){x=!0;break}for(var A=i.nodes.length-1;A>=0;A--){var T=i.nodes[A],k=l[T.id].degree,M=l[T.id].inDegree,P=l[T.id].outDegree,I=T[o],R=Se(N,I,m,_),L=R.minPatternNodeLabelDegree,D=R.minPatternNodeLabelInDegree,B=R.minPatternNodeLabelOutDegree;if(n?k<L||M<D||P<B:k<L){if(u[T[o]]--,u[T[o]]<_[T[o]].length){x=!0;break}i.nodes.splice(A,1),l[T.id]=void 0,S=!0}}if(x||!S&&0!==C)break;for(var z=(y=c.length)-1;z>=0;z--){var F=c[z];if(!l[F.source]||!l[F.target]){c.splice(z,1);var Z=F[a];if(h[Z]--,l[F.source]&&(l[F.source].degree--,l[F.source].outDegree--),l[F.target]&&(l[F.target].degree--,l[F.target].inDegree--),b[Z]&&h[Z]<b[Z].length){x=!0;break}S=!0}}C++}return x||x||i.nodes.length<e.nodes.length||c.length<e.edges.length?(U.splice(r,1),"continue"):void 0},H=U.length-1;H>=0&&"break"!==W(H);H--);var X=U.length,Y=function(t){var e=U[t],n={};e.edges.forEach((function(t){var e="".concat(t.source,"-").concat(t.target,"-").concat(t.label);n[e]?n[e]++:n[e]=1}));for(var r=function(t){var e=U[t],r={};e.edges.forEach((function(t){var e="".concat(t.source,"-").concat(t.target,"-").concat(t.label);r[e]?r[e]++:r[e]=1}));var i=!0;Object.keys(r).length!==Object.keys(n).length?i=!1:Object.keys(n).forEach((function(t){r[t]!==n[t]&&(i=!1)})),i&&U.splice(t,1)},i=X-1;i>t;i--)r(i);X=U.length};for(H=0;H<=X-1;H++)Y(H);return U}}};var Ae=function(){function t(t){void 0===t&&(t=10),this.linkedList=new pt,this.maxStep=t}return Object.defineProperty(t.prototype,"length",{get:function(){return this.linkedList.toArray().length},enumerable:!1,configurable:!0}),t.prototype.isEmpty=function(){return!this.linkedList.head},t.prototype.isMaxStack=function(){return this.toArray().length>=this.maxStep},t.prototype.peek=function(){return this.isEmpty()?null:this.linkedList.head.value},t.prototype.push=function(t){this.linkedList.prepend(t),this.length>this.maxStep&&this.linkedList.deleteTail()},t.prototype.pop=function(){var t=this.linkedList.deleteHead();return t?t.value:null},t.prototype.toArray=function(){return this.linkedList.toArray().map((function(t){return t.value}))},t.prototype.clear=function(){for(;!this.isEmpty();)this.pop()},t}();const Te=Ae;var ke=It;const Me={getAdjMatrix:lt,breadthFirstSearch:_t,connectedComponent:xt,getDegree:Et,getInDegree:St,getOutDegree:Ct,detectCycle:It,detectDirectedCycle:ke,detectAllCycles:Pt,detectAllDirectedCycle:Mt,detectAllUndirectedCycle:kt,depthFirstSearch:Tt,dijkstra:Ot,findAllPath:Dt,findShortestPath:Lt,floydWarshall:Nt,labelPropagation:Bt,louvain:Ht,iLouvain:Xt,kCore:Yt,kMeans:qt,cosineSimilarity:Kt,nodesCosineSimilarity:Qt,minimumSpanningTree:oe,pageRank:ae,getNeighbors:vt,Stack:Te,GADDI:Ce};var Pe=n(7160),Ie=n(1437),Oe=ut,Re=function(t){return function(e,n){return e[t]-n[t]}},Le=function(t,e,n){return t>=e&&t<=n},De=function(t,e,n,r){var i=n.x-t.x,o=n.y-t.y,a=e.x-t.x,s=e.y-t.y,u=r.x-n.x,l=r.y-n.y,c=a*l-s*u,h=1/c;if(c*c>1e-4*(a*a+s*s)*(u*u+l*l)){var f=(i*l-o*u)*h,p=(i*s-o*a)*h;return Le(f,0,1)&&Le(p,0,1)?{x:t.x+f*a,y:t.y+f*s}:null}return null},Ne=function(t,e){var n=t.x,r=t.y,i=t.width,o=t.height,a=[],s={x:n+i/2,y:r+o/2};a.push({x:n,y:r}),a.push({x:n+i,y:r}),a.push({x:n+i,y:r+o}),a.push({x:n,y:r+o}),a.push({x:n,y:r});for(var u=null,l=1;l<a.length&&!(u=De(a[l-1],a[l],s,e));l++);return u},Be=function(t,e){var n=t.x,r=t.y,i=t.r,o=e.x-n,a=e.y-r;if(o*o+a*a<i*i)return null;var s=Math.atan(a/o);return{x:n+Math.abs(i*Math.cos(s))*Math.sign(o),y:r+Math.abs(i*Math.sin(s))*Math.sign(a)}},ze=function(t,e){var n=t.rx,r=t.ry,i=t.x,o=t.y,a=e.x-i,s=e.y-o,u=Math.atan2(s/r,a/n);return u<0&&(u+=2*Math.PI),{x:i+n*Math.cos(u),y:o+r*Math.sin(u)}},Fe=function(t,e,n){void 0===n&&(n=1);var r=[t.x,t.y,n];return e&&!isNaN(e[0])||(e=[1,0,0,0,1,0,0,0,1]),Pe.transformMat3(r,r,e),{x:r[0],y:r[1]}},Ze=function(t,e,n){void 0===n&&(n=1),e&&!isNaN(e[0])||(e=[1,0,0,0,1,0,0,0,1]);var r=D([1,0,0,0,1,0,0,0,1],e);r||(r=[1,0,0,0,1,0,0,0,1]);var i=[t.x,t.y,n];return Pe.transformMat3(i,i,r),{x:i[0],y:i[1]}},je=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,o=t.x-n.x,a=t.y-n.y,s=(t.x*t.x-e.x*e.x-e.y*e.y+t.y*t.y)/2,u=(t.x*t.x-n.x*n.x-n.y*n.y+t.y*t.y)/2,l=i*o-r*a;return{x:-(a*s-i*u)/l,y:-(r*u-o*s)/l}},Ue=function(t,e){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},Ge=function(t,e){var n=[];return t.forEach((function(t){var r=[];t.forEach((function(t){r.push(t*e)})),n.push(r)})),n},Ve=function(t){for(var e=[],n=t.length,r=0;r<n;r+=1){e[r]=[];for(var i=0;i<n;i+=1)r===i?e[r][i]=0:0!==t[r][i]&&t[r][i]?e[r][i]=t[r][i]:e[r][i]=1/0}for(var o=0;o<n;o+=1)for(r=0;r<n;r+=1)for(i=0;i<n;i+=1)e[r][i]>e[r][o]+e[o][i]&&(e[r][i]=e[r][o]+e[o][i]);return e},We=function(t,e){var n=t.nodes,r=t.edges,i=[],o={};if(!n)throw new Error("invalid nodes data!");return n&&n.forEach((function(t,e){o[t.id]=e,i.push([])})),r&&r.forEach((function(t){var n=t.source,r=t.target,a=o[n],s=o[r];i[a][s]=1,e||(i[s][a]=1)})),i},He=function(t,e){t.translate(e.x,e.y)},Xe=function(t,e,n,r){void 0===r&&(r={duration:500});var i=t.getMatrix();i||(i=[1,0,0,0,1,0,0,0,1]);var o=t.getCanvasBBox(),a=e.x-o.minX,s=e.y-o.minY;if(n){var u=a*i[0],l=s*i[4],c=0,h=0,f=0,p=0;t.animate((function(t){return i=Oe(i,[["t",(f=u*t)-c,(p=l*t)-h]]),c=f,h=p,{matrix:i}}),r)}else{var d=Oe(i,[["t",a,s]]);t.setMatrix(d)}},Ye=function(t,e){var n=t.getMatrix();n||(n=[1,0,0,0,1,0,0,0,1]);var r=e;(0,_.isArray)(e)||(r=[e,e]),(0,_.isArray)(e)&&1===e.length&&(r=[e[0],e[0]]),n=Oe(n,[["s",r[0],r[1]]]),t.setMatrix(n)},qe=function(t,e){var n=t.getMatrix();n||(n=[1,0,0,0,1,0,0,0,1]),n=Oe(n,[["r",e]]),t.setMatrix(n)},Ke=function(t,e,n){for(var r=[],i=0;i<t;i++)r[i]=0;return n.forEach((function(t){t.source&&(r[e[t.source]]+=1),t.target&&(r[e[t.target]]+=1)})),r};function Qe(t,e,n){return(n[0]-t[0])*(e[1]-t[1])==(e[0]-t[0])*(n[1]-t[1])&&Math.min(t[0],e[0])<=n[0]&&n[0]<=Math.max(t[0],e[0])&&Math.min(t[1],e[1])<=n[1]&&n[1]<=Math.max(t[1],e[1])}var Je=function(t,e,n){var r=!1,i=t.length;function o(t){return Math.abs(t)<1e-6?0:t<0?-1:1}if(i<=2)return!1;for(var a=0;a<i;a++){var s=t[a],u=t[(a+1)%i];if(Qe(s,u,[e,n]))return!0;o(s[1]-n)>0!=o(u[1]-n)>0&&o(e-(n-s[1])*(s[0]-u[0])/(s[1]-u[1])-s[0])<0&&(r=!r)}return r},$e=function(t,e){return!(e.minX>t.maxX||e.maxX<t.minX||e.minY>t.maxY||e.maxY<t.minY)},tn=function(t,e){var n=function(t){var e=t.map((function(t){return t[0]})),n=t.map((function(t){return t[1]}));return{minX:Math.min.apply(null,e),maxX:Math.max.apply(null,e),minY:Math.min.apply(null,n),maxY:Math.max.apply(null,n)}},r=function(t){for(var e=[],n=t.length,r=0;r<n-1;r++){var i=t[r],o=t[r+1];e.push({from:{x:i[0],y:i[1]},to:{x:o[0],y:o[1]}})}if(e.length>1){var a=t[0],s=t[n-1];e.push({from:{x:s[0],y:s[1]},to:{x:a[0],y:a[1]}})}return e};if(t.length<2||e.length<2)return!1;var i=n(t),o=n(e);if(!$e(i,o))return!1;var a=!1;if((0,_.each)(e,(function(e){if(Je(t,e[0],e[1]))return a=!0,!1})),a)return!0;if((0,_.each)(t,(function(t){if(Je(e,t[0],t[1]))return a=!0,!1})),a)return!0;var s=r(t),u=r(e),l=!1;return(0,_.each)(u,(function(t){if(function(t,e){var n=!1;return(0,_.each)(t,(function(t){if(De(t.from,t.to,e.from,e.to))return n=!0,!1})),n}(s,t))return l=!0,!1})),l},en=function(){function t(t,e,n,r){this.x1=t,this.y1=e,this.x2=n,this.y2=r}return t.prototype.getBBox=function(){var t=Math.min(this.x1,this.x2),e=Math.min(this.y1,this.y2),n=Math.max(this.x1,this.x2),r=Math.max(this.y1,this.y2);return{x:t,y:e,minX:t,minY:e,maxX:n,maxY:r,width:n-t,height:r-e}},t}(),nn=function(t,e){return{top:[t.minX,t.minY,t.maxX,t.minY],left:[t.minX,t.minY,t.minX,t.maxY],bottom:[t.minX,t.maxY,t.maxX,t.maxY],right:[t.maxX,t.minY,t.maxX,t.maxY]}[e]},rn=function(t,e){var n=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),r=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),i=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(i){var o=n/i,a=r/i;if(o>=0&&o<=1&&a>=0&&a<=1)return o}return Number.POSITIVE_INFINITY},on=function(t,e){for(var n=["top","left","bottom","right"],r=t.getBBox(),i=0,o=[],a=0;a<4;a++){var s=nn(r,n[a]),u=s[0],l=s[1],c=s[2],h=s[3];o[a]=De({x:e.x1,y:e.y1},{x:e.x2,y:e.y2},{x:u,y:l},{x:c,y:h}),o[a]&&(i+=1)}return[o,i]},an=function(t,e){for(var n=["top","left","bottom","right"],r=t.getBBox(),i=Number.POSITIVE_INFINITY,o=0,a=0;a<4;a++){var s=nn(r,n[a]),u=s[0],l=s[1],c=s[2],h=s[3],f=rn(e,new en(u,l,c,h));(f=Math.abs(f-.5))>=0&&f<=1&&(o+=1,i=f<i?f:i)}return 0===o?-1:i},sn=function(t){var e=0,n=0;if(t.length>0){for(var r=0,i=t;r<i.length;r++){var o=i[r];e+=o.x,n+=o.y}e/=t.length,n/=t.length}return{x:e,y:n}},un=function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)},ln=function(t,e){var n,r=e.x1,i=e.y1,o=e.x2-r,a=e.y2-i,s=t.x-r,u=t.y-i,l=s*o+u*a;n=l<=0||(l=(s=o-s)*o+(u=a-u)*a)<=0?0:l*l/(o*o+a*a);var c=s*s+u*u-n;return c<0&&(c=0),c},cn=function(t,e,n){return void 0===n&&(n=.001),Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)<Math.pow(n,2)},hn=function(t,e){var n=t.x<e.x,r=t.x>e.x+e.width,i=t.y>e.y+e.height,o=t.y<e.y;if(!(n||r||i||o))return 0;if(i&&!n&&!r)return Math.pow(e.y+e.height-t.y,2);if(o&&!n&&!r)return Math.pow(t.y-e.y,2);if(n&&!i&&!o)return Math.pow(e.x-t.x,2);if(r&&!i&&!o)return Math.pow(e.x+e.width-t.x,2);var a=Math.min(Math.abs(e.x-t.x),Math.abs(e.x+e.width-t.x)),s=Math.min(Math.abs(e.y-t.y),Math.abs(e.y+e.height-t.y));return a*a+s*s},fn=function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=e.x,s=e.y,u=[i-n,o-r];if(Ie.I6(u,[0,0]))return NaN;var l=[-u[1],u[0]];Ie.Fv(l,l);var c=[a-n,s-r];return Math.abs(Ie.AK(c,l))},pn=function(t,e,n){return t+(e-t)*n},dn="rgb(95, 149, 255)",gn="rgb(0, 0, 0)",vn="rgb(247, 250, 255)",mn="rgb(253, 253, 253)",yn="rgb(250, 250, 250)",_n="rgb(224, 224, 224)",bn="rgb(234, 234, 234)",xn="#4572d9";const wn={version:"0.5.1",rootContainerClassName:"root-container",nodeContainerClassName:"node-container",edgeContainerClassName:"edge-container",comboContainerClassName:"combo-container",delegateContainerClassName:"delegate-container",defaultLoopPosition:"top",nodeLabel:{style:{fill:"#000",fontSize:12,textAlign:"center",textBaseline:"middle"},offset:4},defaultNode:{type:"circle",style:{lineWidth:1,stroke:dn,fill:"rgb(239, 244, 255)"},size:20,color:dn,linkPoints:{size:8,lineWidth:1,fill:vn,stroke:dn}},nodeStateStyles:{active:{fill:vn,stroke:dn,lineWidth:2,shadowColor:dn,shadowBlur:10},selected:{fill:"rgb(255, 255, 255)",stroke:dn,lineWidth:4,shadowColor:dn,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{fill:"rgb(223, 234, 255)",stroke:xn,lineWidth:2,"text-shape":{fontWeight:500}},inactive:{fill:vn,stroke:"rgb(191, 213, 255)",lineWidth:1},disable:{fill:yn,stroke:_n,lineWidth:1}},edgeLabel:{style:{fill:gn,textAlign:"center",textBaseline:"middle",fontSize:12}},defaultEdge:{type:"line",size:1,style:{stroke:_n,lineAppendWidth:2},color:_n},edgeStateStyles:{active:{stroke:dn,lineWidth:1},selected:{stroke:dn,lineWidth:2,shadowColor:dn,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{stroke:dn,lineWidth:2,"text-shape":{fontWeight:500}},inactive:{stroke:bn,lineWidth:1},disable:{stroke:"rgb(245, 245, 245)",lineWidth:1}},comboLabel:{style:{fill:gn,textBaseline:"middle",fontSize:12},refY:10,refX:10},defaultCombo:{type:"circle",style:{fill:mn,lineWidth:1,stroke:_n,r:5,width:20,height:10},size:[20,5],color:_n,padding:[25,20,15,20]},comboStateStyles:{active:{stroke:dn,lineWidth:1,fill:vn},selected:{stroke:dn,lineWidth:2,fill:mn,shadowColor:dn,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{stroke:xn,lineWidth:2,fill:mn,"text-shape":{fontWeight:500}},inactive:{stroke:_n,fill:mn,lineWidth:1},disable:{stroke:bn,fill:yn,lineWidth:1}},delegateStyle:{fill:"#F3F9FF",fillOpacity:.5,stroke:"#1890FF",strokeOpacity:.9,lineDash:[5,5]},windowFontFamily:"undefined"!=typeof window&&window.getComputedStyle&&window.getComputedStyle(document.body,null).getPropertyValue("font-family")||"Arial, sans-serif"},En={" ":.3329986572265625,a:.5589996337890625,A:.6569992065429687,b:.58599853515625,B:.6769989013671875,c:.5469985961914062,C:.7279998779296875,d:.58599853515625,D:.705999755859375,e:.554998779296875,E:.63699951171875,f:.37299957275390627,F:.5769989013671875,g:.5909988403320312,G:.7479995727539063,h:.555999755859375,H:.7199996948242188,i:.255999755859375,I:.23699951171875,j:.26699981689453123,J:.5169998168945312,k:.5289993286132812,K:.6899993896484375,l:.23499908447265624,L:.5879989624023437,m:.854998779296875,M:.8819992065429687,n:.5589996337890625,N:.7189987182617188,o:.58599853515625,O:.7669998168945312,p:.58599853515625,P:.6419998168945312,q:.58599853515625,Q:.7669998168945312,r:.3649993896484375,R:.6759994506835938,s:.504998779296875,S:.6319992065429687,t:.354998779296875,T:.6189987182617187,u:.5599990844726562,U:.7139999389648437,v:.48199920654296874,V:.6389999389648438,w:.754998779296875,W:.929998779296875,x:.5089996337890625,X:.63699951171875,y:.4959991455078125,Y:.66199951171875,z:.48699951171875,Z:.6239990234375,0:.6,1:.40099945068359377,2:.6,3:.6,4:.6,5:.6,6:.6,7:.5469985961914062,8:.6,9:.6,"[":.3329986572265625,"]":.3329986572265625,",":.26399993896484375,".":.26399993896484375,";":.26399993896484375,":":.26399993896484375,"{":.3329986572265625,"}":.3329986572265625,"\\":.5,"|":.19499969482421875,"=":.604998779296875,"+":.604998779296875,"-":.604998779296875,_:.5,"`":.3329986572265625," ~":.8329986572265625,"!":.3329986572265625,"@":.8579986572265625,"#":.6,$:.6,"%":.9699996948242188,"^":.517999267578125,"&":.7259994506835937,"*":.505999755859375,"(":.3329986572265625,")":.3329986572265625,"<":.604998779296875,">":.604998779296875,"/":.5,"?":.53699951171875};var Sn=Math.PI,Cn=Math.sin,An=Math.cos,Tn=Cn(Sn/8),kn=An(Sn/8),Mn=function(t,e){var n=t.getBBox(),r={x:n.minX,y:n.minY},i={x:n.maxX,y:n.maxY};if(e){var o=e.getMatrix();o||(o=[1,0,0,0,1,0,0,0,1]),r=Fe(r,o),i=Fe(i,o)}var a=r.x,s=r.y,u=i.x,l=i.y;return{x:a,y:s,minX:a,minY:s,maxX:u,maxY:l,width:u-a,height:l-s}},Pn=function(t){var e=t.sourceNode||t.targetNode,n=e.get("group").getMatrix();n||(n=[1,0,0,0,1,0,0,0,1]);var r=e.getKeyShape().getBBox(),i=t.loopCfg||{},o=i.dist||2*Math.max(r.width,r.height),a=i.position||wn.defaultLoopPosition,s=[n[6],n[7]],u=[t.startPoint.x,t.startPoint.y],l=[t.endPoint.x,t.endPoint.y],c=r.height/2,h=r.height/2,f=c*Tn,p=c*kn,d=h*Tn,g=h*kn;if(u[0]===l[0]&&u[1]===l[1]){switch(a){case"top":u=[s[0]-f,s[1]-p],l=[s[0]+d,s[1]-g];break;case"top-right":c=r.height/2,h=r.width/2,u=[s[0]+(f=c*Tn),s[1]-(p=c*kn)],l=[s[0]+(g=h*kn),s[1]-(d=h*Tn)];break;case"right":c=r.width/2,h=r.width/2,u=[s[0]+(p=c*kn),s[1]-(f=c*Tn)],l=[s[0]+(g=h*kn),s[1]+(d=h*Tn)];break;case"bottom-right":c=r.width/2,h=r.height/2,u=[s[0]+(p=c*kn),s[1]+(f=c*Tn)],l=[s[0]+(d=h*Tn),s[1]+(g=h*kn)];break;case"bottom":c=r.height/2,h=r.height/2,u=[s[0]+(f=c*Tn),s[1]+(p=c*kn)],l=[s[0]-(d=h*Tn),s[1]+(g=h*kn)];break;case"bottom-left":c=r.height/2,h=r.width/2,u=[s[0]-(f=c*Tn),s[1]+(p=c*kn)],l=[s[0]-(g=h*kn),s[1]+(d=h*Tn)];break;case"left":c=r.width/2,h=r.width/2,u=[s[0]-(p=c*kn),s[1]+(f=c*Tn)],l=[s[0]-(g=h*kn),s[1]-(d=h*Tn)];break;case"top-left":c=r.width/2,h=r.height/2,u=[s[0]-(p=c*kn),s[1]-(f=c*Tn)],l=[s[0]-(d=h*Tn),s[1]-(g=h*kn)];break;default:c=r.width/2,h=r.width/2,u=[s[0]-(f=c*Tn),s[1]-(p=c*kn)],l=[s[0]+(d=h*Tn),s[1]-(g=h*kn)]}if(!1===i.clockwise){var v=[u[0],u[1]];u=[l[0],l[1]],l=[v[0],v[1]]}}var m=[u[0]-s[0],u[1]-s[1]],y=(c+o)/c,_=(h+o)/h;!1===i.clockwise&&(y=(h+o)/h,_=(c+o)/c);var b=Ie.bA([0,0],m,y),x=[s[0]+b[0],s[1]+b[1]],w=[l[0]-s[0],l[1]-s[1]],E=Ie.bA([0,0],w,_),S=[s[0]+E[0],s[1]+E[1]];return t.startPoint={x:u[0],y:u[1]},t.endPoint={x:l[0],y:l[1]},t.controlPoints=[{x:x[0],y:x[1]},{x:S[0],y:S[1]}],t},In=function(t,e,n,r,i){var o=1e-4,a=[],s=null==t?void 0:t.getPoint(e);if(!s)return{x:0,y:0,angle:0};if(e<o)a=t.getStartTangent().reverse();else if(e>.9999)a=t.getEndTangent();else{var u=null==t?void 0:t.getPoint(e+o);a.push([s.x,s.y]),a.push([u.x,u.y])}var l=Math.atan2(a[1][1]-a[0][1],a[1][0]-a[0][0]);if(l<0&&(l+=2*Sn),n&&(s.x+=An(l)*n,s.y+=Cn(l)*n),r){var c=l-Sn/2;l>.5*Sn&&l<1.5*Sn&&(c-=Sn),s.x+=An(c)*r,s.y+=Cn(c)*r}var h={x:s.x,y:s.y,angle:l};return i?(l>.5*Sn&&l<1.5*Sn&&(l-=Sn),(0,y.__assign)({rotate:l},h)):h},On=function t(e,n){if(!1===n(e))return!1;if(e&&e.children)for(var r=e.children.length-1;r>=0;r--)if(!t(e.children[r],n))return!1;return!0},Rn=function t(e,n){if(e&&e.children)for(var r=e.children.length-1;r>=0;r--)if(!t(e.children[r],n))return;return!1!==n(e)},Ln=function(t,e){"function"==typeof e&&On(t,e)},Dn=function(t,e){"function"==typeof e&&Rn(t,e)},Nn=function(t,e){return e*(En[t]||1)},Bn=function(t,e){var n=0,r=new RegExp("[一-龥]+");return t.split("").forEach((function(t){r.test(t)?n+=e:n+=Nn(t,e)})),[n,e]},zn=function(t,e){var n=[],r={},i={};t.forEach((function(t){i[t.id]=t})),t.forEach((function(t,e){var o=(0,_.clone)(t);o.itemType="combo",o.children=void 0,o.parentId===o.id?(console.warn("The parentId for combo ".concat(o.id," can not be the same as the combo's id")),delete o.parentId):o.parentId&&!i[o.parentId]&&(console.warn("The parent combo for combo ".concat(o.id," does not exist!")),delete o.parentId);var a=r[o.id];if(a){if(o.children=a.children,r[o.id]=o,!(a=o).parentId)return void n.push(a);var s=r[a.parentId];if(s)s.children?s.children.push(o):s.children=[o];else{var u={id:a.parentId,children:[a]};r[a.parentId]=u,r[o.id]=o}}else if((0,_.isString)(t.parentId)){var l=r[t.parentId];if(l)l.children?l.children.push(o):l.children=[o],r[o.id]=o;else{var c={id:t.parentId,children:[o]};r[c.id]=c,r[o.id]=o}}else n.push(o),r[o.id]=o}));var o={};(e||[]).forEach((function(t){o[t.id]=t;var e=r[t.comboId];if(e){var n={id:t.id,comboId:t.comboId};e.children?e.children.push(n):e.children=[n],n.itemType="node",r[t.id]=n}}));var a=0;return n.forEach((function(t){t.depth=a+10,On(t,(function(t){var e,n=r[t.id].itemType;e="node"===n?r[t.comboId]:r[t.parentId],t.depth=e&&"node"===n?a+1:a+10,a<t.depth&&(a=t.depth);var i=o[t.id];return i&&(i.depth=t.depth),!0}))})),n},Fn=function(t,e,n){var r,i=t,o={root:{children:t}},a=!1,s="root";(t||[]).forEach((function(t){if(!a)return t.id===e?(r=t,"combo"===t.itemType?r.parentId=n:r.comboId=n,void(a=!0)):void Ln(t,(function(t){return o[t.id]={children:t.children},i=o[t.parentId||t.comboId||"root"].children,!t||!t.removed&&e!==t.id||!i||(s=t.parentId||t.comboId||"root",r=t,"combo"===t.itemType?r.parentId=n:r.comboId=n,a=!0,!1)}))}));var u=(i=o[s].children)?i.indexOf(r):-1;if(u>-1&&i.splice(u,1),a||(r={id:e,itemType:"node",comboId:n},o[e]={children:void 0}),e){var l=!1;if(n){var c=0;(t||[]).forEach((function(t){l||Ln(t,(function(t){return n!==t.id||(l=!0,t.children?t.children.push(r):t.children=[r],c=t.depth,"node"===r.itemType?r.depth=c+2:r.depth=c+1,!1)}))}))}else n&&l||"node"===r.itemType||t.push(r);var h=r.depth;Ln(r,(function(t){return"node"===t.itemType?h+=2:h+=1,t.depth=h,!0}))}return t},Zn=function(t,e,n){var r={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0,x:void 0,y:void 0,width:void 0,height:void 0,centerX:void 0,centerY:void 0};if(!t||0===t.length){var i=(null==n?void 0:n.getModel())||{},o=i.x,a=i.y;return{minX:o,minY:a,maxX:o,maxY:a,x:o,y:a,width:void 0,height:void 0}}return t.forEach((function(t){var n=e.findById(t.id);if(n&&n.isVisible()){n.set("bboxCanvasCache",void 0);var i=n.getCanvasBBox();i.x&&r.minX>i.minX&&(r.minX=i.minX),i.y&&r.minY>i.minY&&(r.minY=i.minY),i.x&&r.maxX<i.maxX&&(r.maxX=i.maxX),i.y&&r.maxY<i.maxY&&(r.maxY=i.maxY)}})),r.x=(r.minX+r.maxX)/2,r.y=(r.minY+r.maxY)/2,r.width=r.maxX-r.minX,r.height=r.maxY-r.minY,r.centerX=(r.minX+r.maxX)/2,r.centerY=(r.minY+r.maxY)/2,Object.keys(r).forEach((function(t){r[t]!==1/0&&r[t]!==-1/0||(r[t]=void 0)})),r},jn=function(t){var e=(0,_.isNumber)(t.x)||(0,_.isNumber)(t.y)||t.type||t.anchorPoints||t.size;return t.style&&(e=e||(0,_.isNumber)(t.style.r)||(0,_.isNumber)(t.style.width)||(0,_.isNumber)(t.style.height)||(0,_.isNumber)(t.style.rx)||(0,_.isNumber)(t.style.ry)),e},Un=function(t){var e={};return Object.keys(t).forEach((function(n){var r=t[n];if((0,_.isObject)(r)&&!(0,_.isArray)(r)){var i={};Object.keys(r).forEach((function(t){var e=r[t];("img"!==t||(0,_.isString)(e))&&(i[t]=(0,_.clone)(e))})),e[n]=i}else e[n]=(0,_.clone)(r)})),e},Gn=function(t){var e;if(!t)return console.error("G6 Error Tips: the data must be defined"),!1;var n=t.nodes,r=t.edges,i=t.combos,o=void 0===i?[]:i;if(!n&&!r){var a=!0;return Ln(t,(function(t){return!!(0,_.isString)(t.id)||(a=!1,!1)})),a}var s=(n||[]).find((function(t){return!(0,_.isString)(t.id)}));if(s)return console.warn("G6 Warning Tips: missing 'id' property, or %c".concat(s.id,"%c is not a string."),"font-size: 20px; color: red;",""),!1;var u=(n||[]).map((function(t){return t.id})),l=null===(e=o)||void 0===e?void 0:e.map((function(t){return t.id})),c=(0,y.__spreadArray)((0,y.__spreadArray)([],u,!0),l,!0),h=(r||[]).find((function(t){return!c.includes(t.source)||!c.includes(t.target)}));return!h||(console.warn("G6 Warning Tips: The source %c".concat(h.source,"%c or the target %c").concat(h.target,"%c of the edge do not exist in the nodes or combos."),"font-size: 20px; color: red;","","font-size: 20px; color: red;",""),!1)},Vn=function(){function t(t){this.graph=t,this.destroyed=!1,this.modes=t.get("modes")||{default:[]},this.formatModes(),this.mode=t.get("defaultMode")||"default",this.currentBehaves=[],this.setMode(this.mode)}return t.prototype.formatModes=function(){var t=this.modes;(0,_.each)(t,(function(t){(0,_.each)(t,(function(e,n){(0,_.isString)(e)&&(t[n]={type:e})}))}))},t.prototype.setBehaviors=function(t){var e,n=this.graph,r=this.modes[t],i=[];(0,_.each)(r||[],(function(t){var r=w.getBehavior(t.type||t);r&&(e=new r(t))&&(e.bind(n),i.push(e))})),this.currentBehaves=i},t.mergeBehaviors=function(t,e){return(0,_.each)(e,(function(e){t.indexOf(e)<0&&((0,_.isString)(e)&&(e={type:e}),t.push(e))})),t},t.filterBehaviors=function(t,e){var n=[];return t.forEach((function(t){var r;r=(0,_.isString)(t)?t:t.type,e.indexOf(r)<0&&n.push(t)})),n},t.prototype.setMode=function(t){var e=this.modes,n=this.graph,r=t;e[r]&&(n.emit("beforemodechange",{mode:t}),(0,_.each)(this.currentBehaves,(function(t){t.delegate&&t.delegate.remove(),t.unbind(n)})),this.setBehaviors(r),n.emit("aftermodechange",{mode:t}),this.mode=t)},t.prototype.getMode=function(){return this.mode},t.prototype.manipulateBehaviors=function(e,n,r){var i,o=this;if(i=(0,_.isArray)(e)?e:[e],(0,_.isArray)(n))return(0,_.each)(n,(function(e){o.modes[e]?o.modes[e]=r?t.mergeBehaviors(o.modes[e]||[],i):t.filterBehaviors(o.modes[e]||[],i):r&&(o.modes[e]=i)})),this;var a=n;return n||(a=this.mode),this.modes[a]||r&&(this.modes[a]=i),this.modes[a]=r?t.mergeBehaviors(this.modes[a]||[],i):t.filterBehaviors(this.modes[a]||[],i),this.formatModes(),this.setMode(this.mode),this},t.prototype.updateBehavior=function(t,e,n){(0,_.isString)(t)&&(t={type:t});var r=[];if(n&&n!==this.mode&&"default"!==n){if(!(r=this.modes[n])||!r.length)return console.warn("Update behavior failed! There is no behaviors in this mode on the graph."),this;var i=r.length;for(a=0;a<i;a++){if((s=r[a]).type===t.type||s===t.type)return s===t.type&&(s={type:s}),Object.assign(s,e),r[a]=s,this;a===i-1&&console.warn("Update behavior failed! There is no such behavior in the mode")}}else{if(!(r=this.currentBehaves)||!r.length)return console.warn("Update behavior failed! There is no behaviors in this mode on the graph."),this;for(var o=r.length,a=0;a<o;a++){var s;if((s=r[a]).type===t.type)return s.updateCfg(e),this;a===o-1&&console.warn("Update behavior failed! There is no such behavior in the mode")}}return this},t.prototype.destroy=function(){this.graph=null,this.modes=null,this.currentBehaves=null,this.destroyed=!0},t}();const Wn=Vn;var Hn="\t\n\v\f\r   ᠎             　\u2028\u2029",Xn=new RegExp("([a-z])["+Hn+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+Hn+"]*,?["+Hn+"]*)+)","ig"),Yn=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+Hn+"]*,?["+Hn+"]*","ig"),qn=function(t){if(!t)return null;if((0,_.isArray)(t))return t;var e={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},n=[];return String(t).replace(Xn,(function(r,i,o){var a=[],s=i.toLowerCase();if(o.replace(Yn,(function(t,e){e&&a.push(+e)})),"m"===s&&a.length>2&&(n.push([i].concat(a.splice(0,2))),s="l",i="m"===i?"l":"L"),"o"===s&&1===a.length&&n.push([i,a[0]]),"r"===s)n.push([i].concat(a));else for(;a.length>=e[s]&&(n.push([i].concat(a.splice(0,e[s]))),e[s]););return t})),n},Kn=function(t,e){for(var n=[],r=0,i=t.length;i-2*!e>r;r+=2){var o=[{x:+t[r-2],y:+t[r-1]},{x:+t[r],y:+t[r+1]},{x:+t[r+2],y:+t[r+3]},{x:+t[r+4],y:+t[r+5]}];e?r?i-4===r?o[3]={x:+t[0],y:+t[1]}:i-2===r&&(o[2]={x:+t[0],y:+t[1]},o[3]={x:+t[2],y:+t[3]}):o[0]={x:+t[i-2],y:+t[i-1]}:i-4===r?o[3]=o[2]:r||(o[0]={x:+t[r],y:+t[r+1]}),n.push(["C",(-o[0].x+6*o[1].x+o[2].x)/6,(-o[0].y+6*o[1].y+o[2].y)/6,(o[1].x+6*o[2].x-o[3].x)/6,(o[1].y+6*o[2].y-o[3].y)/6,o[2].x,o[2].y])}return n},Qn=function(t,e,n,r,i){var o=[];if(null===i&&null===r&&(r=n),t=+t,e=+e,n=+n,r=+r,null!==i){var a=Math.PI/180,s=t+n*Math.cos(-r*a),u=t+n*Math.cos(-i*a);o=[["M",s,e+n*Math.sin(-r*a)],["A",n,n,0,+(i-r>180),0,u,e+n*Math.sin(-i*a)]]}else o=[["M",t,e],["m",0,-r],["a",n,r,0,1,1,0,2*r],["a",n,r,0,1,1,0,-2*r],["z"]];return o},Jn=function(t){if(!(t=qn(t))||!t.length)return[["M",0,0]];var e,n,r=[],i=0,o=0,a=0,s=0,u=0;"M"===t[0][0]&&(a=i=+t[0][1],s=o=+t[0][2],u++,r[0]=["M",i,o]);for(var l=3===t.length&&"M"===t[0][0]&&"R"===t[1][0].toUpperCase()&&"Z"===t[2][0].toUpperCase(),c=void 0,h=void 0,f=u,p=t.length;f<p;f++){if(r.push(c=[]),(e=(h=t[f])[0])!==e.toUpperCase())switch(c[0]=e.toUpperCase(),c[0]){case"A":c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5],c[6]=+h[6]+i,c[7]=+h[7]+o;break;case"V":c[1]=+h[1]+o;break;case"H":c[1]=+h[1]+i;break;case"R":for(var d=2,g=(n=[i,o].concat(h.slice(1))).length;d<g;d++)n[d]=+n[d]+i,n[++d]=+n[d]+o;r.pop(),r=r.concat(Kn(n,l));break;case"O":r.pop(),(n=Qn(i,o,h[1],h[2])).push(n[0]),r=r.concat(n);break;case"U":r.pop(),r=r.concat(Qn(i,o,h[1],h[2],h[3])),c=["U"].concat(r[r.length-1].slice(-2));break;case"M":a=+h[1]+i,s=+h[2]+o;break;default:for(d=1,g=h.length;d<g;d++)c[d]=+h[d]+(d%2?i:o)}else if("R"===e)n=[i,o].concat(h.slice(1)),r.pop(),r=r.concat(Kn(n,l)),c=["R"].concat(h.slice(-2));else if("O"===e)r.pop(),(n=Qn(i,o,h[1],h[2])).push(n[0]),r=r.concat(n);else if("U"===e)r.pop(),r=r.concat(Qn(i,o,h[1],h[2],h[3])),c=["U"].concat(r[r.length-1].slice(-2));else for(var v=0,m=h.length;v<m;v++)c[v]=h[v];if("O"!==(e=e.toUpperCase()))switch(c[0]){case"Z":i=+a,o=+s;break;case"H":i=c[1];break;case"V":o=c[1];break;case"M":a=c[c.length-2],s=c[c.length-1];break;default:i=c[c.length-2],o=c[c.length-1]}}return r},$n=function(t,e,n,r){return[t,e,n,r,n,r]},tr=function(t,e,n,r,i,o){var a=1/3,s=2/3;return[a*t+s*n,a*e+s*r,a*i+s*n,a*o+s*r,i,o]},er=function(t,e,n,r,i,o,a,s,u,l){n===r&&(n+=1);var c,h,f,p,d,g=120*Math.PI/180,v=Math.PI/180*(+i||0),m=[],y=function(t,e,n){return{x:t*Math.cos(n)-e*Math.sin(n),y:t*Math.sin(n)+e*Math.cos(n)}};if(l)h=l[0],f=l[1],p=l[2],d=l[3];else{t=(c=y(t,e,-v)).x,e=c.y,s=(c=y(s,u,-v)).x,u=c.y,t===s&&e===u&&(s+=1,u+=1);var _=(t-s)/2,b=(e-u)/2,x=_*_/(n*n)+b*b/(r*r);x>1&&(n*=x=Math.sqrt(x),r*=x);var w=n*n,E=r*r,S=(o===a?-1:1)*Math.sqrt(Math.abs((w*E-w*b*b-E*_*_)/(w*b*b+E*_*_)));p=S*n*b/r+(t+s)/2,d=S*-r*_/n+(e+u)/2,h=Math.asin(((e-d)/r).toFixed(9)),f=Math.asin(((u-d)/r).toFixed(9)),h=t<p?Math.PI-h:h,f=s<p?Math.PI-f:f,h<0&&(h=2*Math.PI+h),f<0&&(f=2*Math.PI+f),a&&h>f&&(h-=2*Math.PI),!a&&f>h&&(f-=2*Math.PI)}var C=f-h;if(Math.abs(C)>g){var A=f,T=s,k=u;f=h+g*(a&&f>h?1:-1),s=p+n*Math.cos(f),u=d+r*Math.sin(f),m=er(s,u,n,r,i,0,a,T,k,[f,A,p,d])}C=f-h;var M=Math.cos(h),P=Math.sin(h),I=Math.cos(f),O=Math.sin(f),R=Math.tan(C/4),L=4/3*n*R,D=4/3*r*R,N=[t,e],B=[t+L*P,e-D*M],z=[s+L*O,u-D*I],F=[s,u];if(B[0]=2*N[0]-B[0],B[1]=2*N[1]-B[1],l)return[B,z,F].concat(m);for(var Z=[],j=0,U=(m=[B,z,F].concat(m).join().split(",")).length;j<U;j++)Z[j]=j%2?y(m[j-1],m[j],v).y:y(m[j],m[j+1],v).x;return Z},nr=function(t,e){var n,r=Jn(t),i=e&&Jn(e),o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},s=[],u=[],l="",c="",h=function(t,e,n){var r,i;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(er.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"===n||"S"===n?(r=2*e.x-e.bx,i=2*e.y-e.by):(r=e.x,i=e.y),t=["C",r,i].concat(t.slice(1));break;case"T":"Q"===n||"T"===n?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(tr(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(tr(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat($n(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat($n(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat($n(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat($n(e.x,e.y,e.X,e.Y))}return t},f=function(t,e){if(t[e].length>7){t[e].shift();for(var o=t[e];o.length;)s[e]="A",i&&(u[e]="A"),t.splice(e++,0,["C"].concat(o.splice(0,6)));t.splice(e,1),n=Math.max(r.length,i&&i.length||0)}},p=function(t,e,o,a,s){t&&e&&"M"===t[s][0]&&"M"!==e[s][0]&&(e.splice(s,0,["M",a.x,a.y]),o.bx=0,o.by=0,o.x=t[s][1],o.y=t[s][2],n=Math.max(r.length,i&&i.length||0))};n=Math.max(r.length,i&&i.length||0);for(var d=0;d<n;d++){r[d]&&(l=r[d][0]),"C"!==l&&(s[d]=l,d&&(c=s[d-1])),r[d]=h(r[d],o,c),"A"!==s[d]&&"C"===l&&(s[d]="C"),f(r,d),i&&(i[d]&&(l=i[d][0]),"C"!==l&&(u[d]=l,d&&(c=u[d-1])),i[d]=h(i[d],a,c),"A"!==u[d]&&"C"===l&&(u[d]="C"),f(i,d)),p(r,i,o,a,d),p(i,r,a,o,d);var g=r[d],v=i&&i[d],m=g.length,y=i&&v.length;o.x=g[m-2],o.y=g[m-1],o.bx=parseFloat(g[m-4])||o.x,o.by=parseFloat(g[m-3])||o.y,a.bx=i&&(parseFloat(v[y-4])||a.x),a.by=i&&(parseFloat(v[y-3])||a.y),a.x=i&&v[y-2],a.y=i&&v[y-1]}return i?[r,i]:r},rr=/,?([a-z]),?/gi,ir=function(t){return t.join(",").replace(rr,"$1")},or=function(t,e,n,r,i){return t*(t*(-3*e+9*n-9*r+3*i)+6*e-12*n+6*r)-3*e+3*n},ar=function(t,e,n,r,i,o,a,s,u){null===u&&(u=1);for(var l=(u=u>1?1:u<0?0:u)/2,c=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],h=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],f=0,p=0;p<12;p++){var d=l*c[p]+l,g=or(d,t,n,i,a),v=or(d,e,r,o,s),m=g*g+v*v;f+=h[p]*Math.sqrt(m)}return l*f},sr=function(t,e,n,r,i,o,a,s){for(var u,l,c,h,f=[],p=[[],[]],d=0;d<2;++d)if(0===d?(l=6*t-12*n+6*i,u=-3*t+9*n-9*i+3*a,c=3*n-3*t):(l=6*e-12*r+6*o,u=-3*e+9*r-9*o+3*s,c=3*r-3*e),Math.abs(u)<1e-12){if(Math.abs(l)<1e-12)continue;(h=-c/l)>0&&h<1&&f.push(h)}else{var g=l*l-4*c*u,v=Math.sqrt(g);if(!(g<0)){var m=(-l+v)/(2*u);m>0&&m<1&&f.push(m);var y=(-l-v)/(2*u);y>0&&y<1&&f.push(y)}}for(var _,b=f.length,x=b;b--;)_=1-(h=f[b]),p[0][b]=_*_*_*t+3*_*_*h*n+3*_*h*h*i+h*h*h*a,p[1][b]=_*_*_*e+3*_*_*h*r+3*_*h*h*o+h*h*h*s;return p[0][x]=t,p[1][x]=e,p[0][x+1]=a,p[1][x+1]=s,p[0].length=p[1].length=x+2,{min:{x:Math.min.apply(0,p[0]),y:Math.min.apply(0,p[1])},max:{x:Math.max.apply(0,p[0]),y:Math.max.apply(0,p[1])}}},ur=function(t,e,n,r,i,o,a,s){if(!(Math.max(t,n)<Math.min(i,a)||Math.min(t,n)>Math.max(i,a)||Math.max(e,r)<Math.min(o,s)||Math.min(e,r)>Math.max(o,s))){var u=(t-n)*(o-s)-(e-r)*(i-a);if(u){var l=((t*r-e*n)*(i-a)-(t-n)*(i*s-o*a))/u,c=((t*r-e*n)*(o-s)-(e-r)*(i*s-o*a))/u,h=+l.toFixed(2),f=+c.toFixed(2);if(!(h<+Math.min(t,n).toFixed(2)||h>+Math.max(t,n).toFixed(2)||h<+Math.min(i,a).toFixed(2)||h>+Math.max(i,a).toFixed(2)||f<+Math.min(e,r).toFixed(2)||f>+Math.max(e,r).toFixed(2)||f<+Math.min(o,s).toFixed(2)||f>+Math.max(o,s).toFixed(2)))return{x:l,y:c}}}},lr=function(t,e,n){return e>=t.x&&e<=t.x+t.width&&n>=t.y&&n<=t.y+t.height},cr=function(t,e,n,r,i){if(i)return[["M",+t+ +i,e],["l",n-2*i,0],["a",i,i,0,0,1,i,i],["l",0,r-2*i],["a",i,i,0,0,1,-i,i],["l",2*i-n,0],["a",i,i,0,0,1,-i,-i],["l",0,2*i-r],["a",i,i,0,0,1,i,-i],["z"]];var o=[["M",t,e],["l",n,0],["l",0,r],["l",-n,0],["z"]];return o.parsePathArray=ir,o},hr=function(t,e,n,r){return null===t&&(t=e=n=r=0),null===e&&(e=t.y,n=t.width,r=t.height,t=t.x),{x:t,y:e,width:n,w:n,height:r,h:r,x2:t+n,y2:e+r,cx:t+n/2,cy:e+r/2,r1:Math.min(n,r)/2,r2:Math.max(n,r)/2,r0:Math.sqrt(n*n+r*r)/2,path:cr(t,e,n,r),vb:[t,e,n,r].join(" ")}},fr=function(t,e,n,r,i,o,a,s){(0,_.isArray)(t)||(t=[t,e,n,r,i,o,a,s]);var u=sr.apply(null,t);return hr(u.min.x,u.min.y,u.max.x-u.min.x,u.max.y-u.min.y)},pr=function(t,e,n,r,i,o,a,s,u){var l=1-u,c=Math.pow(l,3),h=Math.pow(l,2),f=u*u,p=f*u,d=t+2*u*(n-t)+f*(i-2*n+t),g=e+2*u*(r-e)+f*(o-2*r+e),v=n+2*u*(i-n)+f*(a-2*i+n),m=r+2*u*(o-r)+f*(s-2*o+r);return{x:c*t+3*h*u*n+3*l*u*u*i+p*a,y:c*e+3*h*u*r+3*l*u*u*o+p*s,m:{x:d,y:g},n:{x:v,y:m},start:{x:l*t+u*n,y:l*e+u*r},end:{x:l*i+u*a,y:l*o+u*s},alpha:90-180*Math.atan2(d-v,g-m)/Math.PI}},dr=function(t,e,n){if(r=fr(t),i=fr(e),r=hr(r),i=hr(i),!(lr(i,r.x,r.y)||lr(i,r.x2,r.y)||lr(i,r.x,r.y2)||lr(i,r.x2,r.y2)||lr(r,i.x,i.y)||lr(r,i.x2,i.y)||lr(r,i.x,i.y2)||lr(r,i.x2,i.y2)||(r.x<i.x2&&r.x>i.x||i.x<r.x2&&i.x>r.x)&&(r.y<i.y2&&r.y>i.y||i.y<r.y2&&i.y>r.y)))return n?0:[];for(var r,i,o=~~(ar.apply(0,t)/8),a=~~(ar.apply(0,e)/8),s=[],u=[],l={},c=n?0:[],h=0;h<o+1;h++){var f=pr.apply(0,t.concat(h/o));s.push({x:f.x,y:f.y,t:h/o})}for(h=0;h<a+1;h++)f=pr.apply(0,e.concat(h/a)),u.push({x:f.x,y:f.y,t:h/a});for(h=0;h<o;h++)for(var p=0;p<a;p++){var d=s[h],g=s[h+1],v=u[p],m=u[p+1],y=Math.abs(g.x-d.x)<.001?"y":"x",_=Math.abs(m.x-v.x)<.001?"y":"x",b=ur(d.x,d.y,g.x,g.y,v.x,v.y,m.x,m.y);if(b){if(l[b.x.toFixed(4)]===b.y.toFixed(4))continue;l[b.x.toFixed(4)]=b.y.toFixed(4);var x=d.t+Math.abs((b[y]-d[y])/(g[y]-d[y]))*(g.t-d.t),w=v.t+Math.abs((b[_]-v[_])/(m[_]-v[_]))*(m.t-v.t);x>=0&&x<=1&&w>=0&&w<=1&&(n?c+=1:c.push({x:b.x,y:b.y,t1:x,t2:w}))}}return c},gr=function(t,e){return function(t,e,n){var r,i,o,a,s,u,l,c,h,f;t=nr(t),e=nr(e);for(var p=[],d=0,g=t.length;d<g;d++){var v=t[d];if("M"===v[0])r=s=v[1],i=u=v[2];else{"C"===v[0]?(h=[r,i].concat(v.slice(1)),r=h[6],i=h[7]):(h=[r,i,r,i,s,u,s,u],r=s,i=u);for(var m=0,y=e.length;m<y;m++){var _=e[m];if("M"===_[0])o=l=_[1],a=c=_[2];else{"C"===_[0]?(f=[o,a].concat(_.slice(1)),o=f[6],a=f[7]):(f=[o,a,o,a,l,c,l,c],o=l,a=c);for(var b=dr(h,f,n),x=0,w=b.length;x<w;x++)b[x].segment1=d,b[x].segment2=m,b[x].bez1=h,b[x].bez2=f;p=p.concat(b)}}}}return p}(t,e)};function vr(t,e){var n=[],r=[];return t.length&&function t(e,i){if(1===e.length)n.push(e[0]),r.push(e[0]);else{for(var o=[],a=0;a<e.length-1;a++)0===a&&n.push(e[0]),a===e.length-2&&r.push(e[a+1]),o[a]=[(1-i)*e[a][0]+i*e[a+1][0],(1-i)*e[a][1]+i*e[a+1][1]];t(o,i)}}(t,e),{left:n,right:r.reverse()}}var mr=function(t,e){if(1===t.length)return t;var n=t.length-1,r=e.length-1,i=n/r,o=[];if(1===t.length&&"M"===t[0][0]){for(var a=0;a<r-n;a++)t.push(t[0]);return t}for(a=0;a<r;a++){var s=Math.floor(i*a);o[s]=(o[s]||0)+1}var u=o.reduce((function(e,r,i){return i===n?e.concat(t[n]):e.concat(function(t,e,n){if(1===n)return[[].concat(t)];var r=[];if("L"===e[0]||"C"===e[0]||"Q"===e[0])r=r.concat(function(t,e,n){var r=[[t[1],t[2]]];n=n||2;var i=[];"A"===e[0]?(r.push(e[6]),r.push(e[7])):"C"===e[0]?(r.push([e[1],e[2]]),r.push([e[3],e[4]]),r.push([e[5],e[6]])):"S"===e[0]||"Q"===e[0]?(r.push([e[1],e[2]]),r.push([e[3],e[4]])):r.push([e[1],e[2]]);for(var o=r,a=1/n,s=0;s<n-1;s++){var u=vr(o,a/(1-a*s));i.push(u.left),o=u.right}return i.push(o),i.map((function(t){var e=[];return 4===t.length&&(e.push("C"),e=e.concat(t[2])),t.length>=3&&(3===t.length&&e.push("Q"),e=e.concat(t[1])),2===t.length&&e.push("L"),e.concat(t[t.length-1])}))}(t,e,n));else{var i=[].concat(t);"M"===i[0]&&(i[0]="L");for(var o=0;o<=n-1;o++)r.push(i)}return r}(t[i],t[i+1],r))}),[]);return u.unshift(t[0]),"Z"!==e[r]&&"z"!==e[r]||u.push("Z"),u},yr=function(t,e){if(t.length!==e.length)return!1;var n=!0;return(0,_.each)(t,(function(t,r){if(t!==e[r])return n=!1,!1})),n};function _r(t,e,n){var r=null,i=n;return e<i&&(i=e,r="add"),t<i&&(i=t,r="del"),{type:r,min:i}}var br=function(t,e){var n=function(t,e){var n,r,i=t.length,o=e.length,a=0;if(0===i||0===o)return null;for(var s=[],u=0;u<=i;u++)s[u]=[],s[u][0]={min:u};for(var l=0;l<=o;l++)s[0][l]={min:l};for(u=1;u<=i;u++)for(n=t[u-1],l=1;l<=o;l++){r=e[l-1],a=yr(n,r)?0:1;var c=s[u-1][l].min+1,h=s[u][l-1].min+1,f=s[u-1][l-1].min+a;s[u][l]=_r(c,h,f)}return s}(t,e),r=t.length,i=e.length,o=[],a=1,s=1;if(n[r][i].min!==r){for(var u=1;u<=r;u++){var l=n[u][u].min;s=u;for(var c=a;c<=i;c++)n[u][c].min<l&&(l=n[u][c].min,s=c);a=s,n[u][a].type&&o.push({index:u-1,type:n[u][a].type})}for(u=o.length-1;u>=0;u--)a=o[u].index,"add"===o[u].type?t.splice(a,0,[].concat(t[a])):t.splice(a,1)}var h=i-(r=t.length);if(r<i)for(u=0;u<h;u++)"z"===t[r-1][0]||"Z"===t[r-1][0]?t.splice(r-2,0,t[r-2]):t.push(t[r-1]),r+=1;return t};function xr(t,e,n){for(var r,i=[].concat(t),o=1/(n+1),a=wr(e)[0],s=1;s<=n;s++)o*=s,0===(r=Math.floor(t.length*o))?i.unshift([a[0]*o+t[r][0]*(1-o),a[1]*o+t[r][1]*(1-o)]):i.splice(r,0,[a[0]*o+t[r][0]*(1-o),a[1]*o+t[r][1]*(1-o)]);return i}function wr(t){var e=[];switch(t[0]){case"M":case"L":case"T":e.push([t[1],t[2]]);break;case"A":e.push([t[6],t[7]]);break;case"Q":case"S":e.push([t[3],t[4]]),e.push([t[1],t[2]]);break;case"C":e.push([t[5],t[6]]),e.push([t[1],t[2]]),e.push([t[3],t[4]]);break;case"H":case"V":e.push([t[1],t[1]])}return e}var Er=function(t,e){if(t.length<=1)return t;for(var n,r=0;r<e.length;r++)if(t[r][0]!==e[r][0])switch(n=wr(t[r]),e[r][0]){case"M":t[r]=["M"].concat(n[0]);break;case"L":t[r]=["L"].concat(n[0]);break;case"A":t[r]=[].concat(e[r]),t[r][6]=n[0][0],t[r][7]=n[0][1];break;case"Q":if(n.length<2){if(!(r>0)){t[r]=e[r];break}n=xr(n,t[r-1],1)}t[r]=["Q"].concat(n.reduce((function(t,e){return t.concat(e)}),[]));break;case"T":t[r]=["T"].concat(n[0]);break;case"C":if(n.length<3){if(!(r>0)){t[r]=e[r];break}n=xr(n,t[r-1],2)}t[r]=["C"].concat(n.reduce((function(t,e){return t.concat(e)}),[]));break;case"S":if(n.length<2){if(!(r>0)){t[r]=e[r];break}n=xr(n,t[r-1],1)}t[r]=["S"].concat(n.reduce((function(t,e){return t.concat(e)}),[]));break;default:t[r]=e[r]}return t};const Sr=function(){function t(t,e){this.bubbles=!0,this.target=null,this.currentTarget=null,this.delegateTarget=null,this.delegateObject=null,this.defaultPrevented=!1,this.propagationStopped=!1,this.shape=null,this.fromShape=null,this.toShape=null,this.propagationPath=[],this.type=t,this.name=t,this.originalEvent=e,this.timeStamp=e.timeStamp}return t.prototype.preventDefault=function(){this.defaultPrevented=!0,this.originalEvent.preventDefault&&this.originalEvent.preventDefault()},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t.prototype.toString=function(){return"[Event (type="+this.type+")]"},t.prototype.save=function(){},t.prototype.restore=function(){},t}();function Cr(t,e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}var Ar="undefined"!=typeof window&&void 0!==window.document;function Tr(t,e){if(t.isCanvas())return!0;for(var n=e.getParent(),r=!1;n;){if(n===t){r=!0;break}n=n.getParent()}return r}function kr(t){return t.cfg.visible&&t.cfg.capture}var Mr=function(t){function e(e){var n=t.call(this)||this;n.destroyed=!1;var r=n.getDefaultCfg();return n.cfg=(0,_.mix)(r,e),n}return(0,y.__extends)(e,t),e.prototype.getDefaultCfg=function(){return{}},e.prototype.get=function(t){return this.cfg[t]},e.prototype.set=function(t,e){this.cfg[t]=e},e.prototype.destroy=function(){this.cfg={destroyed:!0},this.off(),this.destroyed=!0},e}(C),Pr=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},Ir=function(t,e,n){this.name=t,this.version=e,this.os=n,this.type="browser"},Or=function(t){this.version=t,this.type="node",this.name="node",this.os=process.platform},Rr=function(t,e,n,r){this.name=t,this.version=e,this.os=n,this.bot=r,this.type="bot-device"},Lr=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},Dr=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},Nr=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Br=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],zr=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Fr(t){return t?Zr(t):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new Dr:"undefined"!=typeof navigator?Zr(navigator.userAgent):"undefined"!=typeof process&&process.version?new Or(process.version.slice(1)):null}function Zr(t){var e=function(t){return""!==t&&Br.reduce((function(e,n){var r=n[0],i=n[1];if(e)return e;var o=i.exec(t);return!!o&&[r,o]}),!1)}(t);if(!e)return null;var n=e[0],r=e[1];if("searchbot"===n)return new Lr;var i=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);i?i.length<3&&(i=Pr(Pr([],i,!0),function(t){for(var e=[],n=0;n<t;n++)e.push("0");return e}(3-i.length),!0)):i=[];var o=i.join("."),a=function(t){for(var e=0,n=zr.length;e<n;e++){var r=zr[e],i=r[0];if(r[1].exec(t))return i}return null}(t),s=Nr.exec(t);return s&&s[1]?new Rr(n,o,a,s[1]):new Ir(n,o,a)}function jr(t,e){var n=[],r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=e[0],p=e[1],d=e[2],g=e[3],v=e[4],m=e[5],y=e[6],_=e[7],b=e[8];return n[0]=f*r+p*a+d*l,n[1]=f*i+p*s+d*c,n[2]=f*o+p*u+d*h,n[3]=g*r+v*a+m*l,n[4]=g*i+v*s+m*c,n[5]=g*o+v*u+m*h,n[6]=y*r+_*a+b*l,n[7]=y*i+_*s+b*c,n[8]=y*o+_*u+b*h,n}function Ur(t,e){var n=[],r=e[0],i=e[1];return n[0]=t[0]*r+t[3]*i+t[6],n[1]=t[1]*r+t[4]*i+t[7],n}function Gr(t){var e=[],n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=c*a-s*l,f=-c*o+s*u,p=l*o-a*u,d=n*h+r*f+i*p;return d?(d=1/d,e[0]=h*d,e[1]=(-c*r+i*l)*d,e[2]=(s*r-i*a)*d,e[3]=f*d,e[4]=(c*n-i*u)*d,e[5]=(-s*n+i*o)*d,e[6]=p*d,e[7]=(-l*n+r*u)*d,e[8]=(a*n-r*o)*d,e):null}var Vr=ut,Wr="matrix",Hr=["zIndex","capture","visible","type"],Xr=["repeat"];function Yr(t,e){var n={},r=e.attrs;for(var i in t)n[i]=r[i];return n}function qr(t,e){var n={},r=e.attr();return(0,_.each)(t,(function(t,e){-1!==Xr.indexOf(e)||(0,_.isEqual)(r[e],t)||(n[e]=t)})),n}function Kr(t,e){if(e.onFrame)return t;var n=e.startTime,r=e.delay,i=e.duration,o=Object.prototype.hasOwnProperty;return(0,_.each)(t,(function(t){n+r<t.startTime+t.delay+t.duration&&i>t.delay&&(0,_.each)(e.toAttrs,(function(e,n){o.call(t.toAttrs,n)&&(delete t.toAttrs[n],delete t.fromAttrs[n])}))})),t}var Qr=function(t){function e(e){var n=t.call(this,e)||this;n.attrs={};var r=n.getDefaultAttrs();return(0,_.mix)(r,e.attrs),n.attrs=r,n.initAttrs(r),n.initAnimate(),n}return(0,y.__extends)(e,t),e.prototype.getDefaultCfg=function(){return{visible:!0,capture:!0,zIndex:0}},e.prototype.getDefaultAttrs=function(){return{matrix:this.getDefaultMatrix(),opacity:1}},e.prototype.onCanvasChange=function(t){},e.prototype.initAttrs=function(t){},e.prototype.initAnimate=function(){this.set("animable",!0),this.set("animating",!1)},e.prototype.isGroup=function(){return!1},e.prototype.getParent=function(){return this.get("parent")},e.prototype.getCanvas=function(){return this.get("canvas")},e.prototype.attr=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e[0],i=e[1];if(!r)return this.attrs;if((0,_.isObject)(r)){for(var o in r)this.setAttr(o,r[o]);return this.afterAttrsChange(r),this}return 2===e.length?(this.setAttr(r,i),this.afterAttrsChange(((t={})[r]=i,t)),this):this.attrs[r]},e.prototype.isClipped=function(t,e){var n=this.getClip();return n&&!n.isHit(t,e)},e.prototype.setAttr=function(t,e){var n=this.attrs[t];n!==e&&(this.attrs[t]=e,this.onAttrChange(t,e,n))},e.prototype.onAttrChange=function(t,e,n){"matrix"===t&&this.set("totalMatrix",null)},e.prototype.afterAttrsChange=function(t){if(this.cfg.isClipShape){var e=this.cfg.applyTo;e&&e.onCanvasChange("clip")}else this.onCanvasChange("attr")},e.prototype.show=function(){return this.set("visible",!0),this.onCanvasChange("show"),this},e.prototype.hide=function(){return this.set("visible",!1),this.onCanvasChange("hide"),this},e.prototype.setZIndex=function(t){this.set("zIndex",t);var e=this.getParent();return e&&e.sort(),this},e.prototype.toFront=function(){var t=this.getParent();if(t){var e=t.getChildren(),n=(this.get("el"),e.indexOf(this));e.splice(n,1),e.push(this),this.onCanvasChange("zIndex")}},e.prototype.toBack=function(){var t=this.getParent();if(t){var e=t.getChildren(),n=(this.get("el"),e.indexOf(this));e.splice(n,1),e.unshift(this),this.onCanvasChange("zIndex")}},e.prototype.remove=function(t){void 0===t&&(t=!0);var e=this.getParent();e?(Cr(e.getChildren(),this),e.get("clearing")||this.onCanvasChange("remove")):this.onCanvasChange("remove"),t&&this.destroy()},e.prototype.resetMatrix=function(){this.attr(Wr,this.getDefaultMatrix()),this.onCanvasChange("matrix")},e.prototype.getMatrix=function(){return this.attr(Wr)},e.prototype.setMatrix=function(t){this.attr(Wr,t),this.onCanvasChange("matrix")},e.prototype.getTotalMatrix=function(){var t=this.cfg.totalMatrix;if(!t){var e=this.attr("matrix"),n=this.cfg.parentMatrix;t=n&&e?jr(n,e):e||n,this.set("totalMatrix",t)}return t},e.prototype.applyMatrix=function(t){var e,n=this.attr("matrix");e=t&&n?jr(t,n):n||t,this.set("totalMatrix",e),this.set("parentMatrix",t)},e.prototype.getDefaultMatrix=function(){return null},e.prototype.applyToMatrix=function(t){var e=this.attr("matrix");return e?Ur(e,t):t},e.prototype.invertFromMatrix=function(t){var e=this.attr("matrix");if(e){var n=Gr(e);if(n)return Ur(n,t)}return t},e.prototype.setClip=function(t){var e=this.getCanvas(),n=null;if(t){var r=this.getShapeBase()[(0,_.upperFirst)(t.type)];r&&(n=new r({type:t.type,isClipShape:!0,applyTo:this,attrs:t.attrs,canvas:e}))}return this.set("clipShape",n),this.onCanvasChange("clip"),n},e.prototype.getClip=function(){return this.cfg.clipShape||null},e.prototype.clone=function(){var t=this,e=this.attrs,n={};(0,_.each)(e,(function(t,r){(0,_.isArray)(e[r])?n[r]=function(t){for(var e=[],n=0;n<t.length;n++)(0,_.isArray)(t[n])?e.push([].concat(t[n])):e.push(t[n]);return e}(e[r]):n[r]=e[r]}));var r=new(0,this.constructor)({attrs:n});return(0,_.each)(Hr,(function(e){r.set(e,t.get(e))})),r},e.prototype.destroy=function(){this.destroyed||(this.attrs={},t.prototype.destroy.call(this))},e.prototype.isAnimatePaused=function(){return this.get("_pause").isPaused},e.prototype.animate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.get("timeline")||this.get("canvas")){this.set("animating",!0);var n=this.get("timeline");n||(n=this.get("canvas").get("timeline"),this.set("timeline",n));var r=this.get("animations")||[];n.timer||n.initTimer();var i,o,a,s,u,l=t[0],c=t[1],h=t[2],f=void 0===h?"easeLinear":h,p=t[3],d=void 0===p?_.noop:p,g=t[4],v=void 0===g?0:g;(0,_.isFunction)(l)?(i=l,l={}):(0,_.isObject)(l)&&l.onFrame&&(i=l.onFrame,o=l.repeat),(0,_.isObject)(c)?(c=(u=c).duration,f=u.easing||"easeLinear",v=u.delay||0,o=u.repeat||o||!1,d=u.callback||_.noop,a=u.pauseCallback||_.noop,s=u.resumeCallback||_.noop):((0,_.isNumber)(d)&&(v=d,d=null),(0,_.isFunction)(f)?(d=f,f="easeLinear"):f=f||"easeLinear");var m=qr(l,this),y={fromAttrs:Yr(m,this),toAttrs:m,duration:c,easing:f,repeat:o,callback:d,pauseCallback:a,resumeCallback:s,delay:v,startTime:n.getTime(),id:(0,_.uniqueId)(),onFrame:i,pathFormatted:!1};r.length>0?r=Kr(r,y):n.addAnimator(this),r.push(y),this.set("animations",r),this.set("_pause",{isPaused:!1})}},e.prototype.stopAnimate=function(t){var e=this;void 0===t&&(t=!0);var n=this.get("animations");(0,_.each)(n,(function(n){t&&(n.onFrame?e.attr(n.onFrame(1)):e.attr(n.toAttrs)),n.callback&&n.callback()})),this.set("animating",!1),this.set("animations",[])},e.prototype.pauseAnimate=function(){var t=this.get("timeline"),e=this.get("animations"),n=t.getTime();return(0,_.each)(e,(function(t){t._paused=!0,t._pauseTime=n,t.pauseCallback&&t.pauseCallback()})),this.set("_pause",{isPaused:!0,pauseTime:n}),this},e.prototype.resumeAnimate=function(){var t=this.get("timeline").getTime(),e=this.get("animations"),n=this.get("_pause").pauseTime;return(0,_.each)(e,(function(e){e.startTime=e.startTime+(t-n),e._paused=!1,e._pauseTime=null,e.resumeCallback&&e.resumeCallback()})),this.set("_pause",{isPaused:!1}),this.set("animations",e),this},e.prototype.emitDelegation=function(t,e){var n,r=this,i=e.propagationPath;this.getEvents(),"mouseenter"===t?n=e.fromShape:"mouseleave"===t&&(n=e.toShape);for(var o=function(t){var o=i[t],s=o.get("name");if(s){if((o.isGroup()||o.isCanvas&&o.isCanvas())&&n&&Tr(o,n))return"break";(0,_.isArray)(s)?(0,_.each)(s,(function(t){r.emitDelegateEvent(o,t,e)})):a.emitDelegateEvent(o,s,e)}},a=this,s=0;s<i.length&&"break"!==o(s);s++);},e.prototype.emitDelegateEvent=function(t,e,n){var r=this.getEvents(),i=e+":"+n.type;(r[i]||r["*"])&&(n.name=i,n.currentTarget=t,n.delegateTarget=this,n.delegateObject=t.get("delegateObject"),this.emit(i,n))},e.prototype.translate=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var n=this.getMatrix(),r=Vr(n,[["t",t,e]]);return this.setMatrix(r),this},e.prototype.move=function(t,e){var n=this.attr("x")||0,r=this.attr("y")||0;return this.translate(t-n,e-r),this},e.prototype.moveTo=function(t,e){return this.move(t,e)},e.prototype.scale=function(t,e){var n=this.getMatrix(),r=Vr(n,[["s",t,e||t]]);return this.setMatrix(r),this},e.prototype.rotate=function(t){var e=this.getMatrix(),n=Vr(e,[["r",t]]);return this.setMatrix(n),this},e.prototype.rotateAtStart=function(t){var e=this.attr(),n=e.x,r=e.y,i=this.getMatrix(),o=Vr(i,[["t",-n,-r],["r",t],["t",n,r]]);return this.setMatrix(o),this},e.prototype.rotateAtPoint=function(t,e,n){var r=this.getMatrix(),i=Vr(r,[["t",-t,-e],["r",n],["t",t,e]]);return this.setMatrix(i),this},e}(Mr);const Jr=Qr;var $r={};function ti(t,e){if(t.set("canvas",e),t.isGroup()){var n=t.get("children");n.length&&n.forEach((function(t){ti(t,e)}))}}function ei(t,e){if(t.set("timeline",e),t.isGroup()){var n=t.get("children");n.length&&n.forEach((function(t){ei(t,e)}))}}var ni=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.isCanvas=function(){return!1},e.prototype.getBBox=function(){var t=1/0,e=-1/0,n=1/0,r=-1/0,i=[],o=[],a=this.getChildren().filter((function(t){return t.get("visible")&&(!t.isGroup()||t.isGroup()&&t.getChildren().length>0)}));return a.length>0?((0,_.each)(a,(function(t){var e=t.getBBox();i.push(e.minX,e.maxX),o.push(e.minY,e.maxY)})),t=(0,_.min)(i),e=(0,_.max)(i),n=(0,_.min)(o),r=(0,_.max)(o)):(t=0,e=0,n=0,r=0),{x:t,y:n,minX:t,minY:n,maxX:e,maxY:r,width:e-t,height:r-n}},e.prototype.getCanvasBBox=function(){var t=1/0,e=-1/0,n=1/0,r=-1/0,i=[],o=[],a=this.getChildren().filter((function(t){return t.get("visible")&&(!t.isGroup()||t.isGroup()&&t.getChildren().length>0)}));return a.length>0?((0,_.each)(a,(function(t){var e=t.getCanvasBBox();i.push(e.minX,e.maxX),o.push(e.minY,e.maxY)})),t=(0,_.min)(i),e=(0,_.max)(i),n=(0,_.min)(o),r=(0,_.max)(o)):(t=0,e=0,n=0,r=0),{x:t,y:n,minX:t,minY:n,maxX:e,maxY:r,width:e-t,height:r-n}},e.prototype.getDefaultCfg=function(){var e=t.prototype.getDefaultCfg.call(this);return e.children=[],e},e.prototype.onAttrChange=function(e,n,r){if(t.prototype.onAttrChange.call(this,e,n,r),"matrix"===e){var i=this.getTotalMatrix();this._applyChildrenMarix(i)}},e.prototype.applyMatrix=function(e){var n=this.getTotalMatrix();t.prototype.applyMatrix.call(this,e);var r=this.getTotalMatrix();r!==n&&this._applyChildrenMarix(r)},e.prototype._applyChildrenMarix=function(t){var e=this.getChildren();(0,_.each)(e,(function(e){e.applyMatrix(t)}))},e.prototype.addShape=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[0],r=t[1];(0,_.isObject)(n)?r=n:r.type=n;var i=$r[r.type];i||(i=(0,_.upperFirst)(r.type),$r[r.type]=i);var o=this.getShapeBase(),a=new o[i](r);return this.add(a),a},e.prototype.addGroup=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n,r=t[0],i=t[1];if((0,_.isFunction)(r))n=new r(i||{parent:this});else{var o=r||{},a=this.getGroupBase();n=new a(o)}return this.add(n),n},e.prototype.getCanvas=function(){return this.isCanvas()?this:this.get("canvas")},e.prototype.getShape=function(t,e,n){if(!kr(this))return null;var r,i=this.getChildren();if(this.isCanvas())r=this._findShape(i,t,e,n);else{var o=[t,e,1];o=this.invertFromMatrix(o),this.isClipped(o[0],o[1])||(r=this._findShape(i,o[0],o[1],n))}return r},e.prototype._findShape=function(t,e,n,r){for(var i=null,o=t.length-1;o>=0;o--){var a=t[o];if(kr(a)&&(a.isGroup()?i=a.getShape(e,n,r):a.isHit(e,n)&&(i=a)),i)break}return i},e.prototype.add=function(t){var e=this.getCanvas(),n=this.getChildren(),r=this.get("timeline"),i=t.getParent();i&&function(t,e,n){void 0===n&&(n=!0),n?e.destroy():(e.set("parent",null),e.set("canvas",null)),Cr(t.getChildren(),e)}(i,t,!1),t.set("parent",this),e&&ti(t,e),r&&ei(t,r),n.push(t),t.onCanvasChange("add"),this._applyElementMatrix(t)},e.prototype._applyElementMatrix=function(t){var e=this.getTotalMatrix();e&&t.applyMatrix(e)},e.prototype.getChildren=function(){return this.get("children")},e.prototype.sort=function(){var t=this.getChildren();(0,_.each)(t,(function(t,e){return t._INDEX=e,t})),t.sort((function(t,e){var n,r=(n=e,t.get("zIndex")-n.get("zIndex"));return 0===r?t._INDEX-e._INDEX:r})),this.onCanvasChange("sort")},e.prototype.clear=function(){if(this.set("clearing",!0),!this.destroyed){for(var t=this.getChildren(),e=t.length-1;e>=0;e--)t[e].destroy();this.set("children",[]),this.onCanvasChange("clear"),this.set("clearing",!1)}},e.prototype.destroy=function(){this.get("destroyed")||(this.clear(),t.prototype.destroy.call(this))},e.prototype.getFirst=function(){return this.getChildByIndex(0)},e.prototype.getLast=function(){var t=this.getChildren();return this.getChildByIndex(t.length-1)},e.prototype.getChildByIndex=function(t){return this.getChildren()[t]},e.prototype.getCount=function(){return this.getChildren().length},e.prototype.contain=function(t){return this.getChildren().indexOf(t)>-1},e.prototype.removeChild=function(t,e){void 0===e&&(e=!0),this.contain(t)&&t.remove(e)},e.prototype.findAll=function(t){var e=[],n=this.getChildren();return(0,_.each)(n,(function(n){t(n)&&e.push(n),n.isGroup()&&(e=e.concat(n.findAll(t)))})),e},e.prototype.find=function(t){var e=null,n=this.getChildren();return(0,_.each)(n,(function(n){if(t(n)?e=n:n.isGroup()&&(e=n.find(t)),e)return!1})),e},e.prototype.findById=function(t){return this.find((function(e){return e.get("id")===t}))},e.prototype.findByClassName=function(t){return this.find((function(e){return e.get("className")===t}))},e.prototype.findAllByName=function(t){return this.findAll((function(e){return e.get("name")===t}))},e}(Jr);const ri=ni;var ii,oi,ai=0,si=0,ui=0,li=0,ci=0,hi=0,fi="object"==typeof performance&&performance.now?performance:Date,pi="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function di(){return ci||(pi(gi),ci=fi.now()+hi)}function gi(){ci=0}function vi(){this._call=this._time=this._next=null}function mi(t,e,n){var r=new vi;return r.restart(t,e,n),r}function yi(){ci=(li=fi.now())+hi,ai=si=0;try{!function(){di(),++ai;for(var t,e=ii;e;)(t=ci-e._time)>=0&&e._call.call(null,t),e=e._next;--ai}()}finally{ai=0,function(){for(var t,e,n=ii,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:ii=e);oi=t,bi(r)}(),ci=0}}function _i(){var t=fi.now(),e=t-li;e>1e3&&(hi-=e,li=t)}function bi(t){ai||(si&&(si=clearTimeout(si)),t-ci>24?(t<1/0&&(si=setTimeout(yi,t-fi.now()-hi)),ui&&(ui=clearInterval(ui))):(ui||(li=fi.now(),ui=setInterval(_i,1e3)),ai=1,pi(yi)))}function xi(t){return+t}function wi(t){return t*t}function Ei(t){return t*(2-t)}function Si(t){return((t*=2)<=1?t*t:--t*(2-t)+1)/2}function Ci(t){return t*t*t}function Ai(t){return--t*t*t+1}function Ti(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}vi.prototype=mi.prototype={constructor:vi,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?di():+n)+(null==e?0:+e),this._next||oi===this||(oi?oi._next=this:ii=this,oi=this),this._call=t,this._time=n,bi()},stop:function(){this._call&&(this._call=null,this._time=1/0,bi())}};var ki=function t(e){function n(t){return Math.pow(t,e)}return e=+e,n.exponent=t,n}(3),Mi=function t(e){function n(t){return 1-Math.pow(1-t,e)}return e=+e,n.exponent=t,n}(3),Pi=function t(e){function n(t){return((t*=2)<=1?Math.pow(t,e):2-Math.pow(2-t,e))/2}return e=+e,n.exponent=t,n}(3),Ii=Math.PI,Oi=Ii/2;function Ri(t){return 1==+t?1:1-Math.cos(t*Oi)}function Li(t){return Math.sin(t*Oi)}function Di(t){return(1-Math.cos(Ii*t))/2}function Ni(t){return 1.0009775171065494*(Math.pow(2,-10*t)-.0009765625)}function Bi(t){return Ni(1-+t)}function zi(t){return 1-Ni(t)}function Fi(t){return((t*=2)<=1?Ni(1-t):2-Ni(t-1))/2}function Zi(t){return 1-Math.sqrt(1-t*t)}function ji(t){return Math.sqrt(1- --t*t)}function Ui(t){return((t*=2)<=1?1-Math.sqrt(1-t*t):Math.sqrt(1-(t-=2)*t)+1)/2}var Gi=7.5625;function Vi(t){return 1-Wi(1-t)}function Wi(t){return(t=+t)<.36363636363636365?Gi*t*t:t<.7272727272727273?Gi*(t-=.5454545454545454)*t+.75:t<.9090909090909091?Gi*(t-=.8181818181818182)*t+.9375:Gi*(t-=.9545454545454546)*t+.984375}function Hi(t){return((t*=2)<=1?1-Wi(1-t):Wi(t-1)+1)/2}var Xi=1.70158,Yi=function t(e){function n(t){return(t=+t)*t*(e*(t-1)+t)}return e=+e,n.overshoot=t,n}(Xi),qi=function t(e){function n(t){return--t*t*((t+1)*e+t)+1}return e=+e,n.overshoot=t,n}(Xi),Ki=function t(e){function n(t){return((t*=2)<1?t*t*((e+1)*t-e):(t-=2)*t*((e+1)*t+e)+2)/2}return e=+e,n.overshoot=t,n}(Xi),Qi=2*Math.PI,Ji=function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=Qi);function i(t){return e*Ni(- --t)*Math.sin((r-t)/n)}return i.amplitude=function(e){return t(e,n*Qi)},i.period=function(n){return t(e,n)},i}(1,.3),$i=function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=Qi);function i(t){return 1-e*Ni(t=+t)*Math.sin((t+r)/n)}return i.amplitude=function(e){return t(e,n*Qi)},i.period=function(n){return t(e,n)},i}(1,.3),to=function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=Qi);function i(t){return((t=2*t-1)<0?e*Ni(-t)*Math.sin((r-t)/n):2-e*Ni(t)*Math.sin((r+t)/n))/2}return i.amplitude=function(e){return t(e,n*Qi)},i.period=function(n){return t(e,n)},i}(1,.3),eo=n(6257),no=n(8122),ro=[1,0,0,0,1,0,0,0,1];function io(t,e,n){var r,i=e.startTime;if(n<i+e.delay||e._paused)return!1;var o=e.duration,a=e.easing;if(n=n-i-e.delay,e.repeat)r=n%o/o,r=u[a](r);else{if(!((r=n/o)<1))return e.onFrame?t.attr(e.onFrame(1)):t.attr(e.toAttrs),!0;r=u[a](r)}if(e.onFrame){var s=e.onFrame(r);t.attr(s)}else!function(t,e,n){var r={},i=e.fromAttrs,o=e.toAttrs;if(!t.destroyed){var a,s;for(var u in o)if(!(0,_.isEqual)(i[u],o[u]))if("path"===u){var l=o[u],c=i[u];l.length>c.length?(l=qn(o[u]),c=qn(i[u]),c=br(c,l),c=Er(c,l),e.fromAttrs.path=c,e.toAttrs.path=l):e.pathFormatted||(l=qn(o[u]),c=qn(i[u]),c=Er(c,l),e.fromAttrs.path=c,e.toAttrs.path=l,e.pathFormatted=!0),r[u]=[];for(var h=0;h<l.length;h++){for(var f=l[h],p=c[h],d=[],g=0;g<f.length;g++)(0,_.isNumber)(f[g])&&p&&(0,_.isNumber)(p[g])?(a=(0,eo.Z)(p[g],f[g]),d.push(a(n))):d.push(f[g]);r[u].push(d)}}else if("matrix"===u){var v=(0,no.Z)(i[u]||ro,o[u]||ro)(n);r[u]=v}else["fill","stroke","fillStyle","strokeStyle"].includes(u)&&(s=o[u],/^[r,R,L,l]{1}[\s]*\(/.test(s))?r[u]=o[u]:(0,_.isFunction)(o[u])||(a=(0,eo.Z)(i[u],o[u]),r[u]=a(n));t.attr(r)}}(t,e,r);return!1}var oo=function(){function t(t){this.animators=[],this.current=0,this.timer=null,this.canvas=t}return t.prototype.initTimer=function(){var t,e,n,r=this;this.timer=mi((function(i){if(r.current=i,r.animators.length>0){for(var o=r.animators.length-1;o>=0;o--)if((t=r.animators[o]).destroyed)r.removeAnimator(o);else{if(!t.isAnimatePaused())for(var a=(e=t.get("animations")).length-1;a>=0;a--)n=e[a],io(t,n,i)&&(e.splice(a,1),n.callback&&n.callback());0===e.length&&r.removeAnimator(o)}r.canvas.get("autoDraw")||r.canvas.draw()}}))},t.prototype.addAnimator=function(t){this.animators.push(t)},t.prototype.removeAnimator=function(t){this.animators.splice(t,1)},t.prototype.isAnimating=function(){return!!this.animators.length},t.prototype.stop=function(){this.timer&&this.timer.stop()},t.prototype.stopAllAnimations=function(t){void 0===t&&(t=!0),this.animators.forEach((function(e){e.stopAnimate(t)})),this.animators=[],this.canvas.draw()},t.prototype.getTime=function(){return this.current},t}();const ao=oo;var so=["mousedown","mouseup","dblclick","mouseout","mouseover","mousemove","mouseleave","mouseenter","touchstart","touchmove","touchend","dragenter","dragover","dragleave","drop","contextmenu","mousewheel"];function uo(t,e,n){n.name=e,n.target=t,n.currentTarget=t,n.delegateTarget=t,t.emit(e,n)}function lo(t,e,n){if(n.bubbles){var r=void 0,i=!1;if("mouseenter"===e?(r=n.fromShape,i=!0):"mouseleave"===e&&(i=!0,r=n.toShape),t.isCanvas()&&i)return;if(r&&Tr(t,r))return void(n.bubbles=!1);n.name=e,n.currentTarget=t,n.delegateTarget=t,t.emit(e,n)}}var co=function(){function t(t){var e=this;this.draggingShape=null,this.dragging=!1,this.currentShape=null,this.mousedownShape=null,this.mousedownPoint=null,this._eventCallback=function(t){var n=t.type;e._triggerEvent(n,t)},this._onDocumentMove=function(t){if(e.canvas.get("el")!==t.target&&(e.dragging||e.currentShape)){var n=e._getPointInfo(t);e.dragging&&e._emitEvent("drag",t,n,e.draggingShape)}},this._onDocumentMouseUp=function(t){if(e.canvas.get("el")!==t.target&&e.dragging){var n=e._getPointInfo(t);e.draggingShape&&e._emitEvent("drop",t,n,null),e._emitEvent("dragend",t,n,e.draggingShape),e._afterDrag(e.draggingShape,n,t)}},this.canvas=t.canvas}return t.prototype.init=function(){this._bindEvents()},t.prototype._bindEvents=function(){var t=this,e=this.canvas.get("el");(0,_.each)(so,(function(n){e.addEventListener(n,t._eventCallback)})),document&&(document.addEventListener("mousemove",this._onDocumentMove),document.addEventListener("mouseup",this._onDocumentMouseUp))},t.prototype._clearEvents=function(){var t=this,e=this.canvas.get("el");(0,_.each)(so,(function(n){e.removeEventListener(n,t._eventCallback)})),document&&(document.removeEventListener("mousemove",this._onDocumentMove),document.removeEventListener("mouseup",this._onDocumentMouseUp))},t.prototype._getEventObj=function(t,e,n,r,i,o){var a=new Sr(t,e);return a.fromShape=i,a.toShape=o,a.x=n.x,a.y=n.y,a.clientX=n.clientX,a.clientY=n.clientY,a.propagationPath.push(r),a},t.prototype._getShape=function(t,e){return this.canvas.getShape(t.x,t.y,e)},t.prototype._getPointInfo=function(t){var e=this.canvas,n=e.getClientByEvent(t),r=e.getPointByEvent(t);return{x:r.x,y:r.y,clientX:n.x,clientY:n.y}},t.prototype._triggerEvent=function(t,e){var n=this._getPointInfo(e),r=this._getShape(n,e),i=this["_on"+t],o=!1;if(i)i.call(this,n,r,e);else{var a=this.currentShape;"mouseenter"===t||"dragenter"===t||"mouseover"===t?(this._emitEvent(t,e,n,null,null,r),r&&this._emitEvent(t,e,n,r,null,r),"mouseenter"===t&&this.draggingShape&&this._emitEvent("dragenter",e,n,null)):"mouseleave"===t||"dragleave"===t||"mouseout"===t?(o=!0,a&&this._emitEvent(t,e,n,a,a,null),this._emitEvent(t,e,n,null,a,null),"mouseleave"===t&&this.draggingShape&&this._emitEvent("dragleave",e,n,null)):this._emitEvent(t,e,n,r,null,null)}if(o||(this.currentShape=r),r&&!r.get("destroyed")){var s=this.canvas;s.get("el").style.cursor=r.attr("cursor")||s.get("cursor")}},t.prototype._onmousedown=function(t,e,n){0===n.button&&(this.mousedownShape=e,this.mousedownPoint=t,this.mousedownTimeStamp=n.timeStamp),this._emitEvent("mousedown",n,t,e,null,null)},t.prototype._emitMouseoverEvents=function(t,e,n,r){var i=this.canvas.get("el");n!==r&&(n&&(this._emitEvent("mouseout",t,e,n,n,r),this._emitEvent("mouseleave",t,e,n,n,r),r&&!r.get("destroyed")||(i.style.cursor=this.canvas.get("cursor"))),r&&(this._emitEvent("mouseover",t,e,r,n,r),this._emitEvent("mouseenter",t,e,r,n,r)))},t.prototype._emitDragoverEvents=function(t,e,n,r,i){r?(r!==n&&(n&&this._emitEvent("dragleave",t,e,n,n,r),this._emitEvent("dragenter",t,e,r,n,r)),i||this._emitEvent("dragover",t,e,r)):n&&this._emitEvent("dragleave",t,e,n,n,r),i&&this._emitEvent("dragover",t,e,r)},t.prototype._afterDrag=function(t,e,n){t&&(t.set("capture",!0),this.draggingShape=null),this.dragging=!1;var r=this._getShape(e,n);r!==t&&this._emitMouseoverEvents(n,e,t,r),this.currentShape=r},t.prototype._onmouseup=function(t,e,n){if(0===n.button){var r=this.draggingShape;this.dragging?(r&&this._emitEvent("drop",n,t,e),this._emitEvent("dragend",n,t,r),this._afterDrag(r,t,n)):(this._emitEvent("mouseup",n,t,e),e===this.mousedownShape&&this._emitEvent("click",n,t,e),this.mousedownShape=null,this.mousedownPoint=null)}},t.prototype._ondragover=function(t,e,n){n.preventDefault();var r=this.currentShape;this._emitDragoverEvents(n,t,r,e,!0)},t.prototype._onmousemove=function(t,e,n){var r=this.canvas,i=this.currentShape,o=this.draggingShape;if(this.dragging)o&&this._emitDragoverEvents(n,t,i,e,!1),this._emitEvent("drag",n,t,o);else{var a=this.mousedownPoint;if(a){var s=this.mousedownShape,u=n.timeStamp-this.mousedownTimeStamp,l=a.clientX-t.clientX,c=a.clientY-t.clientY;u>120||l*l+c*c>40?s&&s.get("draggable")?((o=this.mousedownShape).set("capture",!1),this.draggingShape=o,this.dragging=!0,this._emitEvent("dragstart",n,t,o),this.mousedownShape=null,this.mousedownPoint=null):!s&&r.get("draggable")?(this.dragging=!0,this._emitEvent("dragstart",n,t,null),this.mousedownShape=null,this.mousedownPoint=null):(this._emitMouseoverEvents(n,t,i,e),this._emitEvent("mousemove",n,t,e)):(this._emitMouseoverEvents(n,t,i,e),this._emitEvent("mousemove",n,t,e))}else this._emitMouseoverEvents(n,t,i,e),this._emitEvent("mousemove",n,t,e)}},t.prototype._emitEvent=function(t,e,n,r,i,o){var a=this._getEventObj(t,e,n,r,i,o);if(r){a.shape=r,uo(r,t,a);for(var s=r.getParent();s;)s.emitDelegation(t,a),a.propagationStopped||lo(s,t,a),a.propagationPath.push(s),s=s.getParent()}else uo(this.canvas,t,a)},t.prototype.destroy=function(){this._clearEvents(),this.canvas=null,this.currentShape=null,this.draggingShape=null,this.mousedownPoint=null,this.mousedownShape=null,this.mousedownTimeStamp=null},t}();const ho=co;var fo=Fr(),po=fo&&"firefox"===fo.name,go=function(t){function e(e){var n=t.call(this,e)||this;return n.initContainer(),n.initDom(),n.initEvents(),n.initTimeline(),n}return(0,y.__extends)(e,t),e.prototype.getDefaultCfg=function(){var e=t.prototype.getDefaultCfg.call(this);return e.cursor="default",e.supportCSSTransform=!1,e},e.prototype.initContainer=function(){var t=this.get("container");(0,_.isString)(t)&&(t=document.getElementById(t),this.set("container",t))},e.prototype.initDom=function(){var t=this.createDom();this.set("el",t),this.get("container").appendChild(t),this.setDOMSize(this.get("width"),this.get("height"))},e.prototype.initEvents=function(){var t=new ho({canvas:this});t.init(),this.set("eventController",t)},e.prototype.initTimeline=function(){var t=new ao(this);this.set("timeline",t)},e.prototype.setDOMSize=function(t,e){var n=this.get("el");Ar&&(n.style.width=t+"px",n.style.height=e+"px")},e.prototype.changeSize=function(t,e){this.setDOMSize(t,e),this.set("width",t),this.set("height",e),this.onCanvasChange("changeSize")},e.prototype.getRenderer=function(){return this.get("renderer")},e.prototype.getCursor=function(){return this.get("cursor")},e.prototype.setCursor=function(t){this.set("cursor",t);var e=this.get("el");Ar&&e&&(e.style.cursor=t)},e.prototype.getPointByEvent=function(t){if(this.get("supportCSSTransform")){if(po&&!(0,_.isNil)(t.layerX)&&t.layerX!==t.offsetX)return{x:t.layerX,y:t.layerY};if(!(0,_.isNil)(t.offsetX))return{x:t.offsetX,y:t.offsetY}}var e=this.getClientByEvent(t),n=e.x,r=e.y;return this.getPointByClient(n,r)},e.prototype.getClientByEvent=function(t){var e=t;return t.touches&&(e="touchend"===t.type?t.changedTouches[0]:t.touches[0]),{x:e.clientX,y:e.clientY}},e.prototype.getPointByClient=function(t,e){var n=this.get("el").getBoundingClientRect();return{x:t-n.left,y:e-n.top}},e.prototype.getClientByPoint=function(t,e){var n=this.get("el").getBoundingClientRect();return{x:t+n.left,y:e+n.top}},e.prototype.draw=function(){},e.prototype.removeDom=function(){var t=this.get("el");t.parentNode.removeChild(t)},e.prototype.clearEvents=function(){this.get("eventController").destroy()},e.prototype.isCanvas=function(){return!0},e.prototype.getParent=function(){return null},e.prototype.destroy=function(){var e=this.get("timeline");this.get("destroyed")||(this.clear(),e&&e.stop(),this.clearEvents(),this.removeDom(),t.prototype.destroy.call(this))},e}(ri);const vo=go;var mo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.isGroup=function(){return!0},e.prototype.isEntityGroup=function(){return!1},e.prototype.clone=function(){for(var e=t.prototype.clone.call(this),n=this.getChildren(),r=0;r<n.length;r++){var i=n[r];e.add(i.clone())}return e},e}(ri);const yo=mo;const _o=function(t){function e(e){return t.call(this,e)||this}return(0,y.__extends)(e,t),e.prototype._isInBBox=function(t,e){var n=this.getBBox();return n.minX<=t&&n.maxX>=t&&n.minY<=e&&n.maxY>=e},e.prototype.afterAttrsChange=function(e){t.prototype.afterAttrsChange.call(this,e),this.clearCacheBBox()},e.prototype.getBBox=function(){var t=this.cfg.bbox;return t||(t=this.calculateBBox(),this.set("bbox",t)),t},e.prototype.getCanvasBBox=function(){var t=this.cfg.canvasBBox;return t||(t=this.calculateCanvasBBox(),this.set("canvasBBox",t)),t},e.prototype.applyMatrix=function(e){t.prototype.applyMatrix.call(this,e),this.set("canvasBBox",null)},e.prototype.calculateCanvasBBox=function(){var t=this.getBBox(),e=this.getTotalMatrix(),n=t.minX,r=t.minY,i=t.maxX,o=t.maxY;if(e){var a=Ur(e,[t.minX,t.minY]),s=Ur(e,[t.maxX,t.minY]),u=Ur(e,[t.minX,t.maxY]),l=Ur(e,[t.maxX,t.maxY]);n=Math.min(a[0],s[0],u[0],l[0]),i=Math.max(a[0],s[0],u[0],l[0]),r=Math.min(a[1],s[1],u[1],l[1]),o=Math.max(a[1],s[1],u[1],l[1])}var c=this.attrs;if(c.shadowColor){var h=c.shadowBlur,f=void 0===h?0:h,p=c.shadowOffsetX,d=void 0===p?0:p,g=c.shadowOffsetY,v=void 0===g?0:g,m=n-f+d,y=i+f+d,_=r-f+v,b=o+f+v;n=Math.min(n,m),i=Math.max(i,y),r=Math.min(r,_),o=Math.max(o,b)}return{x:n,y:r,minX:n,minY:r,maxX:i,maxY:o,width:i-n,height:o-r}},e.prototype.clearCacheBBox=function(){this.set("bbox",null),this.set("canvasBBox",null)},e.prototype.isClipShape=function(){return this.get("isClipShape")},e.prototype.isInShape=function(t,e){return!1},e.prototype.isOnlyHitBox=function(){return!1},e.prototype.isHit=function(t,e){var n=this.get("startArrowShape"),r=this.get("endArrowShape"),i=[t,e,1],o=(i=this.invertFromMatrix(i))[0],a=i[1],s=this._isInBBox(o,a);if(this.isOnlyHitBox())return s;if(s&&!this.isClipped(o,a)){if(this.isInShape(o,a))return!0;if(n&&n.isHit(o,a))return!0;if(r&&r.isHit(o,a))return!0}return!1},e}(Jr);var bo=new Map;function xo(t,e){bo.set(t,e)}function wo(t){return bo.get(t)}function Eo(t){var e=t.attr();return{x:e.x,y:e.y,width:e.width,height:e.height}}function So(t){var e=t.attr(),n=e.x,r=e.y,i=e.r;return{x:n-i,y:r-i,width:2*i,height:2*i}}function Co(t){return Math.min.apply(null,t)}function Ao(t){return Math.max.apply(null,t)}function To(t,e,n,r){var i=t-n,o=e-r;return Math.sqrt(i*i+o*o)}function ko(t,e){return Math.abs(t-e)<.001}function Mo(t,e){var n=Co(t),r=Co(e);return{x:n,y:r,width:Ao(t)-n,height:Ao(e)-r}}function Po(t){return(t+2*Math.PI)%(2*Math.PI)}const Io=function(t,e,n,r){return To(t,e,n,r)},Oo=function(t,e,n,r,i){return{x:(1-i)*t+i*n,y:(1-i)*e+i*r}},Ro=function(t,e,n,r,i,o){var a=[n-t,r-e];if(Ie.I6(a,[0,0]))return Math.sqrt((i-t)*(i-t)+(o-e)*(o-e));var s=[-a[1],a[0]];Ie.Fv(s,s);var u=[i-t,o-e];return Math.abs(Ie.AK(u,s))};function Lo(t,e,n,r,i,o){var a,s=1/0,u=[n,r],l=20;o&&o>200&&(l=o/10);for(var c=1/l,h=c/10,f=0;f<=l;f++){var p=f*c,d=[i.apply(null,t.concat([p])),i.apply(null,e.concat([p]))];(y=To(u[0],u[1],d[0],d[1]))<s&&(a=p,s=y)}if(0===a)return{x:t[0],y:e[0]};if(1===a){var g=t.length;return{x:t[g-1],y:e[g-1]}}for(s=1/0,f=0;f<32&&!(h<1e-4);f++){var v=a-h,m=a+h,y=(d=[i.apply(null,t.concat([v])),i.apply(null,e.concat([v]))],To(u[0],u[1],d[0],d[1]));if(v>=0&&y<s)a=v,s=y;else{var _=[i.apply(null,t.concat([m])),i.apply(null,e.concat([m]))],b=To(u[0],u[1],_[0],_[1]);m<=1&&b<s?(a=m,s=b):h*=.5}}return{x:i.apply(null,t.concat([a])),y:i.apply(null,e.concat([a]))}}function Do(t,e,n,r){var i=1-r;return i*i*t+2*r*i*e+r*r*n}function No(t,e,n){var r=t+n-2*e;if(ko(r,0))return[.5];var i=(t-e)/r;return i<=1&&i>=0?[i]:[]}function Bo(t,e,n,r){return 2*(1-r)*(e-t)+2*r*(n-e)}function zo(t,e,n,r,i,o,a){var s=Do(t,n,i,a),u=Do(e,r,o,a),l=Oo(t,e,n,r,a),c=Oo(n,r,i,o,a);return[[t,e,l.x,l.y,s,u],[s,u,c.x,c.y,i,o]]}function Fo(t,e,n,r,i,o,a){if(0===a)return(To(t,e,n,r)+To(n,r,i,o)+To(t,e,i,o))/2;var s=zo(t,e,n,r,i,o,.5),u=s[0],l=s[1];return u.push(a-1),l.push(a-1),Fo.apply(null,u)+Fo.apply(null,l)}const Zo={box:function(t,e,n,r,i,o){var a=No(t,n,i)[0],s=No(e,r,o)[0],u=[t,i],l=[e,o];return void 0!==a&&u.push(Do(t,n,i,a)),void 0!==s&&l.push(Do(e,r,o,s)),Mo(u,l)},length:function(t,e,n,r,i,o){return Fo(t,e,n,r,i,o,3)},nearestPoint:function(t,e,n,r,i,o,a,s){return Lo([t,n,i],[e,r,o],a,s,Do)},pointDistance:function(t,e,n,r,i,o,a,s){var u=this.nearestPoint(t,e,n,r,i,o,a,s);return To(u.x,u.y,a,s)},interpolationAt:Do,pointAt:function(t,e,n,r,i,o,a){return{x:Do(t,n,i,a),y:Do(e,r,o,a)}},divide:function(t,e,n,r,i,o,a){return zo(t,e,n,r,i,o,a)},tangentAngle:function(t,e,n,r,i,o,a){var s=Bo(t,n,i,a),u=Bo(e,r,o,a);return Po(Math.atan2(u,s))}};function jo(t,e,n,r,i){var o=1-i;return o*o*o*t+3*e*i*o*o+3*n*i*i*o+r*i*i*i}function Uo(t,e,n,r,i){var o=1-i;return 3*(o*o*(e-t)+2*o*i*(n-e)+i*i*(r-n))}function Go(t,e,n,r){var i,o,a,s=-3*t+9*e-9*n+3*r,u=6*t-12*e+6*n,l=3*e-3*t,c=[];if(ko(s,0))ko(u,0)||(i=-l/u)>=0&&i<=1&&c.push(i);else{var h=u*u-4*s*l;ko(h,0)?c.push(-u/(2*s)):h>0&&(o=(-u-(a=Math.sqrt(h)))/(2*s),(i=(-u+a)/(2*s))>=0&&i<=1&&c.push(i),o>=0&&o<=1&&c.push(o))}return c}function Vo(t,e,n,r,i,o,a,s,u){var l=jo(t,n,i,a,u),c=jo(e,r,o,s,u),h=Oo(t,e,n,r,u),f=Oo(n,r,i,o,u),p=Oo(i,o,a,s,u),d=Oo(h.x,h.y,f.x,f.y,u),g=Oo(f.x,f.y,p.x,p.y,u);return[[t,e,h.x,h.y,d.x,d.y,l,c],[l,c,g.x,g.y,p.x,p.y,a,s]]}function Wo(t,e,n,r,i,o,a,s,u){if(0===u)return function(t,e){for(var n=0,r=t.length,i=0;i<r;i++)n+=To(t[i],e[i],t[(i+1)%r],e[(i+1)%r]);return n/2}([t,n,i,a],[e,r,o,s]);var l=Vo(t,e,n,r,i,o,a,s,.5),c=l[0],h=l[1];return c.push(u-1),h.push(u-1),Wo.apply(null,c)+Wo.apply(null,h)}const Ho={extrema:Go,box:function(t,e,n,r,i,o,a,s){for(var u=[t,a],l=[e,s],c=Go(t,n,i,a),h=Go(e,r,o,s),f=0;f<c.length;f++)u.push(jo(t,n,i,a,c[f]));for(f=0;f<h.length;f++)l.push(jo(e,r,o,s,h[f]));return Mo(u,l)},length:function(t,e,n,r,i,o,a,s){return Wo(t,e,n,r,i,o,a,s,3)},nearestPoint:function(t,e,n,r,i,o,a,s,u,l,c){return Lo([t,n,i,a],[e,r,o,s],u,l,jo,c)},pointDistance:function(t,e,n,r,i,o,a,s,u,l,c){var h=this.nearestPoint(t,e,n,r,i,o,a,s,u,l,c);return To(h.x,h.y,u,l)},interpolationAt:jo,pointAt:function(t,e,n,r,i,o,a,s,u){return{x:jo(t,n,i,a,u),y:jo(e,r,o,s,u)}},divide:function(t,e,n,r,i,o,a,s,u){return Vo(t,e,n,r,i,o,a,s,u)},tangentAngle:function(t,e,n,r,i,o,a,s,u){var l=Uo(t,n,i,a,u),c=Uo(e,r,o,s,u);return Po(Math.atan2(c,l))}};function Xo(t,e,n,r,i,o){return n*Math.cos(i)*Math.cos(o)-r*Math.sin(i)*Math.sin(o)+t}function Yo(t,e,n,r,i,o){return n*Math.sin(i)*Math.cos(o)+r*Math.cos(i)*Math.sin(o)+e}const qo=function(t,e,n,r,i,o,a){for(var s=function(t,e,n){return Math.atan(-e/t*Math.tan(n))}(n,r,i),u=1/0,l=-1/0,c=[o,a],h=2*-Math.PI;h<=2*Math.PI;h+=Math.PI){var f=s+h;o<a?o<f&&f<a&&c.push(f):a<f&&f<o&&c.push(f)}for(h=0;h<c.length;h++){var p=Xo(t,0,n,r,i,c[h]);p<u&&(u=p),p>l&&(l=p)}var d=function(t,e,n){return Math.atan(e/(t*Math.tan(n)))}(n,r,i),g=1/0,v=-1/0,m=[o,a];for(h=2*-Math.PI;h<=2*Math.PI;h+=Math.PI){var y=d+h;o<a?o<y&&y<a&&m.push(y):a<y&&y<o&&m.push(y)}for(h=0;h<m.length;h++){var _=Yo(0,e,n,r,i,m[h]);_<g&&(g=_),_>v&&(v=_)}return{x:u,y:g,width:l-u,height:v-g}};const Ko=function(t){return function(t){if(t.length<2)return 0;for(var e=0,n=0;n<t.length-1;n++){var r=t[n],i=t[n+1];e+=To(r[0],r[1],i[0],i[1])}return e}(t)};function Qo(t,e){return t&&e?{minX:Math.min(t.minX,e.minX),minY:Math.min(t.minY,e.minY),maxX:Math.max(t.maxX,e.maxX),maxY:Math.max(t.maxY,e.maxY)}:t||e}function Jo(t,e){var n=t.get("startArrowShape"),r=t.get("endArrowShape");return n&&(e=Qo(e,n.getCanvasBBox())),r&&(e=Qo(e,r.getCanvasBBox())),e}var $o=null;function ta(){if(!$o){var t=document.createElement("canvas");t.width=1,t.height=1,$o=t.getContext("2d")}return $o}function ea(t,e,n){var r=1;if((0,_.isString)(t)&&(r=t.split("\n").length),r>1){var i=function(t,e){return e?e-t:.14*t}(e,n);return e*r+i*(r-1)}return e}function na(t){var e=t.fontSize,n=t.fontFamily,r=t.fontWeight;return[t.fontStyle,t.fontVariant,r,e+"px",n].join(" ").trim()}var ra=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/gi,ia=/[^\s\,]+/gi;const oa=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=[[0,0],[1,1]]);for(var r=!!e,i=[],o=0,a=t.length;o<a;o+=2)i.push([t[o],t[o+1]]);var s,u,l,c=function(t,e,n,r){var i,o,a,s,u,l,c,h=[],f=!!r;if(f){a=r[0],s=r[1];for(var p=0,d=t.length;p<d;p+=1){var g=t[p];a=Ie.VV([0,0],a,g),s=Ie.Fp([0,0],s,g)}}p=0;for(var v=t.length;p<v;p+=1)if(g=t[p],0!==p||n)if(p!==v-1||n){i=t[[p?p-1:v-1,p-1][n?0:1]],o=t[n?(p+1)%v:p+1];var m=[0,0];m=Ie.lu(m,o,i),m=Ie.bA(m,m,.4);var y=Ie.TE(g,i),_=Ie.TE(g,o),b=y+_;0!==b&&(y/=b,_/=b);var x=Ie.bA([0,0],m,-y),w=Ie.bA([0,0],m,_);l=Ie.IH([0,0],g,x),u=Ie.IH([0,0],g,w),u=Ie.VV([0,0],u,Ie.Fp([0,0],o,g)),u=Ie.Fp([0,0],u,Ie.VV([0,0],o,g)),x=Ie.lu([0,0],u,g),x=Ie.bA([0,0],x,-y/_),l=Ie.IH([0,0],g,x),l=Ie.VV([0,0],l,Ie.Fp([0,0],i,g)),l=Ie.Fp([0,0],l,Ie.VV([0,0],i,g)),w=Ie.lu([0,0],g,l),w=Ie.bA([0,0],w,_/y),u=Ie.IH([0,0],g,w),f&&(l=Ie.Fp([0,0],l,a),l=Ie.VV([0,0],l,s),u=Ie.Fp([0,0],u,a),u=Ie.VV([0,0],u,s)),h.push(c),h.push(l),c=u}else l=g,h.push(c),h.push(l);else c=g;return n&&h.push(h.shift()),h}(i,0,r,n),h=i.length,f=[];for(o=0;o<h-1;o+=1)s=c[2*o],u=c[2*o+1],l=i[o+1],f.push(["C",s[0],s[1],u[0],u[1],l[0],l[1]]);return r&&(s=c[h],u=c[h+1],l=i[0],f.push(["C",s[0],s[1],u[0],u[1],l[0],l[1]])),f};var aa=new RegExp("([a-z])[\t\n\v\f\r   ᠎             　\u2028\u2029,]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?[\t\n\v\f\r   ᠎             　\u2028\u2029]*,?[\t\n\v\f\r   ᠎             　\u2028\u2029]*)+)","ig"),sa=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)[\t\n\v\f\r   ᠎             　\u2028\u2029]*,?[\t\n\v\f\r   ᠎             　\u2028\u2029]*","ig");function ua(t){if(!t)return null;if((0,_.isArray)(t))return t;var e={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},n=[];return String(t).replace(aa,(function(t,r,i){var o=[],a=r.toLowerCase();if(i.replace(sa,(function(t,e){e&&o.push(+e)})),"m"===a&&o.length>2&&(n.push([r].concat(o.splice(0,2))),a="l",r="m"===r?"l":"L"),"o"===a&&1===o.length&&n.push([r,o[0]]),"r"===a)n.push([r].concat(o));else for(;o.length>=e[a]&&(n.push([r].concat(o.splice(0,e[a]))),e[a]););return""})),n}var la=/[a-z]/;function ca(t,e){return[e[0]+(e[0]-t[0]),e[1]+(e[1]-t[1])]}function ha(t){var e=ua(t);if(!e||!e.length)return[["M",0,0]];for(var n=!1,r=0;r<e.length;r++){var i=e[r][0];if(la.test(i)||["V","H","T","S"].indexOf(i)>=0){n=!0;break}}if(!n)return e;var o=[],a=0,s=0,u=0,l=0,c=0,h=e[0];"M"!==h[0]&&"m"!==h[0]||(u=a=+h[1],l=s=+h[2],c++,o[0]=["M",a,s]),r=c;for(var f=e.length;r<f;r++){var p=e[r],d=o[r-1],g=[],v=(i=p[0]).toUpperCase();if(i!==v)switch(g[0]=v,v){case"A":g[1]=p[1],g[2]=p[2],g[3]=p[3],g[4]=p[4],g[5]=p[5],g[6]=+p[6]+a,g[7]=+p[7]+s;break;case"V":g[1]=+p[1]+s;break;case"H":g[1]=+p[1]+a;break;case"M":u=+p[1]+a,l=+p[2]+s,g[1]=u,g[2]=l;break;default:for(var m=1,y=p.length;m<y;m++)g[m]=+p[m]+(m%2?a:s)}else g=e[r];switch(v){case"Z":a=+u,s=+l;break;case"H":g=["L",a=g[1],s];break;case"V":g=["L",a,s=g[1]];break;case"T":a=g[1],s=g[2];var _=ca([d[1],d[2]],[d[3],d[4]]);g=["Q",_[0],_[1],a,s];break;case"S":a=g[g.length-2],s=g[g.length-1];var b=d.length,x=ca([d[b-4],d[b-3]],[d[b-2],d[b-1]]);g=["C",x[0],x[1],g[1],g[2],a,s];break;case"M":u=g[g.length-2],l=g[g.length-1];break;default:a=g[g.length-2],s=g[g.length-1]}o.push(g)}return o}function fa(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function pa(t,e){return fa(t)*fa(e)?(t[0]*e[0]+t[1]*e[1])/(fa(t)*fa(e)):1}function da(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(pa(t,e))}function ga(t,e){return t[0]===e[0]&&t[1]===e[1]}function va(t,e){var n=e[1],r=e[2],i=(0,_.mod)((0,_.toRadian)(e[3]),2*Math.PI),o=e[4],a=e[5],s=t[0],u=t[1],l=e[6],c=e[7],h=Math.cos(i)*(s-l)/2+Math.sin(i)*(u-c)/2,f=-1*Math.sin(i)*(s-l)/2+Math.cos(i)*(u-c)/2,p=h*h/(n*n)+f*f/(r*r);p>1&&(n*=Math.sqrt(p),r*=Math.sqrt(p));var d=n*n*(f*f)+r*r*(h*h),g=d?Math.sqrt((n*n*(r*r)-d)/d):1;o===a&&(g*=-1),isNaN(g)&&(g=0);var v=r?g*n*f/r:0,m=n?g*-r*h/n:0,y=(s+l)/2+Math.cos(i)*v-Math.sin(i)*m,b=(u+c)/2+Math.sin(i)*v+Math.cos(i)*m,x=[(h-v)/n,(f-m)/r],w=[(-1*h-v)/n,(-1*f-m)/r],E=da([1,0],x),S=da(x,w);return pa(x,w)<=-1&&(S=Math.PI),pa(x,w)>=1&&(S=0),0===a&&S>0&&(S-=2*Math.PI),1===a&&S<0&&(S+=2*Math.PI),{cx:y,cy:b,rx:ga(t,[l,c])?0:n,ry:ga(t,[l,c])?0:r,startAngle:E,endAngle:E+S,xRotation:i,arcFlag:o,sweepFlag:a}}function ma(t,e){return[e[0]+(e[0]-t[0]),e[1]+(e[1]-t[1])]}function ya(t){for(var e=[],n=null,r=null,i=null,o=0,a=(t=function(t){var e=t||[];return(0,_.isArray)(e)?e:(0,_.isString)(e)?(e=e.match(ra),(0,_.each)(e,(function(t,n){if((t=t.match(ia))[0].length>1){var r=t[0].charAt(0);t.splice(1,0,t[0].substr(1)),t[0]=r}(0,_.each)(t,(function(e,n){isNaN(e)||(t[n]=+e)})),e[n]=t})),e):void 0}(t)).length,s=0;s<a;s++){var u=t[s];r=t[s+1];var l=u[0],c={command:l,prePoint:n,params:u,startTangent:null,endTangent:null};switch(l){case"M":i=[u[1],u[2]],o=s;break;case"A":var h=va(n,u);c.arcParams=h}if("Z"===l)n=i,r=t[o+1];else{var f=u.length;n=[u[f-2],u[f-1]]}r&&"Z"===r[0]&&(r=t[o],e[o]&&(e[o].prePoint=n)),c.currentPoint=n,e[o]&&ga(n,e[o].currentPoint)&&(e[o].prePoint=c.prePoint);var p=r?[r[r.length-2],r[r.length-1]]:null;c.nextPoint=p;var d=c.prePoint;if(["L","H","V"].includes(l))c.startTangent=[d[0]-n[0],d[1]-n[1]],c.endTangent=[n[0]-d[0],n[1]-d[1]];else if("Q"===l){var g=[u[1],u[2]];c.startTangent=[d[0]-g[0],d[1]-g[1]],c.endTangent=[n[0]-g[0],n[1]-g[1]]}else if("T"===l)g=ma((y=e[s-1]).currentPoint,d),"Q"===y.command?(c.command="Q",c.startTangent=[d[0]-g[0],d[1]-g[1]],c.endTangent=[n[0]-g[0],n[1]-g[1]]):(c.command="TL",c.startTangent=[d[0]-n[0],d[1]-n[1]],c.endTangent=[n[0]-d[0],n[1]-d[1]]);else if("C"===l){var v=[u[1],u[2]],m=[u[3],u[4]];c.startTangent=[d[0]-v[0],d[1]-v[1]],c.endTangent=[n[0]-m[0],n[1]-m[1]],0===c.startTangent[0]&&0===c.startTangent[1]&&(c.startTangent=[v[0]-m[0],v[1]-m[1]]),0===c.endTangent[0]&&0===c.endTangent[1]&&(c.endTangent=[m[0]-v[0],m[1]-v[1]])}else if("S"===l){var y;v=ma((y=e[s-1]).currentPoint,d),m=[u[1],u[2]],"C"===y.command?(c.command="C",c.startTangent=[d[0]-v[0],d[1]-v[1]],c.endTangent=[n[0]-m[0],n[1]-m[1]]):(c.command="SQ",c.startTangent=[d[0]-m[0],d[1]-m[1]],c.endTangent=[n[0]-m[0],n[1]-m[1]])}else if("A"===l){var b=.001,x=c.arcParams||{},w=x.cx,E=void 0===w?0:w,S=x.cy,C=void 0===S?0:S,A=x.rx,T=void 0===A?0:A,k=x.ry,M=void 0===k?0:k,P=x.sweepFlag,I=void 0===P?0:P,O=x.startAngle,R=void 0===O?0:O,L=x.endAngle,D=void 0===L?0:L;0===I&&(b*=-1);var N=T*Math.cos(R-b)+E,B=M*Math.sin(R-b)+C;c.startTangent=[N-i[0],B-i[1]];var z=T*Math.cos(R+D+b)+E,F=M*Math.sin(R+D-b)+C;c.endTangent=[d[0]-z,d[1]-F]}e.push(c)}return e}function _a(t,e){var n=t.prePoint,r=t.currentPoint,i=t.nextPoint,o=Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2),a=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2),s=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2),u=Math.acos((o+a-s)/(2*Math.sqrt(o)*Math.sqrt(a)));if(!u||0===Math.sin(u)||(0,_.isNumberEqual)(u,0))return{xExtra:0,yExtra:0};var l=Math.abs(Math.atan2(i[1]-r[1],i[0]-r[0])),c=Math.abs(Math.atan2(i[0]-r[0],i[1]-r[1]));return l=l>Math.PI/2?Math.PI-l:l,c=c>Math.PI/2?Math.PI-c:c,{xExtra:Math.cos(u/2-l)*(e/2*(1/Math.sin(u/2)))-e/2||0,yExtra:Math.cos(c-u/2)*(e/2*(1/Math.sin(u/2)))-e/2||0}}Math.PI,xo("rect",Eo),xo("image",Eo),xo("circle",So),xo("marker",So),xo("polyline",(function(t){for(var e=t.attr().points,n=[],r=[],i=0;i<e.length;i++){var o=e[i];n.push(o[0]),r.push(o[1])}var a=Mo(n,r),s=a.x,u=a.y,l={minX:s,minY:u,maxX:s+a.width,maxY:u+a.height};return{x:(l=Jo(t,l)).minX,y:l.minY,width:l.maxX-l.minX,height:l.maxY-l.minY}})),xo("polygon",(function(t){for(var e=t.attr().points,n=[],r=[],i=0;i<e.length;i++){var o=e[i];n.push(o[0]),r.push(o[1])}return Mo(n,r)})),xo("text",(function(t){var e=t.attr(),n=e.x,r=e.y,i=e.text,o=e.fontSize,a=e.lineHeight,s=e.font;s||(s=na(e));var u,l=function(t,e){var n=ta(),r=0;if((0,_.isNil)(t)||""===t)return r;if(n.save(),n.font=e,(0,_.isString)(t)&&t.includes("\n")){var i=t.split("\n");(0,_.each)(i,(function(t){var e=n.measureText(t).width;r<e&&(r=e)}))}else r=n.measureText(t).width;return n.restore(),r}(i,s);if(l){var c=e.textAlign,h=e.textBaseline,f=ea(i,o,a),p={x:n,y:r-f};c&&("end"===c||"right"===c?p.x-=l:"center"===c&&(p.x-=l/2)),h&&("top"===h?p.y+=f:"middle"===h&&(p.y+=f/2)),u={x:p.x,y:p.y,width:l,height:f}}else u={x:n,y:r,width:0,height:0};return u})),xo("path",(function(t){var e=t.attr(),n=e.path,r=e.stroke?e.lineWidth:0,i=function(t,e){for(var n=[],r=[],i=[],o=0;o<t.length;o++){var a=(g=t[o]).currentPoint,s=g.params,u=g.prePoint,l=void 0;switch(g.command){case"Q":l=Zo.box(u[0],u[1],s[1],s[2],s[3],s[4]);break;case"C":l=Ho.box(u[0],u[1],s[1],s[2],s[3],s[4],s[5],s[6]);break;case"A":var c=g.arcParams;l=qo(c.cx,c.cy,c.rx,c.ry,c.xRotation,c.startAngle,c.endAngle);break;default:n.push(a[0]),r.push(a[1])}l&&(g.box=l,n.push(l.x,l.x+l.width),r.push(l.y,l.y+l.height)),e&&("L"===g.command||"M"===g.command)&&g.prePoint&&g.nextPoint&&i.push(g)}n=n.filter((function(t){return!Number.isNaN(t)})),r=r.filter((function(t){return!Number.isNaN(t)}));var h=(0,_.min)(n),f=(0,_.min)(r),p=(0,_.max)(n),d=(0,_.max)(r);if(0===i.length)return{x:h,y:f,width:p-h,height:d-f};for(o=0;o<i.length;o++){var g;(a=(g=i[o]).currentPoint)[0]===h?h-=_a(g,e).xExtra:a[0]===p&&(p+=_a(g,e).xExtra),a[1]===f?f-=_a(g,e).yExtra:a[1]===d&&(d+=_a(g,e).yExtra)}return{x:h,y:f,width:p-h,height:d-f}}(t.get("segments")||ya(n),r),o=i.x,a=i.y,s={minX:o,minY:a,maxX:o+i.width,maxY:a+i.height};return{x:(s=Jo(t,s)).minX,y:s.minY,width:s.maxX-s.minX,height:s.maxY-s.minY}})),xo("line",(function(t){var e=t.attr(),n=e.x1,r=e.y1,i=e.x2,o=e.y2,a={minX:Math.min(n,i),maxX:Math.max(n,i),minY:Math.min(r,o),maxY:Math.max(r,o)};return{x:(a=Jo(t,a)).minX,y:a.minY,width:a.maxX-a.minX,height:a.maxY-a.minY}})),xo("ellipse",(function(t){var e=t.attr(),n=e.x,r=e.y,i=e.rx,o=e.ry;return{x:n-i,y:r-o,width:2*i,height:2*o}}));var ba=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.item=n.item,r.canvasX=n.canvasX,r.canvasY=n.canvasY,r.wheelDelta=n.wheelDelta,r.detail=n.detail,r}return(0,y.__extends)(e,t),e}(Sr),xa=function(t){return"".concat(t,"-").concat(Math.random()).concat(Date.now())},wa=function(t){if((0,_.isArray)(t))switch(t.length){case 4:return t;case 3:return t.push(t[1]),t;case 2:return t.concat(t);case 1:return[t[0],t[0],t[0],t[0]];default:return[0,0,0,0]}if((0,_.isNumber)(t))return[t,t,t,t];if((0,_.isString)(t)){var e=parseInt(t,10);return[e,e,e,e]}return[0,0,0,0]},Ea=function(t){var e=new ba(t.type,t);return e.clientX=t.clientX,e.clientY=t.clientY,e.x=t.x,e.y=t.y,e.target=t.target,e.currentTarget=t.currentTarget,e.bubbles=!0,e.item=t.item,e},Sa=function(t){if(!t)return!1;for(var e=[1,0,0,0,1,0,0,0,1],n=0;n<9;n++)if(t[n]!==e[n])return!0;return!1},Ca=function(t){return Number.isNaN(Number(t))},Aa=function(t){for(var e=1/0,n=-1/0,r=1/0,i=-1/0,o=0;o<t.length;o++){var a=t[o].getBBox(),s=a.minX,u=a.minY,l=a.maxX,c=a.maxY;s<e&&(e=s),u<r&&(r=u),l>n&&(n=l),c>i&&(i=c)}return{x:Math.floor(e),y:Math.floor(r),width:Math.ceil(n)-Math.floor(e),height:Math.ceil(i)-Math.floor(r),minX:e,minY:r,maxX:n,maxY:i}},Ta=function(t,e,n,r,i){void 0===e&&(e=15),void 0===n&&(n="quadratic"),void 0===r&&(r=void 0),void 0===i&&(i=void 0);for(var o=t.length,a=2*e,s=["top","top-right","right","bottom-right","bottom","bottom-left","left","top-left"],u={},l=[],c={},h=0;h<o;h++){var f=t[h],p=f.source,d=f.target,g="".concat(p,"-").concat(d);if(!l[h]){u[g]||(u[g]=[]),l[h]=!0,u[g].push(f);for(var v=0;v<o;v++)if(h!==v){var m=t[v],y=m.source,_=m.target;l[v]||(p===_&&d===y?(u[g].push(m),l[v]=!0,c["".concat(y,"|").concat(_,"|").concat(u[g].length-1)]=!0):p===y&&d===_&&(u[g].push(m),l[v]=!0))}}}for(var b in u)for(var x=u[b],w=x.length,E=0;E<w;E++){var S=x[E];if(S.source!==S.target)if(1===w&&r&&S.source!==S.target)S.type=r;else{S.type=n;var C=(E%2==0?1:-1)*(c["".concat(S.source,"|").concat(S.target,"|").concat(E)]?-1:1);S.curveOffset=w%2==1?C*Math.ceil(E/2)*a:C*(Math.floor(E/2)*a+e)}else i&&(S.type=i),S.loopCfg={position:s[E%8],dist:20*Math.floor(E/8)+50}}return t},ka=function(){function t(t){this.destroyed=!1,this.graph=t,this.destroyed=!1}return t.prototype.getViewCenter=function(){var t=this.getFormatPadding(),e=this.graph,n=this.graph.get("width"),r=e.get("height");return{x:(n-t[1]-t[3])/2+t[3],y:(r-t[0]-t[2])/2+t[0]}},t.prototype.fitCenter=function(){var t=this.graph,e=t.get("group");e.resetMatrix();var n=e.getCanvasBBox();if(0!==n.width&&0!==n.height){var r=this.getViewCenter(),i=n.x+n.width/2,o=n.y+n.height/2;t.translate(r.x-i,r.y-o)}},t.prototype.fitView=function(){var t=this.graph,e=this.getFormatPadding(),n=t.get("width"),r=t.get("height"),i=t.get("group");i.resetMatrix();var o=i.getCanvasBBox();if(0!==o.width&&0!==o.height){var a=this.getViewCenter(),s=o.x+o.width/2,u=o.y+o.height/2;t.translate(a.x-s,a.y-u);var l=(n-e[1]-e[3])/o.width,c=(r-e[0]-e[2])/o.height,h=l;l>c&&(h=c),t.zoom(h,a)||console.warn("zoom failed, ratio out of range, ratio: %f",h)}},t.prototype.fitViewByRules=function(t){var e=t.onlyOutOfViewPort,n=void 0!==e&&e,r=t.direction,i=void 0===r?"both":r,o=t.ratioRule,a=void 0===o?"min":o,s=this.graph,u=this.getFormatPadding(),l=s.get("width"),c=s.get("height"),h=s.get("group");h.resetMatrix();var f=h.getCanvasBBox();if(0!==f.width&&0!==f.height){var p=this.getViewCenter(),d=f.x+f.width/2,g=f.y+f.height/2;s.translate(p.x-d,p.y-g);var v,m=(l-u[1]-u[3])/f.width,y=(c-u[0]-u[2])/f.height;v="x"===i?m:"y"===i?y:"max"===a?Math.max(m,y):Math.min(m,y),n&&(v=v<1?v:1);var _=s.getZoom()*v,b=s.get("minZoom");_<b&&(_=b,console.warn("fitview failed, ratio out of range, ratio: %f",v,"graph minzoom has been used instead")),s.zoomTo(_,p)}},t.prototype.getFormatPadding=function(){var t=this.graph.get("fitViewPadding");return wa(t)},t.prototype.focusPoint=function(t,e,n){var r=this,i=this.getViewCenter(),o=this.getPointByCanvas(i.x,i.y),a=this.graph.get("group").getMatrix();if(a||(a=[1,0,0,0,1,0,0,0,1]),e){var s=(o.x-t.x)*a[0],u=(o.y-t.y)*a[4],l=0,c=0,h=0,f=0;this.graph.get("canvas").animate((function(t){h=s*t,f=u*t,r.graph.translate(h-l,f-c),l=h,c=f}),(0,y.__assign)({},n))}else this.graph.translate((o.x-t.x)*a[0],(o.y-t.y)*a[4])},t.prototype.getPointByCanvas=function(t,e){var n=this.graph.get("group").getMatrix();return n||(n=[1,0,0,0,1,0,0,0,1]),Ze({x:t,y:e},n)},t.prototype.getPointByClient=function(t,e){var n=this.graph.get("canvas").getPointByClient(t,e);return this.getPointByCanvas(n.x,n.y)},t.prototype.getClientByPoint=function(t,e){var n=this.graph.get("canvas"),r=this.getCanvasByPoint(t,e),i=n.getClientByPoint(r.x,r.y);return{x:i.x,y:i.y}},t.prototype.getCanvasByPoint=function(t,e){var n=this.graph.get("group").getMatrix();return n||(n=[1,0,0,0,1,0,0,0,1]),Fe({x:t,y:e},n)},t.prototype.focus=function(t,e,n){if((0,_.isString)(t)&&(t=this.graph.findById(t)),t){var r=0,i=0;if(t.getType&&"edge"===t.getType()){var o=t.getSource().get("group").getMatrix(),a=t.getTarget().get("group").getMatrix();o&&a?(r=(o[6]+a[6])/2,i=(o[7]+a[7])/2):(o||a)&&(r=o?o[6]:a[6],i=o?o[7]:a[7])}else{var s=t.get("group").getMatrix();s||(s=[1,0,0,0,1,0,0,0,1]),r=s[6],i=s[7]}this.focusPoint({x:r,y:i},e,n)}},t.prototype.changeSize=function(t,e){var n=this.graph;if(!(0,_.isNumber)(t)||!(0,_.isNumber)(e))throw Error("invalid canvas width & height, please make sure width & height type is number");n.set({width:t,height:e}),n.get("canvas").changeSize(t,e),n.get("plugins").forEach((function(t){t.get("gridContainer")&&t.positionInit()}))},t.prototype.destroy=function(){this.graph=null,this.destroyed=!1},t}();const Ma=ka;function Pa(t){return Pa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pa(t)}function Ia(t){if("string"!=typeof t)return t;var e=function(t){if("string"!=typeof t)return t;try{return JSON.parse(t.trim())}catch(e){return t.trim()}},n=e(t);if("string"!=typeof n)return n;for(var r=function(t){return t[t.length-1]},i=t.trim(),o=[],a=[],s=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.some((function(t){return r(a)===t}))},u=null,l=0,c="";l<i.length;){var h=i[l],f=s('"',"'");if(f||h.trim()){var p="\\"===i[l-1],d=s("}"),g=s("]"),v=s(","),m=r(o);if(f)if(r(a)!==h||p)c+=h;else{a.pop();var y=e(c);m.push(y),u=y,c=""}else if(g&&","===h)c&&(m.push(e(c)),c="");else if(d&&":"===h)a.push(","),c&&(m.push(c),c="");else if(v&&","===h)c&&(m.push(e(c)),c=""),a.pop();else if("}"===h&&(d||v)){c&&(m.push(e(c)),c=""),v&&a.pop();for(var _={},b=1;b<m.length;b+=2)_[m[b-1]]=m[b];o.pop(),o.length&&r(o).push(_),a.pop(),u=_}else"]"===h&&g?(c&&(m.push(e(c)),c=""),o.pop(),o.length&&r(o).push(m),a.pop(),u=m):"{"===h?(o.push([]),a.push("}")):"["===h?(o.push([]),a.push("]")):'"'===h?a.push('"'):"'"===h?a.push("'"):c+=h;l+=1}else l+=1}return u||c}function Oa(t,e){var n={},r=t.getAttributeNames&&t.getAttributeNames()||[],i=t.children&&Array.from(t.children).map((function(t){return Oa(t,e)})),o={},a=t.tagName?t.tagName.toLowerCase():"group";return"text"===a&&(n.text=t.innerText),o.type=a,"img"===a&&(o.type="image"),Array.from(r).forEach((function(e){var r=function(t){return t.split("-").reduce((function(t,e){return t+e.charAt(0).toUpperCase()+e.slice(1)}))}(e),i=t.getAttribute(e);try{if("style"===r||"attrs"===r){var a=Ia(i);n=(0,y.__assign)((0,y.__assign)({},n),a)}else o[r]=Ia(i)}catch(t){if("style"===r)throw t;o[r]=i}})),o.attrs=n,e&&e.style&&o.name&&"object"===Pa(e.style[o.name])&&(o.attrs=(0,y.__assign)((0,y.__assign)({},o.attrs),e.style[o.name])),e&&e.style&&o.keyshape&&(o.attrs=(0,y.__assign)((0,y.__assign)({},o.attrs),e.style)),i.length&&(o.children=i),o}function Ra(t,e){var n;void 0===e&&(e={x:0,y:0});var r=(0,y.__assign)({x:0,y:0,width:0,height:0},e);if(null===(n=t.children)||void 0===n?void 0:n.length){var i=t.attrs,o=void 0===i?{}:i,a=o.marginTop,s=(0,y.__assign)({},e);a&&(s.y+=a);for(var u=0;u<t.children.length;u++){t.children[u].attrs.key="".concat(o.key||"root"," -").concat(u," ");var l=Ra(t.children[u],s);if(l.bbox){var c=l.bbox;"inline"===l.attrs.next?s.x+=l.bbox.width:s.y+=l.bbox.height,c.width+c.x>r.width&&(r.width=c.width+c.x),c.height+c.y>r.height&&(r.height=c.height+c.y)}}}return t.bbox=function(t,e,n){var r,i,o=t.attrs,a=void 0===o?{}:o,s={x:e.x||0,y:e.y||0,width:n.width||0,height:n.height||0};switch(t.type){case"maker":case"circle":a.r&&(i=2*a.r,r=2*a.r);break;case"text":a.text&&(i=Bn(a.text,a.fontSize||12)[0],r=16,s.y+=r,s.height=r,s.width=i,t.attrs=(0,y.__assign)({fontSize:12,fill:"#000"},a));break;default:a.width&&(i=a.width),a.height&&(r=a.height)}return r>=0&&(s.height=r),i>=0&&(s.width=i),a.marginTop&&(s.y+=a.marginTop),a.marginLeft&&(s.x+=a.marginLeft),s}(t,e,r),t.attrs=(0,y.__assign)((0,y.__assign)({},t.attrs),t.bbox),t}function La(t,e){var n,r,i,o,a=(t||{}).type,s=((null==e?void 0:e.attrs)||{}).key;if(s&&t&&(t.attrs.key=s),!t&&e)return{action:"delete",val:e,type:a,key:s};if(t&&!e)return{action:"add",val:t,type:a};if(!t&&!e)return{action:"same",type:a};var u=[];if((null===(n=t.children)||void 0===n?void 0:n.length)>0||(null===(r=e.children)||void 0===r?void 0:r.length)>0)for(var l=Math.max(null===(i=t.children)||void 0===i?void 0:i.length,null===(o=e.children)||void 0===o?void 0:o.length),c=e.children||[],h=t.children||[],f=0;f<l;f+=1)u.push(La(h[f],c[f]));var p=Object.keys(e.attrs),d=Object.keys(t.attrs);return e.type!==t.type?{action:"restructure",nowTarget:t,formerTarget:e,key:s,children:u}:p.filter((function(t){return"children"!==t})).some((function(n){return t.attrs[n]!==e.attrs[n]||!d.includes(n)}))?{action:"change",val:t,children:u,type:a,key:s}:{action:"same",children:u,type:a,key:s}}function Da(t){var e={},n=function(e){var n,r=(n="function"==typeof t?t(e):t,function(t){for(var e=n.length,r=[],i=0,o="";i<e;)if("{"===n[i]&&"{"===n[i+1])r.push(o),o="",i+=2;else if("}"===n[i]&&"}"===n[i+1]){if(r.length){var a=r.pop();o=(0,_.get)(t,o,a.endsWith("=")?'"{'.concat(o,'}"'):o),r.push(a+o)}i+=2,o=""}else o+=n[i],i+=1;return r.push(o),r.map((function(t,e){return r[e-1]&&r[e-1].endsWith("=")?'"{'.concat(t,'}"'):t})).join("")})(e),i=document.createElement("div");i.innerHTML=r;var o=Ra(Oa(i.children[0],e));return i.remove(),o};return{draw:function(t,r){var i=n(t),o=r;return function t(e){var n=e.attrs,i=void 0===n?{}:n,a=e.bbox,s=e.type,u=e.children,l=(0,y.__rest)(e,["attrs","bbox","type","children"]);if("group"!==e.type){var c=r.addShape(e.type,(0,y.__assign)({attrs:i,origin:{bbox:a,type:s,children:u}},l));e.keyshape&&(o=c)}e.children&&e.children.forEach((function(e){return t(e)}))}(i),e[t.id]=[i],o},update:function(t,r){e[t.id]||(e[t.id]=[]);var i=r.getContainer(),o=i.get("children"),a=n(t),s=La(a,e[t.id].pop()),u=function t(e){var n;"group"!==e.type&&i.addShape(e.type,{attrs:e.attrs}),(null===(n=e.children)||void 0===n?void 0:n.length)&&e.children.map((function(e){return t(e)}))},l=function t(e){var n,r=o.find((function(t){return t.attrs.key===e.attrs.key}));r&&i.removeChild(r),(null===(n=e.children)||void 0===n?void 0:n.length)&&e.children.map((function(e){return t(e)}))};!function t(e){var n=e.key;if("group"!==e.type){var i=o.find((function(t){return t.attrs.key===n}));switch(e.action){case"change":if(i){var a=e.val.keyshape?r.getOriginStyle():{};i.attr((0,y.__assign)((0,y.__assign)({},a),e.val.attrs))}break;case"add":u(e.val);break;case"delete":l(e.val);break;case"restructure":l(e.formerTarget),u(e.nowTarget)}}e.children&&e.children.forEach((function(e){return t(e)}))}(s),e[t.id].push(a)},getAnchorPoints:function(){return[[0,.5],[1,.5],[.5,1],[.5,0]]}}}var Na={};function Ba(t){return Na[t]||(Na[t]=(0,_.upperFirst)(t)),Na[t]}var za={defaultShapeType:"defaultType",className:null,getShape:function(t){var e=this;return e[t]||e[e.defaultShapeType]||e["simple-circle"]},draw:function(t,e,n){var r=this.getShape(t);n.shapeMap={};var i=r.draw(e,n);return r.afterDraw&&r.afterDraw(e,n,i),i},baseUpdate:function(t,e,n,r){var i,o,a=this.getShape(t);a.update&&(a.mergeStyle=null===(i=a.getOptions)||void 0===i?void 0:i.call(a,e,r),null===(o=a.update)||void 0===o||o.call(a,e,n,r)),a.afterUpdate&&a.afterUpdate(e,n)},setState:function(t,e,n,r){this.getShape(t).setState(e,n,r)},shouldUpdate:function(t){return!!this.getShape(t).update},getControlPoints:function(t,e){return this.getShape(t).getControlPoints(e)},getAnchorPoints:function(t,e){return this.getShape(t).getAnchorPoints(e)}},Fa={options:{},draw:function(t,e){return this.drawShape(t,e)},drawShape:function(){},afterDraw:function(){},afterUpdate:function(){},setState:function(){},getControlPoints:function(t){return t.controlPoints},getAnchorPoints:function(t){var e=this.options.anchorPoints;return t.anchorPoints||e}},Za=function(){function t(){}return t.registerFactory=function(e,n){var r=Ba(e),i=za,o=(0,y.__assign)((0,y.__assign)({},i),n);return t[r]=o,o.className=r,o},t.getFactory=function(e){return t[Ba(e)]},t.registerNode=function(e,n,r){var i,o=t.Node;if("string"==typeof n||"function"==typeof n){var a=Da(n);i=(0,y.__assign)((0,y.__assign)({},o.getShape("single-node")),a)}else if(n.jsx)a=Da(n.jsx),i=(0,y.__assign)((0,y.__assign)((0,y.__assign)({},o.getShape("single-node")),a),n);else{o.getShape(r);var s=r?o.getShape(r):Fa;i=(0,y.__assign)((0,y.__assign)({},s),n)}return i.type=e,i.itemType="node",o[e]=i,i},t.registerEdge=function(e,n,r){var i=t.Edge,o=r?i.getShape(r):Fa,a=(0,y.__assign)((0,y.__assign)({},o),n);return a.type=e,a.itemType="edge",i[e]=a,a},t.registerCombo=function(e,n,r){var i=t.Combo,o=r?i.getShape(r):Fa,a=(0,y.__assign)((0,y.__assign)({},o),n);return a.type=e,a.itemType="combo",i[e]=a,a},t}();const ja=Za;Za.registerFactory("node",{defaultShapeType:"circle"}),Za.registerFactory("edge",{defaultShapeType:"line"}),Za.registerFactory("combo",{defaultShapeType:"circle"});var Ua="bboxCache",Ga="bboxCanvasCache",Va=function(){function t(t){this._cfg={},this.destroyed=!1;this._cfg=Object.assign({id:void 0,type:"item",model:{},group:void 0,animate:!1,visible:!0,locked:!1,event:!0,keyShape:void 0,states:[]},this.getDefaultCfg(),t);var e=this.get("model"),n=e.id,r=this.get("type");n||(n=xa(r),this.get("model").id=n),this.set("id",n);var i=t.group;i&&(i.set("item",this),i.set("id",n)),this.init(),this.draw();var o=e.shape||e.type||("edge"===r?"line":"circle"),a=this.get("shapeFactory");if(a&&a[o]){var s=a[o].options;if(s&&s.stateStyles){var u=this.get("styles")||e.stateStyles;u=(0,_.deepMix)({},s.stateStyles,u),this.set("styles",u)}}}return t.prototype.calculateBBox=function(){var t=this.get("keyShape"),e=this.get("group"),n=Mn(t,e);return n.x=n.minX,n.y=n.minY,n.width=n.maxX-n.minX,n.height=n.maxY-n.minY,n.centerX=(n.minX+n.maxX)/2,n.centerY=(n.minY+n.maxY)/2,n},t.prototype.calculateCanvasBBox=function(){var t=this.get("keyShape"),e=this.get("group"),n=Mn(t,e);return n.x=n.minX,n.y=n.minY,n.width=n.maxX-n.minX,n.height=n.maxY-n.minY,n.centerX=(n.minX+n.maxX)/2,n.centerY=(n.minY+n.maxY)/2,n},t.prototype.drawInner=function(){var t=this,e=t.get("shapeFactory"),n=t.get("group"),r=t.get("model");n.clear();var i=r.visible;if(void 0===i||i||t.changeVisibility(i),e){t.updatePosition(r);var o=t.getShapeCfg(r),a=o.type,s=e.draw(a,o,n);s&&(t.set("keyShape",s),s.set("isKeyShape",!0),s.set("draggable",!0)),this.setOriginStyle(),this.set("currentShape",a),this.restoreStates(e,a)}},t.prototype.setOriginStyle=function(){var t=this.get("group"),e=t.get("children"),n=this.getKeyShape(),r=this,i=n.get("name");if(this.get("originStyle")){var o=this.get("originStyle");i&&!o[i]&&(o[i]={});var a=this.getCurrentStatesStyle(),s=function(t){var n=e[t],s=n.get("name"),u=n.attr();if(s&&s!==i){var l=a[s];o[s]||(o[s]={}),l?Object.keys(u).forEach((function(t){var e=u[t];e!==l[t]&&(o[s][t]=e)})):o[s]="image"!==n.get("type")?(0,_.clone)(u):r.getShapeStyleByName(s)}else{var c=n.attr(),h={};Object.keys(a).forEach((function(t){var e=a[t];t!==i&&(0,_.isPlainObject)(e)||(h[t]=e)})),Object.keys(c).forEach((function(t){var e=c[t];h[t]!==e&&(i?o[i][t]=e:o[t]=e)}))}};for(l=0;l<e.length;l++)s(l);delete o.path,delete o.matrix,delete o.x,delete o.y,o[i]&&(delete o[i].x,delete o[i].y,delete o[i].matrix,delete o[i].path),r.set("originStyle",o)}else{for(var u={},l=0;l<e.length;l++){var c=e[l],h=c.get("type"),f=c.get("name");if(f&&f!==i)u[f]="image"!==h?(0,_.clone)(c.attr()):r.getShapeStyleByName(f),"text"===h&&u[f]&&(delete u[f].x,delete u[f].y,delete u[f].matrix);else{var p=r.getShapeStyleByName();if(delete p.path,delete p.matrix,i)if(f)u[i]=p;else{var d=xa("shape");c.set("name",d),t.shapeMap[d]=c,u[d]="image"!==h?(0,_.clone)(c.attr()):r.getShapeStyleByName(f)}else Object.assign(u,p)}}r.set("originStyle",u)}},t.prototype.restoreStates=function(t,e){var n=this,r=n.get("states");(0,_.each)(r,(function(r){t.setState(e,r,!0,n)}))},t.prototype.init=function(){var t=ja.getFactory(this.get("type"));this.set("shapeFactory",t)},t.prototype.get=function(t){return this._cfg[t]},t.prototype.set=function(t,e){(0,_.isPlainObject)(t)?this._cfg=(0,y.__assign)((0,y.__assign)({},this._cfg),t):this._cfg[t]=e},t.prototype.getDefaultCfg=function(){return{}},t.prototype.clearCache=function(){this.set(Ua,null),this.set(Ga,null)},t.prototype.beforeDraw=function(){},t.prototype.afterDraw=function(){},t.prototype.afterUpdate=function(){},t.prototype.draw=function(){this.beforeDraw(),this.drawInner(),this.afterDraw()},t.prototype.getShapeStyleByName=function(t){var e,n=this.get("group");if(e=t?n.shapeMap[t]:this.getKeyShape()){var r={};return(0,_.each)(e.attr(),(function(t,e){("img"!==e||(0,_.isString)(t))&&(r[e]=t)})),r}return{}},t.prototype.getShapeCfg=function(t,e){var n=this.get("styles");if(n){var r=t;return r.style=(0,y.__assign)((0,y.__assign)({},n),t.style),r}return t},t.prototype.getStateStyle=function(t){var e=this.get("styles");return e&&e[t]},t.prototype.getOriginStyle=function(){return this.get("originStyle")},t.prototype.getCurrentStatesStyle=function(){var t=this,e={},n=t.getStates();return n&&n.length?((0,_.each)(t.getStates(),(function(n){e=Object.assign(e,t.getStateStyle(n))})),e):this.get("originStyle")},t.prototype.setState=function(t,e){var n=this.get("states"),r=this.get("shapeFactory"),i=t,o=t;(0,_.isString)(e)&&(i="".concat(t,":").concat(e),o="".concat(t,":"));var a=n;if((0,_.isBoolean)(e)){var s=n.indexOf(o);if(e){if(s>-1)return;n.push(i)}else s>-1&&n.splice(s,1)}else if((0,_.isString)(e)){var u=n.filter((function(t){return t.includes(o)}));u.length>0&&this.clearStates(u),(a=a.filter((function(t){return!t.includes(o)}))).push(i),this.set("states",a)}if(r){var l=this.get("model").type;r.setState(l,t,e,this)}},t.prototype.clearStates=function(t){var e=this,n=e.getStates(),r=e.get("shapeFactory"),i=e.get("model").type;t||(t=n),(0,_.isString)(t)&&(t=[t]);var o=n.filter((function(e){return-1===t.indexOf(e)}));e.set("states",o),t.forEach((function(t){r.setState(i,t,!1,e)}))},t.prototype.getContainer=function(){return this.get("group")},t.prototype.getKeyShape=function(){return this.get("keyShape")},t.prototype.getModel=function(){return this.get("model")},t.prototype.getType=function(){return this.get("type")},t.prototype.getID=function(){return this.get("id")},t.prototype.isItem=function(){return!0},t.prototype.getStates=function(){return this.get("states")},t.prototype.hasState=function(t){return this.getStates().indexOf(t)>=0},t.prototype.refresh=function(t){var e=this.get("model");this.updatePosition(e),this.updateShape(t),this.afterUpdate(),this.clearCache()},t.prototype.getUpdateType=function(t){},t.prototype.update=function(t,e){void 0===e&&(e=void 0);var n=this.get("model");if("move"===e)this.updatePosition(t);else{var r=n.visible,i=t.visible;r!==i&&void 0!==i&&this.changeVisibility(i);var o={x:n.x,y:n.y};t.x=isNaN(+t.x)?n.x:+t.x,t.y=isNaN(+t.y)?n.y:+t.y;var a=this.get("styles");if(t.stateStyles){var s=t.stateStyles;(0,_.mix)(a,s),delete t.stateStyles}Object.assign(n,t),o.x===t.x&&o.y===t.y||this.updatePosition(t),this.updateShape(e)}this.afterUpdate(),this.clearCache()},t.prototype.updateShape=function(t){var e=this.get("shapeFactory"),n=this.get("model"),r=n.type;if(e.shouldUpdate(r)&&r===this.get("currentShape")){var i=this.getShapeCfg(n,t);e.baseUpdate(r,i,this,t),"move"!==t&&this.setOriginStyle()}else this.draw();this.restoreStates(e,r)},t.prototype.updatePosition=function(t){var e=this.get("model"),n=isNaN(+t.x)?+e.x:+t.x,r=isNaN(+t.y)?+e.y:+t.y,i=this.get("group");if(isNaN(n)||isNaN(r))return!1;e.x=n,e.y=r;var o=i.getMatrix();return!(o&&o[6]===n&&o[7]===r||(i.resetMatrix(),He(i,{x:n,y:r}),this.clearCache(),0))},t.prototype.getBBox=function(){var t=this.get(Ua);return t||(t=this.calculateBBox(),this.set(Ua,t)),t},t.prototype.getCanvasBBox=function(){var t=this.get(Ga);return t||(t=this.calculateCanvasBBox(),this.set(Ga,t)),t},t.prototype.toFront=function(){this.get("group").toFront()},t.prototype.toBack=function(){this.get("group").toBack()},t.prototype.show=function(){this.changeVisibility(!0)},t.prototype.hide=function(){this.changeVisibility(!1)},t.prototype.changeVisibility=function(t){var e=this.get("group");t?e.show():e.hide(),this.set("visible",t)},t.prototype.isVisible=function(){return this.get("visible")},t.prototype.enableCapture=function(t){var e=this.get("group");e&&e.set("capture",t)},t.prototype.destroy=function(){if(!this.destroyed){var t=this.get("animate"),e=this.get("group");t&&e.stopAnimate(),e.shapeMap={},this.clearCache(),e.remove(),this._cfg=null,this.destroyed=!0}},t}();const Wa=Va;var Ha={source:"start",target:"end"},Xa="Node",Ya="Point",qa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.getDefaultCfg=function(){return{type:"edge",sourceNode:null,targetNode:null,startPoint:null,endPoint:null,linkCenter:!1}},e.prototype.setEnd=function(t,e){var n=Ha[t]+Ya,r=t+Xa,i=this.get(r);i&&!i.destroyed&&i.removeEdge(this),(0,_.isPlainObject)(e)?(this.set(n,e),this.set(r,null)):e&&(e.addEdge(this),this.set(r,e),this.set(n,null))},e.prototype.getLinkPoint=function(t,e,n){var r=Ha[t]+Ya,i=t+Xa,o=this.get(r);if(!o){var a=this.get(i),s=t+"Anchor",u=this.getPrePoint(t,n),l=e[s];(0,_.isNil)(l)||(o=a.getLinkPointByAnchor(l)),o=o||a.getLinkPoint(u),(0,_.isNil)(o.index)||this.set("".concat(t,"AnchorIndex"),o.index)}return o},e.prototype.getPrePoint=function(t,e){if(e&&e.length)return e["source"===t?0:e.length-1];var n="source"===t?"target":"source";return this.getEndPoint(n)},e.prototype.getEndPoint=function(t){var e=t+Xa,n=Ha[t]+Ya,r=this.get(e);return r?r.get("model"):this.get(n)},e.prototype.getControlPointsByCenter=function(t){var e=this.getEndPoint("source"),n=this.getEndPoint("target"),r=this.get("shapeFactory"),i=t.type;return r.getControlPoints(i,{startPoint:e,endPoint:n})},e.prototype.getEndCenter=function(t){var e=t+Xa,n=Ha[t]+Ya,r=this.get(e);if(r){var i=r.getBBox();return{x:i.centerX,y:i.centerY}}return this.get(n)},e.prototype.init=function(){t.prototype.init.call(this),this.setSource(this.get("source")),this.setTarget(this.get("target"))},e.prototype.getShapeCfg=function(e,n){var r=this,i=r.get("linkCenter"),o=(null==n?void 0:n.includes("move"))?e:t.prototype.getShapeCfg.call(this,e);if(i)o.startPoint=r.getEndCenter("source"),o.endPoint=r.getEndCenter("target");else{var a=o.controlPoints||r.getControlPointsByCenter(o);o.startPoint=r.getLinkPoint("source",e,a),o.endPoint=r.getLinkPoint("target",e,a)}return o.sourceNode=r.get("sourceNode"),o.targetNode=r.get("targetNode"),o},e.prototype.getModel=function(){var t=this.get("model"),e=this.get("source".concat(Xa)),n=this.get("target".concat(Xa));return e?delete t["source".concat(Xa)]:t.source=this.get("start".concat(Ya)),n?delete t["target".concat(Xa)]:t.target=this.get("end".concat(Ya)),(0,_.isString)(t.source)||(0,_.isPlainObject)(t.source)||(t.source=t.source.getID()),(0,_.isString)(t.target)||(0,_.isPlainObject)(t.target)||(t.target=t.target.getID()),t},e.prototype.setSource=function(t){this.setEnd("source",t),this.set("source",t)},e.prototype.setTarget=function(t){this.setEnd("target",t),this.set("target",t)},e.prototype.getSource=function(){return this.get("source")},e.prototype.getTarget=function(){return this.get("target")},e.prototype.updatePosition=function(){return!1},e.prototype.update=function(t,e){void 0===e&&(e=void 0);var n=this.get("model"),r=n.visible,i=t.visible;r!==i&&void 0!==i&&this.changeVisibility(i);var o=this.get("styles");if(t.stateStyles){var a=t.stateStyles;(0,_.mix)(o,a),delete t.stateStyles}Object.assign(n,t),this.updateShape(e),this.afterUpdate(),this.clearCache()},e.prototype.destroy=function(){var e=this.get("source".concat(Xa)),n=this.get("target".concat(Xa));e&&!e.destroyed&&e.removeEdge(this),n&&!n.destroyed&&n.removeEdge(this),t.prototype.destroy.call(this)},e}(Wa);const Ka=qa;var Qa="anchorPointsCache",Ja=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.getNearestPoint=function(t,e){for(var n=0,r=t[0],i=Ue(t[0],e),o=0;o<t.length;o++){var a=t[o],s=Ue(a,e);s<i&&(r=a,i=s,n=o)}return r.anchorIndex=n,r},e.prototype.getDefaultCfg=function(){return{type:"node",edges:[]}},e.prototype.getEdges=function(){return this.get("edges")},e.prototype.getInEdges=function(){var t=this;return this.get("edges").filter((function(e){return e.get("target")===t}))},e.prototype.getOutEdges=function(){var t=this;return this.get("edges").filter((function(e){return e.get("source")===t}))},e.prototype.getNeighbors=function(t){var e=this,n=this.get("edges");return"target"===t?n.filter((function(t){return t.getSource()===e})).map((function(t){return t.getTarget()})):"source"===t?n.filter((function(t){return t.getTarget()===e})).map((function(t){return t.getSource()})):n.map((function(t){return t.getSource()===e?t.getTarget():t.getSource()}))},e.prototype.getLinkPointByAnchor=function(t){return this.getAnchorPoints()[t]},e.prototype.getLinkPoint=function(t){var e,n,r=this.get("keyShape").get("type"),i=this.get("type"),o=this.getBBox();"combo"===i?(e=o.centerX||(o.maxX+o.minX)/2,n=o.centerY||(o.maxY+o.minY)/2):(e=o.centerX,n=o.centerY);var a,s=this.getAnchorPoints();switch(r){case"circle":a=Be({x:e,y:n,r:o.width/2},t);break;case"ellipse":a=ze({x:e,y:n,rx:o.width/2,ry:o.height/2},t);break;default:a=Ne(o,t)}var u=a;return s.length&&(u||(u=t),u=this.getNearestPoint(s,u)),u||(u={x:e,y:n}),u},e.prototype.getAnchorPoints=function(){var t=this.get(Qa);if(!t){t=[];var e=this.get("shapeFactory"),n=this.getBBox(),r=this.get("model"),i=this.getShapeCfg(r),o=r.type,a=e.getAnchorPoints(o,i)||[];(0,_.each)(a,(function(e,r){var i={x:n.minX+e[0]*n.width,y:n.minY+e[1]*n.height,anchorIndex:r};t.push(i)})),this.set(Qa,t)}return t},e.prototype.addEdge=function(t){this.get("edges").push(t)},e.prototype.lock=function(){this.set("locked",!0)},e.prototype.unlock=function(){this.set("locked",!1)},e.prototype.hasLocked=function(){return this.get("locked")},e.prototype.removeEdge=function(t){var e=this.getEdges(),n=e.indexOf(t);n>-1&&e.splice(n,1)},e.prototype.clearCache=function(){this.set("bboxCache",null),this.set(Qa,null)},e.prototype.getUpdateType=function(t){var e,n,r,i,o;if(t){var a=!(0,_.isNil)(t.x),s=!(0,_.isNil)(t.y),u=Object.keys(t);return 1===u.length&&(a||s)||2===u.length&&a&&s?"move":(0,_.isNumber)(t.x)||(0,_.isNumber)(t.y)||t.type||t.anchorPoints||t.size||(null==t?void 0:t.style)&&((null===(e=null==t?void 0:t.style)||void 0===e?void 0:e.r)||(null===(n=null==t?void 0:t.style)||void 0===n?void 0:n.width)||(null===(r=null==t?void 0:t.style)||void 0===r?void 0:r.height)||(null===(i=null==t?void 0:t.style)||void 0===i?void 0:i.rx)||(null===(o=null==t?void 0:t.style)||void 0===o?void 0:o.ry))?"bbox|label":u.includes("label")||u.includes("labelCfg")?"style|label":"style"}},e}(Wa);const $a=Ja;var ts="bboxCache",es="bboxCanvasCache",ns="sizeCache",rs="anchorPointsCache",is=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.getDefaultCfg=function(){return{type:"combo",nodes:[],edges:[],combos:[]}},e.prototype.getShapeCfg=function(t){var e=this.get("styles"),n=this.get("bbox");if(e&&n){var r=t,i={r:Math.hypot(n.height,n.width)/2||wn.defaultCombo.size[0]/2,width:n.width||wn.defaultCombo.size[0],height:n.height||wn.defaultCombo.size[1]};r.style=(0,y.__assign)((0,y.__assign)((0,y.__assign)({},e),t.style),i);var o=t.padding||wn.defaultCombo.padding;return(0,_.isNumber)(o)?(i.r+=o,i.width+=2*o,i.height+=2*o):(i.r+=o[0],i.width+=o[1]+o[3]||2*o[1],i.height+=o[0]+o[2]||2*o[0]),this.set(ns,i),r}return t},e.prototype.calculateCanvasBBox=function(){if(!this.destroyed){var t=this.get("keyShape"),e=this.get("group"),n=Mn(t,e);n.centerX=(n.minX+n.maxX)/2,n.centerY=(n.minY+n.maxY)/2;var r=this.get(ns),i=this.get(ts)||{},o=i.x,a=i.x;return r?(r.width=Math.max(r.width,n.width),r.height=Math.max(r.height,n.height),"circle"===t.get("type")?(n.width=2*r.r,n.height=2*r.r):(n.width=r.width,n.height=r.height),n.minX=n.centerX-n.width/2,n.minY=n.centerY-n.height/2,n.maxX=n.centerX+n.width/2,n.maxY=n.centerY+n.height/2):(n.width=n.maxX-n.minX,n.height=n.maxY-n.minY,n.centerX=(n.minX+n.maxX)/2,n.centerY=(n.minY+n.maxY)/2),n.x=n.minX,n.y=n.minY,n.x===o&&n.y===a||this.set(rs,null),n}},e.prototype.getChildren=function(){return{nodes:this.getNodes(),combos:this.getCombos()}},e.prototype.getNodes=function(){return this.get("nodes")},e.prototype.getCombos=function(){return this.get("combos")},e.prototype.addChild=function(t){switch(t.getType()){case"node":this.addNode(t);break;case"combo":this.addCombo(t);break;default:return console.warn("Only node or combo items are allowed to be added into a combo"),!1}return!0},e.prototype.addCombo=function(t){return this.get("combos").push(t),!0},e.prototype.addNode=function(t){return this.get("nodes").push(t),!0},e.prototype.removeChild=function(t){switch(t.getType()){case"node":this.removeNode(t);break;case"combo":this.removeCombo(t);break;default:return console.warn("Only node or combo items are allowed to be added into a combo"),!1}return!0},e.prototype.removeCombo=function(t){if(t){var e=this.getCombos(),n=e.indexOf(t);return n>-1&&(e.splice(n,1),!0)}},e.prototype.removeNode=function(t){if(t){var e=this.getNodes(),n=e.indexOf(t);return n>-1&&(e.splice(n,1),!0)}},e.prototype.getUpdateType=function(t){},e.prototype.getBBox=function(){return this.set(es,null),this.calculateCanvasBBox()},e.prototype.clearCache=function(){this.set(ts,null),this.set(es,null),this.set(rs,null)},e.prototype.destroy=function(){if(!this.destroyed){var t=this.get("animate"),e=this.get("group");t&&e.stopAnimate(),e.shapeMap={},this.clearCache(),this.set(ns,null),this.set("bbox",null),e.remove(),this._cfg=null,this.destroyed=!0}},e}($a);const os=is;var as="node",ss="edge",us="vedge",ls="combo",cs="Mapper",hs=function(){function t(t){var e=this;this.edgeToBeUpdateMap={},this.throttleRefresh=(0,_.throttle)((function(t){var n,r=e.graph;if(r&&!r.get("destroyed")){var i=e.edgeToBeUpdateMap;i&&(null===(n=Object.keys(i))||void 0===n?void 0:n.length)&&(Object.keys(i).forEach((function(t){var e=i[t].edge;e&&!e.destroyed&&e.refresh(i[t].updateType)})),e.edgeToBeUpdateMap={})}}),16,{trailing:!0,leading:!0}),this.graph=t,this.destroyed=!1}return t.prototype.addItem=function(t,e){var n=this.graph,r=t===us?ss:t,i=n.get("".concat(r,"Group"))||n.get("group"),o=(0,_.upperFirst)(r),a=null,s=n.get(r+(0,_.upperFirst)("stateStyles"))||{},u=n.get("default"+o);e.stateStyles&&(s=e.stateStyles),u&&(0,_.each)(u,(function(t,n){(0,_.isObject)(t)&&!(0,_.isArray)(t)?e[n]=(0,_.deepMix)({},t,e[n]):(0,_.isArray)(t)?e[n]=e[n]||(0,_.clone)(u[n]):e[n]=e[n]||u[n]}));var l=n.get(r+cs);if(l){var c=l(e);c.stateStyles&&(s=c.stateStyles,delete c.stateStyles),(0,_.each)(c,(function(t,n){(0,_.isObject)(t)&&!(0,_.isArray)(t)?e[n]=(0,_.deepMix)({},e[n],t):e[n]=c[n]||e[n]}))}if(n.emit("beforeadditem",{type:t,model:e}),t===ss||t===us){var h=void 0,f=void 0;if(h=e.source,f=e.target,h&&(0,_.isString)(h)&&(h=n.findById(h)),f&&(0,_.isString)(f)&&(f=n.findById(f)),!h||!f)return void console.warn("The source or target node of edge ".concat(e.id," does not exist!"));h.getType&&"combo"===h.getType()&&(e.isComboEdge=!0),f.getType&&"combo"===f.getType()&&(e.isComboEdge=!0),a=new Ka({model:e,source:h,target:f,styles:s,linkCenter:n.get("linkCenter"),group:i.addGroup()})}else if(t===as)a=new $a({model:e,styles:s,group:i.addGroup()});else if(t===ls){var p=e.children,d=Zn(p,n);isNaN(d.x)?isNaN(e.x)&&(e.x=100*Math.random()):e.x=d.x,isNaN(d.y)?isNaN(e.y)&&(e.y=100*Math.random()):e.y=d.y;var g=i.addGroup();g.setZIndex(e.depth);var v=(a=new os({model:e,styles:s,bbox:e.collapsed?Zn([],n):d,group:g})).getModel();(p||[]).forEach((function(t){var e=n.findById(t.id);a.addChild(e),t.depth=v.depth+2})),e.collapsed&&setTimeout((function(){a.destroyed||n.collapseCombo(a)}),0)}if(a)return n.get("".concat(t,"s")).push(a),n.get("itemMap")[a.get("id")]=a,n.emit("afteradditem",{item:a,model:e}),a},t.prototype.updateItem=function(t,e){var n,r,i=this,o=this.graph;if((0,_.isString)(t)&&(t=o.findById(t)),t&&!t.destroyed){var a="";t.getType&&(a=t.getType());var s=o.get(a+cs),u=t.getModel(),l=t.getUpdateType(e);if(s){var c=s((0,_.deepMix)({},u,e)),h=(0,_.deepMix)({},u,c,e);c.stateStyles&&(t.set("styles",h.stateStyles),delete h.stateStyles),(0,_.each)(h,(function(t,n){e[n]=t}))}else(0,_.each)(e,(function(t,n){u[n]&&(0,_.isObject)(t)&&!(0,_.isArray)(t)&&(e[n]=(0,y.__assign)((0,y.__assign)({},u[n]),e[n]))}));if(o.emit("beforeupdateitem",{item:t,cfg:e}),a===ss){if(e.source){var f=e.source;(0,_.isString)(f)&&(f=o.findById(f)),t.setSource(f)}if(e.target){var p=e.target;(0,_.isString)(p)&&(p=o.findById(p)),t.setTarget(p)}t.update(e)}if(a===as||a===ls){t.update(e,l);var d=t.getEdges(),g=(null==l?void 0:l.includes("bbox"))||"move"===l;if(a===as)"move"===l?(0,_.each)(d,(function(t){i.edgeToBeUpdateMap[t.getID()]={edge:t,updateType:l},i.throttleRefresh()})):g&&(0,_.each)(d,(function(t){t.refresh(l)}));else if(g&&a===ls){var v=t.get("shapeFactory"),m=u.type||"circle";(void 0===u.animate||void 0===e.animate?null===(r=null===(n=v[m])||void 0===n?void 0:n.options)||void 0===r?void 0:r.animate:u.animate||e.animate)?setTimeout((function(){if(t&&!t.destroyed){var e=t.getKeyShape();e&&!e.destroyed&&(0,_.each)(d,(function(t){t&&!t.destroyed&&t.refresh()}))}}),201):(0,_.each)(d,(function(t){t.refresh()}))}}o.emit("afterupdateitem",{item:t,cfg:e})}},t.prototype.updateCombo=function(t,e){var n,r,i=this,o=this.graph;if((0,_.isString)(t)&&(t=o.findById(t)),t&&!t.destroyed){var a=t.getModel(),s=Zn(e,o,t),u=s.x,l=s.y;t.set("bbox",s),t.update({x:u||a.x,y:l||a.y});var c=t.get("shapeFactory"),h=a.type||"circle";(void 0===a.animate?null===(r=null===(n=c[h])||void 0===n?void 0:n.options)||void 0===r?void 0:r.animate:a.animate)?setTimeout((function(){if(t&&!t.destroyed){var e=t.getKeyShape();e&&!e.destroyed&&(t.getShapeCfg(a),i.updateComboEdges(t))}}),201):this.updateComboEdges(t)}},t.prototype.updateComboEdges=function(t){for(var e=t.getEdges()||[],n=0;n<e.length;n++){var r=e[n];if(r&&!r.destroyed){var i=r.get("shapeFactory"),o=r.getShapeCfg(r.getModel()),a=r.getContainer();a.clear();var s=i.draw(o.type,o,a);r.set("keyShape",s),s.set("isKeyShape",!0),s.set("draggable",!0),r.setOriginStyle()}}},t.prototype.collapseCombo=function(t){var e=this.graph;(0,_.isString)(t)&&(t=e.findById(t));var n=t.getChildren();n.nodes.forEach((function(t){e.hideItem(t)})),n.combos.forEach((function(t){e.hideItem(t)}))},t.prototype.expandCombo=function(t){var e=this.graph;(0,_.isString)(t)&&(t=e.findById(t));var n=t.getChildren();n.nodes.forEach((function(t){e.showItem(t)})),n.combos.forEach((function(t){t.getModel().collapsed?t.show():e.showItem(t)}))},t.prototype.removeItem=function(t){var e=this,n=this.graph;if((0,_.isString)(t)&&(t=n.findById(t)),t&&!t.destroyed){var r=(0,_.clone)(t.getModel());n.emit("beforeremoveitem",{item:r});var i="";t.getType&&(i=t.getType());var o=n.get("".concat(i,"s")),a=o.indexOf(t);if(a>-1&&o.splice(a,1),i===ss){var s=n.get("v".concat(i,"s")),u=s.indexOf(t);u>-1&&s.splice(u,1)}var l=t.get("id");delete n.get("itemMap")[l];var c=n.get("comboTrees"),h=t.get("id");if(i===as){var f=t.getModel().comboId;if(c&&f){var p=c,d=!1;c.forEach((function(t){d||Ln(t,(function(t){if(t.id===h&&p){var e=p.indexOf(t);return p.splice(e,1),d=!0,!1}return p=t.children,!0}))}))}for(var g=(m=t.getEdges()).length-1;g>=0;g--)n.removeItem(m[g],!1);f&&n.updateCombo(f)}else if(i===ls){var v,m,y=t.getModel().parentId,b=!1;for((c||[]).forEach((function(t){b||Ln(t,(function(t){return t.id!==h||(v=t,b=!0,!1)}))})),v.removed=!0,v&&v.children&&v.children.forEach((function(t){e.removeItem(t.id)})),g=(m=t.getEdges()).length;g>=0;g--)n.removeItem(m[g],!1);y&&n.updateCombo(y)}t.destroy(),n.emit("afterremoveitem",{item:r,type:i})}},t.prototype.setItemState=function(t,e,n){var r=this.graph,i=e;(0,_.isString)(n)&&(i="".concat(e,":").concat(n)),t.hasState(i)===n&&n||(0,_.isString)(n)&&t.hasState(i)||(r.emit("beforeitemstatechange",{item:t,state:i,enabled:n}),t.setState(e,n),r.autoPaint(),r.emit("afteritemstatechange",{item:t,state:i,enabled:n}))},t.prototype.priorityState=function(t,e){var n=this.graph,r=t;(0,_.isString)(t)&&(r=n.findById(t)),this.setItemState(r,e,!1),this.setItemState(r,e,!0)},t.prototype.clearItemStates=function(t,e){var n=this.graph;(0,_.isString)(t)&&(t=n.findById(t)),n.emit("beforeitemstatesclear",{item:t,states:e}),t.clearStates(e),n.emit("afteritemstatesclear",{item:t,states:e})},t.prototype.refreshItem=function(t){var e=this.graph;(0,_.isString)(t)&&(t=e.findById(t)),e.emit("beforeitemrefresh",{item:t}),t.refresh(),e.emit("afteritemrefresh",{item:t})},t.prototype.addCombos=function(t,e){var n=this,r=this.graph;(t||[]).forEach((function(t){Dn(t,(function(t){var r;return e.forEach((function(e){e.id===t.id&&(e.children=t.children,e.depth=t.depth,r=e)})),r&&n.addItem("combo",r),!0}))}));var i=r.get("comboGroup");i&&i.sort()},t.prototype.changeItemVisibility=function(t,e){var n=this,r=this.graph;if((0,_.isString)(t)&&(t=r.findById(t)),t){if(r.emit("beforeitemvisibilitychange",{item:t,visible:e}),t.changeVisibility(e),t.getType&&t.getType()===as){var i=t.getEdges();(0,_.each)(i,(function(t){(!e||t.get("source").isVisible()&&t.get("target").isVisible())&&n.changeItemVisibility(t,e)}))}else if(t.getType&&t.getType()===ls){var o=r.get("comboTrees"),a=t.get("id"),s=[],u=!1;(o||[]).forEach((function(t){u||t.children&&0!==t.children.length&&Ln(t,(function(t){return t.id!==a||(s=t.children,u=!0,!1)}))})),s&&(!e||e&&!t.getModel().collapsed)&&s.forEach((function(t){var i=r.findById(t.id);n.changeItemVisibility(i,e)})),i=t.getEdges(),(0,_.each)(i,(function(t){(!e||t.get("source").isVisible()&&t.get("target").isVisible())&&n.changeItemVisibility(t,e)}))}return r.emit("afteritemvisibilitychange",{item:t,visible:e}),t}console.warn("The item to be shown or hidden does not exist!")},t.prototype.destroy=function(){this.graph=null,this.destroyed=!0},t}();const fs=hs;var ps=null,ds=function(){function t(t){this.graph=t,this.cachedStates={enabled:{},disabled:{}},this.destroyed=!1}return t.checkCache=function(t,e,n){if(n[e]){var r=n[e].indexOf(t);r>=0&&n[e].splice(r,1)}},t.cacheState=function(t,e,n){n[e]||(n[e]=[]),n[e].push(t)},t.prototype.updateState=function(e,n,r){var i=this,o=t.checkCache,a=t.cacheState;if(!e.destroyed){var s=this.cachedStates,u=s.enabled,l=s.disabled;r?(o(e,n,l),a(e,n,u)):(o(e,n,u),a(e,n,l)),ps&&clearTimeout(ps),ps=setTimeout((function(){ps=null,i.updateGraphStates()}),16)}},t.prototype.updateStates=function(t,e,n){var r=this;(0,_.isString)(e)?this.updateState(t,e,n):e.forEach((function(e){r.updateState(t,e,n)}))},t.prototype.updateGraphStates=function(){var t=this.graph.get("states"),e=this.cachedStates;(0,_.each)(e.disabled,(function(e,n){t[n]&&(t[n]=t[n].filter((function(t){return e.indexOf(t)<0&&!e.destroyed})))})),(0,_.each)(e.enabled,(function(e,n){if(t[n]){var r={};t[n].forEach((function(t){t.destroyed||(r[t.get("id")]=!0)})),e.forEach((function(e){if(!e.destroyed){var i=e.get("id");r[i]||(r[i]=!0,t[n].push(e))}}))}else t[n]=e})),this.graph.emit("graphstatechange",{states:t}),this.cachedStates={enabled:{},disabled:{}}},t.prototype.destroy=function(){this.graph=null,this.cachedStates=null,ps&&clearTimeout(ps),ps=null,this.destroyed=!0},t}();const gs=ds;var vs=function(t,e){return t&&e?t.replace(/\\?\{([^{}]+)\}/g,(function(t,n){if("\\"===t.charAt(0))return t.slice(1);var r=e[n];return 0===r&&(r="0"),r||""})):t},ms=function(t){var e=[];if(t.length<2)throw new Error("point length must largn than 2, now it's ".concat(t.length));for(var n=0,r=t;n<r.length;n++){var i=r[n],o=i.x,a=i.y;e.push(o),e.push(a)}var s=oa(e);return s.unshift(["M",t[0].x,t[0].y]),s},ys=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i={x:(1-n)*t.x+n*e.x,y:(1-n)*t.y+n*e.y},o=[0,0];Ie.Fv(o,[e.x-t.x,e.y-t.y]),o&&(o[0]||o[1])||(o=[0,0]);var a=[-o[1]*r,o[0]*r];return i.x+=a[0],i.y+=a[1],i},_s=function(t,e){var n=t.length;if(!n)return"";for(var r="",i=0;i<n;i++){var o=t[i];r+=vs(0===i?"M{x} {y}":"L{x} {y}",o)}return e&&(r+="Z"),r},bs=function(t){var e=[];return t.forEach((function(t){if("A"!==t[0])for(var n=1;n<t.length;n+=2)e.push([t[n],t[n+1]]);else{var r=t.length;e.push([t[r-2],t[r-1]])}})),e},xs=function(t){if(t.length<2)throw new Error("point length must largn than 2, now it's ".concat(t.length));var e=t[0],n=t[1],r=t[t.length-1],i=t[t.length-2];t.unshift(r),t.unshift(i),t.push(e),t.push(n);for(var o=[],a=1;a<t.length-2;a+=1){var s=t[a-1].x,u=t[a-1].y,l=t[a].x,c=t[a].y,h=t[a+1].x,f=t[a+1].y,p=l+(h-s)/6,d=c+(f-u)/6,g=h-((a!==t.length-2?t[a+2].x:h)-l)/6,v=f-((a!==t.length-2?t[a+2].y:f)-c)/6;o.push(["C",p,d,g,v,h,f])}return o.unshift(["M",r.x,r.y]),o},ws=function(t,e){return Ie.bA([0,0],Ie.Fv([0,0],t),e)},Es=function(t,e){var n=[t[1]-e[1],e[0]-t[0]],r=Math.sqrt(n[0]*n[0]+n[1]*n[1]);if(0===r)throw new Error("p0 should not be equal to p1");return[n[0]/r,n[1]/r]},Ss=function(t,e){return[e[0]-t[0],e[1]-t[1]]};function Cs(t,e){if(!t||t.length<1)return"";if(1===t.length)return function(t){var n=[t[0][0],t[0][1]-e],r=[t[0][0],t[0][1]+e];return"M ".concat(n," A ").concat(e,",").concat(e,",0,0,0,").concat(r," A ").concat(e,",").concat(e,",0,0,0,").concat(n)}(t);if(2===t.length)return function(t){var n=Ie.bA([0,0],Es(t[0],t[1]),e),r=Ie.bA([0,0],n,-1),i=Ie.IH([0,0],t[0],n),o=Ie.IH([0,0],t[1],n),a=Ie.IH([0,0],t[1],r),s=Ie.IH([0,0],t[0],r);return"M ".concat(i," L ").concat(o," A ").concat([e,e,"0,0,0",a].join(",")," L ").concat(s," A ").concat([e,e,"0,0,0",i].join(","))}(t);for(var n=new Array(t.length),r=0;r<n.length;++r){var i=0===r?t[t.length-1]:t[r-1],o=t[r],a=Ie.bA([0,0],Es(i,o),e);n[r]=[Ie.IH([0,0],i,a),Ie.IH([0,0],o,a)]}var s="A ".concat([e,e,"0,0,0,"].join(","));return n=n.map((function(t,e){var r="";return 0===e&&(r="M ".concat(n[n.length-1][1]," ")),r+"".concat(s+t[0]," L ").concat(t[1])})),n.join(" ")}function As(t,e){var n,r,i,o=t.length;if(!t||o<1)return"";if(1===o)return r=[(n=t)[0][0],n[0][1]-e],i=[n[0][0],n[0][1]+e],"M ".concat(r," A ").concat([e,e,"0,0,0",i].join(",")," A ").concat([e,e,"0,0,0",r].join(","));if(2===o)return function(t){var n=Ss(t[0],t[1]),r=ws(n,e),i=Ie.IH([0,0],t[0],Ie.bA([0,0],r,-1)),o=Ie.IH([0,0],t[1],r),a=1.2*e,s=ws(Ie.Fv([0,0],n),a),u=Ie.bA([0,0],s,-1),l=Ie.IH([0,0],i,u),c=Ie.IH([0,0],o,u),h=Ie.IH([0,0],i,s);return"M ".concat(i," C ").concat([l,c,o].join(",")," S ").concat([h,i].join(",")," Z")}(t);for(var a=t.map((function(e,n){var r=t[(n+1)%o];return{p:e,v:Ie.Fv([0,0],Ss(e,r))}})),s=0;s<a.length;++s){var u=s>0?s-1:o-1,l=Ie.Fv([0,0],Ie.IH([0,0],a[u].v,Ie.bA([0,0],a[s].v,-1)));a[s].p=Ie.IH([0,0],a[s].p,Ie.bA([0,0],l,e))}return a.map((function(t){var e=t.p;return{x:e[0],y:e[1]}}))}var Ts=function(t,e,n){return(t.y-n.y)*(e.x-n.x)-(t.x-n.x)*(e.y-n.y)},ks=function(t){var e=t.map((function(t){return{x:t.getModel().x,y:t.getModel().y}}));if(e.sort((function(t,e){return t.x===e.x?t.y-e.y:t.x-e.x})),1===e.length)return e;for(var n=[],r=0;r<e.length;r++){for(;n.length>=2&&Ts(n[n.length-2],n[n.length-1],e[r])<=0;)n.pop();n.push(e[r])}var i=[];for(r=e.length-1;r>=0;r--){for(;i.length>=2&&Ts(i[i.length-2],i[i.length-1],e[r])<=0;)i.pop();i.push(e[r])}return i.pop(),n.pop(),n.concat(i)},Ms={maxRoutingIterations:100,maxMarchingIterations:100,pixelGroupSize:2,edgeR0:10,edgeR1:10,nodeR0:5,nodeR1:10,morphBuffer:5,threshold:.001,skip:16,nodeInfluenceFactor:1,edgeInfluenceFactor:1,negativeNodeInfluenceFactor:-.5};function Ps(t,e,n){var r=!1,i=function(t,n){return e.cells[t+n*e.width]},o=function(t,e){var r=0;return i(t-1,e-1)>=n&&(r+=1),i(t,e-1)>n&&(r+=2),i(t-1,e)>n&&(r+=4),i(t,e)>n&&(r+=8),r},a=function(n,r){for(var i,a,s=n,u=r,l=0;l<e.width*e.height;l++){if(i=s,a=u,t.findIndex((function(t){return t.x===s&&t.y===u}))>-1){if(t[0].x===s&&t[0].y===u)return!0}else t.push({x:s,y:u});var c=o(s,u);switch(c){case-1:return console.warn("Marched out of bounds"),!0;case 0:case 3:case 2:case 7:s++;break;case 12:case 14:case 4:s--;break;case 6:0===i&&(-1===a?s-=1:s+=1);break;case 1:case 13:case 5:u--;break;case 9:1===i&&(0===a?u-=1:u+=1);break;case 10:case 8:case 11:u++;break;default:return console.warn("Marching squares invalid state: ".concat(c)),!0}}};this.march=function(){for(var t=0;t<e.width&&!r;t+=1)for(var s=0;s<e.height&&!r;s+=1)i(t,s)>n&&15!==o(t,s)&&(r=a(t,s));return r}}var Is=function(t,e){var n=Number.POSITIVE_INFINITY,r=null;return t.forEach((function(t){var i=an(t,e);i>=0&&i<n&&(r=t,n=i)})),r};var Os=function(t,e,n){var r=Object.assign(Ms,n),i=sn(t.map((function(t){return{x:t.getModel().x,y:t.getModel().y}})));t=t.sort((function(t,e){return un({x:t.getModel().x,y:t.getModel().y},i)-un({x:e.getModel().x,y:e.getModel().y},i)}));var o=[],a=[];t.forEach((function(t){(function(t,e,n,r,i){var o=function(t,e,n){var r=null,i=Number.POSITIVE_INFINITY;return e.forEach((function(e){var o={x:t.getModel().x,y:t.getModel().y},a={x:e.getModel().x,y:e.getModel().y},s=un(o,a),u=new en(o.x,o.y,a.x,a.y),l=n.reduce((function(t,e){return an(e,u)>0?t+1:t}),0);s*Math.pow(l+1,2)<i&&(r=e,i=s*Math.pow(l+1,2))})),r}(t,n,e);if(null===o)return[];var a=function(t,e,n,r){var i=[],o=[];o.push(t);for(var a=!0,s=0,u=function(t,e){var n=!1;return e.forEach((function(e){n||(cn(t,{x:e.x1,y:e.y1})||cn(t,{x:e.x2,y:e.y2}))&&(n=!0)})),n},l=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n].getBBox(),o=[[i.x,i.y],[i.x+i.width,i.y],[i.x,i.y+i.height],[i.x+i.width,i.y+i.height]];if(Je(o,t.x,t.y))return!0}return!1};a&&s<n;){a=!1;for(var c=function(){var t=o.pop(),n=Is(e,t);if(n){var c=on(n,t),h=c[0];if(2===c[1]){var f=function(s){for(var c=r,f=Ls(n,c,h,s),p=u(f,o)||u(f,i),d=l(f,e);!p&&d&&c>=1;)f=Ls(n,c/=1.5,h,s),p=u(f,o)||u(f,i),d=l(f,e);!f||p||s&&d||(o.push(new en(t.x1,t.y1,f.x,f.y)),o.push(new en(f.x,f.y,t.x2,t.y2)),a=!0)};f(!0),a||f(!1)}}a||i.push(t),s+=1};!a&&o.length;)c()}for(;o.length;)i.push(o.pop());return i}(new en(t.getModel().x,t.getModel().y,o.getModel().x,o.getModel().y),e,r,i),s=function(t){for(var n=[];t.length>0;){var r=t.pop();if(0===t.length){n.push(r);break}var i=t.pop(),o=new en(r.x1,r.y1,i.x2,i.y2);Is(e,o)?(n.push(r),t.push(i)):t.push(o)}return n}(a);return s})(t,e,o,r.maxRoutingIterations,r.morphBuffer).forEach((function(t){a.push(t)})),o.push(t)}));for(var s=function(t,e,n){var r={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY,width:0,height:0,x:0,y:0},i=[];t.forEach((function(t){i.push(t.getBBox())})),e.forEach((function(t){i.push(t.getBBox())}));for(var o=0,a=i;o<a.length;o++){var s=a[o];r.minX=(s.minX<r.minX?s.minX:r.minX)-n,r.minY=(s.minY<r.minY?s.minY:r.minY)-n,r.maxX=(s.maxX>r.maxX?s.maxX:r.maxX)+n,r.maxY=(s.maxY>r.maxY?s.maxY:r.maxY)+n}return r.width=r.maxX-r.minX,r.height=r.maxY-r.minY,r.x=r.minX,r.y=r.minY,r}(t,a,r.nodeR0),u=function(t,e,n){var r=Math.ceil(t/n),i=Math.ceil(e/n);return{cells:new Float32Array(Math.max(0,r*i)).fill(0),width:r,height:i}}(s.width,s.height,r.pixelGroupSize),l=[],c=[],h=0;h<r.maxMarchingIterations;h++)if(Rs(t,e,a,s,u,r),c=[],new Ps(l=[],u,r.threshold).march()){var f=l.map((function(t){return{x:Math.round(t.x*r.pixelGroupSize+s.minX),y:Math.round(t.y*r.pixelGroupSize+s.minY)}}));if(f){var p=f.length;if(r.skip>1)for(p=Math.floor(f.length/r.skip);p<3&&r.skip>1;)r.skip-=1,p=Math.floor(f.length/r.skip);for(var d=0,g=0;g<p;g+=1,d+=r.skip)c.push({x:f[d].x,y:f[d].y})}if(c&&function(){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=c.map((function(t){return[t.x,t.y]}));if(!Je(i,r.getBBox().centerX,r.getBBox().centerY))return!1}return!0}())return c;if(r.threshold*=.9,h<=.5*r.maxMarchingIterations)r.memberInfluenceFactor*=1.2,r.edgeInfluenceFactor*=1.2;else{if(!(0!==r.nonMemberInfluenceFactor&&e.length>0))break;r.nonMemberInfluenceFactor*=.8}}return c};function Rs(t,e,n,r,i,o){function a(t,e){var n=Math.floor((t-e)/o.pixelGroupSize);return n<0?0:n}function s(t,e){return t*o.pixelGroupSize+e}var u=(o.nodeR0-o.nodeR1)*(o.nodeR0-o.nodeR1),l=(o.edgeR0-o.edgeR1)*(o.edgeR0-o.edgeR1),c=function(t,e){return[Math.min(a(t.minX,e+r.minX),i.width),Math.min(a(t.minY,e+r.minY),i.height),Math.min(a(t.maxX,-e+r.minX),i.width),Math.min(a(t.maxY,-e+r.minY),i.height)]},h=function(t,e){for(var n=t.getBBox(),a=c(n,o.nodeR1),u=a[0],l=a[1],h=a[2],f=a[3],p=l;p<f;p+=1)for(var d=u;d<h;d+=1)if(!(e<0&&i[d+p*i.width]<=0)){var g=s(d,r.minX),v=s(p,r.minY),m=hn({x:g,y:v},{x:n.minX,y:n.minY,width:n.width,height:n.height});if(m<Math.pow(o.nodeR1,2)){var y=Math.sqrt(m)-o.nodeR1;i.cells[d+p*i.width]+=e*y*y}}};o.nodeInfluenceFactor&&t.forEach((function(t){h(t,o.nodeInfluenceFactor/u)})),o.edgeInfluenceFactor&&n.forEach((function(t){!function(t,e){for(var n=t.getBBox(),a=c(n,o.edgeR1),u=a[0],l=a[1],h=a[2],f=a[3],p=l;p<f;p+=1)for(var d=u;d<h;d+=1)if(!(e<0&&i.cells[d+p*i.width]<=0)){var g=s(d,r.minX),v=s(p,r.minY),m=ln({x:g,y:v},t);if(m<Math.pow(o.edgeR1,2)){var y=Math.sqrt(m)-o.edgeR1;i.cells[d+p*i.width]+=e*y*y}}}(t,o.edgeInfluenceFactor/l)})),o.negativeNodeInfluenceFactor&&e.forEach((function(t){h(t,o.negativeNodeInfluenceFactor/u)}))}function Ls(t,e,n,r){var i=t.getBBox(),o=n[0],a=n[1],s=n[2],u=n[3],l={topLeft:{x:i.minX-e,y:i.minY-e},topRight:{x:i.maxX+e,y:i.minY-e},bottomLeft:{x:i.minX-e,y:i.maxY+e},bottomRight:{x:i.maxX+e,y:i.maxY+e}},c=i.height*i.width;function h(t,e){return i.width*(.5*(t.y-i.minY+(e.y-i.minY)))}if(a)return o?r?l.topLeft:l.bottomRight:s?r?l.bottomLeft:l.topRight:h(a,u)<.5*c?a.y>u.y?r?l.topLeft:l.bottomRight:r?l.topRight:l.bottomLeft:a.y<u.y?r?l.bottomLeft:l.topRight:r?l.bottomRight:l.topLeft;if(u){if(o)return r?l.topRight:l.bottomLeft;if(s)return r?l.bottomRight:l.topLeft}return h(o,s)<.5*c?o.x>s.x?r?l.topLeft:l.bottomRight:r?l.bottomLeft:l.topRight:o.x<s.x?r?l.topRight:l.bottomLeft:r?l.bottomRight:l.topLeft}var Ds=function(){function t(t,e){this.cfg=(0,_.deepMix)(this.getDefaultCfg(),e),this.graph=t,this.id=this.cfg.id,this.group=this.cfg.group,this.members=this.cfg.members.map((function(e){return(0,_.isString)(e)?t.findById(e):e})),this.nonMembers=this.cfg.nonMembers.map((function(e){return(0,_.isString)(e)?t.findById(e):e})),this.setPadding(),this.setType(),this.path=this.calcPath(this.members,this.nonMembers),this.render()}return t.prototype.getDefaultCfg=function(){return{id:"g6-hull",type:"round-convex",members:[],nonMembers:[],style:{fill:"lightblue",stroke:"blue",opacity:.2},padding:10}},t.prototype.setPadding=function(){var t=this.members.length&&this.members[0].getKeyShape().getCanvasBBox().width/2;this.padding=this.cfg.padding>0?this.cfg.padding+t:10+t,this.cfg.bubbleCfg={nodeR0:this.padding-t,nodeR1:this.padding-t,morphBuffer:this.padding-t}},t.prototype.setType=function(){this.type=this.cfg.type,this.members.length<3&&(this.type="round-convex"),"round-convex"!==this.type&&"smooth-convex"!==this.type&&"bubble"!==this.type&&(console.warn("The hull type should be either round-convex, smooth-convex or bubble, round-convex is used by default."),this.type="round-convex")},t.prototype.calcPath=function(t,e){var n,r,i;switch(this.type){case"round-convex":r=ua(i=Cs((n=ks(t)).map((function(t){return[t.x,t.y]})),this.padding));break;case"smooth-convex":2===(n=ks(t)).length?r=ua(i=Cs(n.map((function(t){return[t.x,t.y]})),this.padding)):n.length>2&&(i=As(n.map((function(t){return[t.x,t.y]})),this.padding),r=xs(i));break;case"bubble":r=(n=Os(t,e,this.cfg.bubbleCfg)).length>=2&&xs(n)}return r},t.prototype.render=function(){this.group.addShape("path",{attrs:(0,y.__assign)({path:this.path},this.cfg.style),id:this.id,name:this.cfg.id,capture:!1}),this.group.toBack()},t.prototype.addMember=function(t){if(t){(0,_.isString)(t)&&(t=this.graph.findById(t)),this.members.push(t);var e=this.nonMembers.indexOf(t);return e>-1&&this.nonMembers.splice(e,1),this.updateData(this.members,this.nonMembers),!0}},t.prototype.addNonMember=function(t){if(t){(0,_.isString)(t)&&(t=this.graph.findById(t)),this.nonMembers.push(t);var e=this.members.indexOf(t);return e>-1&&this.members.splice(e,1),this.updateData(this.members,this.nonMembers),!0}},t.prototype.removeMember=function(t){if(t){(0,_.isString)(t)&&(t=this.graph.findById(t));var e=this.members.indexOf(t);return e>-1&&(this.members.splice(e,1),this.updateData(this.members,this.nonMembers),!0)}},t.prototype.removeNonMember=function(t){if(t){(0,_.isString)(t)&&(t=this.graph.findById(t));var e=this.nonMembers.indexOf(t);return e>-1&&(this.nonMembers.splice(e,1),this.updateData(this.members,this.nonMembers),!0)}},t.prototype.updateData=function(t,e){var n=this;this.group.findById(this.id).remove(),t&&(this.members=t.map((function(t){return(0,_.isString)(t)?n.graph.findById(t):t}))),e&&(this.nonMembers=e.map((function(t){return(0,_.isString)(t)?n.graph.findById(t):t}))),this.path=this.calcPath(this.members,this.nonMembers),this.render()},t.prototype.updateStyle=function(t){this.group.findById(this.id).attr((0,y.__assign)({},t))},t.prototype.updateCfg=function(t){var e=this;this.cfg=(0,_.deepMix)(this.cfg,t),this.id=this.cfg.id,this.group=this.cfg.group,t.members&&(this.members=this.cfg.members.map((function(t){return(0,_.isString)(t)?e.graph.findById(t):t}))),t.nonMembers&&(this.nonMembers=this.cfg.nonMembers.map((function(t){return(0,_.isString)(t)?e.graph.findById(t):t}))),this.setPadding(),this.setType(),this.path=this.calcPath(this.members,this.nonMembers),this.render()},t.prototype.contain=function(t){var e,n,r=this,i=(e=(0,_.isString)(t)?this.graph.findById(t):t).getKeyShape();if("path"===e.get("type"))n=bs(i.attr("path"));else{var o=i.getCanvasBBox();n=[[o.minX,o.minY],[o.maxX,o.minY],[o.maxX,o.maxY],[o.minX,o.maxY]]}return n=n.map((function(t){var e=r.graph.getPointByCanvas(t[0],t[1]);return[e.x,e.y]})),tn(n,bs(this.path))},t.prototype.destroy=function(){this.group.remove(),this.cfg=null},t}();const Ns=Ds;var Bs=ut,zs=function(t){function e(e){var n=t.call(this)||this;return n.cfg=(0,_.deepMix)(n.getDefaultCfg(),e),n.init(),n.animating=!1,n.destroyed=!1,n.cfg.enabledStack&&(n.undoStack=new Te(n.cfg.maxStep),n.redoStack=new Te(n.cfg.maxStep)),n}return(0,y.__extends)(e,t),e.prototype.init=function(){this.initCanvas();var t=new Ma(this),e=new Wn(this),n=new fs(this),r=new gs(this);this.set({viewController:t,modeController:e,itemController:n,stateController:r}),this.initLayoutController(),this.initEventController(),this.initGroups(),this.initPlugins()},e.prototype.initGroups=function(){var t=this.get("canvas");if(t){var e=(t.get("el")||{}).id,n=void 0===e?"g6":e,r=t.addGroup({id:"".concat(n,"-root"),className:wn.rootContainerClassName});if(this.get("groupByTypes")){var i=r.addGroup({id:"".concat(n,"-edge"),className:wn.edgeContainerClassName}),o=r.addGroup({id:"".concat(n,"-node"),className:wn.nodeContainerClassName}),a=r.addGroup({id:"".concat(n,"-combo"),className:wn.comboContainerClassName});a.toBack(),this.set({nodeGroup:o,edgeGroup:i,comboGroup:a})}var s=r.addGroup({id:"".concat(n,"-delegate"),className:wn.delegateContainerClassName});this.set({delegateGroup:s}),this.set("group",r)}},e.prototype.getDefaultCfg=function(){return{container:void 0,width:void 0,height:void 0,renderer:"canvas",modes:{},plugins:[],data:{},fitViewPadding:10,minZoom:.2,maxZoom:10,event:!0,groupByTypes:!0,directed:!1,autoPaint:!0,nodes:[],edges:[],combos:[],vedges:[],itemMap:{},linkCenter:!1,defaultNode:{},defaultEdge:{},nodeStateStyles:{},edgeStateStyles:{},states:{},animate:!1,animateCfg:{onFrame:void 0,duration:500,easing:"easeLinear"},callback:void 0,enabledStack:!1,maxStep:10,tooltips:[]}},e.prototype.set=function(t,e){return(0,_.isPlainObject)(t)?this.cfg=(0,y.__assign)((0,y.__assign)({},this.cfg),t):this.cfg[t]=e,this},e.prototype.get=function(t){var e;return null===(e=this.cfg)||void 0===e?void 0:e[t]},e.prototype.getGroup=function(){return this.get("group")},e.prototype.getContainer=function(){return this.get("container")},e.prototype.getMinZoom=function(){return this.get("minZoom")},e.prototype.setMinZoom=function(t){return this.set("minZoom",t)},e.prototype.getMaxZoom=function(){return this.get("maxZoom")},e.prototype.setMaxZoom=function(t){return this.set("maxZoom",t)},e.prototype.getWidth=function(){return this.get("width")},e.prototype.getHeight=function(){return this.get("height")},e.prototype.clearItemStates=function(t,e){(0,_.isString)(t)&&(t=this.findById(t));var n=this.get("itemController");e||(e=t.get("states")),n.clearItemStates(t,e),this.get("stateController").updateStates(t,e,!1)},e.prototype.node=function(t){"function"==typeof t&&this.set("nodeMapper",t)},e.prototype.edge=function(t){"function"==typeof t&&this.set("edgeMapper",t)},e.prototype.combo=function(t){"function"==typeof t&&this.set("comboMapper",t)},e.prototype.findById=function(t){return this.get("itemMap")[t]},e.prototype.find=function(t,e){var n,r=this.get("".concat(t,"s"));return(0,_.each)(r,(function(t,r){if(e(t,r))return n=t})),n},e.prototype.findAll=function(t,e){var n=[];return(0,_.each)(this.get("".concat(t,"s")),(function(t,r){e(t,r)&&n.push(t)})),n},e.prototype.findAllByState=function(t,e){return this.findAll(t,(function(t){return t.hasState(e)}))},e.prototype.getAnimateCfgWithCallback=function(t){var e,n=t.animateCfg,r=t.callback;if(n)if(e=(0,_.clone)(n),n.callback){var i=n.callback;e.callback=function(){r(),i()}}else e.callback=r;else e={duration:500,callback:r};return e},e.prototype.translate=function(t,e,n,r){var i=this,o=this.get("group"),a=(0,_.clone)(o.getMatrix());if(a||(a=[1,0,0,0,1,0,0,0,1]),n){var s=this.getAnimateCfgWithCallback({animateCfg:r,callback:function(){return i.emit("viewportchange",{action:"translate",matrix:o.getMatrix()})}});Xe(o,{x:o.getCanvasBBox().x+t,y:o.getCanvasBBox().y+e},n,s||{duration:500,easing:"easeCubic"})}else a=Bs(a,[["t",t,e]]),o.setMatrix(a),this.emit("viewportchange",{action:"translate",matrix:a}),this.autoPaint()},e.prototype.moveTo=function(t,e,n,r){var i=this.get("group");Xe(i,{x:t,y:e},n,r||{duration:500,easing:"easeCubic"}),this.emit("viewportchange",{action:"move",matrix:i.getMatrix()})},e.prototype.fitView=function(t,e){t&&this.set("fitViewPadding",t);var n=this.get("viewController");e?n.fitViewByRules(e):n.fitView(),this.autoPaint()},e.prototype.fitCenter=function(){this.get("viewController").fitCenter(),this.autoPaint()},e.prototype.addBehaviors=function(t,e){return this.get("modeController").manipulateBehaviors(t,e,!0),this},e.prototype.removeBehaviors=function(t,e){return this.get("modeController").manipulateBehaviors(t,e,!1),this},e.prototype.updateBehavior=function(t,e,n){return this.get("modeController").updateBehavior(t,e,n),this},e.prototype.zoom=function(t,e,n,r){var i=this,o=this.get("group"),a=(0,_.clone)(o.getMatrix()),s=this.get("minZoom"),u=this.get("maxZoom");if(a||(a=[1,0,0,0,1,0,0,0,1]),a=Bs(a,e?[["t",-e.x,-e.y],["s",t,t],["t",e.x,e.y]]:[["s",t,t]]),s&&a[0]<s||u&&a[0]>u)return!1;if(n){var l=(0,_.clone)(o.getMatrix());l||(l=[1,0,0,0,1,0,0,0,1]);var c=l[0],h=c*t,f=this.getAnimateCfgWithCallback({animateCfg:r,callback:function(){return i.emit("viewportchange",{action:"zoom",matrix:o.getMatrix()})}});o.animate((function(t){if(1===t)l=a;else{var n=pn(c,h,t)/l[0];l=Bs(l,e?[["t",-e.x,-e.y],["s",n,n],["t",e.x,e.y]]:[["s",n,n]])}return{matrix:l}}),f)}else o.setMatrix(a),this.emit("viewportchange",{action:"zoom",matrix:a}),this.autoPaint();return!0},e.prototype.zoomTo=function(t,e,n,r){var i=t/this.getZoom();return this.zoom(i,e,n,r)},e.prototype.focusItem=function(t,e,n){var r=this.get("viewController"),i=!1;e?i=!0:void 0===e&&(i=this.get("animate"));var o={};n?o=n:void 0===n&&(o=this.get("animateCfg")),r.focus(t,i,o),this.autoPaint()},e.prototype.autoPaint=function(){this.get("autoPaint")&&this.paint()},e.prototype.paint=function(){this.emit("beforepaint"),this.get("canvas").draw(),this.emit("afterpaint")},e.prototype.getPointByClient=function(t,e){return this.get("viewController").getPointByClient(t,e)},e.prototype.getClientByPoint=function(t,e){return this.get("viewController").getClientByPoint(t,e)},e.prototype.getPointByCanvas=function(t,e){return this.get("viewController").getPointByCanvas(t,e)},e.prototype.getCanvasByPoint=function(t,e){return this.get("viewController").getCanvasByPoint(t,e)},e.prototype.getGraphCenterPoint=function(){var t=this.get("group").getCanvasBBox();return{x:(t.minX+t.maxX)/2,y:(t.minY+t.maxY)/2}},e.prototype.getViewPortCenterPoint=function(){return this.getPointByCanvas(this.get("width")/2,this.get("height")/2)},e.prototype.showItem=function(t,e){void 0===e&&(e=!0);var n=this.get("itemController").changeItemVisibility(t,!0);if(e&&this.get("enabledStack")){var r=n.getID(),i={},o={};switch(n.getType()){case"node":i.nodes=[{id:r,visible:!1}],o.nodes=[{id:r,visible:!0}];break;case"edge":i.nodes=[{id:r,visible:!1}],o.edges=[{id:r,visible:!0}];break;case"combo":i.nodes=[{id:r,visible:!1}],o.combos=[{id:r,visible:!0}]}this.pushStack("visible",{before:i,after:o})}},e.prototype.hideItem=function(t,e){void 0===e&&(e=!0);var n=this.get("itemController").changeItemVisibility(t,!1);if(e&&this.get("enabledStack")){var r=n.getID(),i={},o={};switch(n.getType()){case"node":i.nodes=[{id:r,visible:!0}],o.nodes=[{id:r,visible:!1}];break;case"edge":i.nodes=[{id:r,visible:!0}],o.edges=[{id:r,visible:!1}];break;case"combo":i.nodes=[{id:r,visible:!0}],o.combos=[{id:r,visible:!1}]}this.pushStack("visible",{before:i,after:o})}},e.prototype.refreshItem=function(t){this.get("itemController").refreshItem(t)},e.prototype.setAutoPaint=function(t){this.set("autoPaint",t),this.get("canvas").set("autoDraw",t)},e.prototype.remove=function(t,e){void 0===e&&(e=!0),this.removeItem(t,e)},e.prototype.removeItem=function(t,e){void 0===e&&(e=!0);var n=t;if((0,_.isString)(t)&&(n=this.findById(t)),!n&&(0,_.isString)(t))console.warn("The item to be removed does not exist!");else if(n){var r="";if(n.getType&&(r=n.getType()),e&&this.get("enabledStack")){var i=(0,y.__assign)((0,y.__assign)({},n.getModel()),{itemType:r}),o={};switch(r){case"node":o.nodes=[i],o.edges=[];for(var a=n.getEdges(),s=a.length-1;s>=0;s--)o.edges.push((0,y.__assign)((0,y.__assign)({},a[s].getModel()),{itemType:"edge"}));break;case"edge":o.edges=[i];break;case"combo":o.combos=[i]}this.pushStack("delete",{before:o,after:{}})}if("node"===r&&n.getModel().comboId&&this.updateComboTree(n,void 0,!1),this.get("itemController").removeItem(n),"combo"===r){var u=Fn(this.get("comboTrees"));this.set("comboTrees",u)}}},e.prototype.addItem=function(t,e,n,r){void 0===n&&(n=!0),void 0===r&&(r=!0);var i=this.get("comboSorted");this.set("comboSorted",i&&!r);var o=this.get("itemController");if(!function(t,e){if("node"===t||"combo"===t){if(e.id&&!(0,_.isString)(e.id))return console.warn("G6 Warning Tips: missing 'id' property, or the 'id' %c".concat(e.id,"%c is not a string."),"font-size: 20px; color: red;",""),!1}else if(!("edge"!==t||e.source&&e.target))return console.warn("G6 Warning Tips: missing 'source' or 'target' for the edge."),!1;return!0}(t,e))return!1;if(!e.id||!this.findById(e.id)){var a,s=this.get("comboTrees");if(s||(s=[]),"combo"===t){var u=this.get("itemMap"),l=!1;if(s.forEach((function(n){l||Dn(n,(function(n){if(e.parentId===n.id){l=!0;var r=(0,y.__assign)({id:e.id,depth:n.depth+2},e);n.children?n.children.push(r):n.children=[r],e.depth=r.depth,a=o.addItem(t,e)}var i=u[n.id];return l&&i&&i.getType&&"combo"===i.getType()&&o.updateCombo(i,n.children),!0}))})),!l){var c=(0,y.__assign)({id:e.id,depth:0},e);e.depth=c.depth,s.push(c),a=o.addItem(t,e)}this.set("comboTrees",s)}else if("node"===t&&(0,_.isString)(e.comboId)&&s){var h;(h=this.findById(e.comboId))&&h.getType&&"combo"!==h.getType()&&console.warn("'".concat(e.comboId,"' is not a id of a combo in the graph, the node will be added without combo.")),a=o.addItem(t,e);var f=this.get("itemMap"),p=!1,d=!1;(s||[]).forEach((function(t){d||p||Dn(t,(function(t){if(t.id===e.id)return d=!0,!1;if(e.comboId===t.id&&!d){p=!0;var n=(0,_.clone)(e);n.itemType="node",t.children?t.children.push(n):t.children=[n],n.depth=t.depth+1}return p&&f[t.id].getType&&"combo"===f[t.id].getType()&&o.updateCombo(f[t.id],t.children),!0}))}))}else a=o.addItem(t,e);("node"===t&&e.comboId||"combo"===t&&e.parentId)&&(h=this.findById(e.comboId||e.parentId))&&h.getType&&"combo"===h.getType()&&h.addChild(a);var g=this.get("combos");if(g&&g.length>0&&this.sortCombos(),this.autoPaint(),n&&this.get("enabledStack")){var v=(0,y.__assign)((0,y.__assign)({},a.getModel()),{itemType:t}),m={};switch(t){case"node":m.nodes=[v];break;case"edge":m.edges=[v];break;case"combo":m.combos=[v]}this.pushStack("add",{before:{},after:m})}return a}console.warn("This item exists already. Be sure the id %c".concat(e.id,"%c is unique."),"font-size: 20px; color: red;","")},e.prototype.add=function(t,e,n,r){return void 0===n&&(n=!0),void 0===r&&(r=!0),this.addItem(t,e,n,r)},e.prototype.updateItem=function(t,e,n){var r=this;void 0===n&&(n=!0);var i,o=this.get("itemController");i=(0,_.isString)(t)?this.findById(t):t;var a=(0,_.clone)(i.getModel()),s="";i.getType&&(s=i.getType());var u=(0,y.__spreadArray)([],i.getStates(),!0);if("combo"===s&&(0,_.each)(u,(function(t){return r.setItemState(i,t,!1)})),o.updateItem(i,e),"combo"===s&&(0,_.each)(u,(function(t){return r.setItemState(i,t,!0)})),n&&this.get("enabledStack")){var l={nodes:[],edges:[],combos:[]},c={nodes:[],edges:[],combos:[]},h=(0,y.__assign)({id:a.id},e);switch(s){case"node":l.nodes.push(a),c.nodes.push(h);break;case"edge":l.edges.push(a),c.edges.push(h);break;case"combo":l.combos.push(a),c.combos.push(h)}"node"===s&&l.nodes.push(a),this.pushStack("update",{before:l,after:c})}},e.prototype.update=function(t,e,n){void 0===n&&(n=!0),this.updateItem(t,e,n)},e.prototype.setItemState=function(t,e,n){(0,_.isString)(t)&&(t=this.findById(t)),this.get("itemController").setItemState(t,e,n);var r=this.get("stateController");(0,_.isString)(n)?r.updateState(t,"".concat(e,":").concat(n),!0):r.updateState(t,e,n)},e.prototype.priorityState=function(t,e){this.get("itemController").priorityState(t,e)},e.prototype.data=function(t){Gn(t),this.set("data",t)},e.prototype.render=function(){var t=this;this.set("comboSorted",!1);var e=this.get("data");if(this.get("enabledStack")&&this.clearStack(),!e)throw new Error("data must be defined first");var n=e.nodes,r=void 0===n?[]:n,i=e.edges,o=void 0===i?[]:i,a=e.combos,s=void 0===a?[]:a;if(this.clear(!0),this.emit("beforerender"),(0,_.each)(r,(function(e){t.add("node",e,!1,!1)})),s&&0!==s.length){var u=zn(s,r);this.set("comboTrees",u),t.addCombos(s)}(0,_.each)(o,(function(e){t.add("edge",e,!1,!1)}));var l=t.get("animate");(t.get("fitView")||t.get("fitCenter"))&&t.set("animate",!1);var c=t.get("layoutController");if(c){if(c.layout((function(){t.get("fitView")?t.fitView():t.get("fitCenter")&&t.fitCenter(),t.autoPaint(),t.emit("afterrender"),(t.get("fitView")||t.get("fitCenter"))&&t.set("animate",l)})),this.destroyed)return}else t.get("fitView")&&t.fitView(),t.get("fitCenter")&&t.fitCenter(),t.emit("afterrender"),t.set("animate",l);this.get("groupByTypes")||(s&&0!==s.length?this.sortCombos():e.nodes&&e.edges&&e.nodes.length<e.edges.length?this.getNodes().forEach((function(t){t.toFront()})):this.getEdges().forEach((function(t){t.toBack()}))),this.get("enabledStack")&&this.pushStack("render")},e.prototype.read=function(t){this.data(t),this.render()},e.prototype.diffItems=function(t,e,n){var r,i=this,o=this.get("itemMap");(0,_.each)(n,(function(n){if(r=o[n.id]){if(i.get("animate")&&"node"===t){var a=r.getContainer().getMatrix();a||(a=[1,0,0,0,1,0,0,0,1]),r.set("originAttrs",{x:a[6],y:a[7]})}i.updateItem(r,n,!1)}else r=i.addItem(t,n,!1);r&&e["".concat(t,"s")].push(r)}))},e.prototype.changeData=function(t,e){void 0===e&&(e=!0);var n=this;if(!Gn(t))return this;e&&this.get("enabledStack")&&this.pushStack("changedata",{before:n.save(),after:t}),this.set("comboSorted",!1),this.removeHulls(),this.getNodes().map((function(t){return n.clearItemStates(t)})),this.getEdges().map((function(t){return n.clearItemStates(t)}));var r=this.get("canvas"),i=r.get("localRefresh");r.set("localRefresh",!1),n.get("data")||(n.data(t),n.render());var o=this.get("itemMap"),a={nodes:[],edges:[]},s=t.combos;if(s){var u=zn(s,t.nodes);this.set("comboTrees",u)}else this.set("comboTrees",[]);this.diffItems("node",a,t.nodes),(0,_.each)(o,(function(t,e){o[e].getModel().depth=0,t.getType&&"edge"===t.getType()||(t.getType&&"combo"===t.getType()?(delete o[e],t.destroy()):a.nodes.indexOf(t)<0&&(delete o[e],n.remove(t,!1)))}));for(var l=this.getCombos(),c=l.length-1;c>=0;c--)l[c].destroyed&&l.splice(c,1);s&&(n.addCombos(s),this.get("groupByTypes")||this.sortCombos()),this.diffItems("edge",a,t.edges),(0,_.each)(o,(function(t,e){(!t.getType||"node"!==t.getType()&&"combo"!==t.getType())&&a.edges.indexOf(t)<0&&(delete o[e],n.remove(t,!1))})),this.set({nodes:a.nodes,edges:a.edges});var h=this.get("layoutController");return h&&(h.changeData(),n.get("animate")&&!h.getLayoutType()?n.positionsAnimate():n.autoPaint()),setTimeout((function(){r.set("localRefresh",i)}),16),this},e.prototype.addCombos=function(t){var e=this.get("comboTrees");this.get("itemController").addCombos(e,t)},e.prototype.createCombo=function(t,e){var n=this;this.set("comboSorted",!1);var r,i="";if(t){if((0,_.isString)(t))i=t,r={id:t};else{if(!(i=t.id))return void console.warn("Create combo failed. Please assign a unique string id for the adding combo.");r=t}var o=e.map((function(t){var e=n.findById(t),r=e.getModel(),o="";e.getType&&(o=e.getType());var a={id:e.getID(),itemType:o};return"combo"===o?(a.parentId=i,r.parentId=i):"node"===o&&(a.comboId=i,r.comboId=i),a}));r.children=o,this.addItem("combo",r,!1),this.set("comboSorted",!1);var a=this.get("comboTrees");(a||[]).forEach((function(t){Dn(t,(function(t){return t.id!==i||(t.itemType="combo",t.children=o,!1)}))})),a&&this.sortCombos()}},e.prototype.uncombo=function(t){var e,n=this,r=t;if((0,_.isString)(t)&&(r=this.findById(t)),!r||r.getType&&"combo"!==r.getType())console.warn("The item is not a combo!");else{var i=r.getModel().parentId,o=this.get("comboTrees");o||(o=[]);var a,s=this.get("itemMap"),u=r.get("id"),l=[],c=this.get("combos"),h=this.findById(i);if(o.forEach((function(t){a||Dn(t,(function(t){var e;if(t.id===u){a=t,r.getEdges().forEach((function(t){n.removeItem(t,!1)}));var o=c.indexOf(r);c.splice(o,1),delete s[u],r.destroy(),n.emit("afterremoveitem",{item:r,type:"combo"})}return!i||!a||t.id!==i||(h.removeCombo(r),-1!==(o=(l=t.children).indexOf(a))&&l.splice(o,1),null===(e=a.children)||void 0===e||e.forEach((function(t){var e=n.findById(t.id),r=e.getModel();e.getType&&"combo"===e.getType()?(t.parentId=i,delete t.comboId,r.parentId=i,delete r.comboId):e.getType&&"node"===e.getType()&&(t.comboId=i,r.comboId=i),h.addChild(e),l.push(t)})),!1)}))})),!i&&a){var f=o.indexOf(a);o.splice(f,1),null===(e=a.children)||void 0===e||e.forEach((function(t){t.parentId=void 0;var e=n.findById(t.id).getModel();delete e.parentId,delete e.comboId,"node"!==t.itemType&&o.push(t)}))}}},e.prototype.updateCombos=function(){var t=this,e=this,n=this.get("comboTrees"),r=e.get("itemController"),i=e.get("itemMap");(n||[]).forEach((function(e){Dn(e,(function(e){if(!e)return!0;var n=i[e.id];if(n&&n.getType&&"combo"===n.getType()){var o=(0,y.__spreadArray)([],n.getStates(),!0);(0,_.each)(o,(function(e){return t.setItemState(n,e,!1)})),r.updateCombo(n,e.children),(0,_.each)(o,(function(e){return t.setItemState(n,e,!0)}))}return!0}))})),e.sortCombos()},e.prototype.updateCombo=function(t){var e,n=this,r=t;if((0,_.isString)(t)&&(r=this.findById(t)),!r||r.getType&&"combo"!==r.getType())console.warn("The item to be updated is not a combo!");else{e=r.get("id");var i=this.get("comboTrees"),o=this.get("itemController"),a=this.get("itemMap");(i||[]).forEach((function(t){Dn(t,(function(t){if(!t)return!0;var r=a[t.id];if(e===t.id&&r&&r.getType&&"combo"===r.getType()){var i=(0,y.__spreadArray)([],r.getStates(),!0);(0,_.each)(i,(function(t){r.getStateStyle(t)&&n.setItemState(r,t,!1)})),o.updateCombo(r,t.children),(0,_.each)(i,(function(t){r.getStateStyle(t)&&n.setItemState(r,t,!0)})),e&&(e=t.parentId)}return!0}))}))}},e.prototype.updateComboTree=function(t,e,n){var r;void 0===n&&(n=!0),this.set("comboSorted",!1);var i,o=(r=(0,_.isString)(t)?this.findById(t):t).getModel(),a=o.comboId||o.parentId,s="";if(r.getType&&(s=r.getType()),e&&"combo"===s){var u,l=this.get("comboTrees"),c=!0;if((l||[]).forEach((function(t){u||Ln(t,(function(t){if(!u)return t.id===r.getID()&&(u=t),!0}))})),Ln(u,(function(t){return t.id!==e||(c=!1,!1)})),!c)return void console.warn("Failed to update the combo tree! The parentId points to a descendant of the combo!")}if(n&&this.get("enabledStack")){var h={},f={};"combo"===s?(h.combos=[{id:o.id,parentId:o.parentId}],f.combos=[{id:o.id,parentId:e}]):"node"===s&&(h.nodes=[{id:o.id,parentId:o.comboId}],f.nodes=[{id:o.id,parentId:e}]),this.pushStack("updateComboTree",{before:h,after:f})}if(o.parentId||o.comboId){var p=this.findById(o.parentId||o.comboId);p&&p.removeChild(r)}"combo"===s?o.parentId=e:"node"===s&&(o.comboId=e),e&&(i=this.findById(e))&&i.addChild(r),a&&(i=this.findById(a))&&i.removeChild(r);var d=Fn(this.get("comboTrees"),o.id,e);this.set("comboTrees",d),this.updateCombos()},e.prototype.save=function(){var t=[],e=[],n=[];return(0,_.each)(this.get("nodes"),(function(e){t.push(e.getModel())})),(0,_.each)(this.get("edges"),(function(t){e.push(t.getModel())})),(0,_.each)(this.get("combos"),(function(t){n.push(t.getModel())})),{nodes:t,edges:e,combos:n}},e.prototype.changeSize=function(t,e){return this.get("viewController").changeSize(t,e),this},e.prototype.refresh=function(){var t=this;if(t.emit("beforegraphrefresh"),t.get("animate"))t.positionsAnimate();else{var e=t.get("nodes"),n=t.get("edges"),r=t.get("edges");(0,_.each)(e,(function(t){t.refresh()})),(0,_.each)(n,(function(t){t.refresh()})),(0,_.each)(r,(function(t){t.refresh()}))}t.emit("aftergraphrefresh"),t.autoPaint()},e.prototype.getNodes=function(){return this.get("nodes")},e.prototype.getEdges=function(){return this.get("edges")},e.prototype.getCombos=function(){return this.get("combos")},e.prototype.getComboChildren=function(t){if((0,_.isString)(t)&&(t=this.findById(t)),t&&(!t.getType||"combo"===t.getType()))return t.getChildren();console.warn("The combo does not exist!")},e.prototype.positionsAnimate=function(){var t=this;t.emit("beforeanimate");var e=t.get("animateCfg"),n=e.onFrame,r=t.getNodes(),i=r.map((function(t){var e=t.getModel();return{id:e.id,x:e.x,y:e.y}}));t.isAnimating()&&t.stopAnimate(),t.get("canvas").animate((function(e){(0,_.each)(i,(function(r){var i=t.findById(r.id);if(i&&!i.destroyed){var o=i.get("originAttrs"),a=i.get("model");if(!o){var s=i.getContainer().getMatrix();s||(s=[1,0,0,0,1,0,0,0,1]),o={x:s[6],y:s[7]},i.set("originAttrs",o)}if(n){var u=n(i,e,r,o);i.set("model",Object.assign(a,u))}else a.x=o.x+(r.x-o.x)*e,a.y=o.y+(r.y-o.y)*e}})),t.refreshPositions()}),{duration:e.duration,easing:e.easing,callback:function(){(0,_.each)(r,(function(t){t.set("originAttrs",null)})),e.callback&&e.callback(),t.emit("afteranimate"),t.animating=!1}})},e.prototype.refreshPositions=function(){var t=this;t.emit("beforegraphrefreshposition");var e,n=t.get("nodes"),r=t.get("edges"),i=t.get("vedges"),o=t.get("combos"),a={};(0,_.each)(n,(function(t){e=t.getModel();var n=t.get("originAttrs");if(!n||e.x!==n.x||e.y!==n.y){var r=t.updatePosition({x:e.x,y:e.y});a[e.id]=r,e.comboId&&(a[e.comboId]=a[e.comboId]||r)}})),o&&0!==o.length&&t.updateCombos(),(0,_.each)(r,(function(t){var e=t.getSource().getModel(),n=t.getTarget();if(!(0,_.isPlainObject)(n)){var r=n.getModel();(a[e.id]||a[r.id]||t.getModel().isComboEdge)&&t.refresh()}})),(0,_.each)(i,(function(t){t.refresh()})),t.emit("aftergraphrefreshposition"),t.autoPaint()},e.prototype.stopAnimate=function(){this.get("canvas").stopAnimate()},e.prototype.isAnimating=function(){return this.animating},e.prototype.getZoom=function(){var t=this.get("group").getMatrix();return t?t[0]:1},e.prototype.getCurrentMode=function(){return this.get("modeController").getMode()},e.prototype.setMode=function(t){return this.get("modeController").setMode(t),this},e.prototype.clear=function(t){var e;return void 0===t&&(t=!1),null===(e=this.get("canvas"))||void 0===e||e.clear(),this.initGroups(),this.set({itemMap:{},nodes:[],edges:[],groups:[],combos:[],comboTrees:[]}),t||this.emit("afterrender"),this},e.prototype.updateLayout=function(t,e,n){var r=this,i=this.get("layoutController");if((0,_.isString)(t)&&(t={type:t}),e){var o=n;o||(o="begin"===e?{x:0,y:0}:{x:this.getWidth()/2,y:this.getHeight()/2}),o=this.getPointByCanvas(o.x,o.y);var a=["force","gForce","fruchterman"];a.includes(t.type)||!t.type&&a.includes(null==i?void 0:i.layoutType)?t.center=[o.x,o.y]:this.once("afterlayout",(function(t){var n=r.getGroup().getMatrix()||[1,0,0,0,1,0,0,0,1];o.x=o.x*n[0]+n[6],o.y=o.y*n[0]+n[7];var i=r.getGroup().getCanvasBBox(),a=i.minX,s=i.maxX,u=i.minY,l={x:(a+s)/2,y:(u+i.maxY)/2};"begin"===e&&(l.x=a,l.y=u),r.translate(o.x-l.x,o.y-l.y)}))}var s=this.get("layout"),u={};Object.assign(u,s,t),this.set("layout",u),i.isLayoutTypeSame(u)&&u.gpuEnabled===s.gpuEnabled?i.updateLayoutCfg(u):i.changeLayout(u)},e.prototype.destroyLayout=function(){this.get("layoutController").destroyLayout()},e.prototype.layout=function(){var t=this.get("layoutController"),e=this.get("layout");e&&t&&(e.workerEnabled?t.layout():t.layoutMethod?t.relayout(!0):t.layout())},e.prototype.collapseCombo=function(t){var e=this;if((0,_.isString)(t)&&(t=this.findById(t)),t){this.emit("beforecollapseexpandcombo",{action:"expand",item:t});var n=t.getModel();this.get("itemController").collapseCombo(t),n.collapsed=!0;var r=this.getEdges().concat(this.get("vedges")),i=[],o=[],a=this.get("comboTrees"),s=!1;(a||[]).forEach((function(t){s||Ln(t,(function(t){if(s&&t.depth<=n.depth)return!1;if(n.id===t.id&&(s=!0),s){var r=e.findById(t.id);r&&r.getType&&"combo"===r.getType()&&(i=i.concat(r.getNodes()),o=o.concat(r.getCombos()))}return!0}))}));var u={},l=[];r.forEach((function(t){if(!t.isVisible()||t.getModel().isVEdge){var r=t.getSource(),a=t.getTarget();if((i.includes(r)||o.includes(r))&&!i.includes(a)&&!o.includes(a)||r.getModel().id===n.id){if((f=t.getModel()).isVEdge)return void e.removeItem(t,!1);for(var s=a.getModel();!a.isVisible();){if(!(a=e.findById(s.parentId||s.comboId))||!s.parentId&&!s.comboId)return;s=a.getModel()}var c=s.id;if(u["".concat(n.id,"-").concat(c)])return void(u["".concat(n.id,"-").concat(c)]+=f.size||1);var h=e.addItem("vedge",{source:n.id,target:c,isVEdge:!0},!1);u["".concat(n.id,"-").concat(c)]=f.size||1,l.push(h)}else if(!i.includes(r)&&!o.includes(r)&&(i.includes(a)||o.includes(a))||a.getModel().id===n.id){var f;if((f=t.getModel()).isVEdge)return void e.removeItem(t,!1);for(var p=r.getModel();!r.isVisible();){if(!(r=e.findById(p.parentId||p.comboId))||!p.parentId&&!p.comboId)return;p=r.getModel()}var d=p.id;if(u["".concat(d,"-").concat(n.id)])return void(u["".concat(d,"-").concat(n.id)]+=f.size||1);h=e.addItem("vedge",{target:n.id,source:d,isVEdge:!0},!1),u["".concat(d,"-").concat(n.id)]=f.size||1,l.push(h)}}})),l.forEach((function(t){var n=t.getModel();e.updateItem(t,{size:u["".concat(n.source,"-").concat(n.target)]},!1)})),this.emit("aftercollapseexpandcombo",{action:"collapse",item:t})}else console.warn("The combo to be collapsed does not exist!")},e.prototype.expandCombo=function(t){var e=this;if((0,_.isString)(t)&&(t=this.findById(t)),!t||t.getType&&"combo"!==t.getType())console.warn("The combo to be collapsed does not exist!");else{this.emit("beforecollapseexpandcombo",{action:"expand",item:t});var n=t.getModel();this.get("itemController").expandCombo(t),n.collapsed=!1;var r=this.getEdges().concat(this.get("vedges")),i=[],o=[],a=this.get("comboTrees"),s=!1;(a||[]).forEach((function(t){s||Ln(t,(function(t){if(s&&t.depth<=n.depth)return!1;if(n.id===t.id&&(s=!0),s){var r=e.findById(t.id);r&&r.getType&&"combo"===r.getType()&&(i=i.concat(r.getNodes()),o=o.concat(r.getCombos()))}return!0}))}));var u={},l={};r.forEach((function(t){if(!t.isVisible()||t.getModel().isVEdge){var r=t.getSource(),a=t.getTarget(),s=r.get("id"),c=a.get("id");if((i.includes(r)||o.includes(r))&&!i.includes(a)&&!o.includes(a)||s===n.id){if(t.getModel().isVEdge)return void e.removeItem(t,!1);for(var h=a.getModel();!a.isVisible();){if(!(a=e.findById(h.comboId||h.parentId))||!h.parentId&&!h.comboId)return;h=a.getModel()}c=h.id;for(var f=r.getModel();!r.isVisible();){if(!(r=e.findById(f.comboId||f.parentId))||!f.parentId&&!f.comboId)return;if(f.comboId===n.id||f.parentId===n.id)break;f=r.getModel()}if(s=f.id,c){var p="".concat(s,"-").concat(c);if(u[p])return u[p]+=t.getModel().size||1,void e.updateItem(l[p],{size:u[p]},!1);var d=e.addItem("vedge",{source:s,target:c,isVEdge:!0},!1);u[p]=t.getModel().size||1,l[p]=d}}else if(!i.includes(r)&&!o.includes(r)&&(i.includes(a)||o.includes(a))||c===n.id){if(t.getModel().isVEdge)return void e.removeItem(t,!1);for(f=r.getModel();!r.isVisible();){if(!(r=e.findById(f.comboId||f.parentId))||!f.parentId&&!f.comboId)return;f=r.getModel()}for(s=f.id,h=a.getModel();!a.isVisible();){if(!(a=e.findById(h.comboId||h.parentId))||!h.parentId&&!h.comboId)return;if(h.comboId===n.id||h.parentId===n.id)break;h=a.getModel()}if(c=h.id,s){if(p="".concat(s,"-").concat(c),u[p])return u[p]+=t.getModel().size||1,void e.updateItem(l[p],{size:u[p]},!1);d=e.addItem("vedge",{target:c,source:s,isVEdge:!0},!1),u[p]=t.getModel().size||1,l[p]=d}}else(i.includes(r)||o.includes(r))&&(i.includes(a)||o.includes(a))&&r.isVisible()&&a.isVisible()&&t.show()}})),this.emit("aftercollapseexpandcombo",{action:"expand",item:t})}},e.prototype.collapseExpandCombo=function(t){if((0,_.isString)(t)&&(t=this.findById(t)),t&&(!t.getType||"combo"===t.getType())){for(var e=t.getModel(),n=this.findById(e.parentId);n;){var r=n.getModel();if(r.collapsed)return console.warn("Fail to expand the combo since it's ancestor combo is collapsed."),void(n=void 0);n=this.findById(r.parentId)}e.collapsed?this.expandCombo(t):this.collapseCombo(t),this.updateCombo(t)}},e.prototype.sortCombos=function(){var t=this;if(!this.get("comboSorted")){this.set("comboSorted",!0);var e=[],n={};(this.get("comboTrees")||[]).forEach((function(t){Ln(t,(function(t){return e[t.depth]?e[t.depth].push(t.id):e[t.depth]=[t.id],n[t.id]=t.depth,!0}))})),(this.getEdges().concat(this.get("vedges"))||[]).forEach((function(t){var r=t.getModel(),i=n[r.source]||0,o=n[r.target]||0,a=Math.max(i,o);e[a]?e[a].push(r.id):e[a]=[r.id]})),e.forEach((function(e){if(e&&e.length)for(var n=e.length-1;n>=0;n--){var r=t.findById(e[n]);r&&r.toFront()}}))}},e.prototype.getNeighbors=function(t,e){var n=t;return(0,_.isString)(t)&&(n=this.findById(t)),n.getNeighbors(e)},e.prototype.getNodeDegree=function(t,e,n){void 0===e&&(e=void 0),void 0===n&&(n=!1);var r=t;(0,_.isString)(t)&&(r=this.findById(t));var i=this.get("degrees");i&&!n||(i=Et(this.save()),this.set("degrees",i));var o=i[r.getID()],a=0;if(!o)return 0;switch(e){case"in":a=o.inDegree;break;case"out":a=o.outDegree;break;case"all":a=o;break;default:a=o.degree}return a},e.prototype.getUndoStack=function(){return this.undoStack},e.prototype.getRedoStack=function(){return this.redoStack},e.prototype.getStackData=function(){return this.get("enabledStack")?{undoStack:this.undoStack.toArray(),redoStack:this.redoStack.toArray()}:null},e.prototype.clearStack=function(){this.get("enabledStack")&&(this.undoStack.clear(),this.redoStack.clear())},e.prototype.pushStack=function(t,e,n){if(void 0===t&&(t="update"),void 0===n&&(n="undo"),this.get("enabledStack")){var r=e?(0,_.clone)(e):{before:{},after:(0,_.clone)(this.save())};"redo"===n?this.redoStack.push({action:t,data:r}):this.undoStack.push({action:t,data:r}),this.emit("stackchange",{undoStack:this.undoStack,redoStack:this.redoStack})}else console.warn("请先启用 undo & redo 功能，在实例化 Graph 时候配置 enabledStack: true !")},e.prototype.getAdjMatrix=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=this.get("directed"));var n=this.get("adjMatrix");return n&&t||(n=lt(this.save(),e),this.set("adjMatrix",n)),n},e.prototype.getShortestPathMatrix=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=this.get("directed"));var n=this.get("adjMatrix"),r=this.get("shortestPathMatrix");return n&&t||(n=lt(this.save(),e),this.set("adjMatrix",n)),r&&t||(r=Nt(this.save(),e),this.set("shortestPathMatrix",r)),r},e.prototype.on=function(e,n,r){return t.prototype.on.call(this,e,n,r)},e.prototype.destroy=function(){var t,e,n,r,i;this.clear(),this.clearStack(),null===(t=this.get("itemController"))||void 0===t||t.destroy(),null===(e=this.get("modeController"))||void 0===e||e.destroy(),null===(n=this.get("viewController"))||void 0===n||n.destroy(),null===(r=this.get("stateController"))||void 0===r||r.destroy(),null===(i=this.get("canvas"))||void 0===i||i.destroy(),this.cfg=null,this.destroyed=!0,this.redoStack=null,this.undoStack=null},e.prototype.createHull=function(t){if(t.members&&!(t.members.length<1)){var e=this.get("hullGroup"),n=this.get("hullMap");if(n||(n={},this.set("hullMap",n)),e&&!e.get("destroyed")||((e=this.get("group").addGroup({id:"hullGroup"})).toBack(),this.set("hullGroup",e)),n[t.id])return console.warn("Existed hull id."),n[t.id];var r=e.addGroup({id:"".concat(t.id,"-container")}),i=new Ns(this,(0,y.__assign)((0,y.__assign)({},t),{group:r}));return n[i.id]=i,i}console.warn("Create hull failed! The members is empty.")},e.prototype.getHulls=function(){return this.get("hullMap")},e.prototype.getHullById=function(t){return this.get("hullMap")[t]},e.prototype.removeHull=function(t){var e,n;n=(0,_.isString)(t)?this.getHullById(t):t,null===(e=this.get("hullMap"))||void 0===e||delete e[n.id],n.destroy()},e.prototype.removeHulls=function(){var t=this.getHulls();t&&Object.keys(t).length&&(Object.keys(t).forEach((function(e){t[e].destroy()})),this.set("hullMap",{}))},e}(C);const Fs=zs;function Zs(t){return Zs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zs(t)}var js=ut,Us="-shape",Gs="-label",Vs=["startArrow","endArrow"],Ws={lineWidth:1,stroke:void 0,fill:void 0,lineAppendWidth:1,opacity:void 0,strokeOpacity:void 0,fillOpacity:void 0,x:0,y:0,r:10,width:20,height:20,shadowColor:void 0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0},Hs={edge:{lineWidth:1,stroke:"#000",lineDash:void 0,startArrow:!1,endArrow:!1,opacity:void 0,strokeOpacity:void 0,fillOpacity:void 0,shadowColor:void 0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0},node:Ws,combo:Ws},Xs="-label-bg",Ys={options:{labelCfg:{style:{fontFamily:wn.windowFontFamily}},descriptionCfg:{style:{fontFamily:wn.windowFontFamily}}},itemType:"",type:"",getCustomConfig:function(t){return{}},getOptions:function(t,e){return"move"===e||(null==e?void 0:e.includes("bbox"))?{}:(0,_.deepMix)({},this.options,this.getCustomConfig(t)||{},t)},draw:function(t,e){e.shapeMap={},this.mergeStyle=this.getOptions(t);var n=this.drawShape(t,e);if(n.set("className",this.itemType+Us),e.shapeMap[this.itemType+Us]=n,t.label){var r=this.drawLabel(t,e);r.set("className",this.itemType+Gs),e.shapeMap[this.itemType+Gs]=r}return n},afterDraw:function(t,e,n){},drawShape:function(t,e){return null},drawLabel:function(t,e){var n=(this.mergeStyle||this.getOptions(t)||{}).labelCfg||{},r=this.getLabelStyle(t,n,e),i=r.rotate;delete r.rotate;var o=e.addShape("text",{attrs:r,draggable:!0,className:"text-shape",name:"text-shape"});if(e.shapeMap["text-shape"]=o,!isNaN(i)&&""!==i){var a=o.getBBox(),s=[1,0,0,0,1,0,0,0,1];if(r.rotateCenter)switch(r.rotateCenter){case"center":default:s=js(s,[["t",-a.width/2,-a.height/2],["r",i],["t",a.width/2,a.height/2]]);break;case"lefttop":s=js(s,[["t",-r.x,-r.y],["r",i],["t",r.x,r.y]]);break;case"leftcenter":s=js(s,[["t",-r.x,-r.y-a.height/2],["r",i],["t",r.x,r.y+a.height/2]])}else s=js(s,[["t",-r.x,-r.y-a.height/2],["r",i],["t",r.x,r.y+a.height/2]]);o.setMatrix(s)}if(r.background){var u=this.drawLabelBg(t,e,o),l=this.itemType+Xs;u.set("classname",l),e.shapeMap[l]=u,o.toFront()}return o},drawLabelBg:function(t,e,n){var r=this.options.labelCfg,i=(0,_.mix)({},r,t.labelCfg),o=this.getLabelBgStyleByPosition(n,i),a=e.addShape("rect",{name:"text-bg-shape",attrs:o});return e.shapeMap["text-bg-shape"]=a,a},getLabelStyleByPosition:function(t,e,n){return{text:t.label}},getLabelBgStyleByPosition:function(t,e){return{}},getLabelStyle:function(t,e,n){var r=this.getLabelStyleByPosition(t,e,n),i="".concat(this.itemType,"Label"),o=wn[i]?wn[i].style:null;return(0,y.__assign)((0,y.__assign)((0,y.__assign)({},o),r),e.style)},getShapeStyle:function(t){return t.style},update:function(t,e,n){this.updateShapeStyle(t,e,n),this.updateLabel(t,e,n)},updateShapeStyle:function(t,e,n){var r,i=e.getContainer(),o=e.getKeyShape(),a=(0,_.mix)({},o.attr(),t.style),s=function(t){var e,n=a[t];if((0,_.isPlainObject)(n)){var s=(null===(r=i.shapeMap)||void 0===r?void 0:r[t])||i.find((function(e){return e.get("name")===t}));null==s||s.attr(n)}else o.attr(((e={})[t]=n,e))};for(var u in a)s(u)},updateLabel:function(t,e,n){var r,i;if(t.label||""===t.label){var o=e.getContainer(),a=(this.mergeStyle||this.getOptions({},n)||{}).labelCfg,s=void 0===a?{}:a,u=this.itemType+Gs,l=o.shapeMap[u]||o.find((function(t){return t.get("className")===u})),c=this.itemType+Xs,h=o.shapeMap[c]||o.find((function(t){return t.get("className")===c}));if(l){(!n||"bbox|label"===n||"edge"===this.itemType&&"style"!==n)&&(s=(0,_.deepMix)(s,t.labelCfg));var f=this.getLabelStyleByPosition(t,s,o),p=null===(r=t.labelCfg)||void 0===r?void 0:r.style,d=(0,y.__assign)((0,y.__assign)({},f),p),g=d.rotate;if(delete d.rotate,isNaN(g)||""===g)1!==(null===(i=l.getMatrix())||void 0===i?void 0:i[4])&&l.resetMatrix(),l.attr(d);else{var v=[1,0,0,0,1,0,0,0,1];v=js(v,[["t",-d.x,-d.y],["r",g],["t",d.x,d.y]]),d.matrix=v,l.attr(d)}if(h)if(d.background){var m=this.getLabelBgStyleByPosition(l,s);h.attr(m)}else o.removeChild(h);else d.background&&((h=this.drawLabelBg(t,o,l)).set("classname",c),o.shapeMap[c]=h,l.toFront())}else{var b=this.drawLabel(t,o);b.set("className",u),o.shapeMap[u]=b}}},afterUpdate:function(t,e){},setState:function(t,e,n){var r,i,o,a=n.get("keyShape");if(a&&!a.destroyed){var s=n.getType(),u=(0,_.isBoolean)(e)?t:"".concat(t,":").concat(e),l=this.getStateStyle(u,n),c=n.getStateStyle(u);if(c||l){var h=(0,_.mix)({},c||l),f=n.getContainer(),p={x:1,y:1,cx:1,cy:1};if("combo"===s&&(p.r=1,p.width=1,p.height=1),e){var d=function(t){var e,n=h[t];if((0,_.isPlainObject)(n)&&!Vs.includes(t)){var r=(null===(o=f.shapeMap)||void 0===o?void 0:o[t])||f.find((function(e){return e.get("name")===t}));null==r||r.attr(n)}else a.attr(((e={})[t]=n,e))};for(var g in h)d(g)}else{var v=Un(n.getCurrentStatesStyle()),m=n.getModel(),y=(0,_.mix)({},m.style,Un(n.getOriginStyle())),b=a.get("name"),x=a.attr(),w={};Object.keys(x).forEach((function(t){if("img"!==t){var e=x[t];e&&"object"===Zs(e)?w[t]=(0,_.clone)(e):w[t]=e}}));var E={},S=function(t){var e=h[t];if((0,_.isPlainObject)(e)&&!Vs.includes(t)){var n=f.shapeMap[t]||f.find((function(e){return e.get("name")===t}));if(n){var r=Un(n.attr());(0,_.each)(e,(function(e,i){if(t===b&&w[i]&&!p[i]){delete w[i];var o=y[t][i]||Hs[s][i];a.attr(i,o)}else if(r[i]||0===r[i]){delete r[i];var u=y[t][i]||Hs[s][i];n.attr(i,u)}})),E[t]=r}}else if(w[t]&&!p[t]){delete w[t];var i=y[t]||(y[b]?y[b][t]:void 0)||Hs[s][t];a.attr(t,i)}};for(var C in h)S(C);for(var g in b?E[b]=w:(0,_.mix)(E,w),v)if(!p[g]){var A=v[g];(0,_.isPlainObject)(A)&&!Vs.includes(g)||(b?((0,_.mix)(y[b],((i={})[g]=A,i)),delete y[g]):(0,_.mix)(y,((r={})[g]=A,r)),delete v[g])}var T={};(0,_.deepMix)(T,y,E,v);var k=!1,M=function(t){var e,n,r=T[t];if((0,_.isPlainObject)(r)&&!Vs.includes(t)){var i=f.shapeMap[t]||f.find((function(e){return e.get("name")===t}));i&&("text"===i.get("type")&&(delete r.x,delete r.y,delete r.matrix),t===b&&("combo"===s&&(delete r.r,delete r.width,delete r.height),k=!0),i.attr(r))}else if(!k){var o=r||Hs[s][t];"combo"===s?b||a.attr(((e={})[t]=o,e)):a.attr(((n={})[t]=o,n))}};for(var P in T)M(P)}}}},getStateStyle:function(t,e){var n=e.getModel(),r=e.getType(),i=this.getOptions(n),o=i.stateStyles,a=i.style,s=void 0===a?{}:a,u=n.stateStyles?n.stateStyles[t]:o&&o[t];return"combo"===r?(0,_.clone)(u):(0,_.mix)({},s,u)},getControlPoints:function(t){return t.controlPoints},getAnchorPoints:function(t){var e,n;return(null==t?void 0:t.anchorPoints)||(null===(e=this.getCustomConfig(t))||void 0===e?void 0:e.anchorPoints)||(null===(n=this.options)||void 0===n?void 0:n.anchorPoints)}},qs={itemType:"node",shapeType:"single-node",labelPosition:"center",offset:wn.nodeLabel.offset,getSize:function(t){var e,n=(null===(e=this.mergeStyle)||void 0===e?void 0:e.size)||t.size||this.getOptions({}).size||wn.defaultNode.size;return(0,_.isArray)(n)&&1===n.length&&(n=[n[0],n[0]]),(0,_.isArray)(n)||(n=[n,n]),n},getLabelStyleByPosition:function(t,e){var n=e.position||this.labelPosition;if("center"===n)return{x:0,y:0,text:t.label};var r=e.offset;(0,_.isNil)(r)&&(r=this.offset);var i,o=this.getSize(t);switch(n){case"top":i={x:0,y:-o[1]/2-r,textBaseline:"bottom"};break;case"bottom":i={x:0,y:o[1]/2+r,textBaseline:"top"};break;case"left":i={x:-o[0]/2-r,y:0,textAlign:"right"};break;default:i={x:o[0]/2+r,y:0,textAlign:"left"}}return i.text=t.label,i},getLabelBgStyleByPosition:function(t,e){var n;if(!t)return{};var r=null===(n=e.style)||void 0===n?void 0:n.background;if(!r)return{};var i=t.getBBox(),o=wa(r.padding),a=i.width+o[1]+o[3],s=i.height+o[0]+o[2];return(0,y.__assign)((0,y.__assign)({x:i.minX-o[3],y:i.minY-o[0]},r),{width:a,height:s})},drawShape:function(t,e){var n=this.shapeType,r=this.getShapeStyle(t),i=e.addShape(n,{attrs:r,draggable:!0,name:"node-shape"});return e.shapeMap["node-shape"]=i,i},updateLinkPoints:function(t,e){var n,r=(this.mergeStyle||this.getOptions(t)).linkPoints,i=e.shapeMap["link-point-left"]||e.find((function(t){return"link-point-left"===t.get("className")})),o=e.shapeMap["link-point-right"]||e.find((function(t){return"link-point-right"===t.get("className")})),a=e.shapeMap["link-point-top"]||e.find((function(t){return"link-point-top"===t.get("className")})),s=e.shapeMap["link-point-bottom"]||e.find((function(t){return"link-point-bottom"===t.get("className")}));i&&(n=i.attr()),o&&!n&&(n=o.attr()),a&&!n&&(n=a.attr()),s&&!n&&(n=s.attr()),n||(n=r);var u=(0,_.mix)({},n,t.linkPoints),l=u.fill,c=u.stroke,h=u.lineWidth,f=u.size/2;f||(f=u.r);var p=t.linkPoints?t.linkPoints:{left:void 0,right:void 0,top:void 0,bottom:void 0},d=p.left,g=p.right,v=p.top,m=p.bottom,b=this.getSize(t),x=b[0],w=b[1],E={r:f,fill:l,stroke:c,lineWidth:h};if(i)d||void 0===d?i.attr((0,y.__assign)((0,y.__assign)({},E),{x:-x/2,y:0})):(i.remove(),delete e.shapeMap["link-point-left"]);else if(d){var S="link-point-left";e.shapeMap[S]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},E),{x:-x/2,y:0}),className:S,name:S,isAnchorPoint:!0})}if(o)g||void 0===g||(o.remove(),delete e.shapeMap["link-point-right"]),o.attr((0,y.__assign)((0,y.__assign)({},E),{x:x/2,y:0}));else if(g){var C="link-point-right";e.shapeMap[C]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},E),{x:x/2,y:0}),className:C,name:C,isAnchorPoint:!0})}if(a)v||void 0===v||(a.remove(),delete e.shapeMap["link-point-top"]),a.attr((0,y.__assign)((0,y.__assign)({},E),{x:0,y:-w/2}));else if(v){var A="link-point-top";e.shapeMap[A]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},E),{x:0,y:-w/2}),className:A,name:A,isAnchorPoint:!0})}if(s)m||void 0===m?s.attr((0,y.__assign)((0,y.__assign)({},E),{x:0,y:w/2})):(s.remove(),delete e.shapeMap["link-point-bottom"]);else if(m){var T="link-point-bottom";e.shapeMap[T]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},E),{x:0,y:w/2}),className:T,name:T,isAnchorPoint:!0})}},updateShape:function(t,e,n,r,i){e.get("keyShape").attr((0,y.__assign)({},n)),this.updateLabel(t,e,i),r&&this.updateIcon(t,e)},updateIcon:function(t,e){var n=this,r=e.getContainer(),i=(this.mergeStyle||this.getOptions(t)).icon,o=(t.icon?t.icon:{show:void 0}).show,a=r.shapeMap["".concat(this.type,"-icon")]||r.find((function(t){return t.get("name")==="".concat(n.type,"-icon")}));if(a)if(o||void 0===o){var s=(0,_.mix)({},a.attr(),i),u=s.width,l=void 0===u?20:u,c=s.height,h=void 0===c?20:c;("iconfont"===s.fontFamily||s.hasOwnProperty("text"))&&(l=0,h=0),a.attr((0,y.__assign)((0,y.__assign)({},s),{x:-l/2,y:-h/2}))}else a.remove();else if(o){l=i.width,h=i.height,"iconfont"===i.fontFamily&&(l=0,h=0);var f="".concat(this.type,"-icon");r.shapeMap[f]=r.addShape("image",{attrs:(0,y.__assign)((0,y.__assign)({},i),{x:-l/2,y:-h/2}),className:f,name:f});var p=r.shapeMap["node-label"]||r.find((function(t){return"node-label"===t.get("name")}));p&&p.toFront()}}},Ks=(0,y.__assign)((0,y.__assign)({},Ys),qs);ja.registerNode("single-node",Ks);var Qs="edge-shape",Js={itemType:"edge",labelPosition:"center",refX:0,refY:0,labelAutoRotate:!1,options:{size:wn.defaultEdge.size,style:{x:0,y:0,stroke:wn.defaultEdge.style.stroke,lineAppendWidth:wn.defaultEdge.style.lineAppendWidth},labelCfg:{style:{fill:wn.edgeLabel.style.fill,fontSize:wn.edgeLabel.style.fontSize,fontFamily:wn.windowFontFamily}},stateStyles:(0,y.__assign)({},wn.edgeStateStyles)},getPath:function(t){var e=[];return(0,_.each)(t,(function(t,n){0===n?e.push(["M",t.x,t.y]):e.push(["L",t.x,t.y])})),e},getShapeStyle:function(t){var e=this.options.style,n={stroke:t.color},r=(0,_.mix)({},e,n,t.style),i=t.size||wn.defaultEdge.size,o=(t=this.getPathPoints(t)).startPoint,a=t.endPoint,s=this.getControlPoints(t),u=[o];s&&(u=u.concat(s)),u.push(a);var l=this.getPath(u);return(0,_.mix)({},wn.defaultEdge.style,{stroke:wn.defaultEdge.color,lineWidth:i,path:l},r)},updateShapeStyle:function(t,e,n){var r,i=e.getContainer(),o=(null===(r=e.getKeyShape)||void 0===r?void 0:r.call(e))||i.shapeMap["edge-shape"],a=t.size,s=(t=this.getPathPoints(t)).startPoint,u=t.endPoint,l=this.getControlPoints(t),c=[s];l&&(c=c.concat(l)),c.push(u);var h=o.attr(),f=t.style||{};void 0===f.stroke&&(f.stroke=t.color);var p=t.sourceNode,d=t.targetNode,g={radius:f.radius};l||(g={source:p,target:d,offset:f.offset,radius:f.radius});var v=this.getPath(c,g),m={};"move"===n?m={path:v}:(h.endArrow&&!1===f.endArrow&&(t.style.endArrow={path:""}),h.startArrow&&!1===f.startArrow&&(t.style.startArrow={path:""}),void 0===(m=(0,y.__assign)({},t.style)).lineWidth&&(m.lineWdith=((0,_.isNumber)(a)?a:null==a?void 0:a[0])||h.lineWidth),void 0===m.path&&(m.path=v),void 0===m.stroke&&(m.stroke=h.stroke||t.color)),o&&o.attr(m)},getLabelStyleByPosition:function(t,e,n){var r,i=e.position||this.labelPosition,o={},a=null==n?void 0:n.shapeMap[Qs];r="start"===i?0:"end"===i?1:.5;var s,u=e.refX||this.refX,l=e.refY||this.refY;if(t.startPoint.x===t.endPoint.x&&t.startPoint.y===t.endPoint.y)return o.x=t.startPoint.x+u,o.y=t.startPoint.y+l,o.text=t.label,o;s=(0,_.isNil)(e.autoRotate)?this.labelAutoRotate:e.autoRotate;var c=In(a,r,u,l,s);return o.x=c.x,o.y=c.y,o.rotate=c.rotate,o.textAlign=this._getTextAlign(i,c.angle),o.text=t.label,o},getLabelBgStyleByPosition:function(t,e){if(!t)return{};var n=t.getBBox(),r=e.style&&e.style.background;if(!r)return{};var i=r.padding,o=n.width+i[1]+i[3],a=n.height+i[0]+i[2],s=(0,y.__assign)((0,y.__assign)({},r),{width:o,height:a,x:n.minX-i[3],y:n.minY-i[0],matrix:[1,0,0,0,1,0,0,0,1]});return((0,_.isNil)(e.autoRotate)?this.labelAutoRotate:e.autoRotate)&&(s.matrix=t.attr("matrix")||[1,0,0,0,1,0,0,0,1]),s},_getTextAlign:function(t,e){var n="center";return e?(e%=2*Math.PI,"center"!==t&&(n=e>=0&&e<=Math.PI/2||e>=1.5*Math.PI&&e<2*Math.PI?t:function(t){var e=t;return"start"===t?e="end":"end"===t&&(e="start"),e}(t)),n):t},getControlPoints:function(t){return t.controlPoints},getPathPoints:function(t){return t},drawShape:function(t,e){var n=this.getShapeStyle(t),r=e.addShape("path",{className:Qs,name:Qs,attrs:n});return e.shapeMap[Qs]=r,r},drawLabel:function(t,e){var n=this.options.labelCfg,r=(0,_.deepMix)({},n,t.labelCfg),i=this.getLabelStyle(t,r,e),o=i.rotate;delete i.rotate;var a=e.addShape("text",{attrs:i,name:"text-shape"});if(e.shapeMap["text-shape"]=a,isNaN(o)||""===o||a.rotateAtStart(o),i.background){var s=this.drawLabelBg(t,e,a,i,o),u=this.itemType+Xs;s.set("classname",u),e.shapeMap[u]=s,a.toFront()}return a},drawLabelBg:function(t,e,n,r,i){var o=this.options.labelCfg,a=(0,_.deepMix)({},o,t.labelCfg),s=this.getLabelBgStyleByPosition(n,a),u=e.addShape("rect",{name:"text-bg-shape",attrs:s});return e.shapeMap["text-bg-shape"]=u,u}},$s=(0,y.__assign)((0,y.__assign)({},Ys),Js);ja.registerEdge("single-edge",$s),ja.registerEdge("line",{getControlPoints:function(){}},"single-edge"),ja.registerEdge("spline",{getPath:function(t){return ms(t)}},"single-edge"),ja.registerEdge("arc",{curveOffset:20,clockwise:1,getControlPoints:function(t){var e,n,r=t.startPoint,i=t.endPoint,o=(r.x+i.x)/2,a=(r.y+i.y)/2;if(void 0!==t.controlPoints){if(n=t.controlPoints[0],e=je(r,n,i),r.x<=i.x&&r.y>i.y?this.clockwise=e.x>n.x?0:1:r.x<=i.x&&r.y<i.y?this.clockwise=e.x>n.x?1:0:r.x>i.x&&r.y<=i.y?this.clockwise=e.y<n.y?0:1:this.clockwise=e.y<n.y?1:0,(n.x-r.x)/(n.y-r.y)==(i.x-r.x)/(i.y-r.y))return[]}else{void 0===t.curveOffset&&(t.curveOffset=this.curveOffset),(0,_.isArray)(t.curveOffset)&&(t.curveOffset=t.curveOffset[0]),t.curveOffset<0?this.clockwise=0:this.clockwise=1;var s={x:i.x-r.x,y:i.y-r.y},u=Math.atan2(s.y,s.x);n={x:t.curveOffset*Math.cos(-Math.PI/2+u)+o,y:t.curveOffset*Math.sin(-Math.PI/2+u)+a},e=je(r,n,i)}var l=Ue(r,e);return[{x:l,y:l}]},getPath:function(t){var e=[];return e.push(["M",t[0].x,t[0].y]),2===t.length?e.push(["L",t[1].x,t[1].y]):e.push(["A",t[1].x,t[1].y,0,0,this.clockwise,t[2].x,t[2].y]),e}},"single-edge"),ja.registerEdge("quadratic",{curvePosition:.5,curveOffset:-20,getControlPoints:function(t){var e=t.controlPoints;if(!e||!e.length){var n=t.startPoint,r=t.endPoint;void 0===t.curveOffset&&(t.curveOffset=this.curveOffset),void 0===t.curvePosition&&(t.curvePosition=this.curvePosition),(0,_.isArray)(this.curveOffset)&&(t.curveOffset=t.curveOffset[0]),(0,_.isArray)(this.curvePosition)&&(t.curvePosition=t.curveOffset[0]),e=[ys(n,r,t.curvePosition,t.curveOffset)]}return e},getPath:function(t){var e=[];return e.push(["M",t[0].x,t[0].y]),e.push(["Q",t[1].x,t[1].y,t[2].x,t[2].y]),e}},"single-edge"),ja.registerEdge("cubic",{curvePosition:[.5,.5],curveOffset:[-20,20],getControlPoints:function(t){var e=t.controlPoints;if(void 0===t.curveOffset&&(t.curveOffset=this.curveOffset),void 0===t.curvePosition&&(t.curvePosition=this.curvePosition),(0,_.isNumber)(t.curveOffset)&&(t.curveOffset=[t.curveOffset,-t.curveOffset]),(0,_.isNumber)(t.curvePosition)&&(t.curvePosition=[t.curvePosition,1-t.curvePosition]),!e||!e.length||e.length<2){var n=t.startPoint,r=t.endPoint;e=[ys(n,r,t.curvePosition[0],t.curveOffset[0]),ys(n,r,t.curvePosition[1],t.curveOffset[1])]}return e},getPath:function(t){var e=[];return e.push(["M",t[0].x,t[0].y]),e.push(["C",t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y]),e}},"single-edge"),ja.registerEdge("cubic-vertical",{curvePosition:[.5,.5],minCurveOffset:[0,0],curveOffset:void 0,getControlPoints:function(t){var e=t.startPoint,n=t.endPoint;void 0===t.curvePosition&&(t.curvePosition=this.curvePosition),void 0===t.curveOffset&&(t.curveOffset=this.curveOffset),void 0===t.minCurveOffset&&(t.minCurveOffset=this.minCurveOffset),(0,_.isNumber)(t.curveOffset)&&(t.curveOffset=[t.curveOffset,-t.curveOffset]),(0,_.isNumber)(t.minCurveOffset)&&(t.minCurveOffset=[t.minCurveOffset,-t.minCurveOffset]),(0,_.isNumber)(t.curvePosition)&&(t.curvePosition=[t.curvePosition,1-t.curvePosition]);var r=n.y-e.y,i=[0,0];return t.curveOffset?i=t.curveOffset:Math.abs(r)<Math.abs(t.minCurveOffset[0])&&(i=t.minCurveOffset),[{x:e.x,y:e.y+r*this.curvePosition[0]+i[0]},{x:n.x,y:n.y-r*this.curvePosition[1]+i[1]}]}},"cubic"),ja.registerEdge("cubic-horizontal",{curvePosition:[.5,.5],minCurveOffset:[0,0],curveOffset:void 0,getControlPoints:function(t){var e=t.startPoint,n=t.endPoint;void 0===t.curvePosition&&(t.curvePosition=this.curvePosition),void 0===t.curveOffset&&(t.curveOffset=this.curveOffset),void 0===t.minCurveOffset&&(t.minCurveOffset=this.minCurveOffset),(0,_.isNumber)(t.curveOffset)&&(t.curveOffset=[t.curveOffset,-t.curveOffset]),(0,_.isNumber)(t.minCurveOffset)&&(t.minCurveOffset=[t.minCurveOffset,-t.minCurveOffset]),(0,_.isNumber)(t.curvePosition)&&(t.curvePosition=[t.curvePosition,1-t.curvePosition]);var r=n.x-e.x,i=[0,0];return t.curveOffset?i=t.curveOffset:Math.abs(r)<Math.abs(t.minCurveOffset[0])&&(i=t.minCurveOffset),[{x:e.x+r*this.curvePosition[0]+i[0],y:e.y},{x:n.x-r*this.curvePosition[1]+i[1],y:n.y}]}},"cubic"),ja.registerEdge("loop",{getPathPoints:function(t){return Pn(t)},getControlPoints:function(t){return t.controlPoints},afterDraw:function(t){t.controlPoints=void 0},afterUpdate:function(t){t.controlPoints=void 0}},"cubic");var tu={itemType:"combo",shapeType:"single-combo",labelPosition:"top",refX:wn.comboLabel.refX,refY:wn.comboLabel.refY,options:{style:{stroke:wn.defaultCombo.style.stroke,fill:wn.defaultCombo.style.fill,lineWidth:wn.defaultCombo.style.lineWidth},labelCfg:{style:{fill:wn.comboLabel.style.fill,fontSize:wn.comboLabel.style.fontSize,fontFamily:wn.windowFontFamily}},stateStyles:(0,y.__assign)({},wn.comboStateStyles)},getSize:function(t){var e=(0,_.clone)(t.size||this.options.size||wn.defaultCombo.size);return(0,_.isArray)(e)&&1===e.length&&(e=[e[0],e[0]]),(0,_.isArray)(e)||(e=[e,e]),e},getLabelStyleByPosition:function(t,e){var n=e.position||this.labelPosition,r=t.style,i=t.padding||this.options.padding;(0,_.isArray)(i)&&(i=i[0]);var o=e.refX,a=e.refY;(0,_.isNil)(o)&&(o=this.refX),(0,_.isNil)(a)&&(a=this.refY);var s,u=this.getSize(t),l=(Math.max(r.r,u[0]/2)||u[0]/2)+i;switch(n){case"top":s={x:0,y:-l-a,textBaseline:"bottom",textAlign:"center"};break;case"bottom":s={x:0,y:l+a,textBaseline:"bottom",textAlign:"center"};break;case"left":s={x:-l+o,y:0,textAlign:"left"};break;case"center":s={x:0,y:0,text:t.label,textAlign:"center"};break;default:s={x:l+o,y:0,textAlign:"right"}}return s.text=t.label,s},drawShape:function(t,e){var n=this.shapeType,r=this.getShapeStyle(t);return e.addShape(n,{attrs:r,draggable:!0,name:"combo-shape"})},updateShape:function(t,e,n){var r=e.get("keyShape");(void 0===t.animate?this.options.animate:t.animate)&&r.animate?r.animate(n,{duration:200,easing:"easeLinear"}):r.attr((0,y.__assign)({},n)),this.updateLabel(t,e)}},eu=(0,y.__assign)((0,y.__assign)({},Ys),tu);ja.registerCombo("single-combo",eu),ja.registerCombo("circle",{options:{size:[wn.defaultCombo.size[0],wn.defaultCombo.size[0]],padding:wn.defaultCombo.padding[0],animate:!0,style:{stroke:wn.defaultCombo.style.stroke,fill:wn.defaultCombo.style.fill,lineWidth:wn.defaultCombo.style.lineWidth},labelCfg:{style:{fill:wn.comboLabel.style.fill,fontSize:wn.comboLabel.style.fontSize},refX:0,refY:0},stateStyles:(0,y.__assign)({},wn.comboStateStyles)},shapeType:"circle",labelPosition:"top",drawShape:function(t,e){var n=this.getShapeStyle(t);return delete n.height,delete n.width,e.addShape("circle",{attrs:n,className:"circle-combo",name:"circle-combo",draggable:!0})},getShapeStyle:function(t){var e=this.options.style,n=t.padding||this.options.padding;(0,_.isArray)(n)&&(n=n[0]);var r,i={stroke:t.color},o=(0,_.mix)({},e,i,t.style);if(t.fixSize)r=(0,_.isNumber)(t.fixSize)?t.fixSize:t.fixSize[0];else{var a=this.getSize(t);r=!(0,_.isNumber)(o.r)||isNaN(o.r)?a[0]/2||wn.defaultCombo.style.r:Math.max(o.r,a[0]/2)||a[0]/2}o.r=r+n;var s=(0,y.__assign)({x:0,y:0},o);return t.style?t.style.r=r:t.style={r},s},update:function(t,e){var n=this.getSize(t),r=t.padding||this.options.padding;(0,_.isArray)(r)&&(r=r[0]);var i,o=(0,_.clone)(t.style);i=t.fixSize?(0,_.isNumber)(t.fixSize)?t.fixSize:t.fixSize[0]:Math.max(o.r,n[0]/2)||n[0]/2,o.r=i+r;var a=e.get("sizeCache");a&&(a.r=o.r);var s={stroke:t.color},u=e.get("keyShape"),l=(0,_.mix)({},u.attr(),s,o);t.style?t.style.r=i:t.style={r:i},this.updateShape(t,e,l,!0)}},"single-combo"),ja.registerCombo("rect",{options:{size:[40,5],padding:[25,20,15,20],animate:!0,style:{radius:0,stroke:wn.defaultCombo.style.stroke,fill:wn.defaultCombo.style.fill,lineWidth:wn.defaultCombo.style.lineWidth},labelCfg:{style:{fill:wn.comboLabel.style.fill,fontSize:wn.comboLabel.style.fontSize,fontFamily:wn.windowFontFamily}},anchorPoints:[[0,.5],[1,.5]],stateStyles:(0,y.__assign)({},wn.comboStateStyles)},shapeType:"rect",labelPosition:"top",drawShape:function(t,e){var n=this.getShapeStyle(t);return e.addShape("rect",{attrs:n,className:"rect-combo",name:"rect-combo",draggable:!0})},getLabelStyleByPosition:function(t,e){var n=e.position||this.labelPosition,r=t.style,i=t.padding||this.options.padding;(0,_.isNumber)(i)&&(i=[i,i,i,i]);var o=e.refX,a=e.refY;(0,_.isNil)(o)&&(o=this.refX),(0,_.isNil)(a)&&(a=this.refY);var s,u=r.width/2+i[3],l=r.height/2+i[0];switch(n){case"top":s={x:0-u+o,y:0-l+a,textBaseline:"top",textAlign:"left"};break;case"bottom":s={x:0,y:l+a,textBaseline:"bottom",textAlign:"center"};break;case"left":s={x:0-u+a,y:0,textAlign:"left"};break;case"center":s={x:0,y:0,text:t.label,textAlign:"center"};break;default:s={x:u+o,y:0,textAlign:"right"}}return s.text=t.label,s},getShapeStyle:function(t){var e=this.options.style,n=t.padding||this.options.padding;(0,_.isNumber)(n)&&(n=[n,n,n,n]);var r,i,o={stroke:t.color},a=(0,_.mix)({},e,o,t.style),s=this.getSize(t),u=t.collapsed&&t.fixCollapseSize?t.fixCollapseSize:t.fixSize;u?(0,_.isNumber)(u)?(r=u,i=u):(r=u[0],i=u[1]):(r=!(0,_.isNumber)(a.width)||isNaN(a.width)?s[0]||wn.defaultCombo.style.width:Math.max(a.width,s[0])||s[0],i=!(0,_.isNumber)(a.height)||isNaN(a.height)?s[1]||wn.defaultCombo.style.height:Math.max(a.height,s[1])||s[1]);var l=-r/2-n[3],c=-i/2-n[0];a.width=r+n[1]+n[3],a.height=i+n[0]+n[2];var h=(0,y.__assign)({x:l,y:c},a);return t.style?(t.style.width=r,t.style.height=i):t.style={width:r,height:i},h},update:function(t,e){var n=this.getSize(t),r=t.padding||this.options.padding;(0,_.isNumber)(r)&&(r=[r,r,r,r]);var i,o,a=(0,_.clone)(t.style),s=t.collapsed&&t.fixCollapseSize?t.fixCollapseSize:t.fixSize;s?(0,_.isNumber)(s)?(i=s,o=s):(i=s[0],o=s[1]):(i=Math.max(a.width,n[0])||n[0],o=Math.max(a.height,n[1])||n[1]),a.width=i+r[1]+r[3],a.height=o+r[0]+r[2];var u=e.get("sizeCache");u&&(u.width=a.width,u.height=a.height),a.x=-i/2-r[3],a.y=-o/2-r[0];var l={stroke:t.color},c=e.get("keyShape"),h=(0,_.mix)({},c.attr(),l,a);t.style?(t.style.width=i,t.style.height=o):t.style={width:i,height:o},this.updateShape(t,e,h,!1)},updateShape:function(t,e,n){var r=e.get("keyShape");(void 0===t.animate?this.options.animate:t.animate)&&r.animate?r.animate(n,{duration:200,easing:"easeLinear"}):r.attr((0,y.__assign)({},n)),this.updateLabel(t,e)}},"single-combo"),ja.registerNode("simple-circle",{options:{size:wn.defaultNode.size,style:{x:0,y:0,stroke:wn.defaultNode.style.stroke,fill:wn.defaultNode.style.fill,lineWidth:wn.defaultNode.style.lineWidth},labelCfg:{style:{fill:wn.nodeLabel.style.fill,fontSize:wn.nodeLabel.style.fontSize,fontFamily:wn.windowFontFamily}},stateStyles:(0,y.__assign)({},wn.nodeStateStyles)},shapeType:"simple-circle",labelPosition:"center",shapeMap:{},drawShape:function(t,e){var n=this.getShapeStyle(t),r="".concat(this.type,"-keyShape"),i=e.addShape("circle",{attrs:n,className:"".concat(this.type,"-keyShape"),name:r,draggable:!0});return e.shapeMap[r]=i,i},getShapeStyle:function(t){var e=(this.mergeStyle||this.getOptions(t)).style,n={stroke:t.color},r=(0,_.deepMix)({},e,n),i=this.getSize(t)[0]/2;return(0,y.__assign)({x:0,y:0,r:i},r)},update:function(t,e,n){var r=this.getSize(t),i={stroke:t.color,r:r[0]/2},o=e.get("keyShape"),a=(0,_.deepMix)({},o.attr(),i,t.style);this.updateShape(t,e,a,!0,n)}},"single-node"),ja.registerNode("simple-rect",{options:{size:[100,30],style:{radius:0,stroke:wn.defaultNode.style.stroke,fill:wn.defaultNode.style.fill,lineWidth:wn.defaultNode.style.lineWidth},labelCfg:{style:{fill:wn.nodeLabel.style.fill,fontSize:wn.nodeLabel.style.fontSize,fontFamily:wn.windowFontFamily}},anchorPoints:[[0,.5],[1,.5]],stateStyles:(0,y.__assign)({},wn.nodeStateStyles)},shapeType:"simple-rect",labelPosition:"center",drawShape:function(t,e){var n=this.getShapeStyle(t);return e.addShape("rect",{attrs:n,className:"".concat(this.type,"-keyShape"),name:"".concat(this.type,"-keyShape"),draggable:!0})},getShapeStyle:function(t){var e=(this.mergeStyle||this.getOptions(t)).style,n={stroke:t.color},r=(0,_.mix)({},e,n),i=this.getSize(t),o=r.width||i[0],a=r.height||i[1];return(0,y.__assign)({x:-o/2,y:-a/2,width:o,height:a},r)},update:function(t,e,n){e.getContainer();var r=(this.mergeStyle||this.getOptions(t)).style,i=this.getSize(t),o=e.get("keyShape");t.size||(i[0]=o.attr("width")||r.width,i[1]=o.attr("height")||r.height);var a={stroke:t.color,x:-i[0]/2,y:-i[1]/2,width:i[0],height:i[1]},s=(0,_.mix)({},r,o.attr(),a);s=(0,_.mix)(s,t.style),this.updateShape(t,e,s,!1,n)}},"single-node"),ja.registerNode("image",{options:{img:"https://gw.alipayobjects.com/mdn/rms_f8c6a0/afts/img/A*eD7nT6tmYgAAAAAAAAAAAABkARQnAQ",size:200,labelCfg:{style:{fontFamily:wn.windowFontFamily}},clipCfg:{show:!1,type:"circle",r:50,rx:50,ry:35,width:50,height:35,points:[[30,12],[12,30],[30,48],[48,30]],path:[["M",25,25],["L",50,25],["A",12.5,12.5,0,1,1,50,50],["A",12.5,12.5,0,1,0,50,50],["L",25,75],["Z"]],x:0,y:0}},shapeType:"image",labelPosition:"bottom",drawShape:function(t,e){var n=this.shapeType,r=this.getShapeStyle(t);delete r.fill;var i=e.addShape(n,{attrs:r,className:"".concat(this.type,"-keyShape"),name:"".concat(this.type,"-keyShape"),draggable:!0});return this.drawClip(t,i),i},drawClip:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).clipCfg;if(n.show){var r=n.type,i=n.x,o=n.y,a=n.style;if("circle"===r){var s=n.r;e.setClip({type:"circle",attrs:(0,y.__assign)({r:s,x:i,y:o},a)})}else if("rect"===r){var u=n.width,l=n.height,c=i-u/2,h=o-l/2;e.setClip({type:"rect",attrs:(0,y.__assign)({x:c,y:h,width:u,height:l},a)})}else if("ellipse"===r){var f=n.rx,p=n.ry;e.setClip({type:"ellipse",attrs:(0,y.__assign)({x:i,y:o,rx:f,ry:p},a)})}else if("polygon"===r){var d=n.points;e.setClip({type:"polygon",attrs:(0,y.__assign)({points:d},a)})}else if("path"===r){var g=n.path;e.setClip({type:"path",attrs:(0,y.__assign)({path:g},a)})}}},getShapeStyle:function(t){var e=this.mergeStyle||this.getOptions(t),n=e.style,r=e.img,i=this.getSize(t),o=i[0],a=i[1];return n&&(o=n.width||i[0],a=n.height||i[1]),(0,y.__assign)({x:-o/2,y:-a/2,width:o,height:a,img:r},n)},updateShapeStyle:function(t,e){var n=e.getContainer(),r="".concat(this.itemType,"-shape"),i=n.shapeMap[r]||n.find((function(t){return t.get("className")===r}))||e.getKeyShape(),o=this.getShapeStyle(t);i&&!i.destroyed&&i.attr(o)}},"single-node");const nu={triangle:function(t,e,n){void 0===t&&(t=10),void 0===e&&(e=15),void 0===n&&(n=0);var r=2*n;return"M ".concat(r,",0 L ").concat(r+e,",-").concat(t/2," L ").concat(r+e,",").concat(t/2," Z")},vee:function(t,e,n){void 0===t&&(t=15),void 0===e&&(e=20),void 0===n&&(n=0);var r=2*n;return"M ".concat(r,",0 L ").concat(r+e,",-").concat(t/2,"\n        L ").concat(r+2*e/3,",0 L ").concat(r+e,",").concat(t/2," Z")},circle:function(t,e){return void 0===t&&(t=5),void 0===e&&(e=0),"M ".concat(2*e,", 0\n            a ").concat(t,",").concat(t," 0 1,0 ").concat(2*t,",0\n            a ").concat(t,",").concat(t," 0 1,0 ").concat(2*-t,",0")},rect:function(t,e,n){void 0===t&&(t=10),void 0===e&&(e=10),void 0===n&&(n=0);var r=2*n;return"M ".concat(r,",").concat(-t/2," \n        L ").concat(r+e,",").concat(-t/2," \n        L ").concat(r+e,",").concat(t/2," \n        L ").concat(r,",").concat(t/2," Z")},diamond:function(t,e,n){void 0===t&&(t=15),void 0===e&&(e=15),void 0===n&&(n=0);var r=2*n;return"M ".concat(r,",0 \n        L ").concat(r+e/2,",").concat(-t/2," \n        L ").concat(r+e,",0 \n        L ").concat(r+e/2,",").concat(t/2," Z")},triangleRect:function(t,e,n,r,i,o){void 0===t&&(t=15),void 0===e&&(e=15),void 0===n&&(n=15),void 0===r&&(r=3),void 0===i&&(i=5),void 0===o&&(o=0);var a=2*o,s=a+e+i;return"M ".concat(a,",0 L ").concat(a+e,",-").concat(t/2," L ").concat(a+e,",").concat(t/2," Z\n            M ").concat(s,", -").concat(n/2,"\n            L ").concat(s+r," -").concat(n/2,"\n            L ").concat(s+r," ").concat(n/2,"\n            L ").concat(s," ").concat(n/2,"\n            Z")}},ru={collapse:function(t,e,n){return[["M",t-n,e],["a",n,n,0,1,0,2*n,0],["a",n,n,0,1,0,2*-n,0],["M",t-n+4,e],["L",t+n-4,e]]},expand:function(t,e,n){return[["M",t-n,e],["a",n,n,0,1,0,2*n,0],["a",n,n,0,1,0,2*-n,0],["M",t-n+4,e],["L",t-n+2*n-4,e],["M",t-n+n,e-n+4],["L",t,e+n-4]]},upTriangle:function(t,e,n){var r=n*Math.cos(Math.PI/6),i=n*Math.sin(Math.PI/6);return[["M",t-r,e+i],["L",t+r,e+i],["L",t,e-n],["Z"]]},downTriangle:function(t,e,n){var r=n*Math.cos(Math.PI/6),i=n*Math.sin(Math.PI/6);return[["M",t-r,e-i],["L",t+r,e-i],["L",t,e+n],["Z"]]}},iu=ja;var ou=["#5F95FF","#61DDAA","#65789B","#F6BD16","#7262FD","#78D3F8","#9661BC","#F6903D","#008685","#F08BB4"],au=ut;const su=(0,y.__assign)((0,y.__assign)((0,y.__assign)((0,y.__assign)((0,y.__assign)((0,y.__assign)({},l),a),c),o),h),{transform:au,mat3:r});var uu=function(){function t(t){this.graph=t,this.layoutCfg=t.get("layout")||{},this.layoutType=this.getLayoutType(),this.layoutMethods=[],this.initLayout()}return t.prototype.initLayout=function(){},t.prototype.getLayoutType=function(){return this.getLayoutCfgType(this.layoutCfg)},t.prototype.getLayoutCfgType=function(t){var e=t.type;if(e)return e;var n=t.pipes;return Array.isArray(n)?n.map((function(t){return(null==t?void 0:t.type)||""})):null},t.prototype.isLayoutTypeSame=function(t){var e=this.getLayoutCfgType(t);return Array.isArray(this.layoutType)?this.layoutType.every((function(t,n){return t===e[n]})):(null==t?void 0:t.type)===this.layoutType},t.prototype.refreshLayout=function(){var t=this.graph;t&&(t.get("animate")?t.positionsAnimate():t.refreshPositions())},t.prototype.changeLayout=function(t){this.layoutCfg=t,this.destoryLayoutMethods(),this.layout()},t.prototype.changeData=function(){this.destoryLayoutMethods(),this.layout()},t.prototype.destoryLayoutMethods=function(){var t=this.layoutMethods;null==t||t.forEach((function(t){t.destroy()})),this.layoutMethods=[]},t.prototype.destroyLayout=function(){var t=this.graph;this.destoryLayoutMethods(),t.set("layout",void 0),this.layoutCfg=void 0,this.layoutType=void 0,this.layoutMethods=void 0},t.prototype.setDataFromGraph=function(){for(var t=[],e=[],n=[],r=[],i=[],o=[],a=this.graph.getNodes(),s=this.graph.getEdges(),u=this.graph.getCombos(),l=a.length,c=0;c<l;c++){var h=a[c];if(h&&!h.destroyed){var f=h.getModel();h.isVisible()?t.push(f):e.push(f)}}var p=s.length;for(c=0;c<p;c++){var d=s[c];d&&!d.destroyed&&(f=d.getModel(),d.isVisible()?f.isComboEdge?i.push(f):n.push(f):r.push(f))}var g=u.length;for(c=0;c<g;c++){var v=u[c];v.destroyed||(f=v.getModel(),v.isVisible()?o.push(f):r.push(f))}return{nodes:t,hiddenNodes:e,edges:n,hiddenEdges:r,combos:o,hiddenCombos:[],comboEdges:i}},t.prototype.reLayoutMethod=function(t,e){var n=this;return new Promise((function(r,i){var o=n.graph,a=null==e?void 0:e.type;e.onLayoutEnd=function(){o.emit("aftersublayout",{type:a}),r()},t.init(n.data),"force"===a&&(t.ticking=!1,t.forceSimulation.stop()),o.emit("beforesublayout",{type:a}),t.execute(),t.isCustomLayout&&e.onLayoutEnd&&e.onLayoutEnd()}))},t.prototype.relayout=function(t){var e=this,n=this,r=n.graph,i=n.layoutMethods,o=n.layoutCfg;if(t){this.data=this.setDataFromGraph();var a=this.data.nodes;if(!a)return!1;this.initPositions(o.center,a)}r.emit("beforelayout");var s=Promise.resolve();null==i||i.forEach((function(t,n){var r=o[n];s=s.then((function(){return e.reLayoutMethod(t,r)}))})),s.then((function(){o.onAllLayoutEnd&&o.onAllLayoutEnd()})).catch((function(t){console.warn("relayout failed",t)}))},t.prototype.filterLayoutData=function(t,e){var n,r,i=t.nodes,o=t.edges,a=(0,y.__rest)(t,["nodes","edges"]);if(!i)return t;n=(0,_.isFunction)(null==e?void 0:e.nodesFilter)?e.nodesFilter:function(){return!0};var s=i.filter(n);if((0,_.isFunction)(null==e?void 0:e.edgesFilter))r=e.edgesFilter;else{var u=s.reduce((function(t,e){return t[e.id]=!0,t}),{});r=function(t){return u[t.source]&&u[t.target]}}return(0,y.__assign)({nodes:s,edges:o.filter(r)},a)},t.prototype.getLayoutBBox=function(t){var e=this.graph,n=(0,_.groupBy)(e.getNodes(),(function(t){return t.getModel().layoutOrder})),r=Object.values(n).map((function(t){var e=Aa(t);return e.size=[e.width,e.height],e}));return{groupNodes:Object.values((0,_.groupBy)(t,"layoutOrder")),layoutNodes:r}},t.prototype.layoutAnimate=function(){},t.prototype.moveToZero=function(){var t=this.graph.get("data").nodes;if(void 0!==t[0].x&&null!==t[0].x&&!Ca(t[0].x)){for(var e=[0,0],n=t.length,r=0;r<n;r++){var i=t[r];e[0]+=i.x,e[1]+=i.y}for(e[0]/=t.length,e[1]/=t.length,r=0;r<n;r++)(i=t[r]).x-=e[0],i.y-=e[1]}},t.prototype.initPositions=function(t,e){var n=this.graph;if(!e)return!1;var r=e?e.length:0;if(r){var i=.85*n.get("width"),o=.85*n.get("height"),a=Math.ceil(Math.sqrt(r)*(i/o)),s=i/(a-1),u=o/(Math.ceil(r/a)-1);isFinite(s)&&s||(s=0),isFinite(u)&&s||(u=0);for(var l=t[0]-i/2,c=t[1]-o/2,h=!0,f=0;f<r;f++){var p=e[f];Ca(+p.x)&&(h=!1,p.x=f%a*s+l),Ca(+p.y)&&(h=!1,p.y=Math.floor(f/a)*u+c)}return h}},t.prototype.destroy=function(){this.graph=null,this.destoryLayoutMethods(),this.destroyed=!0},t}();const lu=uu;const cu=function(t){this.graph=t,this.destroyed=!1,this.initEvents()};var hu;!function(t){t.CLICK="click",t.DBLCLICK="dblclick",t.MOUSEDOWN="mousedown",t.MOUDEUP="mouseup",t.CONTEXTMENU="contextmenu",t.MOUSEENTER="mouseenter",t.MOUSEOUT="mouseout",t.MOUSEOVER="mouseover",t.MOUSEMOVE="mousemove",t.MOUSELEAVE="mouseleave",t.DRAGSTART="dragstart",t.DRAGEND="dragend",t.DRAG="drag",t.DRAGENTER="dragenter",t.DRAGLEAVE="dragleave",t.DRAGOVER="dragover",t.DRAGOUT="dragout",t.DDROP="drop",t.KEYUP="keyup",t.KEYDOWN="keydown",t.WHEEL="wheel",t.FOCUS="focus",t.BLUR="blur",t.TOUCHSTART="touchstart",t.TOUCHMOVE="touchmove",t.TOUCHEND="touchend",t.CANVAS_TOUCHSTART="canvas:touchstart",t.CANVAS_TOUCHMOVE="canvas:touchmove",t.CANVAS_TOUCHEND="canvas:touchend",t.NODE_TOUCHSTART="node:touchstart",t.NODE_TOUCHMOVE="node:touchmove",t.NODE_TOUCHEND="node:touchend",t.COMBO_TOUCHSTART="combo:touchstart",t.COMBO_TOUCHMOVE="combo:touchmove",t.COMBO_TOUCHEND="combo:touchend",t.EDGE_TOUCHSTART="edge:touchstart",t.EDGE_TOUCHMOVE="edge:touchmove",t.EDGE_TOUCHEND="edge:touchend",t.NODE_CONTEXTMENU="node:contextmenu",t.NODE_CLICK="node:click",t.NODE_DBLCLICK="node:dblclick",t.NODE_MOUSEDOWN="node:mousedown",t.NODE_MOUSEUP="node:mouseup",t.NODE_MOUSEENTER="node:mouseenter",t.NODE_MOUSELEAVE="node:mouseleave",t.NODE_MOUSEMOVE="node:mousemove",t.NODE_MOUSEOUT="node:mouseout",t.NODE_MOUSEOVER="node:mouseover",t.NODE_DROP="node:drop",t.NODE_DRAGOVER="node:dragover",t.NODE_DRAGENTER="node:dragenter",t.NODE_DRAGLEAVE="node:dragleave",t.NODE_DRAGSTART="node:dragstart",t.NODE_DRAG="node:drag",t.NODE_DRAGEND="node:dragend",t.NODE_TAP="node:tap",t.NODE_PANSTART="node:panstart",t.NODE_PANMOVE="node:panmove",t.NODE_PANEND="node:panend",t.COMBO_CONTEXTMENU="combo:contextmenu",t.COMBO_CLICK="combo:click",t.COMBO_DBLCLICK="combo:dblclick",t.COMBO_MOUSEDOWN="combo:mousedown",t.COMBO_MOUSEUP="combo:mouseup",t.COMBO_MOUSEENTER="combo:mouseenter",t.COMBO_MOUSELEAVE="combo:mouseleave",t.COMBO_MOUSEMOVE="combo:mousemove",t.COMBO_MOUSEOUT="combo:mouseout",t.COMBO_MOUSEOVER="combo:mouseover",t.COMBO_DROP="combo:drop",t.COMBO_DRAGOVER="combo:dragover",t.COMBO_DRAGENTER="combo:dragenter",t.COMBO_DRAGLEAVE="combo:dragleave",t.COMBO_DRAGSTART="combo:dragstart",t.COMBO_DRAG="combo:drag",t.COMBO_DRAGEND="combo:dragend",t.COMBO_TAP="combo:tap",t.COMBO_PANSTART="combo:panstart",t.COMBO_PANMOVE="combo:panmove",t.COMBO_PANEND="combo:panend",t.EDGE_CONTEXTMENU="edge:contextmenu",t.EDGE_CLICK="edge:click",t.EDGE_DBLCLICK="edge:dblclick",t.EDGE_MOUSEDOWN="edge:mousedown",t.EDGE_MOUSEUP="edge:mouseup",t.EDGE_MOUSEENTER="edge:mouseenter",t.EDGE_MOUSELEAVE="edge:mouseleave",t.EDGE_MOUSEMOVE="edge:mousemove",t.EDGE_MOUSEOUT="edge:mouseout",t.EDGE_MOUSEOVER="edge:mouseover",t.EDGE_DROP="edge:drop",t.EDGE_DRAGOVER="edge:dragover",t.EDGE_DRAGENTER="edge:dragenter",t.EDGE_DRAGLEAVE="edge:dragleave",t.CANVAS_CONTEXTMENU="canvas:contextmenu",t.CANVAS_CLICK="canvas:click",t.CANVAS_DBLCLICK="canvas:dblclick",t.CANVAS_MOUSEDOWN="canvas:mousedown",t.CANVAS_MOUSEUP="canvas:mouseup",t.CANVAS_MOUSEENTER="canvas:mouseenter",t.CANVAS_MOUSELEAVE="canvas:mouseleave",t.CANVAS_MOUSEMOVE="canvas:mousemove",t.CANVAS_MOUSEOUT="canvas:mouseout",t.CANVAS_MOUSEOVER="canvas:mouseover",t.CANVAS_DROP="canvas:drop",t.CANVAS_DRAGENTER="canvas:dragenter",t.CANVAS_DRAGLEAVE="canvas:dragleave",t.CANVAS_DRAGSTART="canvas:dragstart",t.CANVAS_DRAG="canvas:drag",t.CANVAS_DRAGEND="canvas:dragend",t.CANVAS_TAP="canvas:tap",t.CANVAS_PANSTART="canvas:panstart",t.CANVAS_PANMOVE="canvas:panmove",t.CANVAS_PANEND="canvas:panend",t.BEFORERENDER="beforerender",t.AFTERRENDER="afterrender",t.BEFOREADDITEM="beforeadditem",t.AFTERADDITEM="afteradditem",t.BEFOREREMOVEITEM="beforeremoveitem",t.AFTERREMOVEITEM="afterremoveitem",t.BEFOREUPDATEITEM="beforeupdateitem",t.AFTERUPDATEITEM="afterupdateitem",t.BEFOREITEMVISIBILITYCHANGE="beforeitemvisibilitychange",t.AFTERITEMVISIBILITYCHANGE="afteritemvisibilitychange",t.BEFOREITEMSTATECHANGE="beforeitemstatechange",t.AFTERITEMSTATECHANGE="afteritemstatechange",t.BEFOREITEMREFRESH="beforeitemrefresh",t.AFTERITEMREFRESH="afteritemrefresh",t.BEFOREITEMSTATESCLEAR="beforeitemstatesclear",t.AFTERITEMSTATESCLEAR="afteritemstatesclear",t.BEFOREMODECHANGE="beforemodechange",t.AFTERMODECHANGE="aftermodechange",t.BEFORELAYOUT="beforelayout",t.AFTERLAYOUT="afterlayout",t.BEFORECREATEEDGE="beforecreateedge",t.AFTERCREATEEDGE="aftercreateedge",t.BEFOREGRAPHREFRESHPOSITION="beforegraphrefreshposition",t.AFTERGRAPHREFRESHPOSITION="aftergraphrefreshposition",t.BEFOREGRAPHREFRESH="beforegraphrefresh",t.AFTERGRAPHREFRESH="aftergraphrefresh",t.BEFOREANIMATE="beforeanimate",t.AFTERANIMATE="afteranimate",t.BEFOREPAINT="beforepaint",t.AFTERPAINT="afterpaint",t.BEFORECOLLAPSEEXPANDCOMBO="beforecollapseexpandcombo",t.AFTERCOLLAPSEEXPANDCOMBO="aftercollapseexpandcombo",t.GRAPHSTATECHANGE="graphstatechange",t.AFTERACTIVATERELATIONS="afteractivaterelations",t.NODESELECTCHANGE="nodeselectchange",t.TOOLTIPCHANGE="tooltipchange",t.WHEELZOOM="wheelzoom",t.VIEWPORTCHANGE="viewportchange",t.DRAGNODEEND="dragnodeend",t.STACKCHANGE="stackchange",t.TAP="tap",t.PINCHSTART="pinchstart",t.PINCHMOVE="pinchmove",t.PANSTART="panstart",t.PANMOVE="panmove",t.PANEND="panend"}(hu||(hu={}));var fu=iu.registerNode,pu=iu.registerEdge,du=iu.registerCombo,gu=E.registerBehavior,vu=wn;iu.registerNode,iu.registerEdge,iu.registerCombo,E.registerBehavior;var mu=n(369);function yu(t,e,n,r){var i=t-n,o=e-r;return Math.sqrt(i*i+o*o)}function _u(t,e,n,r,i,o){return i>=t&&i<=t+n&&o>=e&&o<=e+r}function bu(t,e){return!(e.minX>t.maxX||e.maxX<t.minX||e.minY>t.maxY||e.maxY<t.minY)}function xu(t,e){return t[0]===e[0]&&t[1]===e[1]}var wu=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,Eu=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,Su=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,Cu=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;function Au(t,e){var n=t.match(Cu);(0,_.each)(n,(function(t){var n=t.split(":");e.addColorStop(n[0],n[1])}))}function Tu(t,e,n){var r=e.getBBox();if(isNaN(r.x)||isNaN(r.y)||isNaN(r.width)||isNaN(r.height))return n;if((0,_.isString)(n)){if("("===n[1]||"("===n[2]){if("l"===n[0])return function(t,e,n){var r,i,o=wu.exec(n),a=parseFloat(o[1])%360*(Math.PI/180),s=o[2],u=e.getBBox();a>=0&&a<.5*Math.PI?(r={x:u.minX,y:u.minY},i={x:u.maxX,y:u.maxY}):.5*Math.PI<=a&&a<Math.PI?(r={x:u.maxX,y:u.minY},i={x:u.minX,y:u.maxY}):Math.PI<=a&&a<1.5*Math.PI?(r={x:u.maxX,y:u.maxY},i={x:u.minX,y:u.minY}):(r={x:u.minX,y:u.maxY},i={x:u.maxX,y:u.minY});var l=Math.tan(a),c=l*l,h=(i.x-r.x+l*(i.y-r.y))/(c+1)+r.x,f=l*(i.x-r.x+l*(i.y-r.y))/(c+1)+r.y,p=t.createLinearGradient(r.x,r.y,h,f);return Au(s,p),p}(t,e,n);if("r"===n[0])return function(t,e,n){var r=Eu.exec(n),i=parseFloat(r[1]),o=parseFloat(r[2]),a=parseFloat(r[3]),s=r[4];if(0===a){var u=s.match(Cu);return u[u.length-1].split(":")[1]}var l=e.getBBox(),c=l.maxX-l.minX,h=l.maxY-l.minY,f=Math.sqrt(c*c+h*h)/2,p=t.createRadialGradient(l.minX+c*i,l.minY+h*o,0,l.minX+c/2,l.minY+h/2,a*f);return Au(s,p),p}(t,e,n);if("p"===n[0])return function(t,e,n){if(e.get("patternSource")&&e.get("patternSource")===n)return e.get("pattern");var r,i,o=Su.exec(n),a=o[1],s=o[2];function u(){r=t.createPattern(i,a),e.set("pattern",r),e.set("patternSource",n)}switch(a){case"a":a="repeat";break;case"x":a="repeat-x";break;case"y":a="repeat-y";break;default:a="no-repeat"}return i=new Image,s.match(/^data:/i)||(i.crossOrigin="Anonymous"),i.src=s,i.complete?u():(i.onload=u,i.src=i.src),r}(t,e,n)}return n}return n instanceof CanvasPattern?n:void 0}function ku(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Mu(t,e){return ku(t)*ku(e)?(t[0]*e[0]+t[1]*e[1])/(ku(t)*ku(e)):1}function Pu(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(Mu(t,e))}function Iu(t,e){var n=e[1],r=e[2],i=(0,_.mod)((0,_.toRadian)(e[3]),2*Math.PI),o=e[4],a=e[5],s=t[0],u=t[1],l=e[6],c=e[7],h=Math.cos(i)*(s-l)/2+Math.sin(i)*(u-c)/2,f=-1*Math.sin(i)*(s-l)/2+Math.cos(i)*(u-c)/2,p=h*h/(n*n)+f*f/(r*r);p>1&&(n*=Math.sqrt(p),r*=Math.sqrt(p));var d=n*n*(f*f)+r*r*(h*h),g=d?Math.sqrt((n*n*(r*r)-d)/d):1;o===a&&(g*=-1),isNaN(g)&&(g=0);var v=r?g*n*f/r:0,m=n?g*-r*h/n:0,y=(s+l)/2+Math.cos(i)*v-Math.sin(i)*m,b=(u+c)/2+Math.sin(i)*v+Math.cos(i)*m,x=[(h-v)/n,(f-m)/r],w=[(-1*h-v)/n,(-1*f-m)/r],E=Pu([1,0],x),S=Pu(x,w);return Mu(x,w)<=-1&&(S=Math.PI),Mu(x,w)>=1&&(S=0),0===a&&S>0&&(S-=2*Math.PI),1===a&&S<0&&(S+=2*Math.PI),{cx:y,cy:b,rx:xu(t,[l,c])?0:n,ry:xu(t,[l,c])?0:r,startAngle:E,endAngle:E+S,xRotation:i,arcFlag:o,sweepFlag:a}}var Ou=Math.sin,Ru=Math.cos,Lu=Math.atan2,Du=Math.PI;function Nu(t,e,n,r,i,o,a){var s=e.stroke,u=e.lineWidth,l=Lu(r-o,n-i),c=new wl({type:"path",canvas:t.get("canvas"),isArrowShape:!0,attrs:{path:"M"+10*Ru(Du/6)+","+10*Ou(Du/6)+" L0,0 L"+10*Ru(Du/6)+",-"+10*Ou(Du/6),stroke:s,lineWidth:u}});c.translate(i,o),c.rotateAtPoint(i,o,l),t.set(a?"startArrowShape":"endArrowShape",c)}function Bu(t,e,n,r,i,o,a){var s=e.startArrow,u=e.endArrow,l=e.stroke,c=e.lineWidth,h=a?s:u,f=h.d,p=h.fill,d=h.stroke,g=h.lineWidth,v=(0,y.__rest)(h,["d","fill","stroke","lineWidth"]),m=Lu(r-o,n-i);f&&(i-=Ru(m)*f,o-=Ou(m)*f);var _=new wl({type:"path",canvas:t.get("canvas"),isArrowShape:!0,attrs:(0,y.__assign)((0,y.__assign)({},v),{stroke:d||l,lineWidth:g||c,fill:p})});_.translate(i,o),_.rotateAtPoint(i,o,m),t.set(a?"startArrowShape":"endArrowShape",_)}function zu(t,e,n,r,i){var o=Lu(r-e,n-t);return{dx:Ru(o)*i,dy:Ou(o)*i}}function Fu(t,e,n,r,i,o){"object"==typeof e.startArrow?Bu(t,e,n,r,i,o,!0):e.startArrow?Nu(t,e,n,r,i,o,!0):t.set("startArrowShape",null)}function Zu(t,e,n,r,i,o){"object"==typeof e.endArrow?Bu(t,e,n,r,i,o,!1):e.endArrow?Nu(t,e,n,r,i,o,!1):t.set("startArrowShape",null)}var ju={fill:"fillStyle",stroke:"strokeStyle",opacity:"globalAlpha"};function Uu(t,e){var n=e.attr();for(var r in n){var i=n[r],o=ju[r]?ju[r]:r;"matrix"===o&&i?t.transform(i[0],i[1],i[3],i[4],i[6],i[7]):"lineDash"===o&&t.setLineDash?(0,_.isArray)(i)&&t.setLineDash(i):("strokeStyle"===o||"fillStyle"===o?i=Tu(t,e,i):"globalAlpha"===o&&(i*=t.globalAlpha),t[o]=i)}}function Gu(t,e,n){for(var r=0;r<e.length;r++){var i=e[r];i.cfg.visible?i.draw(t,n):i.skipDraw()}}function Vu(t,e,n){var r=t.get("refreshElements");(0,_.each)(r,(function(e){if(e!==t)for(var n=e.cfg.parent;n&&n!==t&&!n.cfg.refresh;)n.cfg.refresh=!0,n=n.cfg.parent})),r[0]===t?Xu(e,n):Wu(e,n)}function Wu(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r.cfg.visible)if(r.cfg.hasChanged)r.cfg.refresh=!0,r.isGroup()&&Xu(r.cfg.children,e);else if(r.cfg.refresh)r.isGroup()&&Wu(r.cfg.children,e);else{var i=Yu(r,e);r.cfg.refresh=i,i&&r.isGroup()&&Wu(r.cfg.children,e)}}}function Hu(t){for(var e=0;e<t.length;e++){var n=t[e];n.cfg.hasChanged=!1,n.isGroup()&&!n.destroyed&&Hu(n.cfg.children)}}function Xu(t,e){for(var n=0;n<t.length;n++){var r=t[n];r.cfg.refresh=!0,r.isGroup()&&Xu(r.get("children"),e)}}function Yu(t,e){var n=t.cfg.cacheCanvasBBox;return t.cfg.isInView&&n&&bu(n,e)}function qu(t,e,n,r){var i=n.path,o=n.startArrow,a=n.endArrow;if(i){var s=[0,0],u=[0,0],l={dx:0,dy:0};e.beginPath();for(var c=0;c<i.length;c++){var h=i[c],f=h[0];if(0===c&&o&&o.d)l=zu((p=t.getStartTangent())[0][0],p[0][1],p[1][0],p[1][1],o.d);else if(c===i.length-2&&"Z"===i[c+1][0]&&a&&a.d)"Z"===i[c+1][0]&&(l=zu((p=t.getEndTangent())[0][0],p[0][1],p[1][0],p[1][1],a.d));else if(c===i.length-1&&a&&a.d){var p;"Z"!==i[0]&&(l=zu((p=t.getEndTangent())[0][0],p[0][1],p[1][0],p[1][1],a.d))}var d=l.dx,g=l.dy;switch(f){case"M":e.moveTo(h[1]-d,h[2]-g),u=[h[1],h[2]];break;case"L":e.lineTo(h[1]-d,h[2]-g);break;case"Q":e.quadraticCurveTo(h[1],h[2],h[3]-d,h[4]-g);break;case"C":e.bezierCurveTo(h[1],h[2],h[3],h[4],h[5]-d,h[6]-g);break;case"A":var v=void 0;r?(v=r[c])||(v=Iu(s,h),r[c]=v):v=Iu(s,h);var m=v.cx,y=v.cy,_=v.rx,b=v.ry,x=v.startAngle,w=v.endAngle,E=v.xRotation,S=v.sweepFlag;if(e.ellipse)e.ellipse(m,y,_,b,E,x,w,1-S);else{var C=_>b?_:b,A=_>b?1:_/b,T=_>b?b/_:1;e.translate(m,y),e.rotate(E),e.scale(A,T),e.arc(0,0,C,x,w,1-S),e.scale(1/A,1/T),e.rotate(-E),e.translate(-m,-y)}break;case"Z":e.closePath()}if("Z"===f)s=u;else{var k=h.length;s=[h[k-2],h[k-1]]}}}}function Ku(t,e){var n=t.get("canvas");n&&("remove"===e&&(t._cacheCanvasBBox=t.get("cacheCanvasBBox")),t.get("hasChanged")||(t.set("hasChanged",!0),t.cfg.parent&&t.cfg.parent.get("hasChanged")||(n.refreshElement(t,e,n),n.get("autoDraw")&&n.draw())))}var Qu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.onCanvasChange=function(t){Ku(this,t)},e.prototype.getShapeBase=function(){return f},e.prototype.getGroupBase=function(){return e},e.prototype._applyClip=function(t,e){e&&(t.save(),Uu(t,e),e.createPath(t),t.restore(),t.clip(),e._afterDraw())},e.prototype.cacheCanvasBBox=function(){var t=this.cfg.children,e=[],n=[];(0,_.each)(t,(function(t){var r=t.cfg.cacheCanvasBBox;r&&t.cfg.isInView&&(e.push(r.minX,r.maxX),n.push(r.minY,r.maxY))}));var r=null;if(e.length){var i=(0,_.min)(e),o=(0,_.max)(e),a=(0,_.min)(n),s=(0,_.max)(n);r={minX:i,minY:a,x:i,y:a,maxX:o,maxY:s,width:o-i,height:s-a};var u=this.cfg.canvas;if(u){var l=u.getViewRange();this.set("isInView",bu(r,l))}}else this.set("isInView",!1);this.set("cacheCanvasBBox",r)},e.prototype.draw=function(t,e){var n=this.cfg.children,r=!e||this.cfg.refresh;n.length&&r&&(t.save(),Uu(t,this),this._applyClip(t,this.getClip()),Gu(t,n,e),t.restore(),this.cacheCanvasBBox()),this.cfg.refresh=null,this.set("hasChanged",!1)},e.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("hasChanged",!1)},e}(yo);const Ju=Qu;var $u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},e.prototype.getShapeBase=function(){return f},e.prototype.getGroupBase=function(){return Ju},e.prototype.onCanvasChange=function(t){Ku(this,t)},e.prototype.calculateBBox=function(){var t=this.get("type"),e=this.getHitLineWidth(),n=wo(t)(this),r=e/2,i=n.x-r,o=n.y-r,a=n.x+n.width+r,s=n.y+n.height+r;return{x:i,minX:i,y:o,minY:o,width:n.width+e,height:n.height+e,maxX:a,maxY:s}},e.prototype.isFill=function(){return!!this.attrs.fill||this.isClipShape()},e.prototype.isStroke=function(){return!!this.attrs.stroke},e.prototype._applyClip=function(t,e){e&&(t.save(),Uu(t,e),e.createPath(t),t.restore(),t.clip(),e._afterDraw())},e.prototype.draw=function(t,e){var n=this.cfg.clipShape;if(e){if(!1===this.cfg.refresh)return void this.set("hasChanged",!1);if(!bu(e,this.getCanvasBBox()))return this.set("hasChanged",!1),void(this.cfg.isInView&&this._afterDraw())}t.save(),Uu(t,this),this._applyClip(t,n),this.drawPath(t),t.restore(),this._afterDraw()},e.prototype.getCanvasViewBox=function(){var t=this.cfg.canvas;return t?t.getViewRange():null},e.prototype.cacheCanvasBBox=function(){var t=this.getCanvasViewBox();if(t){var e=this.getCanvasBBox(),n=bu(e,t);this.set("isInView",n),n?this.set("cacheCanvasBBox",e):this.set("cacheCanvasBBox",null)}},e.prototype._afterDraw=function(){this.cacheCanvasBBox(),this.set("hasChanged",!1),this.set("refresh",null)},e.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("isInView",null),this.set("hasChanged",!1)},e.prototype.drawPath=function(t){this.createPath(t),this.strokeAndFill(t),this.afterDrawPath(t)},e.prototype.fill=function(t){t.fill()},e.prototype.stroke=function(t){t.stroke()},e.prototype.strokeAndFill=function(t){var e=this.attrs,n=e.lineWidth,r=e.opacity,i=e.strokeOpacity,o=e.fillOpacity;this.isFill()&&((0,_.isNil)(o)||1===o?this.fill(t):(t.globalAlpha=o,this.fill(t),t.globalAlpha=r)),this.isStroke()&&n>0&&((0,_.isNil)(i)||1===i||(t.globalAlpha=i),this.stroke(t)),this.afterDrawPath(t)},e.prototype.createPath=function(t){},e.prototype.afterDrawPath=function(t){},e.prototype.isInShape=function(t,e){var n=this.isStroke(),r=this.isFill(),i=this.getHitLineWidth();return this.isInStrokeOrPath(t,e,n,r,i)},e.prototype.isInStrokeOrPath=function(t,e,n,r,i){return!1},e.prototype.getHitLineWidth=function(){if(!this.isStroke())return 0;var t=this.attrs;return t.lineWidth+t.lineAppendWidth},e}(_o);const tl=$u;const el=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{x:0,y:0,r:0})},e.prototype.isInStrokeOrPath=function(t,e,n,r,i){var o=this.attr(),a=o.x,s=o.y,u=o.r,l=i/2,c=yu(a,s,t,e);return r&&n?c<=u+l:r?c<=u:!!n&&c>=u-l&&c<=u+l},e.prototype.createPath=function(t){var e=this.attr(),n=e.x,r=e.y,i=e.r;t.beginPath(),t.arc(n,r,i,0,2*Math.PI,!1),t.closePath()},e}(tl);function nl(t,e,n,r){return t/(n*n)+e/(r*r)}const rl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{x:0,y:0,rx:0,ry:0})},e.prototype.isInStrokeOrPath=function(t,e,n,r,i){var o=this.attr(),a=i/2,s=o.x,u=o.y,l=o.rx,c=o.ry,h=(t-s)*(t-s),f=(e-u)*(e-u);return r&&n?nl(h,f,l+a,c+a)<=1:r?nl(h,f,l,c)<=1:!!n&&nl(h,f,l-a,c-a)>=1&&nl(h,f,l+a,c+a)<=1},e.prototype.createPath=function(t){var e=this.attr(),n=e.x,r=e.y,i=e.rx,o=e.ry;if(t.beginPath(),t.ellipse)t.ellipse(n,r,i,o,0,0,2*Math.PI,!1);else{var a=i>o?i:o,s=i>o?1:i/o,u=i>o?o/i:1;t.save(),t.translate(n,r),t.scale(s,u),t.arc(0,0,a,0,2*Math.PI),t.restore(),t.closePath()}},e}(tl);function il(t){return t instanceof HTMLElement&&(0,_.isString)(t.nodeName)&&"CANVAS"===t.nodeName.toUpperCase()}var ol=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{x:0,y:0,width:0,height:0})},e.prototype.initAttrs=function(t){this._setImage(t.img)},e.prototype.isStroke=function(){return!1},e.prototype.isOnlyHitBox=function(){return!0},e.prototype._afterLoading=function(){if(!0===this.get("toDraw")){var t=this.get("canvas");t?t.draw():this.createPath(this.get("context"))}},e.prototype._setImage=function(t){var e=this,n=this.attrs;if((0,_.isString)(t)){var r=new Image;r.onload=function(){if(e.destroyed)return!1;e.attr("img",r),e.set("loading",!1),e._afterLoading();var t=e.get("callback");t&&t.call(e)},r.crossOrigin="Anonymous",r.src=t,this.set("loading",!0)}else t instanceof Image?(n.width||(n.width=t.width),n.height||(n.height=t.height)):il(t)&&(n.width||(n.width=Number(t.getAttribute("width"))),n.height||(n.height,Number(t.getAttribute("height"))))},e.prototype.onAttrChange=function(e,n,r){t.prototype.onAttrChange.call(this,e,n,r),"img"===e&&this._setImage(n)},e.prototype.createPath=function(t){if(this.get("loading"))return this.set("toDraw",!0),void this.set("context",t);var e=this.attr(),n=e.x,r=e.y,i=e.width,o=e.height,a=e.sx,s=e.sy,u=e.swidth,l=e.sheight,c=e.img;(c instanceof Image||il(c))&&((0,_.isNil)(a)||(0,_.isNil)(s)||(0,_.isNil)(u)||(0,_.isNil)(l)?t.drawImage(c,n,r,i,o):t.drawImage(c,a,s,u,l,n,r,i,o))},e}(tl);const al=ol;function sl(t,e,n,r,i,o,a){var s=Math.min(t,n),u=Math.max(t,n),l=Math.min(e,r),c=Math.max(e,r),h=i/2;return o>=s-h&&o<=u+h&&a>=l-h&&a<=c+h&&Ro(t,e,n,r,o,a)<=i/2}var ul=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},e.prototype.initAttrs=function(t){this.setArrow()},e.prototype.onAttrChange=function(e,n,r){t.prototype.onAttrChange.call(this,e,n,r),this.setArrow()},e.prototype.setArrow=function(){var t=this.attr(),e=t.x1,n=t.y1,r=t.x2,i=t.y2,o=t.startArrow,a=t.endArrow;o&&Fu(this,t,r,i,e,n),a&&Zu(this,t,e,n,r,i)},e.prototype.isInStrokeOrPath=function(t,e,n,r,i){if(!n||!i)return!1;var o=this.attr();return sl(o.x1,o.y1,o.x2,o.y2,i,t,e)},e.prototype.createPath=function(t){var e=this.attr(),n=e.x1,r=e.y1,i=e.x2,o=e.y2,a=e.startArrow,s=e.endArrow,u={dx:0,dy:0},l={dx:0,dy:0};a&&a.d&&(u=zu(n,r,i,o,e.startArrow.d)),s&&s.d&&(l=zu(n,r,i,o,e.endArrow.d)),t.beginPath(),t.moveTo(n+u.dx,r+u.dy),t.lineTo(i-l.dx,o-l.dy)},e.prototype.afterDrawPath=function(t){var e=this.get("startArrowShape"),n=this.get("endArrowShape");e&&e.draw(t),n&&n.draw(t)},e.prototype.getTotalLength=function(){var t=this.attr(),e=t.x1,n=t.y1,r=t.x2,i=t.y2;return Io(e,n,r,i)},e.prototype.getPoint=function(t){var e=this.attr(),n=e.x1,r=e.y1,i=e.x2,o=e.y2;return Oo(n,r,i,o,t)},e}(tl);const ll=ul;var cl={circle:function(t,e,n){return[["M",t-n,e],["A",n,n,0,1,0,t+n,e],["A",n,n,0,1,0,t-n,e]]},square:function(t,e,n){return[["M",t-n,e-n],["L",t+n,e-n],["L",t+n,e+n],["L",t-n,e+n],["Z"]]},diamond:function(t,e,n){return[["M",t-n,e],["L",t,e-n],["L",t+n,e],["L",t,e+n],["Z"]]},triangle:function(t,e,n){var r=n*Math.sin(1/3*Math.PI);return[["M",t-n,e+r],["L",t,e-r],["L",t+n,e+r],["Z"]]},"triangle-down":function(t,e,n){var r=n*Math.sin(1/3*Math.PI);return[["M",t-n,e-r],["L",t+n,e-r],["L",t,e+r],["Z"]]}},hl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.initAttrs=function(t){this._resetParamsCache()},e.prototype._resetParamsCache=function(){this.set("paramsCache",{})},e.prototype.onAttrChange=function(e,n,r){t.prototype.onAttrChange.call(this,e,n,r),-1!==["symbol","x","y","r","radius"].indexOf(e)&&this._resetParamsCache()},e.prototype.isOnlyHitBox=function(){return!0},e.prototype._getR=function(t){return(0,_.isNil)(t.r)?t.radius:t.r},e.prototype._getPath=function(){var t,n,r=this.attr(),i=r.x,o=r.y,a=r.symbol||"circle",s=this._getR(r);if((0,_.isFunction)(a))n=ha(n=(t=a)(i,o,s));else{if(!(t=e.Symbols[a]))return console.warn(a+" marker is not supported."),null;n=t(i,o,s)}return n},e.prototype.createPath=function(t){qu(this,t,{path:this._getPath()},this.get("paramsCache"))},e.Symbols=cl,e}(tl);const fl=hl;function pl(t,e,n){var r=ta();return t.createPath(r),r.isPointInPath(e,n)}function dl(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function gl(t,e,n){return(n[0]-t[0])*(e[1]-t[1])==(e[0]-t[0])*(n[1]-t[1])&&Math.min(t[0],e[0])<=n[0]&&n[0]<=Math.max(t[0],e[0])&&Math.min(t[1],e[1])<=n[1]&&n[1]<=Math.max(t[1],e[1])}function vl(t,e,n){var r=!1,i=t.length;if(i<=2)return!1;for(var o=0;o<i;o++){var a=t[o],s=t[(o+1)%i];if(gl(a,s,[e,n]))return!0;dl(a[1]-n)>0!=dl(s[1]-n)>0&&dl(e-(n-a[1])*(a[0]-s[0])/(a[1]-s[1])-a[0])<0&&(r=!r)}return r}function ml(t,e,n,r,i,o,a,s){var u=(Math.atan2(s-e,a-t)+2*Math.PI)%(2*Math.PI);if(u<r||u>i)return!1;var l={x:t+n*Math.cos(u),y:e+n*Math.sin(u)};return yu(l.x,l.y,a,s)<=o/2}var yl=ut;const _l=(0,y.__assign)({hasArc:function(t){for(var e=!1,n=t.length,r=0;r<n;r++){var i=t[r][0];if("C"===i||"A"===i||"Q"===i){e=!0;break}}return e},extractPolygons:function(t){for(var e=t.length,n=[],r=[],i=[],o=0;o<e;o++){var a=t[o],s=a[0];"M"===s?(i.length&&(r.push(i),i=[]),i.push([a[1],a[2]])):"Z"===s?i.length&&(n.push(i),i=[]):i.push([a[1],a[2]])}return i.length>0&&r.push(i),{polygons:n,polylines:r}},isPointInStroke:function(t,e,n,r,i){for(var o=!1,a=e/2,s=0;s<t.length;s++){var u=t[s],l=u.currentPoint,c=u.params,h=u.prePoint,f=u.box;if(!f||_u(f.x-a,f.y-a,f.width+e,f.height+e,n,r)){switch(u.command){case"L":case"Z":o=sl(h[0],h[1],l[0],l[1],e,n,r);break;case"Q":o=Zo.pointDistance(h[0],h[1],c[1],c[2],c[3],c[4],n,r)<=e/2;break;case"C":o=Ho.pointDistance(h[0],h[1],c[1],c[2],c[3],c[4],c[5],c[6],n,r,i)<=e/2;break;case"A":var p=u.arcParams,d=p.cx,g=p.cy,v=p.rx,m=p.ry,y=p.startAngle,_=p.endAngle,b=p.xRotation,x=[n,r,1],w=v>m?v:m,E=yl(null,[["t",-d,-g],["r",-b],["s",1/(v>m?1:v/m),1/(v>m?m/v:1)]]);Pe.transformMat3(x,x,E),o=ml(0,0,w,y,_,e,x[0],x[1])}if(o)break}}return o}},s);function bl(t,e,n){for(var r=!1,i=0;i<t.length&&!(r=vl(t[i],e,n));i++);return r}var xl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{startArrow:!1,endArrow:!1})},e.prototype.initAttrs=function(t){this._setPathArr(t.path),this.setArrow()},e.prototype.onAttrChange=function(e,n,r){t.prototype.onAttrChange.call(this,e,n,r),"path"===e&&this._setPathArr(n),this.setArrow()},e.prototype._setPathArr=function(t){this.attrs.path=ha(t);var e=_l.hasArc(t);this.set("hasArc",e),this.set("paramsCache",{}),this.set("segments",null),this.set("curve",null),this.set("tCache",null),this.set("totalLength",null)},e.prototype.getSegments=function(){var t=this.get("segements");return t||(t=ya(this.attr("path")),this.set("segments",t)),t},e.prototype.setArrow=function(){var t,e=this.attr(),n=e.startArrow,r=e.endArrow;n&&Fu(this,e,(t=this.getStartTangent())[0][0],t[0][1],t[1][0],t[1][1]),r&&Zu(this,e,(t=this.getEndTangent())[0][0],t[0][1],t[1][0],t[1][1])},e.prototype.isInStrokeOrPath=function(t,e,n,r,i){var o=this.getSegments(),a=this.get("hasArc"),s=!1;if(n){var u=this.getTotalLength();s=_l.isPointInStroke(o,i,t,e,u)}if(!s&&r)if(a)s=pl(this,t,e);else{var l=this.attr("path"),c=_l.extractPolygons(l);s=bl(c.polygons,t,e)||bl(c.polylines,t,e)}return s},e.prototype.createPath=function(t){qu(this,t,this.attr(),this.get("paramsCache"))},e.prototype.afterDrawPath=function(t){var e=this.get("startArrowShape"),n=this.get("endArrowShape");e&&e.draw(t),n&&n.draw(t)},e.prototype.getTotalLength=function(){var t=this.get("totalLength");return(0,_.isNil)(t)?(this._calculateCurve(),this._setTcache(),this.get("totalLength")):t},e.prototype.getPoint=function(t){var e,n,r=this.get("tCache");r||(this._calculateCurve(),this._setTcache(),r=this.get("tCache"));var i=this.get("curve");if(!r||0===r.length)return i?{x:i[0][1],y:i[0][2]}:null;(0,_.each)(r,(function(r,i){t>=r[0]&&t<=r[1]&&(e=(t-r[0])/(r[1]-r[0]),n=i)}));var o=i[n];if((0,_.isNil)(o)||(0,_.isNil)(n))return null;var a=o.length,s=i[n+1];return Ho.pointAt(o[a-2],o[a-1],s[1],s[2],s[3],s[4],s[5],s[6],e)},e.prototype._calculateCurve=function(){var t=this.attr().path;this.set("curve",_l.pathToCurve(t))},e.prototype._setTcache=function(){var t,e,n,r,i=0,o=0,a=[],s=this.get("curve");s&&((0,_.each)(s,(function(t,e){n=s[e+1],r=t.length,n&&(i+=Ho.length(t[r-2],t[r-1],n[1],n[2],n[3],n[4],n[5],n[6])||0)})),this.set("totalLength",i),0!==i?((0,_.each)(s,(function(u,l){n=s[l+1],r=u.length,n&&((t=[])[0]=o/i,e=Ho.length(u[r-2],u[r-1],n[1],n[2],n[3],n[4],n[5],n[6]),o+=e||0,t[1]=o/i,a.push(t))})),this.set("tCache",a)):this.set("tCache",[]))},e.prototype.getStartTangent=function(){var t,e=this.getSegments();if(e.length>1){var n=e[0].currentPoint,r=e[1].currentPoint,i=e[1].startTangent;t=[],i?(t.push([n[0]-i[0],n[1]-i[1]]),t.push([n[0],n[1]])):(t.push([r[0],r[1]]),t.push([n[0],n[1]]))}return t},e.prototype.getEndTangent=function(){var t,e=this.getSegments(),n=e.length;if(n>1){var r=e[n-2].currentPoint,i=e[n-1].currentPoint,o=e[n-1].endTangent;t=[],o?(t.push([i[0]-o[0],i[1]-o[1]]),t.push([i[0],i[1]])):(t.push([r[0],r[1]]),t.push([i[0],i[1]]))}return t},e}(tl);const wl=xl;function El(t,e,n,r,i){var o=t.length;if(o<2)return!1;for(var a=0;a<o-1;a++)if(sl(t[a][0],t[a][1],t[a+1][0],t[a+1][1],e,n,r))return!0;if(i){var s=t[0],u=t[o-1];if(sl(s[0],s[1],u[0],u[1],e,n,r))return!0}return!1}const Sl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.isInStrokeOrPath=function(t,e,n,r,i){var o=this.attr().points,a=!1;return n&&(a=El(o,i,t,e,!0)),!a&&r&&(a=vl(o,t,e)),a},e.prototype.createPath=function(t){var e=this.attr().points;if(!(e.length<2)){t.beginPath();for(var n=0;n<e.length;n++){var r=e[n];0===n?t.moveTo(r[0],r[1]):t.lineTo(r[0],r[1])}t.closePath()}},e}(tl);var Cl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{startArrow:!1,endArrow:!1})},e.prototype.initAttrs=function(t){this.setArrow()},e.prototype.onAttrChange=function(e,n,r){t.prototype.onAttrChange.call(this,e,n,r),this.setArrow(),-1!==["points"].indexOf(e)&&this._resetCache()},e.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},e.prototype.setArrow=function(){var t=this.attr(),e=this.attrs,n=e.points,r=e.startArrow,i=e.endArrow,o=n.length,a=n[0][0],s=n[0][1],u=n[o-1][0],l=n[o-1][1];r&&Fu(this,t,n[1][0],n[1][1],a,s),i&&Zu(this,t,n[o-2][0],n[o-2][1],u,l)},e.prototype.isFill=function(){return!1},e.prototype.isInStrokeOrPath=function(t,e,n,r,i){return!(!n||!i)&&El(this.attr().points,i,t,e,!1)},e.prototype.isStroke=function(){return!0},e.prototype.createPath=function(t){var e=this.attr(),n=e.points,r=e.startArrow,i=e.endArrow,o=n.length;if(!(n.length<2)){var a,s=n[0][0],u=n[0][1],l=n[o-1][0],c=n[o-1][1];r&&r.d&&(s+=(a=zu(s,u,n[1][0],n[1][1],r.d)).dx,u+=a.dy),i&&i.d&&(l-=(a=zu(n[o-2][0],n[o-2][1],l,c,i.d)).dx,c-=a.dy),t.beginPath(),t.moveTo(s,u);for(var h=0;h<o-1;h++){var f=n[h];t.lineTo(f[0],f[1])}t.lineTo(l,c)}},e.prototype.afterDrawPath=function(t){var e=this.get("startArrowShape"),n=this.get("endArrowShape");e&&e.draw(t),n&&n.draw(t)},e.prototype.getTotalLength=function(){var t=this.attr().points,e=this.get("totalLength");return(0,_.isNil)(e)?(this.set("totalLength",Ko(t)),this.get("totalLength")):e},e.prototype.getPoint=function(t){var e,n,r=this.attr().points,i=this.get("tCache");return i||(this._setTcache(),i=this.get("tCache")),(0,_.each)(i,(function(r,i){t>=r[0]&&t<=r[1]&&(e=(t-r[0])/(r[1]-r[0]),n=i)})),Oo(r[n][0],r[n][1],r[n+1][0],r[n+1][1],e)},e.prototype._setTcache=function(){var t=this.attr().points;if(t&&0!==t.length){var e=this.getTotalLength();if(!(e<=0)){var n,r,i=0,o=[];(0,_.each)(t,(function(a,s){t[s+1]&&((n=[])[0]=i/e,r=Io(a[0],a[1],t[s+1][0],t[s+1][1]),i+=r,n[1]=i/e,o.push(n))})),this.set("tCache",o)}}},e.prototype.getStartTangent=function(){var t=this.attr().points,e=[];return e.push([t[1][0],t[1][1]]),e.push([t[0][0],t[0][1]]),e},e.prototype.getEndTangent=function(){var t=this.attr().points,e=t.length-1,n=[];return n.push([t[e-1][0],t[e-1][1]]),n.push([t[e][0],t[e][1]]),n},e}(tl);const Al=Cl;var Tl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{x:0,y:0,width:0,height:0,radius:0})},e.prototype.isInStrokeOrPath=function(t,e,n,r,i){var o=this.attr(),a=o.x,s=o.y,u=o.width,l=o.height,c=o.radius;if(c){var h=!1;return n&&(h=function(t,e,n,r,i,o,a,s){return sl(t+i,e,t+n-i,e,o,a,s)||sl(t+n,e+i,t+n,e+r-i,o,a,s)||sl(t+n-i,e+r,t+i,e+r,o,a,s)||sl(t,e+r-i,t,e+i,o,a,s)||ml(t+n-i,e+i,i,1.5*Math.PI,2*Math.PI,o,a,s)||ml(t+n-i,e+r-i,i,0,.5*Math.PI,o,a,s)||ml(t+i,e+r-i,i,.5*Math.PI,Math.PI,o,a,s)||ml(t+i,e+i,i,Math.PI,1.5*Math.PI,o,a,s)}(a,s,u,l,c,i,t,e)),!h&&r&&(h=pl(this,t,e)),h}var f=i/2;return r&&n?_u(a-f,s-f,u+f,l+f,t,e):r?_u(a,s,u,l,t,e):n?function(t,e,n,r,i,o,a){var s=i/2;return _u(t-s,e-s,n,i,o,a)||_u(t+n-s,e-s,i,r,o,a)||_u(t+s,e+r-s,n,i,o,a)||_u(t-s,e+s,i,r,o,a)}(a,s,u,l,i,t,e):void 0},e.prototype.createPath=function(t){var e=this.attr(),n=e.x,r=e.y,i=e.width,o=e.height,a=e.radius;if(t.beginPath(),0===a)t.rect(n,r,i,o);else{var s=function(t){var e=0,n=0,r=0,i=0;return(0,_.isArray)(t)?1===t.length?e=n=r=i=t[0]:2===t.length?(e=r=t[0],n=i=t[1]):3===t.length?(e=t[0],n=i=t[1],r=t[2]):(e=t[0],n=t[1],r=t[2],i=t[3]):e=n=r=i=t,[e,n,r,i]}(a),u=s[0],l=s[1],c=s[2],h=s[3];t.moveTo(n+u,r),t.lineTo(n+i-l,r),0!==l&&t.arc(n+i-l,r+l,l,-Math.PI/2,0),t.lineTo(n+i,r+o-c),0!==c&&t.arc(n+i-c,r+o-c,c,0,Math.PI/2),t.lineTo(n+h,r+o),0!==h&&t.arc(n+h,r+o-h,h,Math.PI/2,Math.PI),t.lineTo(n,r+u),0!==u&&t.arc(n+u,r+u,u,Math.PI,1.5*Math.PI),t.closePath()}},e}(tl);const kl=Tl;var Ml=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},e.prototype.isOnlyHitBox=function(){return!0},e.prototype.initAttrs=function(t){this._assembleFont(),t.text&&this._setText(t.text)},e.prototype._assembleFont=function(){var t=this.attrs;t.font=na(t)},e.prototype._setText=function(t){var e=null;(0,_.isString)(t)&&-1!==t.indexOf("\n")&&(e=t.split("\n")),this.set("textArr",e)},e.prototype.onAttrChange=function(e,n,r){t.prototype.onAttrChange.call(this,e,n,r),e.startsWith("font")&&this._assembleFont(),"text"===e&&this._setText(n)},e.prototype._getSpaceingY=function(){var t=this.attrs,e=t.lineHeight,n=1*t.fontSize;return e?e-n:.14*n},e.prototype._drawTextArr=function(t,e,n){var r,i=this.attrs,o=i.textBaseline,a=i.x,s=i.y,u=1*i.fontSize,l=this._getSpaceingY(),c=ea(i.text,i.fontSize,i.lineHeight);(0,_.each)(e,(function(e,i){r=s+i*(l+u)-c+u,"middle"===o&&(r+=c-u-(c-u)/2),"top"===o&&(r+=c-u),(0,_.isNil)(e)||(n?t.fillText(e,a,r):t.strokeText(e,a,r))}))},e.prototype._drawText=function(t,e){var n=this.attr(),r=n.x,i=n.y,o=this.get("textArr");if(o)this._drawTextArr(t,o,e);else{var a=n.text;(0,_.isNil)(a)||(e?t.fillText(a,r,i):t.strokeText(a,r,i))}},e.prototype.strokeAndFill=function(t){var e=this.attrs,n=e.lineWidth,r=e.opacity,i=e.strokeOpacity,o=e.fillOpacity;this.isStroke()&&n>0&&((0,_.isNil)(i)||1===i||(t.globalAlpha=r),this.stroke(t)),this.isFill()&&((0,_.isNil)(o)||1===o?this.fill(t):(t.globalAlpha=o,this.fill(t),t.globalAlpha=r)),this.afterDrawPath(t)},e.prototype.fill=function(t){this._drawText(t,!0)},e.prototype.stroke=function(t){this._drawText(t,!1)},e}(tl);const Pl=Ml;function Il(t,e,n){var r,i,o=t.getTotalMatrix();if(o){var a=(r=[e,n,1],(i=o)?Ur(Gr(i),r):r);return[a[0],a[1]]}return[e,n]}function Ol(t,e,n){if(t.isCanvas&&t.isCanvas())return!0;if(!kr(t)||!1===t.cfg.isInView)return!1;if(t.cfg.clipShape){var r=Il(t,e,n),i=r[0],o=r[1];if(t.isClipped(i,o))return!1}var a=t.cfg.cacheCanvasBBox||t.getCanvasBBox();return e>=a.minX&&e<=a.maxX&&n>=a.minY&&n<=a.maxY}function Rl(t,e,n){if(!Ol(t,e,n))return null;for(var r=null,i=t.getChildren(),o=i.length-1;o>=0;o--){var a=i[o];if(a.isGroup())r=Rl(a,e,n);else if(Ol(a,e,n)){var s=a,u=Il(a,e,n),l=u[0],c=u[1];s.isInShape(l,c)&&(r=a)}if(r)break}return r}var Ll=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.getDefaultCfg=function(){var e=t.prototype.getDefaultCfg.call(this);return e.renderer="canvas",e.autoDraw=!0,e.localRefresh=!0,e.refreshElements=[],e.clipView=!0,e.quickHit=!1,e},e.prototype.onCanvasChange=function(t){"attr"!==t&&"sort"!==t&&"changeSize"!==t||(this.set("refreshElements",[this]),this.draw())},e.prototype.getShapeBase=function(){return f},e.prototype.getGroupBase=function(){return Ju},e.prototype.getPixelRatio=function(){var t=this.get("pixelRatio")||(window?window.devicePixelRatio:1);return t>=1?Math.ceil(t):1},e.prototype.getViewRange=function(){return{minX:0,minY:0,maxX:this.cfg.width,maxY:this.cfg.height}},e.prototype.createDom=function(){var t=document.createElement("canvas"),e=t.getContext("2d");return this.set("context",e),t},e.prototype.setDOMSize=function(e,n){t.prototype.setDOMSize.call(this,e,n);var r=this.get("context"),i=this.get("el"),o=this.getPixelRatio();i.width=o*e,i.height=o*n,o>1&&r.scale(o,o)},e.prototype.clear=function(){t.prototype.clear.call(this),this._clearFrame();var e=this.get("context"),n=this.get("el");e.clearRect(0,0,n.width,n.height)},e.prototype.getShape=function(e,n){return this.get("quickHit")?Rl(this,e,n):t.prototype.getShape.call(this,e,n,null)},e.prototype._getRefreshRegion=function(){var t,e=this.get("refreshElements"),n=this.getViewRange();return e.length&&e[0]===this?t=n:(t=function(t){if(!t.length)return null;var e=[],n=[],r=[],i=[];return(0,_.each)(t,(function(t){var o=function(t){var e,n,r;if(t.destroyed)e=t._cacheCanvasBBox;else{var i=t.get("cacheCanvasBBox"),o=i&&!(!i.width||!i.height),a=t.getCanvasBBox(),s=a&&!(!a.width||!a.height);o&&s?(r=a,e=(n=i)&&r?{minX:Math.min(n.minX,r.minX),minY:Math.min(n.minY,r.minY),maxX:Math.max(n.maxX,r.maxX),maxY:Math.max(n.maxY,r.maxY)}:n||r):o?e=i:s&&(e=a)}return e}(t);o&&(e.push(o.minX),n.push(o.minY),r.push(o.maxX),i.push(o.maxY))})),{minX:(0,_.min)(e),minY:(0,_.min)(n),maxX:(0,_.max)(r),maxY:(0,_.max)(i)}}(e),t&&(t.minX=Math.floor(t.minX),t.minY=Math.floor(t.minY),t.maxX=Math.ceil(t.maxX),t.maxY=Math.ceil(t.maxY),t.maxY+=1,this.get("clipView")&&(t=function(t,e){return t&&e&&bu(t,e)?{minX:Math.max(t.minX,e.minX),minY:Math.max(t.minY,e.minY),maxX:Math.min(t.maxX,e.maxX),maxY:Math.min(t.maxY,e.maxY)}:null}(t,n)))),t},e.prototype.refreshElement=function(t){this.get("refreshElements").push(t)},e.prototype._clearFrame=function(){var t=this.get("drawFrame");t&&((0,_.clearAnimationFrame)(t),this.set("drawFrame",null),this.set("refreshElements",[]))},e.prototype.draw=function(){var t=this.get("drawFrame");this.get("autoDraw")&&t||this._startDraw()},e.prototype._drawAll=function(){var t=this.get("context"),e=this.get("el"),n=this.getChildren();t.clearRect(0,0,e.width,e.height),Uu(t,this),Gu(t,n),this.set("refreshElements",[])},e.prototype._drawRegion=function(){var t=this.get("context"),e=this.get("refreshElements"),n=this.getChildren(),r=this._getRefreshRegion();r?(t.clearRect(r.minX,r.minY,r.maxX-r.minX,r.maxY-r.minY),t.save(),t.beginPath(),t.rect(r.minX,r.minY,r.maxX-r.minX,r.maxY-r.minY),t.clip(),Uu(t,this),Vu(this,n,r),Gu(t,n,r),t.restore()):e.length&&Hu(e),(0,_.each)(e,(function(t){t.get("hasChanged")&&t.set("hasChanged",!1)})),this.set("refreshElements",[])},e.prototype._startDraw=function(){var t=this,e=this.get("drawFrame");e||(e=(0,_.requestAnimationFrame)((function(){t.get("localRefresh")?t._drawRegion():t._drawAll(),t.set("drawFrame",null)})),this.set("drawFrame",e))},e.prototype.skipDraw=function(){},e.prototype.removeDom=function(){var t=this.get("el");t.width=0,t.height=0,t.parentNode.removeChild(t)},e}(vo);const Dl=Ll;var Nl={rect:"path",circle:"circle",line:"line",path:"path",marker:"path",text:"text",polyline:"polyline",polygon:"polygon",image:"image",ellipse:"ellipse",dom:"foreignObject"},Bl={opacity:"opacity",fillStyle:"fill",fill:"fill",fillOpacity:"fill-opacity",strokeStyle:"stroke",strokeOpacity:"stroke-opacity",stroke:"stroke",x:"x",y:"y",r:"r",rx:"rx",ry:"ry",width:"width",height:"height",x1:"x1",x2:"x2",y1:"y1",y2:"y2",lineCap:"stroke-linecap",lineJoin:"stroke-linejoin",lineWidth:"stroke-width",lineDash:"stroke-dasharray",lineDashOffset:"stroke-dashoffset",miterLimit:"stroke-miterlimit",font:"font",fontSize:"font-size",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",fontFamily:"font-family",startArrow:"marker-start",endArrow:"marker-end",path:"d",class:"class",id:"id",style:"style",preserveAspectRatio:"preserveAspectRatio"};function zl(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Fl(t){var e=Nl[t.type],n=t.getParent();if(!e)throw new Error("the type "+t.type+" is not supported by svg");var r=zl(e);if(t.get("id")&&(r.id=t.get("id")),t.set("el",r),t.set("attrs",{}),n){var i=n.get("el");i||(i=n.createDom(),n.set("el",i)),i.appendChild(r)}return r}function Zl(t,e){var n=t.get("el"),r=(0,_.toArray)(n.children).sort(e),i=document.createDocumentFragment();r.forEach((function(t){i.appendChild(t)})),n.appendChild(i)}function jl(t){var e=t.attr().matrix;if(e){for(var n=t.cfg.el,r=[],i=0;i<9;i+=3)r.push(e[i]+","+e[i+1]);-1===(r=r.join(",")).indexOf("NaN")?n.setAttribute("transform","matrix("+r+")"):console.warn("invalid matrix:",e)}}function Ul(t,e){var n=t.getClip(),r=t.get("el");if(n){if(n&&!r.hasAttribute("clip-path")){Fl(n),n.createPath(e);var i=e.addClip(n);r.setAttribute("clip-path","url(#"+i+")")}}else r.removeAttribute("clip-path")}function Gl(t,e){e.forEach((function(e){e.draw(t)}))}function Vl(t,e){var n=t.get("canvas");if(n&&n.get("autoDraw")){var r=n.get("context"),i=t.getParent(),o=i?i.getChildren():[n],a=t.get("el");if("remove"===e)if(t.get("isClipShape")){var s=a&&a.parentNode,u=s&&s.parentNode;s&&u&&u.removeChild(s)}else a&&a.parentNode&&a.parentNode.removeChild(a);else if("show"===e)a.setAttribute("visibility","visible");else if("hide"===e)a.setAttribute("visibility","hidden");else if("zIndex"===e)!function(t,e){var n=t.parentNode,r=Array.from(n.childNodes).filter((function(t){return 1===t.nodeType&&"defs"!==t.nodeName.toLowerCase()})),i=r[e],o=r.indexOf(t);if(i){if(o>e)n.insertBefore(t,i);else if(o<e){var a=r[e+1];a?n.insertBefore(t,a):n.appendChild(t)}}else n.appendChild(t)}(a,o.indexOf(t));else if("sort"===e){var l=t.get("children");l&&l.length&&Zl(t,(function(t,e){return l.indexOf(t)-l.indexOf(e)?1:0}))}else"clear"===e?a&&(a.innerHTML=""):"matrix"===e?jl(t):"clip"===e?Ul(t,r):"attr"===e||"add"===e&&t.draw(r)}}var Wl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,y.__extends)(e,t),e.prototype.isEntityGroup=function(){return!0},e.prototype.createDom=function(){var t=zl("g");this.set("el",t);var e=this.getParent();if(e){var n=e.get("el");n||(n=e.createDom(),e.set("el",n)),n.appendChild(t)}return t},e.prototype.afterAttrsChange=function(e){t.prototype.afterAttrsChange.call(this,e);var n=this.get("canvas");if(n&&n.get("autoDraw")){var r=n.get("context");this.createPath(r,e)}},e.prototype.onCanvasChange=function(t){Vl(this,t)},e.prototype.getShapeBase=function(){return p},e.prototype.getGroupBase=function(){return e},e.prototype.draw=function(t){var e=this.getChildren(),n=this.get("el");this.get("destroyed")?n&&n.parentNode.removeChild(n):(n||this.createDom(),Ul(this,t),this.createPath(t),e.length&&Gl(t,e))},e.prototype.createPath=function(t,e){var n=this.attr(),r=this.get("el");(0,_.each)(e||n,(function(t,e){Bl[e]&&r.setAttribute(Bl[e],t)})),jl(this)},e}(yo);const Hl=Wl;var Xl=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="svg",e.canFill=!1,e.canStroke=!1,e}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},e.prototype.afterAttrsChange=function(e){t.prototype.afterAttrsChange.call(this,e);var n=this.get("canvas");if(n&&n.get("autoDraw")){var r=n.get("context");this.draw(r,e)}},e.prototype.getShapeBase=function(){return p},e.prototype.getGroupBase=function(){return Hl},e.prototype.onCanvasChange=function(t){Vl(this,t)},e.prototype.calculateBBox=function(){var t=this.get("el"),e=null;if(t)e=t.getBBox();else{var n=wo(this.get("type"));n&&(e=n(this))}if(e){var r=e.x,i=e.y,o=e.width,a=e.height,s=this.getHitLineWidth(),u=s/2,l=r-u,c=i-u;return{x:l,y:c,minX:l,minY:c,maxX:r+o+u,maxY:i+a+u,width:o+s,height:a+s}}return{x:0,y:0,minX:0,minY:0,maxX:0,maxY:0,width:0,height:0}},e.prototype.isFill=function(){var t=this.attr(),e=t.fill,n=t.fillStyle;return(e||n||this.isClipShape())&&this.canFill},e.prototype.isStroke=function(){var t=this.attr(),e=t.stroke,n=t.strokeStyle;return(e||n)&&this.canStroke},e.prototype.draw=function(t,e){var n=this.get("el");this.get("destroyed")?n&&n.parentNode.removeChild(n):(n||Fl(this),Ul(this,t),this.createPath(t,e),this.shadow(t,e),this.strokeAndFill(t,e),this.transform(e))},e.prototype.createPath=function(t,e){},e.prototype.strokeAndFill=function(t,e){var n=e||this.attr(),r=n.fill,i=n.fillStyle,o=n.stroke,a=n.strokeStyle,s=n.fillOpacity,u=n.strokeOpacity,l=n.lineWidth,c=this.get("el");this.canFill&&(e?"fill"in n?this._setColor(t,"fill",r):"fillStyle"in n&&this._setColor(t,"fill",i):this._setColor(t,"fill",r||i),s&&c.setAttribute(Bl.fillOpacity,s)),this.canStroke&&l>0&&(e?"stroke"in n?this._setColor(t,"stroke",o):"strokeStyle"in n&&this._setColor(t,"stroke",a):this._setColor(t,"stroke",o||a),u&&c.setAttribute(Bl.strokeOpacity,u),l&&c.setAttribute(Bl.lineWidth,l))},e.prototype._setColor=function(t,e,n){var r=this.get("el");if(n)if(n=n.trim(),/^[r,R,L,l]{1}[\s]*\(/.test(n))(i=t.find("gradient",n))||(i=t.addGradient(n)),r.setAttribute(Bl[e],"url(#"+i+")");else if(/^[p,P]{1}[\s]*\(/.test(n)){var i;(i=t.find("pattern",n))||(i=t.addPattern(n)),r.setAttribute(Bl[e],"url(#"+i+")")}else r.setAttribute(Bl[e],n);else r.setAttribute(Bl[e],"none")},e.prototype.shadow=function(t,e){var n=this.attr(),r=e||n,i=r.shadowOffsetX,o=r.shadowOffsetY,a=r.shadowBlur,s=r.shadowColor;(i||o||a||s)&&function(t,e){var n=t.cfg.el,r=t.attr(),i={dx:r.shadowOffsetX,dy:r.shadowOffsetY,blur:r.shadowBlur,color:r.shadowColor};if(i.dx||i.dy||i.blur||i.color){var o=e.find("filter",i);o||(o=e.addShadow(i)),n.setAttribute("filter","url(#"+o+")")}else n.removeAttribute("filter")}(this,t)},e.prototype.transform=function(t){var e=this.attr();(t||e).matrix&&jl(this)},e.prototype.isInShape=function(t,e){return this.isPointInPath(t,e)},e.prototype.isPointInPath=function(t,e){var n=this.get("el"),r=this.get("canvas").get("el").getBoundingClientRect(),i=t+r.left,o=e+r.top,a=document.elementFromPoint(i,o);return!(!a||!a.isEqualNode(n))},e.prototype.getHitLineWidth=function(){var t=this.attrs,e=t.lineWidth,n=t.lineAppendWidth;return this.isStroke()?e+n:0},e}(_o);const Yl=Xl;var ql=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="circle",e.canFill=!0,e.canStroke=!0,e}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{x:0,y:0,r:0})},e.prototype.createPath=function(t,e){var n=this.attr(),r=this.get("el");(0,_.each)(e||n,(function(t,e){"x"===e||"y"===e?r.setAttribute("c"+e,t):Bl[e]&&r.setAttribute(Bl[e],t)}))},e}(Yl);const Kl=ql;var Ql=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="dom",e.canFill=!1,e.canStroke=!1,e}return(0,y.__extends)(e,t),e.prototype.createPath=function(t,e){var n=this.attr(),r=this.get("el");if((0,_.each)(e||n,(function(t,e){Bl[e]&&r.setAttribute(Bl[e],t)})),"function"==typeof n.html){var i=n.html.call(this,n);if(i instanceof Element||i instanceof HTMLDocument){for(var o=r.childNodes,a=o.length-1;a>=0;a--)r.removeChild(o[a]);r.appendChild(i)}else r.innerHTML=i}else r.innerHTML=n.html},e}(Yl);const Jl=Ql;var $l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="ellipse",e.canFill=!0,e.canStroke=!0,e}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{x:0,y:0,rx:0,ry:0})},e.prototype.createPath=function(t,e){var n=this.attr(),r=this.get("el");(0,_.each)(e||n,(function(t,e){"x"===e||"y"===e?r.setAttribute("c"+e,t):Bl[e]&&r.setAttribute(Bl[e],t)}))},e}(Yl);const tc=$l;var ec=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="image",e.canFill=!1,e.canStroke=!1,e}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{x:0,y:0,width:0,height:0})},e.prototype.createPath=function(t,e){var n=this,r=this.attr(),i=this.get("el");(0,_.each)(e||r,(function(t,e){"img"===e?n._setImage(r.img):Bl[e]&&i.setAttribute(Bl[e],t)}))},e.prototype.setAttr=function(t,e){this.attrs[t]=e,"img"===t&&this._setImage(e)},e.prototype._setImage=function(t){var e=this.attr(),n=this.get("el");if((0,_.isString)(t))n.setAttribute("href",t);else if(t instanceof window.Image)e.width||(n.setAttribute("width",t.width),this.attr("width",t.width)),e.height||(n.setAttribute("height",t.height),this.attr("height",t.height)),n.setAttribute("href",t.src);else if(t instanceof HTMLElement&&(0,_.isString)(t.nodeName)&&"CANVAS"===t.nodeName.toUpperCase())n.setAttribute("href",t.toDataURL());else if(t instanceof ImageData){var r=document.createElement("canvas");r.setAttribute("width",""+t.width),r.setAttribute("height",""+t.height),r.getContext("2d").putImageData(t,0,0),e.width||(n.setAttribute("width",""+t.width),this.attr("width",t.width)),e.height||(n.setAttribute("height",""+t.height),this.attr("height",t.height)),n.setAttribute("href",r.toDataURL())}},e}(Yl);const nc=ec;var rc=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="line",e.canFill=!1,e.canStroke=!0,e}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},e.prototype.createPath=function(t,e){var n=this.attr(),r=this.get("el");(0,_.each)(e||n,(function(e,i){if("startArrow"===i||"endArrow"===i)if(e){var o=(0,_.isObject)(e)?t.addArrow(n,Bl[i]):t.getDefaultArrow(n,Bl[i]);r.setAttribute(Bl[i],"url(#"+o+")")}else r.removeAttribute(Bl[i]);else Bl[i]&&r.setAttribute(Bl[i],e)}))},e.prototype.getTotalLength=function(){var t=this.attr(),e=t.x1,n=t.y1,r=t.x2,i=t.y2;return Io(e,n,r,i)},e.prototype.getPoint=function(t){var e=this.attr(),n=e.x1,r=e.y1,i=e.x2,o=e.y2;return Oo(n,r,i,o,t)},e}(Yl);const ic=rc;var oc={circle:function(t,e,n){return[["M",t,e],["m",-n,0],["a",n,n,0,1,0,2*n,0],["a",n,n,0,1,0,2*-n,0]]},square:function(t,e,n){return[["M",t-n,e-n],["L",t+n,e-n],["L",t+n,e+n],["L",t-n,e+n],["Z"]]},diamond:function(t,e,n){return[["M",t-n,e],["L",t,e-n],["L",t+n,e],["L",t,e+n],["Z"]]},triangle:function(t,e,n){var r=n*Math.sin(1/3*Math.PI);return[["M",t-n,e+r],["L",t,e-r],["L",t+n,e+r],["z"]]},triangleDown:function(t,e,n){var r=n*Math.sin(1/3*Math.PI);return[["M",t-n,e-r],["L",t+n,e-r],["L",t,e+r],["Z"]]}};const ac={get:function(t){return oc[t]},register:function(t,e){oc[t]=e},remove:function(t){delete oc[t]},getAll:function(){return oc}};var sc=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="marker",e.canFill=!0,e.canStroke=!0,e}return(0,y.__extends)(e,t),e.prototype.createPath=function(t){this.get("el").setAttribute("d",this._assembleMarker())},e.prototype._assembleMarker=function(){var t=this._getPath();return(0,_.isArray)(t)?t.map((function(t){return t.join(" ")})).join(""):t},e.prototype._getPath=function(){var t,e=this.attr(),n=e.x,r=e.y,i=e.r||e.radius,o=e.symbol||"circle";return(t=(0,_.isFunction)(o)?o:ac.get(o))?t(n,r,i):(console.warn(t+" symbol is not exist."),null)},e.symbolsFactory=ac,e}(Yl);const uc=sc;var lc=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="path",e.canFill=!0,e.canStroke=!0,e}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{startArrow:!1,endArrow:!1})},e.prototype.createPath=function(t,e){var n=this,r=this.attr(),i=this.get("el");(0,_.each)(e||r,(function(e,o){if("path"===o&&(0,_.isArray)(e))i.setAttribute("d",n._formatPath(e));else if("startArrow"===o||"endArrow"===o)if(e){var a=(0,_.isObject)(e)?t.addArrow(r,Bl[o]):t.getDefaultArrow(r,Bl[o]);i.setAttribute(Bl[o],"url(#"+a+")")}else i.removeAttribute(Bl[o]);else Bl[o]&&i.setAttribute(Bl[o],e)}))},e.prototype._formatPath=function(t){var e=t.map((function(t){return t.join(" ")})).join("");return~e.indexOf("NaN")?"":e},e.prototype.getTotalLength=function(){var t=this.get("el");return t?t.getTotalLength():null},e.prototype.getPoint=function(t){var e=this.get("el"),n=this.getTotalLength();if(0===n)return null;var r=e?e.getPointAtLength(t*n):null;return r?{x:r.x,y:r.y}:null},e}(Yl);const cc=lc;var hc=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="polygon",e.canFill=!0,e.canStroke=!0,e}return(0,y.__extends)(e,t),e.prototype.createPath=function(t,e){var n=this.attr(),r=this.get("el");(0,_.each)(e||n,(function(t,e){"points"===e&&(0,_.isArray)(t)&&t.length>=2?r.setAttribute("points",t.map((function(t){return t[0]+","+t[1]})).join(" ")):Bl[e]&&r.setAttribute(Bl[e],t)}))},e}(Yl);const fc=hc;var pc=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="polyline",e.canFill=!0,e.canStroke=!0,e}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{startArrow:!1,endArrow:!1})},e.prototype.onAttrChange=function(e,n,r){t.prototype.onAttrChange.call(this,e,n,r),-1!==["points"].indexOf(e)&&this._resetCache()},e.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},e.prototype.createPath=function(t,e){var n=this.attr(),r=this.get("el");(0,_.each)(e||n,(function(t,e){"points"===e&&(0,_.isArray)(t)&&t.length>=2?r.setAttribute("points",t.map((function(t){return t[0]+","+t[1]})).join(" ")):Bl[e]&&r.setAttribute(Bl[e],t)}))},e.prototype.getTotalLength=function(){var t=this.attr().points,e=this.get("totalLength");return(0,_.isNil)(e)?(this.set("totalLength",Ko(t)),this.get("totalLength")):e},e.prototype.getPoint=function(t){var e,n,r=this.attr().points,i=this.get("tCache");return i||(this._setTcache(),i=this.get("tCache")),(0,_.each)(i,(function(r,i){t>=r[0]&&t<=r[1]&&(e=(t-r[0])/(r[1]-r[0]),n=i)})),Oo(r[n][0],r[n][1],r[n+1][0],r[n+1][1],e)},e.prototype._setTcache=function(){var t=this.attr().points;if(t&&0!==t.length){var e=this.getTotalLength();if(!(e<=0)){var n,r,i=0,o=[];(0,_.each)(t,(function(a,s){t[s+1]&&((n=[])[0]=i/e,r=Io(a[0],a[1],t[s+1][0],t[s+1][1]),i+=r,n[1]=i/e,o.push(n))})),this.set("tCache",o)}}},e.prototype.getStartTangent=function(){var t=this.attr().points,e=[];return e.push([t[1][0],t[1][1]]),e.push([t[0][0],t[0][1]]),e},e.prototype.getEndTangent=function(){var t=this.attr().points,e=t.length-1,n=[];return n.push([t[e-1][0],t[e-1][1]]),n.push([t[e][0],t[e][1]]),n},e}(Yl);const dc=pc;var gc=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="rect",e.canFill=!0,e.canStroke=!0,e}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{x:0,y:0,width:0,height:0,radius:0})},e.prototype.createPath=function(t,e){var n=this,r=this.attr(),i=this.get("el"),o=!1,a=["x","y","width","height","radius"];(0,_.each)(e||r,(function(t,e){-1===a.indexOf(e)||o?-1===a.indexOf(e)&&Bl[e]&&i.setAttribute(Bl[e],t):(i.setAttribute("d",n._assembleRect(r)),o=!0)}))},e.prototype._assembleRect=function(t){var e=t.x,n=t.y,r=t.width,i=t.height,o=t.radius;if(!o)return"M "+e+","+n+" l "+r+",0 l 0,"+i+" l"+-r+" 0 z";var a=function(t){var e=0,n=0,r=0,i=0;return(0,_.isArray)(t)?1===t.length?e=n=r=i=t[0]:2===t.length?(e=r=t[0],n=i=t[1]):3===t.length?(e=t[0],n=i=t[1],r=t[2]):(e=t[0],n=t[1],r=t[2],i=t[3]):e=n=r=i=t,{r1:e,r2:n,r3:r,r4:i}}(o);return(0,_.isArray)(o)?1===o.length?a.r1=a.r2=a.r3=a.r4=o[0]:2===o.length?(a.r1=a.r3=o[0],a.r2=a.r4=o[1]):3===o.length?(a.r1=o[0],a.r2=a.r4=o[1],a.r3=o[2]):(a.r1=o[0],a.r2=o[1],a.r3=o[2],a.r4=o[3]):a.r1=a.r2=a.r3=a.r4=o,[["M "+(e+a.r1)+","+n],["l "+(r-a.r1-a.r2)+",0"],["a "+a.r2+","+a.r2+",0,0,1,"+a.r2+","+a.r2],["l 0,"+(i-a.r2-a.r3)],["a "+a.r3+","+a.r3+",0,0,1,"+-a.r3+","+a.r3],["l "+(a.r3+a.r4-r)+",0"],["a "+a.r4+","+a.r4+",0,0,1,"+-a.r4+","+-a.r4],["l 0,"+(a.r4+a.r1-i)],["a "+a.r1+","+a.r1+",0,0,1,"+a.r1+","+-a.r1],["z"]].join(" ")},e}(Yl);const vc=gc;var mc={top:"before-edge",middle:"central",bottom:"after-edge",alphabetic:"baseline",hanging:"hanging"},yc={top:"text-before-edge",middle:"central",bottom:"text-after-edge",alphabetic:"alphabetic",hanging:"hanging"},_c={left:"left",start:"left",center:"middle",right:"end",end:"end"},bc=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="text",e.canFill=!0,e.canStroke=!0,e}return(0,y.__extends)(e,t),e.prototype.getDefaultAttrs=function(){var e=t.prototype.getDefaultAttrs.call(this);return(0,y.__assign)((0,y.__assign)({},e),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},e.prototype.createPath=function(t,e){var n=this,r=this.attr(),i=this.get("el");this._setFont(),(0,_.each)(e||r,(function(t,e){"text"===e?n._setText(""+t):"matrix"===e&&t?jl(n):Bl[e]&&i.setAttribute(Bl[e],t)})),i.setAttribute("paint-order","stroke"),i.setAttribute("style","stroke-linecap:butt; stroke-linejoin:miter;")},e.prototype._setFont=function(){var t=this.get("el"),e=this.attr(),n=e.textBaseline,r=e.textAlign,i=Fr();i&&"firefox"===i.name?t.setAttribute("dominant-baseline",yc[n]||"alphabetic"):t.setAttribute("alignment-baseline",mc[n]||"baseline"),t.setAttribute("text-anchor",_c[r]||"left")},e.prototype._setText=function(t){var e=this.get("el"),n=this.attr(),r=n.x,i=n.textBaseline,o=void 0===i?"bottom":i;if(t)if(~t.indexOf("\n")){var a=t.split("\n"),s=a.length-1,u="";(0,_.each)(a,(function(t,e){0===e?"alphabetic"===o?u+='<tspan x="'+r+'" dy="'+-s+'em">'+t+"</tspan>":"top"===o?u+='<tspan x="'+r+'" dy="0.9em">'+t+"</tspan>":"middle"===o?u+='<tspan x="'+r+'" dy="'+-(s-1)/2+'em">'+t+"</tspan>":"bottom"===o?u+='<tspan x="'+r+'" dy="-'+(s+.3)+'em">'+t+"</tspan>":"hanging"===o&&(u+='<tspan x="'+r+'" dy="'+(-(s-1)-.3)+'em">'+t+"</tspan>"):u+='<tspan x="'+r+'" dy="1em">'+t+"</tspan>"})),e.innerHTML=u}else e.innerHTML=t;else e.innerHTML=""},e}(Yl);const xc=bc;var wc=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,Ec=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,Sc=/[\d.]+:(#[^\s]+|[^)]+\))/gi;function Cc(t){var e=t.match(Sc);if(!e)return"";var n="";return e.sort((function(t,e){return t=t.split(":"),e=e.split(":"),Number(t[0])-Number(e[0])})),(0,_.each)(e,(function(t){t=t.split(":"),n+='<stop offset="'+t[0]+'" stop-color="'+t[1]+'"></stop>'})),n}var Ac=function(){function t(t){this.cfg={};var e=null,n=(0,_.uniqueId)("gradient_");return"l"===t.toLowerCase()[0]?function(t,e){var n,r,i=wc.exec(t),o=(0,_.mod)((0,_.toRadian)(parseFloat(i[1])),2*Math.PI),a=i[2];o>=0&&o<.5*Math.PI?(n={x:0,y:0},r={x:1,y:1}):.5*Math.PI<=o&&o<Math.PI?(n={x:1,y:0},r={x:0,y:1}):Math.PI<=o&&o<1.5*Math.PI?(n={x:1,y:1},r={x:0,y:0}):(n={x:0,y:1},r={x:1,y:0});var s=Math.tan(o),u=s*s,l=(r.x-n.x+s*(r.y-n.y))/(u+1)+n.x,c=s*(r.x-n.x+s*(r.y-n.y))/(u+1)+n.y;e.setAttribute("x1",n.x),e.setAttribute("y1",n.y),e.setAttribute("x2",l),e.setAttribute("y2",c),e.innerHTML=Cc(a)}(t,e=zl("linearGradient")):function(t,e){var n=Ec.exec(t),r=parseFloat(n[1]),i=parseFloat(n[2]),o=parseFloat(n[3]),a=n[4];e.setAttribute("cx",r),e.setAttribute("cy",i),e.setAttribute("r",o),e.innerHTML=Cc(a)}(t,e=zl("radialGradient")),e.setAttribute("id",n),this.el=e,this.id=n,this.cfg=t,this}return t.prototype.match=function(t,e){return this.cfg===e},t}();const Tc=Ac;var kc={shadowColor:"color",shadowOpacity:"opacity",shadowBlur:"blur",shadowOffsetX:"dx",shadowOffsetY:"dy"},Mc={x:"-40%",y:"-40%",width:"200%",height:"200%"},Pc=function(){function t(t){this.type="filter",this.cfg={},this.type="filter";var e=zl("filter");return(0,_.each)(Mc,(function(t,n){e.setAttribute(n,t)})),this.el=e,this.id=(0,_.uniqueId)("filter_"),this.el.id=this.id,this.cfg=t,this._parseShadow(t,e),this}return t.prototype.match=function(t,e){if(this.type!==t)return!1;var n=!0,r=this.cfg;return(0,_.each)(Object.keys(r),(function(t){if(r[t]!==e[t])return n=!1,!1})),n},t.prototype.update=function(t,e){var n=this.cfg;return n[kc[t]]=e,this._parseShadow(n,this.el),this},t.prototype._parseShadow=function(t,e){var n='<feDropShadow\n      dx="'+(t.dx||0)+'"\n      dy="'+(t.dy||0)+'"\n      stdDeviation="'+(t.blur?t.blur/10:0)+'"\n      flood-color="'+(t.color?t.color:"#000")+'"\n      flood-opacity="'+(t.opacity?t.opacity:1)+'"\n      />';e.innerHTML=n},t}();const Ic=Pc;var Oc=function(){function t(t,e){this.cfg={};var n=zl("marker"),r=(0,_.uniqueId)("marker_");n.setAttribute("id",r);var i=zl("path");i.setAttribute("stroke",t.stroke||"none"),i.setAttribute("fill",t.fill||"none"),n.appendChild(i),n.setAttribute("overflow","visible"),n.setAttribute("orient","auto-start-reverse"),this.el=n,this.child=i,this.id=r;var o=t["marker-start"===e?"startArrow":"endArrow"];return this.stroke=t.stroke||"#000",!0===o?this._setDefaultPath(e,i):(this.cfg=o,this._setMarker(t.lineWidth,i)),this}return t.prototype.match=function(){return!1},t.prototype._setDefaultPath=function(t,e){var n=this.el;e.setAttribute("d","M0,0 L"+10*Math.cos(Math.PI/6)+",5 L0,10"),n.setAttribute("refX",""+10*Math.cos(Math.PI/6)),n.setAttribute("refY","5")},t.prototype._setMarker=function(t,e){var n=this.el,r=this.cfg.path,i=this.cfg.d;(0,_.isArray)(r)&&(r=r.map((function(t){return t.join(" ")})).join("")),e.setAttribute("d",r),n.appendChild(e),i&&n.setAttribute("refX",""+i/t)},t.prototype.update=function(t){var e=this.child;e.attr?e.attr("fill",t):e.setAttribute("fill",t)},t}();const Rc=Oc,Lc=function(){function t(t){this.type="clip",this.cfg={};var e=zl("clipPath");this.el=e,this.id=(0,_.uniqueId)("clip_"),e.id=this.id;var n=t.cfg.el;return e.appendChild(n),this.cfg=t,this}return t.prototype.match=function(){return!1},t.prototype.remove=function(){var t=this.el;t.parentNode.removeChild(t)},t}();var Dc=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i;const Nc=function(){function t(t){this.cfg={};var e=zl("pattern");e.setAttribute("patternUnits","userSpaceOnUse");var n=zl("image");e.appendChild(n);var r=(0,_.uniqueId)("pattern_");e.id=r,this.el=e,this.id=r,this.cfg=t;var i=Dc.exec(t)[2];n.setAttribute("href",i);var o=new Image;function a(){e.setAttribute("width",""+o.width),e.setAttribute("height",""+o.height)}return i.match(/^data:/i)||(o.crossOrigin="Anonymous"),o.src=i,o.complete?a():(o.onload=a,o.src=o.src),this}return t.prototype.match=function(t,e){return this.cfg===e},t}();var Bc=function(){function t(t){var e=zl("defs"),n=(0,_.uniqueId)("defs_");e.id=n,t.appendChild(e),this.children=[],this.defaultArrow={},this.el=e,this.canvas=t}return t.prototype.find=function(t,e){for(var n=this.children,r=null,i=0;i<n.length;i++)if(n[i].match(t,e)){r=n[i].id;break}return r},t.prototype.findById=function(t){for(var e=this.children,n=null,r=0;r<e.length;r++)if(e[r].id===t){n=e[r];break}return n},t.prototype.add=function(t){this.children.push(t),t.canvas=this.canvas,t.parent=this},t.prototype.getDefaultArrow=function(t,e){var n=t.stroke||t.strokeStyle;if(this.defaultArrow[n])return this.defaultArrow[n].id;var r=new Rc(t,e);return this.defaultArrow[n]=r,this.el.appendChild(r.el),this.add(r),r.id},t.prototype.addGradient=function(t){var e=new Tc(t);return this.el.appendChild(e.el),this.add(e),e.id},t.prototype.addArrow=function(t,e){var n=new Rc(t,e);return this.el.appendChild(n.el),this.add(n),n.id},t.prototype.addShadow=function(t){var e=new Ic(t);return this.el.appendChild(e.el),this.add(e),e.id},t.prototype.addPattern=function(t){var e=new Nc(t);return this.el.appendChild(e.el),this.add(e),e.id},t.prototype.addClip=function(t){var e=new Lc(t);return this.el.appendChild(e.el),this.add(e),e.id},t}();const zc=Bc;var Fc=function(t){function e(e){return t.call(this,(0,y.__assign)((0,y.__assign)({},e),{autoDraw:!0,renderer:"svg"}))||this}return(0,y.__extends)(e,t),e.prototype.getShapeBase=function(){return p},e.prototype.getGroupBase=function(){return Hl},e.prototype.getShape=function(t,e,n){var r=n.target||n.srcElement;if(!Nl[r.tagName]){for(var i=r.parentNode;i&&!Nl[i.tagName];)i=i.parentNode;r=i}return this.find((function(t){return t.get("el")===r}))},e.prototype.createDom=function(){var t=zl("svg"),e=new zc(t);return t.setAttribute("width",""+this.get("width")),t.setAttribute("height",""+this.get("height")),this.set("context",e),t},e.prototype.onCanvasChange=function(t){var e=this.get("context"),n=this.get("el");if("sort"===t){var r=this.get("children");r&&r.length&&Zl(this,(function(t,e){return r.indexOf(t)-r.indexOf(e)?1:0}))}else if("clear"===t){if(n){n.innerHTML="";var i=e.el;i.innerHTML="",n.appendChild(i)}}else"matrix"===t?jl(this):"clip"===t?Ul(this,e):"changeSize"===t&&(n.setAttribute("width",""+this.get("width")),n.setAttribute("height",""+this.get("height")))},e.prototype.draw=function(){var t=this.get("context"),e=this.getChildren();Ul(this,t),e.length&&Gl(t,e)},e}(vo);const Zc=Fc;var jc=n(6767),Uc=n.n(jc),Gc=n(7621),Vc=n.n(Gc),Wc=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function Hc(t,e,n){var r;return(r=Math.round(t.h)>=60&&Math.round(t.h)<=240?n?Math.round(t.h)-2*e:Math.round(t.h)+2*e:n?Math.round(t.h)+2*e:Math.round(t.h)-2*e)<0?r+=360:r>=360&&(r-=360),r}function Xc(t,e,n){return 0===t.h&&0===t.s?t.s:((r=n?t.s-.16*e:4===e?t.s+.16:t.s+.05*e)>1&&(r=1),n&&5===e&&r>.1&&(r=.1),r<.06&&(r=.06),Number(r.toFixed(2)));var r}function Yc(t,e,n){var r;return(r=n?t.v+.05*e:t.v-.15*e)>1&&(r=1),Number(r.toFixed(2))}function qc(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],r=Vc()(t),i=5;i>0;i-=1){var o=r.toHsv(),a=Vc()({h:Hc(o,i,!0),s:Xc(o,i,!0),v:Yc(o,i,!0)}).toHexString();n.push(a)}n.push(r.toHexString());for(var s=1;s<=4;s+=1){var u=r.toHsv(),l=Vc()({h:Hc(u,s),s:Xc(u,s),v:Yc(u,s)}).toHexString();n.push(l)}return"dark"===e.theme?Wc.map((function(t){var r=t.index,i=t.opacity;return Vc().mix(e.backgroundColor||"#141414",n[r],100*i).toHexString()})):n}var Kc={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1890FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},Qc={},Jc={};Object.keys(Kc).forEach((function(t){Qc[t]=qc(Kc[t]),Qc[t].primary=Qc[t][5],Jc[t]=qc(Kc[t],{theme:"dark",backgroundColor:"#141414"}),Jc[t].primary=Jc[t][5]})),Qc.red,Qc.volcano,Qc.gold,Qc.orange,Qc.yellow,Qc.lime,Qc.green,Qc.cyan,Qc.blue,Qc.geekblue,Qc.purple,Qc.magenta,Qc.grey;var $c=function(t,e,n){var r=Uc()(t),i=Uc()(e);return Uc()([(1-n)*r.red()+n*i.red(),(1-n)*r.green()+n*i.green(),(1-n)*r.blue()+n*i.blue()]).rgb()},th=function(t,e,n,r){return void 0===e&&(e="#fff"),void 0===n&&(n="default"),void 0===r&&(r="rgb(150, 150, 150)"),"default"===n?function(t,e,n){void 0===e&&(e="#fff"),void 0===n&&(n="rgb(150, 150, 150)");var r=$c(e,t,.05).rgb().toString(),i=$c(e,t,.1).rgb().toString(),o=$c(e,t,.2).rgb().toString(),a=$c(e,t,.4).rgb().toString(),s=$c(e,n,.02).rgb().toString(),u=$c(e,n,.05).rgb().toString(),l=$c(e,n,.1).rgb().toString(),c=$c(e,n,.2).rgb().toString(),h=$c(e,n,.3).rgb().toString(),f=qc(t,{theme:"default",backgroundColor:e}),p=Uc()(t).hex().toLowerCase(),d=f.indexOf(p),g=t;return-1!==d&&(g=f[d+1]),{mainStroke:t,mainFill:i,activeStroke:t,activeFill:r,inactiveStroke:a,inactiveFill:r,selectedStroke:t,selectedFill:e,highlightStroke:g,highlightFill:o,disableStroke:h,disableFill:u,edgeMainStroke:h,edgeActiveStroke:t,edgeInactiveStroke:c,edgeSelectedStroke:t,edgeHighlightStroke:t,edgeDisableStroke:l,comboMainStroke:h,comboMainFill:s,comboActiveStroke:t,comboActiveFill:r,comboInactiveStroke:h,comboInactiveFill:s,comboSelectedStroke:t,comboSelectedFill:s,comboHighlightStroke:g,comboHighlightFill:s,comboDisableStroke:c,comboDisableFill:u}}(t,e,"rgb(150, 150, 150)"):function(t,e,n){void 0===e&&(e="#fff"),void 0===n&&(n="#777");var r=$c(e,t,.2).rgb().toString(),i=$c(e,t,.3).rgb().toString(),o=$c(e,t,.6).rgb().toString(),a=$c(e,t,.8).rgb().toString(),s=$c(e,n,.2).rgb().toString(),u=$c(e,n,.25).rgb().toString(),l=$c(e,n,.3).rgb().toString(),c=$c(e,n,.4).rgb().toString(),h=$c(e,n,.5).rgb().toString(),f=qc(t,{theme:"dark",backgroundColor:e}),p=Uc()(t).hex().toLowerCase(),d=f.indexOf(p),g=t;return-1!==d&&(g=f[d+1]),{mainStroke:a,mainFill:r,activeStroke:t,activeFill:i,inactiveStroke:a,inactiveFill:r,selectedStroke:t,selectedFill:r,highlightStroke:t,highlightFill:o,disableStroke:h,disableFill:u,edgeMainStroke:n,edgeActiveStroke:t,edgeInactiveStroke:n,edgeSelectedStroke:t,edgeHighlightStroke:t,edgeDisableStroke:l,comboMainStroke:c,comboMainFill:u,comboActiveStroke:t,comboActiveFill:s,comboInactiveStroke:c,comboInactiveFill:u,comboSelectedStroke:t,comboSelectedFill:s,comboHighlightStroke:g,comboHighlightFill:u,comboDisableStroke:c,comboDisableFill:s}}(t,e,"#777")},eh=function(t,e,n,r){void 0===e&&(e="#fff"),void 0===n&&(n="default"),void 0===r&&(r="rgb(150, 150, 150)");var i=[];return t.forEach((function(t){i.push(th(t,e,n,r))})),i},nh="rgb(0, 0, 0)",rh=th("rgb(95, 149, 255)","rgb(255, 255, 255)");const ih={version:"0.5.1",rootContainerClassName:"root-container",nodeContainerClassName:"node-container",edgeContainerClassName:"edge-container",comboContainerClassName:"combo-container",delegateContainerClassName:"delegate-container",defaultLoopPosition:"top",nodeLabel:{style:{fill:"#000",fontSize:12,textAlign:"center",textBaseline:"middle"},offset:4},defaultNode:{type:"circle",style:{lineWidth:1,stroke:rh.mainStroke,fill:rh.mainFill},size:20,color:rh.mainStroke,linkPoints:{size:8,lineWidth:1,fill:rh.activeFill,stroke:rh.activeStroke}},nodeStateStyles:{active:{fill:rh.activeFill,stroke:rh.activeStroke,lineWidth:2,shadowColor:rh.mainStroke,shadowBlur:10},selected:{fill:rh.selectedFill,stroke:rh.selectedStroke,lineWidth:4,shadowColor:rh.selectedStroke,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{fill:rh.highlightFill,stroke:rh.highlightStroke,lineWidth:2,"text-shape":{fontWeight:500}},inactive:{fill:rh.inactiveFill,stroke:rh.inactiveStroke,lineWidth:1},disable:{fill:rh.disableFill,stroke:rh.disableStroke,lineWidth:1}},edgeLabel:{style:{fill:nh,textAlign:"center",textBaseline:"middle",fontSize:12}},defaultEdge:{type:"line",size:1,style:{stroke:rh.edgeMainStroke,lineAppendWidth:2},color:rh.edgeMainStroke},edgeStateStyles:{active:{stroke:rh.edgeActiveStroke,lineWidth:1},selected:{stroke:rh.edgeSelectedStroke,lineWidth:2,shadowColor:rh.edgeSelectedStroke,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{stroke:rh.edgeHighlightStroke,lineWidth:2,"text-shape":{fontWeight:500}},inactive:{stroke:rh.edgeInactiveStroke,lineWidth:1},disable:{stroke:rh.edgeDisableStroke,lineWidth:1}},comboLabel:{style:{fill:nh,textBaseline:"middle",fontSize:12},refY:10,refX:10},defaultCombo:{type:"circle",style:{fill:rh.comboMainFill,lineWidth:1,stroke:rh.comboMainStroke,r:5,width:20,height:10},size:[20,5],color:rh.comboMainStroke,padding:[25,20,15,20]},comboStateStyles:{active:{stroke:rh.comboActiveStroke,lineWidth:1,fill:rh.comboActiveFill},selected:{stroke:rh.comboSelectedStroke,lineWidth:2,fill:rh.comboSelectedFill,shadowColor:rh.comboSelectedStroke,shadowBlur:10,"text-shape":{fontWeight:500}},highlight:{stroke:rh.comboHighlightStroke,lineWidth:2,fill:rh.comboHighlightFill,"text-shape":{fontWeight:500}},inactive:{stroke:rh.comboInactiveStroke,fill:rh.comboInactiveFill,lineWidth:1},disable:{stroke:rh.comboDisableStroke,fill:rh.comboDisableFill,lineWidth:1}},delegateStyle:{fill:"#F3F9FF",fillOpacity:.5,stroke:"#1890FF",strokeOpacity:.9,lineDash:[5,5]},textWaterMarkerConfig:{width:150,height:100,compatible:!1,text:{x:0,y:60,lineHeight:20,rotate:20,fontSize:14,fontFamily:"Microsoft YaHei",fill:"rgba(0, 0, 0, 0.1)",baseline:"Middle"}},imageWaterMarkerConfig:{width:150,height:130,compatible:!1,image:{x:0,y:0,width:30,height:20,rotate:0}},waterMarkerImage:"https://gw.alipayobjects.com/os/s/prod/antv/assets/image/logo-with-text-73b8a.svg"};function oh(t,e,n){if(t){if("function"==typeof t.addEventListener)return t.addEventListener(e,n,!1),{remove:function(){t.removeEventListener(e,n,!1)}};if("function"==typeof t.attachEvent)return t.attachEvent("on"+e,n),{remove:function(){t.detachEvent("on"+e,n)}}}}var ah=su.cloneEvent,sh=su.isViewportChanged,uh=function(t){function e(e){var n=t.call(this,e)||this;return n.extendEvents=[],n.dragging=!1,n.preItem=null,n.graph=e,n.destroyed=!1,n.initEvents(),n}return(0,y.__extends)(e,t),e.prototype.initEvents=function(){var t=this.graph,e=this.extendEvents,n=void 0===e?[]:e,r=t.get("canvas"),i=r.get("el"),o=(0,_.wrapBehavior)(this,"onCanvasEvents"),a=(0,_.wrapBehavior)(this,"onExtendEvents"),s=(0,_.wrapBehavior)(this,"onWheelEvent");r.off("*").on("*",o),this.canvasHandler=o,n.push(oh(i,"DOMMouseScroll",s)),n.push(oh(i,"mousewheel",s)),"undefined"!=typeof window&&(n.push(oh(window,"keydown",a)),n.push(oh(window,"keyup",a)),n.push(oh(window,"focus",a)))},e.getItemRoot=function(t){for(;t&&!t.get("item");)t=t.get("parent");return t},e.prototype.onCanvasEvents=function(t){var n=this.graph,r=n.get("canvas"),i=t.target,o=t.type;t.canvasX=t.x,t.canvasY=t.y;var a={x:t.canvasX,y:t.canvasY},s=n.get("group").getMatrix();if(s||(s=[1,0,0,0,1,0,0,0,1]),sh(s)&&(a=n.getPointByClient(t.clientX,t.clientY)),t.x=a.x,t.y=a.y,t.currentTarget=n,i===r)return"mousemove"!==o&&"mouseleave"!==o||this.handleMouseMove(t,"canvas"),t.target=r,t.item=null,n.emit(o,t),void n.emit("canvas:".concat(o),t);var u=e.getItemRoot(i);if(u){var l=u.get("item");if(!l.destroyed){var c=l.getType();if(t.target=i,t.item=l,t.canvasX===t.x&&t.canvasY===t.y){var h=n.getCanvasByPoint(t.x,t.y);t.canvasX=h.x,t.canvasY=h.y}n.emit(o,t),t.name&&!t.name.includes(":")?n.emit("".concat(c,":").concat(o),t):n.emit(t.name,t),"dragstart"===o&&(this.dragging=!0),"dragend"===o&&(this.dragging=!1),"mousemove"===o&&this.handleMouseMove(t,c)}}else n.emit(o,t)},e.prototype.onExtendEvents=function(t){this.graph.emit(t.type,t)},e.prototype.onWheelEvent=function(t){(0,_.isNil)(t.wheelDelta)&&(t.wheelDelta=-t.detail),this.graph.emit("wheel",t)},e.prototype.handleMouseMove=function(t,e){var n=this.graph,r=this.preItem,i=n.get("canvas"),o=t.target===i?null:t.item;t=ah(t),r&&r!==o&&!r.destroyed&&(t.item=r,this.emitCustomEvent(r.getType(),"mouseleave",t),this.dragging&&this.emitCustomEvent(r.getType(),"dragleave",t)),o&&r!==o&&(t.item=o,this.emitCustomEvent(e,"mouseenter",t),this.dragging&&this.emitCustomEvent(e,"dragenter",t)),this.preItem=o},e.prototype.emitCustomEvent=function(t,e,n){n.type=e,this.graph.emit("".concat(t,":").concat(e),n)},e.prototype.destroy=function(){var t=this,e=t.graph,n=t.canvasHandler,r=t.extendEvents;e.get("canvas").off("*",n),(0,_.each)(r,(function(t){t.remove()})),this.dragging=!1,this.preItem=null,this.extendEvents.length=0,this.canvasHandler=null,this.destroyed=!0},e}(cu);const lh=uh;class ch{constructor(){this.nodes=[],this.edges=[],this.combos=[],this.positions=[],this.destroyed=!1,this.onLayoutEnd=()=>{}}layout(t){return this.init(t),this.execute(!0)}init(t){this.nodes=t.nodes||[],this.edges=t.edges||[],this.combos=t.combos||[]}execute(t){}executeWithWorker(){}getDefaultCfg(){return{}}updateCfg(t){t&&Object.assign(this,t)}getType(){return"base"}destroy(){this.nodes=null,this.edges=null,this.combos=null,this.positions=null,this.destroyed=!0}}const hh=t=>"string"==typeof t,fh=(Object.create(null),Array.isArray),ph=t=>"number"==typeof t,dh=t=>Number.isNaN(Number(t)),gh=t=>null!==t&&"object"==typeof t,vh=t=>{if(null===t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array){const e=[];return t.forEach((t=>{e.push(t)})),e.map((t=>vh(t)))}if("object"==typeof t&&t!=={}){const e=Object.assign({},t);return Object.keys(e).forEach((t=>{e[t]=vh(e[t])})),e}return t},mh=(t,e)=>{const n=t[e];return gh(n)?n.cell:n},yh=(t,e,n)=>{const r=[];for(let e=0;e<t;e++)r[e]=0;return n?(n.forEach((t=>{const n=mh(t,"source"),i=mh(t,"target");n&&(r[e[n]]+=1),i&&(r[e[i]]+=1)})),r):r},_h=t=>{const e=[],n=t.length;for(let r=0;r<n;r+=1){e[r]=[];for(let i=0;i<n;i+=1)r===i?e[r][i]=0:0!==t[r][i]&&t[r][i]?e[r][i]=t[r][i]:e[r][i]=1/0}for(let t=0;t<n;t+=1)for(let r=0;r<n;r+=1)for(let i=0;i<n;i+=1)e[r][i]>e[r][t]+e[t][i]&&(e[r][i]=e[r][t]+e[t][i]);return e},bh=(t,e)=>{const{nodes:n,edges:r}=t,i=[],o={};if(!n)throw new Error("invalid nodes data!");return n&&n.forEach(((t,e)=>{o[t.id]=e,i.push([])})),r&&r.forEach((t=>{const n=mh(t,"source"),r=mh(t,"target"),a=o[n],s=o[r];i[a][s]=1,e||(i[s][a]=1)})),i},xh=(t,e)=>{if(t&&t.children)for(let n=t.children.length-1;n>=0;n--)if(!xh(t.children[n],e))return;return!!e(t)},wh=(t,e)=>{"function"==typeof e&&xh(t,e)},Eh=t=>"function"==typeof t,Sh=new Map,Ch=(t,e)=>{if(Sh.get(t)&&console.warn(`The layout with the name ${t} exists already, it will be overridden`),gh(e)){class n extends ch{constructor(t){super();const n=this,r={},i=n.getDefaultCfg();Object.assign(r,i,e,t),Object.keys(r).forEach((t=>{const e=r[t];n[t]=e}))}}Sh.set(t,n)}else Sh.set(t,e);return Sh.get(t)};class Ah extends ch{constructor(t){super(),this.begin=[0,0],this.preventOverlap=!0,this.preventOverlapPadding=10,this.condense=!1,this.sortBy="degree",this.nodeSize=30,this.nodes=[],this.edges=[],this.width=300,this.height=300,this.row=0,this.col=0,this.cellWidth=0,this.cellHeight=0,this.cellUsed={},this.id2manPos={},this.onLayoutEnd=()=>{},this.updateCfg(t)}getDefaultCfg(){return{begin:[0,0],preventOverlap:!0,preventOverlapPadding:10,condense:!1,rows:void 0,cols:void 0,position:void 0,sortBy:"degree",nodeSize:30}}execute(){const t=this,e=t.nodes,n=t.edges,r=e.length,i=t.begin;if(0===r)return t.onLayoutEnd&&t.onLayoutEnd(),{nodes:e,edges:n};if(1===r)return e[0].x=i[0],e[0].y=i[1],t.onLayoutEnd&&t.onLayoutEnd(),{nodes:e,edges:n};const o=[];e.forEach((t=>{o.push(t)}));const a={};if(o.forEach(((t,e)=>{a[t.id]=e})),("degree"===t.sortBy||!hh(t.sortBy)||void 0===o[0][t.sortBy])&&(t.sortBy="degree",dh(e[0].degree))){const t=yh(o.length,a,n);o.forEach(((e,n)=>{e.degree=t[n]}))}o.sort(((e,n)=>n[t.sortBy]-e[t.sortBy])),t.width||"undefined"==typeof window||(t.width=window.innerWidth),t.height||"undefined"==typeof window||(t.height=window.innerHeight);const s=t.rows,u=null!=t.cols?t.cols:t.columns;if(t.cells=r,null!=s&&null!=u?(t.rows=s,t.cols=u):null!=s&&null==u?(t.rows=s,t.cols=Math.ceil(t.cells/t.rows)):null==s&&null!=u?(t.cols=u,t.rows=Math.ceil(t.cells/t.cols)):(t.splits=Math.sqrt(t.cells*t.height/t.width),t.rows=Math.round(t.splits),t.cols=Math.round(t.width/t.height*t.splits)),t.cols*t.rows>t.cells){const e=t.small(),n=t.large();(e-1)*n>=t.cells?t.small(e-1):(n-1)*e>=t.cells&&t.large(n-1)}else for(;t.cols*t.rows<t.cells;){const e=t.small(),n=t.large();(n+1)*e>=t.cells?t.large(n+1):t.small(e+1)}t.cellWidth=t.width/t.cols,t.cellHeight=t.height/t.rows,t.condense&&(t.cellWidth=0,t.cellHeight=0),t.preventOverlap&&o.forEach((e=>{let n,r;e.x&&e.y||(e.x=0,e.y=0),fh(e.size)?(n=e.size[0],r=e.size[1]):ph(e.size)?(n=e.size,r=e.size):gh(e.size)&&(n=e.size.width,r=e.size.height),void 0!==n&&void 0!==r||(fh(t.nodeSize)?(n=t.nodeSize[0],r=t.nodeSize[1]):ph(t.nodeSize)?(n=t.nodeSize,r=t.nodeSize):(n=30,r=30));const i=t.preventOverlapPadding,o=n+i,a=r+i;t.cellWidth=Math.max(t.cellWidth,o),t.cellHeight=Math.max(t.cellHeight,a)})),t.cellUsed={},t.row=0,t.col=0,t.id2manPos={};for(let e=0;e<o.length;e++){const n=o[e];let r;if(t.position&&(r=t.position(n)),r&&(void 0!==r.row||void 0!==r.col)){const e={row:r.row,col:r.col};if(void 0===e.col)for(e.col=0;t.used(e.row,e.col);)e.col++;else if(void 0===e.row)for(e.row=0;t.used(e.row,e.col);)e.row++;t.id2manPos[n.id]=e,t.use(e.row,e.col)}t.getPos(n)}return t.onLayoutEnd&&t.onLayoutEnd(),{edges:n,nodes:o}}small(t){const e=this;let n;const r=e.rows||5,i=e.cols||5;return null==t?n=Math.min(r,i):Math.min(r,i)===e.rows?e.rows=t:e.cols=t,n}large(t){const e=this;let n;const r=e.rows||5,i=e.cols||5;return null==t?n=Math.max(r,i):Math.max(r,i)===e.rows?e.rows=t:e.cols=t,n}used(t,e){return this.cellUsed[`c-${t}-${e}`]||!1}use(t,e){this.cellUsed[`c-${t}-${e}`]=!0}moveToNextCell(){const t=this,e=t.cols||5;t.col++,t.col>=e&&(t.col=0,t.row++)}getPos(t){const e=this,n=e.begin,r=e.cellWidth,i=e.cellHeight;let o,a;const s=e.id2manPos[t.id];if(s)o=s.col*r+r/2+n[0],a=s.row*i+i/2+n[1];else{for(;e.used(e.row,e.col);)e.moveToNextCell();o=e.col*r+r/2+n[0],a=e.row*i+i/2+n[1],e.use(e.row,e.col),e.moveToNextCell()}t.x=o,t.y=a}getType(){return"grid"}}class Th extends ch{constructor(t){super(),this.center=[0,0],this.width=300,this.height=300,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.updateCfg(t)}getDefaultCfg(){return{center:[0,0],width:300,height:300}}execute(){const t=this,e=t.nodes,n=t.center;return t.width||"undefined"==typeof window||(t.width=window.innerWidth),t.height||"undefined"==typeof window||(t.height=window.innerHeight),e&&e.forEach((e=>{e.x=.9*(Math.random()-.5)*t.width+n[0],e.y=.9*(Math.random()-.5)*t.height+n[1]})),t.onLayoutEnd&&t.onLayoutEnd(),{nodes:e,edges:this.edges}}getType(){return"random"}}const kh=(t,e)=>{let n;return n=t?ph(t)?e=>t:t:t=>e||1,n};class Mh extends ch{constructor(t){super(),this.maxIteration=1e3,this.workerEnabled=!1,this.edgeStrength=200,this.nodeStrength=1e3,this.coulombDisScale=.005,this.damping=.9,this.maxSpeed=1e3,this.minMovement=.5,this.interval=.02,this.factor=1,this.linkDistance=1,this.gravity=10,this.preventOverlap=!0,this.tick=()=>{},this.nodes=[],this.edges=[],this.width=300,this.height=300,this.nodeMap={},this.nodeIdxMap={},this.updateCfg(t)}getDefaultCfg(){return{maxIteration:500,gravity:10,enableTick:!0}}execute(){var t,e;const n=this,r=n.nodes;if(void 0!==n.timeInterval&&"undefined"!=typeof window&&window.clearInterval(n.timeInterval),!r||0===r.length)return void(null===(t=n.onLayoutEnd)||void 0===t||t.call(n));n.width||"undefined"==typeof window||(n.width=window.innerWidth),n.height||"undefined"==typeof window||(n.height=window.innerHeight),n.center||(n.center=[n.width/2,n.height/2]);const i=n.center;if(1===r.length)return r[0].x=i[0],r[0].y=i[1],void(null===(e=n.onLayoutEnd)||void 0===e||e.call(n));const o={},a={};r.forEach(((t,e)=>{ph(t.x)||(t.x=Math.random()*n.width),ph(t.y)||(t.y=Math.random()*n.height),o[t.id]=t,a[t.id]=e})),n.nodeMap=o,n.nodeIdxMap=a,n.linkDistance=kh(n.linkDistance,1),n.nodeStrength=kh(n.nodeStrength,1),n.edgeStrength=kh(n.edgeStrength,1);const s=n.nodeSize;let u;if(n.preventOverlap){const t=n.nodeSpacing;let e;e=ph(t)?()=>t:Eh(t)?t:()=>0,u=s?fh(s)?t=>(s[0]>s[1]?s[0]:s[1])+e(t):t=>s+e(t):t=>t.size?fh(t.size)?(t.size[0]>t.size[1]?t.size[0]:t.size[1])+e(t):gh(t.size)?(t.size.width>t.size.height?t.size.width:t.size.height)+e(t):t.size+e(t):10+e(t)}n.nodeSize=u;const l=n.edges;n.degrees=yh(r.length,n.nodeIdxMap,l),n.getMass||(n.getMass=t=>n.degrees[n.nodeIdxMap[t.id]]||1),n.run()}run(){var t;const e=this,{maxIteration:n,nodes:r,workerEnabled:i,minMovement:o}=e;if(r)if(i){for(let t=0;t<n;t++){const n=e.runOneStep(t);if(e.reachMoveThreshold(r,n,o))break}null===(t=e.onLayoutEnd)||void 0===t||t.call(e)}else{if("undefined"==typeof window)return;let t=0;this.timeInterval=window.setInterval((()=>{var i,a;if(!r)return;const s=e.runOneStep(t)||[];e.reachMoveThreshold(r,s,o)&&(null===(i=e.onLayoutEnd)||void 0===i||i.call(e),window.clearInterval(e.timeInterval)),t++,t>=n&&(null===(a=e.onLayoutEnd)||void 0===a||a.call(e),window.clearInterval(e.timeInterval))}),0)}}reachMoveThreshold(t,e,n){let r=0;return t.forEach(((t,n)=>{const i=t.x-e[n].x,o=t.y-e[n].y;r+=Math.sqrt(i*i+o*o)})),r/=t.length,r<n}runOneStep(t){var e;const n=this,{nodes:r,edges:i}=n,o=[],a=[];if(!r)return;r.forEach(((t,e)=>{o[2*e]=0,o[2*e+1]=0,a[2*e]=0,a[2*e+1]=0})),n.calRepulsive(o,r),i&&n.calAttractive(o,i),n.calGravity(o,r);const s=Math.max(.02,n.interval-.002*t);n.updateVelocity(o,a,s,r);const u=[];return r.forEach((t=>{u.push({x:t.x,y:t.y})})),n.updatePosition(a,s,r),null===(e=n.tick)||void 0===e||e.call(n),u}calRepulsive(t,e){const n=this,r=n.getMass,i=n.nodeStrength,o=n.factor,a=n.coulombDisScale,s=n.preventOverlap,u=n.nodeSize;e.forEach(((n,l)=>{const c=r?r(n):1;e.forEach(((e,h)=>{if(l>=h)return;const f=n.x-e.x,p=n.y-e.y,d=Math.sqrt(f*f+p*p)+.01,g=(d+.1)*a,v=f/d,m=p/d,y=(i(n)+i(e))/2*o/(g*g),_=r?r(e):1;if(t[2*l]+=v*y,t[2*l+1]+=m*y,t[2*h]-=v*y,t[2*h+1]-=m*y,s&&d<(u(n)+u(e))/2){const r=(i(n)+i(e))/2/(d*d);t[2*l]+=v*r/c,t[2*l+1]+=m*r/c,t[2*h]-=v*r/_,t[2*h+1]-=m*r/_}}))}))}calAttractive(t,e){const n=this,r=n.nodeMap,i=n.nodeIdxMap,o=n.linkDistance,a=n.edgeStrength,s=n.getMass;e.forEach(((e,n)=>{const u=mh(e,"source"),l=mh(e,"target"),c=r[u],h=r[l],f=h.x-c.x,p=h.y-c.y,d=Math.sqrt(f*f+p*p)+.01,g=f/d,v=p/d,m=((o(e)||1)-d)*a(e),y=i[u],_=i[l],b=s?s(c):1,x=s?s(h):1;t[2*y]-=g*m/b,t[2*y+1]-=v*m/b,t[2*_]+=g*m/x,t[2*_+1]+=v*m/x}))}calGravity(t,e){const n=this,r=n.center,i=n.gravity,o=n.degrees,a=e.length;for(let s=0;s<a;s++){const a=e[s];let u=a.x-r[0],l=a.y-r[1],c=i;if(n.getCenter){const t=n.getCenter(a,o[s]);t&&ph(t[0])&&ph(t[1])&&ph(t[2])&&(u=a.x-t[0],l=a.y-t[1],c=t[2])}c&&(t[2*s]-=c*u,t[2*s+1]-=c*l)}}updateVelocity(t,e,n,r){const i=this,o=n*i.damping;r.forEach(((n,r)=>{let a=t[2*r]*o||.01,s=t[2*r+1]*o||.01;const u=Math.sqrt(a*a+s*s);if(u>i.maxSpeed){const t=i.maxSpeed/u;a*=t,s*=t}e[2*r]=a,e[2*r+1]=s}))}updatePosition(t,e,n){n.forEach(((n,r)=>{if(ph(n.fx)&&ph(n.fy))return n.x=n.fx,void(n.y=n.fy);const i=t[2*r]*e,o=t[2*r+1]*e;n.x+=i,n.y+=o}))}stop(){this.timeInterval&&"undefined"!=typeof window&&window.clearInterval(this.timeInterval)}destroy(){const t=this;t.stop(),t.tick=null,t.nodes=null,t.edges=null,t.destroyed=!0}getType(){return"gForce"}}function Ph(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,o,a,s,u,l,c,h,f,p=t._root,d={data:r},g=t._x0,v=t._y0,m=t._x1,y=t._y1;if(!p)return t._root=d,t;for(;p.length;)if((l=e>=(o=(g+m)/2))?g=o:m=o,(c=n>=(a=(v+y)/2))?v=a:y=a,i=p,!(p=p[h=c<<1|l]))return i[h]=d,t;if(s=+t._x.call(null,p.data),u=+t._y.call(null,p.data),e===s&&n===u)return d.next=p,i?i[h]=d:t._root=d,t;do{i=i?i[h]=new Array(4):t._root=new Array(4),(l=e>=(o=(g+m)/2))?g=o:m=o,(c=n>=(a=(v+y)/2))?v=a:y=a}while((h=c<<1|l)==(f=(u>=a)<<1|s>=o));return i[f]=p,i[h]=d,t}function Ih(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function Oh(t){return t[0]}function Rh(t){return t[1]}function Lh(t,e,n){var r=new Dh(null==e?Oh:e,null==n?Rh:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function Dh(t,e,n,r,i,o){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function Nh(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Bh=Lh.prototype=Dh.prototype;function zh(t){return function(){return t}}function Fh(t){return 1e-6*(t()-.5)}Bh.copy=function(){var t,e,n=new Dh(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=Nh(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=Nh(e));return n},Bh.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Ph(this.cover(e,n),e,n,t)},Bh.addAll=function(t){var e,n,r,i,o=t.length,a=new Array(o),s=new Array(o),u=1/0,l=1/0,c=-1/0,h=-1/0;for(n=0;n<o;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(a[n]=r,s[n]=i,r<u&&(u=r),r>c&&(c=r),i<l&&(l=i),i>h&&(h=i));if(u>c||l>h)return this;for(this.cover(u,l).cover(c,h),n=0;n<o;++n)Ph(this,a[n],s[n],t[n]);return this},Bh.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,o=(r=Math.floor(e))+1;else{for(var a,s,u=i-n||1,l=this._root;n>t||t>=i||r>e||e>=o;)switch(s=(e<r)<<1|t<n,(a=new Array(4))[s]=l,l=a,u*=2,s){case 0:i=n+u,o=r+u;break;case 1:n=i-u,o=r+u;break;case 2:i=n+u,r=o-u;break;case 3:n=i-u,r=o-u}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=r,this._x1=i,this._y1=o,this},Bh.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Bh.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Bh.find=function(t,e,n){var r,i,o,a,s,u,l,c=this._x0,h=this._y0,f=this._x1,p=this._y1,d=[],g=this._root;for(g&&d.push(new Ih(g,c,h,f,p)),null==n?n=1/0:(c=t-n,h=e-n,f=t+n,p=e+n,n*=n);u=d.pop();)if(!(!(g=u.node)||(i=u.x0)>f||(o=u.y0)>p||(a=u.x1)<c||(s=u.y1)<h))if(g.length){var v=(i+a)/2,m=(o+s)/2;d.push(new Ih(g[3],v,m,a,s),new Ih(g[2],i,m,v,s),new Ih(g[1],v,o,a,m),new Ih(g[0],i,o,v,m)),(l=(e>=m)<<1|t>=v)&&(u=d[d.length-1],d[d.length-1]=d[d.length-1-l],d[d.length-1-l]=u)}else{var y=t-+this._x.call(null,g.data),_=e-+this._y.call(null,g.data),b=y*y+_*_;if(b<n){var x=Math.sqrt(n=b);c=t-x,h=e-x,f=t+x,p=e+x,r=g.data}}return r},Bh.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,r,i,o,a,s,u,l,c,h,f,p=this._root,d=this._x0,g=this._y0,v=this._x1,m=this._y1;if(!p)return this;if(p.length)for(;;){if((l=o>=(s=(d+v)/2))?d=s:v=s,(c=a>=(u=(g+m)/2))?g=u:m=u,e=p,!(p=p[h=c<<1|l]))return this;if(!p.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,f=h)}for(;p.data!==t;)if(r=p,!(p=p.next))return this;return(i=p.next)&&delete p.next,r?(i?r.next=i:delete r.next,this):e?(i?e[h]=i:delete e[h],(p=e[0]||e[1]||e[2]||e[3])&&p===(e[3]||e[2]||e[1]||e[0])&&!p.length&&(n?n[f]=p:this._root=p),this):(this._root=i,this)},Bh.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Bh.root=function(){return this._root},Bh.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Bh.visit=function(t){var e,n,r,i,o,a,s=[],u=this._root;for(u&&s.push(new Ih(u,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(u=e.node,r=e.x0,i=e.y0,o=e.x1,a=e.y1)&&u.length){var l=(r+o)/2,c=(i+a)/2;(n=u[3])&&s.push(new Ih(n,l,c,o,a)),(n=u[2])&&s.push(new Ih(n,r,c,l,a)),(n=u[1])&&s.push(new Ih(n,l,i,o,c)),(n=u[0])&&s.push(new Ih(n,r,i,l,c))}return this},Bh.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Ih(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.y0,u=e.x1,l=e.y1,c=(a+u)/2,h=(s+l)/2;(o=i[0])&&n.push(new Ih(o,a,s,c,h)),(o=i[1])&&n.push(new Ih(o,c,s,u,h)),(o=i[2])&&n.push(new Ih(o,a,h,c,l)),(o=i[3])&&n.push(new Ih(o,c,h,u,l))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},Bh.x=function(t){return arguments.length?(this._x=t,this):this._x},Bh.y=function(t){return arguments.length?(this._y=t,this):this._y};var Zh={value:()=>{}};function jh(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new Uh(r)}function Uh(t){this._=t}function Gh(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function Vh(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function Wh(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Zh,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}Uh.prototype=jh.prototype={constructor:Uh,on:function(t,e){var n,r=this._,i=Gh(t+"",r),o=-1,a=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=i[o]).type)r[n]=Wh(r[n],t.name,e);else if(null==e)for(n in r)r[n]=Wh(r[n],t.name,null);return this}for(;++o<a;)if((n=(t=i[o]).type)&&(n=Vh(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Uh(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};const Hh=jh,Xh=4294967296;function Yh(t){return t.x}function qh(t){return t.y}var Kh=Math.PI*(3-Math.sqrt(5));function Qh(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,s=new Map,u=mi(h),l=Hh("tick","end"),c=function(){let t=1;return()=>(t=(1664525*t+1013904223)%Xh)/Xh}();function h(){f(),l.call("tick",e),n<r&&(u.stop(),l.call("end",e))}function f(r){var u,l,c=t.length;void 0===r&&(r=1);for(var h=0;h<r;++h)for(n+=(o-n)*i,s.forEach((function(t){t(n)})),u=0;u<c;++u)null==(l=t[u]).fx?l.x+=l.vx*=a:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=a:(l.y=l.fy,l.vy=0);return e}function p(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var i=10*Math.sqrt(.5+n),o=n*Kh;e.x=i*Math.cos(o),e.y=i*Math.sin(o)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function d(e){return e.initialize&&e.initialize(t,c),e}return null==t&&(t=[]),p(),e={tick:f,restart:function(){return u.restart(h),e},stop:function(){return u.stop(),e},nodes:function(n){return arguments.length?(t=n,p(),s.forEach(d),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(r=+t,e):r},alphaDecay:function(t){return arguments.length?(i=+t,e):+i},alphaTarget:function(t){return arguments.length?(o=+t,e):o},velocityDecay:function(t){return arguments.length?(a=1-t,e):1-a},randomSource:function(t){return arguments.length?(c=t,s.forEach(d),e):c},force:function(t,n){return arguments.length>1?(null==n?s.delete(t):s.set(t,d(n)),e):s.get(t)},find:function(e,n,r){var i,o,a,s,u,l=0,c=t.length;for(null==r?r=1/0:r*=r,l=0;l<c;++l)(a=(i=e-(s=t[l]).x)*i+(o=n-s.y)*o)<r&&(u=s,r=a);return u},on:function(t,n){return arguments.length>1?(l.on(t,n),e):l.on(t)}}}function Jh(){var t,e,n,r,i,o=zh(-30),a=1,s=1/0,u=.81;function l(n){var i,o=t.length,a=Lh(t,Yh,qh).visitAfter(h);for(r=n,i=0;i<o;++i)e=t[i],a.visit(f)}function c(){if(t){var e,n,r=t.length;for(i=new Array(r),e=0;e<r;++e)n=t[e],i[n.index]=+o(n,e,t)}}function h(t){var e,n,r,o,a,s=0,u=0;if(t.length){for(r=o=a=0;a<4;++a)(e=t[a])&&(n=Math.abs(e.value))&&(s+=e.value,u+=n,r+=n*e.x,o+=n*e.y);t.x=r/u,t.y=o/u}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=i[e.data.index]}while(e=e.next)}t.value=s}function f(t,o,l,c){if(!t.value)return!0;var h=t.x-e.x,f=t.y-e.y,p=c-o,d=h*h+f*f;if(p*p/u<d)return d<s&&(0===h&&(d+=(h=Fh(n))*h),0===f&&(d+=(f=Fh(n))*f),d<a&&(d=Math.sqrt(a*d)),e.vx+=h*t.value*r/d,e.vy+=f*t.value*r/d),!0;if(!(t.length||d>=s)){(t.data!==e||t.next)&&(0===h&&(d+=(h=Fh(n))*h),0===f&&(d+=(f=Fh(n))*f),d<a&&(d=Math.sqrt(a*d)));do{t.data!==e&&(p=i[t.data.index]*r/d,e.vx+=h*p,e.vy+=f*p)}while(t=t.next)}}return l.initialize=function(e,r){t=e,n=r,c()},l.strength=function(t){return arguments.length?(o="function"==typeof t?t:zh(+t),c(),l):o},l.distanceMin=function(t){return arguments.length?(a=t*t,l):Math.sqrt(a)},l.distanceMax=function(t){return arguments.length?(s=t*t,l):Math.sqrt(s)},l.theta=function(t){return arguments.length?(u=t*t,l):Math.sqrt(u)},l}function $h(t,e){var n,r=1;function i(){var i,o,a=n.length,s=0,u=0;for(i=0;i<a;++i)s+=(o=n[i]).x,u+=o.y;for(s=(s/a-t)*r,u=(u/a-e)*r,i=0;i<a;++i)(o=n[i]).x-=s,o.y-=u}return null==t&&(t=0),null==e&&(e=0),i.initialize=function(t){n=t},i.x=function(e){return arguments.length?(t=+e,i):t},i.y=function(t){return arguments.length?(e=+t,i):e},i.strength=function(t){return arguments.length?(r=+t,i):r},i}function tf(t){return t.index}function ef(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function nf(t){var e,n,r,i,o,a,s=tf,u=function(t){return 1/Math.min(i[t.source.index],i[t.target.index])},l=zh(30),c=1;function h(r){for(var i=0,s=t.length;i<c;++i)for(var u,l,h,f,p,d,g,v=0;v<s;++v)l=(u=t[v]).source,f=(h=u.target).x+h.vx-l.x-l.vx||Fh(a),p=h.y+h.vy-l.y-l.vy||Fh(a),f*=d=((d=Math.sqrt(f*f+p*p))-n[v])/d*r*e[v],p*=d,h.vx-=f*(g=o[v]),h.vy-=p*g,l.vx+=f*(g=1-g),l.vy+=p*g}function f(){if(r){var a,u,l=r.length,c=t.length,h=new Map(r.map(((t,e)=>[s(t,e,r),t])));for(a=0,i=new Array(l);a<c;++a)(u=t[a]).index=a,"object"!=typeof u.source&&(u.source=ef(h,u.source)),"object"!=typeof u.target&&(u.target=ef(h,u.target)),i[u.source.index]=(i[u.source.index]||0)+1,i[u.target.index]=(i[u.target.index]||0)+1;for(a=0,o=new Array(c);a<c;++a)u=t[a],o[a]=i[u.source.index]/(i[u.source.index]+i[u.target.index]);e=new Array(c),p(),n=new Array(c),d()}}function p(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+u(t[n],n,t)}function d(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+l(t[e],e,t)}return null==t&&(t=[]),h.initialize=function(t,e){r=t,a=e,f()},h.links=function(e){return arguments.length?(t=e,f(),h):t},h.id=function(t){return arguments.length?(s=t,h):s},h.iterations=function(t){return arguments.length?(c=+t,h):c},h.strength=function(t){return arguments.length?(u="function"==typeof t?t:zh(+t),p(),h):u},h.distance=function(t){return arguments.length?(l="function"==typeof t?t:zh(+t),d(),h):l},h}function rf(t){return t.x+t.vx}function of(t){return t.y+t.vy}function af(t){var e,n,r,i=1,o=1;function a(){for(var t,a,u,l,c,h,f,p=e.length,d=0;d<o;++d)for(a=Lh(e,rf,of).visitAfter(s),t=0;t<p;++t)u=e[t],h=n[u.index],f=h*h,l=u.x+u.vx,c=u.y+u.vy,a.visit(g);function g(t,e,n,o,a){var s=t.data,p=t.r,d=h+p;if(!s)return e>l+d||o<l-d||n>c+d||a<c-d;if(s.index>u.index){var g=l-s.x-s.vx,v=c-s.y-s.vy,m=g*g+v*v;m<d*d&&(0===g&&(m+=(g=Fh(r))*g),0===v&&(m+=(v=Fh(r))*v),m=(d-(m=Math.sqrt(m)))/m*i,u.vx+=(g*=m)*(d=(p*=p)/(f+p)),u.vy+=(v*=m)*d,s.vx-=g*(d=1-d),s.vy-=v*d)}}}function s(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function u(){if(e){var r,i,o=e.length;for(n=new Array(o),r=0;r<o;++r)i=e[r],n[i.index]=+t(i,r,e)}}return"function"!=typeof t&&(t=zh(null==t?1:+t)),a.initialize=function(t,n){e=t,r=n,u()},a.iterations=function(t){return arguments.length?(o=+t,a):o},a.strength=function(t){return arguments.length?(i=+t,a):i},a.radius=function(e){return arguments.length?(t="function"==typeof e?e:zh(+e),u(),a):t},a}function sf(t){var e,n,r,i=zh(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vx+=(r[o]-i.x)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=zh(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:zh(+t),a(),o):i},o.x=function(e){return arguments.length?(t="function"==typeof e?e:zh(+e),a(),o):t},o}function uf(t){var e,n,r,i=zh(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vy+=(r[o]-i.y)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=zh(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:zh(+t),a(),o):i},o.y=function(e){return arguments.length?(t="function"==typeof e?e:zh(+e),a(),o):t},o}const lf="GPU_LAYOUT_END";class cf extends ch{constructor(t){super(),this.center=[0,0],this.nodeStrength=null,this.edgeStrength=null,this.preventOverlap=!1,this.clusterNodeStrength=null,this.clusterEdgeStrength=null,this.clusterEdgeDistance=null,this.clusterNodeSize=null,this.clusterFociStrength=null,this.linkDistance=50,this.alphaDecay=.028,this.alphaMin=.001,this.alpha=.3,this.collideStrength=1,this.workerEnabled=!1,this.tick=()=>{},this.onLayoutEnd=()=>{},this.ticking=void 0,t&&this.updateCfg(t)}getDefaultCfg(){return{center:[0,0],nodeStrength:null,edgeStrength:null,preventOverlap:!1,nodeSize:void 0,nodeSpacing:void 0,linkDistance:50,forceSimulation:null,alphaDecay:.028,alphaMin:.001,alpha:.3,collideStrength:1,clustering:!1,clusterNodeStrength:-1,clusterEdgeStrength:.1,clusterEdgeDistance:100,clusterFociStrength:.8,clusterNodeSize:10,tick(){},onLayoutEnd(){},workerEnabled:!1}}init(t){const e=this;e.nodes=t.nodes||[];const n=t.edges||[];e.edges=n.map((t=>{const e={},n=["targetNode","sourceNode","startPoint","endPoint"];return Object.keys(t).forEach((r=>{n.indexOf(r)>-1||(e[r]=t[r])})),e})),e.ticking=!1}execute(t){const e=this,n=e.nodes,r=e.edges;if(e.ticking)return;let i=e.forceSimulation;const o=e.alphaMin,a=e.alphaDecay,s=e.alpha;if(i){if(t)if(e.clustering&&e.clusterForce&&(e.clusterForce.nodes(n),e.clusterForce.links(r)),i.nodes(n),r&&e.edgeForce)e.edgeForce.links(r);else if(r&&!e.edgeForce){const t=nf().id((t=>t.id)).links(r);e.edgeStrength&&t.strength(e.edgeStrength),e.linkDistance&&t.distance(e.linkDistance),e.edgeForce=t,i.force("link",t)}e.preventOverlap&&e.overlapProcess(i),i.alpha(s).restart(),this.ticking=!0}else try{const t=Jh();if(e.nodeStrength&&t.strength(e.nodeStrength),i=Qh().nodes(n),e.clustering){const t=function(){function t(t){return()=>t}let e,n=t=>t.cluster,r=t(1),i=t(-1),o=t(100),a=t(.1),s=[0,0],u=[],l={},c=[],h=100,f=100,p={none:{x:0,y:0}},d=[],g="force",v=!0,m=.1;function y(t){if(!v)return y;e.tick(),b();for(let e,r=0,i=u.length,o=t*m;r<i;++r)e=u[r],e.vx+=(p[n(e)].x-e.x)*o,e.vy+=(p[n(e)].y-e.y)*o}function _(){u&&function(){if(!u||!u.length)return;if(void 0===n(u[0]))throw Error("Couldnt find the grouping attribute for the nodes. Make sure to set it up with forceInABox.groupBy('clusterAttr') before calling .links()");const t=function(){const t=[],e=[],i={};let o=[],a={},s=[];return a=function(t){const e={};return t.forEach((t=>{const r=n(t);e[r]||(e[r]={count:0,sumforceNodeSize:0})})),t.forEach((t=>{const i=n(t),o=r(t),a=e[i];a.count=a.count+1,a.sumforceNodeSize=a.sumforceNodeSize+Math.PI*(o*o)*1.3,e[i]=a})),e}(u),s=function(t){const e={},r=[];return t.forEach((t=>{const r=function(t){const e=mh(t,"source"),r=mh(t,"target"),i=n(l[e]),o=n(l[r]);return i<=o?`${i}~${o}`:`${o}~${i}`}(t);let i=0;void 0!==e[r]&&(i=e[r]),i+=1,e[r]=i})),Object.entries(e).forEach((([t,e])=>{const n=t.split("~")[0],i=t.split("~")[1];void 0!==n&&void 0!==i&&r.push({source:n,target:i,count:e})})),r}(c),o=Object.keys(a),o.forEach(((e,n)=>{const r=a[e];t.push({id:e,size:r.count,r:Math.sqrt(r.sumforceNodeSize/Math.PI)}),i[e]=n})),s.forEach((t=>{const n=mh(t,"source"),r=mh(t,"target"),o=i[n],a=i[r];void 0!==o&&void 0!==a&&e.push({source:o,target:a,count:t.count})})),{nodes:t,links:e}}();e=Qh(t.nodes).force("x",sf(h).strength(.1)).force("y",uf(f).strength(.1)).force("collide",af((t=>t.r)).iterations(4)).force("charge",Jh().strength(i)).force("links",nf(t.nodes.length?t.links:[]).distance(o).strength(a)),d=e.nodes(),b()}()}function b(){return p={none:{x:0,y:0}},d.forEach((t=>{p[t.id]={x:t.x-s[0],y:t.y-s[1]}})),p}function x(t){l={},t.forEach((t=>{l[t.id]=t}))}return y.initialize=t=>{u=t,_()},y.template=function(t){return arguments.length?(g=t,_(),y):g},y.groupBy=function(t){return arguments.length?"string"==typeof t?(n=e=>e[t],y):(n=t,y):n},y.enableGrouping=function(t){return arguments.length?(v=t,y):v},y.strength=function(t){return arguments.length?(m=t,y):m},y.centerX=function(t){return arguments.length?(h=t,y):h},y.centerY=function(t){return arguments.length?(f=t,y):f},y.nodes=function(t){return arguments.length?(x(t||[]),u=t||[],y):u},y.links=function(t){return arguments.length?(c=t||[],_(),y):c},y.forceNodeSize=function(e){return arguments.length?(r="function"==typeof e?e:t(+e),_(),y):r},y.nodeSize=y.forceNodeSize,y.forceCharge=function(e){return arguments.length?(i="function"==typeof e?e:t(+e),_(),y):i},y.forceLinkDistance=function(e){return arguments.length?(o="function"==typeof e?e:t(+e),_(),y):o},y.forceLinkStrength=function(e){return arguments.length?(a="function"==typeof e?e:t(+e),_(),y):a},y.offset=function(t){return arguments.length?(s=t,y):s},y.getFocis=b,y}();t.centerX(e.center[0]).centerY(e.center[1]).template("force").strength(e.clusterFociStrength),r&&t.links(r),n&&t.nodes(n),t.forceLinkDistance(e.clusterEdgeDistance).forceLinkStrength(e.clusterEdgeStrength).forceCharge(e.clusterNodeStrength).forceNodeSize(e.clusterNodeSize),e.clusterForce=t,i.force("group",t)}if(i.force("center",$h(e.center[0],e.center[1])).force("charge",t).alpha(s).alphaDecay(a).alphaMin(o),e.preventOverlap&&e.overlapProcess(i),r){const t=nf().id((t=>t.id)).links(r);e.edgeStrength&&t.strength(e.edgeStrength),e.linkDistance&&t.distance(e.linkDistance),e.edgeForce=t,i.force("link",t)}if(e.workerEnabled&&!hf()&&(e.workerEnabled=!1,console.warn("workerEnabled option is only supported when running in web worker.")),e.workerEnabled){i.stop();const t=function(t){const e=t.alphaMin(),n=t.alphaTarget(),r=t.alpha(),i=Math.log((e-n)/(r-n))/Math.log(1-t.alphaDecay());return Math.ceil(i)}(i);for(let e=1;e<=t;e++)i.tick(),postMessage({nodes:n,currentTick:e,totalTicks:t,type:"LAYOUT_TICK"},void 0);e.ticking=!1}else i.on("tick",(()=>{e.tick()})).on("end",(()=>{e.ticking=!1,e.onLayoutEnd&&e.onLayoutEnd()})),e.ticking=!0;e.forceSimulation=i,e.ticking=!0}catch(t){e.ticking=!1,console.warn(t)}}overlapProcess(t){const e=this,n=e.nodeSize,r=e.nodeSpacing;let i,o;const a=e.collideStrength;if(o=ph(r)?()=>r:Eh(r)?r:()=>0,n)if(Eh(n))i=t=>n(t)+o(t);else if(fh(n)){const t=(n[0]>n[1]?n[0]:n[1])/2;i=e=>t+o(e)}else if(ph(n)){const t=n/2;i=e=>t+o(e)}else i=()=>10;else i=t=>t.size?fh(t.size)?(t.size[0]>t.size[1]?t.size[0]:t.size[1])/2+o(t):gh(t.size)?(t.size.width>t.size.height?t.size.width:t.size.height)/2+o(t):t.size/2+o(t):10+o(t);t.force("collisionForce",af(i).strength(a))}updateCfg(t){const e=this;e.ticking&&(e.forceSimulation.stop(),e.ticking=!1),e.forceSimulation=null,Object.assign(e,t)}destroy(){const t=this;t.ticking&&(t.forceSimulation.stop(),t.ticking=!1),t.nodes=null,t.edges=null,t.destroyed=!0}}function hf(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}function ff(t,e){const n=t.degree,r=e.degree;return n<r?-1:n>r?1:0}class pf extends ch{constructor(t){super(),this.radius=null,this.startRadius=null,this.endRadius=null,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0,this.divisions=1,this.ordering=null,this.angleRatio=1,this.nodes=[],this.edges=[],this.nodeMap={},this.degrees=[],this.width=300,this.height=300,this.updateCfg(t)}getDefaultCfg(){return{radius:null,startRadius:null,endRadius:null,startAngle:0,endAngle:2*Math.PI,clockwise:!0,divisions:1,ordering:null,angleRatio:1}}execute(){const t=this,e=t.nodes,n=t.edges,r=e.length;if(0===r)return void(t.onLayoutEnd&&t.onLayoutEnd());t.width||"undefined"==typeof window||(t.width=window.innerWidth),t.height||"undefined"==typeof window||(t.height=window.innerHeight),t.center||(t.center=[t.width/2,t.height/2]);const i=t.center;if(1===r)return e[0].x=i[0],e[0].y=i[1],void(t.onLayoutEnd&&t.onLayoutEnd());let o=t.radius,a=t.startRadius,s=t.endRadius;const u=t.divisions,l=t.startAngle,c=t.endAngle,h=(c-l)/r,f={};e.forEach(((t,e)=>{f[t.id]=e})),t.nodeMap=f;const p=yh(e.length,f,n);t.degrees=p,o||a||s?!a&&s?a=s:a&&!s&&(s=a):o=t.height>t.width?t.width/2:t.height/2;const d=h*t.angleRatio,g=t.ordering;let v=[];v="topology"===g?t.topologyOrdering():"topology-directed"===g?t.topologyOrdering(!0):"degree"===g?t.degreeOrdering():e;const m=t.clockwise,y=Math.ceil(r/u);for(let t=0;t<r;++t){let e=o;e||null===a||null===s||(e=a+t*(s-a)/(r-1)),e||(e=10+100*t/(r-1));let n=l+t%y*d+2*Math.PI/u*Math.floor(t/y);m||(n=c-t%y*d-2*Math.PI/u*Math.floor(t/y)),v[t].x=i[0]+Math.cos(n)*e,v[t].y=i[1]+Math.sin(n)*e,v[t].weight=p[t]}return t.onLayoutEnd&&t.onLayoutEnd(),{nodes:v,edges:this.edges}}topologyOrdering(t=!1){const e=this,n=e.degrees,r=e.edges,i=e.nodes,o=vh(i),a=e.nodeMap,s=[o[0]],u=[i[0]],l=[],c=i.length;l[0]=!0,function(t,e,n,r){t.forEach(((e,n)=>{t[n].children=[],t[n].parent=[]})),r?e.forEach((e=>{const r=mh(e,"source"),i=mh(e,"target");let o=0;r&&(o=n[r]);let a=0;i&&(a=n[i]);const s=t[o].children,u=t[a].parent;s.push(t[a].id),u.push(t[o].id)})):e.forEach((e=>{const r=mh(e,"source"),i=mh(e,"target");let o=0;r&&(o=n[r]);let a=0;i&&(a=n[i]);const s=t[o].children,u=t[a].children;s.push(t[a].id),u.push(t[o].id)}))}(o,r,a,t);let h=0;return o.forEach(((t,e)=>{if(0!==e)if(e!==c-1&&n[e]===n[e+1]&&!function(t,e,n){const r=n.length;for(let i=0;i<r;i++){const r=mh(n[i],"source"),o=mh(n[i],"target");if(t.id===r&&e.id===o||e.id===r&&t.id===o)return!0}return!1}(s[h],t,r)||l[e]){const t=s[h].children;let r=!1;for(let c=0;c<t.length;c++){const h=a[t[c]];if(n[h]===n[e]&&!l[h]){s.push(o[h]),u.push(i[a[o[h].id]]),l[h]=!0,r=!0;break}}let f=0;for(;!r&&(l[f]||(s.push(o[f]),u.push(i[a[o[f].id]]),l[f]=!0,r=!0),f++,f!==c););}else s.push(t),u.push(i[a[t.id]]),l[e]=!0,h++})),u}degreeOrdering(){const t=this.nodes,e=[],n=this.degrees;return t.forEach(((t,r)=>{t.degree=n[r],e.push(t)})),e.sort(ff),e}getType(){return"circular"}}var df=n(5788);let gf=n.n(df)();gf||"undefined"==typeof window||(gf=window.graphlib),Array.prototype.flat||(Array.prototype.flat=function(t){let e=t||1;if(!isFinite(e))return;const n=this.length;let r=[];if(0===this.length)return this;for(;e--;){const t=[];let i=!1;if(0===r.length){i=!0;for(let t=0;t<n;t++)this[t]instanceof Array?r.push(...this[t]):r.push(this[t])}else{for(let e=0;e<r.length;e++)r[e]instanceof Array?(i=!0,t.push(...r[e])):t.push(r[e]);r=t}if(!i&&e===1/0)break}return r});const vf=gf,mf=t=>{t._prev._next=t._next,t._next._prev=t._prev,delete t._next,delete t._prev},yf=(t,e)=>{if("_next"!==t&&"_prev"!==t)return e},_f=class{constructor(){const t={};t._next=t._prev=t,this.isentinel=t}dequeue(){const t=this.isentinel,e=t._prev;if(e!==t)return mf(e),e}enqueue(){const t=this.isentinel,e=t._prev;if(e!==t)return mf(e),e}toString(){const t=[],e=this.isentinel;let n=e._prev;for(;n!==e;)t.push(JSON.stringify(n,yf)),n=n._prev;return`[${t.join(", ")}]`}},bf=vf.Graph,xf=()=>1,wf=(t,e,n,r,i)=>{var o,a;const s=i?[]:void 0;return null===(o=t.inEdges(r.v))||void 0===o||o.forEach((r=>{const o=t.edge(r),a=t.node(r.v);i&&s.push({v:r.v,w:r.w}),void 0===a.out&&(a.out=0),a.out-=o,Ef(e,n,a)})),null===(a=t.outEdges(r.v))||void 0===a||a.forEach((r=>{const i=t.edge(r),o=r.w,a=t.node(o);void 0===a.in&&(a.in=0),a.in-=i,Ef(e,n,a)})),t.removeNode(r.v),s},Ef=(t,e,n)=>{n.out?n.in?t[n.out-n.in+e].enqueue(n):t[t.length-1].enqueue(n):t[0].enqueue(n)},Sf=(t,e)=>{var n;if(t.nodeCount()<=1)return[];const r=((t,e)=>{const n=new bf;let r=0,i=0;t.nodes().forEach((t=>{n.setNode(t,{v:t,in:0,out:0})})),t.edges().forEach((t=>{const o=n.edge(t.v,t.w)||0,a=null==e?void 0:e(t),s=o+a;n.setEdge(t.v,t.w,s),i=Math.max(i,n.node(t.v).out+=a),r=Math.max(r,n.node(t.w).in+=a)}));const o=[],a=i+r+3;for(let t=0;t<a;t++)o.push(new _f);const s=r+1;return n.nodes().forEach((t=>{Ef(o,s,n.node(t))})),{buckets:o,zeroIdx:s,graph:n}})(t,e||xf);return null===(n=((t,e,n)=>{let r=[];const i=e[e.length-1],o=e[0];let a;for(;t.nodeCount();){for(;a=o.dequeue();)wf(t,e,n,a);for(;a=i.dequeue();)wf(t,e,n,a);if(t.nodeCount())for(let i=e.length-2;i>0;--i)if(a=e[i].dequeue(),a){r=r.concat(wf(t,e,n,a,!0));break}}return r})(r.graph,r.buckets,r.zeroIdx).map((e=>t.outEdges(e.v,e.w))))||void 0===n?void 0:n.flat()},Cf=vf.Graph,Af=(t,e,n,r)=>{let i;do{i=`${r}${Math.random()}`}while(t.hasNode(i));return n.dummy=e,t.setNode(i,n),i},Tf=t=>{const e=(new Cf).setGraph(t.graph());return t.nodes().forEach((n=>{e.setNode(n,t.node(n))})),t.edges().forEach((n=>{const r=e.edge(n.v,n.w)||{weight:0,minlen:1},i=t.edge(n);e.setEdge(n.v,n.w,{weight:r.weight+i.weight,minlen:Math.max(r.minlen,i.minlen)})})),e},kf=(t,e)=>{const n={};return null==t||t.forEach(((t,r)=>{n[t]=e[r]})),n},Mf=t=>{const e=t.nodes().map((e=>t.node(e).rank)),n=Math.min(...e);t.nodes().forEach((e=>{const r=t.node(e);r.hasOwnProperty("rank")&&(r.rank||(r.rank=0),r.rank-=n)}))},Pf=t=>{const e=t.nodes().map((e=>t.node(e).rank)),n=Math.min(...e),r=[];t.nodes().forEach((e=>{var i;const o=((null===(i=t.node(e))||void 0===i?void 0:i.rank)||0)-n;r[o]||(r[o]=[]),r[o].push(e)}));let i=0;const o=t.graph().nodeRankFactor||0;null==r||r.forEach(((e,n)=>{void 0===e&&n%o!=0?--i:i&&(null==e||e.forEach((e=>{t.node(e).rank||(t.node(e).rank=0),t.node(e).rank+=i})))}))},If=t=>{const e=t.nodes().map((e=>{const n=t.node(e).rank;return void 0!==n?n:-1/0}));return Math.max(...e)},Of=(t,e)=>{const n=Date.now();try{return e()}finally{console.log(`${t} time: ${Date.now()-n}ms`)}},Rf=(t,e)=>e(),Lf=(t,e)=>{let n,r=1/0;return null==t||t.forEach((t=>{const i=e(t);r>i&&(r=i,n=t)})),n},Df={addDummyNode:Af,simplify:Tf,asNonCompoundGraph:t=>{const e=new Cf({multigraph:t.isMultigraph()}).setGraph(t.graph());return t.nodes().forEach((n=>{var r;(null===(r=t.children(n))||void 0===r?void 0:r.length)||e.setNode(n,t.node(n))})),t.edges().forEach((n=>e.setEdge(n,t.edge(n)))),e},successorWeights:t=>{const e=t.nodes().map((e=>{var n;const r={};return null===(n=t.outEdges(e))||void 0===n||n.forEach((e=>{r[e.w]=(r[e.w]||0)+t.edge(e).weight})),r}));return kf(t.nodes(),e)},predecessorWeights:t=>{const e=t.nodes().map((e=>{var n;const r={};return null===(n=t.inEdges(e))||void 0===n||n.forEach((e=>{r[e.v]=(r[e.v]||0)+t.edge(e).weight})),r}));return kf(t.nodes(),e)},intersectRect:(t,e)=>{const n=t.x,r=t.y,i=e.x-n,o=e.y-r;let a,s,u=t.width/2,l=t.height/2;return i||o?(Math.abs(o)*u>Math.abs(i)*l?(o<0&&(l=-l),a=l*i/o,s=l):(i<0&&(u=-u),a=u,s=u*o/i),{x:n+a,y:r+s}):{x:0,y:0}},buildLayerMatrix:t=>{const e=[],n=If(t)+1;for(let t=0;t<n;t++)e.push([]);return t.nodes().forEach((n=>{const r=t.node(n),i=r.rank;void 0!==i&&e[i]&&(e[i][r.order||0]=n)})),e},normalizeRanks:Mf,removeEmptyRanks:Pf,addBorderNode:(t,e,n,r)=>{const i={width:0,height:0};return ph(n)&&ph(r)&&(i.rank=n,i.order=r),Af(t,"border",i,e)},maxRank:If,partition:(t,e)=>{const n={lhs:[],rhs:[]};return null==t||t.forEach((t=>{e(t)?n.lhs.push(t):n.rhs.push(t)})),n},time:Of,notime:Rf,zipObject:kf,minBy:Lf},Nf=t=>{t.graph().dummyChains=[],t.edges().forEach((e=>((t,e)=>{var n,r;let i=e.v,o=t.node(i).rank;const a=e.w,s=t.node(a).rank,u=e.name,l=t.edge(e),c=l.labelRank;if(s===o+1)return;let h,f,p;for(t.removeEdge(e),p=0,++o;o<s;++p,++o)l.points=[],f={edgeLabel:l,width:0,height:0,edgeObj:e,rank:o},h=Df.addDummyNode(t,"edge",f,"_d"),o===c&&(f.width=l.width,f.height=l.height,f.dummy="edge-label",f.labelpos=l.labelpos),t.setEdge(i,h,{weight:l.weight},u),0===p&&(t.graph().dummyChains||(t.graph().dummyChains=[]),null===(r=null===(n=t.graph())||void 0===n?void 0:n.dummyChains)||void 0===r||r.push(h)),i=h;t.setEdge(i,a,{weight:l.weight},u)})(t,e)))},Bf=t=>{var e;const n={},r=e=>{var i;const o=t.node(e);if(n.hasOwnProperty(e))return o.rank;n[e]=!0;const a=null===(i=t.outEdges(e))||void 0===i?void 0:i.map((e=>r(e.w)-t.edge(e).minlen||1/0));let s=Math.min(...a);return s!==Number.POSITIVE_INFINITY&&null!=s||(s=0),o.rank=s,s};null===(e=t.sources())||void 0===e||e.forEach((t=>r(t)))},zf=(t,e)=>t.node(e.w).rank-t.node(e.v).rank-t.edge(e).minlen,Ff=vf.Graph,Zf=(t,e)=>{const n=r=>{e.nodeEdges(r).forEach((i=>{const o=i.v,a=r===o?i.w:o;t.hasNode(a)||zf(e,i)||(t.setNode(a,{}),t.setEdge(r,a,{}),n(a))}))};return t.nodes().forEach(n),t.nodeCount()},jf=(t,e)=>{const n=r=>{var i;null===(i=e.nodeEdges(r))||void 0===i||i.forEach((i=>{const o=i.v,a=r===o?i.w:o;t.hasNode(a)||void 0===e.node(a).layer&&zf(e,i)||(t.setNode(a,{}),t.setEdge(r,a,{}),n(a))}))};return t.nodes().forEach(n),t.nodeCount()},Uf=(t,e)=>Lf(e.edges(),(n=>t.hasNode(n.v)!==t.hasNode(n.w)?zf(e,n):1/0)),Gf=(t,e,n)=>{t.nodes().forEach((t=>{e.node(t).rank||(e.node(t).rank=0),e.node(t).rank+=n}))},Vf=vf.alg,{preorder:Wf,postorder:Hf}=Vf,Xf=t=>{t=Tf(t),Bf(t);const e=(t=>{const e=new Ff({directed:!1}),n=t.nodes()[0],r=t.nodeCount();let i,o;for(e.setNode(n,{});Zf(e,t)<r;)i=Uf(e,t),o=e.hasNode(i.v)?zf(t,i):-zf(t,i),Gf(e,t,o);return e})(t);let n,r;for(Qf(e),Yf(e,t);n=$f(e);)r=tp(e,t,n),ep(e,t,n,r)},Yf=(t,e)=>{let n=Hf(t,t.nodes());n=null==n?void 0:n.slice(0,(null==n?void 0:n.length)-1),null==n||n.forEach((n=>{qf(t,e,n)}))},qf=(t,e,n)=>{const r=t.node(n).parent;t.edge(n,r).cutvalue=Kf(t,e,n)},Kf=(t,e,n)=>{var r;const i=t.node(n).parent;let o=!0,a=e.edge(n,i),s=0;return a||(o=!1,a=e.edge(i,n)),s=a.weight,null===(r=e.nodeEdges(n))||void 0===r||r.forEach((r=>{const a=r.v===n,u=a?r.w:r.v;if(u!==i){const i=a===o,l=e.edge(r).weight;if(s+=i?l:-l,rp(t,n,u)){const e=t.edge(n,u).cutvalue;s+=i?-e:e}}})),s},Qf=(t,e)=>{void 0!==e&&(e=t.nodes()[0]),Jf(t,{},1,e)},Jf=(t,e,n,r,i)=>{var o;const a=n;let s=n;const u=t.node(r);return e[r]=!0,null===(o=t.neighbors(r))||void 0===o||o.forEach((n=>{e.hasOwnProperty(n)||(s=Jf(t,e,s,n,r))})),u.low=a,u.lim=s++,i?u.parent=i:delete u.parent,s},$f=t=>t.edges().find((e=>t.edge(e).cutvalue<0)),tp=(t,e,n)=>{let r=n.v,i=n.w;e.hasEdge(r,i)||(r=n.w,i=n.v);const o=t.node(r),a=t.node(i);let s=o,u=!1;o.lim>a.lim&&(s=a,u=!0);const l=e.edges().filter((e=>u===ip(t,t.node(e.v),s)&&u!==ip(t,t.node(e.w),s)));return Lf(l,(t=>zf(e,t)))},ep=(t,e,n,r)=>{const i=n.v,o=n.w;t.removeEdge(i,o),t.setEdge(r.v,r.w,{}),Qf(t),Yf(t,e),np(t,e)},np=(t,e)=>{const n=t.nodes().find((t=>!e.node(t).parent));let r=Wf(t,n);r=null==r?void 0:r.slice(1),null==r||r.forEach((n=>{const r=t.node(n).parent;let i=e.edge(n,r),o=!1;i||(i=e.edge(r,n),o=!0),e.node(n).rank=e.node(r).rank+(o?i.minlen:-i.minlen)}))},rp=(t,e,n)=>t.hasEdge(e,n),ip=(t,e,n)=>n.low<=e.lim&&e.lim<=n.lim;Xf.initLowLimValues=Qf,Xf.initCutValues=Yf,Xf.calcCutValue=Kf,Xf.leaveEdge=$f,Xf.enterEdge=tp,Xf.exchangeEdges=ep;const op=Xf,ap=Bf,sp=t=>{(t=>{var e;const n={};let r=0;const i=e=>{var o;const a=t.node(e);if(n.hasOwnProperty(e))return a.rank;n[e]=!0;const s=null===(o=t.outEdges(e))||void 0===o?void 0:o.map((e=>i(e.w)-t.edge(e).minlen||1/0));let u=Math.min(...s);return u!==Number.POSITIVE_INFINITY&&null!=u||(u=0),a.rank=u,r=Math.min(a.rank,r),a.rank};null===(e=t.sources())||void 0===e||e.forEach((t=>i(t))),r+=1;const o=(e,n)=>{var r;const i=t.node(e),a=isNaN(i.layer)?n:i.layer;(void 0===i.rank||i.rank<a)&&(i.rank=a),null===(r=t.outEdges(e))||void 0===r||r.map((e=>{o(e.w,a+t.edge(e).minlen)}))};t.nodes().forEach((e=>{const n=t.node(e);isNaN(n.layer)?n.rank-=r:o(e,n.layer)}))})(t),(t=>{const e=new Ff({directed:!1}),n=t.nodes()[0],r=t.nodeCount();let i,o;for(e.setNode(n,{});jf(e,t)<r;)i=Uf(e,t),o=e.hasNode(i.v)?zf(t,i):-zf(t,i),Gf(e,t,o)})(t)},up=t=>{switch(t.graph().ranker){case"network-simplex":(t=>{op(t)})(t);break;case"tight-tree":default:sp(t);break;case"longest-path":ap(t)}},lp=t=>{var e;const n=(t=>{var e;const n={};let r=0;const i=e=>{var o;const a=r;null===(o=t.children(e))||void 0===o||o.forEach(i),n[e]={low:a,lim:r++}};return null===(e=t.children())||void 0===e||e.forEach(i),n})(t);null===(e=t.graph().dummyChains)||void 0===e||e.forEach((e=>{var r,i;let o=t.node(e);const a=o.edgeObj;if(!a)return;const s=((t,e,n,r)=>{const i=[],o=[],a=Math.min(e[n].low,e[r].low),s=Math.max(e[n].lim,e[r].lim);let u,l;u=n;do{u=t.parent(u),i.push(u)}while(u&&(e[u].low>a||s>e[u].lim));for(l=u,u=r;(u=t.parent(u))!==l;)o.push(u);return{lca:l,path:i.concat(o.reverse())}})(t,n,a.v,a.w),u=s.path,l=s.lca;let c=0,h=u[c],f=!0;for(;e!==a.w;){if(o=t.node(e),f){for(;(h=u[c])!==l&&t.node(h).maxRank<o.rank;)c++;h===l&&(f=!1)}if(!f){for(;c<u.length-1&&(null===(r=t.node(h=u[c+1]))||void 0===r?void 0:r.minRank)<=o.rank;)c++;h=u[c]}t.setParent(e,h),e=null===(i=t.successors(e))||void 0===i?void 0:i[0]}}))},cp=(t,e,n,r,i,o,a)=>{const s=t.children(a);if(!(null==s?void 0:s.length))return void(a!==e&&t.setEdge(e,a,{weight:0,minlen:n}));const u=Df.addBorderNode(t,"_bt"),l=Df.addBorderNode(t,"_bb"),c=t.node(a);t.setParent(u,a),c.borderTop=u,t.setParent(l,a),c.borderBottom=l,null==s||s.forEach((s=>{cp(t,e,n,r,i,o,s);const c=t.node(s),h=c.borderTop?c.borderTop:s,f=c.borderBottom?c.borderBottom:s,p=c.borderTop?r:2*r,d=h!==f?1:i-o[a]+1;t.setEdge(u,h,{minlen:d,weight:p,nestingEdge:!0}),t.setEdge(f,l,{minlen:d,weight:p,nestingEdge:!0})})),t.parent(a)||t.setEdge(e,u,{weight:0,minlen:i+o[a]})},hp=(t,e,n,r,i,o)=>{const a={rank:o,width:0,height:0,borderType:e},s=i[e][o-1],u=Df.addDummyNode(t,"border",a,n);i[e][o]=u,t.setParent(u,r),s&&t.setEdge(s,u,{weight:1})},fp=t=>{t.nodes().forEach((e=>{pp(t.node(e))})),t.edges().forEach((e=>{pp(t.edge(e))}))},pp=t=>{const e=t.width;t.width=t.height,t.height=e},dp=t=>{t.y=-t.y},gp=t=>{const e=t.x;t.x=t.y,t.y=e},vp=t=>{var e;const n=null===(e=t.graph().rankdir)||void 0===e?void 0:e.toLowerCase();"bt"!==n&&"rl"!==n||(t=>{t.nodes().forEach((e=>{dp(t.node(e))})),t.edges().forEach((e=>{var n;const r=t.edge(e);null===(n=r.points)||void 0===n||n.forEach((t=>dp(t))),r.hasOwnProperty("y")&&dp(r)}))})(t),"lr"!==n&&"rl"!==n||((t=>{t.nodes().forEach((e=>{gp(t.node(e))})),t.edges().forEach((e=>{var n;const r=t.edge(e);null===(n=r.points)||void 0===n||n.forEach((t=>gp(t))),r.hasOwnProperty("x")&&gp(r)}))})(t),fp(t))},mp=t=>{const e={},n=t.nodes().filter((e=>{var n;return!(null===(n=t.children(e))||void 0===n?void 0:n.length)})),r=n.map((e=>t.node(e).rank)),i=Math.max(...r),o=[];for(let t=0;t<i+1;t++)o.push([]);const a=n=>{var r;if(e.hasOwnProperty(n))return;e[n]=!0;const i=t.node(n);isNaN(i.rank)||o[i.rank].push(n),null===(r=t.successors(n))||void 0===r||r.forEach((t=>a(t)))},s=n.sort(((e,n)=>t.node(e).rank-t.node(n).rank)),u=s.filter((e=>void 0!==t.node(e).fixorder)).sort(((e,n)=>t.node(e).fixorder-t.node(n).fixorder));return null==u||u.forEach((n=>{isNaN(t.node(n).rank)||o[t.node(n).rank].push(n),e[n]=!0})),null==s||s.forEach(a),o},yp=(t,e,n)=>{const r=kf(n,n.map(((t,e)=>e))),i=e.map((e=>{var n;const i=null===(n=t.outEdges(e))||void 0===n?void 0:n.map((e=>({pos:r[e.w],weight:t.edge(e).weight})));return null==i?void 0:i.sort(((t,e)=>t.pos-e.pos))})).flat();let o=1;for(;o<n.length;)o<<=1;const a=2*o-1;o-=1;const s=Array(a).fill(0,0,a);let u=0;return null==i||i.forEach((t=>{let e=t.pos+o;s[e]+=t.weight;let n=0;for(;e>0;)e%2&&(n+=s[e+1]),e=e-1>>1,s[e]+=t.weight;u+=t.weight*n})),u},_p=(t,e)=>{let n=0;for(let r=1;r<(null==e?void 0:e.length);++r)n+=yp(t,e[r-1],e[r]);return n},bp=vf.Graph,xp=(t,e,n)=>{const r=(t=>{let e;for(;t.hasNode(e=`_root${Math.random()}`););return e})(t),i=new bp({compound:!0}).setGraph({root:r}).setDefaultNodeLabel((e=>t.node(e)));return t.nodes().forEach((o=>{const a=t.node(o),s=t.parent(o);(a.rank===e||a.minRank<=e&&e<=a.maxRank)&&(i.setNode(o),i.setParent(o,s||r),t[n](o).forEach((e=>{const n=e.v===o?e.w:e.v,r=i.edge(n,o),a=void 0!==r?r.weight:0;i.setEdge(n,o,{weight:t.edge(e).weight+a})})),a.hasOwnProperty("minRank")&&i.setNode(o,{borderLeft:a.borderLeft[e],borderRight:a.borderRight[e]}))})),i},wp=(t,e)=>{var n;let r=0,i=0;t.weight&&(r+=t.barycenter*t.weight,i+=t.weight),e.weight&&(r+=e.barycenter*e.weight,i+=e.weight),t.vs=null===(n=e.vs)||void 0===n?void 0:n.concat(t.vs),t.barycenter=r/i,t.weight=i,t.i=Math.min(e.i,t.i),e.merged=!0},Ep=(t,e)=>{var n,r,i;const o={};null==t||t.forEach(((t,e)=>{const n=o[t.v]={i:e,indegree:0,in:[],out:[],vs:[t.v]};void 0!==t.barycenter&&(n.barycenter=t.barycenter,n.weight=t.weight)})),null===(n=e.edges())||void 0===n||n.forEach((t=>{const e=o[t.v],n=o[t.w];void 0!==e&&void 0!==n&&(n.indegree++,e.out.push(o[t.w]))}));return(t=>{var e,n;const r=[];for(;null==t?void 0:t.length;){const i=t.pop();r.push(i),null===(e=i.in.reverse())||void 0===e||e.forEach((t=>{return e=i,t=>{t.merged||(void 0!==t.barycenter||void 0!==e.barycenter||t.barycenter>=e.barycenter)&&wp(e,t)};var e})),null===(n=i.out)||void 0===n||n.forEach((e=>{return n=i,e=>{e.in.push(n),0==--e.indegree&&t.push(e)};var n}))}const i=r.filter((t=>!t.merged)),o=["vs","i","barycenter","weight"];return i.map((t=>{const e={};return null==o||o.forEach((n=>{void 0!==t[n]&&(e[n]=t[n])})),e}))})(null===(i=(r=Object.values(o)).filter)||void 0===i?void 0:i.call(r,(t=>!t.indegree)))},Sp=(t,e,n)=>{let r,i=n;for(;e.length&&(r=e[e.length-1]).i<=i;)e.pop(),null==t||t.push(r.vs),i++;return i},Cp=(t,e,n,r,i)=>{var o,a,s,u;let l=t.children(e);const c=t.node(e),h=c?c.borderLeft:void 0,f=c?c.borderRight:void 0,p={};h&&(l=null==l?void 0:l.filter((t=>t!==h&&t!==f)));const d=((t,e)=>e.map((e=>{const n=t.inEdges(e);if(!(null==n?void 0:n.length))return{v:e};{const r={sum:0,weight:0};return null==n||n.forEach((e=>{const n=t.edge(e),i=t.node(e.v);r.sum+=n.weight*i.order,r.weight+=n.weight})),{v:e,barycenter:r.sum/r.weight,weight:r.weight}}})))(t,l||[]);null==d||d.forEach((e=>{var i;if(null===(i=t.children(e.v))||void 0===i?void 0:i.length){const i=Cp(t,e.v,n,r);p[e.v]=i,i.hasOwnProperty("barycenter")&&Tp(e,i)}}));const g=Ep(d,n);Ap(g,p),null===(o=g.filter((t=>{var e;return!!t.vs||(null===(e=t.vs)||void 0===e?void 0:e.length)>0})))||void 0===o||o.forEach((e=>{const n=t.node(e.vs[0]);e.fixorder=n.fixorder,e.order=n.order}));const v=((t,e,n)=>{const r=Df.partition(t,(t=>t.hasOwnProperty("fixorder")&&!isNaN(t.fixorder)||t.hasOwnProperty("barycenter"))),i=r.lhs,o=r.rhs.sort(((t,e)=>-t.i- -e.i)),a=[];let s=0,u=0,l=0;null==i||i.sort(((t,e)=>(n,r)=>{if(void 0!==n.fixorder&&void 0!==r.fixorder)return n.fixorder-r.fixorder;if(n.barycenter<r.barycenter)return-1;if(n.barycenter>r.barycenter)return 1;if(e&&void 0!==n.order&&void 0!==r.order){if(n.order<r.order)return-1;if(n.order>r.order)return 1}return t?r.i-n.i:n.i-r.i})(!!e,!!n)),l=Sp(a,o,l),null==i||i.forEach((t=>{var e;l+=null===(e=t.vs)||void 0===e?void 0:e.length,a.push(t.vs),s+=t.barycenter*t.weight,u+=t.weight,l=Sp(a,o,l)}));const c={vs:a.flat()};return u&&(c.barycenter=s/u,c.weight=u),c})(g,r,i);if(h&&(v.vs=[h,v.vs,f].flat(),null===(a=t.predecessors(h))||void 0===a?void 0:a.length)){const e=t.node((null===(s=t.predecessors(h))||void 0===s?void 0:s[0])||{}),n=t.node((null===(u=t.predecessors(f))||void 0===u?void 0:u[0])||{});v.hasOwnProperty("barycenter")||(v.barycenter=0,v.weight=0),v.barycenter=(v.barycenter*v.weight+e.order+n.order)/(v.weight+2),v.weight+=2}return v},Ap=(t,e)=>{null==t||t.forEach((t=>{var n;const r=null===(n=t.vs)||void 0===n?void 0:n.map((t=>e[t]?e[t].vs:t));t.vs=r.flat()}))},Tp=(t,e)=>{void 0!==t.barycenter?(t.barycenter=(t.barycenter*t.weight+e.barycenter*e.weight)/(t.weight+e.weight),t.weight+=e.weight):(t.barycenter=e.barycenter,t.weight=e.weight)},kp=Cp,Mp=vf.Graph,Pp=(t,e,n)=>e.map((e=>xp(t,e,n))),Ip=(t,e,n)=>{const r=new Mp;null==t||t.forEach((t=>{var i;const o=t.graph().root,a=kp(t,o,r,e,n);null===(i=a.vs)||void 0===i||i.forEach(((e,n)=>{t.node(e).order=n})),((t,e,n)=>{const r={};let i;null==n||n.forEach((n=>{let o,a,s=t.parent(n);for(;s;){if(o=t.parent(s),o?(a=r[o],r[o]=s):(a=i,i=s),a&&a!==s)return void e.setEdge(a,s);s=o}}))})(t,r,a.vs)}))},Op=(t,e)=>{null==e||e.forEach((e=>{null==e||e.forEach(((e,n)=>{t.node(e).order=n}))}))},Rp=vf.Graph,Lp=(t,e)=>{var n;if(t.node(e).dummy)return null===(n=t.predecessors(e))||void 0===n?void 0:n.find((e=>t.node(e).dummy))},Dp=(t,e,n)=>{let r=e,i=n;if(r>i){const t=r;r=i,i=t}let o=t[r];o||(t[r]=o={}),o[i]=!0},Np=(t,e,n)=>{let r=e,i=n;return r>i&&(r=i,i=e),t[r]&&t[r].hasOwnProperty(i)},Bp=(t,e,n,r)=>{const i=new Rp,o=t.graph(),a=zp(o.nodesep,o.edgesep,r);return null==e||e.forEach((e=>{let r;null==e||e.forEach((e=>{const o=n[e];if(i.setNode(o),r){const s=n[r],u=i.edge(s,o);i.setEdge(s,o,Math.max(a(t,e,r),u||0))}r=e}))})),i};const zp=(t,e,n)=>(r,i,o)=>{const a=r.node(i),s=r.node(o);let u,l=0;if(l+=a.width/2,a.hasOwnProperty("labelpos"))switch((a.labelpos||"").toLowerCase()){case"l":u=-a.width/2;break;case"r":u=a.width/2}if(u&&(l+=n?u:-u),u=0,l+=(a.dummy?e:t)/2,l+=(s.dummy?e:t)/2,l+=s.width/2,s.hasOwnProperty("labelpos"))switch((s.labelpos||"").toLowerCase()){case"l":u=s.width/2;break;case"r":u=-s.width/2}return u&&(l+=n?u:-u),u=0,l},Fp=(t,e)=>{var n;return(null===(n=t.node(e))||void 0===n?void 0:n.width)||0},Zp=t=>{var e;(t=>{const e=Df.buildLayerMatrix(t),n=t.graph().ranksep;let r=0;null==e||e.forEach((e=>{const i=e.map((e=>t.node(e).height)),o=Math.max(...i);null==e||e.forEach((e=>{t.node(e).y=r+o/2})),r+=o+n}))})(t=Df.asNonCompoundGraph(t));const n=(t=>{const e=Df.buildLayerMatrix(t),n=Object.assign(((t,e)=>{const n={};return(null==e?void 0:e.length)&&e.reduce(((e,r)=>{let i=0,o=0;const a=e.length,s=null==r?void 0:r[(null==r?void 0:r.length)-1];return null==r||r.forEach(((e,u)=>{var l;const c=Lp(t,e),h=c?t.node(c).order:a;(c||e===s)&&(null===(l=r.slice(o,u+1))||void 0===l||l.forEach((e=>{var r;null===(r=t.predecessors(e))||void 0===r||r.forEach((r=>{const o=t.node(r),a=o.order;!(a<i||h<a)||o.dummy&&t.node(e).dummy||Dp(n,r,e)}))})),o=u+1,i=h)})),r})),n})(t,e),((t,e)=>{const n={},r=(e,r,i,o,a)=>{let s;const u=[];for(let t=r;t<i;t++)u.push(t);u.forEach((r=>{var i;s=e[r],t.node(s).dummy&&(null===(i=t.predecessors(s))||void 0===i||i.forEach((e=>{const r=t.node(e);r.dummy&&(r.order<o||r.order>a)&&Dp(n,e,s)})))}))};return(null==e?void 0:e.length)&&e.reduce(((e,n)=>{let i,o=-1,a=0;return null==n||n.forEach(((s,u)=>{if("border"===t.node(s).dummy){const e=t.predecessors(s)||[];e.length&&(i=t.node(e[0]).order,r(n,a,u,o,i),a=u,o=i)}r(n,a,n.length,i,e.length)})),n})),n})(t,e)),r={};let i;["u","d"].forEach((o=>{i="u"===o?e:Object.values(e).reverse(),["l","r"].forEach((e=>{"r"===e&&(i=i.map((t=>Object.values(t).reverse())));const a=("u"===o?t.predecessors:t.successors).bind(t),s=((t,e,n,r)=>{const i={},o={},a={};return null==e||e.forEach((t=>{null==t||t.forEach(((t,e)=>{i[t]=t,o[t]=t,a[t]=e}))})),null==e||e.forEach((t=>{let e=-1;null==t||t.forEach((t=>{let s=r(t);if(s.length){s=s.sort(((t,e)=>a[t]-a[e]));const r=(s.length-1)/2;for(let u=Math.floor(r),l=Math.ceil(r);u<=l;++u){const r=s[u];o[t]===t&&e<a[r]&&!Np(n,t,r)&&(o[r]=t,o[t]=i[t]=i[r],e=a[r])}}}))})),{root:i,align:o}})(0,i,n,a),u=((t,e,n,r,i)=>{var o;const a={},s=Bp(t,e,n,i),u=i?"borderLeft":"borderRight",l=(t,e)=>{let n=s.nodes(),r=n.pop();const i={};for(;r;)i[r]?t(r):(i[r]=!0,n.push(r),n=n.concat(e(r))),r=n.pop()};return l((t=>{a[t]=(s.inEdges(t)||[]).reduce(((t,e)=>Math.max(t,(a[e.v]||0)+s.edge(e))),0)}),s.predecessors.bind(s)),l((e=>{const n=(s.outEdges(e)||[]).reduce(((t,e)=>Math.min(t,(a[e.w]||0)-s.edge(e))),Number.POSITIVE_INFINITY),r=t.node(e);n!==Number.POSITIVE_INFINITY&&r.borderType!==u&&(a[e]=Math.max(a[e],n))}),s.successors.bind(s)),null===(o=Object.values(r))||void 0===o||o.forEach((t=>{a[t]=a[n[t]]})),a})(t,i,s.root,s.align,"r"===e);"r"===e&&Object.keys(u).forEach((t=>u[t]=-u[t])),r[o+e]=u}))}));const o=((t,e)=>Df.minBy(Object.values(e),(e=>{var n;let r=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;return null===(n=Object.keys(e))||void 0===n||n.forEach((n=>{const o=e[n],a=Fp(t,n)/2;r=Math.max(o+a,r),i=Math.min(o-a,i)})),r-i})))(t,r);return o&&function(t,e){const n=Object.values(e),r=Math.min(...n),i=Math.max(...n);["u","d"].forEach((n=>{["l","r"].forEach((o=>{const a=n+o,s=t[a];let u;if(s===e)return;const l=Object.values(s);u="l"===o?r-Math.min(...l):i-Math.max(...l),u&&(t[a]={},Object.keys(s).forEach((e=>{t[a][e]=s[e]+u})))}))}))}(r,o),((t,e)=>{const n={};return Object.keys(t.ul).forEach((r=>{if(e)n[r]=t[e.toLowerCase()][r];else{const e=Object.values(t).map((t=>t[r])).sort(((t,e)=>t-e));n[r]=(e[1]+e[2])/2}})),n})(r,t.graph().align)})(t);null===(e=Object.keys(n))||void 0===e||e.forEach((e=>{t.node(e).x=n[e]}))},jp=vf.Graph,Up=(t,e,n)=>{e("    removeSelfEdges",(()=>{od(t)})),e("    acyclic",(()=>{(t=>{const e="greedy"===t.graph().acyclicer?Sf(t,(t=>e=>t.edge(e).weight)(t)):(t=>{const e=[],n={},r={},i=o=>{var a;r.hasOwnProperty(o)||(r[o]=!0,n[o]=!0,null===(a=t.outEdges(o))||void 0===a||a.forEach((t=>{n.hasOwnProperty(t.w)?e.push(t):i(t.w)})),delete n[o])};return t.nodes().forEach(i),e})(t);null==e||e.forEach((e=>{const n=t.edge(e);t.removeEdge(e),n.forwardName=e.name,n.reversed=!0,t.setEdge(e.w,e.v,n,`rev-${Math.random()}`)}))})(t)})),e("    nestingGraph.run",(()=>{(t=>{var e;const n=Df.addDummyNode(t,"root",{},"_root"),r=(t=>{var e;const n={},r=(e,i)=>{const o=t.children(e);null==o||o.forEach((t=>r(t,i+1))),n[e]=i};return null===(e=t.children())||void 0===e||e.forEach((t=>r(t,1))),n})(t),i=Math.max(...Object.values(r))-1,o=2*i+1;t.graph().nestingRoot=n,t.edges().forEach((e=>{t.edge(e).minlen*=o}));const a=(t=>{let e=0;return t.edges().forEach((n=>{e+=t.edge(n).weight})),e})(t)+1;null===(e=t.children())||void 0===e||e.forEach((e=>{cp(t,n,o,a,i,r,e)})),t.graph().nodeRankFactor=o})(t)})),e("    rank",(()=>{up(Df.asNonCompoundGraph(t))})),e("    injectEdgeLabelProxies",(()=>{Qp(t)})),e("    removeEmptyRanks",(()=>{Pf(t)})),e("    nestingGraph.cleanup",(()=>{(t=>{const e=t.graph();e.nestingRoot&&t.removeNode(e.nestingRoot),delete e.nestingRoot,t.edges().forEach((e=>{t.edge(e).nestingEdge&&t.removeEdge(e)}))})(t)})),e("    normalizeRanks",(()=>{Mf(t)})),e("    assignRankMinMax",(()=>{Jp(t)})),e("    removeEdgeLabelProxies",(()=>{$p(t)})),e("    normalize.run",(()=>{Nf(t)})),e("    parentDummyChains",(()=>{lp(t)})),e("    addBorderSegments",(()=>{(t=>{var e;const n=e=>{const r=t.children(e),i=t.node(e);if((null==r?void 0:r.length)&&r.forEach((t=>n(t))),i.hasOwnProperty("minRank")){i.borderLeft=[],i.borderRight=[];for(let n=i.minRank,r=i.maxRank+1;n<r;++n)hp(t,"borderLeft","_bl",e,i,n),hp(t,"borderRight","_br",e,i,n)}};null===(e=t.children())||void 0===e||e.forEach((t=>n(t)))})(t)})),n&&n.keepNodeOrder&&e("    initDataOrder",(()=>{((t,e)=>{const n=t.nodes().filter((e=>{var n;return!(null===(n=t.children(e))||void 0===n?void 0:n.length)})).map((e=>t.node(e).rank)),r=Math.max(...n),i=[];for(let t=0;t<r+1;t++)i.push([]);null==e||e.forEach((e=>{const n=t.node(e);n&&!n.dummy&&(isNaN(n.rank)||(n.fixorder=i[n.rank].length,i[n.rank].push(e)))}))})(t,n.nodeOrder)})),e("    order",(()=>{(t=>{const e=Df.maxRank(t),n=[],r=[];for(let t=1;t<e+1;t++)n.push(t);for(let t=e-1;t>-1;t--)r.push(t);const i=Pp(t,n,"inEdges"),o=Pp(t,r,"outEdges");let a=mp(t);Op(t,a);let s,u=Number.POSITIVE_INFINITY;for(let e=0,n=0;n<4;++e,++n){Ip(e%2?i:o,e%4>=2),a=Df.buildLayerMatrix(t);const r=_p(t,a);r<u&&(n=0,s=vh(a),u=r)}a=mp(t),Op(t,a);for(let e=0,n=0;n<4;++e,++n){Ip(e%2?i:o,e%4>=2,!0),a=Df.buildLayerMatrix(t);const r=_p(t,a);r<u&&(n=0,s=vh(a),u=r)}Op(t,s)})(t)})),e("    insertSelfEdges",(()=>{ad(t)})),e("    adjustCoordinateSystem",(()=>{(t=>{var e;const n=null===(e=t.graph().rankdir)||void 0===e?void 0:e.toLowerCase();"lr"!==n&&"rl"!==n||fp(t)})(t)})),e("    position",(()=>{Zp(t)})),e("    positionSelfEdges",(()=>{sd(t)})),e("    removeBorderNodes",(()=>{id(t)})),e("    normalize.undo",(()=>{(t=>{var e;null===(e=t.graph().dummyChains)||void 0===e||e.forEach((e=>{var n;let r=t.node(e);const i=r.edgeLabel;let o;r.edgeObj&&t.setEdge(r.edgeObj,i);let a=e;for(;r.dummy;)o=null===(n=t.successors(a))||void 0===n?void 0:n[0],t.removeNode(a),i.points.push({x:r.x,y:r.y}),"edge-label"===r.dummy&&(i.x=r.x,i.y=r.y,i.width=r.width,i.height=r.height),a=o,r=t.node(a)}))})(t)})),e("    fixupEdgeLabelCoords",(()=>{nd(t)})),e("    undoCoordinateSystem",(()=>{vp(t)})),e("    translateGraph",(()=>{td(t)})),e("    assignNodeIntersects",(()=>{ed(t)})),e("    reversePoints",(()=>{rd(t)})),e("    acyclic.undo",(()=>{(t=>{t.edges().forEach((e=>{const n=t.edge(e);if(n.reversed){t.removeEdge(e);const r=n.forwardName;delete n.reversed,delete n.forwardName,t.setEdge(e.w,e.v,n,r)}}))})(t)}))},Gp=["nodesep","edgesep","ranksep","marginx","marginy"],Vp={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},Wp=["acyclicer","ranker","rankdir","align"],Hp=["width","height","layer","fixorder"],Xp={width:0,height:0},Yp=["minlen","weight","width","height","labeloffset"],qp={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},Kp=["labelpos"],Qp=t=>{t.edges().forEach((e=>{const n=t.edge(e);if(n.width&&n.height){const n=t.node(e.v),r={e,rank:(t.node(e.w).rank-n.rank)/2+n.rank};Df.addDummyNode(t,"edge-proxy",r,"_ep")}}))},Jp=t=>{let e=0;t.nodes().forEach((n=>{const r=t.node(n);r.borderTop&&(r.minRank=t.node(r.borderTop).rank,r.maxRank=t.node(r.borderBottom).rank,e=Math.max(e,r.maxRank||-1/0))})),t.graph().maxRank=e},$p=t=>{t.nodes().forEach((e=>{const n=t.node(e);"edge-proxy"===n.dummy&&(t.edge(n.e).labelRank=n.rank,t.removeNode(e))}))},td=t=>{let e=Number.POSITIVE_INFINITY,n=0,r=Number.POSITIVE_INFINITY,i=0;const o=t.graph(),a=o.marginx||0,s=o.marginy||0,u=t=>{const o=t.x,a=t.y,s=t.width,u=t.height;e=Math.min(e,o-s/2),n=Math.max(n,o+s/2),r=Math.min(r,a-u/2),i=Math.max(i,a+u/2)};t.nodes().forEach((e=>{u(t.node(e))})),t.edges().forEach((e=>{const n=t.edge(e);n.hasOwnProperty("x")&&u(n)})),e-=a,r-=s,t.nodes().forEach((n=>{const i=t.node(n);i.x-=e,i.y-=r})),t.edges().forEach((n=>{var i;const o=t.edge(n);null===(i=o.points)||void 0===i||i.forEach((t=>{t.x-=e,t.y-=r})),o.hasOwnProperty("x")&&(o.x-=e),o.hasOwnProperty("y")&&(o.y-=r)})),o.width=n-e+a,o.height=i-r+s},ed=t=>{t.edges().forEach((e=>{const n=t.edge(e),r=t.node(e.v),i=t.node(e.w);let o,a;n.points?(o=n.points[0],a=n.points[n.points.length-1]):(n.points=[],o=i,a=r),n.points.unshift(Df.intersectRect(r,o)),n.points.push(Df.intersectRect(i,a))}))},nd=t=>{t.edges().forEach((e=>{const n=t.edge(e);if(n.hasOwnProperty("x"))switch("l"!==n.labelpos&&"r"!==n.labelpos||(n.width-=n.labeloffset),n.labelpos){case"l":n.x-=n.width/2+n.labeloffset;break;case"r":n.x+=n.width/2+n.labeloffset}}))},rd=t=>{t.edges().forEach((e=>{const n=t.edge(e);n.reversed&&n.points.reverse()}))},id=t=>{t.nodes().forEach((e=>{var n,r,i;if(null===(n=t.children(e))||void 0===n?void 0:n.length){const n=t.node(e),o=t.node(n.borderTop),a=t.node(n.borderBottom),s=t.node(n.borderLeft[(null===(r=n.borderLeft)||void 0===r?void 0:r.length)-1]),u=t.node(n.borderRight[(null===(i=n.borderRight)||void 0===i?void 0:i.length)-1]);n.width=Math.abs(u.x-s.x),n.height=Math.abs(a.y-o.y),n.x=s.x+n.width/2,n.y=o.y+n.height/2}})),t.nodes().forEach((e=>{"border"===t.node(e).dummy&&t.removeNode(e)}))},od=t=>{t.edges().forEach((e=>{if(e.v===e.w){const n=t.node(e.v);n.selfEdges||(n.selfEdges=[]),n.selfEdges.push({e,label:t.edge(e)}),t.removeEdge(e)}}))},ad=t=>{const e=Df.buildLayerMatrix(t);null==e||e.forEach((e=>{let n=0;null==e||e.forEach(((e,r)=>{var i;const o=t.node(e);o.order=r+n,null===(i=o.selfEdges)||void 0===i||i.forEach((e=>{Df.addDummyNode(t,"selfedge",{width:e.label.width,height:e.label.height,rank:o.rank,order:r+ ++n,e:e.e,label:e.label},"_se")})),delete o.selfEdges}))}))},sd=t=>{t.nodes().forEach((e=>{const n=t.node(e);if("selfedge"===n.dummy){const r=t.node(n.e.v),i=r.x+r.width/2,o=r.y,a=n.x-i,s=r.height/2;t.setEdge(n.e,n.label),t.removeNode(e),n.label.points=[{x:i+2*a/3,y:o-s},{x:i+5*a/6,y:o-s},{y:o,x:i+a},{x:i+5*a/6,y:o+s},{x:i+2*a/3,y:o+s}],n.label.x=n.x,n.label.y=n.y}}))},ud=(t,e)=>{const n={};return null==e||e.forEach((e=>{void 0!==t[e]&&(n[e]=+t[e])})),n},ld=t=>{const e={};return Object.keys(t).forEach((n=>{const r=t[n];e[n.toLowerCase()]=r})),e},cd={graphlib:vf,layout:(t,e)=>{const n=e&&e.debugTiming?Df.time:Df.notime;n("layout",(()=>{e&&!e.keepNodeOrder&&e.prevGraph&&n("  inheritOrder",(()=>{((t,e)=>{const n=e._nodes||{};t.nodes().forEach((e=>{const r=t.node(e);void 0!==n[e]?(r.fixorder=n[e]._order,delete n[e]._order):delete r.fixorder}))})(t,e.prevGraph)}));const r=n("  buildLayoutGraph",(()=>(t=>{const e=new jp({multigraph:!0,compound:!0}),n=ld(t.graph()),r={};return null==Wp||Wp.forEach((t=>{void 0!==n[t]&&(r[t]=n[t])})),e.setGraph(Object.assign({},Vp,ud(n,Gp),r)),t.nodes().forEach((n=>{const r=ld(t.node(n)),i=ud(r,Hp);Object.keys(Xp).forEach((t=>{void 0===i[t]&&(i[t]=Xp[t])})),e.setNode(n,i),e.setParent(n,t.parent(n))})),t.edges().forEach((n=>{const r=ld(t.edge(n)),i={};null==Kp||Kp.forEach((t=>{void 0!==r[t]&&(i[t]=r[t])})),e.setEdge(n,Object.assign({},qp,ud(r,Yp),i))})),e})(t)));e&&!1===e.edgeLabelSpace||n("  makeSpaceForEdgeLabels",(()=>{(t=>{const e=t.graph();e.ranksep||(e.ranksep=0),e.ranksep/=2,t.nodes().forEach((e=>{const n=t.node(e);isNaN(n.layer)||(n.layer?n.layer*=2:n.layer=0)})),t.edges().forEach((n=>{var r;const i=t.edge(n);i.minlen*=2,"c"!==(null===(r=i.labelpos)||void 0===r?void 0:r.toLowerCase())&&("TB"===e.rankdir||"BT"===e.rankdir?i.width+=i.labeloffset:i.height+=i.labeloffset)}))})(r)}));try{n("  runLayout",(()=>{Up(r,n,e)}))}catch(t){if("Not possible to find intersection inside of the rectangle"===t.message)return void console.error("The following error may be caused by improper layer setting, please make sure your manual layer setting does not violate the graph's structure:\n",t);throw t}n("  updateInputGraph",(()=>{((t,e)=>{t.nodes().forEach((n=>{var r;const i=t.node(n),o=e.node(n);i&&(i.x=o.x,i.y=o.y,i._order=o.order,i._rank=o.rank,(null===(r=e.children(n))||void 0===r?void 0:r.length)&&(i.width=o.width,i.height=o.height))})),t.edges().forEach((n=>{const r=t.edge(n),i=e.edge(n);r.points=i.points,i.hasOwnProperty("x")&&(r.x=i.x,r.y=i.y)})),t.graph().width=e.graph().width,t.graph().height=e.graph().height})(t,r)}))}))},util:{time:Of,notime:Rf}};class hd extends ch{constructor(t){super(),this.rankdir="TB",this.nodesep=50,this.ranksep=50,this.controlPoints=!1,this.sortByCombo=!1,this.edgeLabelSpace=!0,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.layoutNode=t=>{const{nodes:e}=this,n=e.find((e=>e.id===t));return!n||!1!==n.layout},this.updateCfg(t)}getDefaultCfg(){return{rankdir:"TB",align:void 0,nodeSize:void 0,nodesepFunc:void 0,ranksepFunc:void 0,nodesep:50,ranksep:50,controlPoints:!1}}execute(){const t=this,{nodes:e,nodeSize:n,rankdir:r,combos:i,begin:o}=t;if(!e)return;const a=t.edges||[],s=new cd.graphlib.Graph({multigraph:!0,compound:!0});let u;u=n?fh(n)?()=>n:()=>[n,n]:t=>t.size?fh(t.size)?t.size:gh(t.size)?[t.size.width||40,t.size.height||40]:[t.size,t.size]:[40,40];let l=fd(t.nodesepFunc,t.nodesep,50),c=fd(t.ranksepFunc,t.ranksep,50);"LR"!==r&&"RL"!==r||(l=fd(t.ranksepFunc,t.ranksep,50),c=fd(t.nodesepFunc,t.nodesep,50)),s.setDefaultEdgeLabel((()=>({}))),s.setGraph(t);const h={};let f;e.filter((t=>!1!==t.layout)).forEach((t=>{const e=u(t),n=c(t),r=l(t),i=e[0]+2*r,o=e[1]+2*n,a=t.layer;ph(a)?s.setNode(t.id,{width:i,height:o,layer:a}):s.setNode(t.id,{width:i,height:o}),this.sortByCombo&&t.comboId&&(h[t.comboId]||(h[t.comboId]=!0,s.setNode(t.comboId,{})),s.setParent(t.id,t.comboId))})),this.sortByCombo&&i&&i.forEach((t=>{t.parentId&&(h[t.parentId]||(h[t.parentId]=!0,s.setNode(t.parentId,{})),s.setParent(t.id,t.parentId))})),a.forEach((t=>{const e=mh(t,"source"),n=mh(t,"target");this.layoutNode(e)&&this.layoutNode(n)&&s.setEdge(e,n,{weight:t.weight||1})})),t.preset&&(f=new cd.graphlib.Graph({multigraph:!0,compound:!0}),t.preset.nodes.forEach((t=>{null==f||f.setNode(t.id,t)}))),cd.layout(s,{prevGraph:f,edgeLabelSpace:t.edgeLabelSpace,keepNodeOrder:Boolean(!!t.nodeOrder),nodeOrder:t.nodeOrder});const p=[0,0];if(o){let t=1/0,e=1/0;s.nodes().forEach((n=>{const r=s.node(n);t>r.x&&(t=r.x),e>r.y&&(e=r.y)})),s.edges().forEach((n=>{s.edge(n).points.forEach((n=>{t>n.x&&(t=n.x),e>n.y&&(e=n.y)}))})),p[0]=o[0]-t,p[1]=o[1]-e}return s.nodes().forEach((t=>{const n=s.node(t),r=e.findIndex((e=>e.id===t));e[r]&&(e[r].x=n.x+p[0],e[r].y=n.y+p[1],e[r]._order=n._order)})),s.edges().forEach((e=>{const n=s.edge(e),r=a.findIndex((t=>{const n=mh(t,"source"),r=mh(t,"target");return n===e.v&&r===e.w}));t.edgeLabelSpace&&t.controlPoints&&"loop"!==a[r].type&&(a[r].controlPoints=n.points.slice(1,n.points.length-1),a[r].controlPoints.forEach((t=>{t.x+=p[0],t.y+=p[1]})))})),t.onLayoutEnd&&t.onLayoutEnd(),{nodes:e,edges:a}}getType(){return"dagre"}}function fd(t,e,n){let r;return r=t||(ph(e)?()=>e:()=>n),r}const pd=Object.prototype.toString;function dd(t){return pd.call(t).endsWith("Array]")}const gd=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!dd(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var n=e.fromIndex,r=void 0===n?0:n,i=e.toIndex,o=void 0===i?t.length:i;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=r||o>t.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[r],s=r+1;s<o;s++)t[s]>a&&(a=t[s]);return a},vd=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!dd(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var n=e.fromIndex,r=void 0===n?0:n,i=e.toIndex,o=void 0===i?t.length:i;if(r<0||r>=t.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=r||o>t.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[r],s=r+1;s<o;s++)t[s]<a&&(a=t[s]);return a};function md(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!dd(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==n.output){if(!dd(n.output))throw new TypeError("output option must be an array if specified");e=n.output}else e=new Array(t.length);var r=vd(t),i=gd(t);if(r===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var o=n.min,a=void 0===o?n.autoMinMax?r:0:o,s=n.max,u=void 0===s?n.autoMinMax?i:1:s;if(a>=u)throw new RangeError("min option must be smaller than max option");for(var l=(u-a)/(i-r),c=0;c<t.length;c++)e[c]=(t[c]-r)*l+a;return e}const yd=" ".repeat(2),_d=" ".repeat(4);function bd(t,e={}){const{maxRows:n=15,maxColumns:r=10,maxNumSize:i=8}=e;return`${t.constructor.name} {\n${yd}[\n${_d}${function(t,e,n,r){const{rows:i,columns:o}=t,a=Math.min(i,e),s=Math.min(o,n),u=[];for(let e=0;e<a;e++){let n=[];for(let i=0;i<s;i++)n.push(xd(t.get(e,i),r));u.push(`${n.join(" ")}`)}return s!==o&&(u[u.length-1]+=` ... ${o-n} more columns`),a!==i&&u.push(`... ${i-e} more rows`),u.join(`\n${_d}`)}(t,n,r,i)}\n${yd}]\n${yd}rows: ${t.rows}\n${yd}columns: ${t.columns}\n}`}function xd(t,e){const n=String(t);if(n.length<=e)return n.padEnd(e," ");const r=t.toPrecision(e-2);if(r.length<=e)return r;const i=t.toExponential(e-2),o=i.indexOf("e"),a=i.slice(o);return i.slice(0,e-a.length)+a}function wd(t,e,n){let r=n?t.rows:t.rows-1;if(e<0||e>r)throw new RangeError("Row index out of range")}function Ed(t,e,n){let r=n?t.columns:t.columns-1;if(e<0||e>r)throw new RangeError("Column index out of range")}function Sd(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function Cd(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function Ad(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for row indices");if(e.some((e=>e<0||e>=t.rows)))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function Td(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for column indices");if(e.some((e=>e<0||e>=t.columns)))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function kd(t,e,n,r,i){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(Pd("startRow",e),Pd("endRow",n),Pd("startColumn",r),Pd("endColumn",i),e>n||r>i||e<0||e>=t.rows||n<0||n>=t.rows||r<0||r>=t.columns||i<0||i>=t.columns)throw new RangeError("Submatrix indices are out of range")}function Md(t,e=0){let n=[];for(let r=0;r<t;r++)n.push(e);return n}function Pd(t,e){if("number"!=typeof e)throw new TypeError(`${t} must be a number`)}function Id(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}class Od{static from1DArray(t,e,n){if(t*e!==n.length)throw new RangeError("data length does not match given dimensions");let r=new Ld(t,e);for(let i=0;i<t;i++)for(let t=0;t<e;t++)r.set(i,t,n[i*e+t]);return r}static rowVector(t){let e=new Ld(1,t.length);for(let n=0;n<t.length;n++)e.set(0,n,t[n]);return e}static columnVector(t){let e=new Ld(t.length,1);for(let n=0;n<t.length;n++)e.set(n,0,t[n]);return e}static zeros(t,e){return new Ld(t,e)}static ones(t,e){return new Ld(t,e).fill(1)}static rand(t,e,n={}){if("object"!=typeof n)throw new TypeError("options must be an object");const{random:r=Math.random}=n;let i=new Ld(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++)i.set(n,t,r());return i}static randInt(t,e,n={}){if("object"!=typeof n)throw new TypeError("options must be an object");const{min:r=0,max:i=1e3,random:o=Math.random}=n;if(!Number.isInteger(r))throw new TypeError("min must be an integer");if(!Number.isInteger(i))throw new TypeError("max must be an integer");if(r>=i)throw new RangeError("min must be smaller than max");let a=i-r,s=new Ld(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++){let e=r+Math.round(o()*a);s.set(n,t,e)}return s}static eye(t,e,n){void 0===e&&(e=t),void 0===n&&(n=1);let r=Math.min(t,e),i=this.zeros(t,e);for(let t=0;t<r;t++)i.set(t,t,n);return i}static diag(t,e,n){let r=t.length;void 0===e&&(e=r),void 0===n&&(n=e);let i=Math.min(r,e,n),o=this.zeros(e,n);for(let e=0;e<i;e++)o.set(e,e,t[e]);return o}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let n=t.rows,r=t.columns,i=new Ld(n,r);for(let o=0;o<n;o++)for(let n=0;n<r;n++)i.set(o,n,Math.min(t.get(o,n),e.get(o,n)));return i}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let n=t.rows,r=t.columns,i=new this(n,r);for(let o=0;o<n;o++)for(let n=0;n<r;n++)i.set(o,n,Math.max(t.get(o,n),e.get(o,n)));return i}static checkMatrix(t){return Od.isMatrix(t)?t:new Ld(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.call(this,e,n);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.push(this.get(e,n));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let n=0;n<this.columns;n++)t[e].push(this.get(e,n))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isEmpty(){return 0===this.rows||0===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,n=-1,r=!0,i=!1;for(;t<this.rows&&r;){for(e=0,i=!1;e<this.columns&&!1===i;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>n?(i=!0,n=e):(r=!1,i=!0);t++}return r}isReducedEchelonForm(){let t=0,e=0,n=-1,r=!0,i=!1;for(;t<this.rows&&r;){for(e=0,i=!1;e<this.columns&&!1===i;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>n?(i=!0,n=e):(r=!1,i=!0);for(let n=e+1;n<this.rows;n++)0!==this.get(t,n)&&(r=!1);t++}return r}echelonForm(){let t=this.clone(),e=0,n=0;for(;e<t.rows&&n<t.columns;){let r=e;for(let i=e;i<t.rows;i++)t.get(i,n)>t.get(r,n)&&(r=i);if(0===t.get(r,n))n++;else{t.swapRows(e,r);let i=t.get(e,n);for(let r=n;r<t.columns;r++)t.set(e,r,t.get(e,r)/i);for(let r=e+1;r<t.rows;r++){let i=t.get(r,n)/t.get(e,n);t.set(r,n,0);for(let o=n+1;o<t.columns;o++)t.set(r,o,t.get(r,o)-t.get(e,o)*i)}e++,n++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,n=t.rows,r=n-1;for(;r>=0;)if(0===t.maxRow(r))r--;else{let i=0,o=!1;for(;i<n&&!1===o;)1===t.get(r,i)?o=!0:i++;for(let n=0;n<r;n++){let o=t.get(n,i);for(let a=i;a<e;a++){let e=t.get(n,a)-o*t.get(r,a);t.set(n,a,e)}}r--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:n=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let r=new Ld(this.rows*e,this.columns*n);for(let t=0;t<e;t++)for(let e=0;e<n;e++)r.setSubMatrix(this,this.rows*t,this.columns*e);return r}fill(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,t);return this}neg(){return this.mulS(-1)}getRow(t){wd(this,t);let e=[];for(let n=0;n<this.columns;n++)e.push(this.get(t,n));return e}getRowVector(t){return Ld.rowVector(this.getRow(t))}setRow(t,e){wd(this,t),e=Sd(this,e);for(let n=0;n<this.columns;n++)this.set(t,n,e[n]);return this}swapRows(t,e){wd(this,t),wd(this,e);for(let n=0;n<this.columns;n++){let r=this.get(t,n);this.set(t,n,this.get(e,n)),this.set(e,n,r)}return this}getColumn(t){Ed(this,t);let e=[];for(let n=0;n<this.rows;n++)e.push(this.get(n,t));return e}getColumnVector(t){return Ld.columnVector(this.getColumn(t))}setColumn(t,e){Ed(this,t),e=Cd(this,e);for(let n=0;n<this.rows;n++)this.set(n,t,e[n]);return this}swapColumns(t,e){Ed(this,t),Ed(this,e);for(let n=0;n<this.rows;n++){let r=this.get(n,t);this.set(n,t,this.get(n,e)),this.set(n,e,r)}return this}addRowVector(t){t=Sd(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t[n]);return this}subRowVector(t){t=Sd(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t[n]);return this}mulRowVector(t){t=Sd(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t[n]);return this}divRowVector(t){t=Sd(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t[n]);return this}addColumnVector(t){t=Cd(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t[e]);return this}subColumnVector(t){t=Cd(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t[e]);return this}mulColumnVector(t){t=Cd(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t[e]);return this}divColumnVector(t){t=Cd(this,t);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t[e]);return this}mulRow(t,e){wd(this,t);for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*e);return this}mulColumn(t,e){Ed(this,t);for(let n=0;n<this.rows;n++)this.set(n,t,this.get(n,t)*e);return this}max(){if(this.isEmpty())return NaN;let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)>t&&(t=this.get(e,n));return t}maxIndex(){Id(this);let t=this.get(0,0),e=[0,0];for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.get(n,r)>t&&(t=this.get(n,r),e[0]=n,e[1]=r);return e}min(){if(this.isEmpty())return NaN;let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.get(e,n)<t&&(t=this.get(e,n));return t}minIndex(){Id(this);let t=this.get(0,0),e=[0,0];for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.get(n,r)<t&&(t=this.get(n,r),e[0]=n,e[1]=r);return e}maxRow(t){if(wd(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n));return e}maxRowIndex(t){wd(this,t),Id(this);let e=this.get(t,0),n=[t,0];for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r),n[1]=r);return n}minRow(t){if(wd(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n));return e}minRowIndex(t){wd(this,t),Id(this);let e=this.get(t,0),n=[t,0];for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r),n[1]=r);return n}maxColumn(t){if(Ed(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)>e&&(e=this.get(n,t));return e}maxColumnIndex(t){Ed(this,t),Id(this);let e=this.get(0,t),n=[0,t];for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t),n[0]=r);return n}minColumn(t){if(Ed(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)<e&&(e=this.get(n,t));return e}minColumnIndex(t){Ed(this,t),Id(this);let e=this.get(0,t),n=[0,t];for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t),n[0]=r);return n}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let n=0;n<t;n++)e.push(this.get(n,n));return e}norm(t="frobenius"){let e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e+=this.get(t,n)*this.get(t,n);return Math.sqrt(e)}throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t+=this.get(e,n),this.set(e,n,t);return this}dot(t){Od.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let n=0;for(let r=0;r<e.length;r++)n+=e[r]*t[r];return n}mmul(t){t=Ld.checkMatrix(t);let e=this.rows,n=this.columns,r=t.columns,i=new Ld(e,r),o=new Float64Array(n);for(let a=0;a<r;a++){for(let e=0;e<n;e++)o[e]=t.get(e,a);for(let t=0;t<e;t++){let e=0;for(let r=0;r<n;r++)e+=this.get(t,r)*o[r];i.set(t,a,e)}}return i}strassen2x2(t){t=Ld.checkMatrix(t);let e=new Ld(2,2);const n=this.get(0,0),r=t.get(0,0),i=this.get(0,1),o=t.get(0,1),a=this.get(1,0),s=t.get(1,0),u=this.get(1,1),l=t.get(1,1),c=(n+u)*(r+l),h=(a+u)*r,f=n*(o-l),p=u*(s-r),d=(n+i)*l,g=c+p-d+(i-u)*(s+l),v=f+d,m=h+p,y=c-h+f+(a-n)*(r+o);return e.set(0,0,g),e.set(0,1,v),e.set(1,0,m),e.set(1,1,y),e}strassen3x3(t){t=Ld.checkMatrix(t);let e=new Ld(3,3);const n=this.get(0,0),r=this.get(0,1),i=this.get(0,2),o=this.get(1,0),a=this.get(1,1),s=this.get(1,2),u=this.get(2,0),l=this.get(2,1),c=this.get(2,2),h=t.get(0,0),f=t.get(0,1),p=t.get(0,2),d=t.get(1,0),g=t.get(1,1),v=t.get(1,2),m=t.get(2,0),y=t.get(2,1),_=t.get(2,2),b=(n-o)*(-f+g),x=(-n+o+a)*(h-f+g),w=(o+a)*(-h+f),E=n*h,S=(-n+u+l)*(h-p+v),C=(-n+u)*(p-v),A=(u+l)*(-h+p),T=(-i+l+c)*(g+m-y),k=(i-c)*(g-y),M=i*m,P=(l+c)*(-m+y),I=(-i+a+s)*(v+m-_),O=(i-s)*(v-_),R=(a+s)*(-m+_),L=E+M+r*d,D=(n+r+i-o-a-l-c)*g+x+w+E+T+M+P,N=E+S+A+(n+r+i-a-s-u-l)*v+M+I+R,B=b+a*(-h+f+d-g-v-m+_)+x+E+M+I+O,z=b+x+w+E+s*y,F=M+I+O+R+o*p,Z=E+S+C+l*(-h+p+d-g-v-m+y)+T+k+M,j=T+k+M+P+u*f,U=E+S+C+A+c*_;return e.set(0,0,L),e.set(0,1,D),e.set(0,2,N),e.set(1,0,B),e.set(1,1,z),e.set(1,2,F),e.set(2,0,Z),e.set(2,1,j),e.set(2,2,U),e}mmulStrassen(t){t=Ld.checkMatrix(t);let e=this.clone(),n=e.rows,r=e.columns,i=t.rows,o=t.columns;function a(t,e,n){let r=t.rows,i=t.columns;if(r===e&&i===n)return t;{let r=Od.zeros(e,n);return r=r.setSubMatrix(t,0,0),r}}r!==i&&console.warn(`Multiplying ${n} x ${r} and ${i} x ${o} matrix: dimensions do not match.`);let s=Math.max(n,i),u=Math.max(r,o);return e=a(e,s,u),function t(e,n,r,i){if(r<=512||i<=512)return e.mmul(n);r%2==1&&i%2==1?(e=a(e,r+1,i+1),n=a(n,r+1,i+1)):r%2==1?(e=a(e,r+1,i),n=a(n,r+1,i)):i%2==1&&(e=a(e,r,i+1),n=a(n,r,i+1));let o=parseInt(e.rows/2,10),s=parseInt(e.columns/2,10),u=e.subMatrix(0,o-1,0,s-1),l=n.subMatrix(0,o-1,0,s-1),c=e.subMatrix(0,o-1,s,e.columns-1),h=n.subMatrix(0,o-1,s,n.columns-1),f=e.subMatrix(o,e.rows-1,0,s-1),p=n.subMatrix(o,n.rows-1,0,s-1),d=e.subMatrix(o,e.rows-1,s,e.columns-1),g=n.subMatrix(o,n.rows-1,s,n.columns-1),v=t(Od.add(u,d),Od.add(l,g),o,s),m=t(Od.add(f,d),l,o,s),y=t(u,Od.sub(h,g),o,s),_=t(d,Od.sub(p,l),o,s),b=t(Od.add(u,c),g,o,s),x=t(Od.sub(f,u),Od.add(l,h),o,s),w=t(Od.sub(c,d),Od.add(p,g),o,s),E=Od.add(v,_);E.sub(b),E.add(w);let S=Od.add(y,b),C=Od.add(m,_),A=Od.sub(v,m);A.add(y),A.add(x);let T=Od.zeros(2*E.rows,2*E.columns);return T=T.setSubMatrix(E,0,0),T=T.setSubMatrix(S,E.rows,0),T=T.setSubMatrix(C,0,E.columns),T=T.setSubMatrix(A,E.rows,E.columns),T.subMatrix(0,r-1,0,i-1)}(e,t=a(t,s,u),s,u)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:n=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(e>=n)throw new RangeError("min must be smaller than max");let r=new Ld(this.rows,this.columns);for(let t=0;t<this.rows;t++){const i=this.getRow(t);i.length>0&&md(i,{min:e,max:n,output:i}),r.setRow(t,i)}return r}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:n=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(e>=n)throw new RangeError("min must be smaller than max");let r=new Ld(this.rows,this.columns);for(let t=0;t<this.columns;t++){const i=this.getColumn(t);i.length&&md(i,{min:e,max:n,output:i}),r.setColumn(t,i)}return r}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let n=0;n<t;n++){let t=this.get(e,n),r=this.get(e,this.columns-1-n);this.set(e,n,r),this.set(e,this.columns-1-n,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let n=0;n<t;n++){let t=this.get(n,e),r=this.get(this.rows-1-n,e);this.set(n,e,r),this.set(this.rows-1-n,e,t)}return this}kroneckerProduct(t){t=Ld.checkMatrix(t);let e=this.rows,n=this.columns,r=t.rows,i=t.columns,o=new Ld(e*r,n*i);for(let a=0;a<e;a++)for(let e=0;e<n;e++)for(let n=0;n<r;n++)for(let s=0;s<i;s++)o.set(r*a+n,i*e+s,this.get(a,e)*t.get(n,s));return o}kroneckerSum(t){if(t=Ld.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,n=t.rows,r=this.kroneckerProduct(Ld.eye(n,n)),i=Ld.eye(e,e).kroneckerProduct(t);return r.add(i)}transpose(){let t=new Ld(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.set(n,e,this.get(e,n));return t}sortRows(t=Rd){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=Rd){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,n,r){kd(this,t,e,n,r);let i=new Ld(e-t+1,r-n+1);for(let o=t;o<=e;o++)for(let e=n;e<=r;e++)i.set(o-t,e-n,this.get(o,e));return i}subMatrixRow(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=this.columns-1),e>n||e<0||e>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let r=new Ld(t.length,n-e+1);for(let i=0;i<t.length;i++)for(let o=e;o<=n;o++){if(t[i]<0||t[i]>=this.rows)throw new RangeError(`Row index out of range: ${t[i]}`);r.set(i,o-e,this.get(t[i],o))}return r}subMatrixColumn(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=this.rows-1),e>n||e<0||e>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let r=new Ld(n-e+1,t.length);for(let i=0;i<t.length;i++)for(let o=e;o<=n;o++){if(t[i]<0||t[i]>=this.columns)throw new RangeError(`Column index out of range: ${t[i]}`);r.set(o-e,i,this.get(o,t[i]))}return r}setSubMatrix(t,e,n){if((t=Ld.checkMatrix(t)).isEmpty())return this;kd(this,e,e+t.rows-1,n,n+t.columns-1);for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)this.set(e+r,n+i,t.get(r,i));return this}selection(t,e){let n=function(t,e,n){return{row:Ad(t,e),column:Td(t,n)}}(this,t,e),r=new Ld(t.length,e.length);for(let t=0;t<n.row.length;t++){let e=n.row[t];for(let i=0;i<n.column.length;i++){let o=n.column[i];r.set(t,i,this.get(e,o))}}return r}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let n=0;n<t;n++)e+=this.get(n,n);return e}clone(){let t=new Ld(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t.set(e,n,this.get(e,n));return t}sum(t){switch(t){case"row":return function(t){let e=Md(t.rows);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[n]+=t.get(n,r);return e}(this);case"column":return function(t){let e=Md(t.columns);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[r]+=t.get(n,r);return e}(this);case void 0:return function(t){let e=0;for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)e+=t.get(n,r);return e}(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return function(t){let e=Md(t.rows,1);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[n]*=t.get(n,r);return e}(this);case"column":return function(t){let e=Md(t.columns,1);for(let n=0;n<t.rows;++n)for(let r=0;r<t.columns;++r)e[r]*=t.get(n,r);return e}(this);case void 0:return function(t){let e=1;for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)e*=t.get(n,r);return e}(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:n=!0,mean:r=this.mean(t)}=e;if("boolean"!=typeof n)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Array.isArray(r))throw new TypeError("mean must be an array");return function(t,e,n){const r=t.rows,i=t.columns,o=[];for(let a=0;a<r;a++){let r=0,s=0,u=0;for(let e=0;e<i;e++)u=t.get(a,e)-n[a],r+=u,s+=u*u;e?o.push((s-r*r/i)/(i-1)):o.push((s-r*r/i)/i)}return o}(this,n,r);case"column":if(!Array.isArray(r))throw new TypeError("mean must be an array");return function(t,e,n){const r=t.rows,i=t.columns,o=[];for(let a=0;a<i;a++){let i=0,s=0,u=0;for(let e=0;e<r;e++)u=t.get(e,a)-n[a],i+=u,s+=u*u;e?o.push((s-i*i/r)/(r-1)):o.push((s-i*i/r)/r)}return o}(this,n,r);case void 0:if("number"!=typeof r)throw new TypeError("mean must be a number");return function(t,e,n){const r=t.rows,i=t.columns,o=r*i;let a=0,s=0,u=0;for(let e=0;e<r;e++)for(let r=0;r<i;r++)u=t.get(e,r)-n,a+=u,s+=u*u;return e?(s-a*a/o)/(o-1):(s-a*a/o)/o}(this,n,r);default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const n=this.variance(t,e);if(void 0===t)return Math.sqrt(n);for(let t=0;t<n.length;t++)n[t]=Math.sqrt(n[t]);return n}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:n=this.mean(t)}=e;switch(t){case"row":if(!Array.isArray(n))throw new TypeError("center must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e[n])}(this,n),this;case"column":if(!Array.isArray(n))throw new TypeError("center must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e[r])}(this,n),this;case void 0:if("number"!=typeof n)throw new TypeError("center must be a number");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)-e)}(this,n),this;default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let n=e.scale;switch(t){case"row":if(void 0===n)n=function(t){const e=[];for(let n=0;n<t.rows;n++){let r=0;for(let e=0;e<t.columns;e++)r+=Math.pow(t.get(n,e),2)/(t.columns-1);e.push(Math.sqrt(r))}return e}(this);else if(!Array.isArray(n))throw new TypeError("scale must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e[n])}(this,n),this;case"column":if(void 0===n)n=function(t){const e=[];for(let n=0;n<t.columns;n++){let r=0;for(let e=0;e<t.rows;e++)r+=Math.pow(t.get(e,n),2)/(t.rows-1);e.push(Math.sqrt(r))}return e}(this);else if(!Array.isArray(n))throw new TypeError("scale must be an array");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e[r])}(this,n),this;case void 0:if(void 0===n)n=function(t){const e=t.size-1;let n=0;for(let r=0;r<t.columns;r++)for(let i=0;i<t.rows;i++)n+=Math.pow(t.get(i,r),2)/e;return Math.sqrt(n)}(this);else if("number"!=typeof n)throw new TypeError("scale must be a number");return function(t,e){for(let n=0;n<t.rows;n++)for(let r=0;r<t.columns;r++)t.set(n,r,t.get(n,r)/e)}(this,n),this;default:throw new Error(`invalid option: ${t}`)}}toString(t){return bd(this,t)}}function Rd(t,e){return t-e}Od.prototype.klass="Matrix","undefined"!=typeof Symbol&&(Od.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return bd(this)}),Od.random=Od.rand,Od.randomInt=Od.randInt,Od.diagonal=Od.diag,Od.prototype.diagonal=Od.prototype.diag,Od.identity=Od.eye,Od.prototype.negate=Od.prototype.neg,Od.prototype.tensorProduct=Od.prototype.kroneckerProduct;class Ld extends Od{constructor(t,e){if(super(),Ld.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>=0){if(this.data=[],!(Number.isInteger(e)&&e>=0))throw new TypeError("nColumns must be a positive integer");for(let n=0;n<t;n++)this.data.push(new Float64Array(e))}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const n=t;if("number"!=typeof(e=(t=n.length)?n[0].length:0))throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let r=0;r<t;r++){if(n[r].length!==e)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(n[r]))}}}this.rows=t,this.columns=e}set(t,e,n){return this.data[t][e]=n,this}get(t,e){return this.data[t][e]}removeRow(t){return wd(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),wd(this,t,!0),e=Float64Array.from(Sd(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){Ed(this,t);for(let e=0;e<this.rows;e++){const n=new Float64Array(this.columns-1);for(let r=0;r<t;r++)n[r]=this.data[e][r];for(let r=t+1;r<this.columns;r++)n[r-1]=this.data[e][r];this.data[e]=n}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),Ed(this,t,!0),e=Cd(this,e);for(let n=0;n<this.rows;n++){const r=new Float64Array(this.columns+1);let i=0;for(;i<t;i++)r[i]=this.data[n][i];for(r[i++]=e[n];i<this.columns+1;i++)r[i]=this.data[n][i-1];this.data[n]=r}return this.columns+=1,this}}!function(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+t.get(e,n));return this},t.add=function(t,n){return new e(t).add(n)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-t.get(e,n));return this},t.sub=function(t,n){return new e(t).sub(n)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t.get(e,n));return this},t.mul=function(t,n){return new e(t).mul(n)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/t.get(e,n));return this},t.div=function(t,n){return new e(t).div(n)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)%t.get(e,n));return this},t.mod=function(t,n){return new e(t).mod(n)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)&t.get(e,n));return this},t.and=function(t,n){return new e(t).and(n)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)|t.get(e,n));return this},t.or=function(t,n){return new e(t).or(n)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)^t.get(e,n));return this},t.xor=function(t,n){return new e(t).xor(n)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)<<t.get(e,n));return this},t.leftShift=function(t,n){return new e(t).leftShift(n)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>t.get(e,n));return this},t.signPropagatingRightShift=function(t,n){return new e(t).signPropagatingRightShift(n)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)>>>t.get(e,n));return this},t.rightShift=function(t,n){return new e(t).rightShift(n)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,n){return new e(t).pow(n)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,Math.pow(this.get(e,n),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,Math.pow(this.get(e,n),t.get(e,n)));return this}}(Od,Ld);class Dd extends Od{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,n){return this.data[t][e]=n,this}get(t,e){return this.data[t][e]}}function Nd(t,e){let n=0;return Math.abs(t)>Math.abs(e)?(n=e/t,Math.abs(t)*Math.sqrt(1+n*n)):0!==e?(n=t/e,Math.abs(e)*Math.sqrt(1+n*n)):0}class Bd{constructor(t,e={}){if((t=Dd.checkMatrix(t)).isEmpty())throw new Error("Matrix must be non-empty");let n=t.rows,r=t.columns;const{computeLeftSingularVectors:i=!0,computeRightSingularVectors:o=!0,autoTranspose:a=!1}=e;let s,u=Boolean(i),l=Boolean(o),c=!1;if(n<r)if(a){s=t.transpose(),n=s.rows,r=s.columns,c=!0;let e=u;u=l,l=e}else s=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else s=t.clone();let h=Math.min(n,r),f=Math.min(n+1,r),p=new Float64Array(f),d=new Ld(n,h),g=new Ld(r,r),v=new Float64Array(r),m=new Float64Array(n),y=new Float64Array(f);for(let t=0;t<f;t++)y[t]=t;let _=Math.min(n-1,r),b=Math.max(0,Math.min(r-2,n)),x=Math.max(_,b);for(let t=0;t<x;t++){if(t<_){p[t]=0;for(let e=t;e<n;e++)p[t]=Nd(p[t],s.get(e,t));if(0!==p[t]){s.get(t,t)<0&&(p[t]=-p[t]);for(let e=t;e<n;e++)s.set(e,t,s.get(e,t)/p[t]);s.set(t,t,s.get(t,t)+1)}p[t]=-p[t]}for(let e=t+1;e<r;e++){if(t<_&&0!==p[t]){let r=0;for(let i=t;i<n;i++)r+=s.get(i,t)*s.get(i,e);r=-r/s.get(t,t);for(let i=t;i<n;i++)s.set(i,e,s.get(i,e)+r*s.get(i,t))}v[e]=s.get(t,e)}if(u&&t<_)for(let e=t;e<n;e++)d.set(e,t,s.get(e,t));if(t<b){v[t]=0;for(let e=t+1;e<r;e++)v[t]=Nd(v[t],v[e]);if(0!==v[t]){v[t+1]<0&&(v[t]=0-v[t]);for(let e=t+1;e<r;e++)v[e]/=v[t];v[t+1]+=1}if(v[t]=-v[t],t+1<n&&0!==v[t]){for(let e=t+1;e<n;e++)m[e]=0;for(let e=t+1;e<n;e++)for(let n=t+1;n<r;n++)m[e]+=v[n]*s.get(e,n);for(let e=t+1;e<r;e++){let r=-v[e]/v[t+1];for(let i=t+1;i<n;i++)s.set(i,e,s.get(i,e)+r*m[i])}}if(l)for(let e=t+1;e<r;e++)g.set(e,t,v[e])}}let w=Math.min(r,n+1);if(_<r&&(p[_]=s.get(_,_)),n<w&&(p[w-1]=0),b+1<w&&(v[b]=s.get(b,w-1)),v[w-1]=0,u){for(let t=_;t<h;t++){for(let e=0;e<n;e++)d.set(e,t,0);d.set(t,t,1)}for(let t=_-1;t>=0;t--)if(0!==p[t]){for(let e=t+1;e<h;e++){let r=0;for(let i=t;i<n;i++)r+=d.get(i,t)*d.get(i,e);r=-r/d.get(t,t);for(let i=t;i<n;i++)d.set(i,e,d.get(i,e)+r*d.get(i,t))}for(let e=t;e<n;e++)d.set(e,t,-d.get(e,t));d.set(t,t,1+d.get(t,t));for(let e=0;e<t-1;e++)d.set(e,t,0)}else{for(let e=0;e<n;e++)d.set(e,t,0);d.set(t,t,1)}}if(l)for(let t=r-1;t>=0;t--){if(t<b&&0!==v[t])for(let e=t+1;e<r;e++){let n=0;for(let i=t+1;i<r;i++)n+=g.get(i,t)*g.get(i,e);n=-n/g.get(t+1,t);for(let i=t+1;i<r;i++)g.set(i,e,g.get(i,e)+n*g.get(i,t))}for(let e=0;e<r;e++)g.set(e,t,0);g.set(t,t,1)}let E=w-1,S=0,C=Number.EPSILON;for(;w>0;){let t,e;for(t=w-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+C*Math.abs(p[t]+Math.abs(p[t+1]));if(Math.abs(v[t])<=e||Number.isNaN(v[t])){v[t]=0;break}}if(t===w-2)e=4;else{let n;for(n=w-1;n>=t&&n!==t;n--){let e=(n!==w?Math.abs(v[n]):0)+(n!==t+1?Math.abs(v[n-1]):0);if(Math.abs(p[n])<=C*e){p[n]=0;break}}n===t?e=3:n===w-1?e=1:(e=2,t=n)}switch(t++,e){case 1:{let e=v[w-2];v[w-2]=0;for(let n=w-2;n>=t;n--){let i=Nd(p[n],e),o=p[n]/i,a=e/i;if(p[n]=i,n!==t&&(e=-a*v[n-1],v[n-1]=o*v[n-1]),l)for(let t=0;t<r;t++)i=o*g.get(t,n)+a*g.get(t,w-1),g.set(t,w-1,-a*g.get(t,n)+o*g.get(t,w-1)),g.set(t,n,i)}break}case 2:{let e=v[t-1];v[t-1]=0;for(let r=t;r<w;r++){let i=Nd(p[r],e),o=p[r]/i,a=e/i;if(p[r]=i,e=-a*v[r],v[r]=o*v[r],u)for(let e=0;e<n;e++)i=o*d.get(e,r)+a*d.get(e,t-1),d.set(e,t-1,-a*d.get(e,r)+o*d.get(e,t-1)),d.set(e,r,i)}break}case 3:{const e=Math.max(Math.abs(p[w-1]),Math.abs(p[w-2]),Math.abs(v[w-2]),Math.abs(p[t]),Math.abs(v[t])),i=p[w-1]/e,o=p[w-2]/e,a=v[w-2]/e,s=p[t]/e,c=v[t]/e,h=((o+i)*(o-i)+a*a)/2,f=i*a*(i*a);let m=0;0===h&&0===f||(m=h<0?0-Math.sqrt(h*h+f):Math.sqrt(h*h+f),m=f/(h+m));let y=(s+i)*(s-i)+m,_=s*c;for(let e=t;e<w-1;e++){let i=Nd(y,_);0===i&&(i=Number.MIN_VALUE);let o=y/i,a=_/i;if(e!==t&&(v[e-1]=i),y=o*p[e]+a*v[e],v[e]=o*v[e]-a*p[e],_=a*p[e+1],p[e+1]=o*p[e+1],l)for(let t=0;t<r;t++)i=o*g.get(t,e)+a*g.get(t,e+1),g.set(t,e+1,-a*g.get(t,e)+o*g.get(t,e+1)),g.set(t,e,i);if(i=Nd(y,_),0===i&&(i=Number.MIN_VALUE),o=y/i,a=_/i,p[e]=i,y=o*v[e]+a*p[e+1],p[e+1]=-a*v[e]+o*p[e+1],_=a*v[e+1],v[e+1]=o*v[e+1],u&&e<n-1)for(let t=0;t<n;t++)i=o*d.get(t,e)+a*d.get(t,e+1),d.set(t,e+1,-a*d.get(t,e)+o*d.get(t,e+1)),d.set(t,e,i)}v[w-2]=y,S+=1;break}case 4:if(p[t]<=0&&(p[t]=p[t]<0?-p[t]:0,l))for(let e=0;e<=E;e++)g.set(e,t,-g.get(e,t));for(;t<E&&!(p[t]>=p[t+1]);){let e=p[t];if(p[t]=p[t+1],p[t+1]=e,l&&t<r-1)for(let n=0;n<r;n++)e=g.get(n,t+1),g.set(n,t+1,g.get(n,t)),g.set(n,t,e);if(u&&t<n-1)for(let r=0;r<n;r++)e=d.get(r,t+1),d.set(r,t+1,d.get(r,t)),d.set(r,t,e);t++}S=0,w--}}if(c){let t=g;g=d,d=t}this.m=n,this.n=r,this.s=p,this.U=d,this.V=g}solve(t){let e=t,n=this.threshold,r=this.s.length,i=Ld.zeros(r,r);for(let t=0;t<r;t++)Math.abs(this.s[t])<=n?i.set(t,t,0):i.set(t,t,1/this.s[t]);let o=this.U,a=this.rightSingularVectors,s=a.mmul(i),u=a.rows,l=o.rows,c=Ld.zeros(u,l);for(let t=0;t<u;t++)for(let e=0;e<l;e++){let n=0;for(let i=0;i<r;i++)n+=s.get(t,i)*o.get(e,i);c.set(t,e,n)}return c.mmul(e)}solveForDiagonal(t){return this.solve(Ld.diag(t))}inverse(){let t=this.V,e=this.threshold,n=t.rows,r=t.columns,i=new Ld(n,this.s.length);for(let o=0;o<n;o++)for(let n=0;n<r;n++)Math.abs(this.s[n])>e&&i.set(o,n,t.get(o,n)/this.s[n]);let o=this.U,a=o.rows,s=o.columns,u=new Ld(n,a);for(let t=0;t<n;t++)for(let e=0;e<a;e++){let n=0;for(let r=0;r<s;r++)n+=i.get(t,r)*o.get(e,r);u.set(t,e,n)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,n=this.s;for(let r=0,i=n.length;r<i;r++)n[r]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Ld.diag(this.s)}}class zd{constructor(t){this.distances=t.distances,this.dimension=t.dimension||2,this.linkDistance=t.linkDistance}layout(){const{dimension:t,distances:e,linkDistance:n}=this;try{const n=Ld.mul(Ld.pow(e,2),-.5),r=n.mean("row"),i=n.mean("column"),o=n.mean();n.add(o).subRowVector(r).subColumnVector(i);const a=new Bd(n),s=Ld.sqrt(a.diagonalMatrix).diagonal();return a.leftSingularVectors.toJSON().map((e=>Ld.mul([e],[s]).toJSON()[0].splice(0,t)))}catch(t){const r=[];for(let t=0;t<e.length;t++){const t=Math.random()*n,e=Math.random()*n;r.push([t,e])}return r}}}class Fd{constructor(t){this.disp=[],this.positions=t.positions,this.adjMatrix=t.adjMatrix,this.focusID=t.focusID,this.radii=t.radii,this.iterations=t.iterations||10,this.height=t.height||10,this.width=t.width||10,this.speed=t.speed||100,this.gravity=t.gravity||10,this.nodeSizeFunc=t.nodeSizeFunc,this.k=t.k||5,this.strictRadial=t.strictRadial,this.nodes=t.nodes}layout(){const t=this,e=t.positions,n=[],r=t.iterations,i=t.width/10;t.maxDisplace=i,t.disp=n;for(let i=0;i<r;i++)e.forEach(((t,e)=>{n[e]={x:0,y:0}})),t.getRepulsion(),t.updatePositions();return e}getRepulsion(){const t=this,e=t.positions,n=t.nodes,r=t.disp,i=t.k,o=t.radii||[];e.forEach(((a,s)=>{r[s]={x:0,y:0},e.forEach(((e,u)=>{if(s===u)return;if(o[s]!==o[u])return;let l=a[0]-e[0],c=a[1]-e[1],h=Math.sqrt(l*l+c*c);if(0===h){h=1;const t=s>u?1:-1;l=.01*t,c=.01*t}if(h<t.nodeSizeFunc(n[s])/2+t.nodeSizeFunc(n[u])/2){const t=i*i/h;r[s].x+=l/h*t,r[s].y+=c/h*t}}))}))}updatePositions(){const t=this,e=t.positions,n=t.disp,r=t.speed,i=t.strictRadial,o=t.focusID,a=t.maxDisplace||t.width/10;i&&n.forEach(((t,n)=>{const r=e[n][0]-e[o][0],i=e[n][1]-e[o][1],a=Math.sqrt(r*r+i*i);let s=i/a,u=-r/a;const l=Math.sqrt(t.x*t.x+t.y*t.y);let c=Math.acos((s*t.x+u*t.y)/l);c>Math.PI/2&&(c-=Math.PI/2,s*=-1,u*=-1);const h=Math.cos(c)*l;t.x=s*h,t.y=u*h}));const s=t.radii;e.forEach(((t,u)=>{if(u===o)return;const l=Math.sqrt(n[u].x*n[u].x+n[u].y*n[u].y);if(l>0&&u!==o){const c=Math.min(a*(r/800),l);if(t[0]+=n[u].x/l*c,t[1]+=n[u].y/l*c,i){let n=t[0]-e[o][0],r=t[1]-e[o][1];const i=Math.sqrt(n*n+r*r);n=n/i*s[u],r=r/i*s[u],t[0]=e[o][0]+n,t[1]=e[o][1]+r}}}))}}function Zd(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}class jd extends ch{constructor(t){super(),this.maxIteration=1e3,this.focusNode=null,this.unitRadius=null,this.linkDistance=50,this.preventOverlap=!1,this.strictRadial=!0,this.maxPreventOverlapIteration=200,this.sortStrength=10,this.nodes=[],this.edges=[],this.updateCfg(t)}getDefaultCfg(){return{maxIteration:1e3,focusNode:null,unitRadius:null,linkDistance:50,preventOverlap:!1,nodeSize:void 0,nodeSpacing:void 0,strictRadial:!0,maxPreventOverlapIteration:200,sortBy:void 0,sortStrength:10}}execute(){const t=this,e=t.nodes,n=t.edges||[];if(!e||0===e.length)return void(t.onLayoutEnd&&t.onLayoutEnd());t.width||"undefined"==typeof window||(t.width=window.innerWidth),t.height||"undefined"==typeof window||(t.height=window.innerHeight),t.center||(t.center=[t.width/2,t.height/2]);const r=t.center;if(1===e.length)return e[0].x=r[0],e[0].y=r[1],void(t.onLayoutEnd&&t.onLayoutEnd());const i=t.linkDistance;let o=null;if(hh(t.focusNode)){let n=!1;for(let r=0;r<e.length;r++)e[r].id===t.focusNode&&(o=e[r],t.focusNode=o,n=!0,r=e.length);n||(o=null)}else o=t.focusNode;o||(o=e[0],t.focusNode=o);const a=function(t,e){let n=-1;return t.forEach(((t,r)=>{t.id===e&&(n=r)})),n}(e,o.id);t.focusIndex=a;const s=bh({nodes:e,edges:n},!1),u=_h(s),l=t.maxToFocus(u,a);t.handleInfinity(u,a,l+1),t.distances=u;const c=u[a],h=t.width||500,f=t.height||500;let p=h-r[0]>r[0]?r[0]:h-r[0],d=f-r[1]>r[1]?r[1]:f-r[1];0===p&&(p=h/2),0===d&&(d=f/2);const g=d>p?p:d,v=Math.max(...c),m=[];c.forEach(((e,n)=>{t.unitRadius||(t.unitRadius=g/v),m[n]=e*t.unitRadius})),t.radii=m;const y=t.eIdealDisMatrix();t.eIdealDistances=y;const _=function(t){const e=t.length,n=t[0].length,r=[];for(let i=0;i<e;i++){const e=[];for(let r=0;r<n;r++)0!==t[i][r]?e.push(1/(t[i][r]*t[i][r])):e.push(0);r.push(e)}return r}(y);t.weights=_;let b=new zd({linkDistance:i,distances:y}).layout();b.forEach((t=>{dh(t[0])&&(t[0]=Math.random()*i),dh(t[1])&&(t[1]=Math.random()*i)})),t.positions=b,b.forEach(((t,n)=>{e[n].x=t[0]+r[0],e[n].y=t[1]+r[1]})),b.forEach((t=>{t[0]-=b[a][0],t[1]-=b[a][1]})),t.run();const x=t.preventOverlap,w=t.nodeSize;let E;const S=t.strictRadial;if(x){const n=t.nodeSpacing;let r;r=ph(n)?()=>n:Eh(n)?n:()=>0,E=w?fh(w)?t=>(w[0]>w[1]?w[0]:w[1])+r(t):t=>w+r(t):t=>t.size?fh(t.size)?(t.size[0]>t.size[1]?t.size[0]:t.size[1])+r(t):gh(t.size)?(t.size.width>t.size.height?t.size.width:t.size.height)+r(t):t.size+r(t):10+r(t);const i={nodes:e,nodeSizeFunc:E,adjMatrix:s,positions:b,radii:m,height:f,width:h,strictRadial:S,focusID:a,iterations:t.maxPreventOverlapIteration||200,k:b.length/4.5},o=new Fd(i);b=o.layout()}return b.forEach(((t,n)=>{e[n].x=t[0]+r[0],e[n].y=t[1]+r[1]})),t.onLayoutEnd&&t.onLayoutEnd(),{nodes:e,edges:n}}run(){const t=this,e=t.maxIteration,n=t.positions||[],r=t.weights||[],i=t.eIdealDistances||[],o=t.radii||[];for(let a=0;a<=e;a++){const s=a/e;t.oneIteration(s,n,o,i,r)}}oneIteration(t,e,n,r,i){const o=1-t,a=this.focusIndex;e.forEach(((s,u)=>{const l=Zd(s,[0,0]),c=0===l?0:1/l;if(u===a)return;let h=0,f=0,p=0;e.forEach(((t,e)=>{if(u===e)return;const n=Zd(s,t),o=0===n?0:1/n,a=r[e][u];p+=i[u][e],h+=i[u][e]*(t[0]+a*(s[0]-t[0])*o),f+=i[u][e]*(t[1]+a*(s[1]-t[1])*o)}));const d=0===n[u]?0:1/n[u];p*=o,p+=t*d*d,h*=o,h+=t*d*s[0]*c,s[0]=h/p,f*=o,f+=t*d*s[1]*c,s[1]=f/p}))}eIdealDisMatrix(){const t=this,e=t.nodes;if(!e)return[];const n=t.distances,r=t.linkDistance,i=t.radii||[],o=t.unitRadius||50,a=[];return n&&n.forEach(((n,s)=>{const u=[];n.forEach(((n,a)=>{if(s===a)u.push(0);else if(i[s]===i[a])if("data"===t.sortBy)u.push(n*(Math.abs(s-a)*t.sortStrength)/(i[s]/o));else if(t.sortBy){let r=e[s][t.sortBy]||0,l=e[a][t.sortBy]||0;hh(r)&&(r=r.charCodeAt(0)),hh(l)&&(l=l.charCodeAt(0)),u.push(n*(Math.abs(r-l)*t.sortStrength)/(i[s]/o))}else u.push(n*r/(i[s]/o));else{const t=(r+o)/2;u.push(n*t)}})),a.push(u)})),a}handleInfinity(t,e,n){const r=t.length;for(let i=0;i<r;i++)if(t[e][i]===1/0){t[e][i]=n,t[i][e]=n;for(let o=0;o<r;o++)t[i][o]!==1/0&&t[e][o]===1/0&&(t[e][o]=n+t[i][o],t[o][e]=n+t[i][o])}for(let n=0;n<r;n++)if(n!==e)for(let i=0;i<r;i++)if(t[n][i]===1/0){let r=Math.abs(t[e][n]-t[e][i]);r=0===r?1:r,t[n][i]=r}}maxToFocus(t,e){let n=0;for(let r=0;r<t[e].length;r++)t[e][r]!==1/0&&(n=t[e][r]>n?t[e][r]:n);return n}getType(){return"radial"}}class Ud extends ch{constructor(t){super(),this.nodeSize=30,this.minNodeSpacing=10,this.preventOverlap=!1,this.equidistant=!1,this.startAngle=1.5*Math.PI,this.clockwise=!0,this.sortBy="degree",this.nodes=[],this.edges=[],this.width=300,this.height=300,this.onLayoutEnd=()=>{},this.updateCfg(t)}getDefaultCfg(){return{nodeSize:30,minNodeSpacing:10,preventOverlap:!1,sweep:void 0,equidistant:!1,startAngle:1.5*Math.PI,clockwise:!0,maxLevelDiff:void 0,sortBy:"degree"}}execute(){const t=this,e=t.nodes,n=t.edges,r=e.length;if(0===r)return void(t.onLayoutEnd&&t.onLayoutEnd());t.width||"undefined"==typeof window||(t.width=window.innerWidth),t.height||"undefined"==typeof window||(t.height=window.innerHeight),t.center||(t.center=[t.width/2,t.height/2]);const i=t.center;if(1===r)return e[0].x=i[0],e[0].y=i[1],void(t.onLayoutEnd&&t.onLayoutEnd());const o=[];let a;a=fh(t.nodeSize)?Math.max(t.nodeSize[0],t.nodeSize[1]):t.nodeSize,e.forEach((t=>{o.push(t);let e=a;fh(t.size)?e=Math.max(t.size[0],t.size[1]):ph(t.size)?e=t.size:gh(t.size)&&(e=Math.max(t.size.width,t.size.height)),a=Math.max(a,e)})),t.clockwise=void 0!==t.counterclockwise?!t.counterclockwise:t.clockwise;const s={},u={};if(o.forEach(((t,e)=>{s[t.id]=t,u[t.id]=e})),!("degree"!==t.sortBy&&hh(t.sortBy)&&void 0!==o[0][t.sortBy]||(t.sortBy="degree",ph(e[0].degree)))){const t=yh(e.length,u,n);o.forEach(((e,n)=>{e.degree=t[n]}))}o.sort(((e,n)=>n[t.sortBy]-e[t.sortBy])),t.maxValueNode=o[0],t.maxLevelDiff=t.maxLevelDiff||t.maxValueNode[t.sortBy]/4;const l=[[]];let c=l[0];o.forEach((e=>{if(c.length>0){const n=Math.abs(c[0][t.sortBy]-e[t.sortBy]);t.maxLevelDiff&&n>=t.maxLevelDiff&&(c=[],l.push(c))}c.push(e)}));let h=a+t.minNodeSpacing;if(!t.preventOverlap){const e=l.length>0&&l[0].length>1,n=(Math.min(t.width,t.height)/2-h)/(l.length+(e?1:0));h=Math.min(h,n)}let f=0;if(l.forEach((e=>{let n=t.sweep;void 0===n&&(n=2*Math.PI-2*Math.PI/e.length);const r=e.dTheta=n/Math.max(1,e.length-1);if(e.length>1&&t.preventOverlap){const t=Math.cos(r)-Math.cos(0),e=Math.sin(r)-Math.sin(0),n=Math.sqrt(h*h/(t*t+e*e));f=Math.max(n,f)}e.r=f,f+=h})),t.equidistant){let t=0,e=0;for(let n=0;n<l.length;n++){const r=l[n].r-e;t=Math.max(t,r)}e=0,l.forEach(((n,r)=>{0===r&&(e=n.r),n.r=e,e+=t}))}return l.forEach((e=>{const n=e.dTheta,r=e.r;e.forEach(((e,o)=>{const a=t.startAngle+(t.clockwise?1:-1)*n*o;e.x=i[0]+r*Math.cos(a),e.y=i[1]+r*Math.sin(a)}))})),t.onLayoutEnd&&t.onLayoutEnd(),{nodes:e,edges:n}}getType(){return"concentric"}}class Gd extends ch{constructor(t){super(),this.center=[0,0],this.linkDistance=50,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.updateCfg(t)}getDefaultCfg(){return{center:[0,0],linkDistance:50}}execute(){const t=this,{nodes:e,edges:n=[]}=t,r=t.center;if(!e||0===e.length)return void(t.onLayoutEnd&&t.onLayoutEnd());if(1===e.length)return e[0].x=r[0],e[0].y=r[1],void(t.onLayoutEnd&&t.onLayoutEnd());const i=t.linkDistance,o=bh({nodes:e,edges:n},!1),a=_h(o);t.handleInfinity(a);const s=((t,e)=>{const n=[];return t.forEach((t=>{const r=[];t.forEach((t=>{r.push(t*e)})),n.push(r)})),n})(a,i);t.scaledDistances=s;const u=t.runMDS();return t.positions=u,u.forEach(((t,n)=>{e[n].x=t[0]+r[0],e[n].y=t[1]+r[1]})),t.onLayoutEnd&&t.onLayoutEnd(),{nodes:e,edges:n}}runMDS(){const t=this.scaledDistances,e=Ld.mul(Ld.pow(t,2),-.5),n=e.mean("row"),r=e.mean("column"),i=e.mean();e.add(i).subRowVector(n).subColumnVector(r);const o=new Bd(e),a=Ld.sqrt(o.diagonalMatrix).diagonal();return o.leftSingularVectors.toJSON().map((t=>Ld.mul([t],[a]).toJSON()[0].splice(0,2)))}handleInfinity(t){let e=-999999;t.forEach((t=>{t.forEach((t=>{t!==1/0&&e<t&&(e=t)}))})),t.forEach(((n,r)=>{n.forEach(((n,i)=>{n===1/0&&(t[r][i]=e)}))}))}getType(){return"mds"}}class Vd extends ch{constructor(t){super(),this.maxIteration=1e3,this.workerEnabled=!1,this.gravity=10,this.speed=5,this.clustering=!1,this.clusterGravity=10,this.nodes=[],this.edges=[],this.width=300,this.height=300,this.nodeMap={},this.nodeIdxMap={},this.onLayoutEnd=()=>{},this.tick=()=>{},this.updateCfg(t)}getDefaultCfg(){return{maxIteration:1e3,gravity:10,speed:1,clustering:!1,clusterGravity:10}}execute(){var t,e;const n=this,r=n.nodes;if(void 0!==n.timeInterval&&"undefined"!=typeof window&&window.clearInterval(n.timeInterval),!r||0===r.length)return void(null===(t=n.onLayoutEnd)||void 0===t||t.call(n));n.width||"undefined"==typeof window||(n.width=window.innerWidth),n.height||"undefined"==typeof window||(n.height=window.innerHeight),n.center||(n.center=[n.width/2,n.height/2]);const i=n.center;if(1===r.length)return r[0].x=i[0],r[0].y=i[1],void(null===(e=n.onLayoutEnd)||void 0===e||e.call(n));const o={},a={};return r.forEach(((t,e)=>{ph(t.x)||(t.x=Math.random()*this.width),ph(t.y)||(t.y=Math.random()*this.height),o[t.id]=t,a[t.id]=e})),n.nodeMap=o,n.nodeIdxMap=a,n.run()}run(){var t;const e=this,n=e.nodes;if(!n)return;const{edges:r,maxIteration:i,workerEnabled:o,clustering:a}=e,s={};if(a&&n.forEach((t=>{void 0===s[t.cluster]&&(s[t.cluster]={name:t.cluster,cx:0,cy:0,count:0})})),o){for(let t=0;t<i;t++)e.runOneStep(s);null===(t=e.onLayoutEnd)||void 0===t||t.call(e)}else{if("undefined"==typeof window)return;let t=0;this.timeInterval=window.setInterval((()=>{var n;e.runOneStep(s),t++,t>=i&&(null===(n=e.onLayoutEnd)||void 0===n||n.call(e),window.clearInterval(e.timeInterval))}),0)}return{nodes:n,edges:r}}runOneStep(t){var e;const n=this,r=n.nodes;if(!r)return;const{edges:i,center:o,gravity:a,speed:s,clustering:u}=n,l=n.height*n.width,c=Math.sqrt(l)/10,h=l/(r.length+1),f=Math.sqrt(h),p=[];if(r.forEach(((t,e)=>{p[e]={x:0,y:0}})),n.applyCalculate(r,i,p,f,h),u){for(const e in t)t[e].cx=0,t[e].cy=0,t[e].count=0;r.forEach((e=>{const n=t[e.cluster];ph(e.x)&&(n.cx+=e.x),ph(e.y)&&(n.cy+=e.y),n.count++}));for(const e in t)t[e].cx/=t[e].count,t[e].cy/=t[e].count;const e=n.clusterGravity||a;r.forEach(((n,r)=>{if(!ph(n.x)||!ph(n.y))return;const i=t[n.cluster],o=Math.sqrt((n.x-i.cx)*(n.x-i.cx)+(n.y-i.cy)*(n.y-i.cy)),a=f*e;p[r].x-=a*(n.x-i.cx)/o,p[r].y-=a*(n.y-i.cy)/o}))}r.forEach(((t,e)=>{if(!ph(t.x)||!ph(t.y))return;const n=.01*f*a;p[e].x-=n*(t.x-o[0]),p[e].y-=n*(t.y-o[1])})),r.forEach(((t,e)=>{if(ph(t.fx)&&ph(t.fy))return t.x=t.fx,void(t.y=t.fy);if(!ph(t.x)||!ph(t.y))return;const n=Math.sqrt(p[e].x*p[e].x+p[e].y*p[e].y);if(n>0){const r=Math.min(c*(s/800),n);t.x+=p[e].x/n*r,t.y+=p[e].y/n*r}})),null===(e=n.tick)||void 0===e||e.call(n)}applyCalculate(t,e,n,r,i){this.calRepulsive(t,n,i),e&&this.calAttractive(e,n,r)}calRepulsive(t,e,n){t.forEach(((r,i)=>{e[i]={x:0,y:0},t.forEach(((t,o)=>{if(i===o)return;if(!(ph(r.x)&&ph(t.x)&&ph(r.y)&&ph(t.y)))return;let a=r.x-t.x,s=r.y-t.y,u=a*a+s*s;if(0===u){u=1;const t=i>o?1:-1;a=.01*t,s=.01*t}const l=n/u;e[i].x+=a*l,e[i].y+=s*l}))}))}calAttractive(t,e,n){t.forEach((t=>{const r=mh(t,"source"),i=mh(t,"target");if(!r||!i)return;const o=this.nodeIdxMap[r],a=this.nodeIdxMap[i];if(o===a)return;const s=this.nodeMap[r],u=this.nodeMap[i];if(!(ph(u.x)&&ph(s.x)&&ph(u.y)&&ph(s.y)))return;const l=u.x-s.x,c=u.y-s.y,h=Math.sqrt(l*l+c*c),f=h*h/n;e[a].x-=l/h*f,e[a].y-=c/h*f,e[o].x+=l/h*f,e[o].y+=c/h*f}))}stop(){this.timeInterval&&"undefined"!=typeof window&&window.clearInterval(this.timeInterval)}destroy(){const t=this;t.stop(),t.tick=null,t.nodes=null,t.edges=null,t.destroyed=!0}getType(){return"fruchterman"}}var Wd=n(3269),Hd=n(5671),Xd=n(3144),Yd=n(3229),qd=(n(8660),n(7757)),Kd=n.n(qd),Qd=n(5861),Jd=1;function $d(){return Jd++}var tg=function t(e){(0,Hd.Z)(this,t)},eg=function(){function t(e){(0,Hd.Z)(this,t),this.clazz=void 0,this.components=[],this.entities=[],this.lookup={},this.clazz=e}var e;return(0,Xd.Z)(t,[{key:"clear",value:function(){this.components=[],this.entities=[],this.lookup={}}},{key:"contains",value:function(t){return this.lookup[t]>-1}},{key:"create",value:function(t,e){this.lookup[t]=this.components.length;var n=new this.clazz(e||{});return this.components.push(n),this.entities.push(t),n}},{key:"remove",value:function(t){var e=this.lookup[t];e>-1&&e<this.components.length-1&&(this.components[e]=this.components[this.components.length-1],this.entities[e]=this.entities[this.entities.length-1],this.lookup[this.entities[e]]=e),this.components.pop(),this.entities.pop(),delete this.lookup[t]}},{key:"removeKeepSorted",value:function(t){var e=this.lookup[t];if(e>-1){var n=this.entities[e];if(e<this.components.length-1){for(var r=e+1;r<this.components.length;++r)this.components[r-1]=this.components[r];for(var i=e+1;i<this.entities.length;++i)this.entities[i-1]=this.entities[i],this.lookup[this.entities[i-1]]=i-1}this.components.pop(),this.entities.pop(),delete this.lookup[n]}}},{key:"moveItem",value:function(t,e){if(t!==e){for(var n=this.components[t],r=this.entities[t],i=t<e?1:-1,o=t;o!==e;o+=i){var a=o+i;this.components[o]=this.components[a],this.entities[o]=this.entities[a],this.lookup[this.entities[o]]=o}this.components[e]=n,this.entities[e]=r,this.lookup[r]=e}}},{key:"getEntity",value:function(t){return this.entities[t]}},{key:"getComponent",value:function(t){return this.components[t]}},{key:"getComponentByEntity",value:function(t){var e=this.lookup[t];return e>-1?this.components[e]:null}},{key:"getCount",value:function(){return this.components.length}},{key:"getEntityByComponentIndex",value:function(t){for(var e=0,n=Object.keys(this.lookup);e<n.length;e++){var r=n[e],i=Number(r);if(this.lookup[i]===t)return i}return-1}},{key:"find",value:function(t){for(var e=0;e<this.getCount();e++){var n=this.getComponent(e);if(t(n,e))return n}return null}},{key:"findIndex",value:function(t){for(var e=0;e<this.getCount();e++)if(t(this.getComponent(e),e))return e;return-1}},{key:"forEach",value:function(t){for(var e=0,n=Object.keys(this.lookup);e<n.length;e++){var r=n[e],i=Number(r),o=this.lookup[i];t(i,this.getComponent(o))}}},{key:"forEachAsync",value:(e=(0,Qd.Z)(Kd().mark((function t(e){var n,r,i,o,a;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0,r=Object.keys(this.lookup);case 1:if(!(n<r.length)){t.next=10;break}return i=r[n],o=Number(i),a=this.lookup[o],t.next=7,e(o,this.getComponent(a));case 7:n++,t.next=1;break;case 10:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"map",value:function(t){for(var e=[],n=0,r=Object.keys(this.lookup);n<r.length;n++){var i=r[n],o=Number(i),a=this.lookup[o];e.push(t(o,this.getComponent(a)))}return e}}]),t}(),ng=n(885),rg=n(6700),ig={HierarchyComponentManager:Symbol("HierarchyComponentManager"),TransformComponentManager:Symbol("TransformComponentManager"),NameComponentManager:Symbol("NameComponentManager"),SceneGraphSystem:Symbol("SceneGraphSystem"),FrameGraphSystem:Symbol("FrameGraphSystem"),ResourcePool:Symbol("ResourcePool"),ResourceHandleComponentManager:Symbol("ResourceHandleComponentManager"),PassNodeComponentManager:Symbol("PassNodeComponentManager"),RendererSystem:Symbol("RendererSystem"),RenderPass:Symbol("RenderPass"),RenderPassFactory:Symbol("Factory<IRenderPass>"),Renderable:Symbol("Factory<IRenderPass>"),MeshSystem:Symbol("MeshSystem"),MeshComponentManager:Symbol("MeshComponentManager"),CullableComponentManager:Symbol("CullableComponentManager"),Geometry:Symbol("Geometry"),GeometrySystem:Symbol("GeometrySystem"),GeometryComponentManager:Symbol("GeometryComponentManager"),Material:Symbol("Material"),MaterialSystem:Symbol("MaterialSystem"),MaterialComponentManager:Symbol("MaterialComponentManager"),ForwardRenderPath:Symbol("ForwardRenderPath"),ComputeSystem:Symbol("ComputeSystem"),ComputeComponentManager:Symbol("ComputeComponentManager"),ComputeStrategy:Symbol("ComputeStrategy"),Systems:Symbol("Systems"),World:Symbol("World"),RenderEngine:Symbol("RenderEngine"),WebGPUEngine:Symbol("WebGPUEngine"),WebGLEngine:Symbol("WebGLEngine"),ShaderModuleService:Symbol("ShaderModuleService"),ConfigService:Symbol("ConfigService"),InteractorService:Symbol("InteractorService"),IEventEmitter:Symbol("IEventEmitter"),Light:Symbol("Light")},og=function t(){(0,Hd.Z)(this,t),this.index=void 0},ag=function t(){(0,Hd.Z)(this,t),this.name=void 0,this.data=void 0,this.execute=void 0,this.tearDown=void 0},sg=function(){function t(){(0,Hd.Z)(this,t),this.name=void 0,this.refCount=0,this.hasSideEffect=!1,this.devirtualize=[],this.destroy=[],this.reads=[],this.writes=[]}return(0,Xd.Z)(t,[{key:"read",value:function(t){return this.reads.find((function(e){return e.index===t.index}))||this.reads.push(t),t}},{key:"sample",value:function(t){return this.read(t),t}},{key:"write",value:function(t,e){if(this.writes.find((function(t){return t.index===e.index})))return e;var n=t.getResourceNode(e);n.resource.version++,n.resource.imported&&(this.hasSideEffect=!0);var r=t.createResourceNode(n.resource);return t.getResourceNode(r).writer=this,this.writes.push(r),r}}]),t}(),ug=n(136),lg=n(2963),cg=n(1120);var hg,fg,pg,dg,gg,vg,mg=function(t){(0,ug.Z)(i,(function t(){(0,Hd.Z)(this,t),this.first=void 0,this.last=void 0}));var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(){var t;(0,Hd.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=r.call.apply(r,[this].concat(n))).version=0,t.refs=0,t.name=void 0,t.imported=void 0,t.priority=void 0,t.discardStart=!0,t.discardEnd=!1,t.descriptor=void 0,t.resource=void 0,t}return(0,Xd.Z)(i,[{key:"preExecuteDestroy",value:function(){this.discardEnd=!0}},{key:"postExecuteDestroy",value:function(){this.imported}},{key:"postExecuteDevirtualize",value:function(){this.discardStart=!1}},{key:"preExecuteDevirtualize",value:function(){this.imported}}]),i}(),yg=function t(){(0,Hd.Z)(this,t),this.resource=void 0,this.writer=void 0,this.readerCount=0,this.version=void 0};function _g(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return bg(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bg(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function bg(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var xg=(hg=(0,rg.b2)(),fg=(0,rg.f3)(ig.RenderEngine),hg((vg=function(){function t(){(0,Hd.Z)(this,t),this.passNodes=[],this.resourceNodes=[],this.frameGraphPasses=[],(0,Wd.Z)(this,"engine",gg,this)}var e,n;return(0,Xd.Z)(t,[{key:"execute",value:(n=(0,Qd.Z)(Kd().mark((function t(e){return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.compile(),t.next=3,this.executePassNodes(e);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"tearDown",value:function(){this.frameGraphPasses.forEach((function(t){t.tearDown&&t.tearDown()})),this.reset()}},{key:"addPass",value:function(t,e,n,r){var i=new ag;i.execute=n,r&&(i.tearDown=r),i.name=t;var o=new sg;return o.name=t,this.passNodes.push(o),this.frameGraphPasses.push(i),e(this,o,i),i}},{key:"getPass",value:function(t){return this.frameGraphPasses.find((function(e){return e.name===t}))}},{key:"compile",value:function(){var t,e=this,n=_g(this.passNodes);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.refCount=r.writes.length+(r.hasSideEffect?1:0),r.reads.forEach((function(t){e.resourceNodes[t.index].readerCount++}))}}catch(t){n.e(t)}finally{n.f()}var i,o=[],a=_g(this.resourceNodes);try{for(a.s();!(i=a.n()).done;){var s=i.value;0===s.readerCount&&o.push(s)}}catch(t){a.e(t)}finally{a.f()}for(;o.length;){var u=o.pop(),l=u&&u.writer;if(l&&0==--l.refCount){var c,h=_g(l.reads);try{for(h.s();!(c=h.n()).done;){var f=c.value,p=this.resourceNodes[f.index];0==--p.readerCount&&o.push(p)}}catch(t){h.e(t)}finally{h.f()}}}this.resourceNodes.forEach((function(t){t.resource.refs+=t.readerCount}));var d,g=_g(this.passNodes);try{for(g.s();!(d=g.n()).done;){var v=d.value;if(v.refCount){var m,y=_g(v.reads);try{for(y.s();!(m=y.n()).done;){var _=m.value,b=this.resourceNodes[_.index].resource;b.first=b.first?b.first:v,b.last=v}}catch(t){y.e(t)}finally{y.f()}var x,w=_g(v.writes);try{for(w.s();!(x=w.n()).done;){var E=x.value,S=this.resourceNodes[E.index].resource;S.first=S.first?S.first:v,S.last=v}}catch(t){w.e(t)}finally{w.f()}}}}catch(t){g.e(t)}finally{g.f()}for(var C=0;C<2;C++){var A,T=_g(this.resourceNodes);try{for(T.s();!(A=T.n()).done;){var k=A.value.resource;if(k.priority===C&&k.refs){var M=k.first,P=k.last;M&&P&&(M.devirtualize.push(k),P.destroy.push(k))}}}catch(t){T.e(t)}finally{T.f()}}}},{key:"executePassNodes",value:(e=(0,Qd.Z)(Kd().mark((function t(e){var n,r,i,o,a,s,u,l,c,h,f,p,d;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=_g(this.passNodes.entries()),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=18;break}if(i=(0,ng.Z)(r.value,2),o=i[0],!(a=i[1]).refCount){t.next=16;break}s=_g(a.devirtualize);try{for(s.s();!(u=s.n()).done;)u.value.preExecuteDevirtualize(this.engine)}catch(t){s.e(t)}finally{s.f()}l=_g(a.destroy);try{for(l.s();!(c=l.n()).done;)c.value.preExecuteDestroy(this.engine)}catch(t){l.e(t)}finally{l.f()}return t.next=12,this.frameGraphPasses[o].execute(this,this.frameGraphPasses[o],e);case 12:h=_g(a.devirtualize);try{for(h.s();!(f=h.n()).done;)f.value.postExecuteDevirtualize(this.engine)}catch(t){h.e(t)}finally{h.f()}p=_g(a.destroy);try{for(p.s();!(d=p.n()).done;)d.value.postExecuteDestroy(this.engine)}catch(t){p.e(t)}finally{p.f()}case 16:t.next=3;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(1),n.e(t.t0);case 23:return t.prev=23,n.f(),t.finish(23);case 26:this.reset();case 27:case"end":return t.stop()}}),t,this,[[1,20,23,26]])}))),function(t){return e.apply(this,arguments)})},{key:"reset",value:function(){this.passNodes=[],this.resourceNodes=[],this.frameGraphPasses=[]}},{key:"getResourceNode",value:function(t){return this.resourceNodes[t.index]}},{key:"createResourceNode",value:function(t){var e=new yg;e.resource=t,e.version=t.version,this.resourceNodes.push(e);var n=new og;return n.index=this.resourceNodes.length-1,n}},{key:"createTexture",value:function(t,e,n){var r=new mg;return r.name=e,r.descriptor=n,this.createResourceNode(r)}},{key:"createRenderTarget",value:function(t,e,n){var r=new mg;return r.name=e,r.descriptor=n,this.createResourceNode(r)}},{key:"present",value:function(t){this.addPass("Present",(function(e,n){n.read(t),n.hasSideEffect=!0}),(0,Qd.Z)(Kd().mark((function t(){return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))))}}]),t}(),dg=vg,gg=(0,Yd.Z)(dg.prototype,"engine",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pg=dg))||pg),wg=n(4942),Eg=n(7326),Sg=n(8333),Cg=n(1002),Ag={};Ag["[object Float32Array]"]=Ag["[object Float64Array]"]=Ag["[object Int8Array]"]=Ag["[object Int16Array]"]=Ag["[object Int32Array]"]=Ag["[object Uint8Array]"]=Ag["[object Uint8ClampedArray]"]=Ag["[object Uint16Array]"]=Ag["[object Uint32Array]"]=!0,Ag["[object Arguments]"]=Ag["[object Array]"]=Ag["[object ArrayBuffer]"]=Ag["[object Boolean]"]=Ag["[object DataView]"]=Ag["[object Date]"]=Ag["[object Error]"]=Ag["[object Function]"]=Ag["[object Map]"]=Ag["[object Number]"]=Ag["[object Object]"]=Ag["[object RegExp]"]=Ag["[object Set]"]=Ag["[object String]"]=Ag["[object WeakMap]"]=!1;var Tg=Object.prototype.toString,kg=function(t){return function(t){return!!t&&"object"===(0,Cg.Z)(t)}(t)&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}(t.length)&&!!Ag[Tg.call(t)]};function Mg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Pg(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mg(Object(n),!0).forEach((function(e){(0,wg.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mg(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ig,Og,Rg,Lg,Dg,Ng,Bg,zg,Fg,Zg=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(t){var e;return(0,Hd.Z)(this,i),(e=r.call(this,t)).dirty=!0,e.attributes=[],e.indices=void 0,e.indicesBuffer=void 0,e.vertexCount=0,e.maxInstancedCount=void 0,e.aabb=void 0,e.entity=void 0,Object.assign((0,Eg.Z)(e),t),e}return(0,Xd.Z)(i,[{key:"setAttribute",value:function(t,e,n,r){var i=this.attributes.find((function(e){return e.name===t}));return i?(i.data=e,i.dirty=!0):this.attributes.push(Pg(Pg({dirty:!0,name:t,data:e},n),{},{bufferGetter:r})),this.dirty=!0,this}},{key:"setIndex",value:function(t){return this.indices=new Uint32Array(t.buffer?t.buffer:t),this.dirty=!0,this}},{key:"applyMatrix",value:function(t){var e=this.attributes.find((function(t){return"position"===t.name})),n=this.attributes.find((function(t){return"normal"===t.name}));if(e&&(e.dirty=!0,e.data&&e.data.length))for(var r=0;r<e.data.length;r+=3){var i=Sg.al(e.data[r],e.data[r+1],e.data[r+2],1);Sg.fF(i,i,t),kg(e.data)?e.data.set([i[0],i[1],i[2]],r):(e.data[r]=i[0],e.data[r+1]=i[1],e.data[r+2]=i[2])}if(n){var o=X(T(),t);if(n.data&&n.data.length)for(var a=0;a<n.data.length;a+=3){var s=Pe.fromValues(n.data[a],n.data[a+1],n.data[a+2]);Pe.transformMat3(s,s,o),Pe.normalize(s,s),kg(n.data)?n.data.set([s[0],s[1],s[2]],a):(n.data[a]=s[0],n.data[a+1]=s[1],n.data[a+2]=s[2])}}}}]),i}(tg);!function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.MAX_EXT=32776]="MAX_EXT",t[t.MIN_EXT=32775]="MIN_EXT",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.CULL_FACE=2884]="CULL_FACE",t[t.BLEND=3042]="BLEND",t[t.DITHER=3024]="DITHER",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.TEXTURE1=33985]="TEXTURE1",t[t.TEXTURE2=33986]="TEXTURE2",t[t.TEXTURE3=33987]="TEXTURE3",t[t.TEXTURE4=33988]="TEXTURE4",t[t.TEXTURE5=33989]="TEXTURE5",t[t.TEXTURE6=33990]="TEXTURE6",t[t.TEXTURE7=33991]="TEXTURE7",t[t.TEXTURE8=33992]="TEXTURE8",t[t.TEXTURE9=33993]="TEXTURE9",t[t.TEXTURE10=33994]="TEXTURE10",t[t.TEXTURE11=33995]="TEXTURE11",t[t.TEXTURE12=33996]="TEXTURE12",t[t.TEXTURE13=33997]="TEXTURE13",t[t.TEXTURE14=33998]="TEXTURE14",t[t.TEXTURE15=33999]="TEXTURE15",t[t.TEXTURE16=34e3]="TEXTURE16",t[t.TEXTURE17=34001]="TEXTURE17",t[t.TEXTURE18=34002]="TEXTURE18",t[t.TEXTURE19=34003]="TEXTURE19",t[t.TEXTURE20=34004]="TEXTURE20",t[t.TEXTURE21=34005]="TEXTURE21",t[t.TEXTURE22=34006]="TEXTURE22",t[t.TEXTURE23=34007]="TEXTURE23",t[t.TEXTURE24=34008]="TEXTURE24",t[t.TEXTURE25=34009]="TEXTURE25",t[t.TEXTURE26=34010]="TEXTURE26",t[t.TEXTURE27=34011]="TEXTURE27",t[t.TEXTURE28=34012]="TEXTURE28",t[t.TEXTURE29=34013]="TEXTURE29",t[t.TEXTURE30=34014]="TEXTURE30",t[t.TEXTURE31=34015]="TEXTURE31",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.COPY_SRC=1]="COPY_SRC",t[t.COPY_DST=2]="COPY_DST",t[t.SAMPLED=4]="SAMPLED",t[t.STORAGE=8]="STORAGE",t[t.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"}(Ig||(Ig={}));var jg=(Og=(0,rg.b2)(),Rg=(0,rg.f3)(ig.GeometryComponentManager),Lg=(0,rg.f3)(ig.RenderEngine),Og((Fg=function(){function t(){(0,Hd.Z)(this,t),(0,Wd.Z)(this,"geometry",Bg,this),(0,Wd.Z)(this,"engine",zg,this)}var e;return(0,Xd.Z)(t,[{key:"execute",value:(e=(0,Qd.Z)(Kd().mark((function t(){var e=this;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.geometry.forEach((function(t,n){n.dirty&&(n.attributes.forEach((function(t){var n;t.dirty&&t.data&&(t.buffer?null===(n=t.buffer)||void 0===n||n.subData({data:t.data,offset:0}):t.buffer=e.engine.createBuffer({data:t.data,type:Ig.FLOAT}),t.dirty=!1)})),n.indices&&(n.indicesBuffer?n.indicesBuffer.subData({data:n.indices,offset:0}):n.indicesBuffer=e.engine.createElements({data:n.indices,count:n.indices.length,type:Ig.UNSIGNED_INT,usage:Ig.STATIC_DRAW})),n.dirty=!1)}));case 1:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"tearDown",value:function(){this.geometry.forEach((function(t,e){e.indicesBuffer&&e.indicesBuffer.destroy(),e.attributes.forEach((function(t){t.buffer&&t.buffer.destroy()}))})),this.geometry.clear()}},{key:"createBufferGeometry",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{vertexCount:3},e=t.vertexCount,n=$d();return this.geometry.create(n,{vertexCount:e})}},{key:"createInstancedBufferGeometry",value:function(t){var e=t.maxInstancedCount,n=t.vertexCount,r=$d();return this.geometry.create(r,{maxInstancedCount:e,vertexCount:n})}}]),t}(),Ng=Fg,Bg=(0,Yd.Z)(Ng.prototype,"geometry",[Rg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zg=(0,Yd.Z)(Ng.prototype,"engine",[Lg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dg=Ng))||Dg);function Ug(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Gg(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ug(Object(n),!0).forEach((function(e){(0,wg.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ug(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Vg,Wg,Hg,Xg,Yg,qg,Kg,Qg,Jg,$g,tv=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(t){var e;return(0,Hd.Z)(this,i),(e=r.call(this,t)).vertexShaderGLSL=void 0,e.fragmentShaderGLSL=void 0,e.defines={},e.dirty=!0,e.uniforms=[],e.cull={enable:!0,face:Ig.BACK},e.depth={enable:!0},e.blend=void 0,e.entity=void 0,e.type=void 0,Object.assign((0,Eg.Z)(e),t),e}return(0,Xd.Z)(i,[{key:"setDefines",value:function(t){return this.defines=Gg(Gg({},this.defines),t),this}},{key:"setCull",value:function(t){return this.cull=t,this}},{key:"setDepth",value:function(t){return this.depth=t,this}},{key:"setBlend",value:function(t){return this.blend=t,this}},{key:"setUniform",value:function(t,e){var n=this;if("string"!=typeof t)return Object.keys(t).forEach((function(e){return n.setUniform(e,t[e])})),this;var r=this.uniforms.find((function(e){return e.name===t}));return r?(r.dirty=!0,r.data=e):this.uniforms.push({name:t,dirty:!0,data:e}),this.dirty=!0,this}}]),i}(tg);function ev(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function nv(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ev(Object(n),!0).forEach((function(e){(0,wg.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ev(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var rv,iv=(Vg=(0,rg.b2)(),Wg=(0,rg.f3)(ig.MaterialComponentManager),Hg=(0,rg.f3)(ig.RenderEngine),Xg=(0,rg.f3)(ig.ShaderModuleService),Vg(($g=function(){function t(){(0,Hd.Z)(this,t),(0,Wd.Z)(this,"material",Kg,this),(0,Wd.Z)(this,"engine",Qg,this),(0,Wd.Z)(this,"shaderModule",Jg,this)}var e;return(0,Xd.Z)(t,[{key:"execute",value:(e=(0,Qd.Z)(Kd().mark((function t(){return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),function(){return e.apply(this,arguments)})},{key:"tearDown",value:function(){this.material.clear()}},{key:"createShaderMaterial",value:function(t){var e=$d(),n=t.vertexShader,r=t.fragmentShader,i=[];if(!this.engine.supportWebGPU){var o="material-".concat(e);this.shaderModule.registerModule(o,{vs:t.vertexShader,fs:t.fragmentShader});var a=this.shaderModule.getModule(o);n=a.vs,r=a.fs,a.uniforms&&(i=Object.keys(a.uniforms).map((function(t){return{dirty:!0,name:t,data:a.uniforms[t]}})))}return this.material.create(e,nv(nv({vertexShaderGLSL:n,fragmentShaderGLSL:r},t),{},{uniforms:i}))}}]),t}(),qg=$g,Kg=(0,Yd.Z)(qg.prototype,"material",[Wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qg=(0,Yd.Z)(qg.prototype,"engine",[Hg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jg=(0,Yd.Z)(qg.prototype,"shaderModule",[Xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yg=qg))||Yg);!function(t){t[t.Standard=0]="Standard"}(rv||(rv={}));var ov=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(t){var e;return(0,Hd.Z)(this,i),(e=r.call(this,t)).strategy=rv.Standard,e.visibilityPlaneMask=0,e.visible=!1,Object.assign((0,Eg.Z)(e),t),e}return i}(tg),av=function(){function t(e,n){(0,Hd.Z)(this,t),this.center=void 0,this.halfExtents=void 0,this.min=Pe.create(),this.max=Pe.create(),this.update(e,n)}return(0,Xd.Z)(t,[{key:"update",value:function(t,e){this.center=t||Pe.create(),this.halfExtents=e||Pe.fromValues(.5,.5,.5),this.min=Pe.sub(this.min,this.center,this.halfExtents),this.max=Pe.add(this.max,this.center,this.halfExtents)}},{key:"setMinMax",value:function(t,e){Pe.add(this.center,e,t),Pe.scale(this.center,this.center,.5),Pe.sub(this.halfExtents,e,t),Pe.scale(this.halfExtents,this.halfExtents,.5),Pe.copy(this.min,t),Pe.copy(this.max,e)}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"add",value:function(t){var e=this.center,n=e[0],r=e[1],i=e[2],o=this.halfExtents,a=o[0],s=o[1],u=o[2],l=n-a,c=n+a,h=r-s,f=r+s,p=i-u,d=i+u,g=t.center,v=g[0],m=g[1],y=g[2],_=t.halfExtents,b=_[0],x=_[1],w=_[2],E=v-b,S=v+b,C=m-x,A=m+x,T=y-w,k=y+w;E<l&&(l=E),S>c&&(c=S),C<h&&(h=C),A>f&&(f=A),T<p&&(p=T),k>d&&(d=k),e[0]=.5*(l+c),e[1]=.5*(h+f),e[2]=.5*(p+d),o[0]=.5*(c-l),o[1]=.5*(f-h),o[2]=.5*(d-p),this.min[0]=l,this.min[1]=h,this.min[2]=p,this.max[0]=c,this.max[1]=f,this.max[2]=d}},{key:"intersects",value:function(t){var e=this.getMax(),n=this.getMin(),r=t.getMax(),i=t.getMin();return n[0]<=r[0]&&e[0]>=i[0]&&n[1]<=r[1]&&e[1]>=i[1]&&n[2]<=r[2]&&e[2]>=i[2]}},{key:"containsPoint",value:function(t){var e=this.getMin(),n=this.getMax();return!(t[0]<e[0]||t[0]>n[0]||t[1]<e[1]||t[1]>n[1]||t[2]<e[2]||t[2]>n[2])}},{key:"getNegativeFarPoint",value:function(t){return 273===t.pnVertexFlag?Pe.copy(Pe.create(),this.min):272===t.pnVertexFlag?Pe.fromValues(this.min[0],this.min[1],this.max[2]):257===t.pnVertexFlag?Pe.fromValues(this.min[0],this.max[1],this.min[2]):256===t.pnVertexFlag?Pe.fromValues(this.min[0],this.max[1],this.max[2]):17===t.pnVertexFlag?Pe.fromValues(this.max[0],this.min[1],this.min[2]):16===t.pnVertexFlag?Pe.fromValues(this.max[0],this.min[1],this.max[2]):1===t.pnVertexFlag?Pe.fromValues(this.max[0],this.max[1],this.min[2]):Pe.fromValues(this.max[0],this.max[1],this.max[2])}},{key:"getPositiveFarPoint",value:function(t){return 273===t.pnVertexFlag?Pe.copy(Pe.create(),this.max):272===t.pnVertexFlag?Pe.fromValues(this.max[0],this.max[1],this.min[2]):257===t.pnVertexFlag?Pe.fromValues(this.max[0],this.min[1],this.max[2]):256===t.pnVertexFlag?Pe.fromValues(this.max[0],this.min[1],this.min[2]):17===t.pnVertexFlag?Pe.fromValues(this.min[0],this.max[1],this.max[2]):16===t.pnVertexFlag?Pe.fromValues(this.min[0],this.max[1],this.min[2]):1===t.pnVertexFlag?Pe.fromValues(this.min[0],this.min[1],this.max[2]):Pe.fromValues(this.min[0],this.min[1],this.min[2])}}]),t}();var sv,uv=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(t){var e;return(0,Hd.Z)(this,i),(e=r.call(this,t)).material=void 0,e.geometry=void 0,e.aabb=new av,e.aabbDirty=!0,e.model=void 0,e.visible=!0,e.children=[],Object.assign((0,Eg.Z)(e),t),e}return i}(tg),lv=function(){function t(e,n){(0,Hd.Z)(this,t),this.distance=void 0,this.normal=void 0,this.pnVertexFlag=void 0,this.distance=e||0,this.normal=n||Pe.fromValues(0,1,0),this.updatePNVertexFlag()}return(0,Xd.Z)(t,[{key:"updatePNVertexFlag",value:function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)}},{key:"distanceToPoint",value:function(t){return Pe.dot(t,this.normal)-this.distance}},{key:"normalize",value:function(){var t=1/Pe.len(this.normal);Pe.scale(this.normal,this.normal,t),this.distance*=t}},{key:"intersectsLine",value:function(t,e,n){var r=this.distanceToPoint(t),i=r/(r-this.distanceToPoint(e)),o=i>=0&&i<=1;return o&&n&&Pe.lerp(n,t,e,i),o}}]),t}();!function(t){t[t.OUTSIDE=4294967295]="OUTSIDE",t[t.INSIDE=0]="INSIDE",t[t.INDETERMINATE=2147483647]="INDETERMINATE"}(sv||(sv={}));var cv,hv,fv,pv,dv,gv,vv,mv,yv,_v,bv,xv,wv,Ev,Sv=function(){function t(e){if((0,Hd.Z)(this,t),this.planes=[],e)this.planes=e;else for(var n=0;n<6;n++)this.planes.push(new lv)}return(0,Xd.Z)(t,[{key:"extractFromVPMatrix",value:function(t){var e=(0,ng.Z)(t,16),n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],p=e[11],d=e[12],g=e[13],v=e[14],m=e[15];Pe.set(this.planes[0].normal,o-n,l-a,p-c),this.planes[0].distance=-(m-d),Pe.set(this.planes[1].normal,o+n,l+a,p+c),this.planes[1].distance=-(m+d),Pe.set(this.planes[2].normal,o+r,l+s,p+h),this.planes[2].distance=-(m+g),Pe.set(this.planes[3].normal,o-r,l-s,p-h),this.planes[3].distance=-(m-g),Pe.set(this.planes[4].normal,o-i,l-u,p-f),this.planes[4].distance=-(m-v),Pe.set(this.planes[5].normal,o+i,l+u,p+f),this.planes[5].distance=-(m+v),this.planes.forEach((function(t){t.normalize(),t.updatePNVertexFlag()}))}}]),t}();function Cv(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Av(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Av(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Av(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Tv,kv,Mv,Pv,Iv,Ov,Rv,Lv,Dv,Nv,Bv,zv,Fv,Zv,jv,Uv,Gv,Vv,Wv,Hv,Xv,Yv,qv,Kv,Qv=(cv=(0,rg.b2)(),hv=(0,rg.f3)(ig.MeshComponentManager),fv=(0,rg.f3)(ig.CullableComponentManager),pv=(0,rg.f3)(ig.GeometryComponentManager),dv=(0,rg.f3)(ig.HierarchyComponentManager),gv=(0,rg.f3)(ig.TransformComponentManager),cv((Ev=function(){function t(){(0,Hd.Z)(this,t),(0,Wd.Z)(this,"mesh",yv,this),(0,Wd.Z)(this,"cullable",_v,this),(0,Wd.Z)(this,"geometry",bv,this),(0,Wd.Z)(this,"hierarchy",xv,this),(0,Wd.Z)(this,"transform",wv,this),this.planes=void 0}var e;return(0,Xd.Z)(t,[{key:"setFrustumPlanes",value:function(t){this.planes=t}},{key:"execute",value:(e=(0,Qd.Z)(Kd().mark((function t(e){var n,r,i,o,a,s,u,l,c,h,f,p,d,g,v,m,y,_,b,x,w;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=Cv(e);try{for(n.s();!(r=n.n()).done;){i=r.value,o=i.getScene(),a=i.getCamera(),s=Cv(o.getEntities());try{for(s.s();!(u=s.n()).done;)l=u.value,(c=this.mesh.getComponentByEntity(l))&&(h=this.hierarchy.getComponentByEntity(l),f=this.cullable.getComponentByEntity(l),p=c.geometry,d=this.transform.getComponentByEntity(l),p&&p.aabb&&d&&c.aabbDirty&&(g=d.worldTransform,v=p.aabb,m=v.center,y=v.halfExtents,_=Pe.transformMat4(Pe.create(),m,g),E=g,(S=T())[0]=E[0],S[1]=E[1],S[2]=E[2],S[3]=E[4],S[4]=E[5],S[5]=E[6],S[6]=E[8],S[7]=E[9],S[8]=E[10],b=S,x=Pe.transformMat3(Pe.create(),y,b),c.aabb.update(_,x),c.aabbDirty=!1),f&&p&&(w=this.cullable.getComponentByEntity((null==h?void 0:h.parentID)||-1),f.visibilityPlaneMask=this.computeVisibilityWithPlaneMask(c.aabb,(null==w?void 0:w.visibilityPlaneMask)||sv.INDETERMINATE,this.planes||a.getFrustum().planes),f.visible=f.visibilityPlaneMask!==sv.OUTSIDE))}catch(t){s.e(t)}finally{s.f()}}}catch(t){n.e(t)}finally{n.f()}case 2:case"end":return t.stop()}var E,S}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"tearDown",value:function(){this.cullable.clear(),this.mesh.clear()}},{key:"computeVisibilityWithPlaneMask",value:function(t,e,n){if(e===sv.OUTSIDE||e===sv.INSIDE)return e;for(var r=sv.INSIDE,i=0,o=n.length;i<o;++i){var a=i<31?1<<i:0;if(!(i<31&&0==(e&a))){var s=n[i],u=s.normal,l=s.distance;if(Pe.dot(u,t.getNegativeFarPoint(n[i]))+l>0)return sv.OUTSIDE;Pe.dot(u,t.getPositiveFarPoint(n[i]))+l>0&&(r|=a)}}return r}}]),t}(),mv=Ev,yv=(0,Yd.Z)(mv.prototype,"mesh",[hv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_v=(0,Yd.Z)(mv.prototype,"cullable",[fv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bv=(0,Yd.Z)(mv.prototype,"geometry",[pv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xv=(0,Yd.Z)(mv.prototype,"hierarchy",[dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wv=(0,Yd.Z)(mv.prototype,"transform",[gv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vv=mv))||vv),Jv=n(5975);function $v(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return tm(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tm(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function tm(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var em,nm,rm,im,om,am,sm,um,lm,cm,hm,fm,pm,dm=(Tv=(0,rg.b2)(),kv=(0,rg.f3)(ig.MeshComponentManager),Mv=(0,rg.f3)(ig.GeometryComponentManager),Pv=(0,rg.f3)(ig.MaterialComponentManager),Iv=(0,rg.f3)(ig.CullableComponentManager),Ov=(0,rg.f3)(ig.TransformComponentManager),Rv=(0,rg.f3)(ig.HierarchyComponentManager),Lv=(0,rg.f3)(ig.Systems),Dv=(0,rg.t6)(ig.FrameGraphSystem),Nv=(0,rg.f3)(ig.RenderEngine),Bv=(0,rg.f3)(ig.ResourcePool),Tv((Kv=qv=function(){function t(){var e=this;(0,Hd.Z)(this,t),(0,Wd.Z)(this,"mesh",Zv,this),(0,Wd.Z)(this,"geometry",jv,this),(0,Wd.Z)(this,"material",Uv,this),(0,Wd.Z)(this,"cullable",Gv,this),(0,Wd.Z)(this,"transform",Vv,this),(0,Wd.Z)(this,"hierarchy",Wv,this),(0,Wd.Z)(this,"frameGraphSystem",Hv,this),(0,Wd.Z)(this,"engine",Xv,this),(0,Wd.Z)(this,"resourcePool",Yv,this),this.modelCache={},this.setup=function(t,e,n){var r=t.createRenderTarget(e,"color buffer",{width:1,height:1,usage:Ig.RENDER_ATTACHMENT|Ig.SAMPLED|Ig.COPY_SRC});n.data={output:e.write(t,r)}},this.execute=function(){var t=(0,Qd.Z)(Kd().mark((function t(n,r,i){var o,a,s,u,l,c;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=n.getResourceNode(r.data.output),a=e.resourcePool.getOrCreateResource(o.resource),s=$v(i),t.prev=3,s.s();case 5:if((u=s.n()).done){t.next=11;break}return l=u.value,t.next=9,e.initView(l);case 9:t.next=5;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),s.e(t.t0);case 16:return t.prev=16,s.f(),t.finish(16);case 19:c=e.engine.getCanvas(),a.resize({width:c.width,height:c.height}),e.engine.setScissor({enable:!1}),e.engine.clear({framebuffer:a,color:i[0].getClearColor(),depth:1}),e.engine.useFramebuffer(a,(function(){var t,n=$v(i);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.renderView(r)}}catch(t){n.e(t)}finally{n.f()}}));case 24:case"end":return t.stop()}}),t,null,[[3,13,16,19]])})));return function(e,n,r){return t.apply(this,arguments)}}()}var e,n;return(0,Xd.Z)(t,[{key:"renderView",value:function(t){var e=t.getScene(),n=t.getCamera(),r=n.getViewTransform(),i=Jv.multiply(Jv.create(),n.getPerspective(),r);n.getFrustum().extractFromVPMatrix(i);var o=t.getViewport(),a=o.x,s=o.y,u=o.width,l=o.height;this.engine.viewport({x:a,y:s,width:u,height:l});var c,h=$v(e.getEntities());try{for(h.s();!(c=h.n()).done;){var f=c.value;this.renderMesh(f,{camera:n,view:t,viewMatrix:r})}}catch(t){h.e(t)}finally{h.f()}}},{key:"renderMesh",value:function(t,e){var n=e.camera,r=e.view,i=e.viewMatrix,o=this.mesh.getComponentByEntity(t);if(o&&o.visible){var a=o.material,s=o.geometry;if(s&&!s.dirty&&a){var u=this.transform.getComponentByEntity(t),l=Jv.multiply(Jv.create(),i,u.worldTransform),c=r.getViewport(),h=c.width,f=c.height;a.setUniform({projectionMatrix:n.getPerspective(),modelViewMatrix:l,modelMatrix:u.worldTransform,viewMatrix:i,cameraPosition:n.getPosition(),u_viewport:[h,f]}),o.model&&(o.model.draw({uniforms:a.uniforms.reduce((function(t,e){return t[e.name]=e.data,t}),{})}),a.uniforms.forEach((function(t){t.dirty=!1})),a.dirty=!1)}}}},{key:"initMesh",value:(n=(0,Qd.Z)(Kd().mark((function t(e,n){var r,i,o,a,s,u,l,c;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.mesh.getComponentByEntity(e)){t.next=3;break}return t.abrupt("return");case 3:if(i=r.material,(o=r.geometry)&&!o.dirty&&i){t.next=7;break}return t.abrupt("return");case 7:if(r.model){t.next=24;break}if(a="m-".concat(i.entity,"-g-").concat(o.entity),!this.modelCache[a]){t.next=12;break}return r.model=this.modelCache[a],t.abrupt("return");case 12:return i.setUniform({projectionMatrix:1,modelViewMatrix:1,modelMatrix:1,viewMatrix:1,cameraPosition:1,u_viewport:1}),s=this.engine,u=s.createModel,l=s.createAttribute,c={vs:i.vertexShaderGLSL,fs:i.fragmentShaderGLSL,defines:i.defines,attributes:o.attributes.reduce((function(t,e){return e.data&&e.buffer&&(t[e.name]=l({buffer:e.buffer,attributes:e.attributes,arrayStride:e.arrayStride,stepMode:e.stepMode,divisor:"vertex"===e.stepMode?0:1})),t}),{}),uniforms:i.uniforms.reduce((function(t,e){return t[e.name]=e.data,t}),{}),scissor:{enable:!0,box:function(){return n.getViewport()}}},i.cull&&(c.cull=i.cull),i.depth&&(c.depth=i.depth),i.blend&&(c.blend=i.blend),o.indicesBuffer&&(c.elements=o.indicesBuffer),o.maxInstancedCount&&(c.instances=o.maxInstancedCount,c.count=o.vertexCount||3),t.next=22,u(c);case 22:r.model=t.sent,this.modelCache[a]=r.model;case 24:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"initView",value:(e=(0,Qd.Z)(Kd().mark((function t(e){var n,r,i,o;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.getScene(),r=$v(n.getEntities()),t.prev=2,r.s();case 4:if((i=r.n()).done){t.next=10;break}return o=i.value,t.next=8,this.initMesh(o,e);case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),r.e(t.t0);case 15:return t.prev=15,r.f(),t.finish(15);case 18:case"end":return t.stop()}}),t,this,[[2,12,15,18]])}))),function(t){return e.apply(this,arguments)})}]),t}(),qv.IDENTIFIER="Render Pass",Fv=Kv,Zv=(0,Yd.Z)(Fv.prototype,"mesh",[kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jv=(0,Yd.Z)(Fv.prototype,"geometry",[Mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uv=(0,Yd.Z)(Fv.prototype,"material",[Pv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gv=(0,Yd.Z)(Fv.prototype,"cullable",[Iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vv=(0,Yd.Z)(Fv.prototype,"transform",[Ov],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wv=(0,Yd.Z)(Fv.prototype,"hierarchy",[Rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hv=(0,Yd.Z)(Fv.prototype,"frameGraphSystem",[Lv,Dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xv=(0,Yd.Z)(Fv.prototype,"engine",[Nv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yv=(0,Yd.Z)(Fv.prototype,"resourcePool",[Bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zv=Fv))||zv);function gm(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return vm(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vm(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function vm(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var mm,ym,_m,bm,xm,wm,Em,Sm,Cm,Am,Tm,km,Mm,Pm,Im,Om,Rm,Lm,Dm,Nm,Bm,zm,Fm=(em=(0,rg.b2)(),nm=(0,rg.f3)(ig.RenderEngine),rm=(0,rg.f3)(ig.ResourcePool),im=(0,rg.f3)(ig.RenderPassFactory),om=(0,rg.f3)(ig.MeshComponentManager),em((pm=fm=function(){function t(){var e=this;(0,Hd.Z)(this,t),(0,Wd.Z)(this,"engine",um,this),(0,Wd.Z)(this,"resourcePool",lm,this),(0,Wd.Z)(this,"renderPassFactory",cm,this),(0,Wd.Z)(this,"mesh",hm,this),this.pickingFBO=void 0,this.views=void 0,this.highlightEnabled=!0,this.highlightColor=[255,0,0,255],this.alreadyInRendering=!1,this.setup=function(t,e,n){var r=t.createRenderTarget(e,"picking fbo",{width:1,height:1});n.data={output:e.write(t,r)},e.hasSideEffect=!0},this.execute=function(){var t=(0,Qd.Z)(Kd().mark((function t(n,r,i){var o,a,s;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.views=i,!e.alreadyInRendering){t.next=3;break}return t.abrupt("return");case 3:o=gm(i);try{for(s=function(){var t=a.value,i=t.getViewport(),o=i.width,s=i.height;e.alreadyInRendering=!0;var u=n.getResourceNode(r.data.output);e.pickingFBO=e.resourcePool.getOrCreateResource(u.resource),e.pickingFBO.resize({width:o,height:s}),e.engine.useFramebuffer(e.pickingFBO,(function(){e.engine.clear({framebuffer:e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n,r=e.renderPassFactory(dm.IDENTIFIER),i=[],o=gm(t.getScene().getEntities());try{for(o.s();!(n=o.n()).done;){var a=n.value,s=e.mesh.getComponentByEntity(a);s.material.setUniform("u_PickingStage",1),i.push(s)}}catch(t){o.e(t)}finally{o.f()}r.renderView(t),i.forEach((function(t){t.material.setUniform("u_PickingStage",2)})),e.alreadyInRendering=!1}))},o.s();!(a=o.n()).done;)s()}catch(t){o.e(t)}finally{o.f()}case 5:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),this.pick=function(t,n){var r,i,o=t.x,a=t.y,s=e.engine,u=s.readPixels,l=s.useFramebuffer,c=n.getViewport(),h=c.width,f=c.height,p=o*window.devicePixelRatio,d=a*window.devicePixelRatio;if(!(p>h||p<0||d>f||d<0))return l(e.pickingFBO,(function(){0===(r=u({x:Math.round(p),y:Math.round(f-(a+1)*window.devicePixelRatio),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]&&0===r[1]&&0===r[2]||(i=function(t){var e=(0,ng.Z)(t,3);return e[0]+256*e[1]+65536*e[2]-1}(r),e.highlightEnabled&&e.highlightPickedFeature(r,n))})),i}}return(0,Xd.Z)(t,[{key:"enableHighlight",value:function(t){this.highlightEnabled=t}},{key:"setHighlightColor",value:function(t){this.highlightColor=t}},{key:"highlightPickedFeature",value:function(t,e){if(t){var n,r=gm(e.getScene().getEntities());try{for(r.s();!(n=r.n()).done;){var i=n.value,o=this.mesh.getComponentByEntity(i).material;o.setUniform("u_PickingStage",2),o.setUniform("u_PickingColor",[t[0],t[1],t[2]]),o.setUniform("u_HighlightColor",this.highlightColor)}}catch(t){r.e(t)}finally{r.f()}}}}]),t}(),fm.IDENTIFIER="PixelPicking Pass",sm=pm,um=(0,Yd.Z)(sm.prototype,"engine",[nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm=(0,Yd.Z)(sm.prototype,"resourcePool",[rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cm=(0,Yd.Z)(sm.prototype,"renderPassFactory",[im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hm=(0,Yd.Z)(sm.prototype,"mesh",[om],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am=sm))||am),Zm=(mm=(0,rg.b2)(),ym=(0,rg.f3)(ig.RenderEngine),_m=(0,rg.f3)(ig.ResourcePool),mm((Cm=Sm=function t(){var e=this;(0,Hd.Z)(this,t),(0,Wd.Z)(this,"engine",wm,this),(0,Wd.Z)(this,"resourcePool",Em,this),this.model=void 0,this.setup=function(t,e,n){var r=t.getPass(dm.IDENTIFIER);if(r){var i=t.createRenderTarget(e,"render to screen",{width:1,height:1});n.data={input:e.read(r.data.output),output:e.write(t,i)}}},this.execute=function(){var t=(0,Qd.Z)(Kd().mark((function t(n,r){var i,o,a,s,u,l,c;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.engine,o=i.createModel,a=i.createAttribute,s=i.createBuffer,e.model){t.next=6;break}return t.next=4,o({vs:e.engine.supportWebGPU?"layout(location = 0) in vec2 a_Position;\nlayout(location = 0) out vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}":"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:e.engine.supportWebGPU?"layout(set = 0, binding = 0) uniform sampler u_TextureSampler;\nlayout(set = 0, binding = 1) uniform texture2D u_Texture;\n\nlayout(location = 0) in vec2 v_UV;\nlayout(location = 0) out vec4 outColor;\n\nvoid main() {\n  outColor = texture(sampler2D(u_Texture, u_TextureSampler), v_UV);\n}":"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}",attributes:{a_Position:a({buffer:s({data:[-4,-4,4,-4,0,4],type:Ig.FLOAT}),size:2,arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]})},uniforms:{u_Texture:null},depth:{enable:!1},count:3,blend:{enable:!0}});case 4:u=t.sent,e.model=u;case 6:l=n.getResourceNode(r.data.input),c=e.resourcePool.getOrCreateResource(l.resource),e.engine.useFramebuffer(null,(function(){e.engine.clear({framebuffer:null,color:[0,0,0,0],depth:1,stencil:0}),e.model.draw({uniforms:{u_Texture:c}})}));case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),this.tearDown=function(){e.model=void 0}},Sm.IDENTIFIER="Copy Pass",xm=Cm,wm=(0,Yd.Z)(xm.prototype,"engine",[ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Em=(0,Yd.Z)(xm.prototype,"resourcePool",[_m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bm=xm))||bm),jm=(Am=(0,rg.b2)(),Tm=(0,rg.f3)(ig.Systems),km=(0,rg.t6)(ig.FrameGraphSystem),Mm=(0,rg.f3)(ig.RenderPassFactory),Pm=(0,rg.f3)(ig.ConfigService),Im=(0,rg.f3)(ig.ResourcePool),Am((zm=function(){function t(){(0,Hd.Z)(this,t),(0,Wd.Z)(this,"frameGraphSystem",Lm,this),(0,Wd.Z)(this,"renderPassFactory",Dm,this),(0,Wd.Z)(this,"configService",Nm,this),(0,Wd.Z)(this,"resourcePool",Bm,this)}var e;return(0,Xd.Z)(t,[{key:"execute",value:(e=(0,Qd.Z)(Kd().mark((function t(e){var n,r,i,o,a,s,u,l;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this.renderPassFactory(dm.IDENTIFIER),r=n.setup,i=n.execute,this.frameGraphSystem.addPass(dm.IDENTIFIER,r,i),o=this.renderPassFactory(Zm.IDENTIFIER),a=o.setup,s=o.execute,u=o.tearDown,l=this.frameGraphSystem.addPass(Zm.IDENTIFIER,a,s,u),this.frameGraphSystem.present(l.data.output);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"tearDown",value:function(){this.resourcePool.clean()}},{key:"pick",value:function(t,e){return this.renderPassFactory(Fm.IDENTIFIER).pick(t,e)}}]),t}(),Rm=zm,Lm=(0,Yd.Z)(Rm.prototype,"frameGraphSystem",[Tm,km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dm=(0,Yd.Z)(Rm.prototype,"renderPassFactory",[Mm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nm=(0,Yd.Z)(Rm.prototype,"configService",[Pm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bm=(0,Yd.Z)(Rm.prototype,"resourcePool",[Im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Om=Rm))||Om);var Um,Gm,Vm,Wm,Hm,Xm,Ym,qm,Km,Qm,Jm=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(t){var e;return(0,Hd.Z)(this,i),(e=r.call(this,t)).parentID=void 0,Object.assign((0,Eg.Z)(e),t),e}return i}(tg),$m=(Um=(0,rg.b2)(),Gm=(0,rg.f3)(ig.HierarchyComponentManager),Vm=(0,rg.f3)(ig.TransformComponentManager),Wm=(0,rg.f3)(ig.MeshComponentManager),Um((Qm=function(){function t(){(0,Hd.Z)(this,t),(0,Wd.Z)(this,"hierarchy",Ym,this),(0,Wd.Z)(this,"transform",qm,this),(0,Wd.Z)(this,"mesh",Km,this)}var e;return(0,Xd.Z)(t,[{key:"execute",value:(e=(0,Qd.Z)(Kd().mark((function t(){return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.runTransformUpdateSystem(),this.runHierarchyUpdateSystem();case 2:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"tearDown",value:function(){this.hierarchy.clear(),this.transform.clear()}},{key:"getHierarchyComponentManager",value:function(){return this.hierarchy}},{key:"getTransformComponentManager",value:function(){return this.transform}},{key:"runTransformUpdateSystem",value:function(){var t=this;this.transform.forEach((function(e,n){(n.isDirty()||n.isLocalDirty())&&(t.setMeshAABBDirty(t.mesh.getComponentByEntity(e)),n.updateTransform())}))}},{key:"runHierarchyUpdateSystem",value:function(){var t=this;this.hierarchy.forEach((function(e,n){var r=t.transform.getComponentByEntity(e),i=t.transform.getComponentByEntity(n.parentID);null!==r&&null!==i&&r.updateTransformWithParent(i)}))}},{key:"attach",value:function(t,e,n){this.hierarchy.contains(t)&&this.detach(t),this.hierarchy.create(t,{parentID:e});var r=this.mesh.getComponentByEntity(e);if(this.setMeshAABBDirty(r),r&&-1===r.children.indexOf(t)&&r.children.push(t),this.hierarchy.getCount()>1)for(var i=this.hierarchy.getCount()-1;i>0;--i)for(var o=this.hierarchy.getEntity(i),a=0;a<i;++a)if(this.hierarchy.getComponent(a).parentID===o){this.hierarchy.moveItem(i,a),++i;break}this.hierarchy.getComponentByEntity(t);var s=this.transform.getComponentByEntity(e);null===s&&(s=this.transform.create(e));var u=this.transform.getComponentByEntity(t);null===u&&(u=this.transform.create(t),s=this.transform.getComponentByEntity(e)),u.parent=s,!n&&s&&(u.matrixTransform(Jv.invert(Jv.create(),s.worldTransform)),u.updateTransform()),s&&u.updateTransformWithParent(s)}},{key:"detach",value:function(t){var e=this.hierarchy.getComponentByEntity(t);if(null!==e){var n=this.transform.getComponentByEntity(t);null!==n&&(n.parent=null,n.applyTransform()),this.hierarchy.removeKeepSorted(t);var r=this.mesh.getComponentByEntity(e.parentID);if(r){var i=r.children.indexOf(t);r.children.splice(i,1)}this.setMeshAABBDirty(r)}}},{key:"detachChildren",value:function(t){var e=this.mesh.getComponentByEntity(t);e&&(e.children=[]);for(var n=0;n<this.hierarchy.getCount();){var r;if((null===(r=this.hierarchy.getComponent(n))||void 0===r?void 0:r.parentID)===t){var i=this.hierarchy.getEntity(n);this.detach(i)}else++n}}},{key:"setMeshAABBDirty",value:function(t){t&&(t.aabbDirty=!0)}}]),t}(),Xm=Qm,Ym=(0,Yd.Z)(Xm.prototype,"hierarchy",[Gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qm=(0,Yd.Z)(Xm.prototype,"transform",[Vm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Km=(0,Yd.Z)(Xm.prototype,"mesh",[Wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hm=Xm))||Hm);function ty(){var t=new A.WT(4);return A.WT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function ey(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function ny(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],l=n[2],c=n[3];return t[0]=r*c+a*s+i*l-o*u,t[1]=i*c+a*u+o*s-r*l,t[2]=o*c+a*l+r*u-i*s,t[3]=a*c-r*s-i*u-o*l,t}function ry(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=o*s,t}function iy(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var o=Math.sin(e),a=Math.cos(e),s=Math.sin(n),u=Math.cos(n),l=Math.sin(r),c=Math.cos(r);return t[0]=o*u*c-a*s*l,t[1]=a*s*c+o*u*l,t[2]=a*u*l-o*s*c,t[3]=a*u*c+o*s*l,t}Sg.d9;var oy=Sg.al,ay=Sg.JG,sy=(Sg.t8,Sg.IH,ny),uy=(Sg.bA,Sg.AK,Sg.t7,Sg.kE,Sg.we,Sg.Fv);Sg.I6,Sg.fS,Pe.create(),Pe.fromValues(1,0,0),Pe.fromValues(0,1,0),ty(),ty(),T();var ly=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(t){var e,n,o,a,s,u,l,c,h,f,p,d,g,v,m;return(0,Hd.Z)(this,i),(e=r.call(this,t)).dirtyFlag=void 0,e.localDirtyFlag=void 0,e.parent=null,e.localPosition=Pe.fromValues(0,0,0),e.localRotation=oy(0,0,0,1),e.localScale=Pe.fromValues(1,1,1),e.localTransform=Jv.create(),e.position=Pe.fromValues(0,0,0),e.rotation=oy(0,0,0,1),e.scaling=Pe.fromValues(1,1,1),e.worldTransform=Jv.create(),e.matrixTransform=(n=Jv.create(),function(t){Jv.multiply(n,e.getLocalTransform(),t),Jv.getScaling(e.localScale,n),Jv.getTranslation(e.localPosition,n),Jv.getRotation(e.localRotation,n)}),e.rotateRollPitchYaw=(o=ty(),a=ty(),s=ty(),function(t,n,r){e.setDirty(),iy(o,t,0,0),iy(a,0,n,0),iy(s,0,0,r),ny(e.localRotation,o,e.localRotation),ny(e.localRotation,e.localRotation,a),ny(e.localRotation,s,e.localRotation),uy(e.localRotation,e.localRotation)}),e.lerp=(u=Pe.create(),l=ty(),c=Pe.create(),h=Pe.create(),f=ty(),p=Pe.create(),function(t,n,r){e.setDirty(),Jv.getScaling(u,t.worldTransform),Jv.getTranslation(c,t.worldTransform),Jv.getRotation(l,t.worldTransform),Jv.getScaling(h,n.worldTransform),Jv.getTranslation(p,n.worldTransform),Jv.getRotation(f,n.worldTransform),Pe.lerp(e.localScale,u,h,r),function(t,e,n,r){var i,o,a,s,u,l=e[0],c=e[1],h=e[2],f=e[3],p=n[0],d=n[1],g=n[2],v=n[3];(o=l*p+c*d+h*g+f*v)<0&&(o=-o,p=-p,d=-d,g=-g,v=-v),1-o>A.Ib?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,u=Math.sin(r*i)/a):(s=1-r,u=r),t[0]=s*l+u*p,t[1]=s*c+u*d,t[2]=s*h+u*g,t[3]=s*f+u*v}(e.localRotation,l,f,r),Pe.lerp(e.localPosition,c,p,r)}),e.translate=(d=Pe.create(),function(t){return Pe.add(d,e.getPosition(),t),e.setPosition(d),e.setDirty(!0),(0,Eg.Z)(e)}),e.translateLocal=function(t){return Pe.transformQuat(t,t,e.localRotation),Pe.add(e.localPosition,e.localPosition,t),e.setLocalDirty(!0),(0,Eg.Z)(e)},e.setPosition=(g=Jv.create(),function(t){return e.position=t,e.setLocalDirty(!0),null===e.parent?Pe.copy(e.localPosition,t):(Jv.copy(g,e.parent.worldTransform),Jv.invert(g,g),Pe.transformMat4(e.localPosition,t,g)),(0,Eg.Z)(e)}),e.rotate=(v=ty(),function(t){if(null===e.parent)ny(e.localRotation,e.localRotation,t),uy(e.localRotation,e.localRotation);else{var n=e.getRotation(),r=e.parent.getRotation();ay(v,r),ry(v,v),ny(v,v,t),ny(e.localRotation,t,n),uy(e.localRotation,e.localRotation)}return e.setLocalDirty(),(0,Eg.Z)(e)}),e.rotateLocal=function(t){return ny(e.localRotation,e.localRotation,t),uy(e.localRotation,e.localRotation),e.setLocalDirty(!0),(0,Eg.Z)(e)},e.setRotation=(m=ty(),function(t){return null===e.parent?ay(e.localRotation,t):(ay(m,e.parent.getRotation()),ry(m,m),ay(e.localRotation,m),sy(e.localRotation,e.localRotation,t)),e.setLocalDirty(!0),(0,Eg.Z)(e)}),e}return(0,Xd.Z)(i,[{key:"setLocalPosition",value:function(t){Pe.copy(this.localPosition,t),this.setLocalDirty(!0)}},{key:"setLocalScale",value:function(t){Pe.copy(this.localScale,t),this.setLocalDirty(!0)}},{key:"setLocalRotation",value:function(t){return ay(this.localRotation,t),this.setLocalDirty(!0),this}},{key:"isDirty",value:function(){return this.dirtyFlag}},{key:"setDirty",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?this.dirtyFlag|=i.DIRTY:this.dirtyFlag&=~i.DIRTY}},{key:"isLocalDirty",value:function(){return this.localDirtyFlag}},{key:"setLocalDirty",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?(this.localDirtyFlag|=i.DIRTY,this.setDirty(!0)):this.localDirtyFlag&=~i.DIRTY}},{key:"updateTransform",value:function(){this.isLocalDirty()&&this.getLocalTransform(),this.isDirty()&&null===this.parent&&(Jv.copy(this.worldTransform,this.getLocalTransform()),this.setDirty(!1))}},{key:"updateTransformWithParent",value:function(t){Jv.multiply(this.worldTransform,t.worldTransform,this.getLocalTransform())}},{key:"applyTransform",value:function(){this.setDirty(),Jv.getScaling(this.localScale,this.worldTransform),Jv.getTranslation(this.localPosition,this.worldTransform),Jv.getRotation(this.localRotation,this.worldTransform)}},{key:"clearTransform",value:function(){this.setDirty(),this.localPosition=Pe.fromValues(0,0,0),this.localRotation=oy(0,0,0,1),this.localScale=Pe.fromValues(1,1,1)}},{key:"scaleLocal",value:function(t){return this.setLocalDirty(),Pe.multiply(this.localScale,this.localScale,t),this}},{key:"getLocalPosition",value:function(){return this.localPosition}},{key:"getLocalRotation",value:function(){return this.localRotation}},{key:"getLocalScale",value:function(){return this.localScale}},{key:"getLocalTransform",value:function(){return this.localDirtyFlag&&(Jv.fromRotationTranslationScale(this.localTransform,this.localRotation,this.localPosition,this.localScale),this.setLocalDirty(!1)),this.localTransform}},{key:"getWorldTransform",value:function(){return this.isLocalDirty()||this.isDirty()?(this.parent&&this.parent.getWorldTransform(),this.updateTransform(),this.worldTransform):this.worldTransform}},{key:"getPosition",value:function(){return Jv.getTranslation(this.position,this.worldTransform),this.position}},{key:"getRotation",value:function(){return Jv.getRotation(this.rotation,this.worldTransform),this.rotation}},{key:"getScale",value:function(){return Jv.getScaling(this.scaling,this.worldTransform),this.scaling}}]),i}(tg);ly.DIRTY=1;var cy,hy,fy,py,dy,gy,vy=n(4879),my=(cy=(0,rg.b2)(),hy=(0,rg.f3)(ig.RenderEngine),cy((gy=function(){function t(){(0,Hd.Z)(this,t),(0,Wd.Z)(this,"engine",dy,this),this.resourcePool={}}return(0,Xd.Z)(t,[{key:"getOrCreateResource",value:function(t){if(!this.resourcePool[t.name]){var e=t.descriptor,n=e.width,r=e.height,i=e.usage;this.resourcePool[t.name]=this.engine.createFramebuffer({color:this.engine.createTexture2D({width:n,height:r,wrapS:Ig.CLAMP_TO_EDGE,wrapT:Ig.CLAMP_TO_EDGE,usage:i})})}return this.resourcePool[t.name]}},{key:"clean",value:function(){this.resourcePool={}}}]),t}(),py=gy,dy=(0,Yd.Z)(py.prototype,"engine",[hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fy=py))||fy);var yy,_y,by,xy,wy=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(t){var e;return(0,Hd.Z)(this,i),(e=r.call(this,t)).name=void 0,e.name=t.name||"",e}return i}(tg),Ey=(0,rg.b2)()((_y=function(){function t(){(0,Hd.Z)(this,t),this.config=void 0}return(0,Xd.Z)(t,[{key:"get",value:function(){return this.config}},{key:"set",value:function(t){this.config=t}}]),t}(),yy=_y))||yy;!function(t){t.PANSTART="PANSTART",t.PANEND="PANEND",t.PANMOVE="PANMOVE",t.PINCH="PINCH",t.KEYDOWN="KEYDOWN",t.KEYUP="KEYUP",t.HOVER="HOVER"}(xy||(xy={}));var Sy,Cy,Ay=(0,rg.b2)()(by=function(){function t(){(0,Hd.Z)(this,t)}return(0,Xd.Z)(t,[{key:"listen",value:function(t){}},{key:"on",value:function(t,e){}},{key:"connect",value:function(){}},{key:"disconnect",value:function(){}},{key:"destroy",value:function(){}}]),t}())||by,Ty=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function ky(t){var e={};return{content:t=t.replace(Ty,(function(t,n,r){var i=r.split(":"),o=i[0].trim(),a="";switch(i.length>1&&(a=i[1].trim()),n){case"bool":a="true"===a;break;case"float":case"int":a=Number(a);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":a=a?a.replace("[","").replace("]","").split(",").reduce((function(t,e){return t.push(Number(e.trim())),t}),[]):new Array(function(t){var e=0;switch(t){case"vec2":case"ivec2":e=2;break;case"vec3":case"ivec3":e=3;break;case"vec4":case"ivec4":case"mat2":e=4;break;case"mat3":e=9;break;case"mat4":e=16}return e}(n)).fill(0)}return e[o]=a,"uniform ".concat(n," ").concat(o,";\n")})),uniforms:e}}function My(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Py(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?My(Object(n),!0).forEach((function(e){(0,wg.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):My(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Iy=/precision\s+(high|low|medium)p\s+float/,Oy=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Ry=(0,rg.b2)()((Cy=function(){function t(){(0,Hd.Z)(this,t),this.moduleCache={},this.rawContentCache={}}return(0,Xd.Z)(t,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\n\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\n\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  // compares only in highlight stage\n  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\n\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color) {\n  bool selected = bool(v_PickingResult.a);\n\n  if (selected) {\n    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(resultRGB, color.a);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  return filterPickingColor(filterHighlightColor(color));\n}\n"}),this.registerModule("sdf2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}"})}},{key:"registerModule",value:function(t,e){if(!this.rawContentCache[t]){var n=e.vs,r=void 0===n?"":n,i=e.fs,o=void 0===i?"":i,a=e.uniforms,s=ky(r),u=s.content,l=s.uniforms,c=ky(o),h=c.content,f=c.uniforms;this.rawContentCache[t]={fs:h,uniforms:Py(Py(Py({},l),f),a),vs:u}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var e=this;if(this.moduleCache[t])return this.moduleCache[t];var n=this.rawContentCache[t].vs||"",r=this.rawContentCache[t].fs||"",i=this.processModule(n,[],"vs"),o=i.content,a=i.includeList,s=this.processModule(r,[],"fs"),u=s.content,l=s.includeList,c=u,h=function(t){return t.filter((function(t,e,n){return n.indexOf(t)===e}))}(a.concat(l).concat(t)).reduce((function(t,n){return Py(Py({},t),e.rawContentCache[n].uniforms)}),{});return Iy.test(u)||(c="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"+u),this.moduleCache[t]={fs:c.trim(),uniforms:h,vs:o.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,e,n){var r=this;return{content:t.replace(Oy,(function(t,i){var o=i.split(" ")[0].replace(/"/g,"");if(e.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return e.push(o),r.processModule(a||"",e,n).content})),includeList:e}}}]),t}(),Sy=Cy))||Sy,Ly=new rg.W2;function Dy(){var t=new rg.W2;return t.parent=Ly,t.bind(ig.Systems).to($m).inSingletonScope().whenTargetNamed(ig.SceneGraphSystem),t.bind(ig.Systems).to(xg).inSingletonScope().whenTargetNamed(ig.FrameGraphSystem),t.bind(ig.Systems).to(Qv).inSingletonScope().whenTargetNamed(ig.MeshSystem),t.bind(ig.Systems).to(jg).inSingletonScope().whenTargetNamed(ig.GeometrySystem),t.bind(ig.Systems).to(iv).inSingletonScope().whenTargetNamed(ig.MaterialSystem),t.bind(ig.Systems).to(jm).inSingletonScope().whenTargetNamed(ig.RendererSystem),t.bind(ig.ResourcePool).to(my).inSingletonScope(),t.bind(ig.ConfigService).to(Ey).inSingletonScope(),t.bind(ig.InteractorService).to(Ay).inSingletonScope(),t.bind(ig.RenderPass).to(dm).inSingletonScope().whenTargetNamed(dm.IDENTIFIER),t.bind(ig.RenderPass).to(Zm).inSingletonScope().whenTargetNamed(Zm.IDENTIFIER),t.bind(ig.RenderPass).to(Fm).inSingletonScope().whenTargetNamed(Fm.IDENTIFIER),t.bind(ig.RenderPassFactory).toFactory((function(t){return function(e){return t.container.getNamed(ig.RenderPass,e)}})),t}function Ny(t){for(var e=new av,n=Pe.fromValues(t[0],t[1],t[2]),r=Pe.fromValues(t[0],t[1],t[2]),i=3;i<t.length;){var o=t[i++],a=t[i++],s=t[i++];o<n[0]&&(n[0]=o),a<n[1]&&(n[1]=a),s<n[2]&&(n[2]=s),o>r[0]&&(r[0]=o),a>r[1]&&(r[1]=a),s>r[2]&&(r[2]=s)}return e.setMinMax(n,r),e}(0,vy.Z)(Ly,!1),Ly.bind(ig.ShaderModuleService).to(Ry).inSingletonScope(),Ly.bind(ig.NameComponentManager).toConstantValue(new eg(wy)),Ly.bind(ig.HierarchyComponentManager).toConstantValue(new eg(Jm)),Ly.bind(ig.TransformComponentManager).toConstantValue(new eg(ly)),Ly.bind(ig.MeshComponentManager).toConstantValue(new eg(uv)),Ly.bind(ig.CullableComponentManager).toConstantValue(new eg(ov)),Ly.bind(ig.GeometryComponentManager).toConstantValue(new eg(Zg)),Ly.bind(ig.MaterialComponentManager).toConstantValue(new eg(tv));var By,zy,Fy,Zy,jy,Uy="undefined"!=typeof navigator&&/Version\/[\d\.]+.*Safari/.test(navigator.userAgent);function Gy(t){return"number"==typeof t}function Vy(t){return void 0===t?0:t>360||t<-360?t%360:t}function Wy(t,e,n){return Gy(t)?Pe.fromValues(t,e,n):3===t.length?Pe.clone(t):Pe.fromValues(t[0],t[1],t[2])}Pe.create(),Pe.create(),Pe.create(),Pe.create(),Pe.create(),Pe.create(),n(9518),n(6199),n(4156),n(1468),n(8871),n(9871),function(t){t.Normal="normal",t.PostProcessing="post-processing"}(By||(By={})),n(5612),n(2777),n(159),n(1622),n(499),n(4851),function(t){t.Void="Void",t.Boolean="Boolean",t.Float="Float",t.Uint32="Uint32",t.Int32="Int32",t.Vector="Vector",t.Vector2Float="vec2<f32>",t.Vector3Float="vec3<f32>",t.Vector4Float="vec4<f32>",t.Vector2Boolean="vec2<bool>",t.Vector3Boolean="vec3<bool>",t.Vector4Boolean="vec4<bool>",t.Vector2Uint="vec2<u32>",t.Vector3Uint="vec3<u32>",t.Vector4Uint="vec4<u32>",t.Vector2Int="vec2<i32>",t.Vector3Int="vec3<i32>",t.Vector4Int="vec4<i32>",t.Matrix="Matrix",t.Matrix3x3Float="mat3x3<f32>",t.Matrix4x4Float="mat4x4<i32>",t.Struct="Struct",t.FloatArray="Float[]",t.Vector4FloatArray="vec4<f32>[]"}(zy||(zy={})),function(t){t.Program="Program",t.Identifier="Identifier",t.VariableDeclaration="VariableDeclaration",t.BlockStatement="BlockStatement",t.ReturnStatement="ReturnStatement",t.FunctionDeclaration="FunctionDeclaration",t.VariableDeclarator="VariableDeclarator",t.AssignmentExpression="AssignmentExpression",t.LogicalExpression="LogicalExpression",t.BinaryExpression="BinaryExpression",t.ArrayExpression="ArrayExpression",t.UnaryExpression="UnaryExpression",t.UpdateExpression="UpdateExpression",t.FunctionExpression="FunctionExpression",t.MemberExpression="MemberExpression",t.ConditionalExpression="ConditionalExpression",t.ExpressionStatement="ExpressionStatement",t.CallExpression="CallExpression",t.NumThreadStatement="NumThreadStatement",t.StorageStatement="StorageStatement",t.DoWhileStatement="DoWhileStatement",t.WhileStatement="WhileStatement",t.ForStatement="ForStatement",t.BreakStatement="BreakStatement",t.ContinueStatement="ContinueStatement",t.IfStatement="IfStatement",t.ImportedFunctionStatement="ImportedFunctionStatement"}(Fy||(Fy={})),function(t){t.Input="Input",t.Output="Output",t.Uniform="Uniform",t.Workgroup="Workgroup",t.UniformConstant="UniformConstant",t.Image="Image",t.StorageBuffer="StorageBuffer",t.Private="Private",t.Function="Function"}(Zy||(Zy={})),function(t){t.GLSL100="GLSL100",t.GLSL450="GLSL450",t.WGSL="WGSL"}(jy||(jy={}));var Hy,Xy,Yy,qy,Ky,Qy,Jy,$y,t_,e_,n_=function(){function t(e,n){(0,Hd.Z)(this,t),this.name=void 0,this.matrix=void 0,this.right=void 0,this.up=void 0,this.forward=void 0,this.position=void 0,this.focalPoint=void 0,this.distanceVector=void 0,this.distance=void 0,this.dollyingStep=void 0,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.name=e,this.matrix=Jv.clone(n.matrix),this.right=Pe.clone(n.right),this.up=Pe.clone(n.up),this.forward=Pe.clone(n.forward),this.position=Pe.clone(n.position),this.focalPoint=Pe.clone(n.focalPoint),this.distanceVector=Pe.clone(n.distanceVector),this.azimuth=n.azimuth,this.elevation=n.elevation,this.roll=n.roll,this.relAzimuth=n.relAzimuth,this.relElevation=n.relElevation,this.relRoll=n.relRoll,this.dollyingStep=n.dollyingStep,this.distance=n.distance}return(0,Xd.Z)(t,[{key:"getPosition",value:function(){return this.position}},{key:"getFocalPoint",value:function(){return this.focalPoint}},{key:"getRoll",value:function(){return this.roll}},{key:"retrieve",value:function(t){t.matrix=Jv.copy(t.matrix,this.matrix),t.right=Pe.copy(t.right,this.right),t.up=Pe.copy(t.up,this.up),t.forward=Pe.copy(t.forward,this.forward),t.position=Pe.copy(t.position,this.position),t.focalPoint=Pe.copy(t.focalPoint,this.focalPoint),t.distanceVector=Pe.copy(t.distanceVector,this.distanceVector),t.azimuth=this.azimuth,t.elevation=this.elevation,t.roll=this.roll,t.relAzimuth=this.relAzimuth,t.relElevation=this.relElevation,t.relRoll=this.relRoll,t.dollyingStep=this.dollyingStep,t.distance=this.distance}}]),t}();!function(t){t.ORBITING="ORBITING",t.EXPLORING="EXPLORING",t.TRACKING="TRACKING"}($y||($y={})),function(t){t.DEFAULT="DEFAULT",t.ROTATIONAL="ROTATIONAL",t.TRANSLATIONAL="TRANSLATIONAL",t.CINEMATIC="CINEMATIC"}(t_||(t_={})),function(t){t.ORTHOGRAPHIC="ORTHOGRAPHIC",t.PERSPECTIVE="PERSPECTIVE"}(e_||(e_={}));var r_,i_,o_,a_,s_,u_,l_,c_=Math.PI/180,h_=180/Math.PI,f_=(Hy=(0,rg.b2)(),Xy=(0,rg.f3)(ig.InteractorService),Hy((Jy=Qy=function(){function t(){(0,Hd.Z)(this,t),this.matrix=Jv.create(),this.right=Pe.fromValues(1,0,0),this.up=Pe.fromValues(0,1,0),this.forward=Pe.fromValues(0,0,1),this.position=Pe.fromValues(0,0,1),this.focalPoint=Pe.fromValues(0,0,0),this.distanceVector=Pe.fromValues(0,0,0),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.rotateWorld=!1,(0,Wd.Z)(this,"interactor",Ky,this),this.fov=30,this.near=.1,this.far=1e4,this.aspect=1,this.left=void 0,this.rright=void 0,this.top=void 0,this.bottom=void 0,this.zoom=1,this.perspective=Jv.create(),this.view=void 0,this.following=void 0,this.type=$y.EXPLORING,this.trackingMode=t_.DEFAULT,this.projectionMode=e_.PERSPECTIVE,this.frustum=new Sv,this.landmarks=[],this.landmarkAnimationID=void 0}return(0,Xd.Z)(t,[{key:"clone",value:function(){var e=new t;return e.setType(this.type,void 0),e.interactor=this.interactor,e}},{key:"getProjectionMode",value:function(){return this.projectionMode}},{key:"getPerspective",value:function(){return this.perspective}},{key:"getFrustum",value:function(){return this.frustum}},{key:"getPosition",value:function(){return this.position}},{key:"setType",value:function(t,e){return this.type=t,this.type===$y.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===$y.TRACKING&&void 0!==e&&this.setTrackingMode(e),this}},{key:"setProjectionMode",value:function(t){return this.projectionMode=t,this}},{key:"setTrackingMode",value:function(t){if(this.type!==$y.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=t,this}},{key:"setWorldRotation",value:function(t){this.rotateWorld=t,this._getAngles()}},{key:"getViewTransform",value:function(){return Jv.invert(Jv.create(),this.matrix)}},{key:"getWorldTransform",value:function(){return this.matrix}},{key:"setMatrix",value:function(t){return this.matrix=t,this._update(),this}},{key:"setAspect",value:function(t){return this.setPerspective(this.near,this.far,this.fov,t),this}},{key:"setViewOffset",value:function(t,e,n,r,i,o){return this.aspect=t/e,void 0===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.projectionMode===e_.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"clearViewOffset",value:function(){return void 0!==this.view&&(this.view.enabled=!1),this.projectionMode===e_.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"setPerspective",value:function(t,e,n,r){return this.projectionMode=e_.PERSPECTIVE,this.fov=n,this.near=t,this.far=e,this.aspect=r,Jv.perspective(this.perspective,this.fov*c_,this.aspect,this.near,this.far),this}},{key:"setOrthographic",value:function(t,e,n,r,i,o){this.projectionMode=e_.ORTHOGRAPHIC,this.rright=e,this.left=t,this.top=n,this.bottom=r,this.near=i,this.far=o;var a=(this.rright-this.left)/(2*this.zoom),s=(this.top-this.bottom)/(2*this.zoom),u=(this.rright+this.left)/2,l=(this.top+this.bottom)/2,c=u-a,h=u+a,f=l+s,p=l-s;if(void 0!==this.view&&this.view.enabled){var d=(this.rright-this.left)/this.view.fullWidth/this.zoom,g=(this.top-this.bottom)/this.view.fullHeight/this.zoom;h=(c+=d*this.view.offsetX)+d*this.view.width,p=(f-=g*this.view.offsetY)-g*this.view.height}return Jv.ortho(this.perspective,c,h,f,p,i,o),this}},{key:"setPosition",value:function(t,e,n){return this._setPosition(t,e,n),this.setFocalPoint(this.focalPoint),this}},{key:"setFocalPoint",value:function(t,e,n){var r=Pe.fromValues(0,1,0);if(this.focalPoint=Wy(t,e,n),this.trackingMode===t_.CINEMATIC){var i=Pe.subtract(Pe.create(),this.focalPoint,this.position);t=i[0],e=i[1],n=i[2];var o=Pe.length(i),a=Math.asin(e/o)*h_,s=90+Math.atan2(n,t)*h_,u=Jv.create();Jv.rotateY(u,u,s*c_),Jv.rotateX(u,u,a*c_),r=Pe.transformMat4(Pe.create(),[0,1,0],u)}return Jv.invert(this.matrix,Jv.lookAt(Jv.create(),this.position,this.focalPoint,r)),this._getAxes(),this._getDistance(),this._getAngles(),this}},{key:"setDistance",value:function(t){if(!(this.distance===t||t<0)){this.distance=t,this.distance<2e-4&&(this.distance=2e-4),this.dollyingStep=this.distance/100;var e=Pe.create();t=this.distance;var n=this.forward,r=this.focalPoint;return e[0]=t*n[0]+r[0],e[1]=t*n[1]+r[1],e[2]=t*n[2]+r[2],this._setPosition(e),this}}},{key:"setMaxDistance",value:function(t){return this.maxDistance=t,this}},{key:"setMinDistance",value:function(t){return this.minDistance=t,this}},{key:"changeAzimuth",value:function(t){return this.setAzimuth(this.azimuth+t),this}},{key:"changeElevation",value:function(t){return this.setElevation(this.elevation+t),this}},{key:"changeRoll",value:function(t){return this.setRoll(this.roll+t),this}},{key:"setAzimuth",value:function(t){return this.azimuth=Vy(t),this.computeMatrix(),this._getAxes(),this.type===$y.ORBITING||this.type===$y.EXPLORING?this._getPosition():this.type===$y.TRACKING&&this._getFocalPoint(),this}},{key:"getAzimuth",value:function(){return this.azimuth}},{key:"setElevation",value:function(t){return this.elevation=Vy(t),this.computeMatrix(),this._getAxes(),this.type===$y.ORBITING||this.type===$y.EXPLORING?this._getPosition():this.type===$y.TRACKING&&this._getFocalPoint(),this}},{key:"setRoll",value:function(t){return this.roll=Vy(t),this.computeMatrix(),this._getAxes(),this.type===$y.ORBITING||this.type===$y.EXPLORING?this._getPosition():this.type===$y.TRACKING&&this._getFocalPoint(),this}},{key:"rotate",value:function(t,e,n){if(this.type===$y.EXPLORING){t=Vy(t),e=Vy(e),n=Vy(n);var r=ey(ty(),[1,0,0],(this.rotateWorld?1:-1)*e*c_),i=ey(ty(),[0,1,0],(this.rotateWorld?1:-1)*t*c_),o=ey(ty(),[0,0,1],n*c_),a=ny(ty(),i,r);a=ny(ty(),a,o);var s=Jv.fromQuat(Jv.create(),a);Jv.translate(this.matrix,this.matrix,[0,0,-this.distance]),Jv.multiply(this.matrix,this.matrix,s),Jv.translate(this.matrix,this.matrix,[0,0,this.distance])}else{if(Math.abs(this.elevation+e)>90)return;this.relElevation=Vy(e),this.relAzimuth=Vy(t),this.relRoll=Vy(n),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.computeMatrix()}return this._getAxes(),this.type===$y.ORBITING||this.type===$y.EXPLORING?this._getPosition():this.type===$y.TRACKING&&this._getFocalPoint(),this._update(),this}},{key:"pan",value:function(t,e){var n=Wy(t,e,0),r=Pe.clone(this.position);return Pe.add(r,r,Pe.scale(Pe.create(),this.right,n[0])),Pe.add(r,r,Pe.scale(Pe.create(),this.up,n[1])),this._setPosition(r),this}},{key:"dolly",value:function(t){var e=this.forward,n=Pe.clone(this.position),r=this.dollyingStep,i=this.distance+t*this.dollyingStep;return r=Math.max(Math.min(i,this.maxDistance),this.minDistance)-this.distance,n[0]+=r*e[0],n[1]+=r*e[1],n[2]+=r*e[2],this._setPosition(n),this.type===$y.ORBITING||this.type===$y.EXPLORING?this._getDistance():this.type===$y.TRACKING&&Pe.add(this.focalPoint,n,this.distanceVector),this}},{key:"createLandmark",value:function(t,e){var n=this.clone();n.setPosition(e.position),n.setFocalPoint(e.focalPoint),void 0!==e.roll&&n.setRoll(e.roll);var r=new n_(t,n);return this.landmarks.push(r),r}},{key:"setLandmark",value:function(t){var e=new n_(t,this);return this.landmarks.push(e),this}},{key:"gotoLandmark",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r=this.landmarks.find((function(e){return e.name===t}));if(r){if(0===n)return void r.retrieve(this);void 0!==this.landmarkAnimationID&&window.cancelAnimationFrame(this.landmarkAnimationID),this.interactor.disconnect();var i,o=r.getPosition(),a=r.getFocalPoint(),s=r.getRoll(),u=function t(r){void 0===i&&(i=r);var u,l=r-i,c=(1-Math.cos(l/n*Math.PI))/2,h=Pe.create(),f=Pe.create();if(Pe.lerp(h,e.focalPoint,a,c),Pe.lerp(f,e.position,o,c),u=e.roll*(1-c)+s*c,e.setFocalPoint(h),e.setPosition(f),e.setRoll(u),e.computeMatrix(),!(Pe.dist(h,a)+Pe.dist(f,o)>.01))return e.setFocalPoint(h),e.setPosition(f),e.setRoll(u),e.computeMatrix(),void e.interactor.connect();l<n&&(e.landmarkAnimationID=window.requestAnimationFrame(t))};window.requestAnimationFrame(u)}}},{key:"_update",value:function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles()}},{key:"computeMatrix",value:function(){var t,e,n=ey(ty(),[0,0,1],this.roll*c_);Jv.identity(this.matrix),t=ey(ty(),[1,0,0],(this.rotateWorld&&this.type!==$y.TRACKING||this.type===$y.TRACKING?1:-1)*this.elevation*c_),e=ey(ty(),[0,1,0],(this.rotateWorld&&this.type!==$y.TRACKING||this.type===$y.TRACKING?1:-1)*this.azimuth*c_);var r=ny(ty(),e,t);r=ny(ty(),r,n);var i=Jv.fromQuat(Jv.create(),r);this.type===$y.ORBITING||this.type===$y.EXPLORING?(Jv.translate(this.matrix,this.matrix,this.focalPoint),Jv.multiply(this.matrix,this.matrix,i),Jv.translate(this.matrix,this.matrix,[0,0,this.distance])):this.type===$y.TRACKING&&(Jv.translate(this.matrix,this.matrix,this.position),Jv.multiply(this.matrix,this.matrix,i))}},{key:"_setPosition",value:function(t,e,n){this.position=Wy(t,e,n);var r=this.matrix;r[12]=this.position[0],r[13]=this.position[1],r[14]=this.position[2],r[15]=1}},{key:"_getAxes",value:function(){Pe.copy(this.right,Wy(Sg.fF(Sg.Ue(),[1,0,0,0],this.matrix))),Pe.copy(this.up,Wy(Sg.fF(Sg.Ue(),[0,1,0,0],this.matrix))),Pe.copy(this.forward,Wy(Sg.fF(Sg.Ue(),[0,0,1,0],this.matrix))),Pe.normalize(this.right,this.right),Pe.normalize(this.up,this.up),Pe.normalize(this.forward,this.forward)}},{key:"_getAngles",value:function(){var t=this.distanceVector[0],e=this.distanceVector[1],n=this.distanceVector[2],r=Pe.length(this.distanceVector);if(0===r)return this.elevation=0,void(this.azimuth=0);this.type===$y.TRACKING||this.rotateWorld?(this.elevation=Math.asin(e/r)*h_,this.azimuth=Math.atan2(-t,-n)*h_):(this.elevation=-Math.asin(e/r)*h_,this.azimuth=-Math.atan2(-t,-n)*h_)}},{key:"_getPosition",value:function(){Pe.copy(this.position,Wy(Sg.fF(Sg.Ue(),[0,0,0,1],this.matrix))),this._getDistance()}},{key:"_getFocalPoint",value:function(){Pe.transformMat3(this.distanceVector,[0,0,-this.distance],k(T(),this.matrix)),Pe.add(this.focalPoint,this.position,this.distanceVector),this._getDistance()}},{key:"_getDistance",value:function(){this.distanceVector=Pe.subtract(Pe.create(),this.focalPoint,this.position),this.distance=Pe.length(this.distanceVector),this.dollyingStep=this.distance/100}}]),t}(),Qy.ProjectionMode={ORTHOGRAPHIC:"ORTHOGRAPHIC",PERSPECTIVE:"PERSPECTIVE"},qy=Jy,Ky=(0,Yd.Z)(qy.prototype,"interactor",[Xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yy=qy))||Yy),p_=(r_=(0,rg.b2)(),i_=(0,rg.f3)(ig.GeometryComponentManager),r_((l_=u_=function(){function t(){(0,Hd.Z)(this,t),this.config=void 0,(0,Wd.Z)(this,"geometry",s_,this),this.entity=void 0,this.component=void 0}return(0,Xd.Z)(t,[{key:"getEntity",value:function(){return this.entity}},{key:"getComponent",value:function(){return this.component}},{key:"setConfig",value:function(t){this.config=t}},{key:"setEntity",value:function(t){this.entity=t,this.component=this.geometry.create(t),this.component.entity=t,this.onEntityCreated()}},{key:"onEntityCreated",value:function(){}}]),t}(),u_.BOX="box",u_.SPHERE="sphere",u_.PLANE="plane",u_.MERGED="merged",a_=l_,s_=(0,Yd.Z)(a_.prototype,"geometry",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o_=a_))||o_),d_=n(9469);function g_(){if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}var v_={}.toString;var m_={};m_["[object Float32Array]"]=m_["[object Float64Array]"]=m_["[object Int8Array]"]=m_["[object Int16Array]"]=m_["[object Int32Array]"]=m_["[object Uint8Array]"]=m_["[object Uint8ClampedArray]"]=m_["[object Uint16Array]"]=m_["[object Uint32Array]"]=!0,m_["[object Arguments]"]=m_["[object Array]"]=m_["[object ArrayBuffer]"]=m_["[object Boolean]"]=m_["[object DataView]"]=m_["[object Date]"]=m_["[object Error]"]=m_["[object Function]"]=m_["[object Map]"]=m_["[object Number]"]=m_["[object Object]"]=m_["[object RegExp]"]=m_["[object Set]"]=m_["[object String]"]=m_["[object WeakMap]"]=!1;var y_,__,b_,x_,w_,E_,S_,C_,A_=Object.prototype.toString,T_=function(t){return function(t){return!!t&&"object"===(0,Cg.Z)(t)}(t)&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}(t.length)&&!!m_[A_.call(t)]};function k_(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function M_(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k_(Object(n),!0).forEach((function(e){(0,wg.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var P_,I_,O_,R_,L_,D_,N_,B_,z_,F_,Z_,j_,U_,G_,V_,W_,H_,X_,Y_,q_,K_,Q_,J_,$_,tb,eb,nb,rb,ib,ob,ab,sb,ub,lb,cb,hb=(y_=(0,rg.b2)(),__=(0,rg.f3)(ig.RenderEngine),b_=(0,rg.f3)(ig.ConfigService),y_((C_=function(){function t(){(0,Hd.Z)(this,t),(0,Wd.Z)(this,"engine",E_,this),(0,Wd.Z)(this,"configService",S_,this),this.entity=$d(),this.model=void 0,this.dirty=!0,this.compiledBundle=void 0,this.initPromise=void 0}var e,n,r;return(0,Xd.Z)(t,[{key:"init",value:function(){var t=this.configService.get(),e=t.canvas,n=t.engineOptions;this.initPromise=this.engine.init(M_({canvas:e||g_(),swapChainFormat:d_.EV.BGRA8Unorm,antialiasing:!1},n))}},{key:"setBundle",value:function(t){this.compiledBundle=JSON.parse(JSON.stringify(t))}},{key:"setDispatch",value:function(t){return this.compiledBundle.context&&(this.compiledBundle.context.dispatch=t),this}},{key:"setMaxIteration",value:function(t){return this.compiledBundle.context&&(this.compiledBundle.context.maxIteration=t),this}},{key:"setBinding",value:function(t,e){var n=this;if("string"==typeof t){var r=Gy(e)||T_(e)||function(t){return Array.isArray?Array.isArray(t):function(t,e){return v_.call(t)==="[object "+e+"]"}(t,"Array")}(e);if(this.compiledBundle&&this.compiledBundle.context){var i=this.compiledBundle.context.defines.find((function(e){return e.name===t}));if(i)return i.value=e,this;var o=this.compiledBundle.context.uniforms.find((function(e){return e.name===t}));o&&(r?(o.data=e,o.isReferer=!1,o.storageClass===Zy.Uniform?this.model&&this.model.updateUniform(t,e):this.model&&this.model.updateBuffer(t,e)):(o.isReferer=!0,o.data=e))}}else Object.keys(t).forEach((function(e){n.setBinding(e,t[e])}));return this}},{key:"execute",value:(r=(0,Qd.Z)(Kd().mark((function t(){var e,n,r=this,i=arguments;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=i.length>0&&void 0!==i[0]?i[0]:1,!this.dirty){t.next=6;break}return this.compiledBundle.context&&(e>1?this.compiledBundle.context.maxIteration=e:this.compiledBundle.context.maxIteration++),t.next=5,this.compile();case 5:this.dirty=!1;case 6:for(this.engine.beginFrame(),this.engine.clear({}),this.compiledBundle.context&&this.compiledBundle.context.uniforms.filter((function(t){return t.isReferer})).forEach((function(t){var e=t.data,n=t.name;r.model.confirmInput(e.model,n)})),n=0;n<e;n++)this.model.run();return this.engine.endFrame(),t.abrupt("return",this);case 12:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"getOutput",value:(n=(0,Qd.Z)(Kd().mark((function t(){return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.model.readData());case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"compile",value:(e=(0,Qd.Z)(Kd().mark((function t(){var e,n,r;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.initPromise;case 2:return e=M_({},this.compiledBundle.context),n=this.engine.supportWebGPU?this.engine.useWGSL?jy.WGSL:jy.GLSL450:jy.GLSL100,r=this.compiledBundle.shaders[n],e.defines.filter((function(t){return t.runtime})).forEach((function(t){var e="".concat("__DefineValuePlaceholder__").concat(t.name);r=r.replace(e,"".concat(t.value))})),e.shader=r,e.uniforms.forEach((function(t){if(!t.data&&t.storageClass===Zy.StorageBuffer){var n=1;t.type===zy.FloatArray?n=1:t.type===zy.Vector4FloatArray&&(n=4),t.data=new Float32Array(e.output.length*n).fill(0)}})),this.compiledBundle.context=e,t.next=11,this.engine.createComputeModel(this.compiledBundle.context);case 11:this.model=t.sent;case 12:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),t}(),w_=C_,E_=(0,Yd.Z)(w_.prototype,"engine",[__],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S_=(0,Yd.Z)(w_.prototype,"configService",[b_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x_=w_))||x_),fb=(P_=(0,rg.b2)(),I_=(0,rg.f3)(ig.MaterialComponentManager),P_((N_=D_=function(){function t(){(0,Hd.Z)(this,t),this.config=void 0,(0,Wd.Z)(this,"material",L_,this),this.entity=void 0,this.component=void 0}return(0,Xd.Z)(t,[{key:"getEntity",value:function(){return this.entity}},{key:"getComponent",value:function(){return this.component}},{key:"setConfig",value:function(t){this.config=t}},{key:"setEntity",value:function(t,e){this.entity=t,this.component=this.material.create(t),this.component.entity=t,this.component.type=e,this.onEntityCreated()}},{key:"onEntityCreated",value:function(){}}]),t}(),D_.BASIC="basic",R_=N_,L_=(0,Yd.Z)(R_.prototype,"material",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O_=R_))||O_),pb=(B_=(0,rg.b2)(),z_=(0,rg.f3)(ig.MeshComponentManager),F_=(0,rg.f3)(ig.CullableComponentManager),Z_=(0,rg.f3)(ig.TransformComponentManager),j_=(0,rg.f3)(ig.Systems),U_=(0,rg.t6)(ig.SceneGraphSystem),B_((K_=q_=function(){function t(){(0,Hd.Z)(this,t),this.attributes={},this.config=void 0,(0,Wd.Z)(this,"mesh",W_,this),(0,Wd.Z)(this,"cullable",H_,this),(0,Wd.Z)(this,"transform",X_,this),(0,Wd.Z)(this,"sceneGraphSystem",Y_,this),this.meshComponent=void 0,this.transformComponent=void 0,this.entity=void 0}return(0,Xd.Z)(t,[{key:"getEntity",value:function(){return this.entity}},{key:"getTransformComponent",value:function(){return this.transformComponent}},{key:"getMeshComponent",value:function(){return this.meshComponent}},{key:"setConfig",value:function(t){this.config=t}},{key:"setEntity",value:function(t){this.entity=t,this.cullable.create(t),this.meshComponent=this.mesh.create(t),this.transformComponent=this.transform.create(t),this.onEntityCreated()}},{key:"setMaterial",value:function(t){return this.meshComponent.material=t,this}},{key:"setGeometry",value:function(t){return this.meshComponent.geometry=t,this}},{key:"setAttributes",value:function(t){var e=this;Object.keys(t).forEach((function(n){void 0!==t[n]&&t[n]!==e.attributes[n]&&(e.onAttributeChanged({name:n,data:t[n]}),e.attributes[n]=t[n])}))}},{key:"setVisible",value:function(t){var e=this;return this.meshComponent.visible=t,this.meshComponent.children.forEach((function(n){var r=e.mesh.getComponentByEntity(n);r&&(r.visible=t)})),this}},{key:"isVisible",value:function(){return this.meshComponent.visible}},{key:"attach",value:function(t){return this.sceneGraphSystem.attach(this.entity,t.entity),this}},{key:"detach",value:function(){return this.sceneGraphSystem.detach(this.entity),this}},{key:"detachChildren",value:function(){return this.sceneGraphSystem.detachChildren(this.entity),this}},{key:"onEntityCreated",value:function(){}},{key:"onAttributeChanged",value:function(t){var e=t.name,n=t.data;this.meshComponent&&this.meshComponent.material&&this.meshComponent.material.setUniform(this.convertAttributeName2UniformName(e),n)}},{key:"convertAttributeName2UniformName",value:function(t){return t}}]),t}(),q_.POINT="point",q_.LINE="line",q_.GRID="grid",V_=K_,W_=(0,Yd.Z)(V_.prototype,"mesh",[z_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H_=(0,Yd.Z)(V_.prototype,"cullable",[F_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X_=(0,Yd.Z)(V_.prototype,"transform",[Z_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y_=(0,Yd.Z)(V_.prototype,"sceneGraphSystem",[j_,U_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G_=V_))||G_),db=n(1550),gb=n.n(db),vb=function(){function t(e,n){(0,Hd.Z)(this,t),this.attribute=void 0,this.buffer=void 0;var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return(0,Xd.Z)(t,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),t}(),mb=(Q_={},(0,wg.Z)(Q_,Ig.POINTS,"points"),(0,wg.Z)(Q_,Ig.LINES,"lines"),(0,wg.Z)(Q_,Ig.LINE_LOOP,"line loop"),(0,wg.Z)(Q_,Ig.LINE_STRIP,"line strip"),(0,wg.Z)(Q_,Ig.TRIANGLES,"triangles"),(0,wg.Z)(Q_,Ig.TRIANGLE_FAN,"triangle fan"),(0,wg.Z)(Q_,Ig.TRIANGLE_STRIP,"triangle strip"),Q_),yb=(J_={},(0,wg.Z)(J_,Ig.STATIC_DRAW,"static"),(0,wg.Z)(J_,Ig.DYNAMIC_DRAW,"dynamic"),(0,wg.Z)(J_,Ig.STREAM_DRAW,"stream"),J_),_b=($_={},(0,wg.Z)($_,Ig.BYTE,"int8"),(0,wg.Z)($_,Ig.UNSIGNED_INT,"int16"),(0,wg.Z)($_,Ig.INT,"int32"),(0,wg.Z)($_,Ig.UNSIGNED_BYTE,"uint8"),(0,wg.Z)($_,Ig.UNSIGNED_SHORT,"uint16"),(0,wg.Z)($_,Ig.UNSIGNED_INT,"uint32"),(0,wg.Z)($_,Ig.FLOAT,"float"),$_),bb=(tb={},(0,wg.Z)(tb,Ig.ALPHA,"alpha"),(0,wg.Z)(tb,Ig.LUMINANCE,"luminance"),(0,wg.Z)(tb,Ig.LUMINANCE_ALPHA,"luminance alpha"),(0,wg.Z)(tb,Ig.RGB,"rgb"),(0,wg.Z)(tb,Ig.RGBA,"rgba"),(0,wg.Z)(tb,Ig.RGBA4,"rgba4"),(0,wg.Z)(tb,Ig.RGB5_A1,"rgb5 a1"),(0,wg.Z)(tb,Ig.RGB565,"rgb565"),(0,wg.Z)(tb,Ig.DEPTH_COMPONENT,"depth"),(0,wg.Z)(tb,Ig.DEPTH_STENCIL,"depth stencil"),tb),xb=(eb={},(0,wg.Z)(eb,Ig.DONT_CARE,"dont care"),(0,wg.Z)(eb,Ig.NICEST,"nice"),(0,wg.Z)(eb,Ig.FASTEST,"fast"),eb),wb=(nb={},(0,wg.Z)(nb,Ig.NEAREST,"nearest"),(0,wg.Z)(nb,Ig.LINEAR,"linear"),(0,wg.Z)(nb,Ig.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,wg.Z)(nb,Ig.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,wg.Z)(nb,Ig.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,wg.Z)(nb,Ig.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),nb),Eb=(rb={},(0,wg.Z)(rb,Ig.REPEAT,"repeat"),(0,wg.Z)(rb,Ig.CLAMP_TO_EDGE,"clamp"),(0,wg.Z)(rb,Ig.MIRRORED_REPEAT,"mirror"),rb),Sb=(ib={},(0,wg.Z)(ib,Ig.NONE,"none"),(0,wg.Z)(ib,Ig.BROWSER_DEFAULT_WEBGL,"browser"),ib),Cb=(ob={},(0,wg.Z)(ob,Ig.NEVER,"never"),(0,wg.Z)(ob,Ig.ALWAYS,"always"),(0,wg.Z)(ob,Ig.LESS,"less"),(0,wg.Z)(ob,Ig.LEQUAL,"lequal"),(0,wg.Z)(ob,Ig.GREATER,"greater"),(0,wg.Z)(ob,Ig.GEQUAL,"gequal"),(0,wg.Z)(ob,Ig.EQUAL,"equal"),(0,wg.Z)(ob,Ig.NOTEQUAL,"notequal"),ob),Ab=(ab={},(0,wg.Z)(ab,Ig.FUNC_ADD,"add"),(0,wg.Z)(ab,Ig.MIN_EXT,"min"),(0,wg.Z)(ab,Ig.MAX_EXT,"max"),(0,wg.Z)(ab,Ig.FUNC_SUBTRACT,"subtract"),(0,wg.Z)(ab,Ig.FUNC_REVERSE_SUBTRACT,"reverse subtract"),ab),Tb=(sb={},(0,wg.Z)(sb,Ig.ZERO,"zero"),(0,wg.Z)(sb,Ig.ONE,"one"),(0,wg.Z)(sb,Ig.SRC_COLOR,"src color"),(0,wg.Z)(sb,Ig.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,wg.Z)(sb,Ig.SRC_ALPHA,"src alpha"),(0,wg.Z)(sb,Ig.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,wg.Z)(sb,Ig.DST_COLOR,"dst color"),(0,wg.Z)(sb,Ig.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,wg.Z)(sb,Ig.DST_ALPHA,"dst alpha"),(0,wg.Z)(sb,Ig.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,wg.Z)(sb,Ig.CONSTANT_COLOR,"constant color"),(0,wg.Z)(sb,Ig.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,wg.Z)(sb,Ig.CONSTANT_ALPHA,"constant alpha"),(0,wg.Z)(sb,Ig.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,wg.Z)(sb,Ig.SRC_ALPHA_SATURATE,"src alpha saturate"),sb),kb=(ub={},(0,wg.Z)(ub,Ig.NEVER,"never"),(0,wg.Z)(ub,Ig.ALWAYS,"always"),(0,wg.Z)(ub,Ig.LESS,"less"),(0,wg.Z)(ub,Ig.LEQUAL,"lequal"),(0,wg.Z)(ub,Ig.GREATER,"greater"),(0,wg.Z)(ub,Ig.GEQUAL,"gequal"),(0,wg.Z)(ub,Ig.EQUAL,"equal"),(0,wg.Z)(ub,Ig.NOTEQUAL,"notequal"),ub),Mb=(lb={},(0,wg.Z)(lb,Ig.ZERO,"zero"),(0,wg.Z)(lb,Ig.KEEP,"keep"),(0,wg.Z)(lb,Ig.REPLACE,"replace"),(0,wg.Z)(lb,Ig.INVERT,"invert"),(0,wg.Z)(lb,Ig.INCR,"increment"),(0,wg.Z)(lb,Ig.DECR,"decrement"),(0,wg.Z)(lb,Ig.INCR_WRAP,"increment wrap"),(0,wg.Z)(lb,Ig.DECR_WRAP,"decrement wrap"),lb),Pb=(cb={},(0,wg.Z)(cb,Ig.FRONT,"front"),(0,wg.Z)(cb,Ig.BACK,"back"),cb),Ib=function(){function t(e,n){(0,Hd.Z)(this,t),this.buffer=void 0;var r=n.data,i=n.usage,o=n.type;this.buffer=e.buffer({data:r,usage:yb[i||Ig.STATIC_DRAW],type:_b[o||Ig.UNSIGNED_BYTE]})}return(0,Xd.Z)(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){}},{key:"subData",value:function(t){var e=t.data,n=t.offset;this.buffer.subdata(e,n)}}]),t}(),Ob=n(2982),Rb={};Rb["[object Float32Array]"]=Rb["[object Float64Array]"]=Rb["[object Int8Array]"]=Rb["[object Int16Array]"]=Rb["[object Int32Array]"]=Rb["[object Uint8Array]"]=Rb["[object Uint8ClampedArray]"]=Rb["[object Uint16Array]"]=Rb["[object Uint32Array]"]=!0,Rb["[object Arguments]"]=Rb["[object Array]"]=Rb["[object ArrayBuffer]"]=Rb["[object Boolean]"]=Rb["[object DataView]"]=Rb["[object Date]"]=Rb["[object Error]"]=Rb["[object Function]"]=Rb["[object Map]"]=Rb["[object Number]"]=Rb["[object Object]"]=Rb["[object RegExp]"]=Rb["[object Set]"]=Rb["[object String]"]=Rb["[object WeakMap]"]=!1;var Lb=Object.prototype.toString,Db=function(t){return function(t){return!!t&&"object"===(0,Cg.Z)(t)}(t)&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}(t.length)&&!!Rb[Lb.call(t)]};function Nb(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Bb(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Nb(Object(n),!0).forEach((function(e){(0,wg.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Nb(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var zb=0,Fb=function(){function t(e,n){var r=this;(0,Hd.Z)(this,t),this.reGl=e,this.context=n,this.entity=$d(),this.texFBO=void 0,this.computeCommand=void 0,this.textureCache={},this.outputTextureName=void 0,this.swapOutputTextureName=void 0,this.compiledPingpong=void 0,this.dynamicPingpong=void 0;var i={};this.context.uniforms.forEach((function(t){var e=t.name,n=t.type,o=t.data,a=t.isReferer,s=t.storageClass;if(s===Zy.StorageBuffer){if(a)r.textureCache[e]={data:void 0},i["".concat(e,"Size")]=function(){return o.compiledBundle.context.output.textureSize};else{r.textureCache[e]=r.calcDataTexture(e,n,o);var u=r.textureCache[e],l=u.textureWidth,c=u.isOutput;i["".concat(e,"Size")]=[l,l],c&&(r.outputTextureName=e,r.context.needPingpong&&(r.outputTextureName="".concat(e,"Output"),r.textureCache[r.outputTextureName]=r.calcDataTexture(e,n,o)))}i[e]=function(){return r.textureCache[e].texture}}else if(s===Zy.Uniform){if(o&&(Array.isArray(o)||Db(o))&&o.length>16)throw new Error("invalid data type ".concat(n));i[e]=function(){return t.data}}}));var o=this.getOuputDataTexture(),a=o.textureWidth,s=o.texelCount;i.u_OutputTextureSize=[a,a],i.u_OutputTexelCount=s,this.context.output.textureSize=[a,a];var u={attributes:{a_Position:[[-1,1,0],[-1,-1,0],[1,1,0],[1,-1,0]],a_TexCoord:[[0,1],[0,0],[1,1],[1,0]]},frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n".concat(this.context.shader),uniforms:i,vert:"attribute vec3 a_Position;\nattribute vec2 a_TexCoord;\n\nvarying vec2 v_TexCoord;\n\nvoid main() {\n  gl_Position = vec4(a_Position, 1.0);\n  v_TexCoord = a_TexCoord;\n}",primitive:"triangle strip",count:4};this.computeCommand=this.reGl(u)}var e;return(0,Xd.Z)(t,[{key:"run",value:function(){var t=this;this.context.maxIteration>1&&this.context.needPingpong&&(this.compiledPingpong=!0),(this.compiledPingpong||this.dynamicPingpong)&&this.swap(),this.texFBO=this.reGl.framebuffer({color:this.getOuputDataTexture().texture}),this.texFBO.use((function(){t.computeCommand()}))}},{key:"readData",value:(e=(0,Qd.Z)(Kd().mark((function t(){var e,n,r,i,o,a,s,u,l=this;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.reGl({framebuffer:this.texFBO})((function(){e=l.reGl.read()})),!e){t.next=6;break}if(n=this.getOuputDataTexture(),r=n.originalDataLength,i=n.elementsPerTexel,o=n.typedArrayConstructor,a=void 0===o?Float32Array:o,s=[],4!==i)for(u=0;u<e.length;u+=4)1===i?s.push(e[u]):2===i?s.push(e[u],e[u+1]):s.push(e[u],e[u+1],e[u+2]);else s=e;return t.abrupt("return",new a(s.slice(0,r)));case 6:return t.abrupt("return",new Float32Array);case 7:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"confirmInput",value:function(t,e){var n;this.entity===t.entity?(this.dynamicPingpong=!0,n=this):n=t,this.textureCache[e].id=n.getOuputDataTexture().id,this.textureCache[e].texture=n.getOuputDataTexture().texture}},{key:"updateUniform",value:function(){}},{key:"updateBuffer",value:function(t,e){var n=this.context.uniforms.find((function(e){return e.name===t}));if(n){var r=this.calcDataTexture(t,n.type,e),i=r.texture,o=r.data;this.textureCache[t].data=o,this.textureCache[t].texture=i}}},{key:"destroy",value:function(){}},{key:"swap",value:function(){if(this.swapOutputTextureName||this.createSwapOutputDataTexture(),this.compiledPingpong){var t=this.context.output.name;this.textureCache[t].id=this.getOuputDataTexture().id,this.textureCache[t].texture=this.getOuputDataTexture().texture}var e=this.outputTextureName;this.outputTextureName=this.swapOutputTextureName,this.swapOutputTextureName=e}},{key:"getOuputDataTexture",value:function(){return this.textureCache[this.outputTextureName]}},{key:"createSwapOutputDataTexture",value:function(){var t=this.cloneDataTexture(this.getOuputDataTexture());this.swapOutputTextureName="".concat(this.entity,"-swap"),this.textureCache[this.swapOutputTextureName]=t}},{key:"cloneDataTexture",value:function(t){var e=t.data,n=t.textureWidth;return Bb(Bb({},t),{},{id:zb++,texture:this.reGl.texture({width:n,height:n,data:e,type:"float"})})}},{key:"calcDataTexture",value:function(t,e,n){var r=1;e===zy.Vector4FloatArray&&(r=4);for(var i=[],o=0;o<n.length;o+=r)1===r?i.push(n[o],0,0,0):2===r?i.push(n[o],n[o+1],0,0):3===r?i.push(n[o],n[o+1],n[o+2],0):4===r&&i.push(n[o],n[o+1],n[o+2],n[o+3]);var a=n.length,s=Math.ceil(a/r),u=Math.ceil(Math.sqrt(s)),l=u*u;s<l&&i.push.apply(i,(0,Ob.Z)(new Array(4*(l-s)).fill(0)));var c=this.reGl.texture({width:u,height:u,data:i,type:"float"});return{id:zb++,data:i,originalDataLength:a,typedArrayConstructor:Db(n)?n.constructor:void 0,textureWidth:u,texture:c,texelCount:s,elementsPerTexel:r,isOutput:t===this.context.output.name}}}]),t}(),Zb=function(){function t(e,n){(0,Hd.Z)(this,t),this.elements=void 0;var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=e.elements({data:r,usage:yb[i||Ig.STATIC_DRAW],type:_b[o||Ig.UNSIGNED_BYTE],count:a})}return(0,Xd.Z)(t,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var e=t.data;this.elements.subdata(e)}},{key:"destroy",value:function(){this.elements.destroy()}}]),t}(),jb=function(){function t(e,n){(0,Hd.Z)(this,t),this.framebuffer=void 0;var r=n.width,i=n.height,o=n.color,a=n.colors,s=(n.depth,n.stencil,{width:r,height:i});Array.isArray(a)&&(s.colors=a.map((function(t){return t.get()}))),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=e.framebuffer(s)}return(0,Xd.Z)(t,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.framebuffer.resize(e,n)}}]),t}();function Ub(t){var e={};return Object.keys(t).forEach((function(n){Gb(n,t[n],e,"")})),e}function Gb(t,e,n,r){null===e||"number"==typeof e||"boolean"==typeof e||Array.isArray(e)&&"number"==typeof e[0]||Db(e)||""===e||void 0!==e.resize?n["".concat(r&&r+".").concat(t)]=e:(function(t){var e=(0,Cg.Z)(t);return null!=t&&("object"===e||"function"===e)}(e)&&Object.keys(e).forEach((function(i){Gb(i,e[i],n,"".concat(r&&r+".").concat(t))})),Array.isArray(e)&&e.forEach((function(e,i){Object.keys(e).forEach((function(o){Gb(o,e[o],n,"".concat(r&&r+".").concat(t,"[").concat(i,"]"))}))})))}function Vb(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Wb(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Vb(Object(n),!0).forEach((function(e){(0,wg.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Vb(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Hb,Xb,Yb,qb=function(){function t(e,n){(0,Hd.Z)(this,t),this.reGl=void 0,this.drawCommand=void 0,this.uniforms={},this.reGl=e;var r=n.vs,i=n.fs,o=n.defines,a=n.attributes,s=n.uniforms,u=n.primitive,l=n.count,c=n.elements,h=n.depth,f=n.blend,p=n.stencil,d=n.cull,g=n.instances,v=n.scissor,m=n.viewport,y={};s&&(this.uniforms=Ub(s),Object.keys(s).forEach((function(t){y[t]=e.prop(t)})));var _={};Object.keys(a).forEach((function(t){_[t]=a[t].get()}));var b=o&&this.generateDefines(o)||"",x={attributes:_,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n".concat(b,"\n").concat(i),uniforms:y,vert:"\n".concat(b,"\n").concat(r),primitive:mb[void 0===u?Ig.TRIANGLES:u]};g&&(x.instances=g),l&&(x.count=l),c&&(x.elements=c.get()),v&&(x.scissor=v),m&&(x.viewport=m),this.initDepthDrawParams({depth:h},x),this.initBlendDrawParams({blend:f},x),this.initStencilDrawParams({stencil:p},x),this.initCullDrawParams({cull:d},x),this.drawCommand=e(x)}return(0,Xd.Z)(t,[{key:"addUniforms",value:function(t){this.uniforms=Wb(Wb({},this.uniforms),Ub(t))}},{key:"draw",value:function(t){var e=Wb(Wb({},this.uniforms),Ub(t.uniforms||{})),n={};Object.keys(e).forEach((function(t){var r=(0,Cg.Z)(e[t]);"boolean"===r||"number"===r||Array.isArray(e[t])||e[t].BYTES_PER_ELEMENT?n[t]=e[t]:"string"===r||(n[t]=e[t].get())})),this.drawCommand(n)}},{key:"destroy",value:function(){}},{key:"initDepthDrawParams",value:function(t,e){var n=t.depth;n&&(e.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:Cb[n.func||Ig.LESS],range:n.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,e){var n=t.blend;if(n){var r=n.enable,i=n.func,o=n.equation,a=n.color,s=void 0===a?[0,0,0,0]:a;e.blend={enable:!!r,func:{srcRGB:Tb[i&&i.srcRGB||Ig.SRC_ALPHA],srcAlpha:Tb[i&&i.srcAlpha||Ig.SRC_ALPHA],dstRGB:Tb[i&&i.dstRGB||Ig.ONE_MINUS_SRC_ALPHA],dstAlpha:Tb[i&&i.dstAlpha||Ig.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Ab[o&&o.rgb||Ig.FUNC_ADD],alpha:Ab[o&&o.alpha||Ig.FUNC_ADD]},color:s}}}},{key:"initStencilDrawParams",value:function(t,e){var n=t.stencil;if(n){var r=n.enable,i=n.mask,o=void 0===i?-1:i,a=n.func,s=void 0===a?{cmp:Ig.ALWAYS,ref:0,mask:-1}:a,u=n.opFront,l=void 0===u?{fail:Ig.KEEP,zfail:Ig.KEEP,zpass:Ig.KEEP}:u,c=n.opBack,h=void 0===c?{fail:Ig.KEEP,zfail:Ig.KEEP,zpass:Ig.KEEP}:c;e.stencil={enable:!!r,mask:o,func:Wb(Wb({},s),{},{cmp:kb[s.cmp]}),opFront:{fail:Mb[l.fail],zfail:Mb[l.zfail],zpass:Mb[l.zpass]},opBack:{fail:Mb[h.fail],zfail:Mb[h.zfail],zpass:Mb[h.zpass]}}}}},{key:"initCullDrawParams",value:function(t,e){var n=t.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?Ig.BACK:i;e.cull={enable:!!r,face:Pb[o]}}}},{key:"generateDefines",value:function(t){return Object.keys(t).map((function(e){return"#define ".concat(e," ").concat(Number(t[e]))})).join("\n")}}]),t}(),Kb=function(){function t(e,n){(0,Hd.Z)(this,t),this.texture=void 0,this.width=void 0,this.height=void 0;var r=n.data,i=n.type,o=void 0===i?Ig.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,l=void 0!==u&&u,c=n.format,h=void 0===c?Ig.RGBA:c,f=n.mipmap,p=void 0!==f&&f,d=n.wrapS,g=void 0===d?Ig.CLAMP_TO_EDGE:d,v=n.wrapT,m=void 0===v?Ig.CLAMP_TO_EDGE:v,y=n.aniso,_=void 0===y?0:y,b=n.alignment,x=void 0===b?1:b,w=n.premultiplyAlpha,E=void 0!==w&&w,S=n.mag,C=void 0===S?Ig.NEAREST:S,A=n.min,T=void 0===A?Ig.NEAREST:A,k=n.colorSpace,M=void 0===k?Ig.BROWSER_DEFAULT_WEBGL:k;this.width=a,this.height=s;var P={width:a,height:s,type:_b[o],format:bb[h],wrapS:Eb[g],wrapT:Eb[m],mag:wb[C],min:wb[T],alignment:x,flipY:l,colorSpace:Sb[M],premultiplyAlpha:E,aniso:_};r&&(P.data=r),"number"==typeof p?P.mipmap=xb[p]:"boolean"==typeof p&&(P.mipmap=p),this.texture=e.texture(P)}return(0,Xd.Z)(t,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.texture.resize(e,n),this.width=e,this.height=n}},{key:"destroy",value:function(){this.texture.destroy()}}]),t}(),Qb=(0,rg.b2)()((Xb=function(){function t(){var e=this;(0,Hd.Z)(this,t),this.supportWebGPU=!1,this.useWGSL=!1,this.$canvas=void 0,this.gl=void 0,this.inited=void 0,this.createModel=function(){var t=(0,Qd.Z)(Kd().mark((function t(n){return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.uniforms){t.next=3;break}return t.next=3,Promise.all(Object.keys(n.uniforms).map(function(){var t=(0,Qd.Z)(Kd().mark((function t(e){var r;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.uniforms[e]||void 0===n.uniforms[e].load){t.next=5;break}return t.next=3,n.uniforms[e].load();case 3:r=t.sent,n.uniforms[e]=r;case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:return t.abrupt("return",new qb(e.gl,n));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.createAttribute=function(t){return new vb(e.gl,t)},this.createBuffer=function(t){return new Ib(e.gl,t)},this.createElements=function(t){return new Zb(e.gl,t)},this.createTexture2D=function(t){return new Kb(e.gl,t)},this.createFramebuffer=function(t){return new jb(e.gl,t)},this.useFramebuffer=function(t,n){e.gl({framebuffer:t?t.get():null})(n)},this.createComputeModel=function(){var t=(0,Qd.Z)(Kd().mark((function t(n){return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Fb(e.gl,n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.clear=function(t){var n=t.color,r=t.depth,i=t.stencil,o=t.framebuffer,a=void 0===o?null:o,s={color:n,depth:r,stencil:i};s.framebuffer=null===a?a:a.get(),e.gl.clear(s)},this.setScissor=function(t){e.gl&&e.gl._gl&&(t.enable&&t.box?(e.gl._gl.enable(Ig.SCISSOR_TEST),e.gl._gl.scissor(t.box.x,t.box.y,t.box.width,t.box.height)):e.gl._gl.disable(Ig.SCISSOR_TEST),e.gl._refresh())},this.viewport=function(t){var n=t.x,r=t.y,i=t.width,o=t.height;e.gl&&e.gl._gl&&(e.gl._gl.viewport(n,r,i,o),e.gl._refresh())},this.readPixels=function(t){var n=t.framebuffer,r={x:t.x,y:t.y,width:t.width,height:t.height};return n&&(r.framebuffer=n.get()),e.gl.read(r)},this.getCanvas=function(){return e.$canvas},this.getGLContext=function(){return e.gl._gl},this.destroy=function(){e.gl&&(e.gl.destroy(),e.inited=!1)}}var e;return(0,Xd.Z)(t,[{key:"init",value:(e=(0,Qd.Z)(Kd().mark((function t(e){return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.inited){t.next=2;break}return t.abrupt("return");case 2:return this.$canvas=e.canvas,t.next=5,new Promise((function(t,n){gb()({canvas:e.canvas,attributes:{alpha:!0,antialias:e.antialias,premultipliedAlpha:!0},pixelRatio:1,extensions:["OES_element_index_uint","OES_texture_float","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(e,r){!e&&r||n(e),t(r)}})}));case 5:this.gl=t.sent,this.inited=!0;case 7:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"isFloatSupported",value:function(){return this.gl.limits.readFloat}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),t}(),Hb=Xb))||Hb;function Jb(t,e){return new Promise((function(e,n){!function(t,e,n,r){if("undefined"!=typeof window){var i=document.getElementsByTagName("head")[0],o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",t),r&&(o.id=r),o.onload=function(){e&&e()},o.onerror=function(e){n&&n("Unable to load script '".concat(t,"'"),e)},i.appendChild(o)}}(t,(function(){e()}),(function(t,e){n(e)}))}))}function $b(){return tx.apply(this,arguments)}function tx(){return(tx=(0,Qd.Z)(Kd().mark((function t(){return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Yb){t.next=2;break}return t.abrupt("return",Yb);case 2:return t.next=4,Jb("https://preview.babylonjs.com/glslang/glslang.js");case 4:return Yb=window.glslang("https://preview.babylonjs.com/glslang/glslang.wasm"),t.abrupt("return",Yb);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var ex=function(){function t(e,n){(0,Hd.Z)(this,t),this.engine=e,this.options=n,this.attribute=void 0,this.buffer=void 0;var r=n,i=r.buffer,o=r.offset,a=r.stride,s=r.normalized,u=r.size,l=r.divisor,c=r.arrayStride,h=r.attributes,f=r.stepMode;this.buffer=i,this.attribute={buffer:i.get(),offset:o||0,stride:a||0,normalized:s||!1,divisor:l||0,arrayStride:c||0,attributes:h,stepMode:f||"vertex"},u&&(this.attribute.size=u)}return(0,Xd.Z)(t,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),t}(),nx=function(){function t(e,n){(0,Hd.Z)(this,t),this.engine=e,this.options=n,this.buffer=void 0;var r=n,i=r.data,o=r.usage;r.type,this.buffer=this.createBuffer(i instanceof Array?new Float32Array(i):i,o||d_.FB.Vertex|d_.FB.CopyDst)}return(0,Xd.Z)(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var e=t.data,n=t.offset;this.setSubData(this.buffer,n,e instanceof Array?new Float32Array(e):e)}},{key:"createBuffer",value:function(t,e){var n=t.byteLength%4,r={size:t.byteLength+n,usage:e},i=this.engine.device.createBuffer(r);return this.setSubData(i,0,t),i}},{key:"setSubData",value:function(t,e,n){(Uy?this.engine.device.getQueue():this.engine.device.defaultQueue).writeBuffer(t,e,n)}}]),t}();function rx(t){return"number"==typeof t}var ix,ox,ax,sx,ux,lx,cx,hx=function(){function t(e,n){(0,Hd.Z)(this,t),this.engine=e,this.context=n,this.entity=$d(),this.uniformGPUBufferLayout=[],this.uniformBuffer=void 0,this.vertexBuffers={},this.outputBuffer=void 0,this.bindGroupEntries=void 0,this.bindGroup=void 0,this.computePipeline=void 0}var e,n,r;return(0,Xd.Z)(t,[{key:"init",value:(r=(0,Qd.Z)(Kd().mark((function t(){var e,n,r,i,o,a,s,u=this;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.compileComputePipelineStageDescriptor(this.context.shader);case 2:e=t.sent,n=e.computeStage,r=this.context.uniforms.filter((function(t){return t.storageClass===Zy.StorageBuffer})),i=this.context.uniforms.filter((function(t){return t.storageClass===Zy.Uniform})),o=i.length?1:0,this.bindGroupEntries=[],o&&(a=0,s=[],i.forEach((function(t){if(rx(t.data))u.uniformGPUBufferLayout.push({name:t.name,offset:a}),a+=4,s.push(t.data);else{var e,n=(null===(e=t.data)||void 0===e?void 0:e.length)||1;3===n&&(n=4,t.data.push(0));var r=a/4%4;if(r>0){var i=4-r;if(n>1&&n<=i)2===n&&(3===i&&(a+=4,s.push(0)),s.push.apply(s,(0,Ob.Z)(t.data)),u.uniformGPUBufferLayout.push({name:t.name,offset:a}));else{for(var o=0;o<i;o++)a+=4,s.push(0);s.push.apply(s,(0,Ob.Z)(t.data)),u.uniformGPUBufferLayout.push({name:t.name,offset:a})}}a+=4*n}})),this.uniformBuffer=new nx(this.engine,{data:s instanceof Array?new Float32Array(s):s,usage:d_.FB.Uniform|d_.FB.CopyDst}),this.bindGroupEntries.push({binding:0,resource:{buffer:this.uniformBuffer.get()}})),r.forEach((function(t){var e;null!==t.data&&(t.type!==zy.Vector4FloatArray&&t.type!==zy.FloatArray||(t.name===u.context.output.name?(e=new nx(u.engine,{data:isFinite(Number(t.data))?[t.data]:t.data,usage:d_.FB.Storage|d_.FB.CopyDst|d_.FB.CopySrc}),u.outputBuffer=e,u.context.output={name:t.name,length:isFinite(Number(t.data))?1:t.data.length,typedArrayConstructor:Float32Array,gpuBuffer:e.get()}):t.isReferer?t.data.model&&t.data.model.outputBuffer&&(e=t.data.model.outputBuffer):e=new nx(u.engine,{data:isFinite(Number(t.data))?[t.data]:t.data,usage:d_.FB.Storage|d_.FB.CopyDst|d_.FB.CopySrc}),u.vertexBuffers[t.name]=e,u.bindGroupEntries.push({binding:o,resource:{name:t.name,refer:e?void 0:t.data,buffer:e?e.get():void 0}}),o++))})),this.computePipeline=this.engine.device.createComputePipeline({computeStage:n}),console.log(this.bindGroupEntries),this.bindGroup=this.engine.device.createBindGroup({layout:this.computePipeline.getBindGroupLayout(0),entries:this.bindGroupEntries});case 13:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"destroy",value:function(){var t=this;this.uniformBuffer&&this.uniformBuffer.destroy(),Object.keys(this.vertexBuffers).forEach((function(e){return t.vertexBuffers[e].destroy()}))}},{key:"readData",value:(n=(0,Qd.Z)(Kd().mark((function t(){var e,n,r,i,o,a,s,u,l;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=this.context.output)){t.next=16;break}if(n=e.length,r=e.typedArrayConstructor,!(i=e.gpuBuffer)){t.next=16;break}return o=n*r.BYTES_PER_ELEMENT,a=this.engine.device.createBuffer({size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),(s=this.engine.device.createCommandEncoder()).copyBufferToBuffer(i,0,a,0,o),(Uy?this.engine.device.getQueue():this.engine.device.defaultQueue).submit([s.finish()]),t.next=12,a.mapAsync(d_.gc.Read);case 12:return u=a.getMappedRange(),l=new r(u.slice(0)),a.unmap(),t.abrupt("return",l);case 16:return t.abrupt("return",new Float32Array);case 17:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"run",value:function(){var t;this.engine.currentComputePass&&(this.engine.currentComputePass.setPipeline(this.computePipeline),this.engine.currentComputePass.setBindGroup(0,this.bindGroup),(t=this.engine.currentComputePass).dispatch.apply(t,(0,Ob.Z)(this.context.dispatch)))}},{key:"updateBuffer",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.vertexBuffers[t];r&&r.subData({data:e,offset:n})}},{key:"updateUniform",value:function(t,e){var n=this.uniformGPUBufferLayout.find((function(e){return e.name===t}));n&&this.uniformBuffer.subData({data:Number.isFinite(e)?new Float32Array([e]):new Float32Array(e),offset:n.offset})}},{key:"confirmInput",value:function(t,e){var n=this.vertexBuffers[e],r=t.outputBuffer;if(n&&r&&n!==r){var i=this.engine.device.createCommandEncoder(),o=t.context.output,a=o.length*o.typedArrayConstructor.BYTES_PER_ELEMENT;i.copyBufferToBuffer(r.get(),0,n.get(),0,a),(Uy?this.engine.device.getQueue():this.engine.device.defaultQueue).submit([i.finish()])}}},{key:"compileShaderToSpirV",value:function(t,e,n){return this.compileRawShaderToSpirV(n+t,e)}},{key:"compileRawShaderToSpirV",value:function(t,e){return this.engine.glslang.compileGLSL(t,e)}},{key:"compileComputePipelineStageDescriptor",value:(e=(0,Qd.Z)(Kd().mark((function t(e){var n;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e,this.engine.options.useWGSL){t.next=6;break}return t.next=5,this.compileShaderToSpirV(e,"compute","#version 450\n");case 5:n=t.sent;case 6:return t.abrupt("return",{computeStage:{module:this.engine.device.createShaderModule({code:n,isWHLSL:Uy}),entryPoint:"main"}});case 7:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})}]),t}(),fx=function(){function t(e,n){(0,Hd.Z)(this,t),this.engine=e,this.options=n,this.indexCount=void 0,this.buffer=void 0;var r=n,i=r.data,o=(r.usage,r.type,r.count);this.indexCount=o||0,this.buffer=new nx(e,{data:i instanceof Array?new Uint16Array(i):i,usage:d_.FB.Index|d_.FB.CopyDst})}return(0,Xd.Z)(t,[{key:"get",value:function(){return this.buffer}},{key:"subData",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),t}(),px=function(){function t(e,n){(0,Hd.Z)(this,t),this.engine=e,this.options=n,this.colorTexture=void 0,this.depthTexture=void 0,this.width=0,this.height=0;var r=n,i=(r.width,r.height,r.color),o=(r.colors,r.depth);r.stencil,i&&(this.colorTexture=i),o&&(this.depthTexture=o)}return(0,Xd.Z)(t,[{key:"get",value:function(){var t,e;return{color:null===(t=this.colorTexture)||void 0===t?void 0:t.get(),depth:null===(e=this.depthTexture)||void 0===e?void 0:e.get()}}},{key:"destroy",value:function(){var t,e;null===(t=this.colorTexture)||void 0===t||t.destroy(),null===(e=this.depthTexture)||void 0===e||e.destroy()}},{key:"resize",value:function(t){var e,n,r=t.width,i=t.height;r===this.width&&i===this.height||(null===(e=this.colorTexture)||void 0===e||e.resize({width:r,height:i}),null===(n=this.depthTexture)||void 0===n||n.resize({width:r,height:i})),this.width=r,this.height=i}}]),t}(),dx=(ix={},(0,wg.Z)(ix,Ig.POINTS,d_.YV.PointList),(0,wg.Z)(ix,Ig.LINES,d_.YV.LineList),(0,wg.Z)(ix,Ig.LINE_LOOP,d_.YV.LineList),(0,wg.Z)(ix,Ig.LINE_STRIP,d_.YV.LineStrip),(0,wg.Z)(ix,Ig.TRIANGLES,d_.YV.TriangleList),(0,wg.Z)(ix,Ig.TRIANGLE_FAN,d_.YV.TriangleList),(0,wg.Z)(ix,Ig.TRIANGLE_STRIP,d_.YV.TriangleStrip),ix),gx=(ox={},(0,wg.Z)(ox,Ig.NEVER,d_.wb.Never),(0,wg.Z)(ox,Ig.ALWAYS,d_.wb.Always),(0,wg.Z)(ox,Ig.LESS,d_.wb.Less),(0,wg.Z)(ox,Ig.LEQUAL,d_.wb.LessEqual),(0,wg.Z)(ox,Ig.GREATER,d_.wb.Greater),(0,wg.Z)(ox,Ig.GEQUAL,d_.wb.GreaterEqual),(0,wg.Z)(ox,Ig.EQUAL,d_.wb.Equal),(0,wg.Z)(ox,Ig.NOTEQUAL,d_.wb.NotEqual),ox),vx=(ax={},(0,wg.Z)(ax,Ig.FUNC_ADD,d_.db.Add),(0,wg.Z)(ax,Ig.MIN_EXT,d_.db.Min),(0,wg.Z)(ax,Ig.MAX_EXT,d_.db.Max),(0,wg.Z)(ax,Ig.FUNC_SUBTRACT,d_.db.Subtract),(0,wg.Z)(ax,Ig.FUNC_REVERSE_SUBTRACT,d_.db.ReverseSubtract),ax),mx=(sx={},(0,wg.Z)(sx,Ig.ZERO,d_.zi.Zero),(0,wg.Z)(sx,Ig.ONE,d_.zi.One),(0,wg.Z)(sx,Ig.SRC_COLOR,d_.zi.SrcColor),(0,wg.Z)(sx,Ig.ONE_MINUS_SRC_COLOR,d_.zi.OneMinusSrcColor),(0,wg.Z)(sx,Ig.SRC_ALPHA,d_.zi.SrcAlpha),(0,wg.Z)(sx,Ig.ONE_MINUS_SRC_ALPHA,d_.zi.OneMinusSrcAlpha),(0,wg.Z)(sx,Ig.DST_COLOR,d_.zi.DstColor),(0,wg.Z)(sx,Ig.ONE_MINUS_DST_COLOR,d_.zi.OneMinusDstColor),(0,wg.Z)(sx,Ig.DST_ALPHA,d_.zi.DstAlpha),(0,wg.Z)(sx,Ig.ONE_MINUS_DST_ALPHA,d_.zi.OneMinusDstAlpha),(0,wg.Z)(sx,Ig.CONSTANT_COLOR,d_.zi.BlendColor),(0,wg.Z)(sx,Ig.ONE_MINUS_CONSTANT_COLOR,d_.zi.OneMinusBlendColor),(0,wg.Z)(sx,Ig.SRC_ALPHA_SATURATE,d_.zi.SrcAlphaSaturated),sx),yx=(ux={},(0,wg.Z)(ux,Ig.ALPHA,"r8unorm"),(0,wg.Z)(ux,Ig.RGBA,"rgba8unorm"),(0,wg.Z)(ux,Ig.DEPTH_COMPONENT,"depth32float"),(0,wg.Z)(ux,Ig.DEPTH_STENCIL,"depth24plus-stencil8"),ux),_x=(lx={},(0,wg.Z)(lx,Ig.NEAREST,"nearest"),(0,wg.Z)(lx,Ig.LINEAR,"linear"),lx),bx=(cx={},(0,wg.Z)(cx,Ig.REPEAT,"repeat"),(0,wg.Z)(cx,Ig.CLAMP_TO_EDGE,"clamp-to-edge"),(0,wg.Z)(cx,Ig.MIRRORED_REPEAT,"mirror-repeat"),cx);function xx(t){var e=t.cull;return e&&e.enable?e.face?e.face===Ig.FRONT?d_.Wf.Front:d_.Wf.Back:void 0:d_.Wf.None}function wx(t){var e=t.depth,n=(t.stencil,{compare:d_.wb.Always,depthFailOp:d_.xS.Keep,failOp:d_.xS.Keep,passOp:d_.xS.Keep});return{depthWriteEnabled:e&&e.enable,depthCompare:gx[(null==e?void 0:e.func)||Ig.ALWAYS],format:d_.EV.Depth24PlusStencil8,stencilFront:n,stencilBack:n,stencilReadMask:4294967295,stencilWriteMask:4294967295}}function Ex(t,e){var n=t.blend;return[{format:e,alphaBlend:{srcFactor:mx[n&&n.func&&n.func.srcAlpha||Ig.ONE],dstFactor:mx[n&&n.func&&n.func.dstAlpha||Ig.ZERO],operation:vx[n&&n.equation&&n.equation.alpha||Ig.FUNC_ADD]},colorBlend:{srcFactor:mx[n&&n.func&&n.func.srcRGB||Ig.ONE],dstFactor:mx[n&&n.func&&n.func.dstRGB||Ig.ZERO],operation:vx[n&&n.equation&&n.equation.rgb||Ig.FUNC_ADD]},writeMask:d_.Yw.All}]}function Sx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Cx(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Sx(Object(n),!0).forEach((function(e){(0,wg.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Sx(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ax(t){for(var e=0,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0,a=r;o<a.length;o++){var s=a[o];e+=s.length}for(var u=new t(e),l=0,c=0,h=r;c<h.length;c++){var f=h[c];u.set(f,l),l+=f.length}return u}var Tx,kx,Mx,Px=function(){function t(e,n){(0,Hd.Z)(this,t),this.engine=e,this.options=n,this.pipelineLayout=void 0,this.renderPipeline=void 0,this.uniformsBindGroupLayout=void 0,this.uniformBindGroup=void 0,this.uniformBuffer=void 0,this.uniforms={},this.uniformGPUBufferLayout=[],this.attributeCache={},this.indexBuffer=void 0,this.indexCount=void 0}var e,n;return(0,Xd.Z)(t,[{key:"init",value:(n=(0,Qd.Z)(Kd().mark((function t(){var e,n,r,i,o,a,s,u,l,c,h,f,p,d,g,v,m=this;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.options,n=e.vs,r=e.fs,i=e.attributes,o=e.uniforms,a=e.primitive,e.count,s=e.elements,u=e.depth,l=e.blend,c=e.stencil,h=e.cull,e.instances,t.next=3,this.compilePipelineStageDescriptor(n,r,null);case 3:f=t.sent,p=f.vertexStage,d=f.fragmentStage,o&&this.buildUniformBindGroup(o),s&&(this.indexBuffer=s.get(),this.indexCount=s.indexCount),g={vertexBuffers:Object.keys(i).map((function(t,e){var n=i[t],r=n.get(),o=r.arrayStride,a=r.stepMode,s=r.attributes;return m.attributeCache[t]=n,{arrayStride:o,stepMode:a,attributes:s}}))},v={sampleCount:this.engine.mainPassSampleCount,primitiveTopology:dx[a||Ig.TRIANGLES],rasterizationState:Cx(Cx({},this.getDefaultRasterizationStateDescriptor()),{},{cullMode:xx({cull:h})}),depthStencilState:wx({depth:u,stencil:c}),colorStates:Ex({blend:l},this.engine.options.swapChainFormat),layout:this.pipelineLayout,vertexStage:p,fragmentStage:d,vertexState:g},this.renderPipeline=this.engine.device.createRenderPipeline(v);case 11:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"addUniforms",value:function(t){this.uniforms=Cx(Cx({},this.uniforms),Ub(t))}},{key:"draw",value:function(t){var e=this,n=this.engine.getCurrentRenderPass(),r=Cx(Cx({},this.uniforms),Ub(t.uniforms||{})),i=[];Object.keys(r).forEach((function(t){var n=(0,Cg.Z)(r[t]);if("boolean"===n||"number"===n||Array.isArray(r[t])||r[t].BYTES_PER_ELEMENT){var o,a=null===(o=e.uniformGPUBufferLayout.find((function(e){return e.name===t})))||void 0===o?void 0:o.offset;null!==a&&e.uniformBuffer.subData({data:r[t],offset:a})}else{var s,u=null===(s=e.uniformGPUBufferLayout.find((function(e){return e.name===t})))||void 0===s?void 0:s.offset;if(null!==u){var l=r[t].get(),c=l.color||l,h=c.texture,f=c.sampler;f&&(i.push({binding:u,resource:f}),u++),i.push({binding:u,resource:h.createView()})}}})),this.uniformBuffer&&(i[0]={binding:0,resource:{buffer:this.uniformBuffer.get()}}),this.uniformBindGroup=this.engine.device.createBindGroup({layout:this.uniformsBindGroupLayout,entries:i}),this.renderPipeline&&n.setPipeline(this.renderPipeline),n.setBindGroup(0,this.uniformBindGroup),this.indexBuffer&&n.setIndexBuffer(this.indexBuffer.get(),d_.iD.Uint32,0),Object.keys(this.attributeCache).forEach((function(t,r){n.setVertexBuffer(0+r,e.attributeCache[t].get().buffer,0)})),this.indexBuffer?n.drawIndexed(this.indexCount,this.options.instances||1,0,0,0):n.draw(this.options.count||0,this.options.instances||0,0,0)}},{key:"destroy",value:function(){throw new Error("Method not implemented.")}},{key:"compilePipelineStageDescriptor",value:(e=(0,Qd.Z)(Kd().mark((function t(e,n,r){var i,o,a;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i="#version 450\n",o=e,a=n,this.engine.options.useWGSL){t.next=10;break}return t.next=6,this.compileShaderToSpirV(e,"vertex",i);case 6:return o=t.sent,t.next=9,this.compileShaderToSpirV(n,"fragment",i);case 9:a=t.sent;case 10:return t.abrupt("return",this.createPipelineStageDescriptor(o,a));case 11:case"end":return t.stop()}}),t,this)}))),function(t,n,r){return e.apply(this,arguments)})},{key:"compileShaderToSpirV",value:function(t,e,n){return this.compileRawShaderToSpirV(n+t,e)}},{key:"compileRawShaderToSpirV",value:function(t,e){return this.engine.glslang.compileGLSL(t,e)}},{key:"createPipelineStageDescriptor",value:function(t,e){return{vertexStage:{module:this.engine.device.createShaderModule({code:t,isWHLSL:Uy}),entryPoint:"main"},fragmentStage:{module:this.engine.device.createShaderModule({code:e,isWHLSL:Uy}),entryPoint:"main"}}}},{key:"getDefaultRasterizationStateDescriptor",value:function(){return{frontFace:d_.zX.CCW,cullMode:d_.Wf.None,depthBias:0,depthBiasSlopeScale:0,depthBiasClamp:0}}},{key:"buildUniformBindGroup",value:function(t){var e=this,n=0,r=Ax.apply(void 0,[Float32Array].concat((0,Ob.Z)(Object.keys(t).map((function(r){return t[r]?(e.uniformGPUBufferLayout.push({name:r,offset:n}),n+=4*(t[r].length||1),t[r]):[]}))))),i=[],o=!1;r.length&&(o=!0,i.push({binding:0,visibility:d_.$X.Fragment|d_.$X.Vertex,type:d_.$l.UniformBuffer})),Object.keys(t).filter((function(e){return null===t[e]})).forEach((function(t,n){e.uniformGPUBufferLayout.push({name:t,offset:2*n+(o?1:0)}),i.push({binding:2*n+(o?1:0),visibility:d_.$X.Fragment,type:d_.$l.Sampler},{binding:2*n+(o?1:0)+1,visibility:d_.$X.Fragment,type:d_.$l.SampledTexture})})),this.uniformsBindGroupLayout=this.engine.device.createBindGroupLayout({entries:i}),this.pipelineLayout=this.engine.device.createPipelineLayout({bindGroupLayouts:[this.uniformsBindGroupLayout]}),o&&(this.uniformBuffer=new nx(this.engine,{data:r instanceof Array?new Float32Array(r):r,usage:d_.FB.Uniform|d_.FB.CopyDst}))}}]),t}(),Ix=function(){function t(e,n){(0,Hd.Z)(this,t),this.engine=e,this.options=n,this.texture=void 0,this.sampler=void 0,this.width=void 0,this.height=void 0,this.createTexture()}return(0,Xd.Z)(t,[{key:"get",value:function(){return{texture:this.texture,sampler:this.sampler}}},{key:"update",value:function(){}},{key:"resize",value:function(t){var e=t.width,n=t.height;e===this.width&&n===this.height||(this.destroy(),this.createTexture()),this.width=e,this.height=n}},{key:"destroy",value:function(){this.texture&&this.texture.destroy()}},{key:"createTexture",value:function(){var t=this.options,e=(void 0===(t.data,t.type)&&Ig.UNSIGNED_BYTE,t.width),n=t.height,r=(t.flipY,t.format),i=void 0===r?Ig.RGBA:r,o=(t.mipmap,t.wrapS),a=void 0===o?Ig.CLAMP_TO_EDGE:o,s=t.wrapT,u=void 0===s?Ig.CLAMP_TO_EDGE:s,l=t.aniso,c=void 0===l?0:l,h=(t.alignment,t.premultiplyAlpha,t.mag),f=void 0===h?Ig.NEAREST:h,p=t.min,d=void 0===p?Ig.NEAREST:p,g=(void 0===t.colorSpace&&Ig.BROWSER_DEFAULT_WEBGL,t.usage);this.width=e,this.height=n,this.texture=this.engine.device.createTexture({size:[e,n,1],mipLevelCount:1,sampleCount:1,dimension:d_.kd.E2d,format:yx[i],usage:g||d_.v2.Sampled|d_.v2.CopyDst}),(!g||g&d_.v2.Sampled)&&(this.sampler=this.engine.device.createSampler({addressModeU:bx[a],addressModeV:bx[u],addressModeW:bx[a],magFilter:_x[f],minFilter:_x[d],maxAnisotropy:c}))}}]),t}(),Ox=(0,rg.b2)()((kx=function(){function t(){var e=this;(0,Hd.Z)(this,t),this.supportWebGPU=!0,this.useWGSL=!1,this.options=void 0,this.canvas=void 0,this.context=void 0,this.glslang=void 0,this.adapter=void 0,this.device=void 0,this.swapChain=void 0,this.mainPassSampleCount=void 0,this.mainTexture=void 0,this.depthTexture=void 0,this.mainColorAttachments=void 0,this.mainTextureExtends=void 0,this.mainDepthAttachment=void 0,this.uploadEncoder=void 0,this.renderEncoder=void 0,this.computeEncoder=void 0,this.renderTargetEncoder=void 0,this.commandBuffers=new Array(4).fill(void 0),this.currentRenderPass=null,this.mainRenderPass=null,this.currentRenderTargetViewDescriptor=void 0,this.currentComputePass=null,this.bundleEncoder=void 0,this.tempBuffers=[],this.currentRenderTarget=null,this.uploadEncoderDescriptor={label:"upload"},this.renderEncoderDescriptor={label:"render"},this.renderTargetEncoderDescriptor={label:"renderTarget"},this.computeEncoderDescriptor={label:"compute"},this.pipelines={},this.computePipelines={},this.defaultSampleCount=4,this.clearDepthValue=1,this.clearStencilValue=0,this.transientViewport={x:1/0,y:0,width:0,height:0},this.cachedViewport={x:0,y:0,width:0,height:0},this.clear=function(t){t.framebuffer;var n=t.color,r=t.depth,i=t.stencil;e.options.supportCompute&&e.startComputePass(),e.currentRenderTarget?(e.currentRenderPass&&e.endRenderTargetRenderPass(),e.startRenderTargetRenderPass(e.currentRenderTarget,n||null,!!r,!!i)):(e.mainColorAttachments[0].loadValue=n||d_.Ws.Load,e.mainDepthAttachment.depthLoadValue=r||d_.Ws.Load,e.mainDepthAttachment.stencilLoadValue=i?e.clearStencilValue:d_.Ws.Load,e.mainRenderPass&&e.endMainRenderPass(),e.startMainRenderPass())},this.createModel=function(){var t=(0,Qd.Z)(Kd().mark((function t(n){var r;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Px(e,n),t.next=3,r.init();case 3:return t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.createAttribute=function(t){return new ex(e,t)},this.createBuffer=function(t){return new nx(e,t)},this.createElements=function(t){return new fx(e,t)},this.createTexture2D=function(t){return new Ix(e,t)},this.createFramebuffer=function(t){return new px(e,t)},this.useFramebuffer=function(t,n){e.currentRenderTarget&&e.unbindFramebuffer(e.currentRenderTarget),e.currentRenderTarget=t,e.currentRenderTargetViewDescriptor={dimension:d_.p_.E2d,arrayLayerCount:1,aspect:d_.H7.All},e.currentRenderPass=null,n()},this.createComputeModel=function(){var t=(0,Qd.Z)(Kd().mark((function t(n){var r;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new hx(e,n),t.next=3,r.init();case 3:return t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.getCanvas=function(){return e.canvas},this.getGLContext=function(){throw new Error("Method not implemented.")},this.viewport=function(t){var n=t.x,r=t.y,i=t.width,o=t.height;e.currentRenderPass?e.transientViewport.x!==1/0?e.getCurrentRenderPass().setViewport(e.transientViewport.x,e.transientViewport.y,e.transientViewport.width,e.transientViewport.height,0,1):n===e.cachedViewport.x&&r===e.cachedViewport.y&&i===e.cachedViewport.width&&o===e.cachedViewport.height||(e.cachedViewport={x:n,y:r,width:i,height:o},e.getCurrentRenderPass().setViewport(n,r,i,o,0,1)):e.transientViewport={x:n,y:r,width:i,height:o}},this.readPixels=function(t){throw new Error("Method not implemented.")}}var e,n;return(0,Xd.Z)(t,[{key:"isFloatSupported",value:function(){return!0}},{key:"init",value:(n=(0,Qd.Z)(Kd().mark((function t(e){return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.canvas=e.canvas,this.options=e,this.useWGSL=!!e.useWGSL,this.mainPassSampleCount=e.antialiasing?this.defaultSampleCount:1,t.next=6,this.initGlslang();case 6:this.initContextAndSwapChain(),this.initMainAttachments();case 8:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"setScissor",value:function(t){throw new Error("Method not implemented.")}},{key:"destroy",value:function(){this.mainTexture&&this.mainTexture.destroy(),this.depthTexture&&this.depthTexture.destroy(),this.tempBuffers.forEach((function(t){return t.destroy()})),this.tempBuffers=[]}},{key:"beginFrame",value:function(){this.uploadEncoder=this.device.createCommandEncoder(this.uploadEncoderDescriptor),this.renderEncoder=this.device.createCommandEncoder(this.renderEncoderDescriptor),this.renderTargetEncoder=this.device.createCommandEncoder(this.renderTargetEncoderDescriptor),this.options.supportCompute&&(this.computeEncoder=this.device.createCommandEncoder(this.computeEncoderDescriptor))}},{key:"endFrame",value:function(){this.options.supportCompute&&this.endComputePass(),this.endMainRenderPass(),this.commandBuffers[0]=this.uploadEncoder.finish(),this.commandBuffers[1]=this.renderEncoder.finish(),this.options.supportCompute&&(this.commandBuffers[2]=this.computeEncoder.finish()),this.commandBuffers[3]=this.renderTargetEncoder.finish(),Uy?this.device.getQueue().submit(this.commandBuffers.filter((function(t){return t}))):this.device.defaultQueue.submit(this.commandBuffers.filter((function(t){return t})))}},{key:"getCurrentRenderPass",value:function(){return this.currentRenderTarget&&!this.currentRenderPass?this.startRenderTargetRenderPass(this.currentRenderTarget,null,!1,!1):this.currentRenderPass||this.startMainRenderPass(),this.currentRenderPass}},{key:"initGlslang",value:(e=(0,Qd.Z)(Kd().mark((function t(){var e,n;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,$b();case 2:return this.glslang=t.sent,t.next=5,null===(e=navigator)||void 0===e||null===(n=e.gpu)||void 0===n?void 0:n.requestAdapter();case 5:return this.adapter=t.sent,t.next=8,this.adapter.requestDevice();case 8:this.device=t.sent;case 9:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"initContextAndSwapChain",value:function(){this.context=this.canvas.getContext(Uy?"gpu":"gpupresent"),this.swapChain=this.context.configureSwapChain({device:this.device,format:this.options.swapChainFormat,usage:d_.v2.OutputAttachment|d_.v2.CopySrc})}},{key:"initMainAttachments",value:function(){if(this.mainTextureExtends={width:this.canvas.width,height:this.canvas.height,depth:1},this.options.antialiasing){var t={size:this.mainTextureExtends,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:d_.kd.E2d,format:d_.EV.BGRA8Unorm,usage:d_.v2.OutputAttachment};this.mainTexture&&this.mainTexture.destroy(),this.mainTexture=this.device.createTexture(t),this.mainColorAttachments=[{attachment:Uy?this.mainTexture.createDefaultView():this.mainTexture.createView(),loadValue:[0,0,0,1],storeOp:d_.EG.Store}]}else this.mainColorAttachments=[{attachment:Uy?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView(),loadValue:[0,0,0,1],storeOp:d_.EG.Store}];var e={size:this.mainTextureExtends,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:d_.kd.E2d,format:Uy?"depth32float-stencil8":d_.EV.Depth24PlusStencil8,usage:d_.v2.OutputAttachment};this.depthTexture&&this.depthTexture.destroy(),this.depthTexture=this.device.createTexture(e),this.mainDepthAttachment={attachment:Uy?this.depthTexture.createDefaultView():this.depthTexture.createView(),depthLoadValue:this.clearDepthValue,depthStoreOp:d_.EG.Store,stencilLoadValue:this.clearStencilValue,stencilStoreOp:d_.EG.Store}}},{key:"startComputePass",value:function(){this.currentComputePass&&this.endComputePass(),this.currentComputePass=this.computeEncoder.beginComputePass()}},{key:"startMainRenderPass",value:function(){this.currentRenderPass&&!this.currentRenderTarget&&this.endMainRenderPass(),this.options.antialiasing?this.mainColorAttachments[0].resolveTarget=Uy?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView():this.mainColorAttachments[0].attachment=Uy?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView(),this.currentRenderPass=this.renderEncoder.beginRenderPass({colorAttachments:this.mainColorAttachments,depthStencilAttachment:this.mainDepthAttachment}),this.mainRenderPass=this.currentRenderPass,this.cachedViewport&&this.viewport(this.cachedViewport)}},{key:"startRenderTargetRenderPass",value:function(t,e,n){var r,i,o,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=null===(r=t.get().color)||void 0===r?void 0:r.texture;s&&(o=s.createView(this.currentRenderTargetViewDescriptor));var u,l=null===(i=t.get().depth)||void 0===i?void 0:i.texture;l&&(u=l.createView());var c=this.renderTargetEncoder.beginRenderPass({colorAttachments:[{attachment:o,loadValue:null!==e?e:d_.Ws.Load,storeOp:d_.EG.Store}],depthStencilAttachment:l&&u?{attachment:u,depthLoadValue:n?this.clearDepthValue:d_.Ws.Load,depthStoreOp:d_.EG.Store,stencilLoadValue:a?this.clearStencilValue:d_.Ws.Load,stencilStoreOp:d_.EG.Store}:void 0});this.currentRenderPass=c,this.cachedViewport&&this.viewport(this.cachedViewport)}},{key:"endMainRenderPass",value:function(){this.currentRenderPass===this.mainRenderPass&&null!==this.currentRenderPass&&(this.currentRenderPass.endPass(),this.resetCachedViewport(),this.currentRenderPass=null,this.mainRenderPass=null)}},{key:"endComputePass",value:function(){this.currentComputePass&&(this.currentComputePass.endPass(),this.currentComputePass=null)}},{key:"endRenderTargetRenderPass",value:function(){this.currentRenderPass&&(this.currentRenderPass.endPass(),this.resetCachedViewport())}},{key:"resetCachedViewport",value:function(){this.cachedViewport={x:0,y:0,width:0,height:0}}},{key:"unbindFramebuffer",value:function(t){this.currentRenderPass&&this.currentRenderPass!==this.mainRenderPass&&this.endRenderTargetRenderPass(),this.transientViewport.x=1/0,this.currentRenderTarget=null,this.currentRenderPass=this.mainRenderPass}}]),t}(),Tx=kx))||Tx;var Rx,Lx=4/64,Dx=(0,rg.b2)()(Mx=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(){return(0,Hd.Z)(this,i),r.apply(this,arguments)}return(0,Xd.Z)(i,[{key:"onEntityCreated",value:function(){var t=this.config,e=t.widthSegments,n=void 0===e?1:e,r=t.heightSegments,i=void 0===r?1:r,o=t.depthSegments,a=void 0===o?1:o,s=t.halfExtents,u=void 0===s?Pe.fromValues(.5,.5,.5):s,l=n,c=i,h=a,f=(0,ng.Z)(u,3),p=f[0],d=f[1],g=f[2],v=[Pe.fromValues(-p,-d,g),Pe.fromValues(p,-d,g),Pe.fromValues(p,d,g),Pe.fromValues(-p,d,g),Pe.fromValues(p,-d,-g),Pe.fromValues(-p,-d,-g),Pe.fromValues(-p,d,-g),Pe.fromValues(p,d,-g)],m=[[0,1,3],[4,5,7],[3,2,6],[1,0,4],[1,4,2],[5,0,6]],y=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],_=[],b=[],x=[],w=[],E=[],S=0,C=function(t,e,n){var r,i,o,a;for(o=0;o<=e;o++)for(a=0;a<=n;a++){var s=Pe.create(),u=Pe.create(),l=Pe.create(),c=Pe.create();Pe.lerp(s,v[m[t][0]],v[m[t][1]],o/e),Pe.lerp(u,v[m[t][0]],v[m[t][2]],a/n),Pe.sub(l,u,v[m[t][0]]),Pe.add(c,s,l),r=o/e,i=a/n,_.push(c[0],c[1],c[2]),b.push(y[t][0],y[t][1],y[t][2]),x.push(r,i),r=.875*(r/=3)+Lx,i=.875*(i/=3)+Lx,r+=t%3/3,i+=Math.floor(t/3)/3,w.push(r,i),o<e&&a<n&&(E.push(S+n+1,S+1,S),E.push(S+n+1,S+n+2,S+1)),S++}};C(0,l,c),C(1,l,c),C(2,l,h),C(3,l,h),C(4,h,c),C(5,h,c);var A=Ny(_),T=this.getComponent();T.indices=Uint32Array.from(E),T.aabb=A,T.vertexCount=S,T.attributes=[{dirty:!0,name:"position",data:Float32Array.from(_),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(b),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(x),arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),i}(p_))||Mx;var Nx,Bx=(0,rg.b2)()(Rx=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(){return(0,Hd.Z)(this,i),r.apply(this,arguments)}return(0,Xd.Z)(i,[{key:"onEntityCreated",value:function(){var t=this.config.geometries,e=void 0===t?[]:t,n=this.getComponent();n.aabb=new av;var r=[],i=[],o=0;e.forEach((function(t){var e=t.aabb,a=t.indices,s=t.vertexCount,u=t.attributes;n.aabb.add(e),n.vertexCount+=s,a&&i.push.apply(i,(0,Ob.Z)(a.map((function(t){return t+o})))),o+=s,u.forEach((function(t,e){r[e]?t.data&&(Gy(t.data)?r[e].push(t.data):T_(t.data)?r[e].data=function(t,e){if(!t&&!e)throw new Error("Please specify valid arguments for parameters a and b.");if(!e||0===e.length)return t;if(!t||0===t.length)return e;if(Object.prototype.toString.call(t)!==Object.prototype.toString.call(e))throw new Error("The types of the two arguments passed for parameters a and b do not match.");var n=new t.constructor(t.length+e.length);return n.set(t),n.set(e,t.length),n}(r[e].data,t.data):r[e].data=r[e].data.concat(t.data)):(r[e]=t,r[e].dirty=!0)}))})),n.attributes=r,n.indices=Uint32Array.from(i),n.dirty=!0}}]),i}(p_))||Rx;var zx,Fx=(0,rg.b2)()(Nx=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(){return(0,Hd.Z)(this,i),r.apply(this,arguments)}return(0,Xd.Z)(i,[{key:"onEntityCreated",value:function(){for(var t=this.config,e=t.halfExtents,n=void 0===e?[.5,.5]:e,r=t.widthSegments,i=void 0===r?5:r,o=t.lengthSegments,a=void 0===o?5:o,s=[],u=[],l=[],c=[],h=0,f=0;f<=i;f++)for(var p=0;p<=a;p++){var d=-n[0]+2*n[0]*f/i,g=-(-n[1]+2*n[1]*p/a),v=f/i,m=p/a;s.push(d,0,g),u.push(0,1,0),l.push(v,m),f<i&&p<a&&(c.push(h+a+1,h+1,h),c.push(h+a+1,h+a+2,h+1)),h++}var y=Ny(s),_=this.getComponent();_.indices=Uint32Array.from(c),_.aabb=y,_.vertexCount=h,_.attributes=[{dirty:!0,name:"position",data:Float32Array.from(s),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(u),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(l),arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),i}(p_))||Nx;var Zx,jx,Ux,Gx,Vx,Wx,Hx,Xx,Yx=(0,rg.b2)()(zx=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(){return(0,Hd.Z)(this,i),r.apply(this,arguments)}return(0,Xd.Z)(i,[{key:"onEntityCreated",value:function(){for(var t=this.config,e=t.radius,n=void 0===e?.5:e,r=t.latitudeBands,i=void 0===r?16:r,o=t.longitudeBands,a=void 0===o?16:o,s=[],u=[],l=[],c=[],h=0;h<=i;h++)for(var f=h*Math.PI/i,p=Math.sin(f),d=Math.cos(f),g=0;g<=a;g++){var v=2*g*Math.PI/a-Math.PI/2,m=Math.sin(v),y=Math.cos(v)*p,_=d,b=m*p,x=1-g/a,w=1-h/i;s.push(y*n,_*n,b*n),u.push(y,_,b),l.push(x,w)}for(var E=0;E<i;++E)for(var S=0;S<a;++S){var C=E*(a+1)+S,A=C+a+1;c.push(C+1,A,C),c.push(C+1,A+1,A)}var T=Ny(s),k=this.getComponent();k.indices=Uint32Array.from(c),k.aabb=T,k.vertexCount=s.length/3,k.attributes=[{dirty:!0,name:"position",data:Float32Array.from(s),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(u),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(l),arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),i}(p_))||zx;var qx,Kx,Qx,Jx,$x,tw,ew,nw,rw,iw,ow,aw,sw=(Zx=(0,rg.b2)(),jx=(0,rg.f3)(ig.RenderEngine),Ux=(0,rg.f3)(ig.ShaderModuleService),Zx((Xx=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(){var t;(0,Hd.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,Wd.Z)(t,"engine",Wx,(0,Eg.Z)(t)),(0,Wd.Z)(t,"shaderModuleService",Hx,(0,Eg.Z)(t)),t}return(0,Xd.Z)(i,[{key:"onEntityCreated",value:function(){var t=this.getComponent(),e=this.engine.supportWebGPU?"layout(set = 0, binding = 0) uniform Uniforms {\n  vec4 color;\n  mat4 projectionMatrix;\n  mat4 modelViewMatrix;\n} uniforms;\n\nlayout(location = 0) in vec3 position;\n// layout(location = 1) in vec3 barycentric;\n\nlayout(location = 0) out vec4 fragColor;\n// layout(location = 1) out vec3 v_Barycentric;\n\nvoid main() {\n  gl_Position = uniforms.projectionMatrix * uniforms.modelViewMatrix * vec4(position, 1.0);\n  fragColor = uniforms.color;\n  // v_Barycentric = barycentric;\n}":'attribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec4 color;\n\nvarying vec4 fragColor;\n\n#pragma include "uv.vert.declaration"\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  fragColor = color;\n\n  #pragma include "uv.vert.main"\n}',n=this.engine.supportWebGPU?"// layout(set = 0, binding = 1) uniform WireframeUniforms {\n//   float lineWidth;\n//   vec4 lineColor;\n// } wireframe;\n\nlayout(location = 0) in vec4 fragColor;\n// layout(location = 1) in vec3 v_Barycentric;\n\nlayout(location = 0) out vec4 outColor;\n\n// wireframe\n// float edgeFactor() {\n//   vec3 d = fwidth(v_Barycentric);\n//   vec3 a3 = smoothstep(vec3(0.0), d * wireframe.lineWidth, v_Barycentric);\n//   return min(min(a3.x, a3.y), a3.z);\n// }\n\nvoid main() {\n  // outColor = mix(fragColor, wireframe.lineColor, (1.0 - edgeFactor()));\n  outColor = fragColor;\n}":'varying vec4 fragColor;\n\n#pragma include "uv.frag.declaration"\n#pragma include "map.frag.declaration"\n\nvoid main() {\n  vec4 diffuseColor = fragColor;\n\n  #pragma include "map.frag.main"\n\n  gl_FragColor = diffuseColor;\n}';this.shaderModuleService.registerModule("material-basic",{vs:e,fs:n});var r=this.shaderModuleService.getModule("material-basic"),i=r.vs,o=r.fs,a=r.uniforms;t.vertexShaderGLSL=i,t.fragmentShaderGLSL=o,t.setUniform(a),this.config.map&&(t.setDefines({USE_UV:1,USE_MAP:1}),t.setUniform({map:this.config.map,uvTransform:T()}))}}]),i}(fb),Vx=Xx,Wx=(0,Yd.Z)(Vx.prototype,"engine",[jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hx=(0,Yd.Z)(Vx.prototype,"shaderModuleService",[Ux],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gx=Vx))||Gx);var uw,lw,cw,hw,fw,pw,dw,gw,vw,mw,yw,_w,bw=(qx=(0,rg.b2)(),Kx=(0,rg.f3)(ig.Systems),Qx=(0,rg.t6)(ig.MaterialSystem),Jx=(0,rg.f3)(ig.Systems),$x=(0,rg.t6)(ig.GeometrySystem),tw=(0,rg.f3)(ig.ShaderModuleService),qx((aw=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(){var t;(0,Hd.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,Wd.Z)(t,"materialSystem",rw,(0,Eg.Z)(t)),(0,Wd.Z)(t,"geometrySystem",iw,(0,Eg.Z)(t)),(0,Wd.Z)(t,"shaderModuleService",ow,(0,Eg.Z)(t)),t}return(0,Xd.Z)(i,[{key:"onAttributeChanged",value:function(t){var e=t.name,n=t.data,r=this.getMeshComponent();r&&r.material&&("gridColor"===e?(r.material.setUniform("u_GridColor",n),r.material.setUniform("u_GridColor2",n)):"gridSize"===e&&(r.material.setUniform("u_GridSize",n),r.material.setUniform("u_GridSize2",n)))}},{key:"onEntityCreated",value:function(){this.shaderModuleService.registerModule("grid",{vs:"attribute vec3 a_Position;\n\nvarying vec3 v_Position;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n\nvoid main() {\n  v_Position = a_Position;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(a_Position, 1.);\n}",fs:"// generate grid, borrow from clay.gl viewer\n// @see https://github.com/pissang/clay-viewer/blob/master/src/graphic/ground.glsl\n#extension GL_OES_standard_derivatives : enable\n\nvarying vec3 v_Position;\n// varying vec3 v_Normal;\n\nuniform float u_GridSize : 5;\nuniform float u_GridSize2 : .5;\nuniform vec4 u_GridColor : [0, 0, 0, 1];\nuniform vec4 u_GridColor2 : [0.3, 0.3, 0.3, 1];\nuniform bool u_GridEnabled : true;\n\n// uniform vec3 u_LightDirection;\n// uniform vec3 u_LightColor;\n// uniform vec3 u_Camera;\n\nvoid main() {\n  // vec3 n = v_Normal;\n  // vec3 l = normalize(u_LightDirection);\n  // float NdotL = clamp(dot(n, l), 0.001, 1.0);\n\n  gl_FragColor = vec4(1.);\n\n  if (u_GridEnabled) {\n    float wx = v_Position.x;\n    float wz = v_Position.z;\n    // float x0 = abs(fract(wx / u_GridSize - 0.5) - 0.5) / fwidth(wx) * u_GridSize / 2.0;\n    // float z0 = abs(fract(wz / u_GridSize - 0.5) - 0.5) / fwidth(wz) * u_GridSize / 2.0;\n\n    float x1 = abs(fract(wx / u_GridSize2 - 0.5) - 0.5) / fwidth(wx) * u_GridSize2;\n    float z1 = abs(fract(wz / u_GridSize2 - 0.5) - 0.5) / fwidth(wz) * u_GridSize2;\n\n    // float v0 = 1.0 - clamp(min(x0, z0), 0.0, 1.0);\n    float v1 = 1.0 - clamp(min(x1, z1), 0.0, 1.0);\n    // if (v0 > 0.1) {\n        // gl_FragColor = mix(gl_FragColor, u_GridColor, v0);\n    // }\n    // else {\n        gl_FragColor = mix(gl_FragColor, u_GridColor2, v1);\n    // }\n  }\n\n  // float shadowFactor = calcShadow(u_ShadowMap, v_PositionFromLight, l, n);\n  // vec3 diffuseColor = u_LightColor * NdotL * shadowFactor;\n\n  // gl_FragColor.rgb *= diffuseColor;\n}"});var t=this.shaderModuleService.getModule("grid"),e=t.vs,n=t.fs,r=t.uniforms,i=this.materialSystem.createShaderMaterial({vertexShader:e,fragmentShader:n});this.setMaterial(i);var o=this.geometrySystem.createBufferGeometry({vertexCount:4});this.setGeometry(o),i.setCull({enable:!1,face:Ig.BACK}).setDepth({enable:!0,func:Ig.LESS}),i.setUniform(r),this.setAttributes({gridColor:this.config.gridColor,gridSize:this.config.gridSize}),o.setIndex([0,3,2,2,1,0]),o.setAttribute("a_Position",Float32Array.from([-4,-1,-4,4,-1,-4,4,-1,4,-4,-1,4]),{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]})}}]),i}(pb),nw=aw,rw=(0,Yd.Z)(nw.prototype,"materialSystem",[Kx,Qx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iw=(0,Yd.Z)(nw.prototype,"geometrySystem",[Jx,$x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ow=(0,Yd.Z)(nw.prototype,"shaderModuleService",[tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ew=nw))||ew),xw=n(2644),ww=n(582);function Ew(t,e,n,r,i){Sw(e,r,-i),Sw(e,r,i),t.push(n),t.push(n)}function Sw(t,e,n){t.push([[e[0],e[1]],n])}var Cw,Aw,Tw,kw,Mw,Pw,Iw,Ow,Rw,Lw,Dw,Nw,Bw=(uw=(0,rg.b2)(),lw=(0,rg.f3)(ig.Systems),cw=(0,rg.t6)(ig.MaterialSystem),hw=(0,rg.f3)(ig.Systems),fw=(0,rg.t6)(ig.GeometrySystem),pw=(0,rg.f3)(ig.ShaderModuleService),uw((_w=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(){var t;(0,Hd.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,Wd.Z)(t,"materialSystem",vw,(0,Eg.Z)(t)),(0,Wd.Z)(t,"geometrySystem",mw,(0,Eg.Z)(t)),(0,Wd.Z)(t,"shaderModuleService",yw,(0,Eg.Z)(t)),t.vertexCount=void 0,t}return(0,Xd.Z)(i,[{key:"onAttributeChanged",value:function(t){var e=t.name,n=t.data,r=this.getMeshComponent();if(r&&r.material)switch(e){case"dashArray":r.material.setUniform("u_dash_array",n);break;case"dashOffset":r.material.setUniform("u_dash_offset",n);break;case"dashRatio":r.material.setUniform("u_dash_ratio",n);break;case"thickness":r.material.setUniform("u_thickness",n);break;case"color":var i=new Array(this.vertexCount).fill(void 0).map((function(){return n})).reduce((function(t,e){return[].concat((0,Ob.Z)(t),(0,Ob.Z)(e))}),[]);r.geometry.setAttribute("a_color",Float32Array.from(i),{arrayStride:16,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float4"}]})}}},{key:"onEntityCreated",value:function(){var t=this;this.shaderModuleService.registerModule("line",{vs:"attribute vec2 a_pos;\nattribute vec4 a_color;\nattribute float a_line_miter;\nattribute vec2 a_line_normal;\nattribute float a_counters;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float u_thickness : 0.02;\nuniform vec2 u_viewport;\n\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_counters;\n\nvoid main() {\n  v_color = a_color;\n  v_counters = a_counters;\n\n  vec3 normal = normalize(vec3(a_line_normal, 0.0));\n\n  vec4 offset = vec4(normal * u_thickness / 2.0 * a_line_miter, 0.0);\n\n  v_normal = vec2(normal * sign(a_line_miter));\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(a_pos, 0.0, 1.0) + offset;\n}\n",fs:"uniform float u_dash_array : 0.02;\nuniform float u_dash_offset : 0;\nuniform float u_dash_ratio : 0;\nuniform float u_thickness : 0.02;\n\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_counters;\n\nvoid main() {\n    float blur = 1. - smoothstep(0.98, 1., length(v_normal));\n\n    gl_FragColor = v_color;\n    gl_FragColor.a *= blur * ceil(mod(v_counters + u_dash_offset, u_dash_array) - (u_dash_array * u_dash_ratio));\n}"});var e=this.shaderModuleService.getModule("line"),n=e.vs,r=e.fs,i=e.uniforms,o=this.materialSystem.createShaderMaterial({vertexShader:n,fragmentShader:r}),a=function(t,e,n){for(var r=[0,0],i=[0,0],o=[0,0],a=[0,0],s=-1,u=!1,l=null,c=(0,xw.create)(),h=0,f=[],p=[],d=[],g=[0,0],v=t.length,m=1;m<v;m++){var y=h,_=t[m-1],b=t[m],x=m<t.length-1?t[m+1]:null;if(g.push(m/v,m/v),(0,ww.o7)(r,b,_),l||(l=[0,0],(0,ww.mJ)(l,r)),u||(u=!0,Ew(p,f,_,l,1)),d.push([y+0,y+1,y+2]),x){(0,ww.o7)(i,x,b);var w=(0,ww.x7)(o,a,r,i,1),E=(0,xw.dot)(o,l)<0?-1:1,S=w>3;if(!isFinite(w)){(0,ww.mJ)(l,r),Ew(p,f,b,l,1),d.push(1===s?[y,y+2,y+3]:[y+2,y+1,y+3]),h+=2,s=E;continue}S?(w=3,g.push(m/v),Sw(f,l,-E),p.push(b),Sw(f,a,w*E),p.push(b),d.push(s!==-E?[y,y+2,y+3]:[y+2,y+1,y+3]),d.push([y+2,y+3,y+4]),(0,ww.mJ)(c,i),(0,xw.copy)(l,c),Sw(f,l,-E),p.push(b),h+=3):(Ew(p,f,b,a,w),d.push(1===s?[y,y+2,y+3]:[y+2,y+1,y+3]),E=-1,(0,xw.copy)(l,a),h+=2),s=E}else(0,ww.mJ)(l,r),Ew(p,f,b,l,1),d.push(1===s?[y,y+2,y+3]:[y+2,y+1,y+3]),h+=2}return{normals:f,attrIndex:d,attrPos:p,attrCounters:g}}(this.config.points),s=a.normals,u=a.attrIndex,l=a.attrPos,c=a.attrCounters,h=l.length;this.vertexCount=h;var f=this.geometrySystem.createBufferGeometry({vertexCount:h});this.setMaterial(o),this.setGeometry(f),o.setCull({enable:!1,face:Ig.BACK}).setUniform(i),this.setAttributes({dashArray:this.config.dashArray,dashOffset:this.config.dashOffset,dashRatio:this.config.dashRatio,thickness:this.config.thickness});var p=[],d=[];s.forEach((function(t){var e=t[0],n=t[1];p.push([e[0],e[1]]),d.push(n)})),f.setIndex(u.reduce((function(t,e){return[].concat((0,Ob.Z)(t),(0,Ob.Z)(e))}),[])),f.setAttribute("a_pos",Float32Array.from(l.reduce((function(t,e){return[].concat((0,Ob.Z)(t),(0,Ob.Z)(e))}),[])),{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]});var g=new Array(h).fill(void 0).map((function(){return(0,Ob.Z)(t.config.color)})).reduce((function(t,e){return[].concat((0,Ob.Z)(t),(0,Ob.Z)(e))}),[]);f.setAttribute("a_color",Float32Array.from(g),{arrayStride:16,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float4"}]}),f.setAttribute("a_line_miter",Float32Array.from(d),{arrayStride:4,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float"}]}),f.setAttribute("a_line_normal",Float32Array.from(p.reduce((function(t,e){return[].concat((0,Ob.Z)(t),(0,Ob.Z)(e))}),[])),{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:3,offset:0,format:"float2"}]}),f.setAttribute("a_counters",Float32Array.from(c),{arrayStride:4,stepMode:"vertex",attributes:[{shaderLocation:4,offset:0,format:"float"}]})}}]),i}(pb),gw=_w,vw=(0,Yd.Z)(gw.prototype,"materialSystem",[lw,cw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mw=(0,Yd.Z)(gw.prototype,"geometrySystem",[hw,fw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yw=(0,Yd.Z)(gw.prototype,"shaderModuleService",[pw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dw=gw))||dw);function zw(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var Fw,Zw,jw,Uw,Gw,Vw,Ww,Hw,Xw,Yw,qw=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],Kw=(Cw=(0,rg.b2)(),Aw=(0,rg.f3)(ig.Systems),Tw=(0,rg.t6)(ig.MaterialSystem),kw=(0,rg.f3)(ig.Systems),Mw=(0,rg.t6)(ig.GeometrySystem),Pw=(0,rg.f3)(ig.ShaderModuleService),Cw((Nw=function(t){(0,ug.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,cg.Z)(e);if(n){var i=(0,cg.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,lg.Z)(this,t)});function i(){var t;(0,Hd.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,Wd.Z)(t,"materialSystem",Rw,(0,Eg.Z)(t)),(0,Wd.Z)(t,"geometrySystem",Lw,(0,Eg.Z)(t)),(0,Wd.Z)(t,"shaderModuleService",Dw,(0,Eg.Z)(t)),t}return(0,Xd.Z)(i,[{key:"onAttributeChanged",value:function(t){var e=t.name,n=t.data,r=this.getMeshComponent();r&&r.material&&("strokeWidth"===e?r.material.setUniform("u_stroke_width",n):"strokeColor"===e?r.material.setUniform("u_stroke_color",n):"strokeOpacity"===e?r.material.setUniform("u_stroke_opacity",n):"opacity"===e?r.material.setUniform("u_opacity",n):"blur"===e&&r.material.setUniform("u_blur",n))}},{key:"onEntityCreated",value:function(){this.shaderModuleService.registerModule("grid",{vs:'attribute vec2 position;\nattribute vec4 color;\nattribute float shape;\nattribute vec2 offset;\nattribute float size;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n\nuniform float u_stroke_width : 0.01;\nuniform float u_device_pixel_ratio;\nuniform vec2 u_viewport;\n\nvarying vec4 v_color;\nvarying vec4 v_data;\nvarying float v_radius;\n\n#pragma include "picking"\n\nvoid main() {\n  v_color = color;\n  v_radius = size;\n\n  lowp float antialiasblur = 1.0 / u_device_pixel_ratio * (size + u_stroke_width);\n\n  // construct point coords\n  v_data = vec4(position, antialiasblur, shape);\n\n  gl_Position = projectionMatrix * modelViewMatrix\n    * vec4(position * size + offset, 0.0, 1.0);\n\n  setPickingColor(a_PickingColor);\n}',fs:"uniform float u_blur : 0.05;\nuniform float u_opacity : 0.7;\nuniform float u_stroke_width : 0.01;\nuniform vec4 u_stroke_color : [0, 0, 0, 0];\nuniform float u_stroke_opacity : 1;\n\nvarying vec4 v_color;\nvarying vec4 v_data;\nvarying float v_radius;\n\n#pragma include \"sdf2d\"\n#pragma include \"picking\"\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  float antialiasblur = v_data.z;\n  float antialiased_blur = -max(u_blur, antialiasblur);\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  // if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  // } else if (shape == 1) {\n  //   outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n  //   inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  // } else if (shape == 2) {\n  //   outer_df = sdBox(v_data.xy, vec2(1.));\n  //   inner_df = sdBox(v_data.xy, vec2(r));\n  // } else if (shape == 3) {\n  //   outer_df = sdPentagon(v_data.xy, 0.8);\n  //   inner_df = sdPentagon(v_data.xy, r * 0.8);\n  // } else if (shape == 4) {\n  //   outer_df = sdHexagon(v_data.xy, 0.8);\n  //   inner_df = sdHexagon(v_data.xy, r * 0.8);\n  // } else if (shape == 5) {\n  //   outer_df = sdOctogon(v_data.xy, 1.0);\n  //   inner_df = sdOctogon(v_data.xy, r);\n  // } else if (shape == 6) {\n  //   outer_df = sdHexagram(v_data.xy, 0.52);\n  //   inner_df = sdHexagram(v_data.xy, r * 0.52);\n  // } else if (shape == 7) {\n  //   outer_df = sdRhombus(v_data.xy, vec2(1.0));\n  //   inner_df = sdRhombus(v_data.xy, vec2(r));\n  // } else if (shape == 8) {\n  //   outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n  //   inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  // }\n\n  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    inner_df\n  );\n  vec4 strokeColor = u_stroke_color == vec4(0) ? v_color : u_stroke_color;\n\n  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);\n  gl_FragColor.a = gl_FragColor.a * opacity_t;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}"});var t=this.shaderModuleService.getModule("grid"),e=t.vs,n=t.fs,r=t.uniforms,i=this.materialSystem.createShaderMaterial({vertexShader:e,fragmentShader:n,cull:{enable:!1},depth:{enable:!1},blend:{enable:!0,func:{srcRGB:Ig.SRC_ALPHA,dstRGB:Ig.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}});i.setUniform(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?zw(Object(n),!0).forEach((function(e){(0,wg.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zw(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({u_device_pixel_ratio:window.devicePixelRatio},r));var o=this.buildAttributes(),a=this.geometrySystem.createInstancedBufferGeometry({maxInstancedCount:o.instancedOffsets.length/2,vertexCount:6});a.setIndex([0,2,1,0,3,2]),a.setAttribute("position",Float32Array.from(o.positions),{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]}),a.setAttribute("offset",Float32Array.from(o.instancedOffsets),{arrayStride:8,stepMode:"instance",attributes:[{shaderLocation:1,offset:0,format:"float2"}]}),a.setAttribute("color",Float32Array.from(o.instancedColors),{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:2,offset:0,format:"float4"}]}),a.setAttribute("size",Float32Array.from(o.instancedSizes),{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:3,offset:0,format:"float"}]}),a.setAttribute("shape",Float32Array.from(o.instancedShapes),{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:4,offset:0,format:"float"}]}),a.setAttribute("a_PickingColor",Float32Array.from(o.instancedPickingColors),{arrayStride:12,stepMode:"instance",attributes:[{shaderLocation:6,offset:0,format:"float3"}]}),this.setMaterial(i),this.setGeometry(a)}},{key:"buildAttribute",value:function(t,e,n){var r,i,o,a,s;(r=e.instancedPickingColors).push.apply(r,(0,Ob.Z)([(s=t.id||n)+1&255,s+1>>8&255,s+1>>8>>8&255])),e.instancedShapes.push(qw.indexOf(t.shape||"circle")),(i=e.instancedColors).push.apply(i,(0,Ob.Z)(t.color||[1,0,0,1])),(o=e.instancedOffsets).push.apply(o,(0,Ob.Z)(t.position||[0,0])),(a=e.instancedSizes).push.apply(a,(0,Ob.Z)(t.size||[.2,.2]))}},{key:"buildAttributes",value:function(){var t=this,e={positions:[1,1,1,-1,-1,-1,-1,1],instancedOffsets:[],instancedColors:[],instancedSizes:[],instancedShapes:[],instancedPickingColors:[]};return Array.isArray(this.config)?this.config.forEach((function(n,r){t.buildAttribute(n,e,r)})):this.buildAttribute(this.config,e,0),e}}]),i}(pb),Ow=Nw,Rw=(0,Yd.Z)(Ow.prototype,"materialSystem",[Aw,Tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lw=(0,Yd.Z)(Ow.prototype,"geometrySystem",[kw,Mw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dw=(0,Yd.Z)(Ow.prototype,"shaderModuleService",[Pw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iw=Ow))||Iw);function Qw(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Jw(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jw(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Jw(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var $w,tE,eE,nE,rE,iE,oE,aE,sE,uE,lE,cE,hE=(Fw=(0,rg.b2)(),Zw=(0,rg.f3)(ig.RenderEngine),jw=(0,rg.f3)(ig.ShaderModuleService),Uw=(0,rg.f3)(ig.ConfigService),Fw((Yw=function(){function t(){(0,Hd.Z)(this,t),this.container=void 0,(0,Wd.Z)(this,"engine",Ww,this),(0,Wd.Z)(this,"shaderModule",Hw,this),(0,Wd.Z)(this,"configService",Xw,this),this.inited=!1,this.rendering=!1,this.pendings=[],this.views=[],this.size=void 0}var e,n;return(0,Xd.Z)(t,[{key:"init",value:(n=(0,Qd.Z)(Kd().mark((function t(){var e,n,r,i,o;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.shaderModule.registerBuiltinModules(),this.shaderModule.registerModule("uv.vert.declaration",{vs:"#ifdef USE_UV\n  attribute vec2 uv;\n\t#ifdef UVS_VERTEX_ONLY\n    vec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif"}),this.shaderModule.registerModule("uv.vert.main",{vs:"#ifdef USE_UV\n  vUv = (uvTransform * vec3(uv, 1)).xy;\n#endif"}),this.shaderModule.registerModule("uv.frag.declaration",{fs:"#if (defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ))\n  varying vec2 vUv;\n#endif"}),this.shaderModule.registerModule("map.frag.declaration",{fs:"#ifdef USE_MAP\n  uniform sampler2D map;\n#endif"}),this.shaderModule.registerModule("map.frag.main",{fs:"#ifdef USE_MAP\n  vec4 texelColor = texture2D(map, vUv);\n  // texelColor = mapTexelToLinear(texelColor);\n  diffuseColor *= texelColor;\n#endif"}),e=this.container.getAll(ig.Systems),!(n=this.configService.get()).canvas){t.next=30;break}return t.next=11,this.engine.init({canvas:n.canvas,swapChainFormat:d_.EV.BGRA8Unorm,antialiasing:!1});case 11:r=Qw(e),t.prev=12,r.s();case 14:if((i=r.n()).done){t.next=21;break}if(!(o=i.value).initialize){t.next=19;break}return t.next=19,o.initialize();case 19:t.next=14;break;case 21:t.next=26;break;case 23:t.prev=23,t.t0=t.catch(12),r.e(t.t0);case 26:return t.prev=26,r.f(),t.finish(26);case 29:this.inited=!0;case 30:case"end":return t.stop()}}),t,this,[[12,23,26,29]])}))),function(){return n.apply(this,arguments)})},{key:"render",value:(e=(0,Qd.Z)(Kd().mark((function t(){var e,n,r,i,o,a,s,u=arguments;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.inited&&!this.rendering){t.next=2;break}return t.abrupt("return");case 2:for(this.pendings.length&&this.pendings.forEach((function(t){t()})),this.rendering=!0,this.engine.beginFrame(),e=this.container.getAll(ig.Systems),n=u.length,r=new Array(n),i=0;i<n;i++)r[i]=u[i];o=Qw(e),t.prev=8,o.s();case 10:if((a=o.n()).done){t.next=17;break}if(!(s=a.value).execute){t.next=15;break}return t.next=15,s.execute(r);case 15:t.next=10;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(8),o.e(t.t0);case 22:return t.prev=22,o.f(),t.finish(22);case 25:this.engine.endFrame(),this.rendering=!1;case 27:case"end":return t.stop()}}),t,this,[[8,19,22,25]])}))),function(){return e.apply(this,arguments)})},{key:"clear",value:function(t){var e=this;return this.inited?this.engine.clear(t):this.pendings.unshift((function(){e.engine.clear(t),e.pendings.shift()})),this}},{key:"setSize",value:function(t){var e=t.width,n=t.height,r=this.engine.getCanvas();return this.size={width:e,height:n},r.width=e,r.height=n,this}},{key:"getSize",value:function(){return this.size}}]),t}(),Vw=Yw,Ww=(0,Yd.Z)(Vw.prototype,"engine",[Zw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hw=(0,Yd.Z)(Vw.prototype,"shaderModule",[jw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xw=(0,Yd.Z)(Vw.prototype,"configService",[Uw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gw=Vw))||Gw),fE=(0,rg.b2)()((tE=function(){function t(){(0,Hd.Z)(this,t),this.entities=[]}return(0,Xd.Z)(t,[{key:"getEntities",value:function(){return this.entities}},{key:"addRenderable",value:function(t){return this.addEntity(t.getEntity()),this}},{key:"removeRenderable",value:function(t){return this.removeEntity(t.getEntity()),this}},{key:"addLight",value:function(){}},{key:"addEntity",value:function(t){return-1===this.entities.indexOf(t)&&this.entities.push(t),this}},{key:"removeEntity",value:function(t){var e=this.entities.indexOf(t);return this.entities.splice(e,1),this}}]),t}(),$w=tE))||$w,pE=(0,rg.b2)()((nE=function(){function t(){(0,Hd.Z)(this,t),this.cache={}}return(0,Xd.Z)(t,[{key:"get",value:function(t){return this.cache[t]}},{key:"set",value:function(t,e){this.cache[t]=e}}]),t}(),eE=nE))||eE;function dE(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function gE(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?dE(Object(n),!0).forEach((function(e){(0,wg.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dE(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var vE,mE,yE,_E,bE,xE,wE,EE,SE,CE,AE,TE,kE,ME=(rE=(0,rg.b2)(),iE=(0,rg.f3)(pE),oE=(0,rg.f3)(ig.RenderEngine),rE((cE=function(){function t(){(0,Hd.Z)(this,t),(0,Wd.Z)(this,"textureCache",uE,this),(0,Wd.Z)(this,"engine",lE,this),this.config=void 0,this.loaded=!1,this.texture=void 0}var e;return(0,Xd.Z)(t,[{key:"setConfig",value:function(t){this.config=t}},{key:"isLoaded",value:function(){return this.loaded}},{key:"load",value:(e=(0,Qd.Z)(Kd().mark((function t(){var e=this;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.config.url){t.next=4;break}return t.abrupt("return",new Promise((function(t,n){var r=e.textureCache.get(e.config.url);if(r)t(r);else{var i=new Image;i.crossOrigin="Anonymous",i.src=e.config.url,i.onload=function(){var n=e.engine.createTexture2D(gE(gE({},e.config),{},{data:i,width:i.width,height:i.height,flipY:!0}));e.textureCache.set(e.config.url,n),e.texture=n,e.loaded=!0,t(n)},i.onerror=function(){n()}}})));case 4:return this.loaded=!0,this.texture=this.engine.createTexture2D(this.config),t.abrupt("return",this.texture);case 7:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),t}(),sE=cE,uE=(0,Yd.Z)(sE.prototype,"textureCache",[iE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lE=(0,Yd.Z)(sE.prototype,"engine",[oE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aE=sE))||aE),PE=(vE=(0,rg.b2)(),mE=(0,rg.f3)(ig.Systems),yE=(0,rg.t6)(ig.RendererSystem),vE((wE=function(){function t(){(0,Hd.Z)(this,t),(0,Wd.Z)(this,"rendererSystem",xE,this),this.camera=void 0,this.scene=void 0,this.viewport={x:0,y:0,width:0,height:0},this.clearColor=[1,1,1,1]}return(0,Xd.Z)(t,[{key:"getCamera",value:function(){return this.camera}},{key:"getScene",value:function(){return this.scene}},{key:"getViewport",value:function(){return this.viewport}},{key:"getClearColor",value:function(){return this.clearColor}},{key:"setCamera",value:function(t){return this.camera=t,this}},{key:"setScene",value:function(t){return this.scene=t,this}},{key:"setViewport",value:function(t){return this.viewport=t,this}},{key:"setClearColor",value:function(t){return this.clearColor=t,this}},{key:"pick",value:function(t){return this.rendererSystem.pick(t,this)}}]),t}(),bE=wE,xE=(0,Yd.Z)(bE.prototype,"rendererSystem",[mE,yE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_E=bE))||_E);function IE(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function OE(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?IE(Object(n),!0).forEach((function(e){(0,wg.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):IE(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var RE=(EE=(0,rg.b2)(),SE=(0,rg.f3)(ig.ConfigService),EE((kE=function(){function t(){(0,Hd.Z)(this,t),(0,Wd.Z)(this,"configService",TE,this),this.container=void 0}var e;return(0,Xd.Z)(t,[{key:"getEngine",value:(e=(0,Qd.Z)(Kd().mark((function t(){var e,n,r,i;return Kd().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.container.get(ig.RenderEngine),n=this.configService.get(),r=n.canvas,i=n.engineOptions,t.next=4,e.init(OE({canvas:r||g_(),swapChainFormat:d_.EV.BGRA8Unorm,antialiasing:!1},i));case 4:return t.abrupt("return",e);case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getTransformComponent",value:function(t){return this.container.get(ig.TransformComponentManager).getComponentByEntity(t)}},{key:"getMeshComponent",value:function(t){return this.container.get(ig.MeshComponentManager).getComponentByEntity(t)}},{key:"setConfig",value:function(t){this.configService.set(t)}},{key:"setContainer",value:function(t){this.container=t}},{key:"getContainer",value:function(){return this.container}},{key:"createEntity",value:function(){return $d()}},{key:"createScene",value:function(){return this.container.get(fE)}},{key:"createCamera",value:function(){return this.container.get(f_)}},{key:"createView",value:function(){return this.container.get(PE)}},{key:"createRenderable",value:function(t,e){var n=t?this.container.getNamed(ig.Renderable,t):this.container.get(pb),r=$d();return n.setConfig(e||{}),n.setEntity(r),n}},{key:"createGeometry",value:function(t,e){var n=this.container.getNamed(ig.Geometry,t),r=$d();return n.setConfig(e||{}),n.setEntity(r),n.getComponent()}},{key:"createMaterial",value:function(t,e){var n=this.container.getNamed(ig.Material,t),r=$d();return n.setConfig(e||{}),n.setEntity(r,t),n.getComponent()}},{key:"createTexture2D",value:function(t){var e=this.container.get(ME);return e.setConfig(t),e}},{key:"createBufferGeometry",value:function(t){return this.container.getNamed(ig.Systems,ig.GeometrySystem).createBufferGeometry(t)}},{key:"createInstancedBufferGeometry",value:function(t){return this.container.getNamed(ig.Systems,ig.GeometrySystem).createInstancedBufferGeometry(t)}},{key:"createShaderMaterial",value:function(t){return this.container.getNamed(ig.Systems,ig.MaterialSystem).createShaderMaterial(t)}},{key:"createKernel",value:function(t){var e=this.container.get(hb);return"string"==typeof t?e.setBundle(JSON.parse(t)):e.setBundle(t),e.init(),e}},{key:"createRenderer",value:function(){var t=this.container.get(hE);return t.container=this.container,t.init(),t}},{key:"destroy",value:function(){this.container.getAll(ig.Systems).forEach((function(t){t.tearDown&&t.tearDown()})),this.container.get(ig.RenderEngine).destroy(),this.container.get(ig.InteractorService).destroy()}}],[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Dy(),r=navigator.gpu?Ox:Qb;n.isBound(ig.RenderEngine)||n.bind(ig.RenderEngine).to(r).inSingletonScope(),n.bind(hE).toSelf(),n.bind(hb).toSelf(),n.bind(pb).toSelf(),n.bind(PE).toSelf(),n.bind(f_).toSelf(),n.bind(fE).toSelf(),n.bind(t).toSelf(),n.bind(pE).toSelf(),n.bind(ME).toSelf(),n.bind(ig.Geometry).to(Dx).whenTargetNamed(p_.BOX),n.bind(ig.Geometry).to(Yx).whenTargetNamed(p_.SPHERE),n.bind(ig.Geometry).to(Fx).whenTargetNamed(p_.PLANE),n.bind(ig.Geometry).to(Bx).whenTargetNamed(p_.MERGED),n.bind(ig.Material).to(sw).whenTargetNamed(fb.BASIC),n.bind(ig.Renderable).to(Kw).whenTargetNamed(pb.POINT),n.bind(ig.Renderable).to(Bw).whenTargetNamed(pb.LINE),n.bind(ig.Renderable).to(bw).whenTargetNamed(pb.GRID);var i=n.get(t);return i.setContainer(n),i.setConfig(e),i}}]),t}(),AE=kE,TE=(0,Yd.Z)(AE.prototype,"configService",[SE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CE=AE))||CE);const LE=(t,e)=>{let n;return n=t?ph(t)?()=>t:t:()=>e||1,n},DE=t=>{const e=[],n=t.length,r=t[0].length;for(let i=0;i<r;i++)t.forEach(((t,r)=>{if(e.push(t[i]),r===n-1)for(;e.length%4!=0;)e.push(0)}));return new Float32Array(e)};var NE=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof n?t:new n((function(e){e(t)}))}(t.value).then(a,s)}u((r=r.apply(t,e||[])).next())}))};class BE extends ch{constructor(t){super(),this.maxIteration=1e3,this.gravity=10,this.speed=1,this.clustering=!1,this.clusterField="cluster",this.clusterGravity=10,this.workerEnabled=!1,this.nodes=[],this.edges=[],this.width=300,this.height=300,this.nodeMap={},this.nodeIdxMap={},this.updateCfg(t)}getDefaultCfg(){return{maxIteration:1e3,gravity:10,speed:1,clustering:!1,clusterGravity:10}}execute(){return NE(this,void 0,void 0,(function*(){const t=this,e=t.nodes;if(!e||0===e.length)return void(t.onLayoutEnd&&t.onLayoutEnd());t.width||"undefined"==typeof window||(t.width=window.innerWidth),t.height||"undefined"==typeof window||(t.height=window.innerHeight),t.center||(t.center=[t.width/2,t.height/2]);const n=t.center;if(1===e.length)return e[0].x=n[0],e[0].y=n[1],void(t.onLayoutEnd&&t.onLayoutEnd());const r={},i={};e.forEach(((t,e)=>{ph(t.x)||(t.x=Math.random()*this.width),ph(t.y)||(t.y=Math.random()*this.height),r[t.id]=t,i[t.id]=e})),t.nodeMap=r,t.nodeIdxMap=i,yield t.run()}))}executeWithWorker(t,e){return NE(this,void 0,void 0,(function*(){const n=this,r=n.nodes,i=n.center;if(!r||0===r.length)return;if(1===r.length)return r[0].x=i[0],void(r[0].y=i[1]);const o={},a={};r.forEach(((t,e)=>{ph(t.x)||(t.x=Math.random()*this.width),ph(t.y)||(t.y=Math.random()*this.height),o[t.id]=t,a[t.id]=e})),n.nodeMap=o,n.nodeIdxMap=a,yield n.run(t,e)}))}run(t,e){return NE(this,void 0,void 0,(function*(){const n=this,r=n.nodes,i=n.edges,o=n.maxIteration,a=n.center,s=n.height*n.width;let u=Math.sqrt(s)/10;const l=s/(r.length+1),c=Math.sqrt(l),h=n.speed,f=n.clustering,{array:p,count:d}=((t,e)=>{const n=[],r=t.length,i={};return e.forEach((e=>{t.forEach(((t,o)=>{if(void 0===i[e[t]]&&(i[e[t]]=Object.keys(i).length),n.push(i[e[t]]),o===r-1)for(;n.length%4!=0;)n.push(0)}))})),{array:new Float32Array(n),count:Object.keys(i).length}})([n.clusterField],r);r.forEach(((t,e)=>{let n=0,r=0;ph(t.fx)&&ph(t.fy)&&(n=t.fx||.001,r=t.fy||.001),p[4*e+1]=n,p[4*e+2]=r}));const g=r.length,{maxEdgePerVetex:v,array:m}=((t,e)=>{const n=[],r=[],i={};let o=0;for(o=0;o<t.length;o++){const e=t[o];i[e.id]=o,n.push(e.x),n.push(e.y),n.push(0),n.push(0),r.push([])}for(o=0;o<e.length;o++){const t=e[o],n=mh(t,"source"),a=mh(t,"target");r[i[n]].push(i[a]),r[i[a]].push(i[n])}let a=0;for(o=0;o<t.length;o++){const t=n.length,e=r[o],i=e.length;n[4*o+2]=t,n[4*o+3]=e.length,a=Math.max(a,e.length);for(let t=0;t<i;++t){const r=e[t];n.push(+r)}}for(;n.length%4!=0;)n.push(0);return{maxEdgePerVetex:a,array:new Float32Array(n)}})(r,i);let y;y=n.workerEnabled?RE.create({canvas:t,engineOptions:{supportCompute:!0}}):RE.create({engineOptions:{supportCompute:!0}});const _=n.onLayoutEnd,b=[];for(let t=0;t<d;t++)b.push(0,0,0,0);const x=y.createKernel('{"shaders":{"WGSL":"import \\"GLSL.std.450\\" as std;\\n\\n\\n# var gWebGPUDebug : bool = false;\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\n\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\n\\ntype GWebGPUParams = [[block]] struct {\\n  [[offset 0]] u_K : f32;\\n  [[offset 4]] u_K2 : f32;\\n  [[offset 8]] u_Center : vec2<f32>;\\n  [[offset 16]] u_Gravity : f32;\\n  [[offset 20]] u_ClusterGravity : f32;\\n  [[offset 24]] u_Speed : f32;\\n  [[offset 28]] u_MaxDisplace : f32;\\n  [[offset 32]] u_Clustering : f32;\\n};\\n[[binding 0, set 0]] var<uniform> gWebGPUUniformParams : GWebGPUParams;\\ntype GWebGPUBuffer0 = [[block]] struct {\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\ntype GWebGPUBuffer1 = [[block]] struct {\\n  [[offset 0]] u_AttributeArray : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 2, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\ntype GWebGPUBuffer2 = [[block]] struct {\\n  [[offset 0]] u_ClusterCenters : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 3, set 0]] var<storage_buffer> gWebGPUBuffer2 : GWebGPUBuffer2;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nfn calcRepulsive(i : i32, currentNode : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\nvar dy : f32 = 0.0;\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {if (i != j) {var nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\nvar xDist : f32 = currentNode.x - nextNode.x;\\nvar yDist : f32 = currentNode.y - nextNode.y;\\nvar dist : f32 = ((xDist * xDist) + (yDist * yDist)) + 0.01;\\nvar param : f32 = gWebGPUUniformParams.u_K2 / dist;\\nif (dist > 0.0) {dx = dx + param * xDist;\\ndy = dy + param * yDist;\\nif ((xDist == 0.0) && (yDist == 0.0)) {var sign : f32 = select(1.0, -1.0, i < j);\\ndx = dx + param * std::sign;\\ndy = dy + param * std::sign;}}}}\\nreturn vec2<f32>(dx, dy);}\\nfn calcGravity(currentNode : vec4<f32>, nodeAttributes : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\nvar dy : f32 = 0.0;\\nvar vx : f32 = currentNode.x - gWebGPUUniformParams.u_Center.x;\\nvar vy : f32 = currentNode.y - gWebGPUUniformParams.u_Center.y;\\nvar gf : f32 = (0.01 * gWebGPUUniformParams.u_K) * gWebGPUUniformParams.u_Gravity;\\ndx = gf * vx;\\ndy = gf * vy;\\nif (gWebGPUUniformParams.u_Clustering == 1.0) {var clusterIdx : i32 = i32(nodeAttributes.x);\\nvar center : vec4<f32> = gWebGPUBuffer2.u_ClusterCenters[clusterIdx];\\nvar cvx : f32 = currentNode.x - center.x;\\nvar cvy : f32 = currentNode.y - center.y;\\nvar dist : f32 = std::sqrt((cvx * cvx) + (cvy * cvy)) + 0.01;\\nvar parma : f32 = (gWebGPUUniformParams.u_K * gWebGPUUniformParams.u_ClusterGravity) / dist;\\ndx = dx + parma * cvx;\\ndy = dy + parma * cvy;}\\nreturn vec2<f32>(dx, dy);}\\nfn calcAttractive(i : i32, currentNode : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\nvar dy : f32 = 0.0;\\nvar arr_offset : i32 = i32(std::floor(currentNode.z + 0.5));\\nvar length : i32 = i32(std::floor(currentNode.w + 0.5));\\nvar node_buffer : vec4<f32>;\\nfor (var p : i32 = 0; p < __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX; p = p + 1) {if (p >= length) {break;}\\nvar arr_idx : i32 = arr_offset + i32(p);\\nvar buf_offset : i32 = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[i32(arr_idx / 4)];}\\nvar float_j : f32 = select(node_buffer.x, select(node_buffer.y, select(node_buffer.z, node_buffer.w, buf_offset == 2), buf_offset == 1), buf_offset == 0);\\nvar nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[i32(float_j)];\\nvar xDist : f32 = currentNode.x - nextNode.x;\\nvar yDist : f32 = currentNode.y - nextNode.y;\\nvar dist : f32 = std::sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\nvar attractiveF : f32 = dist / gWebGPUUniformParams.u_K;\\nif (dist > 0.0) {dx = dx - xDist * attractiveF;\\ndy = dy - yDist * attractiveF;\\nif ((xDist == 0.0) && (yDist == 0.0)) {var sign : f32 = select(1.0, -1.0, i < i32(float_j));\\ndx = dx - std::sign * attractiveF;\\ndy = dy - std::sign * attractiveF;}}}\\nreturn vec2<f32>(dx, dy);}\\nfn main() -> void {var i : i32 = globalInvocationID.x;\\nvar currentNode : vec4<f32> = gWebGPUBuffer0.u_Data[i];\\nvar dx : f32 = 0.0;\\nvar dy : f32 = 0.0;\\nif (i >= __DefineValuePlaceholder__VERTEX_COUNT) {gWebGPUBuffer0.u_Data[i] = currentNode;\\nreturn ;}\\nvar nodeAttributes : vec4<f32> = gWebGPUBuffer1.u_AttributeArray[i];\\nif ((nodeAttributes.y != 0.0) && (nodeAttributes.z != 0.0)) {gWebGPUBuffer0.u_Data[i] = vec4<f32>(nodeAttributes.y, nodeAttributes.z, currentNode.z, currentNode.w);\\nreturn ;}\\nvar repulsive : vec2<f32> = calcRepulsive(i, currentNode);\\ndx = dx + repulsive.x;\\ndy = dy + repulsive.y;\\nvar attractive : vec2<f32> = calcAttractive(i, currentNode);\\ndx = dx + attractive.x;\\ndy = dy + attractive.y;\\nvar gravity : vec2<f32> = calcGravity(currentNode, nodeAttributes);\\ndx = dx - gravity.x;\\ndy = dy - gravity.y;\\ndx = dx * gWebGPUUniformParams.u_Speed;\\ndy = dy * gWebGPUUniformParams.u_Speed;\\nvar distLength : f32 = std::sqrt((dx * dx) + (dy * dy));\\nif (distLength > 0.0) {var limitedDist : f32 = std::min(gWebGPUUniformParams.u_MaxDisplace * gWebGPUUniformParams.u_Speed, distLength);\\ngWebGPUBuffer0.u_Data[i] = vec4<f32>(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w);}\\nreturn;}\\n\\nentry_point compute as \\"main\\" = main;\\n","GLSL450":"\\n\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\nivec3 workGroupSize = ivec3(1,1,1);\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\n\\nlayout(std140, set = 0, binding = 0) uniform GWebGPUParams {\\n  float u_K;\\n  float u_K2;\\n  vec2 u_Center;\\n  float u_Gravity;\\n  float u_ClusterGravity;\\n  float u_Speed;\\n  float u_MaxDisplace;\\n  float u_Clustering;\\n} gWebGPUUniformParams;\\nlayout(std430, set = 0, binding = 1) buffer   GWebGPUBuffer0 {\\n  vec4 u_Data[];\\n} gWebGPUBuffer0;\\n\\nlayout(std430, set = 0, binding = 2) buffer readonly  GWebGPUBuffer1 {\\n  vec4 u_AttributeArray[];\\n} gWebGPUBuffer1;\\n\\nlayout(std430, set = 0, binding = 3) buffer readonly  GWebGPUBuffer2 {\\n  vec4 u_ClusterCenters[];\\n} gWebGPUBuffer2;\\n\\n\\n\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\nlayout (\\n  local_size_x = 1,\\n  local_size_y = 1,\\n  local_size_z = 1\\n) in;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nvec2 calcRepulsive(int i, vec4 currentNode) {float dx = 0.0;\\nfloat dy = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = gWebGPUBuffer0.u_Data[j];\\nfloat xDist = currentNode.x - nextNode.x;\\nfloat yDist = currentNode.y - nextNode.y;\\nfloat dist = ((xDist * xDist) + (yDist * yDist)) + 0.01;\\nfloat param = gWebGPUUniformParams.u_K2 / dist;\\nif (dist > 0.0) {dx += param * xDist;\\ndy += param * yDist;\\nif ((xDist == 0.0) && (yDist == 0.0)) {float sign = (i < j) ? (1.0) : (-1.0);\\ndx += param * sign;\\ndy += param * sign;}}}}\\nreturn vec2(dx, dy);}\\nvec2 calcGravity(vec4 currentNode, vec4 nodeAttributes) {float dx = 0.0;\\nfloat dy = 0.0;\\nfloat vx = currentNode.x - gWebGPUUniformParams.u_Center.x;\\nfloat vy = currentNode.y - gWebGPUUniformParams.u_Center.y;\\nfloat gf = (0.01 * gWebGPUUniformParams.u_K) * gWebGPUUniformParams.u_Gravity;\\ndx = gf * vx;\\ndy = gf * vy;\\nif (gWebGPUUniformParams.u_Clustering == 1.0) {int clusterIdx = int(nodeAttributes.x);\\nvec4 center = gWebGPUBuffer2.u_ClusterCenters[clusterIdx];\\nfloat cvx = currentNode.x - center.x;\\nfloat cvy = currentNode.y - center.y;\\nfloat dist = sqrt((cvx * cvx) + (cvy * cvy)) + 0.01;\\nfloat parma = (gWebGPUUniformParams.u_K * gWebGPUUniformParams.u_ClusterGravity) / dist;\\ndx += parma * cvx;\\ndy += parma * cvy;}\\nreturn vec2(dx, dy);}\\nvec2 calcAttractive(int i, vec4 currentNode) {float dx = 0.0;\\nfloat dy = 0.0;\\nint arr_offset = int(floor(currentNode.z + 0.5));\\nint length = int(floor(currentNode.w + 0.5));\\nvec4 node_buffer;\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\nint arr_idx = arr_offset + int(p);\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[int(arr_idx / 4)];}\\nfloat float_j = (buf_offset == 0) ? (node_buffer.x) : ((buf_offset == 1) ? (node_buffer.y) : ((buf_offset == 2) ? (node_buffer.z) : (node_buffer.w)));\\nvec4 nextNode = gWebGPUBuffer0.u_Data[int(float_j)];\\nfloat xDist = currentNode.x - nextNode.x;\\nfloat yDist = currentNode.y - nextNode.y;\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\nfloat attractiveF = dist / gWebGPUUniformParams.u_K;\\nif (dist > 0.0) {dx -= xDist * attractiveF;\\ndy -= yDist * attractiveF;\\nif ((xDist == 0.0) && (yDist == 0.0)) {float sign = (i < int(float_j)) ? (1.0) : (-1.0);\\ndx -= sign * attractiveF;\\ndy -= sign * attractiveF;}}}\\nreturn vec2(dx, dy);}\\nvoid main() {int i = globalInvocationID.x;\\nvec4 currentNode = gWebGPUBuffer0.u_Data[i];\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nif (i >= VERTEX_COUNT) {gWebGPUBuffer0.u_Data[i] = currentNode;\\nreturn ;}\\nvec4 nodeAttributes = gWebGPUBuffer1.u_AttributeArray[i];\\nif ((nodeAttributes.y != 0.0) && (nodeAttributes.z != 0.0)) {gWebGPUBuffer0.u_Data[i] = vec4(nodeAttributes.y, nodeAttributes.z, currentNode.z, currentNode.w);\\nreturn ;}\\nvec2 repulsive = calcRepulsive(i, currentNode);\\ndx += repulsive.x;\\ndy += repulsive.y;\\nvec2 attractive = calcAttractive(i, currentNode);\\ndx += attractive.x;\\ndy += attractive.y;\\nvec2 gravity = calcGravity(currentNode, nodeAttributes);\\ndx -= gravity.x;\\ndy -= gravity.y;\\ndx *= gWebGPUUniformParams.u_Speed;\\ndy *= gWebGPUUniformParams.u_Speed;\\nfloat distLength = sqrt((dx * dx) + (dy * dy));\\nif (distLength > 0.0) {float limitedDist = min(gWebGPUUniformParams.u_MaxDisplace * gWebGPUUniformParams.u_Speed, distLength);\\ngWebGPUBuffer0.u_Data[i] = vec4(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w);}}\\n","GLSL100":"\\n\\nfloat epsilon = 0.00001;\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\n  vec2 normAddr2D = float(address1D) * conv_const;\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\n}\\n\\nvoid barrier() {}\\n  \\n\\nuniform vec2 u_OutputTextureSize;\\nuniform int u_OutputTexelCount;\\nvarying vec2 v_TexCoord;\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n\\nuniform sampler2D u_Data;\\nuniform vec2 u_DataSize;\\nvec4 getDatau_Data(vec2 address2D) {\\n  return vec4(texture2D(u_Data, address2D).rgba);\\n}\\nvec4 getDatau_Data(float address1D) {\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\n}\\nvec4 getDatau_Data(int address1D) {\\n  return getDatau_Data(float(address1D));\\n}\\nuniform float u_K;\\nuniform float u_K2;\\nuniform vec2 u_Center;\\nuniform float u_Gravity;\\nuniform float u_ClusterGravity;\\nuniform float u_Speed;\\nuniform float u_MaxDisplace;\\nuniform float u_Clustering;\\nuniform sampler2D u_AttributeArray;\\nuniform vec2 u_AttributeArraySize;\\nvec4 getDatau_AttributeArray(vec2 address2D) {\\n  return vec4(texture2D(u_AttributeArray, address2D).rgba);\\n}\\nvec4 getDatau_AttributeArray(float address1D) {\\n  return getDatau_AttributeArray(addrTranslation_1Dto2D(address1D, u_AttributeArraySize));\\n}\\nvec4 getDatau_AttributeArray(int address1D) {\\n  return getDatau_AttributeArray(float(address1D));\\n}\\nuniform sampler2D u_ClusterCenters;\\nuniform vec2 u_ClusterCentersSize;\\nvec4 getDatau_ClusterCenters(vec2 address2D) {\\n  return vec4(texture2D(u_ClusterCenters, address2D).rgba);\\n}\\nvec4 getDatau_ClusterCenters(float address1D) {\\n  return getDatau_ClusterCenters(addrTranslation_1Dto2D(address1D, u_ClusterCentersSize));\\n}\\nvec4 getDatau_ClusterCenters(int address1D) {\\n  return getDatau_ClusterCenters(float(address1D));\\n}\\nvec2 calcRepulsive(int i, vec4 currentNode) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = getDatau_Data(j);\\nfloat xDist = currentNode.x - nextNode.x;\\nfloat yDist = currentNode.y - nextNode.y;\\nfloat dist = ((xDist * xDist) + (yDist * yDist)) + 0.01;\\nfloat param = u_K2 / dist;\\nif (dist > 0.0) {dx += param * xDist;\\ndy += param * yDist;\\nif ((xDist == 0.0) && (yDist == 0.0)) {float sign = (i < j) ? (1.0) : (-1.0);\\ndx += param * sign;\\ndy += param * sign;}}}}\\nreturn vec2(dx, dy);}\\nvec2 calcGravity(vec4 currentNode, vec4 nodeAttributes) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nfloat vx = currentNode.x - u_Center.x;\\nfloat vy = currentNode.y - u_Center.y;\\nfloat gf = (0.01 * u_K) * u_Gravity;\\ndx = gf * vx;\\ndy = gf * vy;\\nif (u_Clustering == 1.0) {int clusterIdx = int(nodeAttributes.x);\\nvec4 center = getDatau_ClusterCenters(clusterIdx);\\nfloat cvx = currentNode.x - center.x;\\nfloat cvy = currentNode.y - center.y;\\nfloat dist = sqrt((cvx * cvx) + (cvy * cvy)) + 0.01;\\nfloat parma = (u_K * u_ClusterGravity) / dist;\\ndx += parma * cvx;\\ndy += parma * cvy;}\\nreturn vec2(dx, dy);}\\nvec2 calcAttractive(int i, vec4 currentNode) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nint arr_offset = int(floor(currentNode.z + 0.5));\\nint length = int(floor(currentNode.w + 0.5));\\nvec4 node_buffer;\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\nint arr_idx = arr_offset + int(p);\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = getDatau_Data(int(arr_idx / 4));}\\nfloat float_j = (buf_offset == 0) ? (node_buffer.x) : ((buf_offset == 1) ? (node_buffer.y) : ((buf_offset == 2) ? (node_buffer.z) : (node_buffer.w)));\\nvec4 nextNode = getDatau_Data(int(float_j));\\nfloat xDist = currentNode.x - nextNode.x;\\nfloat yDist = currentNode.y - nextNode.y;\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\nfloat attractiveF = dist / u_K;\\nif (dist > 0.0) {dx -= xDist * attractiveF;\\ndy -= yDist * attractiveF;\\nif ((xDist == 0.0) && (yDist == 0.0)) {float sign = (i < int(float_j)) ? (1.0) : (-1.0);\\ndx -= sign * attractiveF;\\ndy -= sign * attractiveF;}}}\\nreturn vec2(dx, dy);}\\nvoid main() {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nint i = globalInvocationID.x;\\nvec4 currentNode = getDatau_Data(i);\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nif (i >= VERTEX_COUNT) {gl_FragColor = vec4(currentNode);\\nreturn ;}\\nvec4 nodeAttributes = getDatau_AttributeArray(i);\\nif ((nodeAttributes.y != 0.0) && (nodeAttributes.z != 0.0)) {gl_FragColor = vec4(vec4(nodeAttributes.y, nodeAttributes.z, currentNode.z, currentNode.w));\\nreturn ;}\\nvec2 repulsive = calcRepulsive(i, currentNode);\\ndx += repulsive.x;\\ndy += repulsive.y;\\nvec2 attractive = calcAttractive(i, currentNode);\\ndx += attractive.x;\\ndy += attractive.y;\\nvec2 gravity = calcGravity(currentNode, nodeAttributes);\\ndx -= gravity.x;\\ndy -= gravity.y;\\ndx *= u_Speed;\\ndy *= u_Speed;\\nfloat distLength = sqrt((dx * dx) + (dy * dy));\\nif (distLength > 0.0) {float limitedDist = min(u_MaxDisplace * u_Speed, distLength);\\ngl_FragColor = vec4(vec4(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w));}if (gWebGPUDebug) {\\n  gl_FragColor = gWebGPUDebugOutput;\\n}}\\n"},"context":{"name":"","dispatch":[1,1,1],"threadGroupSize":[1,1,1],"maxIteration":1,"defines":[{"name":"MAX_EDGE_PER_VERTEX","type":"Float","runtime":true},{"name":"VERTEX_COUNT","type":"Float","runtime":true}],"uniforms":[{"name":"u_Data","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":false,"writeonly":false,"size":[1,1]},{"name":"u_K","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_K2","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_Center","type":"vec2<f32>","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_Gravity","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_ClusterGravity","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_Speed","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_MaxDisplace","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_Clustering","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_AttributeArray","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_ClusterCenters","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]}],"globalDeclarations":[],"output":{"name":"u_Data","size":[1,1],"length":1},"needPingpong":true}}').setDispatch([g,1,1]).setBinding({u_Data:m,u_K:c,u_K2:l,u_Gravity:n.gravity,u_ClusterGravity:n.clusterGravity||n.gravity||1,u_Speed:h,u_MaxDisplace:u,u_Clustering:f?1:0,u_Center:a,u_AttributeArray:p,u_ClusterCenters:b,MAX_EDGE_PER_VERTEX:v,VERTEX_COUNT:g});let w;f&&(w=y.createKernel('{"shaders":{"WGSL":"import \\"GLSL.std.450\\" as std;\\n\\n\\n# var gWebGPUDebug : bool = false;\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\n\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\n\\n\\ntype GWebGPUBuffer0 = [[block]] struct {\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 0, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\ntype GWebGPUBuffer1 = [[block]] struct {\\n  [[offset 0]] u_NodeAttributes : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\ntype GWebGPUBuffer2 = [[block]] struct {\\n  [[offset 0]] u_ClusterCenters : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 2, set 0]] var<storage_buffer> gWebGPUBuffer2 : GWebGPUBuffer2;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nfn main() -> void {var i : i32 = globalInvocationID.x;\\nvar center : vec4<f32> = gWebGPUBuffer2.u_ClusterCenters[i];\\nvar sumx : f32 = 0.0;\\nvar sumy : f32 = 0.0;\\nvar count : f32 = 0.0;\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {var attributes : vec4<f32> = gWebGPUBuffer1.u_NodeAttributes[j];\\nvar clusterIdx : i32 = i32(attributes.x);\\nvar vertex : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\nif (clusterIdx == i) {sumx = sumx + vertex.x;\\nsumy = sumy + vertex.y;\\ncount = count + 1.0;}}\\ngWebGPUBuffer2.u_ClusterCenters[i] = vec4<f32>(sumx / count, sumy / count, count, i);\\nreturn;}\\n\\nentry_point compute as \\"main\\" = main;\\n","GLSL450":"\\n\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\nivec3 workGroupSize = ivec3(1,1,1);\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\n\\n\\nlayout(std430, set = 0, binding = 0) buffer readonly  GWebGPUBuffer0 {\\n  vec4 u_Data[];\\n} gWebGPUBuffer0;\\n\\nlayout(std430, set = 0, binding = 1) buffer readonly  GWebGPUBuffer1 {\\n  vec4 u_NodeAttributes[];\\n} gWebGPUBuffer1;\\n\\nlayout(std430, set = 0, binding = 2) buffer   GWebGPUBuffer2 {\\n  vec4 u_ClusterCenters[];\\n} gWebGPUBuffer2;\\n\\n\\n\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n#define CLUSTER_COUNT __DefineValuePlaceholder__CLUSTER_COUNT\\nlayout (\\n  local_size_x = 1,\\n  local_size_y = 1,\\n  local_size_z = 1\\n) in;\\n\\n\\n\\nvoid main() {int i = globalInvocationID.x;\\nvec4 center = gWebGPUBuffer2.u_ClusterCenters[i];\\nfloat sumx = 0.0;\\nfloat sumy = 0.0;\\nfloat count = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {vec4 attributes = gWebGPUBuffer1.u_NodeAttributes[j];\\nint clusterIdx = int(attributes.x);\\nvec4 vertex = gWebGPUBuffer0.u_Data[j];\\nif (clusterIdx == i) {sumx += vertex.x;\\nsumy += vertex.y;\\ncount += 1.0;}}\\ngWebGPUBuffer2.u_ClusterCenters[i] = vec4(sumx / count, sumy / count, count, i);}\\n","GLSL100":"\\n\\nfloat epsilon = 0.00001;\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\n  vec2 normAddr2D = float(address1D) * conv_const;\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\n}\\n\\nvoid barrier() {}\\n  \\n\\nuniform vec2 u_OutputTextureSize;\\nuniform int u_OutputTexelCount;\\nvarying vec2 v_TexCoord;\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n#define CLUSTER_COUNT __DefineValuePlaceholder__CLUSTER_COUNT\\n\\nuniform sampler2D u_Data;\\nuniform vec2 u_DataSize;\\nvec4 getDatau_Data(vec2 address2D) {\\n  return vec4(texture2D(u_Data, address2D).rgba);\\n}\\nvec4 getDatau_Data(float address1D) {\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\n}\\nvec4 getDatau_Data(int address1D) {\\n  return getDatau_Data(float(address1D));\\n}\\nuniform sampler2D u_NodeAttributes;\\nuniform vec2 u_NodeAttributesSize;\\nvec4 getDatau_NodeAttributes(vec2 address2D) {\\n  return vec4(texture2D(u_NodeAttributes, address2D).rgba);\\n}\\nvec4 getDatau_NodeAttributes(float address1D) {\\n  return getDatau_NodeAttributes(addrTranslation_1Dto2D(address1D, u_NodeAttributesSize));\\n}\\nvec4 getDatau_NodeAttributes(int address1D) {\\n  return getDatau_NodeAttributes(float(address1D));\\n}\\nuniform sampler2D u_ClusterCenters;\\nuniform vec2 u_ClusterCentersSize;\\nvec4 getDatau_ClusterCenters(vec2 address2D) {\\n  return vec4(texture2D(u_ClusterCenters, address2D).rgba);\\n}\\nvec4 getDatau_ClusterCenters(float address1D) {\\n  return getDatau_ClusterCenters(addrTranslation_1Dto2D(address1D, u_ClusterCentersSize));\\n}\\nvec4 getDatau_ClusterCenters(int address1D) {\\n  return getDatau_ClusterCenters(float(address1D));\\n}\\nvoid main() {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nint i = globalInvocationID.x;\\nvec4 center = getDatau_ClusterCenters(i);\\nfloat sumx = 0.0;\\nfloat sumy = 0.0;\\nfloat count = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {vec4 attributes = getDatau_NodeAttributes(j);\\nint clusterIdx = int(attributes.x);\\nvec4 vertex = getDatau_Data(j);\\nif (clusterIdx == i) {sumx += vertex.x;\\nsumy += vertex.y;\\ncount += 1.0;}}\\ngl_FragColor = vec4(vec4(sumx / count, sumy / count, count, i));if (gWebGPUDebug) {\\n  gl_FragColor = gWebGPUDebugOutput;\\n}}\\n"},"context":{"name":"","dispatch":[1,1,1],"threadGroupSize":[1,1,1],"maxIteration":1,"defines":[{"name":"VERTEX_COUNT","type":"Float","runtime":true},{"name":"CLUSTER_COUNT","type":"Float","runtime":true}],"uniforms":[{"name":"u_Data","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_NodeAttributes","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_ClusterCenters","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":false,"writeonly":false,"size":[1,1]}],"globalDeclarations":[],"output":{"name":"u_ClusterCenters","size":[1,1],"length":1},"needPingpong":true}}').setDispatch([d,1,1]).setBinding({u_Data:m,u_NodeAttributes:p,u_ClusterCenters:b,VERTEX_COUNT:g,CLUSTER_COUNT:d})),yield(()=>NE(this,void 0,void 0,(function*(){for(let t=0;t<o;t++)yield x.execute(),f&&(w.setBinding({u_Data:x}),yield w.execute(),x.setBinding({u_ClusterCenters:w})),x.setBinding({u_MaxDisplace:u*=.99});const n=yield x.getOutput();t?e.postMessage({type:lf,vertexEdgeData:n}):r.forEach(((t,e)=>{const r=n[4*e],i=n[4*e+1];t.x=r,t.y=i})),_&&_()})))()}))}getType(){return"fruchterman-gpu"}}var zE=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof n?t:new n((function(e){e(t)}))}(t.value).then(a,s)}u((r=r.apply(t,e||[])).next())}))};class FE extends ch{constructor(t){super(),this.maxIteration=1e3,this.edgeStrength=200,this.nodeStrength=1e3,this.coulombDisScale=.005,this.damping=.9,this.maxSpeed=1e3,this.minMovement=.5,this.interval=.02,this.factor=1,this.linkDistance=1,this.gravity=10,this.workerEnabled=!1,this.nodes=[],this.edges=[],this.width=300,this.height=300,this.nodeMap={},this.nodeIdxMap={},this.updateCfg(t)}getDefaultCfg(){return{maxIteration:2e3,gravity:10,clustering:!1,clusterGravity:10}}execute(){return zE(this,void 0,void 0,(function*(){const t=this,e=t.nodes;if(!e||0===e.length)return void(t.onLayoutEnd&&t.onLayoutEnd());t.width||"undefined"==typeof window||(t.width=window.innerWidth),t.height||"undefined"==typeof window||(t.height=window.innerHeight),t.center||(t.center=[t.width/2,t.height/2]);const n=t.center;if(1===e.length)return e[0].x=n[0],e[0].y=n[1],void(t.onLayoutEnd&&t.onLayoutEnd());const r={},i={};e.forEach(((e,n)=>{ph(e.x)||(e.x=Math.random()*t.width),ph(e.y)||(e.y=Math.random()*t.height),r[e.id]=e,i[e.id]=n})),t.nodeMap=r,t.nodeIdxMap=i,t.nodeStrength=LE(t.nodeStrength,1),t.edgeStrength=LE(t.edgeStrength,1),yield t.run()}))}executeWithWorker(t,e){const n=this,r=n.nodes,i=n.center;if(!r||0===r.length)return;if(1===r.length)return r[0].x=i[0],void(r[0].y=i[1]);const o={},a={};r.forEach(((t,e)=>{ph(t.x)||(t.x=Math.random()*n.width),ph(t.y)||(t.y=Math.random()*n.height),o[t.id]=t,a[t.id]=e})),n.nodeMap=o,n.nodeIdxMap=a,n.nodeStrength=LE(n.nodeStrength,1),n.edgeStrength=LE(n.edgeStrength,1),n.run(t,e)}run(t,e){return zE(this,void 0,void 0,(function*(){const n=this,r=n.nodes,i=n.edges,o=n.maxIteration;n.width||"undefined"==typeof window||(n.width=window.innerWidth),n.height||"undefined"==typeof window||(n.height=window.innerHeight);const a=r.length;n.linkDistance=LE(n.linkDistance),n.edgeStrength=LE(n.edgeStrength);const{maxEdgePerVetex:s,array:u}=((t,e,n,r)=>{const i=[],o=[],a={};let s=0;for(s=0;s<t.length;s++){const e=t[s];a[e.id]=s,i.push(e.x),i.push(e.y),i.push(0),i.push(0),o.push([])}for(s=0;s<e.length;s++){const t=e[s],i=mh(t,"source"),u=mh(t,"target");o[a[i]].push(a[u]),o[a[i]].push(n(t)),o[a[i]].push(r(t)),o[a[i]].push(0),o[a[u]].push(a[i]),o[a[u]].push(n(t)),o[a[u]].push(r(t)),o[a[u]].push(0)}let u=0;for(s=0;s<t.length;s++){const t=i.length,e=o[s],n=e.length;i[4*s+2]=t+1048576*n/4,i[4*s+3]=0,u=Math.max(u,n/4);for(let t=0;t<n;++t){const n=e[t];i.push(+n)}}for(;i.length%4!=0;)i.push(0);return{maxEdgePerVetex:u,array:new Float32Array(i)}})(r,i,n.linkDistance,n.edgeStrength);n.degrees=yh(r.length,n.nodeIdxMap,i);const l=[],c=[],h=[],f=[],p=[],d=[],g=[];n.getMass||(n.getMass=t=>n.degrees[n.nodeIdxMap[t.id]]||1);const v=n.gravity,m=n.center;r.forEach(((t,e)=>{l.push(n.getMass(t)),c.push(n.nodeStrength(t)),n.degrees[e]||(n.degrees[e]=0);let r=[m[0],m[1],v];if(n.getCenter){const i=n.getCenter(t,n.degrees[e]);i&&ph(i[0])&&ph(i[1])&&ph(i[2])&&(r=i)}h.push(r[0]),f.push(r[1]),p.push(r[2]),ph(t.fx)&&ph(t.fy)?(d.push(t.fx||.001),g.push(t.fy||.001)):(d.push(0),g.push(0))}));const y=DE([l,n.degrees,c,d]),_=DE([h,f,p,g]);let b;b=n.workerEnabled?RE.create({canvas:t,engineOptions:{supportCompute:!0}}):RE.create({engineOptions:{supportCompute:!0}});const x=n.onLayoutEnd,w=[];u.forEach((t=>{w.push(t)}));for(let t=0;t<4;t++)w.push(0);const E=b.createKernel('{"shaders":{"WGSL":"import \\"GLSL.std.450\\" as std;\\n\\n\\n# var gWebGPUDebug : bool = false;\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\n\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\n\\ntype GWebGPUParams = [[block]] struct {\\n  [[offset 0]] u_damping : f32;\\n  [[offset 4]] u_maxSpeed : f32;\\n  [[offset 8]] u_minMovement : f32;\\n  \\n  [[offset 12]] u_coulombDisScale : f32;\\n  [[offset 16]] u_factor : f32;\\n  \\n  \\n  [[offset 20]] u_interval : f32;\\n};\\n[[binding 0, set 0]] var<uniform> gWebGPUUniformParams : GWebGPUParams;\\ntype GWebGPUBuffer0 = [[block]] struct {\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\ntype GWebGPUBuffer1 = [[block]] struct {\\n  [[offset 0]] u_AveMovement : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 2, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\ntype GWebGPUBuffer2 = [[block]] struct {\\n  [[offset 0]] u_NodeAttributeArray1 : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 3, set 0]] var<storage_buffer> gWebGPUBuffer2 : GWebGPUBuffer2;\\ntype GWebGPUBuffer3 = [[block]] struct {\\n  [[offset 0]] u_NodeAttributeArray2 : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 4, set 0]] var<storage_buffer> gWebGPUBuffer3 : GWebGPUBuffer3;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nfn unpack_float(packedValue : f32) -> vec2<i32> {var packedIntValue : i32 = i32(packedValue);\\nvar v0 : i32 = packedIntValue / 1048576;\\nreturn vec2<i32>(v0, packedIntValue - (v0 * 1048576));}\\nfn calcRepulsive(i : i32, currentNode : vec4<f32>) -> vec2<f32> {var ax : f32 = 0.0;\\nvar ay : f32 = 0.0;\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {if (i != j) {var nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\nvar vx : f32 = currentNode.x - nextNode.x;\\nvar vy : f32 = currentNode.y - nextNode.y;\\nvar dist : f32 = std::sqrt((vx * vx) + (vy * vy)) + 0.01;\\nvar n_dist : f32 = (dist + 0.1) * gWebGPUUniformParams.u_coulombDisScale;\\nvar direx : f32 = vx / dist;\\nvar direy : f32 = vy / dist;\\nvar attributesi : vec4<f32> = gWebGPUBuffer2.u_NodeAttributeArray1[i];\\nvar attributesj : vec4<f32> = gWebGPUBuffer2.u_NodeAttributeArray1[j];\\nvar massi : f32 = attributesi.x;\\nvar nodeStrengthi : f32 = attributesi.z;\\nvar nodeStrengthj : f32 = attributesj.z;\\nvar nodeStrength : f32 = (nodeStrengthi + nodeStrengthj) / 2.0;\\nvar param : f32 = (nodeStrength * gWebGPUUniformParams.u_factor) / (n_dist * n_dist);\\nax = ax + direx * param;\\nay = ay + direy * param;}}\\nreturn vec2<f32>(ax, ay);}\\nfn calcGravity(i : i32, currentNode : vec4<f32>, attributes2 : vec4<f32>) -> vec2<f32> {var vx : f32 = currentNode.x - attributes2.x;\\nvar vy : f32 = currentNode.y - attributes2.y;\\nvar ax : f32 = vx * attributes2.z;\\nvar ay : f32 = vy * attributes2.z;\\nreturn vec2<f32>(ax, ay);}\\nfn calcAttractive(i : i32, currentNode : vec4<f32>, attributes1 : vec4<f32>) -> vec2<f32> {var mass : f32 = attributes1.x;\\nvar ax : f32 = 0.0;\\nvar ay : f32 = 0.0;\\nvar compressed : vec2<i32> = unpack_float(currentNode.z);\\nvar length : i32 = compressed.x;\\nvar arr_offset : i32 = compressed.y;\\nvar node_buffer : vec4<f32>;\\nfor (var p : i32 = 0; p < __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX; p = p + 1) {if (p >= length) {break;}\\nvar arr_idx : i32 = arr_offset + (4 * p);\\nvar buf_offset : i32 = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[i32(arr_idx / 4)];}\\nvar float_j : f32 = node_buffer.x;\\nvar nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[i32(float_j)];\\nvar vx : f32 = nextNode.x - currentNode.x;\\nvar vy : f32 = nextNode.y - currentNode.y;\\nvar dist : f32 = std::sqrt((vx * vx) + (vy * vy)) + 0.01;\\nvar direx : f32 = vx / dist;\\nvar direy : f32 = vy / dist;\\nvar edgeLength : f32 = node_buffer.y;\\nvar edgeStrength : f32 = node_buffer.z;\\nvar diff : f32 = edgeLength - dist;\\nvar param : f32 = (diff * edgeStrength) / mass;\\nax = ax - direx * param;\\nay = ay - direy * param;}\\nreturn vec2<f32>(ax, ay);}\\nfn main() -> void {var i : i32 = globalInvocationID.x;\\nvar currentNode : vec4<f32> = gWebGPUBuffer0.u_Data[i];\\nvar movement : vec4<f32> = gWebGPUBuffer1.u_AveMovement[0];\\nvar ax : f32 = 0.0;\\nvar ay : f32 = 0.0;\\nif ((i >= __DefineValuePlaceholder__VERTEX_COUNT) || (movement.x < gWebGPUUniformParams.u_minMovement)) {gWebGPUBuffer0.u_Data[i] = currentNode;\\nreturn ;}\\nvar nodeAttributes1 : vec4<f32> = gWebGPUBuffer2.u_NodeAttributeArray1[i];\\nvar nodeAttributes2 : vec4<f32> = gWebGPUBuffer3.u_NodeAttributeArray2[i];\\nvar repulsive : vec2<f32> = calcRepulsive(i, currentNode);\\nax = ax + repulsive.x;\\nay = ay + repulsive.y;\\nvar attractive : vec2<f32> = calcAttractive(i, currentNode, nodeAttributes1);\\nax = ax + attractive.x;\\nay = ay + attractive.y;\\nvar gravity : vec2<f32> = calcGravity(i, currentNode, nodeAttributes2);\\nax = ax - gravity.x;\\nay = ay - gravity.y;\\nvar param : f32 = gWebGPUUniformParams.u_interval * gWebGPUUniformParams.u_damping;\\nvar vx : f32 = ax * param;\\nvar vy : f32 = ay * param;\\nvar vlength : f32 = std::sqrt((vx * vx) + (vy * vy)) + 0.0001;\\nif (vlength > gWebGPUUniformParams.u_maxSpeed) {var param2 : f32 = gWebGPUUniformParams.u_maxSpeed / vlength;\\nvx = param2 * vx;\\nvy = param2 * vy;}\\nvar distx : f32 = vx * gWebGPUUniformParams.u_interval;\\nvar disty : f32 = vy * gWebGPUUniformParams.u_interval;\\nvar distLength : f32 = std::sqrt((distx * distx) + (disty * disty));\\nif ((nodeAttributes1.w != 0.0) && (nodeAttributes2.w != 0.0)) {gWebGPUBuffer0.u_Data[i] = vec4<f32>(nodeAttributes1.w, nodeAttributes2.w, currentNode.z, 0.0);}else {gWebGPUBuffer0.u_Data[i] = vec4<f32>(currentNode.x + distx, currentNode.y + disty, currentNode.z, distLength);}\\nreturn;}\\n\\nentry_point compute as \\"main\\" = main;\\n","GLSL450":"\\n\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\nivec3 workGroupSize = ivec3(1,1,1);\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\n\\nlayout(std140, set = 0, binding = 0) uniform GWebGPUParams {\\n  float u_damping;\\n  float u_maxSpeed;\\n  float u_minMovement;\\n  \\n  float u_coulombDisScale;\\n  float u_factor;\\n  \\n  \\n  float u_interval;\\n} gWebGPUUniformParams;\\nlayout(std430, set = 0, binding = 1) buffer   GWebGPUBuffer0 {\\n  vec4 u_Data[];\\n} gWebGPUBuffer0;\\n\\nlayout(std430, set = 0, binding = 2) buffer readonly  GWebGPUBuffer1 {\\n  vec4 u_AveMovement[];\\n} gWebGPUBuffer1;\\n\\nlayout(std430, set = 0, binding = 3) buffer readonly  GWebGPUBuffer2 {\\n  vec4 u_NodeAttributeArray1[];\\n} gWebGPUBuffer2;\\n\\nlayout(std430, set = 0, binding = 4) buffer readonly  GWebGPUBuffer3 {\\n  vec4 u_NodeAttributeArray2[];\\n} gWebGPUBuffer3;\\n\\n\\n\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n#define SHIFT_20 1048576.0\\nlayout (\\n  local_size_x = 1,\\n  local_size_y = 1,\\n  local_size_z = 1\\n) in;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nivec2 unpack_float(float packedValue) {int packedIntValue = int(packedValue);\\nint v0 = packedIntValue / int(SHIFT_20);\\nreturn ivec2(v0, packedIntValue - (v0 * int(SHIFT_20)));}\\nvec2 calcRepulsive(int i, vec4 currentNode) {float ax = 0.0;\\nfloat ay = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = gWebGPUBuffer0.u_Data[j];\\nfloat vx = currentNode.x - nextNode.x;\\nfloat vy = currentNode.y - nextNode.y;\\nfloat dist = sqrt((vx * vx) + (vy * vy)) + 0.01;\\nfloat n_dist = (dist + 0.1) * gWebGPUUniformParams.u_coulombDisScale;\\nfloat direx = vx / dist;\\nfloat direy = vy / dist;\\nvec4 attributesi = gWebGPUBuffer2.u_NodeAttributeArray1[i];\\nvec4 attributesj = gWebGPUBuffer2.u_NodeAttributeArray1[j];\\nfloat massi = attributesi.x;\\nfloat nodeStrengthi = attributesi.z;\\nfloat nodeStrengthj = attributesj.z;\\nfloat nodeStrength = (nodeStrengthi + nodeStrengthj) / 2.0;\\nfloat param = (nodeStrength * gWebGPUUniformParams.u_factor) / (n_dist * n_dist);\\nax += direx * param;\\nay += direy * param;}}\\nreturn vec2(ax, ay);}\\nvec2 calcGravity(int i, vec4 currentNode, vec4 attributes2) {float vx = currentNode.x - attributes2.x;\\nfloat vy = currentNode.y - attributes2.y;\\nfloat ax = vx * attributes2.z;\\nfloat ay = vy * attributes2.z;\\nreturn vec2(ax, ay);}\\nvec2 calcAttractive(int i, vec4 currentNode, vec4 attributes1) {float mass = attributes1.x;\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nivec2 compressed = unpack_float(currentNode.z);\\nint length = compressed.x;\\nint arr_offset = compressed.y;\\nvec4 node_buffer;\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\nint arr_idx = arr_offset + (4 * p);\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[int(arr_idx / 4)];}\\nfloat float_j = node_buffer.x;\\nvec4 nextNode = gWebGPUBuffer0.u_Data[int(float_j)];\\nfloat vx = nextNode.x - currentNode.x;\\nfloat vy = nextNode.y - currentNode.y;\\nfloat dist = sqrt((vx * vx) + (vy * vy)) + 0.01;\\nfloat direx = vx / dist;\\nfloat direy = vy / dist;\\nfloat edgeLength = node_buffer.y;\\nfloat edgeStrength = node_buffer.z;\\nfloat diff = edgeLength - dist;\\nfloat param = (diff * edgeStrength) / mass;\\nax -= direx * param;\\nay -= direy * param;}\\nreturn vec2(ax, ay);}\\nvoid main() {int i = globalInvocationID.x;\\nvec4 currentNode = gWebGPUBuffer0.u_Data[i];\\nvec4 movement = gWebGPUBuffer1.u_AveMovement[0];\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nif ((i >= VERTEX_COUNT) || (movement.x < gWebGPUUniformParams.u_minMovement)) {gWebGPUBuffer0.u_Data[i] = currentNode;\\nreturn ;}\\nvec4 nodeAttributes1 = gWebGPUBuffer2.u_NodeAttributeArray1[i];\\nvec4 nodeAttributes2 = gWebGPUBuffer3.u_NodeAttributeArray2[i];\\nvec2 repulsive = calcRepulsive(i, currentNode);\\nax += repulsive.x;\\nay += repulsive.y;\\nvec2 attractive = calcAttractive(i, currentNode, nodeAttributes1);\\nax += attractive.x;\\nay += attractive.y;\\nvec2 gravity = calcGravity(i, currentNode, nodeAttributes2);\\nax -= gravity.x;\\nay -= gravity.y;\\nfloat param = gWebGPUUniformParams.u_interval * gWebGPUUniformParams.u_damping;\\nfloat vx = ax * param;\\nfloat vy = ay * param;\\nfloat vlength = sqrt((vx * vx) + (vy * vy)) + 0.0001;\\nif (vlength > gWebGPUUniformParams.u_maxSpeed) {float param2 = gWebGPUUniformParams.u_maxSpeed / vlength;\\nvx = param2 * vx;\\nvy = param2 * vy;}\\nfloat distx = vx * gWebGPUUniformParams.u_interval;\\nfloat disty = vy * gWebGPUUniformParams.u_interval;\\nfloat distLength = sqrt((distx * distx) + (disty * disty));\\nif ((nodeAttributes1.w != 0.0) && (nodeAttributes2.w != 0.0)) {gWebGPUBuffer0.u_Data[i] = vec4(nodeAttributes1.w, nodeAttributes2.w, currentNode.z, 0.0);}else {gWebGPUBuffer0.u_Data[i] = vec4(currentNode.x + distx, currentNode.y + disty, currentNode.z, distLength);}}\\n","GLSL100":"\\n\\nfloat epsilon = 0.00001;\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\n  vec2 normAddr2D = float(address1D) * conv_const;\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\n}\\n\\nvoid barrier() {}\\n  \\n\\nuniform vec2 u_OutputTextureSize;\\nuniform int u_OutputTexelCount;\\nvarying vec2 v_TexCoord;\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n#define SHIFT_20 1048576.0\\n\\nuniform sampler2D u_Data;\\nuniform vec2 u_DataSize;\\nvec4 getDatau_Data(vec2 address2D) {\\n  return vec4(texture2D(u_Data, address2D).rgba);\\n}\\nvec4 getDatau_Data(float address1D) {\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\n}\\nvec4 getDatau_Data(int address1D) {\\n  return getDatau_Data(float(address1D));\\n}\\nuniform float u_damping;\\nuniform float u_maxSpeed;\\nuniform float u_minMovement;\\nuniform sampler2D u_AveMovement;\\nuniform vec2 u_AveMovementSize;\\nvec4 getDatau_AveMovement(vec2 address2D) {\\n  return vec4(texture2D(u_AveMovement, address2D).rgba);\\n}\\nvec4 getDatau_AveMovement(float address1D) {\\n  return getDatau_AveMovement(addrTranslation_1Dto2D(address1D, u_AveMovementSize));\\n}\\nvec4 getDatau_AveMovement(int address1D) {\\n  return getDatau_AveMovement(float(address1D));\\n}\\nuniform float u_coulombDisScale;\\nuniform float u_factor;\\nuniform sampler2D u_NodeAttributeArray1;\\nuniform vec2 u_NodeAttributeArray1Size;\\nvec4 getDatau_NodeAttributeArray1(vec2 address2D) {\\n  return vec4(texture2D(u_NodeAttributeArray1, address2D).rgba);\\n}\\nvec4 getDatau_NodeAttributeArray1(float address1D) {\\n  return getDatau_NodeAttributeArray1(addrTranslation_1Dto2D(address1D, u_NodeAttributeArray1Size));\\n}\\nvec4 getDatau_NodeAttributeArray1(int address1D) {\\n  return getDatau_NodeAttributeArray1(float(address1D));\\n}\\nuniform sampler2D u_NodeAttributeArray2;\\nuniform vec2 u_NodeAttributeArray2Size;\\nvec4 getDatau_NodeAttributeArray2(vec2 address2D) {\\n  return vec4(texture2D(u_NodeAttributeArray2, address2D).rgba);\\n}\\nvec4 getDatau_NodeAttributeArray2(float address1D) {\\n  return getDatau_NodeAttributeArray2(addrTranslation_1Dto2D(address1D, u_NodeAttributeArray2Size));\\n}\\nvec4 getDatau_NodeAttributeArray2(int address1D) {\\n  return getDatau_NodeAttributeArray2(float(address1D));\\n}\\nuniform float u_interval;\\nivec2 unpack_float(float packedValue) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nint packedIntValue = int(packedValue);\\nint v0 = packedIntValue / int(SHIFT_20);\\nreturn ivec2(v0, packedIntValue - (v0 * int(SHIFT_20)));}\\nvec2 calcRepulsive(int i, vec4 currentNode) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = getDatau_Data(j);\\nfloat vx = currentNode.x - nextNode.x;\\nfloat vy = currentNode.y - nextNode.y;\\nfloat dist = sqrt((vx * vx) + (vy * vy)) + 0.01;\\nfloat n_dist = (dist + 0.1) * u_coulombDisScale;\\nfloat direx = vx / dist;\\nfloat direy = vy / dist;\\nvec4 attributesi = getDatau_NodeAttributeArray1(i);\\nvec4 attributesj = getDatau_NodeAttributeArray1(j);\\nfloat massi = attributesi.x;\\nfloat nodeStrengthi = attributesi.z;\\nfloat nodeStrengthj = attributesj.z;\\nfloat nodeStrength = (nodeStrengthi + nodeStrengthj) / 2.0;\\nfloat param = (nodeStrength * u_factor) / (n_dist * n_dist);\\nax += direx * param;\\nay += direy * param;}}\\nreturn vec2(ax, ay);}\\nvec2 calcGravity(int i, vec4 currentNode, vec4 attributes2) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat vx = currentNode.x - attributes2.x;\\nfloat vy = currentNode.y - attributes2.y;\\nfloat ax = vx * attributes2.z;\\nfloat ay = vy * attributes2.z;\\nreturn vec2(ax, ay);}\\nvec2 calcAttractive(int i, vec4 currentNode, vec4 attributes1) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat mass = attributes1.x;\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nivec2 compressed = unpack_float(currentNode.z);\\nint length = compressed.x;\\nint arr_offset = compressed.y;\\nvec4 node_buffer;\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\nint arr_idx = arr_offset + (4 * p);\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = getDatau_Data(int(arr_idx / 4));}\\nfloat float_j = node_buffer.x;\\nvec4 nextNode = getDatau_Data(int(float_j));\\nfloat vx = nextNode.x - currentNode.x;\\nfloat vy = nextNode.y - currentNode.y;\\nfloat dist = sqrt((vx * vx) + (vy * vy)) + 0.01;\\nfloat direx = vx / dist;\\nfloat direy = vy / dist;\\nfloat edgeLength = node_buffer.y;\\nfloat edgeStrength = node_buffer.z;\\nfloat diff = edgeLength - dist;\\nfloat param = (diff * edgeStrength) / mass;\\nax -= direx * param;\\nay -= direy * param;}\\nreturn vec2(ax, ay);}\\nvoid main() {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nint i = globalInvocationID.x;\\nvec4 currentNode = getDatau_Data(i);\\nvec4 movement = getDatau_AveMovement(0.0);\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nif ((i >= VERTEX_COUNT) || (movement.x < u_minMovement)) {gl_FragColor = vec4(currentNode);\\nreturn ;}\\nvec4 nodeAttributes1 = getDatau_NodeAttributeArray1(i);\\nvec4 nodeAttributes2 = getDatau_NodeAttributeArray2(i);\\nvec2 repulsive = calcRepulsive(i, currentNode);\\nax += repulsive.x;\\nay += repulsive.y;\\nvec2 attractive = calcAttractive(i, currentNode, nodeAttributes1);\\nax += attractive.x;\\nay += attractive.y;\\nvec2 gravity = calcGravity(i, currentNode, nodeAttributes2);\\nax -= gravity.x;\\nay -= gravity.y;\\nfloat param = u_interval * u_damping;\\nfloat vx = ax * param;\\nfloat vy = ay * param;\\nfloat vlength = sqrt((vx * vx) + (vy * vy)) + 0.0001;\\nif (vlength > u_maxSpeed) {float param2 = u_maxSpeed / vlength;\\nvx = param2 * vx;\\nvy = param2 * vy;}\\nfloat distx = vx * u_interval;\\nfloat disty = vy * u_interval;\\nfloat distLength = sqrt((distx * distx) + (disty * disty));\\nif ((nodeAttributes1.w != 0.0) && (nodeAttributes2.w != 0.0)) {gl_FragColor = vec4(vec4(nodeAttributes1.w, nodeAttributes2.w, currentNode.z, 0.0));}else {gl_FragColor = vec4(vec4(currentNode.x + distx, currentNode.y + disty, currentNode.z, distLength));}if (gWebGPUDebug) {\\n  gl_FragColor = gWebGPUDebugOutput;\\n}}\\n"},"context":{"name":"","dispatch":[1,1,1],"threadGroupSize":[1,1,1],"maxIteration":1,"defines":[{"name":"MAX_EDGE_PER_VERTEX","type":"Float","runtime":true},{"name":"VERTEX_COUNT","type":"Float","runtime":true},{"name":"SHIFT_20","type":"Float","value":1048576,"runtime":false}],"uniforms":[{"name":"u_Data","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":false,"writeonly":false,"size":[1,1]},{"name":"u_damping","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_maxSpeed","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_minMovement","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_AveMovement","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_coulombDisScale","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_factor","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_NodeAttributeArray1","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_NodeAttributeArray2","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_interval","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]}],"globalDeclarations":[],"output":{"name":"u_Data","size":[1,1],"length":1},"needPingpong":true}}').setDispatch([a,1,1]).setBinding({u_Data:u,u_damping:n.damping,u_maxSpeed:n.maxSpeed,u_minMovement:n.minMovement,u_coulombDisScale:n.coulombDisScale,u_factor:n.factor,u_NodeAttributeArray1:y,u_NodeAttributeArray2:_,MAX_EDGE_PER_VERTEX:s,VERTEX_COUNT:a,u_AveMovement:w,u_interval:n.interval}),S=b.createKernel('{"shaders":{"WGSL":"import \\"GLSL.std.450\\" as std;\\n\\n\\n# var gWebGPUDebug : bool = false;\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\n\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\n\\ntype GWebGPUParams = [[block]] struct {\\n  [[offset 0]] u_iter : f32;\\n};\\n[[binding 0, set 0]] var<uniform> gWebGPUUniformParams : GWebGPUParams;\\ntype GWebGPUBuffer0 = [[block]] struct {\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\ntype GWebGPUBuffer1 = [[block]] struct {\\n  [[offset 0]] u_AveMovement : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 2, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\n\\n\\n\\n\\n\\n\\n\\n\\nfn main() -> void {var movement : f32 = 0.0;\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {var vertex : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\nmovement = movement + vertex.w;}\\nmovement = movement / f32(__DefineValuePlaceholder__VERTEX_COUNT);\\ngWebGPUBuffer1.u_AveMovement[0] = vec4<f32>(movement, 0.0, 0.0, 0.0);\\nreturn;}\\n\\nentry_point compute as \\"main\\" = main;\\n","GLSL450":"\\n\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\nivec3 workGroupSize = ivec3(1,1,1);\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\n\\nlayout(std140, set = 0, binding = 0) uniform GWebGPUParams {\\n  float u_iter;\\n} gWebGPUUniformParams;\\nlayout(std430, set = 0, binding = 1) buffer readonly  GWebGPUBuffer0 {\\n  vec4 u_Data[];\\n} gWebGPUBuffer0;\\n\\nlayout(std430, set = 0, binding = 2) buffer   GWebGPUBuffer1 {\\n  vec4 u_AveMovement[];\\n} gWebGPUBuffer1;\\n\\n\\n\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\nlayout (\\n  local_size_x = 1,\\n  local_size_y = 1,\\n  local_size_z = 1\\n) in;\\n\\n\\n\\nvoid main() {float movement = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {vec4 vertex = gWebGPUBuffer0.u_Data[j];\\nmovement += vertex.w;}\\nmovement = movement / float(VERTEX_COUNT);\\ngWebGPUBuffer1.u_AveMovement[0] = vec4(movement, 0.0, 0.0, 0.0);}\\n","GLSL100":"\\n\\nfloat epsilon = 0.00001;\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\n  vec2 normAddr2D = float(address1D) * conv_const;\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\n}\\n\\nvoid barrier() {}\\n  \\n\\nuniform vec2 u_OutputTextureSize;\\nuniform int u_OutputTexelCount;\\nvarying vec2 v_TexCoord;\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n\\nuniform sampler2D u_Data;\\nuniform vec2 u_DataSize;\\nvec4 getDatau_Data(vec2 address2D) {\\n  return vec4(texture2D(u_Data, address2D).rgba);\\n}\\nvec4 getDatau_Data(float address1D) {\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\n}\\nvec4 getDatau_Data(int address1D) {\\n  return getDatau_Data(float(address1D));\\n}\\nuniform float u_iter;\\nuniform sampler2D u_AveMovement;\\nuniform vec2 u_AveMovementSize;\\nvec4 getDatau_AveMovement(vec2 address2D) {\\n  return vec4(texture2D(u_AveMovement, address2D).rgba);\\n}\\nvec4 getDatau_AveMovement(float address1D) {\\n  return getDatau_AveMovement(addrTranslation_1Dto2D(address1D, u_AveMovementSize));\\n}\\nvec4 getDatau_AveMovement(int address1D) {\\n  return getDatau_AveMovement(float(address1D));\\n}\\nvoid main() {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat movement = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {vec4 vertex = getDatau_Data(j);\\nmovement += vertex.w;}\\nmovement = movement / float(VERTEX_COUNT);\\ngl_FragColor = vec4(vec4(movement, 0.0, 0.0, 0.0));if (gWebGPUDebug) {\\n  gl_FragColor = gWebGPUDebugOutput;\\n}}\\n"},"context":{"name":"","dispatch":[1,1,1],"threadGroupSize":[1,1,1],"maxIteration":1,"defines":[{"name":"VERTEX_COUNT","type":"Float","runtime":true}],"uniforms":[{"name":"u_Data","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_iter","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_AveMovement","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":false,"writeonly":false,"size":[1,1]}],"globalDeclarations":[],"output":{"name":"u_AveMovement","size":[1,1],"length":1},"needPingpong":true}}').setDispatch([1,1,1]).setBinding({u_Data:u,VERTEX_COUNT:a,u_AveMovement:[0,0,0,0]});yield(()=>zE(this,void 0,void 0,(function*(){for(let t=0;t<o;t++){yield E.execute(),S.setBinding({u_Data:E}),yield S.execute();const e=Math.max(.02,n.interval-.002*t);E.setBinding({u_interval:e,u_AveMovement:S})}const i=yield E.getOutput();t?e.postMessage({type:lf,vertexEdgeData:i}):r.forEach(((t,e)=>{const n=i[4*e],r=i[4*e+1];t.x=n,t.y=r})),x&&x()})))()}))}getType(){return"gForce-gpu"}}class ZE extends ch{constructor(t){super(),this.center=[0,0],this.maxIteration=100,this.gravity=10,this.comboGravity=10,this.linkDistance=10,this.alpha=1,this.alphaMin=.001,this.alphaDecay=1-Math.pow(this.alphaMin,1/300),this.alphaTarget=0,this.velocityDecay=.6,this.edgeStrength=.6,this.nodeStrength=30,this.preventOverlap=!1,this.preventNodeOverlap=!1,this.preventComboOverlap=!1,this.collideStrength=void 0,this.nodeCollideStrength=.5,this.comboCollideStrength=.5,this.comboSpacing=20,this.comboPadding=10,this.optimizeRangeFactor=1,this.onTick=()=>{},this.onLayoutEnd=()=>{},this.depthAttractiveForceScale=1,this.depthRepulsiveForceScale=2,this.nodes=[],this.edges=[],this.combos=[],this.comboTrees=[],this.width=300,this.height=300,this.bias=[],this.nodeMap={},this.oriComboMap={},this.indexMap={},this.comboMap={},this.previousLayouted=!1,this.updateCfg(t)}getDefaultCfg(){return{maxIteration:100,center:[0,0],gravity:10,speed:1,comboGravity:30,preventOverlap:!1,preventComboOverlap:!0,preventNodeOverlap:!0,nodeSpacing:void 0,collideStrength:void 0,nodeCollideStrength:.5,comboCollideStrength:.5,comboSpacing:20,comboPadding:10,edgeStrength:.6,nodeStrength:30,linkDistance:10}}execute(){const t=this,e=t.nodes,n=t.center;if(t.comboTree={id:"comboTreeRoot",depth:-1,children:t.comboTrees},e&&0!==e.length){if(1===e.length)return e[0].x=n[0],e[0].y=n[1],void(t.onLayoutEnd&&t.onLayoutEnd());t.initVals(),t.run(),t.onLayoutEnd&&t.onLayoutEnd()}else t.onLayoutEnd&&t.onLayoutEnd()}run(){const t=this,e=t.nodes,n=t.previousLayouted?t.maxIteration/5:t.maxIteration;t.width||"undefined"==typeof window||(t.width=window.innerWidth),t.height||"undefined"==typeof window||(t.height=window.innerHeight);const r=t.center,i=t.velocityDecay,o=t.comboMap;t.previousLayouted||t.initPos(o);for(let r=0;r<n;r++){const n=[];e.forEach(((t,e)=>{n[e]={x:0,y:0}})),t.applyCalculate(n),t.applyComboCenterForce(n),e.forEach(((t,e)=>{ph(t.x)&&ph(t.y)&&(t.x+=n[e].x*i,t.y+=n[e].y*i)})),t.alpha+=(t.alphaTarget-t.alpha)*t.alphaDecay,t.onTick()}const a=[0,0];e.forEach((t=>{ph(t.x)&&ph(t.y)&&(a[0]+=t.x,a[1]+=t.y)})),a[0]/=e.length,a[1]/=e.length;const s=[r[0]-a[0],r[1]-a[1]];e.forEach(((t,e)=>{ph(t.x)&&ph(t.y)&&(t.x+=s[0],t.y+=s[1])})),t.combos.forEach((t=>{const e=o[t.id];e&&e.empty&&(t.x=e.cx||t.x,t.y=e.cy||t.y)})),t.previousLayouted=!0}initVals(){const t=this,e=t.edges,n=t.nodes,r=t.combos,i={},o={},a={};n.forEach(((t,e)=>{o[t.id]=t,a[t.id]=e})),t.nodeMap=o,t.indexMap=a;const s={};r.forEach((t=>{s[t.id]=t})),t.oriComboMap=s,t.comboMap=t.getComboMap();const u=t.preventOverlap;t.preventComboOverlap=t.preventComboOverlap||u,t.preventNodeOverlap=t.preventNodeOverlap||u;const l=t.collideStrength;l&&(t.comboCollideStrength=l,t.nodeCollideStrength=l),t.comboCollideStrength=t.comboCollideStrength?t.comboCollideStrength:0,t.nodeCollideStrength=t.nodeCollideStrength?t.nodeCollideStrength:0;for(let t=0;t<e.length;++t){const n=mh(e[t],"source"),r=mh(e[t],"target");i[n]?i[n]++:i[n]=1,i[r]?i[r]++:i[r]=1}const c=[];for(let t=0;t<e.length;++t){const n=mh(e[t],"source"),r=mh(e[t],"target");c[t]=i[n]/(i[n]+i[r])}this.bias=c;const h=t.nodeSize,f=t.nodeSpacing;let p,d;if(d=ph(f)?()=>f:Eh(f)?f:()=>0,this.nodeSpacing=d,h)if(Eh(h))p=t=>h(t);else if(fh(h)){const t=(h[0]>h[1]?h[0]:h[1])/2;p=e=>t}else{const t=h/2;p=e=>t}else p=t=>t.size?fh(t.size)?(t.size[0]>t.size[1]?t.size[0]:t.size[1])/2:gh(t.size)?(t.size.width>t.size.height?t.size.width:t.size.height)/2:t.size/2:10;this.nodeSize=p;const g=t.comboSpacing;let v;v=ph(g)?()=>g:Eh(g)?g:()=>0,this.comboSpacing=v;const m=t.comboPadding;let y;y=ph(m)?()=>m:fh(m)?()=>Math.max.apply(null,m):Eh(m)?m:()=>0,this.comboPadding=y;let _,b=this.linkDistance;b||(b=10),_=ph(b)?t=>b:b,this.linkDistance=_;let x,w=this.edgeStrength;w||(w=1),x=ph(w)?t=>w:w,this.edgeStrength=x;let E,S=this.nodeStrength;S||(S=30),E=ph(S)?t=>S:S,this.nodeStrength=E}initPos(t){this.nodes.forEach(((e,n)=>{const r=e.comboId,i=t[r];r&&i?(e.x=i.cx+100/(n+1),e.y=i.cy+100/(n+1)):(e.x=100/(n+1),e.y=100/(n+1))}))}getComboMap(){const t=this,e=t.nodeMap,n=t.comboTrees,r=t.oriComboMap,i={};return(n||[]).forEach((n=>{const o=[];wh(n,(n=>{if("node"===n.itemType)return!0;if(!r[n.id])return!0;if(void 0===i[n.id]){const e={id:n.id,name:n.id,cx:0,cy:0,count:0,depth:t.oriComboMap[n.id].depth||0,children:[]};i[n.id]=e}const a=n.children;a&&a.forEach((t=>{if(!i[t.id]&&!e[t.id])return!0;o.push(t)}));const s=i[n.id];if(s.cx=0,s.cy=0,0===o.length){s.empty=!0;const t=r[n.id];s.cx=t.x,s.cy=t.y}return o.forEach((t=>{if(s.count++,"node"!==t.itemType){const e=i[t.id];return ph(e.cx)&&(s.cx+=e.cx),void(ph(e.cy)&&(s.cy+=e.cy))}const n=e[t.id];n&&(ph(n.x)&&(s.cx+=n.x),ph(n.y)&&(s.cy+=n.y))})),s.cx/=s.count||1,s.cy/=s.count||1,s.children=o,!0}))})),i}applyComboCenterForce(t){const e=this,n=e.gravity,r=e.comboGravity||n,i=this.alpha,o=e.comboTrees,a=e.indexMap,s=e.nodeMap,u=e.comboMap;(o||[]).forEach((e=>{wh(e,(e=>{if("node"===e.itemType)return!0;if(!u[e.id])return!0;const n=u[e.id],o=(n.depth+1)/10*.5,l=n.cx,c=n.cy;return n.cx=0,n.cy=0,n.children.forEach((e=>{if("node"!==e.itemType){const t=u[e.id];return t&&ph(t.cx)&&(n.cx+=t.cx),void(t&&ph(t.cy)&&(n.cy+=t.cy))}const h=s[e.id],f=h.x-l||.005,p=h.y-c||.005,d=Math.sqrt(f*f+p*p),g=a[h.id],v=r*i/d*o;t[g].x-=f*v,t[g].y-=p*v,ph(h.x)&&(n.cx+=h.x),ph(h.y)&&(n.cy+=h.y)})),n.cx/=n.count||1,n.cy/=n.count||1,!0}))}))}applyCalculate(t){const e=this,n=e.comboMap,r=e.nodes,i={};r.forEach(((t,e)=>{r.forEach(((n,r)=>{if(e<r)return;const o=t.x-n.x||.005,a=t.y-n.y||.005;let s=o*o+a*a;const u=Math.sqrt(s);s<1&&(s=u),i[`${t.id}-${n.id}`]={vx:o,vy:a,vl2:s,vl:u},i[`${n.id}-${t.id}`]={vl2:s,vl:u,vx:-o,vy:-a}}))})),e.updateComboSizes(n),e.calRepulsive(t,i),e.calAttractive(t,i),e.preventComboOverlap&&e.comboNonOverlapping(t,n)}updateComboSizes(t){const e=this,n=e.comboTrees,r=e.nodeMap,i=e.nodeSize,o=e.comboSpacing,a=e.comboPadding;(n||[]).forEach((n=>{const s=[];wh(n,(n=>{if("node"===n.itemType)return!0;const u=t[n.id];if(!u)return!1;const l=n.children;l&&l.forEach((e=>{(t[e.id]||r[e.id])&&s.push(e)})),u.minX=1/0,u.minY=1/0,u.maxX=-1/0,u.maxY=-1/0,s.forEach((t=>{if("node"!==t.itemType)return!0;const e=r[t.id];if(!e)return!0;const n=i(e),o=e.x-n,a=e.y-n,s=e.x+n,l=e.y+n;u.minX>o&&(u.minX=o),u.minY>a&&(u.minY=a),u.maxX<s&&(u.maxX=s),u.maxY<l&&(u.maxY=l)}));let c=e.oriComboMap[n.id].size||10;fh(c)&&(c=c[0]);const h=Math.max(u.maxX-u.minX,u.maxY-u.minY,c);return u.r=h/2+o(u)/2+a(u),!0}))}))}comboNonOverlapping(t,e){const n=this,r=n.comboTree,i=n.comboCollideStrength,o=n.indexMap,a=n.nodeMap;wh(r,(n=>{if(!e[n.id]&&!a[n.id]&&"comboTreeRoot"!==n.id)return!1;const r=n.children;return r&&r.length>1&&r.forEach(((n,s)=>{if("node"===n.itemType)return!1;const u=e[n.id];u&&r.forEach(((r,l)=>{if(s<=l)return!1;if("node"===r.itemType)return!1;const c=e[r.id];if(!c)return!1;const h=u.cx-c.cx||.005,f=u.cy-c.cy||.005,p=h*h+f*f,d=u.r||1,g=c.r||1,v=d+g,m=g*g,y=d*d;if(p<v*v){const e=n.children;if(!e||0===e.length)return!1;const s=r.children;if(!s||0===s.length)return!1;const u=Math.sqrt(p),l=(v-u)/u*i,c=h*l,d=f*l,g=m/(y+m),_=1-g;e.forEach((e=>{if("node"!==e.itemType)return!1;if(!a[e.id])return;const n=o[e.id];s.forEach((e=>{if("node"!==e.itemType)return!1;if(!a[e.id])return!1;const r=o[e.id];t[n].x+=c*g,t[n].y+=d*g,t[r].x-=c*_,t[r].y-=d*_}))}))}}))})),!0}))}calRepulsive(t,e){const n=this,r=n.nodes,i=n.width*n.optimizeRangeFactor,o=n.nodeStrength,a=n.alpha,s=n.nodeCollideStrength,u=n.preventNodeOverlap,l=n.nodeSize,c=n.nodeSpacing,h=n.depthRepulsiveForceScale,f=n.center;r.forEach(((p,d)=>{if(p.x&&p.y){if(f){const e=n.gravity,r=p.x-f[0]||.005,i=p.y-f[1]||.005,o=Math.sqrt(r*r+i*i);t[d].x-=r*e*a/o,t[d].y-=i*e*a/o}r.forEach(((n,r)=>{if(d===r)return;if(!n.x||!n.y)return;const{vl2:f,vl:g}=e[`${p.id}-${n.id}`];if(g>i)return;const{vx:v,vy:m}=e[`${p.id}-${n.id}`];let y=Math.log(Math.abs(n.depth-p.depth)/10)+1||1;y=y<1?1:y,n.comboId!==p.comboId&&(y+=1);const _=y?Math.pow(h,y):1,b=o(n)*a/f*_;if(t[d].x+=v*b,t[d].y+=m*b,d<r&&u){const e=l(p)+c(p)||1,i=l(n)+c(n)||1,o=e+i;if(f<o*o){const n=(o-g)/g*s,a=i*i;let u=a/(e*e+a);const l=v*n,c=m*n;t[d].x+=l*u,t[d].y+=c*u,u=1-u,t[r].x-=l*u,t[r].y-=c*u}}}))}}))}calAttractive(t,e){const n=this,r=n.edges,i=n.linkDistance,o=n.alpha,a=n.edgeStrength,s=n.bias,u=n.depthAttractiveForceScale;r.forEach(((r,l)=>{const c=mh(r,"source"),h=mh(r,"target");if(!c||!h||c===h)return;const f=n.indexMap[c],p=n.indexMap[h],d=n.nodeMap[c],g=n.nodeMap[h];if(!d||!g)return;let v=d.depth===g.depth?0:Math.log(Math.abs(d.depth-g.depth)/10);d.comboId===g.comboId&&(v/=2);let m=v?Math.pow(u,v):1;if(d.comboId!==g.comboId&&1===m?m=u/2:d.comboId===g.comboId&&(m=2),!(ph(g.x)&&ph(d.x)&&ph(g.y)&&ph(d.y)))return;const{vl:y,vx:_,vy:b}=e[`${h}-${c}`],x=(y-i(r))/y*o*a(r)*m,w=_*x,E=b*x,S=s[l];t[p].x-=w*S,t[p].y-=E*S,t[f].x+=w*(1-S),t[f].y+=E*(1-S)}))}getType(){return"comboForce"}}class jE{constructor(t){this.id=t.id||0,this.rx=t.rx,this.ry=t.ry,this.fx=0,this.fy=0,this.mass=t.mass,this.degree=t.degree,this.g=t.g||0}distanceTo(t){const e=this.rx-t.rx,n=this.ry-t.ry;return Math.hypot(e,n)}setPos(t,e){this.rx=t,this.ry=e}resetForce(){this.fx=0,this.fy=0}addForce(t){const e=t.rx-this.rx,n=t.ry-this.ry;let r=Math.hypot(e,n);r=r<1e-4?1e-4:r;const i=this.g*(this.degree+1)*(t.degree+1)/r;this.fx+=i*e/r,this.fy+=i*n/r}in(t){return t.contains(this.rx,this.ry)}add(t){const e=this.mass+t.mass,n=(this.rx*this.mass+t.rx*t.mass)/e,r=(this.ry*this.mass+t.ry*t.mass)/e,i=this.degree+t.degree;return new jE({rx:n,ry:r,mass:e,degree:i})}}class UE{constructor(t){this.xmid=t.xmid,this.ymid=t.ymid,this.length=t.length,this.massCenter=t.massCenter||[0,0],this.mass=t.mass||1}getLength(){return this.length}contains(t,e){const n=this.length/2;return t<=this.xmid+n&&t>=this.xmid-n&&e<=this.ymid+n&&e>=this.ymid-n}NW(){const t=this.xmid-this.length/4,e=this.ymid+this.length/4,n=this.length/2;return new UE({xmid:t,ymid:e,length:n})}NE(){const t=this.xmid+this.length/4,e=this.ymid+this.length/4,n=this.length/2;return new UE({xmid:t,ymid:e,length:n})}SW(){const t=this.xmid-this.length/4,e=this.ymid-this.length/4,n=this.length/2;return new UE({xmid:t,ymid:e,length:n})}SE(){const t=this.xmid+this.length/4,e=this.ymid-this.length/4,n=this.length/2;return new UE({xmid:t,ymid:e,length:n})}}class GE{constructor(t){this.body=null,this.quad=null,this.NW=null,this.NE=null,this.SW=null,this.SE=null,this.theta=.5,null!=t&&(this.quad=t)}insert(t){null!=this.body?this._isExternal()?(this.quad&&(this.NW=new GE(this.quad.NW()),this.NE=new GE(this.quad.NE()),this.SW=new GE(this.quad.SW()),this.SE=new GE(this.quad.SE())),this._putBody(this.body),this._putBody(t),this.body=this.body.add(t)):(this.body=this.body.add(t),this._putBody(t)):this.body=t}_putBody(t){this.quad&&(t.in(this.quad.NW())&&this.NW?this.NW.insert(t):t.in(this.quad.NE())&&this.NE?this.NE.insert(t):t.in(this.quad.SW())&&this.SW?this.SW.insert(t):t.in(this.quad.SE())&&this.SE&&this.SE.insert(t))}_isExternal(){return null==this.NW&&null==this.NE&&null==this.SW&&null==this.SE}updateForce(t){null!=this.body&&t!==this.body&&(this._isExternal()||(this.quad?this.quad.getLength():0)/this.body.distanceTo(t)<this.theta?t.addForce(this.body):(this.NW&&this.NW.updateForce(t),this.NE&&this.NE.updateForce(t),this.SW&&this.SW.updateForce(t),this.SE&&this.SE.updateForce(t)))}}class VE extends ch{constructor(t){super(),this.center=[0,0],this.width=300,this.height=300,this.nodes=[],this.edges=[],this.kr=5,this.kg=1,this.mode="normal",this.preventOverlap=!1,this.dissuadeHubs=!1,this.barnesHut=void 0,this.maxIteration=0,this.ks=.1,this.ksmax=10,this.tao=.1,this.onLayoutEnd=()=>{},this.prune=void 0,this.updateCfg(t)}getDefaultCfg(){return{}}execute(){const t=this,{nodes:e,onLayoutEnd:n,prune:r}=t;let i=t.maxIteration;t.width||"undefined"==typeof window||(t.width=window.innerWidth),t.height||"undefined"==typeof window||(t.height=window.innerHeight);const o=[],a=e.length;for(let n=0;n<a;n+=1){const r=e[n];let i=10,a=10;ph(r.size)&&(i=r.size,a=r.size),fh(r.size)?(isNaN(r.size[0])||(i=r.size[0]),isNaN(r.size[1])||(a=r.size[1])):gh(r.size)&&(i=r.size.width,a=r.size.height),t.getWidth&&!isNaN(t.getWidth(r))&&(a=t.getWidth(r)),t.getHeight&&!isNaN(t.getHeight(r))&&(i=t.getHeight(r));const s=Math.max(i,a);o.push(s)}void 0===t.barnesHut&&a>250&&(t.barnesHut=!0),void 0===t.prune&&a>100&&(t.prune=!0),0!==this.maxIteration||t.prune?0===this.maxIteration&&r&&(i=100,a<=200&&a>100?i=500:a>200&&(i=950),this.maxIteration=i):(i=250,a<=200&&a>100?i=1e3:a>200&&(i=1200),this.maxIteration=i),t.kr||(t.kr=50,a>100&&a<=500?t.kr=20:a>500&&(t.kr=1)),t.kg||(t.kg=20,a>100&&a<=500?t.kg=10:a>500&&(t.kg=1)),this.nodes=t.updateNodesByForces(o),n()}updateNodesByForces(t){const e=this,{edges:n,maxIteration:r}=e;let i=e.nodes;const o=n.filter((t=>mh(t,"source")!==mh(t,"target"))),a=i.length,s=o.length,u=[],l={},c={},h=[];for(let t=0;t<a;t+=1)l[i[t].id]=t,u[t]=0,(void 0===i[t].x||isNaN(i[t].x))&&(i[t].x=1e3*Math.random()),(void 0===i[t].y||isNaN(i[t].y))&&(i[t].y=1e3*Math.random()),h.push({x:i[t].x,y:i[t].y});for(let t=0;t<s;t+=1){let e,n,r=0,s=0;for(let u=0;u<a;u+=1){const a=mh(o[t],"source"),l=mh(o[t],"target");i[u].id===a?(e=i[u],r=u):i[u].id===l&&(n=i[u],s=u),c[t]={sourceIdx:r,targetIdx:s}}e&&(u[l[e.id]]+=1),n&&(u[l[n.id]]+=1)}let f=r;if(i=this.iterate(f,l,c,s,u,t),e.prune){for(let t=0;t<s;t+=1)u[c[t].sourceIdx]<=1?(i[c[t].sourceIdx].x=i[c[t].targetIdx].x,i[c[t].sourceIdx].y=i[c[t].targetIdx].y):u[c[t].targetIdx]<=1&&(i[c[t].targetIdx].x=i[c[t].sourceIdx].x,i[c[t].targetIdx].y=i[c[t].sourceIdx].y);e.prune=!1,e.barnesHut=!1,f=100,i=this.iterate(f,l,c,s,u,t)}return i}iterate(t,e,n,r,i,o){const a=this;let{nodes:s}=a;const{kr:u,preventOverlap:l}=a,{barnesHut:c}=a,h=s.length;let f=0,p=t,d=[];const g=[],v=[];for(let t=0;t<h;t+=1)if(d[2*t]=0,d[2*t+1]=0,c){const e={id:t,rx:s[t].x,ry:s[t].y,mass:1,g:u,degree:i[t]};v[t]=new jE(e)}for(;p>0;){for(let t=0;t<h;t+=1)g[2*t]=d[2*t],g[2*t+1]=d[2*t+1],d[2*t]=0,d[2*t+1]=0;d=this.getAttrForces(p,50,r,e,n,i,o,d),d=c&&(l&&p>50||!l)?this.getOptRepGraForces(d,v,i):this.getRepGraForces(p,50,d,100,o,i);const t=this.updatePos(d,g,f,i);s=t.nodes,f=t.sg,p--,a.tick&&a.tick()}return s}getAttrForces(t,e,n,r,i,o,a,s){const{nodes:u,preventOverlap:l,dissuadeHubs:c,mode:h,prune:f}=this;for(let p=0;p<n;p+=1){const n=u[i[p].sourceIdx],d=i[p].sourceIdx,g=u[i[p].targetIdx],v=i[p].targetIdx;if(f&&(o[d]<=1||o[v]<=1))continue;const m=[g.x-n.x,g.y-n.y];let y=Math.hypot(m[0],m[1]);y=y<1e-4?1e-4:y,m[0]=m[0]/y,m[1]=m[1]/y,l&&t<e&&(y=y-a[d]-a[v]);let _=y,b=_;"linlog"===h&&(_=Math.log(1+y),b=_),c&&(_=y/o[d],b=y/o[v]),l&&t<e&&y<=0?(_=0,b=0):l&&t<e&&y>0&&(_=y,b=y),s[2*r[n.id]]+=_*m[0],s[2*r[g.id]]-=b*m[0],s[2*r[n.id]+1]+=_*m[1],s[2*r[g.id]+1]-=b*m[1]}return s}getRepGraForces(t,e,n,r,i,o){const{nodes:a,preventOverlap:s,kr:u,kg:l,center:c,prune:h}=this,f=a.length;for(let p=0;p<f;p+=1){for(let l=p+1;l<f;l+=1){if(h&&(o[p]<=1||o[l]<=1))continue;const c=[a[l].x-a[p].x,a[l].y-a[p].y];let f=Math.hypot(c[0],c[1]);f=f<1e-4?1e-4:f,c[0]=c[0]/f,c[1]=c[1]/f,s&&t<e&&(f=f-i[p]-i[l]);let d=u*(o[p]+1)*(o[l]+1)/f;s&&t<e&&f<0?d=r*(o[p]+1)*(o[l]+1):s&&t<e&&0===f?d=0:s&&t<e&&f>0&&(d=u*(o[p]+1)*(o[l]+1)/f),n[2*p]-=d*c[0],n[2*l]+=d*c[0],n[2*p+1]-=d*c[1],n[2*l+1]+=d*c[1]}const d=[a[p].x-c[0],a[p].y-c[1]],g=Math.hypot(d[0],d[1]);d[0]=d[0]/g,d[1]=d[1]/g;const v=l*(o[p]+1);n[2*p]-=v*d[0],n[2*p+1]-=v*d[1]}return n}getOptRepGraForces(t,e,n){const{nodes:r,kg:i,center:o,prune:a}=this,s=r.length;let u=9e10,l=-9e10,c=9e10,h=-9e10;for(let t=0;t<s;t+=1)a&&n[t]<=1||(e[t].setPos(r[t].x,r[t].y),r[t].x>=l&&(l=r[t].x),r[t].x<=u&&(u=r[t].x),r[t].y>=h&&(h=r[t].y),r[t].y<=c&&(c=r[t].y));const f=Math.max(l-u,h-c),p=new UE({xmid:(l+u)/2,ymid:(h+c)/2,length:f,massCenter:o,mass:s}),d=new GE(p);for(let t=0;t<s;t+=1)a&&n[t]<=1||e[t].in(p)&&d.insert(e[t]);for(let u=0;u<s;u+=1){if(a&&n[u]<=1)continue;e[u].resetForce(),d.updateForce(e[u]),t[2*u]-=e[u].fx,t[2*u+1]-=e[u].fy;const s=[r[u].x-o[0],r[u].y-o[1]];let l=Math.hypot(s[0],s[1]);l=l<1e-4?1e-4:l,s[0]=s[0]/l,s[1]=s[1]/l;const c=i*(n[u]+1);t[2*u]-=c*s[0],t[2*u+1]-=c*s[1]}return t}updatePos(t,e,n,r){const{nodes:i,ks:o,tao:a,prune:s,ksmax:u}=this,l=i.length,c=[],h=[];let f=0,p=0;for(let n=0;n<l;n+=1){if(s&&r[n]<=1)continue;const i=[t[2*n]-e[2*n],t[2*n+1]-e[2*n+1]],o=Math.hypot(i[0],i[1]),a=[t[2*n]+e[2*n],t[2*n+1]+e[2*n+1]],u=Math.hypot(a[0],a[1]);c[n]=o,h[n]=u/2,f+=(r[n]+1)*c[n],p+=(r[n]+1)*h[n]}const d=n;n=a*p/f,0!==d&&(n=n>1.5*d?1.5*d:n);for(let e=0;e<l;e+=1){if(s&&r[e]<=1)continue;let a=o*n/(1+n*Math.sqrt(c[e])),l=Math.hypot(t[2*e],t[2*e+1]);l=l<1e-4?1e-4:l;const h=u/l;a=a>h?h:a;const f=a*t[2*e],p=a*t[2*e+1];i[e].x+=f,i[e].y+=p}return{nodes:i,sg:n}}}class WE{constructor(){this.cells=[],this.columnNum=0,this.rowNum=0,this.additionColumn=[],this.additionRow=[]}init(t,e,n){this.cells=[],this.CELL_W=n.CELL_W||WE.DEFAULT_CELL_W,this.CELL_H=n.CELL_H||WE.DEFAULT_CELL_H,this.columnNum=Math.ceil(t/this.CELL_W),this.rowNum=Math.ceil(e/this.CELL_H),WE.MIN_DIST=Math.pow(t,2)+Math.pow(e,2);for(let t=0;t<this.columnNum;t++){const e=[];for(let n=0;n<this.rowNum;n++){const r={dx:t,dy:n,x:t*this.CELL_W,y:n*this.CELL_H,occupied:!1};e.push(r)}this.cells.push(e)}}findGridByNodeId(t){var e,n;for(let r=0;r<this.columnNum;r++)for(let i=0;i<this.rowNum;i++)if(this.cells[r][i].node&&(null===(n=null===(e=this.cells[r][i])||void 0===e?void 0:e.node)||void 0===n?void 0:n.id)===t)return{column:r,row:i};return null}sqdist(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)}occupyNearest(t){let e,n=WE.MIN_DIST,r=null;for(let i=0;i<this.columnNum;i++)for(let o=0;o<this.rowNum;o++)!this.cells[i][o].occupied&&(e=this.sqdist(t,this.cells[i][o]))<n&&(n=e,r=this.cells[i][o]);return r&&(r.occupied=!0),r}insertColumn(t,e){if(!(e<=0)){for(let t=0;t<e;t++){this.cells[t+this.columnNum]=[];for(let e=0;e<this.rowNum;e++)this.cells[t+this.columnNum][e]={dx:t,dy:e,x:t*this.CELL_W,y:e*this.CELL_H,occupied:!1,node:null}}for(let n=this.columnNum-1;n>t;n--)for(let t=0;t<this.rowNum;t++)this.cells[n+e][t]=Object.assign(Object.assign({},this.cells[n][t]),{x:(n+e)*this.CELL_W,y:t*this.CELL_H}),this.cells[n][t]={x:n*this.CELL_W,y:t*this.CELL_H,occupied:!0,node:null};for(let n=0;n<this.additionColumn.length;n++)this.additionColumn[n]>=t&&(this.additionColumn[n]+=e);for(let n=0;n<e;n++)this.additionColumn.push(t+n+1);this.columnNum+=e}}insertRow(t,e){if(!(e<=0)){for(let t=0;t<e;t++)for(let e=0;e<this.columnNum;e++)this.cells[e][t+this.rowNum]={dx:e,dy:t,x:e*this.CELL_W,y:t*this.CELL_H,occupied:!1,node:null};for(let n=0;n<this.columnNum;n++)for(let r=this.rowNum-1;r>t;r--)this.cells[n][r+e]=Object.assign(Object.assign({},this.cells[n][r]),{dx:n,dy:r+e,x:n*this.CELL_W,y:(r+e)*this.CELL_H}),this.cells[n][r]={dx:n,dy:r,x:n*this.CELL_W,y:r*this.CELL_H,occupied:!1,node:null};for(let n=0;n<this.additionRow.length;n++)this.additionRow[n]>=t&&(this.additionRow[n]+=e);for(let n=0;n<e;n++)this.additionRow.push(t+n+1);this.rowNum+=e}}getNodes(){const t=[];for(let e=0;e<this.columnNum;e++)for(let n=0;n<this.rowNum;n++)this.cells[e][n].node&&t.push(this.cells[e][n]);return t}}WE.MIN_DIST=50,WE.DEFAULT_CELL_W=80,WE.DEFAULT_CELL_H=80;const HE=1e7,XE=1.5707963267948966,YE=new Map;let qE=.8;function KE(t,e){const n=(YE.get(t.id)||[]).find((t=>t.source===e.id||t.target===e.id)),r=t.size[0]*t.size[1],i=e.size[0]*e.size[1],o=r>i?e:t,a=r>i?t:e,s=o.x-o.size[0]/2,u=o.y-o.size[1]/2,l=o.x+o.size[0]/2,c=o.y+o.size[1]/2,h=a.x-a.size[0]/2,f=a.y-a.size[1]/2,p=a.x+a.size[0]/2,d=a.y+a.size[1]/2,g=o.x,v=o.y,m=a.x,y=a.y;let _=0,b=0;if(l>=h&&p>=s&&c>=f&&d>=u)b=Math.sqrt(Math.pow(m-g,2)+Math.pow(y-v,2)),0===b&&(b=1e-7),_=10/b*100+((l<p?l:p)-(s>h?s:h))*((c<d?c:d)-(u>f?u:f)),_*=HE;else{let t=!1;const e=function(t,e,n){const r=t.x-t.size[0]/2,i=t.y-t.size[1]/2,o=t.x+t.size[0]/2,a=t.y+t.size[1]/2,s=e.x-e.size[0]/2,u=e.y-e.size[1]/2,l=e.x+e.size[0]/2,c=e.y+e.size[1]/2,h=t.x,f=t.y,p=e.x,d=e.y,g=p-h,v=Math.atan2(g,d-f);let m=0,y=0,_=0,b=0;v>XE?(y=i-c,m=s-o,_=parseFloat(y?(y/Math.cos(v)).toFixed(2):m.toFixed(2)),b=parseFloat(m?(m/Math.sin(v)).toFixed(2):y.toFixed(2))):0<v&&v<=XE?(y=u-a,m=s-o,_=b=y>m?parseFloat(y?(y/Math.cos(v)).toFixed(2):m.toFixed(2)):parseFloat(m?(m/Math.sin(v)).toFixed(2):y.toFixed(2))):v<-XE?(y=i-c,m=-(l-r),_=b=y>m?parseFloat(y?(y/Math.cos(v)).toFixed(2):m.toFixed(2)):parseFloat(m?(m/Math.sin(v)).toFixed(2):y.toFixed(2))):(y=u-a,m=Math.abs(g)>(o-r)/2?r-l:g,_=b=y>m?parseFloat(y?(y/Math.cos(v)).toFixed(2):m.toFixed(2)):parseFloat(m&&0!==v?(m/Math.sin(v)).toFixed(2):y.toFixed(2)));const x=parseFloat(v.toFixed(2));let w=n;return n&&(w=1.1780972450961724<x&&x<1.9634954084936207),{distance:Math.abs(_<b?_:b),isHoriz:w}}(o,a,t);b=e.distance,t=e.isHoriz,b<=10?_+=0!==b?n?10+1e7/b:10+1e8/b:HE:(_+=b,n&&(_+=b*b))}return _}function QE(t){let e=0;for(let n=0;n<t.length;n++){const r=t[n];(r.x<0||r.y<0||r.x>1200||r.y>800)&&(e+=1e12);for(let i=n+1;i<t.length;i++)e+=KE(r,t[i])}return e}function JE(t,e,n,r){const i=new Map;n.forEach(((t,e)=>{i.set(t.id,t)}));const o=r.filter((e=>e.source===t.id||e.target===t.id))||[],a=[];o.forEach((e=>{const n=e.source===t.id?e.target:e.source,r=i.get(n);r&&a.push(r)}));let s=!0;for(let n=0;n<a.length;n++){const r=a[n],i=180*Math.atan((t.y-r.y)/(r.x-t.y)),o=180*Math.atan((e.y-r.y)/(r.x-e.y)),u=o<30||o>150,l=i>70&&i<110,c=o>70&&o<110;if((i<30||i>150)&&!u||i*o<0){s=!1;break}if(l&&!c||i*o<0){s=!1;break}if((r.x-t.x)*(r.x-e.x)<0){s=!1;break}if((r.y-t.y)*(r.y-e.y)<0){s=!1;break}}return s}function $E(t,e){let n=!1;const r=[10,-10,0,0],i=[0,0,10,-10];for(let o=0;o<t.length;++o){const a=t[o];let s=tS(a,t);for(let o=0;o<r.length;o++)if(JE(a,{x:a.x+r[o],y:a.y+i[o]},t,e)){a.x+=r[o],a.y+=i[o];const e=tS(a,t),u=Math.random();e<s||u<qE&&u>.1?(s=e,n=!0):(a.x-=r[o],a.y-=i[o])}}return qE>.1&&(qE*=.5),n?QE(t):0}function tS(t,e){let n=0;(t.x<0||t.y<0||t.x+t.size[0]+20>1200||t.y+t.size[1]+20>800)&&(n+=1e12);for(let r=0;r<e.length;++r)t.id!==e[r].id&&(n+=KE(t,e[r]));return n}function eS(t,e){const{nodes:n,edges:r}=t,i=e.width,o=e.height;if(!(null==n?void 0:n.length))return Promise.resolve();const a=[];n.forEach((t=>{const e=r.filter((e=>e.source===t.id||e.target===t.id));if(e.length>1){const e=Object.assign({},t);delete e.size,a.push(e)}}));const s=[];r.forEach((t=>{const e=a.find((e=>e.id===t.source)),n=a.find((e=>e.id===t.target));e&&n&&s.push(t)}));const u=new hd({type:"dagre",ranksep:e.nodeMinGap,nodesep:e.nodeMinGap}),{nodes:l}=u.layout({nodes:a,edges:s});n.forEach((t=>{const e=(l||[]).find((e=>e.id===t.id));t.x=(null==e?void 0:e.x)||i/2,t.y=(null==e?void 0:e.y)||o/2}));const c=JSON.parse(JSON.stringify(n)),h=JSON.parse(JSON.stringify(r)),f=Qh().nodes(c).force("link",nf(h).id((t=>t.id)).distance((t=>{const e=s.find((e=>e.source===t.source&&e.target===t.target));return e?30:20}))).force("charge",Jh()).force("center",$h(i/2,o/2)).force("x",sf(i/2)).force("y",uf(o/2)).alpha(.3).alphaDecay(.08).alphaMin(.001),p=new Promise((t=>{f.on("end",(()=>{n.forEach((t=>{const e=c.find((e=>e.id===t.id));e&&(t.x=e.x,t.y=e.y)}));const a=Math.min(...n.map((t=>t.x))),s=Math.max(...n.map((t=>t.x))),u=Math.min(...n.map((t=>t.y))),l=Math.max(...n.map((t=>t.y))),h=i/(s-a),f=o/(l-u);n.forEach((t=>{void 0!==t.x&&h<1&&(t.x=(t.x-a)*h),void 0!==t.y&&f<1&&(t.y=(t.y-u)*f)})),n.forEach((t=>{t.sizeTemp=t.size,t.size=[10,10]})),function(t,e){if(0===t.length)return{nodes:t,edges:e};t.forEach((t=>{const n=e.filter((e=>e.source===t.id||e.target===t.id));YE.set(t,n)})),t.sort(((t,e)=>{var n,r;return(null===(n=YE.get(t.id))||void 0===n?void 0:n.length)-(null===(r=YE.get(e.id))||void 0===r?void 0:r.length)}));let n=QE(t),r=20,i=1,o=0,a=0;for(;r>0&&(a++,!(a>=50));){const a=$E(t,e);0!==a&&(o=a),i=o-n,n=o,0===i?--r:r=20}t.forEach((t=>{t.x=t.x-t.size[0]/2,t.y=t.y-t.size[1]/2}))}(n,r),n.forEach((t=>{t.size=t.sizeTemp||[],delete t.sizeTemp})),function(t,e){if(!t.nodes||0===t.nodes.length)return t;const n=e.width,r=e.height,i=e.nodeMinGap;let o=1e4,a=1e4;t.nodes.forEach((t=>{const e=t.size[0]||50,n=t.size[1]||50;o=Math.min(e,o),a=Math.min(n,a)}));const s=new WE;s.init(n,r,{CELL_H:a,CELL_W:o}),t.nodes.forEach((t=>{const e=s.occupyNearest(t);e&&(e.node={id:t.id,size:t.size},t.x=e.x,t.y=e.y,t.dx=e.dx,t.dy=e.dy)}));for(let e=0;e<t.nodes.length;e++){const n=t.nodes[e],r=s.findGridByNodeId(n.id);if(!r)throw new Error("can not find node cell");const{column:u,row:l}=r;if(n.size[0]+i>o){const t=Math.ceil((n.size[0]+i)/o)-1;let e=t;for(let n=0;n<t&&s.additionColumn.indexOf(u+n+1)>-1&&!s.cells[u+n+1][l].node;n++)e--;s.insertColumn(u,e)}if(n.size[1]+i>a){const t=Math.ceil((n.size[1]+i)/a)-1;let e=t;for(let n=0;n<t&&s.additionRow.indexOf(l+n+1)>-1&&!s.cells[u][l+n+1].node;n++)e--;s.insertRow(l,e)}}for(let e=0;e<s.columnNum;e++)for(let n=0;n<s.rowNum;n++){const r=s.cells[e][n];if(r.node){const e=t.nodes.find((t=>{var e;return t.id===(null===(e=null==r?void 0:r.node)||void 0===e?void 0:e.id)}));e&&(e.x=r.x+e.size[0]/2,e.y=r.y+e.size[1]/2)}}}({nodes:n,edges:r},e),t()}))}));return p}const nS={force:cf,fruchterman:Vd,forceAtlas2:VE,gForce:Mh,dagre:hd,circular:pf,radial:jd,concentric:Ud,grid:Ah,mds:Gd,comboForce:ZE,random:Th,"gForce-gpu":FE,"fruchterman-gpu":BE,er:class extends ch{constructor(t){super(),this.width=300,this.height=300,this.nodeMinGap=50,this.onLayoutEnd=()=>{},t&&this.updateCfg(t)}getDefaultCfg(){return{width:300,height:300,nodeMinGap:50}}execute(){const t=this,e=t.nodes,n=t.edges;return null==e||e.forEach((t=>{t.size||(t.size=[50,50])})),eS({nodes:e,edges:n},{width:this.width,height:this.height,nodeMinGap:this.nodeMinGap}).then((()=>{t.onLayoutEnd&&t.onLayoutEnd()}))}getType(){return"er"}}};var rS=n(1746),iS=n.n(rS),oS=su.traverseTree,aS=function(t,e){return t?(0,_.isNumber)(t)?function(e){return t}:t:function(t){return e||1}},sS=function(t,e){var n=[],r=[],i={},o=0;for(o=0;o<t.length;o++){var a=t[o];i[a.id]=o,n.push(a.x),n.push(a.y),n.push(0),n.push(0),r.push([])}for(o=0;o<e.length;o++){var s=e[o];r[i[s.source]].push(i[s.target]),r[i[s.target]].push(i[s.source])}var u=0;for(o=0;o<t.length;o++){var l=n.length,c=r[o],h=c.length;n[4*o+2]=l,n[4*o+3]=c.length,u=Math.max(u,c.length);for(var f=0;f<h;++f){var p=c[f];n.push(+p)}}for(;n.length%4!=0;)n.push(0);return{array:new Float32Array(n),maxEdgePerVetex:u}},uS=function(t,e,n){var r=[],i=[],o={},a=0;for(a=0;a<t.length;a++){var s=t[a];o[s.id]=a,r.push(s.x),r.push(s.y),r.push(0),r.push(0),i.push([])}for(a=0;a<e.length;a++){var u=e[a];i[o[u.source]].push(o[u.target]),i[o[u.source]].push(n(u)),i[o[u.target]].push(o[u.source]),i[o[u.target]].push(n(u))}var l=0;for(a=0;a<t.length;a++){var c=r.length,h=i[a],f=h.length;r[4*a+2]=c,r[4*a+3]=f/2,l=Math.max(l,f/2);for(var p=0;p<f;++p){var d=h[p];r.push(+d)}}for(;r.length%4!=0;)r.push(0);return{array:new Float32Array(r),maxEdgePerVetex:l}},lS=function(t,e,n,r){var i=[],o=[],a={},s=0;for(s=0;s<t.length;s++){var u=t[s];a[u.id]=s,i.push(u.x),i.push(u.y),i.push(0),i.push(0),o.push([])}for(s=0;s<e.length;s++){var l=e[s];o[a[l.source]].push(a[l.target]),o[a[l.source]].push(n(l)),o[a[l.source]].push(r(l)),o[a[l.source]].push(0),o[a[l.target]].push(a[l.source]),o[a[l.target]].push(n(l)),o[a[l.target]].push(r(l)),o[a[l.target]].push(0)}var c=0;for(s=0;s<t.length;s++){var h=i.length,f=o[s],p=f.length;i[4*s+2]=h+1048576*p/4,i[4*s+3]=0,c=Math.max(c,p/4);for(var d=0;d<p;++d){var g=f[d];i.push(+g)}}for(;i.length%4!=0;)i.push(0);return{array:new Float32Array(i),maxEdgePerVetex:c}},cS=function(t,e){var n=[],r=t.length,i={};return e.forEach((function(e){t.forEach((function(t,o){if(void 0===i[e[t]]&&(i[e[t]]=Object.keys(i).length),n.push(i[e[t]]),o===r-1)for(;n.length%4!=0;)n.push(0)}))})),{array:new Float32Array(n),count:Object.keys(i).length}},hS=function(t){for(var e=[],n=t.length,r=t[0].length,i=function(r){t.forEach((function(t,i){if(e.push(t[r]),i===n-1)for(;e.length%4!=0;)e.push(0)}))},o=0;o<r;o++)i(o);return new Float32Array(e)},fS=function(t,e){var n={x:1/0,y:1/0},r={x:-1/0,y:-1/0},i="x",o="y";e&&["V","TB","BT"].indexOf(e)>=0&&(o="x",i="y");var a=0;oS(t,(function(t){return a++,t.x>r.x&&(r.x=t.x),t.x<n.x&&(n.x=t.x),t.y>r.y&&(r.y=t.y),t.y<n.y&&(n.y=t.y),!0}));var s=2*Math.PI/a,u=r[o]-n[o];return 0===u||oS(t,(function(e){var r=(e[o]-n[o])/u*(2*Math.PI-s)+s,a=Math.abs("x"===i?e.x-t.x:e.y-t.y);return e.x=a*Math.cos(r),e.y=a*Math.sin(r),!0})),t},pS=function t(){return"undefined"==typeof window||"undefined"==typeof document?{}:{canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var t=document.createElement("div");return t.id="webgl-error-message",t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.background="#fff",t.style.color="#000",t.style.padding="1.5em",t.style.width="400px",t.style.margin="5em auto 0",this.webgl||(t.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" rel="external nofollow" rel="external nofollow" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" rel="external nofollow" rel="external nofollow" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" rel="external nofollow" rel="external nofollow" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" rel="external nofollow" rel="external nofollow" style="color:#000">here</a>.'].join("\n")),t},addGetWebGLMessage:function(e){var n=void 0!==(e=e||{}).parent?e.parent:document.body,r=void 0!==e.id?e.id:"oldie",i=t().getWebGLErrorMessage();i.id=r,n.appendChild(i)}}};const dS=(0,y.__assign)((0,y.__assign)((0,y.__assign)((0,y.__assign)({},su),d),g),v);var gS=dS.radialLayout;const vS=function(){function t(t){this.type=t.type,this.radial=t.radial,this.config=t}return t.prototype.init=function(t){var e=this;this.data=t,this.radial?this.layoutMethod=function(t){var n=iS()[e.type](t,e.config);return gS(n),n}:this.layoutMethod=function(t){return iS()[e.type](t,e.config)}},t.prototype.execute=function(){return this.layoutMethod(this.data,this.config)},t.prototype.layout=function(t){return this.init(t),this.execute()},t}();Ch("grid",Ah),Ch("random",Th),Ch("force",cf),Ch("circular",pf),Ch("dagre",hd),Ch("radial",jd),Ch("concentric",Ud),Ch("mds",Gd),Ch("fruchterman",Vd),Ch("fruchterman-gpu",BE),Ch("gForce",Mh),Ch("gForce-gpu",FE),Ch("comboForce",ZE),Ch("forceAtlas2",VE);var mS=function(t,e){e.isCustomLayout=!0,nS[t]=Ch(t,e)};const yS=function(t,e){var n=t.toString(),r=new Blob(["importScripts('".concat(e,"');(").concat(n,")()")],{type:"text/javascript"});return new Worker(URL.createObjectURL(r))};function _S(t){return _S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_S(t)}var bS=function(t){return setTimeout(t,16)},xS=function(t){return clearTimeout(t)},wS=function(t){return("undefined"!=typeof window&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame)||bS)(t)},ES=function(t){return("undefined"!=typeof window&&(window.cancelAnimationFrame||window.webkitCancelAnimationFrame)||xS)(t)},SS=["fruchterman","gForce"],CS=["force","grid","circular"],AS=function(t){function e(e){var n=t.call(this,e)||this;return n.graph=e,n.layoutCfg=e.get("layout")||{},n.layoutType=n.getLayoutType(),n.worker=null,n.workerData={},n.initLayout(),n}return(0,y.__extends)(e,t),e.prototype.initLayout=function(){},e.prototype.getWorker=function(){return this.worker||("undefined"==typeof Worker?(console.warn("Web worker is not supported in current browser."),this.worker=null):this.worker=function(t){void 0===t&&(t="https://unpkg.com/@antv/layout@latest/dist/layout.min.js");var e=new yS((function(){var t="LAYOUT_RUN",e="LAYOUT_ERROR",n="GPU_LAYOUT_RUN";layout.registerLayout("grid",layout.GridLayout),layout.registerLayout("random",layout.RandomLayout),layout.registerLayout("force",layout.ForceLayout),layout.registerLayout("circular",layout.CircularLayout),layout.registerLayout("dagre",layout.DagreLayout),layout.registerLayout("radial",layout.RadialLayout),layout.registerLayout("concentric",layout.ConcentricLayout),layout.registerLayout("mds",layout.MDSLayout),layout.registerLayout("fruchterman",layout.FruchtermanLayout),layout.registerLayout("fruchterman-gpu",layout.FruchtermanGPULayout),layout.registerLayout("gForce",layout.GForceLayout),layout.registerLayout("gForce-gpu",layout.GForceGPULayout),layout.registerLayout("comboForce",layout.ComboForceLayout),layout.registerLayout("forceAtlas2",layout.ForceAtlas2Layout),onmessage=function(r){(function(e){var r=e.data.type;return r===t||r===n})(r)&&function(r){var i=this;switch(r.data.type){case t:var o,a=r.data,s=a.nodes,u=a.edges,l=a.layoutCfg,c=(g=void 0===l?{}:l).type;if(!(h=layout.getLayoutByName(c))){this.postMessage({type:e,message:"layout ".concat(c," not found")});break}g.onLayoutEnd=function(){i.postMessage({type:"LAYOUT_END",nodes:s}),null==o||o.destroy()},(o=new h(g)).init({nodes:s,edges:u}),o.execute();break;case n:var h,f=r.data,p=f.nodes,d=(u=f.edges,f.layoutCfg),g=void 0===d?{}:d,v=f.canvas;if(c=g.type,!(h=layout.getLayoutByName(c))){this.postMessage({type:e,message:"layout ".concat(c," not found")});break}if("gpu"!==c.split("-")[1]){this.postMessage({type:e,message:"layout ".concat(c," does not support GPU")});break}var m=new h(g);m.init({nodes:p,edges:u}),m.executeWithWorker(v,this)}}(r)}}),t);return e}(this.layoutCfg.workerScriptURL)),this.worker},e.prototype.stopWorker=function(){var t=this.workerData;this.worker&&(this.worker.terminate(),this.worker=null,t.requestId&&(ES(t.requestId),t.requestId=null),t.requestId2&&(ES(t.requestId2),t.requestId2=null))},e.prototype.execLayoutMethod=function(t,e){var n=this;return new Promise((function(r,i){return(0,y.__awaiter)(n,void 0,void 0,(function(){var n,o,a,s,u,l,c;return(0,y.__generator)(this,(function(h){switch(h.label){case 0:if(!(n=this.graph)||n.get("destroyed"))return[2];o=t.type,t.onLayoutEnd=function(){n.emit("aftersublayout",{type:o}),r()},o&&this.isGPU&&(this.hasGPUVersion(o)?o="".concat(o,"-gpu"):console.warn("The '".concat(o,"' layout does not support GPU calculation for now, it will run in CPU."))),"force"===o||"g6force"===o||"gForce"===o?(a=t.onTick,l=function(){a&&a(),n.refreshPositions()},t.tick=l):"comboForce"===t.type&&(t.comboTrees=n.get("comboTrees"));try{s=new nS[o](t)}catch(t){console.warn("The layout method: '".concat(o,"' does not exist! Please specify it first.")),i()}return s.enableTick&&(u=t.onTick,l=function(){u&&u(),n.refreshPositions()},s.tick=l),function(t,e){var n;(null===(n=null==t?void 0:t.nodes)||void 0===n?void 0:n.length)&&t.nodes.forEach((function(t){t.layoutOrder=e}))}(c=this.filterLayoutData(this.data,t),e),s.init(c),n.emit("beforesublayout",{type:o}),[4,s.execute()];case 1:return h.sent(),s.isCustomLayout&&t.onLayoutEnd&&t.onLayoutEnd(),this.layoutMethods[e]=s,[2]}}))}))}))},e.prototype.updateLayoutMethod=function(t,e){var n=this;return new Promise((function(r,i){return(0,y.__awaiter)(n,void 0,void 0,(function(){var n,i,o;return(0,y.__generator)(this,(function(a){switch(a.label){case 0:return n=this.graph,i=null==e?void 0:e.type,e.onLayoutEnd=function(){n.emit("aftersublayout",{type:i}),r()},o=this.filterLayoutData(this.data,e),t.init(o),t.updateCfg(e),n.emit("beforesublayout",{type:i}),[4,t.execute()];case 1:return a.sent(),t.isCustomLayout&&e.onLayoutEnd&&e.onLayoutEnd(),[2]}}))}))}))},e.prototype.layout=function(t){var e=this,n=this.graph;this.data=this.setDataFromGraph();var r=this.data,i=r.nodes,o=r.hiddenNodes;if(!i)return!1;var a=n.get("width"),s=n.get("height"),u={};Object.assign(u,{width:a,height:s,center:[a/2,s/2]},this.layoutCfg),this.layoutCfg=u,this.destoryLayoutMethods(),n.emit("beforelayout"),this.initPositions(u.center,i),this.initPositions(u.center,o);var l=u.type;l&&"gpu"===l.split("-")[1]&&(l=l.split("-")[0],u.gpuEnabled=!0);var c=!1;u.gpuEnabled&&(c=!0,pS().webgl||(console.warn("Your browser does not support webGL or GPGPU. The layout will run in CPU."),c=!1)),this.isGPU=c;var h=u.onLayoutEnd,f=u.layoutEndFormatted,p=u.adjust;if(f||(u.layoutEndFormatted=!0,u.onAllLayoutEnd=function(){return(0,y.__awaiter)(e,void 0,void 0,(function(){return(0,y.__generator)(this,(function(t){switch(t.label){case 0:return h&&h(),this.refreshLayout(),p&&u.pipes?[4,this.adjustPipesBox(this.data,p)]:[3,2];case 1:t.sent(),this.refreshLayout(),t.label=2;case 2:return n.emit("afterlayout"),[2]}}))}))}),this.stopWorker(),u.workerEnabled&&this.layoutWithWorker(this.data))return!0;var d=Promise.resolve();return u.type?d=d.then((function(){return(0,y.__awaiter)(e,void 0,void 0,(function(){return(0,y.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.execLayoutMethod(u,0)];case 1:return[2,t.sent()]}}))}))})):u.pipes&&u.pipes.forEach((function(t,n){d=d.then((function(){return(0,y.__awaiter)(e,void 0,void 0,(function(){return(0,y.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.execLayoutMethod(t,n)];case 1:return[2,e.sent()]}}))}))}))})),d.then((function(){u.onAllLayoutEnd&&u.onAllLayoutEnd(),t&&t()})).catch((function(t){console.warn("graph layout failed,",t)})),!1},e.prototype.layoutWithWorker=function(t){var e=this,n=this.layoutCfg,r=this.graph,i=this.getWorker(),o=this.workerData;if(!i)return!1;o.requestId=null,o.requestId2=null,o.currentTick=null,o.currentTickData=null,r.emit("beforelayout");var a=Promise.resolve();if(n.type)a=a.then((function(){return e.runWebworker(i,t,n)}));else if(n.pipes)for(var s=function(n){a=a.then((function(){return e.runWebworker(i,t,n)}))},u=0,l=n.pipes;u<l.length;u++)s(l[u]);return a.then((function(){n.onAllLayoutEnd&&n.onAllLayoutEnd()})).catch((function(t){console.error("layout failed",t)})),!0},e.prototype.runWebworker=function(t,e,n){var r,i,o=this,a=this.isGPU,s=this.filterLayoutData(e,n),u=s.nodes,l=s.edges,c=document.createElement("canvas"),h=a&&"undefined"!=typeof window&&window.navigator&&!navigator.gpu&&"OffscreenCanvas"in window&&"transferControlToOffscreen"in c,f=(i={},(r=n)&&"object"===_S(r)?(Object.keys(r).forEach((function(t){r.hasOwnProperty(t)&&function(t){return"function"!=typeof t}(r[t])&&(i[t]=r[t])})),i):r);if(h){var p=c.transferControlToOffscreen();f.type="".concat(f.type,"-gpu"),t.postMessage({type:"GPU_LAYOUT_RUN",nodes:u,edges:l,layoutCfg:f,canvas:p},[p])}else t.postMessage({type:"LAYOUT_RUN",nodes:u,edges:l,layoutCfg:f});return new Promise((function(e,r){t.onmessage=function(t){o.handleWorkerMessage(e,r,t,s,n)}}))},e.prototype.handleWorkerMessage=function(t,e,n,r,i){var o=this.graph,a=this.workerData,s=n.data,u=s.type,l=function(){i.onTick&&i.onTick()};switch(u){case"LAYOUT_TICK":a.currentTick=s.currentTick,a.currentTickData=s,a.requestId||(a.requestId=wS((function(){kS(r,s),o.refreshPositions(),l(),s.currentTick===s.totalTicks?t():a.currentTick===s.totalTicks&&(a.requestId2=wS((function(){kS(r,a.currentTickData),o.refreshPositions(),a.requestId2=null,l(),t()}))),a.requestId=null})));break;case"LAYOUT_END":null==a.currentTick&&(kS(r,s),t());break;case"GPU_LAYOUT_END":null==a.currentTick&&(function(t,e){for(var n=t.nodes,r=e.vertexEdgeData,i=n.length,o=0;o<i;o++){var a=n[o],s=r[4*o],u=r[4*o+1];a.x=s,a.y=u}}(r,s),t());break;case"LAYOUT_ERROR":console.warn("Web-Worker layout error!",s.message),e();break;default:e()}},e.prototype.updateLayoutCfg=function(t){var e=this,n=this.graph,r=this.layoutMethods,i=(0,_.mix)({},this.layoutCfg,t);if(this.layoutCfg=i,null==r?void 0:r.length){if(this.data=this.setDataFromGraph(),this.stopWorker(),!t.workerEnabled||!this.layoutWithWorker(this.data)){n.emit("beforelayout");var o=Promise.resolve();1===r.length?o=o.then((function(){return(0,y.__awaiter)(e,void 0,void 0,(function(){return(0,y.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.updateLayoutMethod(r[0],i)];case 1:return[2,t.sent()]}}))}))})):null==r||r.forEach((function(t,n){var r=i.pipes[n];o=o.then((function(){return(0,y.__awaiter)(e,void 0,void 0,(function(){return(0,y.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.updateLayoutMethod(t,r)];case 1:return[2,e.sent()]}}))}))}))})),o.then((function(){i.onAllLayoutEnd&&i.onAllLayoutEnd()})).catch((function(t){console.warn("layout failed",t)}))}}else this.layout()},e.prototype.adjustPipesBox=function(t,e){var n=this;return new Promise((function(r){var i=t.nodes;(null==i?void 0:i.length)||r(),CS.includes(e)||(console.warn("The adjust type ".concat(e," is not supported yet, please assign it with 'force', 'grid', or 'circular'.")),r());var o={center:n.layoutCfg.center,nodeSize:function(t){return Math.max(t.height,t.width)},preventOverlap:!0,onLayoutEnd:function(){}},a=n.getLayoutBBox(i),s=a.groupNodes,u=a.layoutNodes,l=(0,_.clone)(u);o.onLayoutEnd=function(){null==u||u.forEach((function(t,e){var n,r,i,o=t.x-(null===(n=l[e])||void 0===n?void 0:n.x),a=t.y-(null===(r=l[e])||void 0===r?void 0:r.y);null===(i=s[e])||void 0===i||i.forEach((function(t){t.x+=o,t.y+=a}))})),r()},new nS[e](o).layout({nodes:u})}))},e.prototype.hasGPUVersion=function(t){return SS.includes(t)},e.prototype.destroy=function(){this.destoryLayoutMethods();var t=this.worker;t&&(t.terminate(),this.worker=null),this.destroyed=!0,this.graph.set("layout",void 0),this.layoutCfg=void 0,this.layoutType=void 0,this.layoutMethods=void 0,this.graph=null},e}(lu);const TS=AS;function kS(t,e){for(var n=t.nodes,r=e.nodes,i=n.length,o=0;o<i;o++){var a=n[o];a.x=r[o].x,a.y=r[o].y}}var MS,PS,IS,OS;function RS(t){MS||(MS=document.createElement("table"),PS=document.createElement("tr"),IS=/^\s*<(\w+|!)[^>]*>/,OS={tr:document.createElement("tbody"),tbody:MS,thead:MS,tfoot:MS,td:PS,th:PS,"*":document.createElement("div")});var e=IS.test(t)&&RegExp.$1;e&&e in OS||(e="*");var n=OS[e];t=t.replace(/(^\s*)|(\s*$)/g,""),n.innerHTML=""+t;var r=n.childNodes[0];return n.removeChild(r),r}var LS=ut,DS=function(t){function e(e){var n=t.call(this,e)||this,r=n.get("defaultNode");return r||n.set("defaultNode",{type:"circle"}),r.type||(r.type="circle",n.set("defaultNode",r)),n.destroyed=!1,n}return(0,y.__extends)(e,t),e.prototype.initLayoutController=function(){var t=new TS(this);this.set({layoutController:t})},e.prototype.initEventController=function(){var t=new lh(this);this.set({eventController:t})},e.prototype.initCanvas=function(){var t=this.get("container");if("string"==typeof t&&(t=document.getElementById(t),this.set("container",t)),!t)throw new Error("invalid container");var e,n=t.clientWidth,r=t.clientHeight,i=this.get("width")||n,o=this.get("height")||r;if(this.get("width")||this.get("height")||(this.set("width",n),this.set("height",r)),"svg"===this.get("renderer"))e=new Zc({container:t,width:i,height:o});else{var a={container:t,width:i,height:o},s=this.get("pixelRatio");s&&(a.pixelRatio=s),e=new Dl(a)}this.set("canvas",e)},e.prototype.initPlugins=function(){var t=this;(0,_.each)(t.get("plugins"),(function(e){!e.destroyed&&e.initPlugin&&e.initPlugin(t)}))},e.prototype.downloadImageWatermark=function(t,e,n,r){return(0,y.__awaiter)(this,void 0,void 0,(function(){var i,o,a;return(0,y.__generator)(this,(function(s){switch(s.label){case 0:return i=t.style.backgroundImage,o=i.slice(5,i.length-2),(a=new Image).src=o,[4,new Promise((function(t){a.onload=function(){var i=e.createPattern(a,"repeat");e.rect(0,0,n,r),e.fillStyle=i,e.fill(),t("")}}))];case 1:return s.sent(),[2]}}))}))},e.prototype.asyncToDataUrl=function(t,e,n,r,i,o){var a=this,s=document.querySelector(".g6-graph-watermarker"),u=this.get("canvas"),l=u.getRenderer(),c=o||u.get("el"),h="";t||(t="image/png"),setTimeout((function(){return(0,y.__awaiter)(a,void 0,void 0,(function(){var o,a,u,f,p,d,g,v,m,_;return(0,y.__generator)(this,(function(y){switch(y.label){case 0:return"svg"!==l?[3,1]:(o=c.cloneNode(!0),a=document.implementation.createDocumentType("svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),(u=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",a)).replaceChild(o,u.documentElement),f=(new XMLSerializer).serializeToString(u),h="data:image/svg+xml;charset=utf8,".concat(encodeURIComponent(f)),[3,4]);case 1:return p=void 0,d=c.getContext("2d"),g=r||this.get("width"),v=i||this.get("height"),m=void 0,s?[4,this.downloadImageWatermark(s,d,g,v)]:[3,3];case 2:y.sent(),y.label=3;case 3:if(e){_="undefined"!=typeof window?window.devicePixelRatio:1;try{p=d.getImageData(0,0,g*_,v*_),m=d.globalCompositeOperation,d.globalCompositeOperation="destination-over",d.fillStyle=e,d.fillRect(0,0,g,v)}catch(t){console.error("Download image failed. Out of memory at ImageData creation")}}h=c.toDataURL(t),e&&(d.clearRect(0,0,g,v),d.putImageData(p,0,0),d.globalCompositeOperation=m),y.label=4;case 4:return n&&n(h),[2]}}))}))}),16)},e.prototype.toDataURL=function(t,e){var n=this.get("canvas"),r=n.getRenderer(),i=n.get("el");t||(t="image/png");var o="";if("svg"===r){var a=i.cloneNode(!0),s=document.implementation.createDocumentType("svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),u=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",s);u.replaceChild(a,u.documentElement);var l=(new XMLSerializer).serializeToString(u);o="data:image/svg+xml;charset=utf8,".concat(encodeURIComponent(l))}else{var c=void 0,h=i.getContext("2d"),f=this.get("width"),p=this.get("height"),d=void 0;if(e){var g="undefined"!=typeof window?window.devicePixelRatio:1;try{c=h.getImageData(0,0,f*g,p*g),d=h.globalCompositeOperation,h.globalCompositeOperation="destination-over",h.fillStyle=e,h.fillRect(0,0,f,p)}catch(t){console.error("Download image failed. Out of memory at ImageData creation")}}o=i.toDataURL(t),e&&(h.clearRect(0,0,f,p),h.putImageData(c,0,0),h.globalCompositeOperation=d)}return o},e.prototype.toFullDataURL=function(t,e,n){var r=this.get("group").getCanvasBBox(),i=r.height,o=r.width,a=this.get("renderer"),s=RS('<id="virtual-image"></div>'),u=n?n.backgroundColor:void 0,l=n?n.padding:void 0;l?(0,_.isNumber)(l)&&(l=[l,l,l,l]):l=[0,0,0,0];var c=i+l[0]+l[2],h=o+l[1]+l[3],f={container:s,height:c,width:h,quickHit:!0},p="svg"===a?new Zc(f):new Dl(f),d=this.get("group").clone(),g=(0,_.clone)(d.getMatrix());g||(g=[1,0,0,0,1,0,0,0,1]);var v=(r.maxX+r.minX)/2,m=(r.maxY+r.minY)/2;g=LS(g,[["t",-v,-m],["t",o/2+l[3],i/2+l[0]]]),d.resetMatrix(),d.setMatrix(g),p.add(d);var y=p.get("el"),b="";e||(e="image/png"),setTimeout((function(){if("svg"===a){var n=y.cloneNode(!0),r=document.implementation.createDocumentType("svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),i=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",r);i.replaceChild(n,i.documentElement);var o=(new XMLSerializer).serializeToString(i);b="data:image/svg+xml;charset=utf8,".concat(encodeURIComponent(o))}else{var s=void 0,l=y.getContext("2d"),f=void 0;if(u){var p="undefined"!=typeof window?window.devicePixelRatio:1;try{s=l.getImageData(0,0,h*p,c*p),f=l.globalCompositeOperation,l.globalCompositeOperation="destination-over",l.fillStyle=u,l.fillRect(0,0,h,c)}catch(t){console.error("Download image failed. Out of memory at ImageData creation")}}b=y.toDataURL(e),u&&(l.clearRect(0,0,h,c),l.putImageData(s,0,0),l.globalCompositeOperation=f)}t&&t(b)}),16)},e.prototype.downloadFullImage=function(t,e,n){var r=this,i=this.get("group").getCanvasBBox(),o=i.height,a=i.width,s=this.get("renderer"),u=RS('<id="virtual-image"></div>'),l=document.querySelector(".g6-graph-watermarker"),c=n?n.backgroundColor:void 0,h=n?n.padding:void 0;h?(0,_.isNumber)(h)&&(h=[h,h,h,h]):h=[0,0,0,0];var f=o+h[0]+h[2],p=a+h[1]+h[3];if(l){var d=this.get("graphWaterMarker").cfg||{},g=d.width,v=d.height;f=Math.ceil(f/v)*v,p=Math.ceil(p/g)*g}var m={container:u,height:f,width:p},y="svg"===s?new Zc(m):new Dl(m),b=this.get("group").clone(),x=(0,_.clone)(b.getMatrix());x||(x=[1,0,0,0,1,0,0,0,1]);var w=(i.maxX+i.minX)/2,E=(i.maxY+i.minY)/2;x=LS(x,[["t",-w,-E],["t",a/2+h[3],o/2+h[0]]]),b.resetMatrix(),b.setMatrix(x),y.add(b);var S=y.get("el");e||(e="image/png"),this.asyncToDataUrl(e,c,(function(n){var i=document.createElement("a"),o=(t||"graph")+("svg"===s?".svg":".".concat(e.split("/")[1]));r.dataURLToImage(n,s,i,o);var a=document.createEvent("MouseEvents");a.initEvent("click",!1,!1),i.dispatchEvent(a)}),p,f,S)},e.prototype.downloadImage=function(t,e,n){var r=this,i=this;i.isAnimating()&&i.stopAnimate();var o=i.get("canvas").getRenderer();e||(e="image/png");var a=(t||"graph")+("svg"===o?".svg":e.split("/")[1]),s=document.createElement("a");i.asyncToDataUrl(e,n,(function(t){r.dataURLToImage(t,o,s,a);var e=document.createEvent("MouseEvents");e.initEvent("click",!1,!1),s.dispatchEvent(e)}))},e.prototype.dataURLToImage=function(t,e,n,r){if(t&&"data:"!==t){if("undefined"!=typeof window)if(window.Blob&&window.URL&&"svg"!==e){var i=t.split(","),o="";if(i&&i.length>0){var a=i[0].match(/:(.*?);/);a&&a.length>=2&&(o=a[1])}for(var s=atob(i[1]),u=s.length,l=new Uint8Array(u);u--;)l[u]=s.charCodeAt(u);var c=new Blob([l],{type:o});window.navigator.msSaveBlob?window.navigator.msSaveBlob(c,r):n.addEventListener("click",(function(){n.download=r,n.href=window.URL.createObjectURL(c)}))}else n.addEventListener("click",(function(){n.download=r,n.href=t}))}else console.error("Download image failed. The graph is too large or there is invalid attribute values in graph items")},e.prototype.addPlugin=function(t){t.destroyed||(this.get("plugins").push(t),t.initPlugin(this))},e.prototype.removePlugin=function(t){var e=this.get("plugins"),n=e.indexOf(t);n>=0&&(t.destroyPlugin(),e.splice(n,1))},e.prototype.setImageWaterMarker=function(t,e){void 0===t&&(t=ih.waterMarkerImage);var n=this.get("container");(0,_.isString)(n)&&(n=document.getElementById(n)),n.style.position||(n.style.position="relative");var r=this.get("graphWaterMarker"),i=(0,_.deepMix)({},ih.imageWaterMarkerConfig,e),o=i.width,a=i.height,s=i.compatible,u=i.image;if(!r){var l={container:n,width:o,height:a,capture:!1},c=this.get("pixelRatio");c&&(l.pixelRatio=c),r=new Dl(l),this.set("graphWaterMarker",r)}r.get("el").style.display="none";var h=r.get("context"),f=u.rotate,p=u.x,d=u.y;h.rotate(-f*Math.PI/180);var g=new Image;g.crossOrigin="anonymous",g.src=t,g.onload=function(){if(h.drawImage(g,p,d,u.width,u.height),h.rotate(f*Math.PI/180),s)n.style.cssText="background-image: url(".concat(r.get("el").toDataURL("image/png"),");background-repeat:repeat;");else{var t=document.querySelector(".g6-graph-watermarker");t||((t=document.createElement("div")).className="g6-graph-watermarker"),t.className="g6-graph-watermarker",r.destroyed||(t.style.cssText="background-image: url(".concat(r.get("el").toDataURL("image/png"),");background-repeat:repeat;position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;z-index:-1;"),n.appendChild(t))}}},e.prototype.setTextWaterMarker=function(t,e){var n=this.get("container");(0,_.isString)(n)&&(n=document.getElementById(n)),n.style.position||(n.style.position="relative");var r=this.get("graphWaterMarker"),i=(0,_.deepMix)({},ih.textWaterMarkerConfig,e),o=i.width,a=i.height,s=i.compatible,u=i.text;if(!r){var l={container:n,width:o,height:a,capture:!1},c=this.get("pixelRatio");c&&(l.pixelRatio=c),r=new Dl(l),this.set("graphWaterMarker",r)}r.get("el").style.display="none";var h=r.get("context"),f=u.rotate,p=u.fill,d=u.fontFamily,g=u.fontSize,v=u.baseline,m=u.x,y=u.y,b=u.lineHeight;h.rotate(-f*Math.PI/180),h.font="".concat(g,"px ").concat(d),h.fillStyle=p,h.textBaseline=v;for(var x=t.length-1;x>=0;x--)h.fillText(t[x],m,y+x*b);if(h.rotate(f*Math.PI/180),s)n.style.cssText="background-image: url(".concat(r.get("el").toDataURL("image/png"),");background-repeat:repeat;");else{var w=document.querySelector(".g6-graph-watermarker");w||((w=document.createElement("div")).className="g6-graph-watermarker"),w.style.cssText="background-image: url(".concat(r.get("el").toDataURL("image/png"),");background-repeat:repeat;position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;z-index:99;"),n.appendChild(w)}},e.prototype.destroy=function(){var e,n,r,i;(0,_.each)(this.get("plugins"),(function(t){t.destroyPlugin()}));var o=this.get("tooltips");if(o)for(var a=0;a<o.length;a++){var s=o[a];if(s){var u=s.parentElement;u&&u.removeChild(s)}}null===(e=this.get("eventController"))||void 0===e||e.destroy(),null===(n=this.get("layoutController"))||void 0===n||n.destroy(),null===(r=this.get("graphWaterMarker"))||void 0===r||r.destroy(),null===(i=document.querySelector(".g6-graph-watermarker"))||void 0===i||i.remove(),t.prototype.destroy.call(this)},e}(Fs);const NS=DS;var BS=dS.radialLayout,zS=dS.traverseTree,FS=function(t){function e(e){var n=t.call(this,e)||this;return n.layoutAnimating=!1,n.set("removeList",[]),n.set("layoutMethod",n.getLayout()),n}return(0,y.__extends)(e,t),e.prototype.getLayout=function(){var t=this.get("layout");return t?"function"==typeof t?t:(t.type||(t.type="dendrogram"),t.direction||(t.direction="TB"),t.radial?function(e){var n=iS()[t.type](e,t);return BS(n),n}:function(e){return iS()[t.type](e,t)}):null},e.indexOfChild=function(t,e){var n=-1;return(0,_.each)(t,(function(t,r){if(e===t.id)return n=r,!1})),n},e.prototype.getDefaultCfg=function(){var e=t.prototype.getDefaultCfg.call(this);return e.animate=!0,e},e.prototype.innerAddChild=function(t,e,n){var r=this,i=t.data;i&&(i.x=t.x,i.y=t.y,i.depth=t.depth);var o=r.addItem("node",i,!1);if(e){if(o.set("parent",e),n){var a=e.get("originAttrs");if(a)o.set("originAttrs",a);else{var s=e.getModel();o.set("originAttrs",{x:s.x,y:s.y})}}var u=e.get("children");u?u.push(o):e.set("children",[o]),r.addItem("edge",{source:e.get("id"),target:o.get("id"),id:"".concat(e.get("id"),":").concat(o.get("id"))},!1)}return(0,_.each)(t.children||[],(function(t){r.innerAddChild(t,o,n)})),r.emit("afteraddchild",{item:o,parent:e}),o},e.prototype.innerUpdateChild=function(t,n,r){var i=this,o=i.findById(t.id);if(o){(0,_.each)(t.children||[],(function(t){i.innerUpdateChild(t,o,r)}));var a,s,u=o.get("children");if(u&&u.length>0)for(var l=u.length-1;l>=0;l--){var c=u[l].getModel();-1===e.indexOfChild(t.children||[],c.id)&&(i.innerRemoveChild(c.id,{x:t.x,y:t.y},r),u.splice(l,1))}o.get("originAttrs")&&(a=o.get("originAttrs").x,s=o.get("originAttrs").y);var h=o.getModel();r&&o.set("originAttrs",{x:h.x,y:h.y}),o.set("model",t.data),a===t.x&&s===t.y||o.updatePosition({x:t.x,y:t.y})}else i.innerAddChild(t,n,r)},e.prototype.innerRemoveChild=function(t,e,n){var r=this,i=r.findById(t);if(i)if((0,_.each)(i.get("children"),(function(t){r.innerRemoveChild(t.getModel().id,e,n)})),n){var o=i.getModel();i.set("to",e),i.set("originAttrs",{x:o.x,y:o.y}),r.get("removeList").push(i)}else r.removeItem(i,!1)},e.prototype.changeData=function(t){var e=this;this.getNodes().map((function(t){return e.clearItemStates(t)})),this.getEdges().map((function(t){return e.clearItemStates(t)})),t?(e.data(t),e.render()):e.layout(this.get("fitView"))},e.prototype.changeLayout=function(t){console.warn("Please call updateLayout instead of changeLayout. changeLayout will be discarded soon"),this.updateLayout(t)},e.prototype.updateLayout=function(t){var e=this;t?(e.set("layout",t),e.set("layoutMethod",e.getLayout()),e.layout()):console.warn("layout cannot be null")},e.prototype.refreshLayout=function(t){console.warn("Please call layout instead of refreshLayout. refreshLayout will be discarded soon"),this.layout(t)},e.prototype.layout=function(t){var e=this,n=e.get("data"),r=e.get("layoutMethod"),i=r?r(n,e.get("layout")):n,o=e.get("animate");e.emit("beforerefreshlayout",{data:n,layoutData:i}),e.emit("beforelayout"),e.innerUpdateChild(i,void 0,o),t&&e.get("viewController").fitView(),o?e.layoutAnimate(i):(e.refresh(),e.paint()),e.emit("afterrefreshlayout",{data:n,layoutData:i}),e.emit("afterlayout")},e.prototype.addChild=function(t,e){var n=this;n.emit("beforeaddchild",{model:t,parent:e}),(0,_.isString)(e)||(e=e.get("id"));var r=n.findDataById(e);r&&(r.children||(r.children=[]),r.children.push(t),n.changeData())},e.prototype.updateChildren=function(t,e){var n=this;e&&n.findById(e)?(n.findDataById(e).children=t,n.changeData()):console.warn("Update children failed! There is no node with id '".concat(e,"'"))},e.prototype.updateChild=function(t,n){var r=this;if(n&&r.findById(n)){var i=r.findDataById(n),o=r.findById(t.id);if(i.children||(i.children=[]),o){var a=e.indexOfChild(i.children,t.id);i.children[a]=t}else i.children.push(t);r.changeData()}else r.changeData(t)},e.prototype.removeChild=function(t){var n=this,r=n.findById(t);if(r){var i=r.get("parent");if(i&&!i.destroyed){var o=n.findDataById(i.get("id")),a=o&&o.children||[],s=r.getModel(),u=e.indexOfChild(a,s.id);a.splice(u,1)}n.changeData()}},e.prototype.findDataById=function(t,e){var n=this;if(e||(e=n.get("data")),t===e.id)return e;var r=null;return(0,_.each)(e.children||[],(function(e){return e.id===t?(r=e,!1):!(r=n.findDataById(t,e))&&void 0})),r},e.prototype.layoutAnimate=function(t,e){var n=this,r=this.get("animateCfg");n.emit("beforeanimate",{data:t}),n.getEdges().forEach((function(t){var e=t.get("model");e.sourceAnchor||(e.sourceAnchor=t.get("sourceAnchorIndex"))})),this.get("canvas").animate((function(r){zS(t,(function(i){var o=n.findById(i.id);if(o){var a=o.get("originAttrs"),s=o.get("model");if(a||(a={x:s.x,y:s.y},o.set("originAttrs",a)),e){var u=e(o,r,a,t);o.set("model",Object.assign(s,u))}else s.x=a.x+(i.x-a.x)*r,s.y=a.y+(i.y-a.y)*r}return!0})),(0,_.each)(n.get("removeList"),(function(t){var e=t.getModel(),n=t.get("originAttrs"),i=t.get("to");e.x=n.x+(i.x-n.x)*r,e.y=n.y+(i.y-n.y)*r})),n.refreshPositions()}),{duration:r.duration,easing:r.ease,callback:function(){(0,_.each)(n.getNodes(),(function(t){t.set("originAttrs",null)})),(0,_.each)(n.get("removeList"),(function(t){n.removeItem(t)})),n.set("removeList",[]),r.callback&&r.callback(),n.emit("afteranimate",{data:t})},delay:r.delay})},e.prototype.stopLayoutAnimate=function(){this.get("canvas").stopAnimate(),this.emit("layoutanimateend",{data:this.get("data")}),this.layoutAnimating=!1},e.prototype.isLayoutAnimating=function(){return this.layoutAnimating},e.prototype.render=function(){var t=this,e=t.get("data");if(!e||!(0,_.isObject)(e)||!Object.keys(e).length)throw new Error("data must be defined first");t.clear(),t.emit("beforerender"),t.layout(this.get("fitView")),t.emit("afterrender")},e.prototype.save=function(){return this.get("data")},e}(NS);const ZS=FS;function jS(t,e){if(t)for(var n in e)e.hasOwnProperty(n)&&(t.style[n]=e[n]);return t}var US=function(){function t(t){this._cfgs=(0,_.deepMix)(this.getDefaultCfgs(),t),this._events={},this.destroyed=!1}return t.prototype.getDefaultCfgs=function(){return{}},t.prototype.initPlugin=function(t){var e=this;e.set("graph",t);var n=e.getEvents(),r={};(0,_.each)(n,(function(n,i){var o=(0,_.wrapBehavior)(e,n);r[i]=o,t.on(i,o)})),this._events=r,this.init()},t.prototype.getEvents=function(){return{}},t.prototype.get=function(t){var e;return null===(e=this._cfgs)||void 0===e?void 0:e[t]},t.prototype.set=function(t,e){this._cfgs[t]=e},t.prototype.destroy=function(){},t.prototype.destroyPlugin=function(){this.destroy();var t=this.get("graph"),e=this._events;(0,_.each)(e,(function(e,n){t.off(n,e)})),this._events=null,this._cfgs=null,this.destroyed=!0},t}();const GS=US;var VS,WS=(VS=function(t,e){return VS=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},VS(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}VS(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),HS="url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAwIDEwIEwgNDAgMTAgTSAxMCAwIEwgMTAgNDAgTSAwIDIwIEwgNDAgMjAgTSAyMCAwIEwgMjAgNDAgTSAwIDMwIEwgNDAgMzAgTSAzMCAwIEwgMzAgNDAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2UwZTBlMCIgb3BhY2l0eT0iMC4yIiBzdHJva2Utd2lkdGg9IjEiLz48cGF0aCBkPSJNIDQwIDAgTCAwIDAgMCA0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZTBlMGUwIiBzdHJva2Utd2lkdGg9IjEiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JpZCkiLz48L3N2Zz4=)",XS=function(t){function e(e){return t.call(this,e)||this}return WS(e,t),e.prototype.getDefaultCfgs=function(){return{img:HS,follow:!0}},e.prototype.init=function(){var t=this.get("graph"),e=t.get("container"),n=t.get("canvas").get("el"),r=this.get("img")||HS,i=RS("<div class='g6-grid-container' style=\"position:absolute;overflow:hidden;z-index: -1;\"></div>"),o=RS("<div\n        class='g6-grid'\n        style='position:absolute;\n        background-image: ".concat(r,";\n        user-select: none\n        '></div>"));this.set("container",i),this.set("gridContainer",o),this.positionInit(),i.appendChild(o),e.insertBefore(i,n)},e.prototype.positionInit=function(){var t=this.get("graph"),e=t.get("minZoom"),n=t.get("width"),r=t.get("height");jS(this.get("container"),{width:"".concat(n,"px"),height:"".concat(r,"px")});var i=80*n/e,o=80*r/e;jS(this.get("gridContainer"),{width:"".concat(i,"px"),height:"".concat(o,"px"),left:"-".concat(i/2,"px"),top:"-".concat(o/2,"px")})},e.prototype.getEvents=function(){return{viewportchange:"updateGrid"}},e.prototype.updateGrid=function(t){var e=this.get("gridContainer"),n=t.matrix;n||(n=[1,0,0,0,1,0,0,0,1]);var r=this.get("follow");jS(e,{transform:"matrix(".concat(n[0],", ").concat(n[1],", ").concat(n[3],", ").concat(n[4],", ").concat(r?n[6]:"0",", ").concat(r?n[7]:"0",")")})},e.prototype.getContainer=function(){return this.get("container")},e.prototype.destroy=function(){var t=this.get("graph").get("container"),e=this.get("container");t.removeChild(e)},e}(GS);const YS=XS;var qS=n(8186),KS=n.n(qS),QS=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();"undefined"!=typeof document&&KS()("\n  .g6-component-contextmenu {\n    border: 1px solid #e2e2e2;\n    border-radius: 4px;\n    font-size: 12px;\n    color: #545454;\n    background-color: rgba(255, 255, 255, 0.9);\n    padding: 10px 8px;\n    box-shadow: rgb(174, 174, 174) 0px 0px 10px;\n  }\n  .g6-contextmenu-ul {\n    padding: 0;\n    margin: 0;\n    list-style: none;\n  }\n\n");var JS=function(t){function e(e){return t.call(this,e)||this}return QS(e,t),e.prototype.getDefaultCfgs=function(){return{offsetX:6,offsetY:6,handleMenuClick:void 0,getContent:function(t){return"\n          <ul class='g6-contextmenu-ul'>\n            <li>菜单项1</li>\n            <li>菜单项2</li>\n          </ul>\n        "},shouldBegin:function(t){return!0},onHide:function(){return!0},itemTypes:["node","edge","combo"],trigger:"contextmenu"}},e.prototype.getEvents=function(){return"click"===this.get("trigger")?{click:"onMenuShow"}:{contextmenu:"onMenuShow"}},e.prototype.init=function(){var t=this.get("className"),e=RS("<div class=".concat(t||"g6-component-contextmenu","></div>"));jS(e,{top:"0px",position:"absolute",visibility:"hidden"});var n=this.get("container");n||(n=this.get("graph").get("container")),(0,_.isString)(n)&&(n=document.getElementById(n)),n.appendChild(e),this.set("menu",e)},e.prototype.onMenuShow=function(t){var e=this;t.preventDefault();var n=this.get("itemTypes");if(t.item){if(t.item&&t.item.getType&&-1===n.indexOf(t.item.getType()))return void e.onMenuHide()}else if(-1===n.indexOf("canvas"))return void e.onMenuHide();if(this.get("shouldBegin")(t)){var r=this.get("menu"),i=this.get("getContent"),o=this.get("graph"),a=i(t,o);(0,_.isString)(a)?r.innerHTML=a:r.innerHTML=a.outerHTML,this.removeMenuEventListener();var s=this.get("handleMenuClick");if(s){var u=function(e){s(e.target,t.item,o)};this.set("handleMenuClickWrapper",u),r.addEventListener("click",u)}var l=o.get("width"),c=o.get("height"),h=r.getBoundingClientRect(),f=this.get("offsetX")||0,p=this.get("offsetY")||0,d=o.getContainer().offsetTop,g=o.getContainer().offsetLeft,v=t.canvasX+g+f,m=t.canvasY+d+p;v+h.width>l&&(v=t.canvasX-h.width-f+g),m+h.height>c&&(m=t.canvasY-h.height-p+d),jS(r,{top:"".concat(m,"px"),left:"".concat(v,"px"),visibility:"visible"});var y="click"===this.get("trigger"),b=function(t){y?y=!1:e.onMenuHide()};document.body.addEventListener("click",b),this.set("handler",b)}},e.prototype.removeMenuEventListener=function(){var t=this.get("handleMenuClickWrapper"),e=this.get("handler");t&&(this.get("menu").removeEventListener("click",t),this.set("handleMenuClickWrapper",null)),e&&document.body.removeEventListener("click",e)},e.prototype.onMenuHide=function(){var t=this.get("menu");t&&jS(t,{visibility:"hidden"}),this.removeMenuEventListener()},e.prototype.destroy=function(){var t=this.get("menu");if(this.removeMenuEventListener(),t){var e=this.get("container");e||(e=this.get("graph").get("container")),(0,_.isString)(e)&&(e=document.getElementById(e)),e.removeChild(t)}},e}(GS);const $S=JS;var tC=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),eC=function(){return eC=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},eC.apply(this,arguments)},nC=Math.max,rC=ut,iC=function(t){function e(e){var n=t.call(this,e)||this;return n.handleUpdateCanvas=(0,_.debounce)((function(t){var e=n;e.destroyed||e.updateCanvas()}),100,!1),n}return tC(e,t),e.prototype.getDefaultCfgs=function(){return{container:null,className:"g6-minimap",viewportClassName:"g6-minimap-viewport",type:"default",padding:50,size:[200,120],delegateStyle:{fill:"#40a9ff",stroke:"#096dd9"},refresh:!0}},e.prototype.getEvents=function(){return{beforepaint:"updateViewport",beforeanimate:"disableRefresh",afteranimate:"enableRefresh",viewportchange:"disableOneRefresh"}},e.prototype.disableRefresh=function(){this.set("refresh",!1)},e.prototype.enableRefresh=function(){this.set("refresh",!0),this.updateCanvas()},e.prototype.disableOneRefresh=function(){this.set("viewportChange",!0)},e.prototype.initViewport=function(){var t=this,e=this._cfgs,n=e.size,r=e.graph;if(!this.destroyed){var i=this.get("canvas").get("container"),o=RS("\n      <div\n        class=".concat(e.viewportClassName,"\n        style='position:absolute;\n          left:0;\n          top:0;\n          box-sizing:border-box;\n          outline: 2px solid #1980ff'\n        draggable=true>\n      </div>")),a=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,s=0,u=0,l=!1,c=0,h=0,f=0,p=0,d=0,g=0;o.addEventListener("dragstart",(function(i){var a,v;if(i.dataTransfer){var m=new Image;m.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' %3E%3Cpath /%3E%3C/svg%3E",null===(v=(a=i.dataTransfer).setDragImage)||void 0===v||v.call(a,m,0,0);try{i.dataTransfer.setData("text/html","view-port-minimap")}catch(t){i.dataTransfer.setData("text","view-port-minimap")}}if(e.refresh=!1,i.target===o){var y=o.style;c=parseInt(y.left,10),h=parseInt(y.top,10),f=parseInt(y.width,10),p=parseInt(y.height,10),f>n[0]||p>n[1]||(g=r.getZoom(),d=t.get("ratio"),l=!0,s=i.clientX,u=i.clientY)}}),!1),o.addEventListener(a?"dragover":"drag",(function(t){if(l&&!(0,_.isNil)(t.clientX)&&!(0,_.isNil)(t.clientY)){var e=s-t.clientX,i=u-t.clientY;(c-e<0||c-e+f>=n[0])&&(e=0),(h-i<0||h-i+p>=n[1])&&(i=0),h-=i,jS(o,{left:"".concat(c-=e,"px"),top:"".concat(h,"px")}),r.translate(e*g/d,i*g/d),s=t.clientX,u=t.clientY}}),!1),o.addEventListener("dragend",(function(){l=!1,e.refresh=!0}),!1),this.set("viewport",o),i.appendChild(o)}},e.prototype.updateViewport=function(){if(!this.destroyed){var t=this.get("ratio"),e=(this.get("dx"),this.get("dy"),this.get("totaldx")),n=this.get("totaldy"),r=this.get("graph"),i=this.get("size"),o=r.get("width"),a=r.get("height"),s=r.getPointByCanvas(0,0),u=r.getPointByCanvas(o,a),l=this.get("viewport");l||this.initViewport();var c=(u.x-s.x)*t,h=(u.y-s.y)*t,f=s.x*t+e,p=s.y*t+n,d=f+c,g=p+h;f<0&&(c+=f,f=0),d>i[0]&&(c-=d-i[0]),p<0&&(h+=p,p=0),g>i[1]&&(h-=g-i[1]),this.set("ratio",t),jS(l,{left:"".concat(f,"px"),top:"".concat(p,"px"),width:"".concat(c,"px"),height:"".concat(h,"px")})}},e.prototype.updateGraphShapes=function(){var t=this._cfgs.graph,e=this.get("canvas"),n=t.get("group");if(!n.destroyed){var r=n.clone();r.resetMatrix(),e.clear(),e.add(r),"svg"===t.get("renderer")&&this.updateVisible(r)}},e.prototype.updateVisible=function(t){var e=this;if(t.isGroup()||t.get("visible")){var n=t.get("children");if(!n||!n.length)return;n.forEach((function(t){t.get("visible")||t.hide(),e.updateVisible(t)}))}else t.hide()},e.prototype.updateKeyShapes=function(){var t=this,e=this._cfgs.graph,n=this.get("canvas"),r=n.get("children")[0]||n.addGroup();(0,_.each)(e.getEdges(),(function(e){t.updateOneEdgeKeyShape(e,r)})),(0,_.each)(e.getNodes(),(function(e){t.updateOneNodeKeyShape(e,r)}));var i=e.getCombos();if(i&&i.length){var o=r.find((function(t){return"comboGroup"===t.get("name")}))||r.addGroup({name:"comboGroup"});setTimeout((function(){t.destroyed||((0,_.each)(i,(function(e){t.updateOneComboKeyShape(e,o)})),null==o||o.sort(),null==o||o.toBack(),t.updateCanvas())}),250)}this.clearDestroyedShapes()},e.prototype.updateOneComboKeyShape=function(t,e){if(!this.destroyed){var n=this.get("itemMap")||{},r=n[t.get("id")],i=t.getBBox(),o=t.get("keyShape").clone(),a=o.attr(),s={x:i.centerX,y:i.centerY};r?s=Object.assign(a,s):(r=o,e.add(r));var u=r.get("type");"rect"!==u&&"image"!==u||(s.x=i.minX,s.y=i.minY),r.attr(s),t.isVisible()?r.show():r.hide(),r.exist=!0;var l=t.getModel().depth;isNaN(l)||r.set("zIndex",l),n[t.get("id")]=r,this.set("itemMap",n)}},e.prototype.updateOneNodeKeyShape=function(t,e){var n=this.get("itemMap")||{},r=n[t.get("id")],i=t.getBBox(),o=t.get("keyShape").clone(),a=o.attr(),s={x:i.centerX,y:i.centerY};r?s=Object.assign(a,s):(r=o,e.add(r));var u=r.get("type");"rect"!==u&&"image"!==u||(s.x=i.minX,s.y=i.minY),r.attr(s),t.isVisible()?r.show():r.hide(),r.exist=!0;var l=t.getModel().depth;isNaN(l)||r.set("zIndex",l),n[t.get("id")]=r,this.set("itemMap",n)},e.prototype.updateDelegateShapes=function(){var t=this,e=this._cfgs.graph,n=this.get("canvas"),r=n.get("children")[0]||n.addGroup();(0,_.each)(e.getEdges(),(function(e){t.updateOneEdgeKeyShape(e,r)})),(0,_.each)(e.getNodes(),(function(e){t.updateOneNodeDelegateShape(e,r)}));var i=e.getCombos();if(i&&i.length){var o=r.find((function(t){return"comboGroup"===t.get("name")}))||r.addGroup({name:"comboGroup"});setTimeout((function(){t.destroyed||((0,_.each)(i,(function(e){t.updateOneComboKeyShape(e,o)})),null==o||o.sort(),null==o||o.toBack(),t.updateCanvas())}),250)}this.clearDestroyedShapes()},e.prototype.clearDestroyedShapes=function(){var t=this.get("itemMap")||{},e=Object.keys(t);if(e&&0!==e.length)for(var n=e.length-1;n>=0;n--){var r=t[e[n]],i=r.exist;r.exist=!1,i||(r.remove(),delete t[e[n]])}},e.prototype.updateOneEdgeKeyShape=function(t,e){var n=this.get("itemMap")||{},r=n[t.get("id")];if(r){var i=t.get("keyShape").attr("path");r.attr("path",i)}else r=t.get("keyShape").clone(),e.add(r);t.isVisible()?r.show():r.hide(),r.exist=!0,n[t.get("id")]=r,this.set("itemMap",n)},e.prototype.updateOneNodeDelegateShape=function(t,e){var n=this.get("delegateStyle"),r=this.get("itemMap")||{},i=r[t.get("id")],o=t.getBBox();if(i){var a={x:o.minX,y:o.minY,width:o.width,height:o.height};i.attr(a)}else i=e.addShape("rect",{attrs:eC({x:o.minX,y:o.minY,width:o.width,height:o.height},n),name:"minimap-node-shape"});t.isVisible()?i.show():i.hide(),i.exist=!0,r[t.get("id")]=i,this.set("itemMap",r)},e.prototype.init=function(){this.initContainer(),this.get("graph").on("afterupdateitem",this.handleUpdateCanvas),this.get("graph").on("afteritemstatechange",this.handleUpdateCanvas),this.get("graph").on("afteradditem",this.handleUpdateCanvas),this.get("graph").on("afterremoveitem",this.handleUpdateCanvas),this.get("graph").on("afterrender",this.handleUpdateCanvas),this.get("graph").on("afterlayout",this.handleUpdateCanvas)},e.prototype.initContainer=function(){var t=this,e=t.get("graph"),n=t.get("size"),r=t.get("className"),i=t.get("container"),o=RS("<div class='".concat(r,"' style='width: ").concat(n[0],"px; height: ").concat(n[1],"px; overflow: hidden'></div>"));(0,_.isString)(i)&&(i=document.getElementById(i)),i?i.appendChild(o):e.get("container").appendChild(o),t.set("container",o);var a,s=RS('<div class="g6-minimap-container" style="position: relative;"></div>');o.appendChild(s),s.addEventListener("dragenter",(function(t){t.preventDefault()})),s.addEventListener("dragover",(function(t){t.preventDefault()})),a="svg"===e.get("renderer")?new Zc({container:s,width:n[0],height:n[1]}):new Dl({container:s,width:n[0],height:n[1]}),t.set("canvas",a),t.updateCanvas()},e.prototype.updateCanvas=function(){if(!this.destroyed&&this.get("refresh")){var t=this.get("graph");if(!t.get("destroyed")){this.get("viewportChange")&&(this.set("viewportChange",!1),this.updateViewport());var e=this.get("size"),n=this.get("canvas"),r=this.get("type"),i=this.get("padding");if(!n.destroyed){switch(r){case"default":this.updateGraphShapes();break;case"keyShape":this.updateKeyShapes();break;case"delegate":this.updateDelegateShapes()}var o=n.get("children")[0];if(o){o.resetMatrix();var a=o.getCanvasBBox(),s=t.get("canvas").getCanvasBBox(),u=t.getZoom()||1,l=s.width/u,c=s.height/u;Number.isFinite(a.width)&&(l=nC(a.width,l),c=nC(a.height,c)),l+=2*i,c+=2*i;var h=Math.min(e[0]/l,e[1]/c),f=[1,0,0,0,1,0,0,0,1],p=0,d=0;Number.isFinite(a.minX)&&(p=-a.minX),Number.isFinite(a.minY)&&(d=-a.minY);var g=(e[0]-(l-2*i)*h)/2,v=(e[1]-(c-2*i)*h)/2;f=rC(f,[["t",p,d],["s",h,h],["t",g,v]]),o.setMatrix(f),this.set("ratio",h),this.set("totaldx",g+p*h),this.set("totaldy",v+d*h),this.set("dx",g),this.set("dy",v),this.updateViewport()}}}}},e.prototype.getCanvas=function(){return this.get("canvas")},e.prototype.getViewport=function(){return this.get("viewport")},e.prototype.getContainer=function(){return this.get("container")},e.prototype.destroy=function(){this.get("canvas").destroy();var t=this.get("container");t.parentNode.removeChild(t)},e}(GS);const oC=iC;var aC=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function sC(t,e,n){var r=t.x-e.x,i=t.y-e.y;return!n||Math.abs(r)>n||Math.abs(i)>n?Math.sqrt(r*r+i*i):n}function uC(t,e){var n=(e.source.y-e.target.y)/(e.source.x-e.target.x),r=(n*n*e.source.x+n*(t.y-e.source.y)+t.x)/(n*n+1);return{x:r,y:n*(r-e.source.x)+e.source.y}}var lC=function(t){function e(e){return t.call(this,e)||this}return aC(e,t),e.prototype.getDefaultCfgs=function(){return{edgeBundles:[],edgePoints:[],K:.1,lambda:.1,divisions:1,divRate:2,cycles:6,iterations:90,iterRate:.6666667,bundleThreshold:.6,eps:1e-6,onLayoutEnd:function(){},onTick:function(){}}},e.prototype.init=function(){var t=this.get("graph"),e=this.get("onTick");this.set("tick",(function(){e&&e(),t.refreshPositions()}))},e.prototype.bundling=function(t){var e=this;if(e.set("data",t),!e.isTicking()){var n=t.edges||[],r=t.nodes||[],i={},o=!1;if(r.forEach((function(t){null!==t.x&&null!==!t.y&&void 0!==t.x&&void 0!==!t.y||(o=!0),i[t.id]=t})),o)throw new Error("please layout the graph or assign x and y for nodes first");e.set("nodeIdMap",i);var a=e.get("divisions"),s=e.get("divRate"),u=e.divideEdges(a);e.set("edgePoints",u);var l=e.getEdgeBundles();e.set("edgeBundles",l);for(var c=e.get("cycles"),h=e.get("iterations"),f=e.get("iterRate"),p=e.get("lambda"),d=0;d<c;d++){for(var g=function(t){var r=[];n.forEach((function(t,n){if(t.source!==t.target){var o=i[t.source],s=i[t.target];r[n]=e.getEdgeForces({source:o,target:s},n,a,p);for(var l=0;l<a+1;l++)u[n][l].x+=r[n][l].x,u[n][l].y+=r[n][l].y}}))},v=0;v<h;v++)g();p/=2,a*=s,h*=f,u=e.divideEdges(a),e.set("edgePoints",u)}n.forEach((function(t,e){t.source!==t.target&&(t.type="polyline",t.controlPoints=u[e].slice(1,u[e].length-1))})),e.get("graph").refresh()}},e.prototype.updateBundling=function(t){var e=this,n=t.data;if(n&&e.set("data",n),e.get("ticking")&&e.set("ticking",!1),Object.keys(t).forEach((function(n){e.set(n,t[n])})),t.onTick){var r=this.get("graph");e.set("tick",(function(){t.onTick(),r.refresh()}))}e.bundling(n)},e.prototype.divideEdges=function(t){var e=this,n=e.get("data").edges,r=e.get("nodeIdMap"),i=e.get("edgePoints");return i&&void 0!==i||(i=[]),n.forEach((function(n,o){i[o]&&void 0!==i[o]||(i[o]=[]);var a=r[n.source],s=r[n.target];if(1===t)i[o].push({x:a.x,y:a.y}),i[o].push({x:.5*(a.x+s.x),y:.5*(a.y+s.y)}),i[o].push({x:s.x,y:s.y});else{var u=(i[o]&&i[o]!==[]?e.getEdgeLength(i[o]):sC({x:a.x,y:a.y},{x:s.x,y:s.y}))/(t+1),l=u,c=[{x:a.x,y:a.y}];i[o].forEach((function(t,e){if(0!==e){for(var n=sC(t,i[o][e-1]);n>l;){var r=l/n,a={x:i[o][e-1].x,y:i[o][e-1].y};a.x+=r*(t.x-i[o][e-1].x),a.y+=r*(t.y-i[o][e-1].y),c.push(a),n-=l,l=u}l-=n}})),c.push({x:s.x,y:s.y}),i[o]=c}})),i},e.prototype.getEdgeLength=function(t){var e=0;return t.forEach((function(n,r){0!==r&&(e+=sC(n,t[r-1]))})),e},e.prototype.getEdgeBundles=function(){var t=this,e=t.get("data").edges||[],n=t.get("bundleThreshold"),r=t.get("nodeIdMap"),i=t.get("edgeBundles");return i||(i=[]),e.forEach((function(t,e){i[e]&&void 0!==i[e]||(i[e]=[])})),e.forEach((function(o,a){var s=r[o.source],u=r[o.target];e.forEach((function(e,o){if(!(o<=a)){var l=r[e.source],c=r[e.target];t.getBundleScore({source:s,target:u},{source:l,target:c})>=n&&(i[a].push(o),i[o].push(a))}}))})),i},e.prototype.getBundleScore=function(t,e){var n=this;return t.vx=t.target.x-t.source.x,t.vy=t.target.y-t.source.y,e.vx=e.target.x-e.source.x,e.vy=e.target.y-e.source.y,t.length=sC({x:t.source.x,y:t.source.y},{x:t.target.x,y:t.target.y}),e.length=sC({x:e.source.x,y:e.source.y},{x:e.target.x,y:e.target.y}),n.getAngleScore(t,e)*n.getScaleScore(t,e)*n.getPositionScore(t,e)*n.getVisibilityScore(t,e)},e.prototype.getAngleScore=function(t,e){var n=function(t,e){return t.x*e.x+t.y*e.y}({x:t.vx,y:t.vy},{x:e.vx,y:e.vy});return n/(t.length*e.length)},e.prototype.getScaleScore=function(t,e){var n=(t.length+e.length)/2;return 2/(n/Math.min(t.length,e.length)+Math.max(t.length,e.length)/n)},e.prototype.getPositionScore=function(t,e){var n=(t.length+e.length)/2;return n/(n+sC({x:(t.source.x+t.target.x)/2,y:(t.source.y+t.target.y)/2},{x:(e.source.x+e.target.x)/2,y:(e.source.y+e.target.y)/2}))},e.prototype.getVisibilityScore=function(t,e){var n=this.getEdgeVisibility(t,e),r=this.getEdgeVisibility(e,t);return n<r?n:r},e.prototype.getEdgeVisibility=function(t,e){var n=uC(e.source,t),r=uC(e.target,t),i={x:(n.x+r.x)/2,y:(n.y+r.y)/2},o={x:(t.source.x+t.target.x)/2,y:(t.source.y+t.target.y)/2};return Math.max(0,1-2*sC(i,o)/sC(n,r))},e.prototype.getEdgeForces=function(t,e,n,r){for(var i=this,o=i.get("edgePoints"),a=i.get("K")/(sC(t.source,t.target)*(n+1)),s=[{x:0,y:0}],u=1;u<n;u++){var l={x:0,y:0},c=i.getSpringForce({pre:o[e][u-1],cur:o[e][u],next:o[e][u+1]},a),h=i.getElectrostaticForce(u,e);l.x=r*(c.x+h.x),l.y=r*(c.y+h.y),s.push(l)}return s.push({x:0,y:0}),s},e.prototype.getSpringForce=function(t,e){var n=t.pre.x+t.next.x-2*t.cur.x,r=t.pre.y+t.next.y-2*t.cur.y;return{x:n*=e,y:r*=e}},e.prototype.getElectrostaticForce=function(t,e){var n=this,r=n.get("eps"),i=n.get("edgeBundles"),o=n.get("edgePoints"),a=i[e],s={x:0,y:0};return a.forEach((function(n){var i={x:o[n][t].x-o[e][t].x,y:o[n][t].y-o[e][t].y};if(Math.abs(i.x)>r||Math.abs(i.y)>r){var a=1/sC(o[n][t],o[e][t]);s.x+=i.x*a,s.y+=i.y*a}})),s},e.prototype.isTicking=function(){return this.get("ticking")},e.prototype.getSimulation=function(){return this.get("forceSimulation")},e.prototype.destroy=function(){this.get("ticking")&&this.getSimulation().stop(),t.prototype.destroy.call(this)},e}(GS);const cC=lC;var hC=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),fC=function(){return fC=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},fC.apply(this,arguments)},pC={stroke:"#000",strokeOpacity:.8,lineWidth:2,fillOpacity:.1,fill:"#ccc"},dC=function(t){function e(e){return t.call(this,e)||this}return hC(e,t),e.prototype.getDefaultCfgs=function(){return{trigger:"mousemove",d:1.5,r:300,delegateStyle:(0,_.clone)(pC),showLabel:!1,maxD:5,minD:0,scaleRBy:"unset",scaleDBy:"unset",showDPercent:!0}},e.prototype.getEvents=function(){var t;switch(this.get("trigger")){case"click":t={click:"magnify"};break;case"drag":t={click:"createDelegate"};break;default:t={mousemove:"magnify"}}return t},e.prototype.init=function(){var t=this,e=t.get("r");t.set("cachedMagnifiedModels",[]),t.set("cachedOriginPositions",{}),t.set("r2",e*e);var n=t.get("d");t.set("molecularParam",(n+1)*e)},e.prototype.createDelegate=function(t){var e=this,n=this,r=n.get("delegate");r&&!r.destroyed||(n.magnify(t),(r=n.get("delegate")).on("dragstart",(function(t){n.set("delegateCenterDiff",{x:r.attr("x")-t.x,y:r.attr("y")-t.y})})),r.on("drag",(function(t){n.magnify(t)})),"wheel"===this.get("scaleDBy")&&r.on("mousewheel",(function(t){e.scaleDByWheel(t)})),"wheel"===this.get("scaleRBy")&&r.on("mousewheel",(function(t){n.scaleRByWheel(t)})))},e.prototype.scaleRByWheel=function(t){var e=this;if(t&&t.originalEvent){t.preventDefault&&t.preventDefault();var n,r=e.get("graph"),i=e.get("delegate"),o=(i?{x:i.attr("x"),y:i.attr("y")}:void 0)||r.getPointByClient(t.clientX,t.clientY);n=t.originalEvent.wheelDelta<0?.95:1/.95;var a=e.get("maxR"),s=e.get("minR"),u=e.get("r");(u>(a||r.get("height"))&&n>1||u<(s||.05*r.get("height"))&&n<1)&&(n=1),u*=n,e.set("r",u),e.set("r2",u*u);var l=e.get("d");e.set("molecularParam",(l+1)*u),e.set("delegateCenterDiff",void 0),e.magnify(t,o)}},e.prototype.scaleRByDrag=function(t){var e=this;if(t){var n,r=e.get("dragPrePos"),i=e.get("graph"),o=i.getPointByClient(t.clientX,t.clientY);n=t.x-r.x<0?.95:1/.95;var a=e.get("maxR"),s=e.get("minR"),u=e.get("r");(u>(a||i.get("height"))&&n>1||u<(s||.05*i.get("height"))&&n<1)&&(n=1),u*=n,e.set("r",u),e.set("r2",u*u);var l=e.get("d");e.set("molecularParam",(l+1)*u),e.magnify(t,o),e.set("dragPrePos",{x:t.x,y:t.y})}},e.prototype.scaleDByWheel=function(t){var e=this;if(t||t.originalEvent){t.preventDefault&&t.preventDefault();var n;n=t.originalEvent.wheelDelta<0?-.1:.1;var r=e.get("d")+n,i=e.get("maxD"),o=e.get("minD");if(r<i&&r>o){e.set("d",r);var a=e.get("r");e.set("molecularParam",(r+1)*a);var s=e.get("delegate"),u=s?{x:s.attr("x"),y:s.attr("y")}:void 0;e.set("delegateCenterDiff",void 0),e.magnify(t,u)}}},e.prototype.scaleDByDrag=function(t){var e=this,n=e.get("dragPrePos"),r=t.x-n.x>0?.1:-.1,i=e.get("d")+r,o=e.get("maxD"),a=e.get("minD");if(i<o&&i>a){e.set("d",i);var s=e.get("r");e.set("molecularParam",(i+1)*s),e.magnify(t)}e.set("dragPrePos",{x:t.x,y:t.y})},e.prototype.magnify=function(t,e){var n=this;n.restoreCache();var r=n.get("graph"),i=n.get("cachedMagnifiedModels"),o=n.get("cachedOriginPositions"),a=n.get("showLabel"),s=n.get("r"),u=n.get("r2"),l=n.get("d"),c=n.get("molecularParam"),h=r.getNodes(),f=h.length,p=e?{x:e.x,y:e.y}:{x:t.x,y:t.y};!n.get("dragging")||"mousemove"!==n.get("trigger")&&"click"!==n.get("trigger")||(p=n.get("cacheCenter"));var d=n.get("delegateCenterDiff");d&&(p.x+=d.x,p.y+=d.y),n.updateDelegate(p,s);for(var g=0;g<f;g++){var v=h[g].getModel(),m=v.x,y=v.y;if(!isNaN(m)&&!isNaN(y)){var _=(m-p.x)*(m-p.x)+(y-p.y)*(y-p.y);if(!isNaN(_)&&_<u&&0!==_){var b=Math.sqrt(_),x=c*b/(l*b+s),w=(m-p.x)/b,E=(y-p.y)/b;if(v.x=w*x+p.x,v.y=E*x+p.y,o[v.id]||(o[v.id]={x:m,y,texts:[]}),i.push(v),a&&2*b<s)for(var S=h[g].getContainer().getChildren(),C=S.length,A=0;A<C;A++){var T=S[A];"text"===T.get("type")&&(o[v.id].texts.push({visible:T.get("visible"),shape:T}),T.set("visible",!0))}}}}r.refreshPositions()},e.prototype.restoreCache=function(){for(var t=this,e=t.get("cachedMagnifiedModels"),n=t.get("cachedOriginPositions"),r=e.length,i=0;i<r;i++){var o=e[i],a=n[o.id];o.x=a.x,o.y=a.y;for(var s=a.texts.length,u=0;u<s;u++){var l=a.texts[u];l.shape.set("visible",l.visible)}}t.set("cachedMagnifiedModels",[]),t.set("cachedOriginPositions",{})},e.prototype.updateParams=function(t){var e=this,n=t.r,r=t.d,i=t.trigger,o=t.minD,a=t.maxD,s=t.minR,u=t.maxR,l=t.scaleDBy,c=t.scaleRBy;isNaN(t.r)||(e.set("r",n),e.set("r2",n*n)),isNaN(r)||e.set("d",r),isNaN(a)||e.set("maxD",a),isNaN(o)||e.set("minD",o),isNaN(u)||e.set("maxR",u),isNaN(s)||e.set("minR",s);var h,f=e.get("d"),p=e.get("r");e.set("molecularParam",(f+1)*p),"mousemove"!==i&&"click"!==i&&"drag"!==i||e.set("trigger",i),("drag"===l||"wheel"===l||"unset"===l)&&(e.set("scaleDBy",l),e.get("delegate").remove(),e.get("delegate").destroy(),(h=e.get("dPercentText"))&&(h.remove(),h.destroy())),"drag"!==c&&"wheel"!==c&&"unset"!==c||(e.set("scaleRBy",c),e.get("delegate").remove(),e.get("delegate").destroy(),(h=e.get("dPercentText"))&&(h.remove(),h.destroy()))},e.prototype.updateDelegate=function(t,e){var n=this,r=this,i=r.get("graph"),o=r.get("delegate");if(!o||o.destroyed){var a=i.get("group"),s=r.get("delegateStyle")||pC;o=a.addShape("circle",{attrs:fC({r:e/1.5,x:t.x,y:t.y},s),name:"lens-shape",draggable:!0}),"drag"!==this.get("trigger")&&("wheel"===this.get("scaleRBy")?o.on("mousewheel",(function(t){r.scaleRByWheel(t)})):"drag"===this.get("scaleRBy")&&(o.on("dragstart",(function(t){r.set("dragging",!0),r.set("cacheCenter",{x:t.x,y:t.y}),r.set("dragPrePos",{x:t.x,y:t.y})})),o.on("drag",(function(t){r.scaleRByDrag(t)})),o.on("dragend",(function(t){r.set("dragging",!1)}))),"wheel"===this.get("scaleDBy")?o.on("mousewheel",(function(t){n.scaleDByWheel(t)})):"drag"===this.get("scaleDBy")&&(o.on("dragstart",(function(t){r.set("dragging",!0),r.set("cacheCenter",{x:t.x,y:t.y}),r.set("dragPrePos",{x:t.x,y:t.y})})),o.on("drag",(function(t){n.scaleDByDrag(t)})),o.on("dragend",(function(t){r.set("dragging",!1)}))))}else o.attr({x:t.x,y:t.y,r:e/1.5});if(r.get("showDPercent")){var u=Math.round((r.get("d")-r.get("minD"))/(r.get("maxD")-r.get("minD"))*100),l=r.get("dPercentText"),c=t.y+e/1.5+16;!l||l.destroyed?(l=i.get("group").addShape("text",{attrs:{text:"".concat(u,"%"),x:t.x,y:c,fill:"#aaa",stroke:"#fff",lineWidth:1,fontSize:12}}),r.set("dPercentText",l)):l.attr({text:"".concat(u,"%"),x:t.x,y:c})}r.set("delegate",o)},e.prototype.clear=function(){var t=this.get("graph");this.restoreCache(),t.refreshPositions();var e=this.get("delegate");e&&!e.destroyed&&(e.remove(),e.destroy());var n=this.get("dPercentText");n&&!n.destroyed&&(n.remove(),n.destroy())},e.prototype.destroy=function(){this.clear()},e}(GS);const gC=dC;var vC=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();"undefined"!=typeof document&&KS()("\n  .g6-component-toolbar {\n    position: absolute;\n    list-style-type: none;\n    padding: 6px;\n    left: 0px;\n    top: 0px;\n    background-color: rgba(255, 255, 255, 0.9);\n    border: 1px solid #e2e2e2;\n    border-radius: 4px;\n    font-size: 12px;\n    color: #545454;\n    margin: 0;\n  }\n  .g6-component-toolbar li {\n    float: left;\n    text-align: center;\n    width: 35px;\n    height: 24px;\n    cursor: pointer;\n\t\tlist-style-type:none;\n    list-style: none;\n    margin-left: 0px;\n  }\n  .g6-component-toolbar li .icon {\n    opacity: 0.7;\n  }\n  .g6-component-toolbar li .icon:hover {\n    opacity: 1;\n  }\n");var mC=function(t){function e(e){return t.call(this,e)||this}return vC(e,t),e.prototype.getDefaultCfgs=function(){return{handleClick:void 0,getContent:function(t){return'\n          <ul class=\'g6-component-toolbar\'>\n            <li code=\'redo\'>\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="24">\n                <path d="M256 682.666667c0-102.741333 66.730667-213.333333 213.333333-213.333334 107.008 0 190.762667 56.576 230.570667 125.354667L611.968 682.666667H853.333333v-241.365334l-91.562666 91.562667C704.768 448.469333 601.130667 384 469.333333 384c-196.096 0-298.666667 150.229333-298.666666 298.666667h85.333333z" fill="" p-id="2041"></path>\n              </svg>\n            </li>\n            <li code=\'undo\'>\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="24">\n                <path d="M170.666667 682.666667h241.365333l-87.936-87.978667C363.904 525.909333 447.658667 469.333333 554.666667 469.333333c146.602667 0 213.333333 110.592 213.333333 213.333334h85.333333c0-148.437333-102.570667-298.666667-298.666666-298.666667-131.797333 0-235.392 64.469333-292.48 148.821333L170.666667 441.301333V682.666667z" fill="" p-id="2764"></path>\n              </svg>\n            </li>\n            <li  code=\'zoomOut\'>\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="24">\n                <path d="M658.432 428.736a33.216 33.216 0 0 1-33.152 33.152H525.824v99.456a33.216 33.216 0 0 1-66.304 0V461.888H360.064a33.152 33.152 0 0 1 0-66.304H459.52V296.128a33.152 33.152 0 0 1 66.304 0V395.52H625.28c18.24 0 33.152 14.848 33.152 33.152z m299.776 521.792a43.328 43.328 0 0 1-60.864-6.912l-189.248-220.992a362.368 362.368 0 0 1-215.36 70.848 364.8 364.8 0 1 1 364.8-364.736 363.072 363.072 0 0 1-86.912 235.968l192.384 224.64a43.392 43.392 0 0 1-4.8 61.184z m-465.536-223.36a298.816 298.816 0 0 0 298.432-298.432 298.816 298.816 0 0 0-298.432-298.432A298.816 298.816 0 0 0 194.24 428.8a298.816 298.816 0 0 0 298.432 298.432z"></path>\n              </svg>\n            </li>\n            <li code=\'zoomIn\'>\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="24">\n                <path d="M639.936 416a32 32 0 0 1-32 32h-256a32 32 0 0 1 0-64h256a32 32 0 0 1 32 32z m289.28 503.552a41.792 41.792 0 0 1-58.752-6.656l-182.656-213.248A349.76 349.76 0 0 1 480 768 352 352 0 1 1 832 416a350.4 350.4 0 0 1-83.84 227.712l185.664 216.768a41.856 41.856 0 0 1-4.608 59.072zM479.936 704c158.784 0 288-129.216 288-288S638.72 128 479.936 128a288.32 288.32 0 0 0-288 288c0 158.784 129.216 288 288 288z" p-id="3853"></path>\n              </svg>\n            </li>\n            <li code=\'realZoom\'>\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="24">\n                <path d="M384 320v384H320V320h64z m256 0v384H576V320h64zM512 576v64H448V576h64z m0-192v64H448V384h64z m355.968 576H92.032A28.16 28.16 0 0 1 64 931.968V28.032C64 12.608 76.608 0 95.168 0h610.368L896 192v739.968a28.16 28.16 0 0 1-28.032 28.032zM704 64v128h128l-128-128z m128 192h-190.464V64H128v832h704V256z"></path>\n              </svg>\n            </li>\n            <li code=\'autoZoom\'>\n              <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="24">\n                <path d="M684.288 305.28l0.128-0.64-0.128-0.64V99.712c0-19.84 15.552-35.904 34.496-35.712a35.072 35.072 0 0 1 34.56 35.776v171.008h170.944c19.648 0 35.84 15.488 35.712 34.432a35.072 35.072 0 0 1-35.84 34.496h-204.16l-0.64-0.128a32.768 32.768 0 0 1-20.864-7.552c-1.344-1.024-2.816-1.664-3.968-2.816-0.384-0.32-0.512-0.768-0.832-1.088a33.472 33.472 0 0 1-9.408-22.848zM305.28 64a35.072 35.072 0 0 0-34.56 35.776v171.008H99.776A35.072 35.072 0 0 0 64 305.216c0 18.944 15.872 34.496 35.84 34.496h204.16l0.64-0.128a32.896 32.896 0 0 0 20.864-7.552c1.344-1.024 2.816-1.664 3.904-2.816 0.384-0.32 0.512-0.768 0.768-1.088a33.024 33.024 0 0 0 9.536-22.848l-0.128-0.64 0.128-0.704V99.712A35.008 35.008 0 0 0 305.216 64z m618.944 620.288h-204.16l-0.64 0.128-0.512-0.128c-7.808 0-14.72 3.2-20.48 7.68-1.28 1.024-2.752 1.664-3.84 2.752-0.384 0.32-0.512 0.768-0.832 1.088a33.664 33.664 0 0 0-9.408 22.912l0.128 0.64-0.128 0.704v204.288c0 19.712 15.552 35.904 34.496 35.712a35.072 35.072 0 0 0 34.56-35.776V753.28h170.944c19.648 0 35.84-15.488 35.712-34.432a35.072 35.072 0 0 0-35.84-34.496z m-593.92 11.52c-0.256-0.32-0.384-0.768-0.768-1.088-1.088-1.088-2.56-1.728-3.84-2.688a33.088 33.088 0 0 0-20.48-7.68l-0.512 0.064-0.64-0.128H99.84a35.072 35.072 0 0 0-35.84 34.496 35.072 35.072 0 0 0 35.712 34.432H270.72v171.008c0 19.84 15.552 35.84 34.56 35.776a35.008 35.008 0 0 0 34.432-35.712V720l-0.128-0.64 0.128-0.704a33.344 33.344 0 0 0-9.472-22.848zM512 374.144a137.92 137.92 0 1 0 0.128 275.84A137.92 137.92 0 0 0 512 374.08z"></path>\n              </svg>\n            </li>\n          </ul>\n        '},zoomSensitivity:2}},e.prototype.init=function(){var t=this,e=this.get("graph"),n=this.get("getContent")(e),r=n;(0,_.isString)(n)&&(r=RS(n));var i=this.get("className");r.setAttribute("class",i||"g6-component-toolbar");var o=this.get("container");o||(o=this.get("graph").get("container")),(0,_.isString)(o)&&(o=document.getElementById(o)),o.appendChild(r),this.set("toolBar",r);var a=this.get("handleClick");r.addEventListener("click",(function(n){var r=function(t){if(!t)return[];if(t.composedPath)return t.composedPath();for(var e=[],n=t.target;n;){if(e.push(n),"HTML"===n.tagName)return e.push(document,window),e;n=n.parentElement}return e}(n).filter((function(t){return"LI"===t.nodeName}));if(0!==r.length){var i=r[0].getAttribute("code");i&&(a?a(i,e):t.handleDefaultOperator(i,e))}}));var s=this.get("position");s&&jS(r,{top:"".concat(s.y,"px"),left:"".concat(s.x,"px")}),this.bindUndoRedo()},e.prototype.bindUndoRedo=function(){var t=this.get("graph"),e=document.querySelector('.g6-component-toolbar li[code="undo"]'),n=document.querySelector('.g6-component-toolbar li[code="undo"] svg'),r=document.querySelector('.g6-component-toolbar li[code="redo"]'),i=document.querySelector('.g6-component-toolbar li[code="redo"] svg');e&&n&&r&&i&&t.on("stackchange",(function(t){var o=t.undoStack,a=t.redoStack,s=o.length,u=a.length;1===s?(e.setAttribute("style","cursor: not-allowed"),n.setAttribute("style","opacity: 0.4")):(e.removeAttribute("style"),n.removeAttribute("style")),0===u?(r.setAttribute("style","cursor: not-allowed"),i.setAttribute("style","opacity: 0.4")):(r.removeAttribute("style"),i.removeAttribute("style"))}))},e.prototype.undo=function(){var t=this.get("graph"),e=t.getUndoStack();if(e&&1!==e.length){var n=e.pop();if(n){var r=n.action;t.pushStack(r,(0,_.clone)(n.data),"redo");var i=n.data.before;if("add"===r&&(i=n.data.after),!i)return;switch(r){case"visible":Object.keys(i).forEach((function(e){var n=i[e];n&&n.forEach((function(e){var n=t.findById(e.id);e.visible?t.showItem(n,!1):t.hideItem(n,!1)}))}));break;case"render":case"update":Object.keys(i).forEach((function(e){var n=i[e];n&&n.forEach((function(e){t.updateItem(e.id,e,!1)}))}));break;case"changedata":t.changeData(i,!1);break;case"delete":Object.keys(i).forEach((function(e){var n=i[e];n&&n.forEach((function(e){var n=e.itemType;delete e.itemType,t.addItem(n,e,!1)}))}));break;case"add":Object.keys(i).forEach((function(e){var n=i[e];n&&n.forEach((function(e){t.removeItem(e.id,!1)}))}));break;case"updateComboTree":Object.keys(i).forEach((function(e){var n=i[e];n&&n.forEach((function(e){t.updateComboTree(e.id,e.parentId,!1)}))}))}}}},e.prototype.redo=function(){var t=this.get("graph"),e=t.getRedoStack();if(e&&0!==e.length){var n=e.pop();if(n){var r=n.action,i=n.data.after;if(t.pushStack(r,(0,_.clone)(n.data)),"delete"===r&&(i=n.data.before),!i)return;switch(r){case"visible":Object.keys(i).forEach((function(e){var n=i[e];n&&n.forEach((function(e){var n=t.findById(e.id);e.visible?t.showItem(n,!1):t.hideItem(n,!1)}))}));break;case"render":case"update":Object.keys(i).forEach((function(e){var n=i[e];n&&n.forEach((function(e){t.updateItem(e.id,e,!1)}))}));break;case"changedata":t.changeData(i,!1);break;case"delete":i.edges&&i.edges.forEach((function(e){t.removeItem(e.id,!1)})),i.nodes&&i.nodes.forEach((function(e){t.removeItem(e.id,!1)})),i.combos&&i.combos.forEach((function(e){t.removeItem(e.id,!1)}));break;case"add":Object.keys(i).forEach((function(e){var n=i[e];n&&n.forEach((function(e){var n=e.itemType;delete e.itemType,t.addItem(n,e,!1)}))}));break;case"updateComboTree":Object.keys(i).forEach((function(e){var n=i[e];n&&n.forEach((function(e){t.updateComboTree(e.id,e.parentId,!1)}))}))}}}},e.prototype.handleDefaultOperator=function(t,e){var n=e.getZoom();switch(t){case"redo":this.redo();break;case"undo":this.undo();break;case"zoomOut":var r=1/(1-.05*this.get("zoomSensitivity"));if(r*n>(this.get("maxZoom")||e.get("maxZoom")))return;e.zoomTo(n*r);break;case"zoomIn":var i=1-.05*this.get("zoomSensitivity");if(i*n<(this.get("minZoom")||e.get("minZoom")))return;e.zoomTo(n*i);break;case"realZoom":e.zoomTo(1);break;case"autoZoom":e.fitView([20,20])}},e.prototype.destroy=function(){var t=this.get("toolBar");if(t){var e=this.get("container");e||(e=this.get("graph").get("container")),(0,_.isString)(e)&&(e=document.getElementById(e)),e.removeChild(t)}var n=this.get("handleClick");n&&t.removeEventListener("click",n)},e}(GS);const yC=mC;var _C=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();"undefined"!=typeof document&&KS()("\n  .g6-component-tooltip {\n    border: 1px solid #e2e2e2;\n    border-radius: 4px;\n    font-size: 12px;\n    color: #545454;\n    background-color: rgba(255, 255, 255, 0.9);\n    padding: 10px 8px;\n    box-shadow: rgb(174, 174, 174) 0px 0px 10px;\n  }\n  .tooltip-type {\n    padding: 0;\n    margin: 0;\n  }\n  .tooltip-id {\n    color: #531dab;\n  }\n");var bC=function(t){function e(e){return t.call(this,e)||this}return _C(e,t),e.prototype.getDefaultCfgs=function(){return{offsetX:6,offsetY:6,getContent:function(t){return"\n          <h4 class='tooltip-type'>类型：".concat(t.item.getType(),"</h4>\n          <span class='tooltip-id'>ID：").concat(t.item.getID(),"</span>\n        ")},shouldBegin:function(t){return!0},itemTypes:["node","edge","combo"],trigger:"mouseenter",fixToNode:void 0}},e.prototype.getEvents=function(){return"click"===this.get("trigger")?{"node:click":"onClick","edge:click":"onClick","combo:click":"onClick","canvas:click":"onMouseLeave",afterremoveitem:"onMouseLeave",contextmenu:"onMouseLeave",drag:"onMouseLeave"}:{"node:mouseenter":"onMouseEnter","node:mouseleave":"onMouseLeave","node:mousemove":"onMouseMove","edge:mouseenter":"onMouseEnter","edge:mouseleave":"onMouseLeave","edge:mousemove":"onMouseMove","combo:mouseenter":"onMouseEnter","combo:mouseleave":"onMouseLeave","combo:mousemove":"onMouseMove",afterremoveitem:"onMouseLeave",contextmenu:"onMouseLeave","node:drag":"onMouseLeave"}},e.prototype.init=function(){var t=this,e=t.get("className")||"g6-component-tooltip",n=RS("<div class=".concat(e,"></div>")),r=t.get("container");r||(r=t.get("graph").get("container")),(0,_.isString)(r)&&(r=document.getElementById(r)),jS(n,{position:"absolute",visibility:"hidden",display:"none"}),r.appendChild(n),"click"!==t.get("trigger")&&(n.addEventListener("mouseenter",(function(t){jS(n,{visibility:"visible",display:"unset"})})),n.addEventListener("mouseleave",(function(e){t.hideTooltip()}))),t.set("tooltip",n)},e.prototype.onClick=function(t){var e=this.get("itemTypes");if(!t.item||!t.item.getType||-1!==e.indexOf(t.item.getType())){var n=t.item,r=this.get("graph");this.currentTarget===n?(this.currentTarget=null,this.hideTooltip(),r.emit("tooltipchange",{item:t.item,action:"hide"})):(this.currentTarget=n,this.showTooltip(t),r.emit("tooltipchange",{item:t.item,action:"show"}))}},e.prototype.onMouseEnter=function(t){var e=this.get("itemTypes");if(!t.item||!t.item.getType||-1!==e.indexOf(t.item.getType())){var n=t.item,r=this.get("graph");this.currentTarget=n,this.showTooltip(t),r.emit("tooltipchange",{item:t.item,action:"show"})}},e.prototype.onMouseMove=function(t){var e=this.get("itemTypes");t.item&&t.item.getType&&-1===e.indexOf(t.item.getType())||this.currentTarget&&t.item===this.currentTarget&&this.showTooltip(t)},e.prototype.onMouseLeave=function(){this.hideTooltip(),this.get("graph").emit("tooltipchange",{item:this.currentTarget,action:"hide"}),this.currentTarget=null},e.prototype.showTooltip=function(t){if(t.item){var e=this.get("itemTypes");if(!t.item.getType||-1!==e.indexOf(t.item.getType())){var n=this.get("tooltip"),r=this.get("getContent")(t);(0,_.isString)(r)?n.innerHTML=r:n.innerHTML=r.outerHTML,this.updatePosition(t)}}},e.prototype.hideTooltip=function(){var t=this.get("tooltip");t&&jS(t,{visibility:"hidden",display:"none"})},e.prototype.updatePosition=function(t){var e=this.get("shouldBegin"),n=this.get("tooltip");if(e(t)){var r=this.get("graph"),i=r.get("width"),o=r.get("height"),a=this.get("offsetX")||0,s=this.get("offsetY")||0,u=r.getPointByClient(t.clientX,t.clientY),l=this.get("fixToNode"),c=t.item;if(c.getType&&"node"===c.getType()&&l&&(0,_.isArray)(l)&&l.length>=2){var h=c.getBBox();u={x:h.minX+h.width*l[0],y:h.minY+h.height*l[1]}}var f=r.getCanvasByPoint(u.x,u.y),p=f.x,d=f.y,g=r.getContainer(),v={x:p+g.offsetLeft+a,y:d+g.offsetTop+s};jS(n,{visibility:"visible",display:"unset"});var m=n.getBoundingClientRect();p+m.width+a>i&&(v.x-=m.width+a),d+m.height+s>o&&(v.y-=m.height+s),jS(n,{left:"".concat(v.x,"px"),top:"".concat(v.y,"px")})}else jS(n,{visibility:"hidden",display:"none"})},e.prototype.hide=function(){this.onMouseLeave()},e.prototype.destroy=function(){var t=this.get("tooltip");if(t){var e=this.get("container");e||(e=this.get("graph").get("container")),(0,_.isString)(e)&&(e=document.getElementById(e)),e.removeChild(t)}},e}(GS);const xC=bC;var wC={};function EC(t,e){wC[t]=e}var SC=function(){function t(t){this.type="base",this.isCategory=!1,this.isLinear=!1,this.isContinuous=!1,this.isIdentity=!1,this.values=[],this.range=[0,1],this.ticks=[],this.__cfg__=t,this.initCfg(),this.init()}return t.prototype.translate=function(t){return t},t.prototype.change=function(t){(0,_.assign)(this.__cfg__,t),this.init()},t.prototype.clone=function(){return this.constructor(this.__cfg__)},t.prototype.getTicks=function(){var t=this;return(0,_.map)(this.ticks,(function(e,n){return(0,_.isObject)(e)?e:{text:t.getText(e,n),tickValue:e,value:t.scale(e)}}))},t.prototype.getText=function(t,e){var n=this.formatter,r=n?n(t,e):t;return(0,_.isNil)(r)||!(0,_.isFunction)(r.toString)?"":r.toString()},t.prototype.getConfig=function(t){return this.__cfg__[t]},t.prototype.init=function(){(0,_.assign)(this,this.__cfg__),this.setDomain(),(0,_.isEmpty)(this.getConfig("ticks"))&&(this.ticks=this.calculateTicks())},t.prototype.initCfg=function(){},t.prototype.setDomain=function(){},t.prototype.calculateTicks=function(){var t=this.tickMethod,e=[];if((0,_.isString)(t)){var n=wC[t];if(!n)throw new Error("There is no method to to calculate ticks!");e=n(this)}else(0,_.isFunction)(t)&&(e=t(this));return e},t.prototype.rangeMin=function(){return this.range[0]},t.prototype.rangeMax=function(){return this.range[1]},t.prototype.calcPercent=function(t,e,n){return(0,_.isNumber)(t)?(t-e)/(n-e):NaN},t.prototype.calcValue=function(t,e,n){return e+t*(n-e)},t}();const CC=SC;var AC=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="cat",e.isCategory=!0,e}return(0,y.__extends)(e,t),e.prototype.buildIndexMap=function(){if(!this.translateIndexMap){this.translateIndexMap=new Map;for(var t=0;t<this.values.length;t++)this.translateIndexMap.set(this.values[t],t)}},e.prototype.translate=function(t){this.buildIndexMap();var e=this.translateIndexMap.get(t);return void 0===e&&(e=(0,_.isNumber)(t)?t:NaN),e},e.prototype.scale=function(t){var e=this.translate(t),n=this.calcPercent(e,this.min,this.max);return this.calcValue(n,this.rangeMin(),this.rangeMax())},e.prototype.invert=function(t){var e=this.max-this.min,n=this.calcPercent(t,this.rangeMin(),this.rangeMax()),r=Math.round(e*n)+this.min;return r<this.min||r>this.max?NaN:this.values[r]},e.prototype.getText=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=e;return(0,_.isNumber)(e)&&!this.values.includes(e)&&(i=this.values[i]),t.prototype.getText.apply(this,(0,y.__spreadArray)([i],n,!1))},e.prototype.initCfg=function(){this.tickMethod="cat"},e.prototype.setDomain=function(){if((0,_.isNil)(this.getConfig("min"))&&(this.min=0),(0,_.isNil)(this.getConfig("max"))){var t=this.values.length;this.max=t>1?t-1:t}this.translateIndexMap&&(this.translateIndexMap=void 0)},e}(CC);const TC=AC;var kC=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|Z|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,MC="[1-9]\\d?",PC="\\d\\d",IC="[^\\s]+",OC=/\[([^]*?)\]/gm;function RC(t,e){for(var n=[],r=0,i=t.length;r<i;r++)n.push(t[r].substr(0,e));return n}var LC=function(t){return function(e,n){var r=n[t].map((function(t){return t.toLowerCase()})),i=r.indexOf(e.toLowerCase());return i>-1?i:null}};function DC(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];for(var a in o)t[a]=o[a]}return t}var NC=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],BC=["January","February","March","April","May","June","July","August","September","October","November","December"],zC=RC(BC,3),FC={dayNamesShort:RC(NC,3),dayNames:NC,monthNamesShort:zC,monthNames:BC,amPm:["am","pm"],DoFn:function(t){return t+["th","st","nd","rd"][t%10>3?0:(t-t%10!=10?1:0)*t%10]}},ZC=DC({},FC),jC=function(t){return ZC=DC(ZC,t)},UC=function(t){return t.replace(/[|\\{()[^$+*?.-]/g,"\\$&")},GC=function(t,e){for(void 0===e&&(e=2),t=String(t);t.length<e;)t="0"+t;return t},VC={D:function(t){return String(t.getDate())},DD:function(t){return GC(t.getDate())},Do:function(t,e){return e.DoFn(t.getDate())},d:function(t){return String(t.getDay())},dd:function(t){return GC(t.getDay())},ddd:function(t,e){return e.dayNamesShort[t.getDay()]},dddd:function(t,e){return e.dayNames[t.getDay()]},M:function(t){return String(t.getMonth()+1)},MM:function(t){return GC(t.getMonth()+1)},MMM:function(t,e){return e.monthNamesShort[t.getMonth()]},MMMM:function(t,e){return e.monthNames[t.getMonth()]},YY:function(t){return GC(String(t.getFullYear()),4).substr(2)},YYYY:function(t){return GC(t.getFullYear(),4)},h:function(t){return String(t.getHours()%12||12)},hh:function(t){return GC(t.getHours()%12||12)},H:function(t){return String(t.getHours())},HH:function(t){return GC(t.getHours())},m:function(t){return String(t.getMinutes())},mm:function(t){return GC(t.getMinutes())},s:function(t){return String(t.getSeconds())},ss:function(t){return GC(t.getSeconds())},S:function(t){return String(Math.round(t.getMilliseconds()/100))},SS:function(t){return GC(Math.round(t.getMilliseconds()/10),2)},SSS:function(t){return GC(t.getMilliseconds(),3)},a:function(t,e){return t.getHours()<12?e.amPm[0]:e.amPm[1]},A:function(t,e){return t.getHours()<12?e.amPm[0].toUpperCase():e.amPm[1].toUpperCase()},ZZ:function(t){var e=t.getTimezoneOffset();return(e>0?"-":"+")+GC(100*Math.floor(Math.abs(e)/60)+Math.abs(e)%60,4)},Z:function(t){var e=t.getTimezoneOffset();return(e>0?"-":"+")+GC(Math.floor(Math.abs(e)/60),2)+":"+GC(Math.abs(e)%60,2)}},WC=function(t){return+t-1},HC=[null,MC],XC=[null,IC],YC=["isPm",IC,function(t,e){var n=t.toLowerCase();return n===e.amPm[0]?0:n===e.amPm[1]?1:null}],qC=["timezoneOffset","[^\\s]*?[\\+\\-]\\d\\d:?\\d\\d|[^\\s]*?Z?",function(t){var e=(t+"").match(/([+-]|\d\d)/gi);if(e){var n=60*+e[1]+parseInt(e[2],10);return"+"===e[0]?n:-n}return 0}],KC={D:["day",MC],DD:["day",PC],Do:["day","[1-9]\\d?[^\\s]+",function(t){return parseInt(t,10)}],M:["month",MC,WC],MM:["month",PC,WC],YY:["year",PC,function(t){var e=+(""+(new Date).getFullYear()).substr(0,2);return+(""+(+t>68?e-1:e)+t)}],h:["hour",MC,void 0,"isPm"],hh:["hour",PC,void 0,"isPm"],H:["hour",MC],HH:["hour",PC],m:["minute",MC],mm:["minute",PC],s:["second",MC],ss:["second",PC],YYYY:["year","\\d{4}"],S:["millisecond","\\d",function(t){return 100*+t}],SS:["millisecond",PC,function(t){return 10*+t}],SSS:["millisecond","\\d{3}"],d:HC,dd:HC,ddd:XC,dddd:XC,MMM:["month",IC,LC("monthNamesShort")],MMMM:["month",IC,LC("monthNames")],a:YC,A:YC,ZZ:qC,Z:qC},QC={default:"ddd MMM DD YYYY HH:mm:ss",shortDate:"M/D/YY",mediumDate:"MMM D, YYYY",longDate:"MMMM D, YYYY",fullDate:"dddd, MMMM D, YYYY",isoDate:"YYYY-MM-DD",isoDateTime:"YYYY-MM-DDTHH:mm:ssZ",shortTime:"HH:mm",mediumTime:"HH:mm:ss",longTime:"HH:mm:ss.SSS"},JC=function(t){return DC(QC,t)},$C=function(t,e,n){if(void 0===e&&(e=QC.default),void 0===n&&(n={}),"number"==typeof t&&(t=new Date(t)),"[object Date]"!==Object.prototype.toString.call(t)||isNaN(t.getTime()))throw new Error("Invalid Date pass to format");var r=[];e=(e=QC[e]||e).replace(OC,(function(t,e){return r.push(e),"@@@"}));var i=DC(DC({},ZC),n);return(e=e.replace(kC,(function(e){return VC[e](t,i)}))).replace(/@@@/g,(function(){return r.shift()}))};function tA(t,e,n){if(void 0===n&&(n={}),"string"!=typeof e)throw new Error("Invalid format in fecha parse");if(e=QC[e]||e,t.length>1e3)return null;var r={year:(new Date).getFullYear(),month:0,day:1,hour:0,minute:0,second:0,millisecond:0,isPm:null,timezoneOffset:null},i=[],o=[],a=e.replace(OC,(function(t,e){return o.push(UC(e)),"@@@"})),s={},u={};a=UC(a).replace(kC,(function(t){var e=KC[t],n=e[0],r=e[1],o=e[3];if(s[n])throw new Error("Invalid format. "+n+" specified twice in format");return s[n]=!0,o&&(u[o]=!0),i.push(e),"("+r+")"})),Object.keys(u).forEach((function(t){if(!s[t])throw new Error("Invalid format. "+t+" is required in specified format")})),a=a.replace(/@@@/g,(function(){return o.shift()}));var l=t.match(new RegExp(a,"i"));if(!l)return null;for(var c=DC(DC({},ZC),n),h=1;h<l.length;h++){var f=i[h-1],p=f[0],d=f[2],g=d?d(l[h],c):+l[h];if(null==g)return null;r[p]=g}1===r.isPm&&null!=r.hour&&12!=+r.hour?r.hour=+r.hour+12:0===r.isPm&&12==+r.hour&&(r.hour=0);for(var v=new Date(r.year,r.month,r.day,r.hour,r.minute,r.second,r.millisecond),m=[["month","getMonth"],["day","getDate"],["hour","getHours"],["minute","getMinutes"],["second","getSeconds"]],y=(h=0,m.length);h<y;h++)if(s[m[h][0]]&&r[m[h][0]]!==v[m[h][1]]())return null;return null==r.timezoneOffset?v:new Date(Date.UTC(r.year,r.month,r.day,r.hour,r.minute-r.timezoneOffset,r.second,r.millisecond))}const eA={format:$C,parse:tA,defaultI18n:FC,setGlobalDateI18n:jC,setGlobalDateMasks:JC};function nA(t,e){return(m.format||eA.format)(t,e)}function rA(t){return(0,_.isString)(t)&&(t=t.indexOf("T")>0?new Date(t).getTime():new Date(t.replace(/-/gi,"/")).getTime()),(0,_.isDate)(t)&&(t=t.getTime()),t}var iA=1e3,oA=6e4,aA=36e5,sA=24*aA,uA=31*sA,lA=365*sA,cA=[["HH:mm:ss",iA],["HH:mm:ss",1e4],["HH:mm:ss",3e4],["HH:mm",oA],["HH:mm",6e5],["HH:mm",18e5],["HH",aA],["HH",6*aA],["HH",12*aA],["YYYY-MM-DD",sA],["YYYY-MM-DD",4*sA],["YYYY-WW",7*sA],["YYYY-MM",uA],["YYYY-MM",4*uA],["YYYY-MM",6*uA],["YYYY",380*sA]];var hA=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="timeCat",e}return(0,y.__extends)(e,t),e.prototype.translate=function(t){t=rA(t);var e=this.values.indexOf(t);return-1===e&&(e=(0,_.isNumber)(t)&&t<this.values.length?t:NaN),e},e.prototype.getText=function(t,e){var n=this.translate(t);if(n>-1){var r=this.values[n],i=this.formatter;return i?i(r,e):nA(r,this.mask)}return t},e.prototype.initCfg=function(){this.tickMethod="time-cat",this.mask="YYYY-MM-DD",this.tickCount=7},e.prototype.setDomain=function(){var e=this.values;(0,_.each)(e,(function(t,n){e[n]=rA(t)})),e.sort((function(t,e){return t-e})),t.prototype.setDomain.call(this)},e}(TC);const fA=hA;var pA=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isContinuous=!0,e}return(0,y.__extends)(e,t),e.prototype.scale=function(t){if((0,_.isNil)(t))return NaN;var e=this.rangeMin(),n=this.rangeMax();return this.max===this.min?e:e+this.getScalePercent(t)*(n-e)},e.prototype.init=function(){t.prototype.init.call(this);var e=this.ticks,n=(0,_.head)(e),r=(0,_.last)(e);n<this.min&&(this.min=n),r>this.max&&(this.max=r),(0,_.isNil)(this.minLimit)||(this.min=n),(0,_.isNil)(this.maxLimit)||(this.max=r)},e.prototype.setDomain=function(){var t=(0,_.getRange)(this.values),e=t.min,n=t.max;(0,_.isNil)(this.min)&&(this.min=e),(0,_.isNil)(this.max)&&(this.max=n),this.min>this.max&&(this.min=e,this.max=n)},e.prototype.calculateTicks=function(){var e=this,n=t.prototype.calculateTicks.call(this);return this.nice||(n=(0,_.filter)(n,(function(t){return t>=e.min&&t<=e.max}))),n},e.prototype.getScalePercent=function(t){var e=this.max,n=this.min;return(t-n)/(e-n)},e.prototype.getInvertPercent=function(t){return(t-this.rangeMin())/(this.rangeMax()-this.rangeMin())},e}(CC);const dA=pA;var gA=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="linear",e.isLinear=!0,e}return(0,y.__extends)(e,t),e.prototype.invert=function(t){var e=this.getInvertPercent(t);return this.min+e*(this.max-this.min)},e.prototype.initCfg=function(){this.tickMethod="wilkinson-extended",this.nice=!1},e}(dA);const vA=gA;function mA(t,e){var n=Math.E;return e>=0?Math.pow(n,Math.log(e)/t):-1*Math.pow(n,Math.log(-e)/t)}function yA(t,e){return 1===t?1:Math.log(e)/Math.log(t)}function _A(t,e,n){(0,_.isNil)(n)&&(n=Math.max.apply(null,t));var r=n;return(0,_.each)(t,(function(t){t>0&&t<r&&(r=t)})),r===n&&(r=n/e),r>1&&(r=1),r}var bA=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="log",e}return(0,y.__extends)(e,t),e.prototype.invert=function(t){var e,n=this.base,r=yA(n,this.max),i=this.rangeMin(),o=this.rangeMax()-i,a=this.positiveMin;if(a){if(0===t)return 0;var s=1/(r-(e=yA(n,a/n)))*o;if(t<s)return t/s*a}else e=yA(n,this.min);var u=(t-i)/o*(r-e)+e;return Math.pow(n,u)},e.prototype.initCfg=function(){this.tickMethod="log",this.base=10,this.tickCount=6,this.nice=!0},e.prototype.setDomain=function(){t.prototype.setDomain.call(this);var e=this.min;if(e<0)throw new Error("When you use log scale, the minimum value must be greater than zero!");0===e&&(this.positiveMin=_A(this.values,this.base,this.max))},e.prototype.getScalePercent=function(t){var e=this.max,n=this.min;if(e===n)return 0;if(t<=0)return 0;var r=this.base,i=this.positiveMin;return i&&(n=1*i/r),t<i?t/i/(yA(r,e)-yA(r,n)):(yA(r,t)-yA(r,n))/(yA(r,e)-yA(r,n))},e}(dA);const xA=bA;var wA=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="pow",e}return(0,y.__extends)(e,t),e.prototype.invert=function(t){var e=this.getInvertPercent(t),n=this.exponent,r=mA(n,this.max),i=mA(n,this.min),o=e*(r-i)+i,a=o>=0?1:-1;return Math.pow(o,n)*a},e.prototype.initCfg=function(){this.tickMethod="pow",this.exponent=2,this.tickCount=5,this.nice=!0},e.prototype.getScalePercent=function(t){var e=this.max,n=this.min;if(e===n)return 0;var r=this.exponent;return(mA(r,t)-mA(r,n))/(mA(r,e)-mA(r,n))},e}(dA);const EA=wA;var SA=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="time",e}return(0,y.__extends)(e,t),e.prototype.getText=function(t,e){var n=this.translate(t),r=this.formatter;return r?r(n,e):nA(n,this.mask)},e.prototype.scale=function(e){var n=e;return((0,_.isString)(n)||(0,_.isDate)(n))&&(n=this.translate(n)),t.prototype.scale.call(this,n)},e.prototype.translate=function(t){return rA(t)},e.prototype.initCfg=function(){this.tickMethod="time-pretty",this.mask="YYYY-MM-DD",this.tickCount=7,this.nice=!1},e.prototype.setDomain=function(){var t=this.values,e=this.getConfig("min"),n=this.getConfig("max");if((0,_.isNil)(e)&&(0,_.isNumber)(e)||(this.min=this.translate(this.min)),(0,_.isNil)(n)&&(0,_.isNumber)(n)||(this.max=this.translate(this.max)),t&&t.length){var r=[],i=1/0,o=i,a=0;(0,_.each)(t,(function(t){var e=rA(t);if(isNaN(e))throw new TypeError("Invalid Time: "+t+" in time scale!");i>e?(o=i,i=e):o>e&&(o=e),a<e&&(a=e),r.push(e)})),t.length>1&&(this.minTickInterval=o-i),(0,_.isNil)(e)&&(this.min=i),(0,_.isNil)(n)&&(this.max=a)}},e}(vA);const CA=SA;var AA=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="quantize",e}return(0,y.__extends)(e,t),e.prototype.invert=function(t){var e=this.ticks,n=e.length,r=this.getInvertPercent(t),i=Math.floor(r*(n-1));if(i>=n-1)return(0,_.last)(e);if(i<0)return(0,_.head)(e);var o=e[i],a=i/(n-1);return o+(r-a)/((i+1)/(n-1)-a)*(e[i+1]-o)},e.prototype.initCfg=function(){this.tickMethod="r-pretty",this.tickCount=5,this.nice=!0},e.prototype.calculateTicks=function(){var e=t.prototype.calculateTicks.call(this);return this.nice||((0,_.last)(e)!==this.max&&e.push(this.max),(0,_.head)(e)!==this.min&&e.unshift(this.min)),e},e.prototype.getScalePercent=function(t){var e=this.ticks;if(t<(0,_.head)(e))return 0;if(t>(0,_.last)(e))return 1;var n=0;return(0,_.each)(e,(function(e,r){if(!(t>=e))return!1;n=r})),n/(e.length-1)},e}(dA);const TA=AA,kA=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="quantile",e}return(0,y.__extends)(e,t),e.prototype.initCfg=function(){this.tickMethod="quantile",this.tickCount=5,this.nice=!0},e}(TA);var MA={};function PA(t,e){if(function(t){return MA[t]}(t))throw new Error("type '"+t+"' existed.");MA[t]=e}var IA=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="identity",e.isIdentity=!0,e}return(0,y.__extends)(e,t),e.prototype.calculateTicks=function(){return this.values},e.prototype.scale=function(t){return this.values[0]!==t&&(0,_.isNumber)(t)?t:this.range[0]},e.prototype.invert=function(t){var e=this.range;return t<e[0]||t>e[1]?NaN:this.values[0]},e}(CC);const OA=IA;function RA(t){return Math.abs(t)<1e-15?t:parseFloat(t.toFixed(15))}var LA=[1,5,2,2.5,4,3],DA=100*Number.EPSILON;function NA(t,e,n,r,i,o){var a=(0,_.size)(e),s=(0,_.indexOf)(e,t),u=0,l=function(t,e){return(t%e+e)%e}(r,o);return(l<DA||o-l<DA)&&r<=0&&i>=0&&(u=1),1-s/(a-1)-n+u}function BA(t,e,n){var r=(0,_.size)(e);return 1-(0,_.indexOf)(e,t)/(r-1)-n+1}function zA(t,e,n,r,i,o){var a=(t-1)/(o-i),s=(e-1)/(Math.max(o,r)-Math.min(n,i));return 2-Math.max(a/s,s/a)}function FA(t,e){return t>=e?2-(t-1)/(e-1):1}function ZA(t,e,n,r){var i=e-t;return 1-.5*(Math.pow(e-r,2)+Math.pow(t-n,2))/Math.pow(.1*i,2)}function jA(t,e,n){var r=e-t;if(n>r){var i=(n-r)/2;return 1-Math.pow(i,2)/Math.pow(.1*r,2)}return 1}function UA(t,e,n,r,i,o){void 0===n&&(n=5),void 0===r&&(r=!0),void 0===i&&(i=LA),void 0===o&&(o=[.25,.2,.5,.05]);var a=n<0?0:Math.round(n);if(Number.isNaN(t)||Number.isNaN(e)||"number"!=typeof t||"number"!=typeof e||!a)return{min:0,max:0,ticks:[]};if(e-t<1e-15||1===a)return{min:t,max:e,ticks:[t]};for(var s={score:-2,lmin:0,lmax:0,lstep:0},u=1;u<1/0;){for(var l=0;l<i.length;l+=1){var c=i[l],h=BA(c,i,u);if(o[0]*h+o[1]+o[2]+o[3]<s.score){u=1/0;break}for(var f=2;f<1/0;){var p=FA(f,a);if(o[0]*h+o[1]+o[2]*p+o[3]<s.score)break;for(var d=(e-t)/(f+1)/u/c,g=Math.ceil(Math.log10(d));g<1/0;){var v=u*c*Math.pow(10,g),m=jA(t,e,v*(f-1));if(o[0]*h+o[1]*m+o[2]*p+o[3]<s.score)break;var y=Math.floor(e/v)*u-(f-1)*u,b=Math.ceil(t/v)*u;if(y<=b)for(var x=b-y,w=0;w<=x;w+=1){var E=(y+w)*(v/u),S=E+v*(f-1),C=v,A=NA(c,i,u,E,S,C),T=ZA(t,e,E,S),k=zA(f,a,t,e,E,S),M=o[0]*A+o[1]*T+o[2]*k+1*o[3];M>s.score&&(!r||E<=t&&S>=e)&&(s.lmin=E,s.lmax=S,s.lstep=C,s.score=M)}g+=1}f+=1}}u+=1}var P=RA(s.lmax),I=RA(s.lmin),O=RA(s.lstep),R=Math.floor(function(t){return Math.round(1e12*t)/1e12}((P-I)/O))+1,L=new Array(R);for(L[0]=RA(I),l=1;l<R;l++)L[l]=RA(L[l-1]+O);return{min:Math.min(t,(0,_.head)(L)),max:Math.max(e,(0,_.last)(L)),ticks:L}}function GA(t){var e=t.values,n=t.tickInterval,r=t.tickCount,i=e;if((0,_.isNumber)(n))return(0,_.filter)(i,(function(t,e){return e%n==0}));var o=t.min,a=t.max;if((0,_.isNil)(o)&&(o=0),(0,_.isNil)(a)&&(a=e.length-1),(0,_.isNumber)(r)&&r<a-o){var s=UA(o,a,r,!1,[1,2,5,3,4,7,6,8,9]).ticks;return(0,_.filter)(s,(function(t){return t>=o&&t<=a})).map((function(t){return e[t]}))}return e.slice(o,a+1)}var VA=Math.sqrt(50),WA=Math.sqrt(10),HA=Math.sqrt(2),XA=function(){function t(){this._domain=[0,1]}return t.prototype.domain=function(t){return t?(this._domain=Array.from(t,Number),this):this._domain.slice()},t.prototype.nice=function(t){var e,n;void 0===t&&(t=5);var r,i=this._domain.slice(),o=0,a=this._domain.length-1,s=this._domain[o],u=this._domain[a];return u<s&&(s=(e=[u,s])[0],u=e[1],o=(n=[a,o])[0],a=n[1]),(r=YA(s,u,t))>0?r=YA(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,t):r<0&&(r=YA(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,t)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,this.domain(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,this.domain(i)),this},t.prototype.ticks=function(t){return void 0===t&&(t=5),function(t,e,n){var r,i,o,a,s=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(a=YA(t,e,n))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),e=Math.floor(e/a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(t+s)*a;else for(t=Math.floor(t*a),e=Math.ceil(e*a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(t-s)/a;return r&&o.reverse(),o}(this._domain[0],this._domain[this._domain.length-1],t||5)},t}();function YA(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=VA?10:o>=WA?5:o>=HA?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=VA?10:o>=WA?5:o>=HA?2:1)}function qA(t,e,n){return("ceil"===n?Math.ceil(t/e):"floor"===n?Math.floor(t/e):Math.round(t/e))*e}function KA(t,e,n){var r=qA(t,n,"floor"),i=qA(e,n,"ceil");r=(0,_.fixedBase)(r,n),i=(0,_.fixedBase)(i,n);for(var o=[],a=r;a<=i;a+=n){var s=(0,_.fixedBase)(a,n);o.push(s)}return{min:r,max:i,ticks:o}}function QA(t,e,n){var r,i=t.minLimit,o=t.maxLimit,a=t.min,s=t.max,u=t.tickCount,l=void 0===u?5:u,c=(0,_.isNil)(i)?(0,_.isNil)(e)?a:e:i,h=(0,_.isNil)(o)?(0,_.isNil)(n)?s:n:o;if(c>h&&(h=(r=[c,h])[0],c=r[1]),l<=2)return[c,h];for(var f=(h-c)/(l-1),p=[],d=0;d<l;d++)p.push(c+f*d);return p}function JA(t,e,n){if(void 0===n&&(n=5),t===e)return{max:e,min:t,ticks:[t]};var r=n<0?0:Math.round(n);if(0===r)return{max:e,min:t,ticks:[]};var i=(e-t)/r,o=Math.pow(10,Math.floor(Math.log10(i))),a=o;2*o-i<1.5*(i-a)&&5*o-i<2.75*(i-(a=2*o))&&10*o-i<1.5*(i-(a=5*o))&&(a=10*o);for(var s=Math.ceil(e/a),u=Math.floor(t/a),l=Math.max(s*a,e),c=Math.min(u*a,t),h=Math.floor((l-c)/a)+1,f=new Array(h),p=0;p<h;p++)f[p]=RA(c+p*a);return{min:c,max:l,ticks:f}}function $A(t,e){var n=t.length*e;return 1===e?t[t.length-1]:0===e?t[0]:n%1!=0?t[Math.ceil(n)-1]:t.length%2==0?(t[n-1]+t[n])/2:t[n]}function tT(t){return new Date(t).getFullYear()}function eT(t){return new Date(t,0,1).getTime()}function nT(t){return new Date(t).getMonth()}function rT(t,e){return new Date(t,e,1).getTime()}EC("cat",GA),EC("time-cat",(function(t){var e=GA(t),n=(0,_.last)(t.values);return n!==(0,_.last)(e)&&e.push(n),e})),EC("wilkinson-extended",(function(t){var e=t.min,n=t.max,r=t.tickCount,i=t.nice,o=t.tickInterval,a=t.minLimit,s=t.maxLimit,u=UA(e,n,r,i).ticks;return(0,_.isNil)(a)&&(0,_.isNil)(s)?o?KA(e,n,o).ticks:u:QA(t,(0,_.head)(u),(0,_.last)(u))})),EC("r-pretty",(function(t){var e=t.min,n=t.max,r=t.tickCount,i=t.tickInterval,o=t.minLimit,a=t.maxLimit,s=JA(e,n,r).ticks;return(0,_.isNil)(o)&&(0,_.isNil)(a)?i?KA(e,n,i).ticks:s:QA(t,(0,_.head)(s),(0,_.last)(s))})),EC("time",(function(t){var e=t.min,n=t.max,r=t.minTickInterval,i=t.tickInterval,o=t.tickCount;if(i)o=Math.ceil((n-e)/i);else{var a=(n-e)/(i=function(t,e,n){var r,i=(r=function(t){return t[1]},function(t,e,n,i){for(var o=(0,_.isNil)(n)?0:n,a=(0,_.isNil)(i)?t.length:i;o<a;){var s=o+a>>>1;r(t[s])>e?a=s:o=s+1}return o})(cA,(e-t)/n)-1,o=cA[i];return i<0?o=cA[0]:i>=cA.length&&(o=(0,_.last)(cA)),o}(e,n,o)[1])/o;a>1&&(i*=Math.ceil(a)),r&&i<r&&(i=r)}for(var s=[],u=e;u<n+i;u+=i)s.push(u);return s})),EC("time-pretty",(function(t){var e=t.min,n=t.max,r=t.minTickInterval,i=t.tickCount,o=t.tickInterval,a=[];o||(o=(n-e)/i,r&&o<r&&(o=r));var s=tT(e);if(o>lA)for(var u=tT(n),l=Math.ceil(o/lA),c=s;c<=u+l;c+=l)a.push(eT(c));else if(o>uA){var h=Math.ceil(o/uA),f=nT(e),p=function(t,e){var n=tT(t),r=tT(e),i=nT(t);return 12*(r-n)+(nT(e)-i)%12}(e,n);for(c=0;c<=p+h;c+=h)a.push(rT(s,c+f))}else if(o>sA){var d=(_=new Date(e)).getFullYear(),g=_.getMonth(),v=_.getDate(),m=Math.ceil(o/sA),y=function(t,e){return Math.ceil((e-t)/sA)}(e,n);for(c=0;c<y+m;c+=m)a.push(new Date(d,g,v+c).getTime())}else if(o>aA){d=(_=new Date(e)).getFullYear(),g=_.getMonth(),m=_.getDate();var _,b=_.getHours(),x=Math.ceil(o/aA),w=function(t,e){return Math.ceil((e-t)/aA)}(e,n);for(c=0;c<=w+x;c+=x)a.push(new Date(d,g,m,b+c).getTime())}else if(o>oA){var E=function(t,e){return Math.ceil((e-t)/6e4)}(e,n),S=Math.ceil(o/oA);for(c=0;c<=E+S;c+=S)a.push(e+c*oA)}else{var C=o;C<iA&&(C=iA);var A=Math.floor(e/iA)*iA,T=Math.ceil((n-e)/iA),k=Math.ceil(C/iA);for(c=0;c<T+k;c+=k)a.push(A+c*iA)}return a.length>=512&&console.warn("Notice: current ticks length("+a.length+') >= 512, may cause performance issues, even out of memory. Because of the configure "tickInterval"(in milliseconds, current is '+o+") is too small, increase the value to solve the problem!"),a})),EC("log",(function(t){var e,n=t.base,r=t.tickCount,i=t.min,o=t.max,a=t.values,s=yA(n,o);if(i>0)e=Math.floor(yA(n,i));else{var u=_A(a,n,o);e=Math.floor(yA(n,u))}for(var l=s-e,c=Math.ceil(l/r),h=[],f=e;f<s+c;f+=c)h.push(Math.pow(n,f));return i<=0&&h.unshift(0),h})),EC("pow",(function(t){var e=t.exponent,n=t.tickCount,r=Math.ceil(mA(e,t.max));return JA(Math.floor(mA(e,t.min)),r,n).ticks.map((function(t){var n=t>=0?1:-1;return Math.pow(t,e)*n}))})),EC("quantile",(function(t){var e=t.tickCount,n=t.values;if(!n||!n.length)return[];for(var r=n.slice().sort((function(t,e){return t-e})),i=[],o=0;o<e;o++){var a=o/(e-1);i.push($A(r,a))}return i})),EC("d3-linear",(function(t){var e=t.min,n=t.max,r=t.tickInterval,i=t.minLimit,o=t.maxLimit,a=function(t){var e=t.min,n=t.max,r=t.nice,i=t.tickCount,o=new XA;return o.domain([e,n]),r&&o.nice(i),o.ticks(i)}(t);return(0,_.isNil)(i)&&(0,_.isNil)(o)?r?KA(e,n,r).ticks:a:QA(t,(0,_.head)(a),(0,_.last)(a))})),PA("cat",TC),PA("category",TC),PA("identity",OA),PA("linear",vA),PA("log",xA),PA("pow",EA),PA("time",CA),PA("timeCat",fA),PA("quantize",TA),PA("quantile",kA);function iT(t){return function(t){return(0,_.map)(t,(function(t,e){return[0===e?"M":"L",t[0],t[1]]}))}(t)}function oT(t,e,n,r){void 0===r&&(r=5);for(var i=new vA({values:t}),o=new TC({values:(0,_.map)(t,(function(t,e){return e}))}),a=(0,_.map)(t,(function(t,r){return[o.scale(r)*e,n-i.scale(t)*n]})),s=[],u=0;u<a.length;u++){var l=a[u],c=sT({x:l[0],y:l[1],y0:n,size:r});s.push.apply(s,c)}return function(t,e){void 0===e&&(e=!0);var n=[],r=t[0];n.push(["M",r.x,r.y]);for(var i=1,o=t.length;i<o;i++)n.push(["L",t[i].x,t[i].y]);return e&&(n.push(["L",r.x,r.y]),n.push(["z"])),n}(s)}function aT(t,e,n,r){var i=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}([],t,!0),o=function(t,e){var n=new vA({values:t}),r=Math.max(0,n.min);return e-n.scale(r)*e}(r,n);return i.push(["L",e,o]),i.push(["L",0,o]),i.push(["Z"]),i}function sT(t){var e,n,r,i,o=t.x,a=t.y,s=t.y0,u=t.size;(0,_.isArray)(a)?(e=a[0],n=a[1]):(e=s,n=a),(0,_.isArray)(o)?(r=o[0],i=o[1]):(r=o-u/2,i=o+u/2);var l=[{x:r,y:e},{x:r,y:n}];return l.push({x:i,y:n},{x:i,y:e}),l}var uT=function(){return uT=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},uT.apply(this,arguments)},lT={stroke:"#C5C5C5",strokeOpacity:.85},cT={fill:"#CACED4",opacity:.85},hT=function(){function t(t){var e=t.x,n=void 0===e?0:e,r=t.y,i=void 0===r?0:r,o=t.width,a=void 0===o?200:o,s=t.height,u=void 0===s?26:s,l=t.smooth,c=void 0===l||l,h=t.isArea,f=void 0!==h&&h,p=t.data,d=void 0===p?[]:p,g=t.lineStyle,v=t.areaStyle,m=t.group,y=t.interval,_=void 0===y?null:y;this.group=m,this.x=n,this.y=i,this.width=a,this.height=u,this.data=d,this.smooth=c,this.isArea=f,this.lineStyle=Object.assign({},lT,g),this.areaStyle=Object.assign({},cT,v),this.intervalConfig=_,this.renderLine()}return t.prototype.renderLine=function(){var t=this,e=t.x,n=t.y,r=t.width,i=t.height,o=(t.barWidth,t.data),a=t.smooth,s=t.isArea,u=t.lineStyle,l=t.areaStyle,c=this.group.addGroup({name:"trend-group"});if(o){var h=function(t,e,n,r){void 0===r&&(r=!0);var i=new vA({values:t}),o=new TC({values:(0,_.map)(t,(function(t,e){return e}))}),a=(0,_.map)(t,(function(t,r){return[o.scale(r)*e,n-i.scale(t)*n]}));return r?function(t){if(t.length<=2)return iT(t);var e=[];(0,_.each)(t,(function(t){(0,_.isEqual)(t,e.slice(e.length-2))||e.push(t[0],t[1])}));var n=oa(e,!1),r=(0,_.head)(t),i=r[0],o=r[1];return n.unshift(["M",i,o]),n}(a):iT(a)}(o,r,i,a);if(c.addShape("path",{attrs:uT({path:h},u),name:"trend-line"}),s){var f=aT(h,r,i,o);c.addShape("path",{attrs:uT({path:f},l),name:"trend-area"})}}this.intervalConfig&&c.addShape("path",{attrs:uT({path:oT(this.intervalConfig.data,r,i,this.intervalConfig.style.barWidth)},this.intervalConfig.style),name:"trend-interval"}),c.move(e,n)},t.prototype.destory=function(){this.group.destroy()},t}();const fT=hT;var pT=function(){return pT=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},pT.apply(this,arguments)},dT={fill:"#1890ff",stroke:"#1890ff",type:"trend",radius:2,opacity:1,cursor:"ew-resize",highLightFill:"#0050b3"},gT={fill:"#fff",stroke:"#1890ff",radius:2,opacity:1,cursor:"ew-resize"},vT=function(){function t(t){var e=t.group,n=t.name,r=t.type,i=t.x,o=void 0===i?0:i,a=t.y,s=void 0===a?0:a,u=t.width,l=void 0===u?2:u,c=t.height,h=void 0===c?24:c,f=t.style,p=void 0===f?{}:f;this.group=e,this.name=n,this.handleType=r,this.x=o,this.y=s,this.width=l,this.height=h,"trend"===r?this.style=pT(pT({},dT),p):"simple"===r&&(this.style=pT(pT({},gT),p)),this.renderHandle()}return t.prototype.setX=function(t){this.setXY(t,void 0)},t.prototype.setY=function(t){this.setXY(void 0,t)},t.prototype.setXY=function(t,e){(0,_.isNumber)(t)&&(this.x=t),(0,_.isNumber)(e)&&(this.y=e),this.updateXY()},t.prototype.renderHandle=function(){var t=this,e=t.width,n=t.height,r=t.style,i=t.name,o=r.fill,a=r.stroke,s=r.radius,u=r.opacity,l=r.cursor;this.handleGroup=this.group.addGroup(),"trend"===this.handleType?(this.verticalLine=this.handleGroup.addShape("rect",{attrs:{x:0,y:0,width:e,height:n,fill:o,stroke:a,radius:s,opacity:u,cursor:l},name:"".concat(i,"-handler")}),this.topCircle=this.handleGroup.addShape("circle",{attrs:{x:e/2,y:0,r:2*e,fill:o,stroke:a,radius:s,opacity:u,cursor:l,lineAppendWidth:12},name:"".concat(i,"-handler")}),this.bottomCircle=this.handleGroup.addShape("circle",{attrs:{x:e/2,y:n,r:2*e,fill:o,stroke:a,radius:s,opacity:u,cursor:l},name:"".concat(i,"-handler")})):"simple"===this.handleType&&(this.topCircle=this.handleGroup.addShape("circle",{attrs:{x:e/2,y:n/2,r:2*e,fill:o,stroke:a,radius:s,opacity:u,cursor:l,lineWidth:2},name:"".concat(i,"-handler")})),this.updateXY(),"trend"===this.handleType?this.bindTrendEvents():"simple"===this.handleType&&this.bindSimpleEvents()},t.prototype.bindSimpleEvents=function(){var t=this,e=this.name;this.handleGroup.on("".concat(e,"-handler:mouseenter"),(function(){var e=t.style.highLightFill;t.topCircle.attr("fill",e)})),this.handleGroup.on("".concat(e,"-handler:mouseleave"),(function(){var e=t.style.fill;t.topCircle.attr("fill",e)}))},t.prototype.bindTrendEvents=function(){var t=this,e=this.name;this.handleGroup.on("".concat(e,"-handler:mouseenter"),(function(){var e=t.style.highLightFill;t.verticalLine.attr("fill",e),t.topCircle.attr("fill",e),t.bottomCircle.attr("fill",e)})),this.handleGroup.on("".concat(e,"-handler:mouseleave"),(function(){var e=t.style.fill;t.verticalLine.attr("fill",e),t.topCircle.attr("fill",e),t.bottomCircle.attr("fill",e)}))},t.prototype.show=function(){this.handleGroup.show()},t.prototype.hide=function(){this.handleGroup.hide()},t.prototype.updateXY=function(){this.handleGroup.setMatrix([1,0,0,0,1,0,this.x,this.y,1])},t}();const mT=vT;var yT="timebarstartplay",_T="timebarendplay",bT="valuechange",xT="timebarConfigChanged",wT="playPauseBtn",ET="nextStepBtn",ST="preStepBtn",CT=function(){return CT=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},CT.apply(this,arguments)},AT=function(){function t(t){this.config=(0,_.deepMix)({},t),this.init()}return t.prototype.update=function(t){this.config=(0,_.deepMix)({},this.config,t),this.updateElement(),this.renderMarker()},t.prototype.init=function(){this.initElement(),this.renderMarker()},t.prototype.initElement=function(){var t=this.config,e=t.group,n=t.style,r=n.scale,i=void 0===r?1:r,o=n.offsetX,a=void 0===o?0:o,s=n.offsetY,u=void 0===s?0:s,l=this.config.x+a,c=this.config.y+u,h=e.addGroup({name:wT});this.startMarkerGroup=h.addGroup({name:wT}),this.circle=e.addShape("circle",{attrs:CT({x:l,y:c,r:this.config.r*i},n),name:wT}),this.startMarker=this.startMarkerGroup.addShape("path",{attrs:{path:this.getStartMarkerPath(l,c,i),fill:n.stroke||"#aaa"},name:"start-marker"}),this.pauseMarkerGroup=h.addGroup({name:wT});var f=.25*this.config.r*i,p=.5*this.config.r*Math.sqrt(3)*i;this.pauseLeftMarker=this.pauseMarkerGroup.addShape("rect",{attrs:{x:l-.375*this.config.r*i,y:c-p/2,width:f,height:p,fill:n.stroke||"#aaa",lineWidth:0}}),this.pauseRightMarker=this.pauseMarkerGroup.addShape("rect",{attrs:{x:l+1/8*this.config.r*i,y:c-p/2,width:f,height:p,fill:n.stroke||"#aaa",lineWidth:0}})},t.prototype.updateElement=function(){var t=this.config.style,e=t.scale,n=void 0===e?1:e,r=t.offsetX,i=void 0===r?0:r,o=t.offsetY,a=void 0===o?0:o,s=this.config.x+i,u=this.config.y+a;this.circle.attr("x",s),this.circle.attr("y",u),this.circle.attr("r",this.config.r*n),this.startMarker.attr("path",this.getStartMarkerPath(s,u,n));var l=.25*this.config.r*n,c=.5*this.config.r*Math.sqrt(3)*n;this.pauseLeftMarker.attr("x",s-.375*this.config.r*n),this.pauseLeftMarker.attr("y",u-c/2),this.pauseLeftMarker.attr("width",l),this.pauseLeftMarker.attr("height",c),this.pauseRightMarker.attr("x",s+1/8*this.config.r*n),this.pauseRightMarker.attr("y",u-c/2),this.pauseRightMarker.attr("width",l),this.pauseRightMarker.attr("height",c)},t.prototype.renderMarker=function(){this.config.isPlay?(this.startMarkerGroup.hide(),this.pauseMarkerGroup.show()):(this.startMarkerGroup.show(),this.pauseMarkerGroup.hide())},t.prototype.getStartMarkerPath=function(t,e,n){var r=.5*this.config.r*Math.sqrt(3)*n;return[["M",t-r/Math.sqrt(3)/2,e-r/2],["L",t+r/Math.sqrt(3),e],["L",t-r/Math.sqrt(3)/2,e+r/2]]},t}();const TT=AT;var kT=function(){return kT=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},kT.apply(this,arguments)},MT=ut,PT={fill:"#aaa",fillOpacity:.35,stroke:"#aaa"},IT={fill:"#fff"},OT={fill:"green"},RT={pointer:{fill:"#aaa",lineWidth:0},scroller:{stroke:"#aaa",fill:"#aaa",lineWidth:1,lineAppendWidth:5,cursor:"pointer"},text:{fill:"#aaa",textBaseline:"top"}},LT={check:{stroke:"green",lineWidth:3},box:{fill:"#fff",stroke:"#aaa",lineWidth:2,radius:3,width:12,height:12},text:{fill:"#aaa",fontSize:12,textBaseline:"top"}},DT={speed:1,loop:!1,fill:"#fff",stroke:"#fff",hideTimeTypeController:!1,preBtnStyle:{fill:"#aaa",stroke:"#aaa"},nextBtnStyle:{fill:"#aaa",stroke:"#aaa"},playBtnStyle:{fill:"#aaa",stroke:"#aaa",fillOpacity:.05},speedControllerStyle:RT,timeTypeControllerStyle:LT},NT=50,BT=function(){function t(t){this.controllerCfg=(0,_.deepMix)({},DT,t),this.group=t.group,this.controllerGroup=this.group.addGroup({name:"controller-group"}),this.speedAxisY=[],this.currentSpeed=this.controllerCfg.speed,this.currentType="range",this.fontFamily=t.fontFamily||"Arial, sans-serif",this.init()}return t.prototype.init=function(){this.renderPlayButton()},t.prototype.getNextMarkerPath=function(t,e,n){return[["M",t,e-n],["L",t+n,e],["L",t,e+n],["Z",t,e-n],["M",t,e],["L",t-n,e-n],["L",t-n,e+n],["Z"]]},t.prototype.getPreMarkerPath=function(t,e,n){return[["M",t,e-n],["L",t-n,e],["L",t,e+n],["L",t,e-n],["M",t,e],["L",t+n,e-n],["L",t+n,e+n],["Z"]]},t.prototype.renderPlayButton=function(){var t=this.controllerCfg,e=t.width,n=t.height,r=t.x,i=t.y,o=t.hideTimeTypeController,a=t.fill,s=void 0===a?"#aaa":a,u=t.stroke,l=void 0===u?"green":u,c=t.containerStyle,h=void 0===c?{}:c,f=kT(kT({},PT),t.playBtnStyle||{}),p=kT(kT({},IT),t.preBtnStyle||{}),d=kT(kT({},OT),t.nextBtnStyle||{}),g=n/2-5,v=i+10,m=this.controllerGroup.addShape("rect",{attrs:kT({x:r,y:v,width:e,height:n,stroke:l,fill:s},h),name:"container-rect"});this.playButton?this.playButton.update({x:e/2,y:v,r:g}):this.playButton=new TT({group:this.controllerGroup,x:e/2,y:v+g+5,r:g,isPlay:this.isPlay,style:f});var y=p.offsetX||0,_=p.offsetY||0,b=(p.scale||1)*g;this.controllerGroup.addShape("path",{attrs:kT({path:this.getPreMarkerPath(e/2-5*g+y,v+g+5+_,.5*b)},p),name:ST});var x=d.offsetX||0,w=d.offsetY||0,E=(d.scale||1)*g;this.controllerGroup.addShape("path",{attrs:kT({path:this.getNextMarkerPath(e/2+5*g+x,v+g+5+w,.5*E)},d),name:ET}),m.toBack(),this.renderSpeedBtn(),o||this.renderToggleTime(),this.bindEvent();var S=this.controllerCfg.scale,C=void 0===S?1:S,A=this.controllerGroup.getCanvasBBox(),T=(A.maxX+A.minX)/2,k=(A.maxY+A.minY)/2,M=MT([1,0,0,0,1,0,0,0,1],[["t",-T,-k],["s",C,C],["t",T,k]]);this.controllerGroup.setMatrix(M)},t.prototype.renderSpeedBtn=function(){var t=this.controllerCfg,e=t.y,n=t.width,r=t.hideTimeTypeController,i=kT(kT({},RT),this.controllerCfg.speedControllerStyle||{}),o=i.scroller,a=void 0===o?{}:o,s=i.text,u=void 0===s?{}:s,l=i.pointer,c=void 0===l?{}:l,h=i.scale,f=void 0===h?1:h,p=i.offsetX,d=void 0===p?0:p,g=i.offsetY,v=void 0===g?0:g,m=this.controllerGroup.addGroup({name:"speed-group"});this.speedGroup=m;var y=[],_=5;this.speedAxisY=[19,22,26,32,39];for(var b=0;b<5;b++){var x=e+this.speedAxisY[b],w=n-(r?NT:110);m.addShape("line",{attrs:kT({x1:w,x2:w+15,y1:x,y2:x},a),speed:_,name:"speed-rect"}),this.speedAxisY[b]=x,y.push(_),_-=1}this.speedText=m.addShape("text",{attrs:kT({x:n-(r?NT:110)+20,y:this.speedAxisY[0]+4,text:"1.0X",fontFamily:this.fontFamily||"Arial, sans-serif"},u),name:"speed-text"}),this.speedPoint=m.addShape("path",{attrs:kT({path:this.getPointerPath(n-(r?NT:110),0),matrix:[1,0,0,0,1,0,0,this.speedAxisY[4],1]},c),name:"speed-pointer"});var E=this.speedGroup.getCanvasBBox(),S=(E.maxX+E.minX)/2,C=(E.maxY+E.minY)/2,A=this.speedGroup.getMatrix()||[1,0,0,0,1,0,0,0,1];A=MT(A,[["t",-S,-C],["s",f,f],["t",S+d*f,C+v*f]]),this.speedGroup.setMatrix(A)},t.prototype.getPointerPath=function(t,e){return[["M",t,e],["L",t-10,e-4],["L",t-10,e+4],["Z"]]},t.prototype.renderToggleTime=function(){var t,e=this.controllerCfg.width,n=kT(kT({},LT),this.controllerCfg.timeTypeControllerStyle||{}),r=n.scale,i=void 0===r?1:r,o=n.offsetX,a=void 0===o?0:o,s=n.offsetY,u=void 0===s?0:s,l=n.box,c=void 0===l?{}:l,h=n.check,f=void 0===h?{}:h,p=n.text,d=void 0===p?{}:p;this.toggleGroup=this.controllerGroup.addGroup({name:"toggle-group"}),this.toggleGroup.addShape("rect",{attrs:kT({x:e-NT,y:this.speedAxisY[0]+3.5},c),isChecked:!1,name:"toggle-model"}),this.checkedIcon=this.toggleGroup.addShape("path",{attrs:kT({path:[["M",e-NT+3,this.speedAxisY[1]+6],["L",e-NT+7,this.speedAxisY[1]+10],["L",e-NT+12,this.speedAxisY[1]+4]]},f),capture:!1,name:"check-icon"}),this.checkedIcon.hide(),this.checkedText=this.toggleGroup.addShape("text",{attrs:kT({text:(null===(t=this.controllerCfg)||void 0===t?void 0:t.timePointControllerText)||"单一时间",x:e-NT+15,y:this.speedAxisY[0]+4,fontFamily:"undefined"!=typeof window&&window.getComputedStyle(document.body,null).getPropertyValue("font-family")||"Arial, sans-serif"},d),name:"checked-text"});var g=this.toggleGroup.getCanvasBBox(),v=(g.maxX+g.minX)/2,m=(g.maxY+g.minY)/2,y=this.toggleGroup.getMatrix()||[1,0,0,0,1,0,0,0,1];y=MT(y,[["t",-v,-m],["s",i,i],["t",v+a*i,m+u*i]]),this.toggleGroup.setMatrix(y)},t.prototype.bindEvent=function(){var t=this;this.speedGroup.on("speed-rect:click",(function(e){var n=e.target.attr("y1"),r=t.speedPoint.attr("matrix"),i=t.speedAxisY.indexOf(r[7]||0),o=t.speedAxisY.indexOf(n),a=t.speedAxisY[o]-t.speedAxisY[i];r=MT(r,[["t",0,a]]),t.speedPoint.setMatrix(r),t.currentSpeed=t.speedAxisY.length-o,t.speedText.attr("text","".concat(t.currentSpeed,".0X")),t.group.emit(xT,{speed:t.currentSpeed,type:t.currentType})})),this.speedGroup.on("mousewheel",(function(e){e.preventDefault();var n=t.speedPoint.attr("matrix")||[1,0,0,0,1,0,0,0,1],r=n[7],i=t.speedAxisY.indexOf(r);if(-1===i){var o=1/0;t.speedAxisY.forEach((function(t,e){var n=Math.abs(t-r);o>n&&(o=n,i=e)}))}i=e.originalEvent.deltaY>0?Math.max(0,i-1):Math.min(t.speedAxisY.length-1,i+1);var a=t.speedAxisY[i]-r;n=MT(n,[["t",0,a]]),t.speedPoint.setMatrix(n),t.currentSpeed=t.speedAxisY.length-i,t.speedText.attr("text","".concat(t.currentSpeed,".0X")),t.group.emit(xT,{speed:t.currentSpeed,type:t.currentType})})),this.toggleGroup&&this.toggleGroup.on("toggle-model:click",(function(e){var n,r,i=e.target.get("isChecked");i?(t.checkedIcon.hide(),t.checkedText.attr("text",(null===(r=t.controllerCfg)||void 0===r?void 0:r.timePointControllerText)||"单一时间"),t.currentType="range"):(t.checkedIcon.show(),t.checkedText.attr("text",(null===(n=t.controllerCfg)||void 0===n?void 0:n.timeRangeControllerText)||"时间范围"),t.currentType="single"),e.target.set("isChecked",!i),t.group.emit(xT,{type:t.currentType,speed:t.currentSpeed})}))},t.prototype.destroy=function(){this.speedGroup.off("speed-rect:click"),this.toggleGroup&&(this.toggleGroup.off("toggle-model:click"),this.toggleGroup.destroy()),this.speedGroup.destroy()},t}();const zT=BT;var FT=function(){return FT=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},FT.apply(this,arguments)},ZT=ut,jT={fill:"#416180",opacity:.05},UT={fill:"#416180",opacity:.15,radius:5},GT={fill:"#5B8FF9",opacity:.3,cursor:"grab"},VT={width:2,height:24},WT={textBaseline:"middle",fill:"#000",opacity:.45},HT={textAlign:"center",textBaseline:"top",fill:"#607889",opacity:.35},XT={lineWidth:1,stroke:"#ccc"},YT=function(){function t(t){var e=this;this.prevX=0,this.onMouseDown=function(t){return function(n){e.currentHandler=t;var r=n.originalEvent;r.stopPropagation(),r.preventDefault(),e.prevX=(0,_.get)(r,"touches.0.pageX",r.pageX);var i=e.canvas.get("container");i.addEventListener("mousemove",e.onMouseMove),i.addEventListener("mouseup",e.onMouseUp),i.addEventListener("mouseleave",e.onMouseUp),i.addEventListener("touchmove",e.onMouseMove),i.addEventListener("touchend",e.onMouseUp),i.addEventListener("touchcancel",e.onMouseUp)}},this.onMouseMove=function(t){t.stopPropagation(),t.preventDefault();var n=(0,_.get)(t,"touches.0.pageX",t.pageX),r=n-e.prevX,i=e.adjustOffsetRange(r/e.width);e.updateStartEnd(i),e.updateUI(),e.prevX=n},this.onMouseUp=function(){e.currentHandler&&(e.currentHandler=void 0);var t=e.canvas.get("container");t&&(t.removeEventListener("mousemove",e.onMouseMove),t.removeEventListener("mouseup",e.onMouseUp),t.removeEventListener("mouseleave",e.onMouseUp),t.removeEventListener("touchmove",e.onMouseMove),t.removeEventListener("touchend",e.onMouseUp),t.removeEventListener("touchcancel",e.onMouseUp))};var n=t.x,r=void 0===n?0:n,i=t.y,o=void 0===i?0:i,a=t.width,s=void 0===a?100:a,u=t.height,l=t.padding,c=void 0===l?10:l,h=t.trendCfg,f=t.controllerCfg,p=void 0===f?{speed:1}:f,d=t.backgroundStyle,g=void 0===d?{}:d,v=t.foregroundStyle,m=void 0===v?{}:v,y=t.handlerStyle,b=void 0===y?{}:y,x=t.textStyle,w=void 0===x?{}:x,E=t.start,S=void 0===E?0:E,C=t.end,A=void 0===C?1:C,T=t.minText,k=void 0===T?"":T,M=t.maxText,P=void 0===M?"":M,I=t.group,O=t.graph,R=t.canvas,L=t.tick,D=void 0===L?{tickLabelStyle:{},tickLineStyle:{},tickLabelFormatter:function(t){return t},ticks:[]}:L,N=t.type;this.graph=O,this.canvas=R,this.group=I,this.timeBarType=N,this.x=r,this.y=o,this.width=s,this.height=u,this.padding=c,this.ticks=D.ticks,this.trendCfg=h,this.controllerCfg=p,this.currentSpeed=p.speed||1,this.tickLabelFormatter=D.tickLabelFormatter,"trend"===N?this.backgroundStyle=FT(FT({},jT),g):"simple"===N&&(this.backgroundStyle=FT(FT({},UT),g)),this.foregroundStyle=FT(FT({},GT),m),this.handlerStyle=FT(FT({},VT),b),this.textStyle=FT(FT({},WT),w),this.tickLabelStyle=FT(FT({},HT),D.tickLabelStyle),this.tickLineStyle=FT(FT({},XT),D.tickLineStyle),this.currentMode="range",this.start=S,this.end=A,this.minText=k,this.maxText=P,this.fontFamily="undefined"!=typeof window&&window.getComputedStyle(document.body,null).getPropertyValue("font-family")||"Arial, sans-serif",this.renderSlider()}return t.prototype.update=function(t){var e=t.x,n=t.y,r=t.width,i=t.height,o=t.minText,a=t.maxText,s=t.start,u=t.end;this.start=Math.min(1,Math.max(s,0)),this.end=Math.min(1,Math.max(u,0)),(0,_.assign)(this,{x:e,y:n,width:r,height:i,minText:o,maxText:a}),this.updateUI()},t.prototype.setText=function(t,e){this.minTextShape.attr("text",t),this.maxTextShape.attr("text",e)},t.prototype.renderSlider=function(){var t=this,e=this,n=e.width,r=e.height,i=e.timeBarType;if("trend"===i&&(0,_.size)((0,_.get)(this.trendCfg,"data"))){var o=new fT(FT(FT({x:this.x,y:this.y,width:n,height:r},this.trendCfg),{group:this.group}));this.trendComponent=o}var a=this.group.addGroup({name:"slider-group"});a.addShape("rect",{attrs:FT({x:0,y:0,width:n,height:r},this.backgroundStyle),name:"background"});var s=this.group.addGroup();"trend"===i?(this.minTextShape=s.addShape("text",{attrs:FT({x:0,y:r/2+this.y,textAlign:"right",text:this.minText,silent:!1,fontFamily:this.fontFamily||"Arial, sans-serif",stroke:"#fff",lineWidth:5},this.textStyle),capture:!1,name:"min-text-shape"}),this.maxTextShape=s.addShape("text",{attrs:FT({y:r/2+this.y,textAlign:"left",text:this.maxText,silent:!1,fontFamily:this.fontFamily||"Arial, sans-serif",stroke:"#fff",lineWidth:5},this.textStyle),capture:!1,name:"max-text-shape"})):(this.minTextShape=s.addShape("text",{attrs:FT({x:0,y:this.y-10,textAlign:"center",text:this.minText,silent:!1,fontFamily:this.fontFamily||"Arial, sans-serif",stroke:"#fff",lineWidth:5},this.textStyle),capture:!1,name:"min-text-shape"}),this.maxTextShape=s.addShape("text",{attrs:FT({y:this.y-10,textAlign:"center",text:this.maxText,silent:!1,fontFamily:this.fontFamily||"Arial, sans-serif",stroke:"#fff",lineWidth:5},this.textStyle),capture:!1,name:"max-text-shape"})),this.foregroundShape=this.group.addGroup().addShape("rect",{attrs:FT({x:0,y:this.y,height:r},this.foregroundStyle),name:"foreground-shape"}),this.foregroundShape.on("mousedown",(function(t){t.target.attr("cursor","grabbing")})),this.foregroundShape.on("mouseup",(function(e){e.target.attr("cursor",t.foregroundStyle.cursor||"grab")}));var u=(0,_.get)(this.handlerStyle,"width",2),l=(0,_.get)(this.handlerStyle,"height",24),c=this.group.addGroup({name:"minHandlerShape"});this.minHandlerShape=new mT({name:"minHandlerShape",group:c,type:i,x:this.x,y:this.y,width:u,height:l,style:this.handlerStyle});var h=this.group.addGroup({name:"maxHandlerShape"});this.maxHandlerShape=new mT({name:"maxHandlerShape",group:h,type:i,x:this.x,y:this.y,width:u,height:l,style:this.handlerStyle});var f=this.ticks,p=n/(f.length-1);this.tickPosList=[],this.textList&&this.textList.length&&this.textList.forEach((function(t){t.destroy()}));var d=-1/0,g=this.tickLabelStyle.rotate;delete this.tickLabelStyle.rotate,this.textList=f.map((function(e,n){var i;t.tickPosList.push(t.x+n*p),t.tickLabelFormatter?(i=t.tickLabelFormatter(e),!(0,_.isString)(i)&&i&&(i=e.date)):i=e.date;var o=t.x+n*p,a=t.y+r+5,s=t.group.addShape("text",{attrs:FT({x:o,y:a,text:i,fontFamily:t.fontFamily||"Arial, sans-serif"},t.tickLabelStyle),name:"tick-label"});if((0,_.isNumber)(g)&&n!==f.length-1){var u=ZT([1,0,0,0,1,0,0,0,1],[["t",-o,-a],["r",g],["t",o-5,a+2]]);s.attr({textAlign:"left",matrix:u})}0===n?s.attr({textAlign:"left"}):n!==f.length-1&&s.attr({textAlign:"right"});var l=t.group.addShape("line",{attrs:FT({x1:t.x+n*p,y1:t.y+r+2,x2:t.x+n*p,y2:t.y+r+6},t.tickLineStyle),name:"tick-line"});l.toBack();var c=s.getBBox();return c.minX>d?(s.show(),l.show(),d=c.minX+c.width+10):(s.hide(),l.hide()),s})),this.controllerBtnGroup=new zT(FT({group:this.group,x:this.x,y:this.y+r+25,width:n,height:35},this.controllerCfg)),this.updateStartEnd(0),this.updateUI(),a.move(this.x,this.y),this.bindEvents()},t.prototype.bindEvents=function(){var t=this,e=this.group.find((function(t){return"minHandlerShape"===t.get("name")}));e&&(e.on("minHandlerShape-handler:mousedown",this.onMouseDown(this.minHandlerShape)),e.on("minHandlerShape-handler:touchstart",this.onMouseDown(this.minHandlerShape)));var n=this.group.find((function(t){return"maxHandlerShape"===t.get("name")}));n&&(n.on("maxHandlerShape-handler:mousedown",this.onMouseDown(this.maxHandlerShape)),n.on("maxHandlerShape-handler:touchstart",this.onMouseDown(this.maxHandlerShape))),this.foregroundShape.on("mousedown",this.onMouseDown(this.foregroundShape)),this.foregroundShape.on("touchstart",this.onMouseDown(this.foregroundShape)),this.group.on("".concat(wT,":click"),(function(){t.isPlay=!t.isPlay,t.currentHandler=t.maxHandlerShape,t.changePlayStatus()})),this.group.on("".concat(ET,":click"),(function(){t.currentHandler=t.maxHandlerShape,t.updateStartEnd(.01),t.updateUI()})),this.group.on("".concat(ST,":click"),(function(){t.currentHandler=t.maxHandlerShape,t.updateStartEnd(-.01),t.updateUI()})),this.group.on(xT,(function(e){var n=e.type,r=e.speed;t.currentSpeed=r,t.currentMode=n,"single"===n?(t.minHandlerShape.hide(),t.foregroundShape.hide(),t.minTextShape.hide()):"range"===n&&(t.minHandlerShape.show(),t.foregroundShape.show(),t.minTextShape.show())}))},t.prototype.adjustTickIndex=function(t){for(var e=0;e<this.tickPosList.length-1;e++)if(this.tickPosList[e]<=t&&t<=this.tickPosList[e+1])return Math.abs(this.tickPosList[e]-t)<Math.abs(t-this.tickPosList[e+1])?e:e+1;return 0},t.prototype.adjustOffsetRange=function(t){switch(this.currentHandler){case this.minHandlerShape:var e=0-this.start,n=1-this.start;return Math.min(n,Math.max(e,t));case this.maxHandlerShape:return e=0-this.end,n=1-this.end,Math.min(n,Math.max(e,t));case this.foregroundShape:return e=0-this.start,n=1-this.end,Math.min(n,Math.max(e,t));default:return 0}},t.prototype.updateStartEnd=function(t){var e=this.ticks[this.adjustTickIndex(this.start*this.width)],n=this.ticks[this.adjustTickIndex(this.end*this.width)];if(!this.currentHandler)return this.minText=this.tickLabelFormatter?this.tickLabelFormatter(e):null==e?void 0:e.date,void(this.maxText=this.tickLabelFormatter?this.tickLabelFormatter(n):null==n?void 0:n.date);switch(this.currentHandler){case this.minHandlerShape:this.maxText=this.maxTextShape.attr("text"),this.start+=t,this.minText=this.tickLabelFormatter?this.tickLabelFormatter(e):e.date;break;case this.maxHandlerShape:this.minText=this.minTextShape.attr("text"),this.end+=t,this.maxText=this.tickLabelFormatter?this.tickLabelFormatter(n):n.date;break;case this.foregroundShape:this.start+=t,this.end+=t,this.minText=this.tickLabelFormatter?this.tickLabelFormatter(e):e.date,this.maxText=this.tickLabelFormatter?this.tickLabelFormatter(n):n.date}},t.prototype.updateUI=function(){var t=this;this.start<0&&(this.start=0),this.end>1&&(this.end=1);var e=this.x+this.start*this.width,n=this.x+this.end*this.width;this.foregroundShape.attr("x",e),this.foregroundShape.attr("width",n-e);var r=(0,_.get)(this.handlerStyle,"width",2);this.setText(this.minText,this.maxText);var i=this.dodgeText([e,n]),o=i[0],a=i[1];this.minHandlerShape.setX(e-r/2),(0,_.each)(o,(function(e,n){return t.minTextShape.attr(n,e)})),this.maxHandlerShape.setX(n-r/2),(0,_.each)(a,(function(e,n){return t.maxTextShape.attr(n,e)})),"range"===this.currentMode?this.graph.emit(bT,{value:[this.start,this.end].sort()}):"single"===this.currentMode&&this.graph.emit(bT,{value:[this.end,this.end]})},t.prototype.dodgeText=function(t){var e,n,r=(0,_.get)(this.handlerStyle,"width",2),i=this.minTextShape,o=this.maxTextShape,a=t[0],s=t[1],u=!1;a>s&&(a=(e=[s,a])[0],s=e[1],i=(n=[o,i])[0],o=n[1],u=!0);var l=i.getBBox(),c=o.getBBox(),h=null,f=null;return"trend"===this.timeBarType?(h=a-l.width<this.x+2?{x:a+r/2+2,textAlign:"left"}:{x:a-r/2-2,textAlign:"right"},f=s+c.width>this.x+this.width?{x:s-r/2-2,textAlign:"right"}:{x:s+r/2+2,textAlign:"left"}):"simple"===this.timeBarType&&(h=i.attr("x")>l.width?{x:a,textAlign:"center"}:{x:a,textAlign:"left"},f=o.attr("x")>this.width-c.width?{x:s,textAlign:"right"}:{x:s,textAlign:"center"}),u?[f,h]:[h,f]},t.prototype.startPlay=function(){var t=this;return"undefined"!=typeof window?window.requestAnimationFrame((function(){var e=t,n=e.ticks,r=e.width,i=t.currentSpeed,o=r/n.length/(1e3*(10-i)/60),a=t.adjustOffsetRange(o/t.width);t.updateStartEnd(a),t.updateUI(),t.isPlay&&(t.playHandler=t.startPlay())})):void 0},t.prototype.changePlayStatus=function(t){void 0===t&&(t=!0),this.controllerBtnGroup.playButton.update({isPlay:this.isPlay}),this.isPlay?(this.playHandler=this.startPlay(),this.graph.emit(yT,null)):this.playHandler&&("undefined"!=typeof window&&window.cancelAnimationFrame(this.playHandler),t&&this.graph.emit(_T,null))},t.prototype.destory=function(){this.graph.off(bT);var t=this.group,e=t.find((function(t){return"minHandlerShape"===t.get("name")}));e&&(e.off("minHandlerShape-handler:mousedown"),e.off("minHandlerShape-handler:touchstart"),e.destroy());var n=t.find((function(t){return"maxHandlerShape"===t.get("name")}));n&&(n.off("maxHandlerShape-handler:mousedown"),n.off("maxHandlerShape-handler:touchstart"),n.destroy()),this.foregroundShape.off("mousedown"),this.foregroundShape.off("touchstart"),this.foregroundShape.destroy(),t.off("".concat(wT,":click")),t.off("".concat(ET,":click")),t.off("".concat(ST,":click")),t.off(xT),t.destroy(),this.trendComponent&&this.trendComponent.destory()},t}();const qT=YT;var KT=function(){function t(t){var e=t.x,n=void 0===e?0:e,r=t.y,i=void 0===r?0:r,o=t.container,a=t.text,s=t.padding,u=void 0===s?[4,4,4,4]:s,l=t.className,c=void 0===l?"g6-component-timebar-tooltip":l,h=t.backgroundColor,f=void 0===h?"#000":h,p=t.textColor,d=void 0===p?"#fff":p,g=t.opacity,v=void 0===g?.8:g,m=t.fontSize,y=void 0===m?12:m;this.container=o,this.className=c,this.backgroundColor=f,this.textColor=d,this.x=n,this.y=i,this.text=a,this.padding=u,this.opacity=v,this.fontSize=y,this.render()}return t.prototype.render=function(){var t=this,e=t.className,n=(t.x,t.y,t.backgroundColor),r=t.textColor,i=t.text,o=t.padding,a=t.opacity,s=t.fontSize,u=t.container,l=RS("<div class='".concat(e,"' style=\"position: absolute; width: fit-content; height: fit-content; opacity: ").concat(a,'"></div>'));(0,_.isString)(u)&&(u=document.getElementById(u)),u.appendChild(l),t.parentHeight=u.offsetHeight,t.parentWidth=u.offsetWidth,jS(l,{visibility:"hidden",top:0,left:0});var c=RS("\n      <div style='position: absolute; white-space:nowrap; background-color: ".concat(n,"; font-size: ").concat(s,"px; border-radius: 4px; width: fit-content; height: fit-content; color: ").concat(r,"; padding: ").concat(o[0],"px ").concat(o[1],"px ").concat(o[2],"px ").concat(o[3],"px'></div>"));c.innerHTML=i,l.appendChild(c),t.backgroundDOM=c;var h=RS("<div style='position: absolute; width: 0px; height: 0px; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 10px solid ".concat(n,"'></div>"));l.appendChild(h),t.arrowDOM=h,t.container=l},t.prototype.show=function(t){var e=this,n=t.text,r=t.x;t.y,t.clientX,t.clientY,e.backgroundDOM.innerHTML=n;var i=e.backgroundDOM.offsetWidth,o=e.backgroundDOM.offsetHeight,a=e.arrowDOM.offsetWidth,s=e.arrowDOM.offsetHeight;jS(e.container,{top:"".concat(-o-s,"px"),left:"".concat(r,"px"),visibility:"visible"}),jS(e.backgroundDOM,{marginLeft:"".concat(-i/2,"px")}),jS(e.arrowDOM,{marginLeft:"".concat(-a/2,"px"),top:"".concat(o,"px")});var u=r-i/2,l=r+i/2;u<0?jS(e.backgroundDOM,{marginLeft:"".concat(-i/2-u,"px")}):l>e.parentWidth&&jS(e.backgroundDOM,{marginLeft:"".concat(-i/2-l+e.parentWidth+12,"px")})},t.prototype.hide=function(){jS(this.container,{top:0,left:0,visibility:"hidden"})},t}();const QT=KT;var JT=function(){return JT=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},JT.apply(this,arguments)},$T=ut,tk={fill:"#5B8FF9"},ek={fill:"#e6e8e9"},nk=function(){function t(t){this.frameCount=0,this.fontFamily="Arial, sans-serif";var e=t.graph,n=t.canvas,r=t.group,i=t.width,o=t.height,a=t.padding,s=t.data,u=t.start,l=t.end,c=t.x,h=void 0===c?0:c,f=t.y,p=void 0===f?0:f,d=t.tickLabelFormatter,g=t.selectedTickStyle,v=void 0===g?tk:g,m=t.unselectedTickStyle,y=void 0===m?ek:m,_=t.tooltipBackgroundColor,b=t.tooltipFomatter,x=t.tickLabelStyle;this.graph=e,this.group=r,this.sliceGroup=r.addGroup({name:"slice-group"}),this.canvas=n,this.width=i,this.height=o,this.padding=a,this.data=s,this.start=u,this.end=l,this.tickLabelFormatter=d,this.tickLabelStyle=x||{},this.selectedTickStyle=v,this.unselectedTickStyle=y,this.x=h,this.y=p,this.tooltipBackgroundColor=_,this.tooltipFomatter=b,this.fontFamily="undefined"!=typeof window&&window.getComputedStyle(document.body,null).getPropertyValue("font-family")||"Arial, sans-serif",this.renderSlices(),this.initEvent()}return t.prototype.renderSlices=function(){var t=this,e=this,n=e.width,r=e.height,i=e.padding,o=e.data,a=e.start,s=e.end,u=e.tickLabelFormatter,l=e.selectedTickStyle,c=e.unselectedTickStyle,h=e.tickLabelStyle,f=n-2*i,p=r-(3*i+4+10)-2*i,d=o.length,g=(f-2*(d-1))/d;this.tickWidth=g;var v=this.sliceGroup,m=[],y=[],b=Math.round(d*a),x=Math.round(d*s);this.startTickRectId=b,this.endTickRectId=x;var w=h.rotate;delete h.rotate,o.forEach((function(e,r){var o=r>=b&&r<=x?l:c,a=v.addShape("rect",{attrs:JT({x:i+r*(g+2),y:i,width:g,height:p},o),draggable:!0,name:"tick-rect-".concat(r)}),s=v.addShape("rect",{attrs:{x:i+r*g+2*(2*r-1)/2,y:i,width:0===r||r===d-1?g+1:g+2,height:p,fill:"#fff",opacity:0},draggable:!0,name:"pick-rect-".concat(r)});s.toFront();var f,E=a.getBBox(),S=(E.minX+E.maxX)/2;if(m.push({rect:a,pickRect:s,value:e.date,x:S,y:E.minY}),u?(f=u(e),!(0,_.isString)(f)&&f&&(f=e.date)):r%Math.round(d/10)==0&&(f=e.date),f){y.push(f);var C=E.maxY+2*i;v.addShape("line",{attrs:{stroke:"#BFBFBF",x1:S,y1:C,x2:S,y2:C+4},name:"tick-line"});var A=C+4+i,T=v.addShape("text",{attrs:JT({fill:"#8c8c8c",stroke:"#fff",lineWidth:1,x:S,y:A,textAlign:"center",text:f,textBaseline:"top",fontSize:10,fontFamily:t.fontFamily||"Arial, sans-serif"},h),capture:!1,name:"tick-label"}),k=T.getBBox();if(k.maxX>n?T.attr("textAlign","right"):k.minX<0&&T.attr("textAlign","left"),(0,_.isNumber)(w)&&10!==y.length){var M=$T([1,0,0,0,1,0,0,0,1],[["t",-S,-A],["r",w],["t",S-5,A+2]]);T.attr({textAlign:"left",matrix:M})}1===y.length?T.attr({textAlign:"left"}):10===y.length&&T.attr({textAlign:"right"})}})),this.tickRects=m;var E=this.group;this.currentSpeed=1,this.controllerBtnGroup=new zT({group:E,x:this.x,y:this.y+r+5,width:n,height:40,hideTimeTypeController:!0,speed:this.currentSpeed,fontFamily:this.fontFamily||"Arial, sans-serif"})},t.prototype.initEvent=function(){var t=this,e=this.sliceGroup;e.on("click",(function(e){var n=e.target;if("rect"===n.get("type")&&n.get("name")){var r=parseInt(n.get("name").split("-")[2],10);if(!isNaN(r)){var i=t.tickRects,o=t.unselectedTickStyle;i.forEach((function(t){t.rect.attr(o)}));var a=t.selectedTickStyle;i[r].rect.attr(a),t.startTickRectId=r,t.endTickRectId=r;var s=r/i.length;t.graph.emit(bT,{value:[s,s]})}}})),e.on("dragstart",(function(e){var n=t.tickRects,r=t.unselectedTickStyle;n.forEach((function(t){t.rect.attr(r)}));var i=e.target,o=parseInt(i.get("name").split("-")[2],10),a=t.selectedTickStyle;n[o].rect.attr(a),t.startTickRectId=o;var s=o/n.length;t.graph.emit(bT,{value:[s,s]}),t.dragging=!0})),e.on("dragover",(function(e){if(t.dragging&&"rect"===e.target.get("type")){for(var n=parseInt(e.target.get("name").split("-")[2],10),r=t.startTickRectId,i=t.tickRects,o=t.selectedTickStyle,a=t.unselectedTickStyle,s=0;s<i.length;s++){var u=s>=r&&s<=n?o:a;i[s].rect.attr(u)}var l=i.length;t.endTickRectId=n;var c=r/l,h=n/l;t.graph.emit(bT,{value:[c,h]})}})),e.on("drop",(function(e){if(t.dragging&&(t.dragging=!1,"rect"===e.target.get("type"))){var n=t.startTickRectId,r=parseInt(e.target.get("name").split("-")[2],10);if(!(r<n)){var i=t.selectedTickStyle,o=t.tickRects;o[r].rect.attr(i),t.endTickRectId=r;var a=o.length,s=n/a,u=r/a;t.graph.emit(bT,{value:[s,u]})}}}));var n=this,r=n.tooltipBackgroundColor,i=n.tooltipFomatter,o=n.canvas,a=new QT({container:o.get("container"),backgroundColor:r}),s=this.tickRects;s.forEach((function(t){var e=t.pickRect;e.on("mouseenter",(function(t){var e=t.target;if("rect"===e.get("type")){var n=parseInt(e.get("name").split("-")[2],10),r=o.getClientByPoint(s[n].x,s[n].y);a.show({x:s[n].x,y:s[n].y,clientX:r.x,clientY:r.y,text:i?i(s[n].value):s[n].value})}})),e.on("mouseleave",(function(t){a.hide()}))}));var u=this.group;u.on("".concat(wT,":click"),(function(){t.isPlay=!t.isPlay,t.changePlayStatus()})),u.on("".concat(ET,":click"),(function(){t.updateStartEnd(1)})),u.on("".concat(ST,":click"),(function(){t.updateStartEnd(-1)})),u.on(xT,(function(e){e.type;var n=e.speed;t.currentSpeed=n}))},t.prototype.changePlayStatus=function(t){void 0===t&&(t=!0),this.controllerBtnGroup.playButton.update({isPlay:this.isPlay}),this.isPlay?(this.playHandler=this.startPlay(),this.graph.emit(yT,null)):this.playHandler&&("undefined"!=typeof window&&window.cancelAnimationFrame(this.playHandler),t&&this.graph.emit(_T,null))},t.prototype.startPlay=function(){var t=this;return"undefined"!=typeof window?window.requestAnimationFrame((function(){var e=t.currentSpeed;t.frameCount%(60/e)==0&&(t.frameCount=0,t.updateStartEnd(1)),t.frameCount++,t.isPlay&&(t.playHandler=t.startPlay())})):void 0},t.prototype.updateStartEnd=function(t){var e=this,n=this.tickRects,r=n.length,i=this.unselectedTickStyle,o=this.selectedTickStyle,a=e.endTickRectId;if(t>0?e.endTickRectId++:(n[e.endTickRectId].rect.attr(i),e.endTickRectId--),a!==e.startTickRectId)e.endTickRectId<e.startTickRectId&&(e.startTickRectId=e.endTickRectId);else{for(var s=e.startTickRectId;s<=e.endTickRectId-1;s++)n[s].rect.attr(i);e.startTickRectId=e.endTickRectId}if(n[e.endTickRectId]){n[e.endTickRectId].rect.attr(o);var u=e.startTickRectId/r,l=e.endTickRectId/r;this.graph.emit(bT,{value:[u,l]})}},t.prototype.destory=function(){this.graph.off(bT);var t=this.sliceGroup;t.off("click"),t.off("dragstart"),t.off("dragover"),t.off("drop"),this.tickRects.forEach((function(t){var e=t.pickRect;e.off("mouseenter"),e.off("mouseleave")})),this.tickRects.length=0,t.off("".concat(wT,":click")),t.off("".concat(ET,":click")),t.off("".concat(ST,":click")),t.off(xT),this.sliceGroup.destroy()},t}();const rk=nk;var ik=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ok=function(){return ok=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},ok.apply(this,arguments)},ak=function(t){function e(e){return t.call(this,e)||this}return ik(e,t),e.prototype.getDefaultCfgs=function(){return{container:null,className:"g6-component-timebar",padding:10,type:"trend",trend:{data:[],isArea:!1,smooth:!0},controllerCfg:{speed:1,loop:!1},slider:{start:.1,end:.9,minText:"min",maxText:"max"},tick:{start:.1,end:.9,data:[]},textStyle:{},filterEdge:!1,filterItemTypes:["node"],containerCSS:{}}},e.prototype.initContainer=function(){var t,e,n=this.get("graph"),r=this._cfgs,i=r.width,o=r.height,a=this.get("className")||"g6-component-timebar",s=this.get("container"),u=this.get("graph").get("container");s?((0,_.isString)(s)&&(s=document.getElementById(s)),t=s):jS(t=RS("<div class='".concat(a,"'></div>")),{position:"relative"}),u.appendChild(t),this.set("timeBarContainer",t),e="SVG"===n.get("renderer")?new Zc({container:t,width:i,height:o}):new Dl({container:t,width:i,height:o}),this.get("containerCSS")&&jS(t,this.get("containerCSS")),this.set("canvas",e)},e.prototype.init=function(){this.initContainer();var t=this.get("canvas").addGroup({name:"timebar-group"});this.set("timeBarGroup",t),this.renderTrend(),this.initEvent();var e="undefined"!=typeof window&&window.getComputedStyle(document.body,null).getPropertyValue("font-family")||"Arial, sans-serif";this.set("fontFamily",e)},e.prototype.renderTrend=function(){var t=this,e=this._cfgs,n=e.width,r=e.x,i=e.y,o=e.padding,a=e.type,s=e.trend,u=e.slider,l=e.controllerCfg,c=e.textStyle,h=e.tick,f=e.backgroundStyle,p=e.foregroundStyle,d=s.data,g=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(s,["data"]),v=n-2*o,m="trend"===a?26:4,y=this.get("graph"),_=this.get("timeBarGroup"),b=this.get("canvas"),x=null;if("trend"===a||"simple"===a){var w=this.get("getValue");x=new qT(ok(ok({graph:y,canvas:b,group:_,type:a,x:r+o,y:"trend"===a?i+o:i+o+15,width:v,height:m,padding:o,backgroundStyle:f,foregroundStyle:p,trendCfg:ok(ok({},g),{data:d.map((function(t){return(null==w?void 0:w(t))||t.value}))})},u),{tick:{ticks:d,tickLabelFormatter:h.tickLabelFormatter,tickLabelStyle:h.tickLabelStyle,tickLineStyle:h.tickLineStyle},handlerStyle:ok(ok({},u.handlerStyle),{height:u.height||m}),controllerCfg:l,textStyle:c}))}else"tick"===a&&(x=new rk(ok({graph:y,canvas:b,group:_,x:r+o,y:i+o,width:n,height:42,padding:2},h)));var E=function e(){var n=t.get("timebar");n.draggingHandler=!1,n.isPlay&&(n.isPlay=!1,n.currentHandler=n.maxHandlerShape,n.changePlayStatus()),document.removeEventListener("mouseup",e)};b.on("mousedown",(function(t){"maxHandlerShape-handler"!==t.target.get("name")&&"minHandlerShape-handler"!==t.target.get("name")&&t.target!==x.foregroundShape||document.addEventListener("mouseup",E)})),this.set("timebar",x)},e.prototype.filterData=function(t){var e,n=t.value,r=null,i=this._cfgs.type;if("trend"===i||"simple"===i?r=this._cfgs.trend.data:"tick"===i&&(r=this._cfgs.tick.data),r&&0!==r.length){var o=this.get("rangeChange"),a=this.get("graph"),s=Math.round(r.length*n[0]),u=Math.round(r.length*n[1]);u=u>=r.length?r.length-1:u,s=s>=r.length?r.length-1:s;var l=null===(e=this._cfgs.tick)||void 0===e?void 0:e.tickLabelFormatter,c=l?l(r[s]):r[s].date,h=l?l(r[u]):r[u].date;if("tick"!==i&&this.get("timebar").setText(c,h),o)o(a,c,h);else{(!this.cacheGraphData||this.cacheGraphData.nodes&&0===this.cacheGraphData.nodes.length)&&(this.cacheGraphData=a.get("data"));var f=this.get("filterItemTypes"),p=this.get("changeData"),d=this.get("getDate"),g=this.get("shouldIgnore"),v=r[s].date,m=r[u].date;if(p||void 0===p){var y=this.cacheGraphData.nodes,_=this.cacheGraphData.edges;if(f.includes("node")){y=y.filter((function(t){var e=+((null==d?void 0:d(t))||t.date);return e>=v&&e<=m||(null==g?void 0:g("node",t,{min:v,max:m}))}));var b=y.map((function(t){return t.id}));_&&(_=_.filter((function(t){return b.includes(t.source)&&b.includes(t.target)||(null==g?void 0:g("edge",t,{min:v,max:m}))})))}(this.get("filterEdge")||f.includes("edge"))&&(_=_.filter((function(t){var e=+((null==d?void 0:d(t))||t.date);return e>=v&&e<=m||(null==g?void 0:g("edge",t,{min:v,max:m}))}))),a.changeData({nodes:y,edges:_})}else f.includes("node")&&a.getNodes().forEach((function(t){var e=t.getModel();if(!(null==g?void 0:g("node",e,{min:v,max:m}))){var n=+((null==d?void 0:d(e))||e.date);n<v||n>m?a.hideItem(t):a.showItem(t)}})),(this.get("filterEdge")||f.includes("edge"))&&a.getEdges().forEach((function(t){var e=t.getModel();if(!(null==g?void 0:g("edge",e,{min:r[s].date,max:r[u].date}))){var n=+((null==d?void 0:d(e))||e.date);n<r[s].date||n>r[u].date?a.hideItem(t):a.showItem(t)}}))}}else console.warn("请配置 TimeBar 组件的数据")},e.prototype.initEvent=function(){var t=this,e=0,n=0,r=this._cfgs.type;r&&"trend"!==r&&"simple"!==r?"tick"===r&&(e=this._cfgs.tick.start,n=this._cfgs.tick.end):(e=this._cfgs.slider.start,n=this._cfgs.slider.end);var i=this.get("graph");i.on("afterrender",(function(r){t.filterData({value:[e,n]})})),i.on(bT,(0,_.throttle)((function(e){t.filterData(e)}),200,{trailing:!0,leading:!0}))},e.prototype.destroy=function(){var e=this.get("timebar");e&&e.destory&&e.destory(),t.prototype.destroy.call(this);var n=this.get("timeBarContainer");if(n){var r=this.get("container");r||(r=this.get("graph").get("container")),(0,_.isString)(r)&&(r=document.getElementById(r)),r.removeChild(n)}},e}(GS);const sk=ak;var uk=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),lk=su.applyMatrix,ck=function(t){function e(e){return t.call(this,e)||this}return uk(e,t),e.prototype.getDefaultCfgs=function(){return{container:null,className:"g6-minimap",viewportClassName:"g6-minimap-viewport",width:200,delegateStyle:{fill:"#40a9ff",stroke:"#096dd9"},refresh:!0}},e.prototype.getEvents=function(){return{beforepaint:"updateViewport",beforeanimate:"disableRefresh",afteranimate:"enableRefresh",viewportchange:"disableOneRefresh"}},e.prototype.disableRefresh=function(){this.set("refresh",!1)},e.prototype.enableRefresh=function(){this.set("refresh",!0),this.updateCanvas()},e.prototype.disableOneRefresh=function(){this.set("viewportChange",!0)},e.prototype.initViewport=function(){var t=this,e=this._cfgs,n=e.graph;if(!this.destroyed){var r=this.get("container");(0,_.isString)(r)&&(r=document.getElementById(r));var i=RS("<div class=".concat(e.viewportClassName,"\n      style='position:absolute;\n        left:0;\n        top:0;\n        box-sizing:border-box;\n        border: 2px solid #1980ff'>\n      </div>")),o=0,a=0,s=!1,u=0,l=0,c=0,h=0,f=0,p=0;r.addEventListener("mousedown",(function(r){if(e.refresh=!1,r.target===i){var u=i.style;c=parseInt(u.width,10),h=parseInt(u.height,10);var l=t.get("width"),d=t.get("height");c>l||h>d||(p=n.getZoom(),f=t.get("ratio"),s=!0,o=r.clientX,a=r.clientY)}}),!1),r.addEventListener("mousemove",(function(e){if(s&&!(0,_.isNil)(e.clientX)&&!(0,_.isNil)(e.clientY)){var r=t.get("width"),d=t.get("height"),g=i.style;u=parseInt(g.left,10),l=parseInt(g.top,10),c=parseInt(g.width,10),h=parseInt(g.height,10);var v=o-e.clientX,m=a-e.clientY;u-v<0?v=u:u-v+c>=r&&(v=0),l-m<0?m=l:l-m+h>=d&&(m=0),l-=m,jS(i,{left:"".concat(u-=v,"px"),top:"".concat(l,"px")}),n.translate(v*p/f,m*p/f),o=e.clientX,a=e.clientY}}),!1),r.addEventListener("mouseleave",(function(){s=!1,e.refresh=!0}),!1),r.addEventListener("mouseup",(function(){s=!1,e.refresh=!0}),!1),this.set("viewport",i),r.appendChild(i)}},e.prototype.updateViewport=function(){if(!this.destroyed){var t=this.get("ratio"),e=this.get("width"),n=this.get("height"),r=this.get("graph"),i=r.get("width"),o=i/r.get("height"),a=r.getGroup(),s=a.getCanvasBBox(),u=[(s.minX+s.maxX)/2,(s.minY+s.maxY)/2],l=[s.maxX-s.minX,s.maxY-s.minY],c={centerX:u[0],centerY:u[1],width:0,height:0,minX:0,minY:0};s[0]/s[1]>o?(c.width=l[0],c.height=c.width/o):(c.height=l[1],c.width=c.height*o),c.minX=u[0]-c.width/2,c.minY=u[1]-c.height/2;var h=a.getMatrix();h||(h=[1,0,0,0,1,0,0,0,1]);var f=D([1,0,0,0,1,0,0,0,1],h),p=lk({x:c.minX,y:c.minY},f),d=r.getCanvasByPoint(p.x,p.y),g=this.get("viewport");g||this.initViewport();var v=i/c.width,m=v*e,y=v*n,_=e*-d.x/c.width,b=n*-d.y/c.height,x=_+m,w=b+y;_<0&&(m+=_,_=0),x>e&&(m-=x-e),b<0&&(y+=b,b=0),w>n&&(y-=w-n),this.set("ratio",t),jS(g,{left:"".concat(_,"px"),top:"".concat(b,"px"),width:"".concat(m,"px"),height:"".concat(y,"px")})}},e.prototype.init=function(){this.initContainer()},e.prototype.initContainer=function(){var t=this,e=t.get("graph"),n=e.get("width"),r=e.get("height")/n,i=t.get("className"),o=t.get("container"),a=t.get("width"),s=t.get("height");a||s||(a=200),a?(s=r*a,t.set("height",s)):(a=1/r*s,t.set("width",a));var u=RS("<div class='".concat(i,"' style='width: ").concat(a,"px; height: ").concat(s,"px; overflow: hidden; position: relative;'></div>"));(0,_.isString)(o)&&(o=document.getElementById(o)),o?o.appendChild(u):e.get("container").appendChild(u),t.set("container",u);var l=RS('<div class="g6-minimap-container" style="position: relative; width: 100%; height: 100%; text-align: center; display: table;"></div>');u.appendChild(l);var c=RS('<span style="display: table-cell; vertical-align: middle; "></span>');l.appendChild(c),t.set("containerDOM",l),t.set("containerSpan",c);var h=RS('<img alt="" src="'.concat(this.get("graphImg"),'" style="display: inline-block; user-select: none;" draggable="false" />'));t.set("imgDOM",h),t.updateImgSize(),c.appendChild(h),t.updateCanvas()},e.prototype.updateImgSize=function(){var t=this,e=t.get("imgDOM"),n=t.get("width"),r=t.get("height");e.onload=function(){var t=function(t,e){var n,r;if(t.naturalWidth)n=t.naturalWidth,r=t.naturalHeight;else{var i=new Image;i.src=t.src,i.onload=function(){}}return[n,r]}(e);t[0]>t[1]?e.width=n:e.height=r}},e.prototype.updateCanvas=function(){if(this.get("refresh")){var t=this.get("graph");if(!t.get("destroyed")){this.get("viewportChange")&&(this.set("viewportChange",!1),this.updateViewport());var e=this.get("width")/t.get("canvas").getCanvasBBox().width;this.set("ratio",e),this.updateViewport()}}},e.prototype.getViewport=function(){return this.get("viewport")},e.prototype.getContainer=function(){return this.get("container")},e.prototype.updateGraphImg=function(t){var e=this;e.get("imgDOM").remove(),e.set("graphImg",t);var n=RS('<img alt="" src="'.concat(t,'" style="display: inline-block;" ondragstart="return false;" onselectstart="return false;"/>'));e.set("imgDOM",n),n.src=t,e.updateImgSize(),e.get("containerSpan").appendChild(n),e.updateCanvas()},e.prototype.destroy=function(){var t=this.get("container");t.parentNode.removeChild(t)},e}(GS);const hk=ck;var fk=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pk=function(){return pk=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},pk.apply(this,arguments)},dk=su.distance,gk={stroke:"#000",strokeOpacity:.8,lineWidth:2,fillOpacity:1,fill:"#fff"},vk=function(t){function e(e){return t.call(this,e)||this}return fk(e,t),e.prototype.getDefaultCfgs=function(){return{type:"both",trigger:"mousemove",r:60,delegateStyle:(0,_.clone)(gk),showLabel:"edge",scaleRBy:"wheel"}},e.prototype.getEvents=function(){var t;switch(this.get("trigger")){case"click":t={click:"filter"};break;case"drag":t={click:"createDelegate"};break;default:t={mousemove:"filter"}}return t},e.prototype.init=function(){var t=this,e=t.get("showLabel"),n="node"===e||"both"===e,r="edge"===e||"both"===e;t.set("showNodeLabel",n),t.set("showEdgeLabel",r),t.get("shouldShow")||t.set("shouldShow",(function(){return!0}))},e.prototype.createDelegate=function(t){var e=this,n=e.get("delegate");n&&!n.destroyed||(e.filter(t),(n=e.get("delegate")).on("dragstart",(function(t){})),n.on("drag",(function(t){e.filter(t)})),"wheel"===this.get("scaleRBy")&&n.on("mousewheel",(function(t){e.scaleRByWheel(t)})))},e.prototype.scaleRByWheel=function(t){var e=this;if(t&&t.originalEvent){t.preventDefault&&t.preventDefault();var n,r=e.get("graph"),i=e.get("delegate");(i?(i.attr("x"),i.attr("y"),1):void 0)||r.getPointByClient(t.clientX,t.clientY),n=t.originalEvent.wheelDelta<0?.95:1/.95;var o=e.get("maxR"),a=e.get("minR"),s=e.get("r");(s>(o||r.get("height"))&&n>1||s<(a||.05*r.get("height"))&&n<1)&&(n=1),s*=n,e.set("r",s),e.filter(t)}},e.prototype.filter=function(t){var e=this,n=e.get("graph"),r=n.getNodes(),i={},o=e.get("r"),a=e.get("type"),s={x:t.x,y:t.y};e.updateDelegate(s,o);var u=e.get("shouldShow"),l=e.get("vShapes");l&&l.forEach((function(t){t.remove(),t.destroy()})),l=[],r.forEach((function(t){var e=t.getModel(),n=e.x,r=e.y;dk({x:n,y:r},s)<o&&(i[e.id]=t)}));var c=n.getEdges(),h=[];c.forEach((function(t){var e=t.getModel(),n=e.source,r=e.target;u(e)&&("only-source"===a||"one"===a?i[n]&&!i[r]&&h.push(t):"only-target"===a||"one"===a?i[r]&&!i[n]&&h.push(t):"both"===a&&i[n]&&i[r]&&h.push(t))}));var f=e.get("showNodeLabel"),p=e.get("showEdgelabel"),d=n.get("group");h.forEach((function(t){t.get("group").get("children").forEach((function(t){var e=t.get("type"),n=d.addShape(e,{attrs:t.attr()});l.push(n),f&&"text"===e&&n.set("visible",!0)}))})),Object.keys(i).forEach((function(t){var e=i[t].get("group").clone();if(d.add(e),l.push(e),p)for(var n=e.get("children"),r=0;r<n.length;r++){var o=n[r];"text"===o.get("type")&&o.set("visible",!0)}})),e.set("vShapes",l)},e.prototype.updateParams=function(t){var e=this,n=t.r,r=t.trigger,i=t.minR,o=t.maxR,a=t.scaleRBy,s=t.showLabel,u=t.shouldShow;if(isNaN(t.r)||e.set("r",n),isNaN(o)||e.set("maxR",o),isNaN(i)||e.set("minR",i),"mousemove"!==r&&"click"!==r||e.set("trigger",r),"wheel"===a||"unset"===a){e.set("scaleRBy",a),e.get("delegate").remove(),e.get("delegate").destroy();var l=e.get("dPercentText");l&&(l.remove(),l.destroy())}"node"!==s&&"both"!==s||e.set("showNodeLabel",!0),"edge"!==s&&"both"!==s||e.set("showEdgeLabel",!0),u&&e.set("shouldShow",u)},e.prototype.updateDelegate=function(t,e){var n=this,r=n.get("graph"),i=n.get("delegate");if(!i||i.destroyed){var o=r.get("group"),a=n.get("delegateStyle")||gk;i=o.addShape("circle",{attrs:pk({r:e,x:t.x,y:t.y},a),name:"lens-shape",draggable:!0}),"drag"!==this.get("trigger")&&"wheel"===this.get("scaleRBy")&&i.on("mousewheel",(function(t){n.scaleRByWheel(t)}))}else i.attr({x:t.x,y:t.y,r:e});n.set("delegate",i)},e.prototype.clear=function(){var t=this,e=t.get("vShapes");e&&e.forEach((function(t){t.remove(),t.destroy()})),e=[],t.set("vShapes",e);var n=t.get("delegate");n&&!n.destroyed&&(n.remove(),n.destroy())},e.prototype.destroy=function(){this.clear()},e}(GS);const mk=vk;var yk=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_k=su.pointLineDistance,bk={stroke:"#FA8C16",lineWidth:1},xk=function(t){function e(e){return t.call(this,e)||this}return yk(e,t),e.prototype.getDefaultCfgs=function(){return{line:bk,itemAlignType:"center",tolerance:5,horizontalLines:{},verticalLines:{},alignLines:[]}},e.prototype.init=function(){},e.prototype.getEvents=function(){return{"node:dragstart":"onDragStart","node:drag":"onDrag","node:dragend":"onDragEnd"}},e.prototype.onDragStart=function(){this.initBoxLine()},e.prototype.onDrag=function(t){var e=t.item,n=(e.get("delegateShape")||e).getBBox(),r=e.getModel(),i=r.x-n.x,o=r.y-n.y;this.show({x:n.minX+i,y:n.minY+o},{width:n.width,height:n.height})},e.prototype.onDragEnd=function(){this.destory()},e.prototype.initBoxLine=function(){var t=this._cfgs,e=t.horizontalLines,n=t.verticalLines,r=t.itemAlignType;this.get("graph").getNodes().forEach((function(t){var i=t.getBBox(),o=t.get("id");!0===r||"horizontal"===r?(e["".concat(o,"tltr")]=[i.minX,i.minY,i.maxX,i.minY,t],e["".concat(o,"lcrc")]=[i.minX,i.centerY,i.maxX,i.centerY,t],e["".concat(o,"blbr")]=[i.minX,i.maxY,i.maxX,i.maxY,t]):"center"===r&&(e["".concat(o,"lcrc")]=[i.minX,i.centerY,i.maxX,i.centerY,t]),!0===r||"vertical"===r?(n["".concat(o,"tlbl")]=[i.minX,i.minY,i.minX,i.maxY,t],n["".concat(o,"tcbc")]=[i.centerX,i.minY,i.centerX,i.maxY,t],n["".concat(o,"trbr")]=[i.maxX,i.minY,i.maxX,i.maxY,t]):"center"===r&&(n["".concat(o,"tcbc")]=[i.centerX,i.minY,i.centerX,i.maxY,t])}))},e.prototype.show=function(t,e){var n=(0,_.mix)({},t);return this.itemAlign(t,e,n),t},e.prototype.itemAlign=function(t,e,n){var r=this,i=this._cfgs,o=i.horizontalLines,a=i.verticalLines,s=i.tolerance,u={x:n.x+e.width/2,y:n.y},l={x:n.x+e.width/2,y:n.y+e.height/2},c={x:n.x+e.width/2,y:n.y+e.height},h={x:n.x,y:n.y+e.height/2},f={x:n.x+e.width,y:n.y+e.height/2},p=[],d=[],g=null;if(this.clearAlignLine(),(0,_.each)(o,(function(t){t[4].isVisible&&(p.push(r.getLineDisObject(t,u)),p.push(r.getLineDisObject(t,l)),p.push(r.getLineDisObject(t,c)))})),(0,_.each)(a,(function(t){t[4].isVisible&&(d.push(r.getLineDisObject(t,h)),d.push(r.getLineDisObject(t,l)),d.push(r.getLineDisObject(t,f)))})),p.sort((function(t,e){return t.dis-e.dis})),d.sort((function(t,e){return t.dis-e.dis})),0!==p.length&&p[0].dis<s){t.y=p[0].line[1]-p[0].point.y+n.y,g={type:"item",horizontals:[p[0]]};for(var v=1;v<3;v++)p[0].dis===p[v].dis&&g.horizontals.push(p[v])}if(0!==d.length&&d[0].dis<s)for(t.x=d[0].line[0]-d[0].point.x+n.x,g?g.verticals=[d[0]]:g={type:"item",verticals:[d[0]]},v=1;v<3;v++)d[0].dis===d[v].dis&&g.verticals.push(d[v]);g&&(g.bbox=e,this.addAlignLine(g))},e.prototype.addAlignLine=function(t){var e=t.bbox,n=t.type,r=t.horizontals,i=t.verticals,o=this._cfgs,a=o.line,s=o.alignLines,u=this.get("graph").get("group");"item"===n&&(r&&(0,_.each)(r,(function(t){var n,r,i=t.line,o=t.point,l=(i[0]+i[2])/2;o.x<l?(n=o.x-e.width/2,r=Math.max(i[0],i[2])):(n=o.x+e.width/2,r=Math.min(i[0],i[2]));var c=(0,_.mix)({x1:n,y1:i[1],x2:r,y2:i[1]},a),h=u.addShape("line",{attrs:c,capture:!1});s.push(h)})),i&&(0,_.each)(i,(function(t){var n,r,i=t.line,o=t.point,l=(i[1]+i[3])/2;o.y<l?(n=o.y-e.height/2,r=Math.max(i[1],i[3])):(n=o.y+e.height/2,r=Math.min(i[1],i[3]));var c=(0,_.mix)({x1:i[0],y1:n,x2:i[0],y2:r},a),h=u.addShape("line",{attrs:c,capture:!1});s.push(h)})))},e.prototype.getLineDisObject=function(t,e){return{line:t,point:e,dis:_k(t,e)}},e.prototype.getContainer=function(){return this.get("container")},e.prototype.clearAlignLine=function(){var t=this._cfgs.alignLines;(0,_.each)(t,(function(t){t.remove()})),t.length=0},e.prototype.destory=function(){var t=this._cfgs,e=t.horizontalLines,n=t.verticalLines;this.get("graph").getNodes().forEach((function(t){var r=t.get("id");delete e["".concat(r,"tltr")],delete e["".concat(r,"lcrc")],delete e["".concat(r,"blbr")],delete n["".concat(r,"tlbl")],delete n["".concat(r,"tcbc")],delete n["".concat(r,"trbr")]})),this.clearAlignLine()},e}(GS);const wk=xk;var Ek=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Sk=function(){return Sk=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},Sk.apply(this,arguments)},Ck=["click","mouseenter"],Ak=function(t){function e(e){return t.call(this,e)||this}return Ek(e,t),e.prototype.getDefaultCfgs=function(){return{data:{},position:"top",padding:8,margin:8,offsetX:0,offsetY:0,layout:"horizontal",flipPage:!1,containerStyle:{},align:void 0,horiSep:8,vertiSep:8,filter:{enable:!1,trigger:"click"}}},e.prototype.init=function(){this.formatArray("padding"),this.formatArray("margin");var t=this.get("filter")||{};t.multiple&&"mouseenter"===t.trigger&&this.set("multiple",!1);var e=this.get("align");if(!e){var n=this.get("position").split("-");n.includes("left")&&(e="left"),e=n.includes("right")?"right":"center",this.set("align",e)}var r=this.get("graph").get("container"),i=RS("<div class='g6-legend-container' style=\"position: absolute;\"></div>");r.appendChild(i),this.set("container",i);var o=this.render();jS(i,this.getContainerPos(o)),this.bindEvents()},e.prototype.getContainerPos=function(t){void 0===t&&(t=[0,0]);var e=this.get("graph"),n=this.get("offsetX"),r=this.get("offsetY"),i=this.get("margin"),o=this.get("position").split("-"),a={top:0,right:1,bottom:2,left:3},s={left:(e.getWidth()-t[0])/2+0,top:(e.getHeight()-t[1])/2+0};return o.forEach((function(n){var r=i[a[n]],o=n;switch(n){case"top":case"left":r+=0;break;case"bottom":r=e.getHeight()-t[1]-r+0,o="top";break;default:r=e.getWidth()-t[0]-r+0,o="left"}s[o]=r})),s.top+=r+e.getContainer().offsetTop,s.left+=n+e.getContainer().offsetLeft,Object.keys(s).forEach((function(t){s[t]="".concat(s[t],"px")})),s},e.prototype.bindEvents=function(){var t=this,e=t.get("filter");if(e&&e.enable){var n=e.trigger||"click";Ck.includes(n)||(console.warn("Trigger for legend filterling must be 'click' or 'mouseenter', 'click' will take effect by default."),n="click");var r=t.get("legendCanvas");"mouseenter"===n?(r.on("node-container:mouseenter",(function(e){return t.filterData(e)})),r.on("node-container:mouseleave",(function(e){t.clearFilter(),t.clearActiveLegend()}))):(r.on("node-container:click",(function(e){return t.filterData(e)})),r.on("click",(function(e){e.target&&e.target.isCanvas&&e.target.isCanvas()&&(t.clearFilter(),t.clearActiveLegend())})))}},e.prototype.changeData=function(t){this.set("data",t);var e=this.render();jS(this.get("container"),this.getContainerPos(e))},e.prototype.activateLegend=function(t){var e=this.get("filter");(null==e?void 0:e.multiple)||this.clearActiveLegend();var n=t.get("parent");n.get("active")?(n.set("active",!1),this.findLegendItemsByState("active").length&&n.set("inactive",!0)):(n.set("inactive",!1),n.set("active",!0)),this.findLegendItemsByState("active").length?this.findLegendItemsByState("active","all",!1).forEach((function(t){t.set("inactive",!0)})):this.clearActiveLegend();var r=(null==e?void 0:e.lengedStateStyles)||{},i=(null==r?void 0:r.inactive)||{opacity:.5,"text-shape":{opacity:.5}},o=i["text-shape"]||{};this.findLegendItemsByState("inactive").forEach((function(t){var e=t.get("children"),n=e[0],r=e[1];n.attr(Sk(Sk({},n.get("oriAttrs")),i)),r.attr(Sk(Sk({},r.get("oriAttrs")),o))}));var a=(null==r?void 0:r.active)||{stroke:"#000",lineWidth:2,"text-shape":{fontWeight:"bold"}},s=a["text-shape"]||{};this.findLegendItemsByState("active").forEach((function(t){var e=t.get("children"),n=e[0],r=e[1];n.attr(Sk(Sk({},n.get("oriAttrs")),a)),r.attr(Sk(Sk({},r.get("oriAttrs")),s))}))},e.prototype.findLegendItemsByState=function(t,e,n){void 0===e&&(e="all"),void 0===n&&(n=!0);var r=this.get("legendCanvas").find((function(t){return"root"===t.get("name")})),i=r.find((function(t){return"node-group"===t.get("name")})),o=r.find((function(t){return"edge-group"===t.get("name")}));return"node"===e?i.get("children").filter((function(e){return!!e.get(t)===n})):"edge"===e?o.get("children").filter((function(e){return!!e.get(t)===n})):i.get("children").filter((function(e){return!!e.get(t)===n})).concat(o.get("children").filter((function(e){return!!e.get(t)===n})))},e.prototype.clearActiveLegend=function(){var t=this.get("legendCanvas").find((function(t){return"root"===t.get("name")}));[t.find((function(t){return"node-group"===t.get("name")})),t.find((function(t){return"edge-group"===t.get("name")}))].forEach((function(t){t.get("children").forEach((function(t){t.set("active",!1),t.set("inactive",!1);var e=t.get("children"),n=e[0],r=e[1];n.attr(n.get("oriAttrs")),r.attr(r.get("oriAttrs"))}))}))},e.prototype.filterData=function(t){var e=this.get("filter"),n=null==e?void 0:e.filterFunctions;if(e&&n){var r=this.get("legendCanvas"),i=this.get("graph"),o=e.graphActiveState||"active",a=e.graphInactiveState||"inactive",s=e.multiple;this.clearFilter(),s||this.clearActiveLegend(),this.activateLegend(t.target);var u=r.find((function(t){return"root"===t.get("name")})),l=u.find((function(t){return"node-group"===t.get("name")})),c=u.find((function(t){return"edge-group"===t.get("name")})),h=l.get("children").filter((function(t){return t.get("active")})),f=c.get("children").filter((function(t){return t.get("active")})),p=0,d=["getNodes","getEdges"];d.forEach((function(t){i[t]().forEach((function(e){var r=!1;("getNodes"===t?h:f).forEach((function(t){var i=n[t.get("id")];r=r||i(e.getModel())})),r?(i.setItemState(e,a,!1),i.setItemState(e,o,!0),p++):(i.setItemState(e,o,!1),i.setItemState(e,a,!0))}))})),p||d.forEach((function(t){i[t]().forEach((function(t){i.clearItemStates(t,[a])}))}))}},e.prototype.clearFilter=function(){var t=this.get("graph"),e=this.get("filter");if(e){var n=e.graphActiveState||"active",r=e.graphInactiveState||"inactive";t.getNodes().forEach((function(e){t.clearItemStates(e,[n,r])})),t.getEdges().forEach((function(e){t.clearItemStates(e,[n,r])}))}},e.prototype.render=function(){var t=this;this.processData();var e=this.get("legendCanvas");if(!e){var n=(e=new Dl({container:this.get("container"),width:200,height:200})).addGroup({name:"root"});n.addGroup({name:"node-group"}),n.addGroup({name:"edge-group"}),this.set("legendCanvas",e)}var r=e.find((function(t){return"root"===t.get("name")})),i=r.find((function(t){return"node-group"===t.get("name")})),o=r.find((function(t){return"edge-group"===t.get("name")})),a=this.get("itemsData"),s=[i,o];["nodes","edges"].forEach((function(e,n){a[e].forEach((function(r){var i,o,a=s[n].addGroup({id:r.id,name:"node-container"}),u=r.type,l=t.getShapeSize(r),c=l.width,h=l.height,f=l.r,p=t.getStyle(e.substr(0,4),r);switch(r.type){case"circle":default:o={r:f,x:0,y:0};break;case"rect":o={width:c,height:h,x:-c/2,y:-h/2};break;case"ellipse":o={r1:c,r2:h,x:0,y:0};break;case"line":o={x1:-c/2,y1:0,x2:c/2,y2:0},u="line";break;case"quadratic":o={path:[["M",-c/2,0],["Q",0,c/2,c/2,0]]},u="path";break;case"cubic":o={path:[["M",-c/2,0],["C",-c/6,c/2,c/6,-c/2,c/2,0]]},u="path"}var d=a.addShape(u,{attrs:Sk(Sk({},o),p),name:"".concat(r.type,"-node-keyShape"),oriAttrs:Sk({opacity:1},p)});if(r.label){var g=d.getBBox(),v=(null===(i=r.labelCfg)||void 0===i?void 0:i.style)||{},m=Sk({textAlign:"begin",fontSize:12,textBaseline:"middle",fill:"#000",opacity:1,fontWeight:"normal"},v);a.addShape("text",{attrs:Sk({x:g.maxX+4,y:0,text:r.label},m),className:"legend-label",name:"".concat(r.type,"-node-text"),oriAttrs:m})}}))}));var u,l=this.get("padding"),c=r.find((function(t){return"title-container"===t.get("name")})),h={height:0,maxY:0,width:0};if(this.get("title")){c||(c=r.addGroup({name:"title-container"}));var f={fontSize:20,fontFamily:"Arial",fontWeight:300,textBaseline:"top",textAlign:"center",fill:"#000",x:0,y:l[0]},p=this.get("titleConfig")||{},d=Object.assign(f,p.style||{});u=c.addShape("text",{attrs:Sk({text:this.get("title")},d)}),h=c.getCanvasBBox(),c.setMatrix([1,0,0,0,1,0,p.offsetX,p.offsetY,1])}this.layoutItems();var g=r.getCanvasBBox(),v=i.getCanvasBBox(),m=v.minX<0?Math.abs(v.minX)+l[3]:l[3],y=h.maxY<v.minY?Math.abs(h.maxY-v.minY)+l[0]:h.maxY+l[0],_=[1,0,0,0,1,0,m,y,1];i.setMatrix(_);var b=[(g=r.getCanvasBBox()).minX+g.width+l[1],g.minY+g.height+l[2]];if(u){p=Sk({position:"center",offsetX:0,offsetY:0},this.get("titleConfig")),h=c.getCanvasBBox();var x=c.getMatrix()||[1,0,0,0,1,0,0,0,1];"center"===p.position?x[6]=b[0]/2+p.offsetX:"right"===p.position?(x[6]=b[0]-l[3]+p.offsetX,u.attr({textAlign:"right"})):(x[6]=l[3]+p.offsetX,u.attr({textAlign:"left"})),c.setMatrix(x),h=c.getCanvasBBox(),_=[1,0,0,0,1,0,m=v.minX<0?Math.abs(v.minX)+l[3]:l[3],y=v.minY<h.maxY?Math.abs(h.maxY-v.minY)+l[0]:h.maxY+l[0],1],i.setMatrix(_);var w=[1,0,0,0,1,0,m,y,1];"vertical"===this.get("layout")?w[6]+=v.maxX+this.get("horiSep"):w[7]+=v.maxY+this.get("vertiSep"),o.setMatrix(w)}else{v=i.getCanvasBBox();var E=[1,0,0,0,1,0,0,0,1];"vertical"===this.get("layout")?E[6]+=_[6]+v.maxX+this.get("horiSep"):E[7]+=_[7]+v.maxY+this.get("vertiSep"),o.setMatrix(E)}g=r.getCanvasBBox(),v=i.getCanvasBBox(),_=i.getMatrix()||[1,0,0,0,1,0,0,0,1];var S=o.getMatrix()||[1,0,0,0,1,0,0,0,1],C=o.getCanvasBBox();b=[Math.max(v.width+_[6],C.width+S[6])+l[1],Math.max(v.height+_[7],C.height+S[7])+l[2]],e.changeSize(b[0],b[1]);var A=this.get("containerStyle"),T=r.getMatrix()||[1,0,0,0,1,0,0,0,1],k=su.invertMatrix({x:0,y:0},T);return r.addShape("rect",{attrs:Sk({x:k.x+(A.lineWidth||1),y:k.y+(A.lineWidth||1),width:b[0]-2*(A.lineWidth||1),height:b[1]-2*(A.lineWidth||1),fill:"#f00",stroke:"#000",lineWidth:1,opacity:.5},A),name:"legend-back-rect",capture:!1}).toBack(),b},e.prototype.layoutItems=function(){var t=this.get("legendCanvas"),e=this.get("horiSep"),n=this.get("vertiSep"),r=this.get("layout"),i=this.get("align"),o=[0,0],a=t.find((function(t){return"root"===t.get("name")})),s=a.find((function(t){return"node-group"===t.get("name")})),u=a.find((function(t){return"edge-group"===t.get("name")})),l={min:0,max:-1/0},c=-1/0;s.get("children").forEach((function(t,i){0===i&&(l.min=o[0]);var a=t.get("children")[0],s=t.getCanvasBBox(),u=a.getBBox(),h=u.width,f=u.height,p=0,d=0,g=0;"vertical"===r?(d=o[1],g=o[0]+h/2,o[0]=g+s.height+n,p=s.maxX+d+h/2):(d=o[0]+h/2,g=o[1],o[0]=d+s.width+e,p=s.maxY+g+f/2),o[0]>l.max&&(l.max=o[0]),p>c&&(c=p),t.setMatrix([1,0,0,0,1,0,d,g,1])}));var h=l.max-l.min,f={min:0,max:-1/0},p=s.getCanvasBBox();o[0]=0,o[1]="vertical"===r?p.maxX+e:p.maxY+n,u.get("children").forEach((function(t,i){0===i&&(f.min=o[0]);var a=t.get("children")[0],s=t.getCanvasBBox(),u=a.getBBox(),l=u.width,c=u.height,h=0,p=0;"vertical"===r?(h=o[1],p=o[0],o[0]=p+s.height+n,t.setMatrix([1,0,0,0,1,0,0,p+c/2,1])):(h=o[0],p=o[1],o[0]=h+s.width+e,t.setMatrix([1,0,0,0,1,0,h+l/2,0,1])),o[0]>f.max&&(f.max=o[0])}));var d=f.max-f.min;if(i&&""!==i&&"left"!==i){var g=h-d,v="center"===i?Math.abs(g)/2:Math.abs(g);(g<0?s:u).get("children").forEach((function(t){var e=t.getMatrix()||[1,0,0,0,1,0,0,0,1];"vertical"===r?e[7]+=v:e[6]+=v,t.setMatrix(e)}))}},e.prototype.processData=function(){var t=this.get("data"),e={nodes:[],edges:[]};t.nodes&&(t.nodes.sort((function(t,e){return t.order-e.order})),t.nodes.forEach((function(t){var n,r,i,o,a,s=t.size||[(null===(n=t.style)||void 0===n?void 0:n.width)||(null===(r=t.style)||void 0===r?void 0:r.r)||8,(null===(i=t.style)||void 0===i?void 0:i.height)||(null===(o=t.style)||void 0===o?void 0:o.r)||8],u=(null===(a=t.labelCfg)||void 0===a?void 0:a.style)||{};e.nodes.push({id:t.id||(0,_.uniqueId)(),type:t.type||"circle",style:Sk({},t.style),order:t.order,label:t.label,itemType:"node",size:s,labelCfg:{position:"right",style:Sk({fontFamily:"Arial"},u)}})}))),t.edges&&(t.edges.sort((function(t,e){return t.order-e.order})),t.edges.forEach((function(t){var n,r,i=t.type||"line";"cubic-horizontal"===t.type&&(i="cubic");var o=(null===(n=t.labelCfg)||void 0===n?void 0:n.style)||{},a=t.size||[(null===(r=t.style)||void 0===r?void 0:r.width)||8,1];e.edges.push({id:t.id||(0,_.uniqueId)(),type:i,size:a,style:Sk({lineWidth:(0,_.isArray)(a)?a[1]:1},t.style),order:t.order,label:t.label,itemType:"edge",labelCfg:{position:"right",style:Sk({fontFamily:"Arial"},o)}})}))),this.set("itemsData",e)},e.prototype.getContainer=function(){return this.get("container")},e.prototype.formatArray=function(t){var e=this.get(t);if((0,_.isNumber)(e))this.set(t,[e,e,e,e]);else if((0,_.isArray)(e))switch(e.length){case 0:this.set(t,[0,0,0,0]);break;case 1:this.set(t,[e[0],e[0],e[0],e[0]]);break;case 2:this.set(t,[e[0],e[1],e[0],e[1]]);break;case 3:this.set(t,[e[0],e[1],e[2],e[1]])}return this.get(t)},e.prototype.getShapeSize=function(t){var e,n,r;return t.size&&((0,_.isArray)(t.size)?(e=t.size[0],n=t.size[1]||t.size[0],r=t.size[0]/2):(0,_.isNumber)(t.size)&&(e=t.size,n=t.size,r=t.size/2)),t.style&&(t.style.width&&(e=t.style.width),t.style.height&&(n=t.style.height),t.style.r&&(r=t.style.r)),r||(r=5),e||(e=r),n||(n=r),{width:e,height:n,r}},e.prototype.getStyle=function(t,e){return Sk(Sk({},"node"===t?{fill:"#ccc",lineWidth:0}:{stroke:"#000",lineWidth:1}),e.style||{})},e.prototype.destroy=function(){var t=this.get("graph").get("container"),e=this.get("container");t.removeChild(e)},e}(GS);const Tk={PluginBase:GS,Menu:$S,Grid:YS,Minimap:oC,Bundling:cC,ToolBar:yC,Tooltip:xC,Fisheye:gC,TimeBar:sk,ImageMinimap:hk,EdgeFilterLens:mk,SnapLine:wk,Legend:Ak};fu("circle",{options:{size:vu.defaultNode.size,style:{x:0,y:0,stroke:vu.defaultNode.style.stroke,fill:vu.defaultNode.style.fill,lineWidth:vu.defaultNode.style.lineWidth},labelCfg:{style:{fill:vu.nodeLabel.style.fill,fontSize:vu.nodeLabel.style.fontSize,fontFamily:vu.windowFontFamily}},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:vu.defaultNode.linkPoints.size,lineWidth:vu.defaultNode.linkPoints.lineWidth,fill:vu.defaultNode.linkPoints.fill,stroke:vu.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20},stateStyles:(0,y.__assign)({},vu.nodeStateStyles)},shapeType:"circle",labelPosition:"center",drawShape:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).icon,r=void 0===n?{}:n,i=this.getShapeStyle(t),o=(0,_.deepMix)({},r,t.icon),a="".concat(this.type,"-keyShape"),s=e.addShape("circle",{attrs:i,className:a,name:a,draggable:!0});e.shapeMap[a]=s;var u=o.width,l=o.height,c=o.show,h=o.text;if(c){var f="".concat(this.type,"-icon");e.shapeMap[f]=h?e.addShape("text",{attrs:(0,y.__assign)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},o),className:f,name:f,draggable:!0}):e.addShape("image",{attrs:(0,y.__assign)({x:-u/2,y:-l/2},o),className:f,name:f,draggable:!0})}return this.drawLinkPoints(t,e),s},drawLinkPoints:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).linkPoints;if(n){var r=n||{},i=r.top,o=r.left,a=r.right,s=r.bottom,u=r.size,l=r.r,c=(0,y.__rest)(r,["top","left","right","bottom","size","r"]),h=this.getSize(t)[0]/2;if(o){var f="link-point-left";e.shapeMap[f]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:-h,y:0,r:u/2||l||5}),className:f,name:f,isAnchorPoint:!0})}if(a){var p="link-point-right";e.shapeMap[p]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:h,y:0,r:u/2||l||5}),className:p,name:p,isAnchorPoint:!0})}if(i){var d="link-point-top";e.shapeMap[d]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:0,y:-h,r:u/2||l||5}),className:d,name:d,isAnchorPoint:!0})}if(s){var g="link-point-bottom";e.shapeMap[g]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:0,y:h,r:u/2||l||5}),className:g,name:g,isAnchorPoint:!0})}}},getShapeStyle:function(t){var e=(this.mergeStyle||this.getOptions(t)).style,n={stroke:t.color},r=(0,_.deepMix)({},e,n),i=this.getSize(t)[0]/2;return(0,y.__assign)({x:0,y:0,r:i},r)},update:function(t,e,n){var r=e.getContainer(),i=this.getSize(t),o=(0,y.__assign)({},t.style);void 0===t.style.stroke&&t.color&&(o.stroke=t.color),void 0!==t.style.r||isNaN(i[0])||(o.r=i[0]/2),this.updateShape(t,e,o,!0,n),this.updateLinkPoints(t,r)}},"single-node"),fu("rect",{options:{size:[100,30],style:{radius:0,stroke:vu.defaultNode.style.stroke,fill:vu.defaultNode.style.fill,lineWidth:vu.defaultNode.style.lineWidth},labelCfg:{style:{fill:vu.nodeLabel.style.fill,fontSize:vu.nodeLabel.style.fontSize,fontFamily:vu.windowFontFamily}},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:vu.defaultNode.linkPoints.size,lineWidth:vu.defaultNode.linkPoints.lineWidth,fill:vu.defaultNode.linkPoints.fill,stroke:vu.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20},anchorPoints:[[0,.5],[1,.5]],stateStyles:(0,y.__assign)({},vu.nodeStateStyles)},shapeType:"rect",labelPosition:"center",drawShape:function(t,e){var n=this.getShapeStyle(t),r=e.addShape("rect",{attrs:n,className:"".concat(this.type,"-keyShape"),name:"".concat(this.type,"-keyShape"),draggable:!0});return e.shapeMap["".concat(this.type,"-keyShape")]=r,this.drawLinkPoints(t,e),r},drawLinkPoints:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).linkPoints,r=void 0===n?{}:n,i=r.top,o=r.left,a=r.right,s=r.bottom,u=r.size,l=r.r,c=(0,y.__rest)(r,["top","left","right","bottom","size","r"]),h=this.getSize(t),f=h[0],p=h[1];o&&(e.shapeMap["link-point-left"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:-f/2,y:0,r:u/2||l||5}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0})),a&&(e.shapeMap["link-point-right"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:f/2,y:0,r:u/2||l||5}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0})),i&&(e.shapeMap["link-point-top"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:0,y:-p/2,r:u/2||l||5}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0})),s&&(e.shapeMap["link-point-bottom"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:0,y:p/2,r:u/2||l||5}),className:"link-point-bottom",name:"link-point-bottom",isAnchorPoint:!0}))},getShapeStyle:function(t){var e=(this.mergeStyle||this.getOptions(t)).style,n={stroke:t.color},r=(0,_.mix)({},e,n),i=this.getSize(t),o=r.width||i[0],a=r.height||i[1];return(0,y.__assign)({x:-o/2,y:-a/2,width:o,height:a},r)},update:function(t,e,n){var r=e.getContainer(),i=this.getOptions({}).style,o=this.getSize(t),a=e.get("keyShape");t.size||(o[0]=a.attr("width")||i.width,o[1]=a.attr("height")||i.height);var s={stroke:t.color,x:-o[0]/2,y:-o[1]/2,width:o[0],height:o[1]},u=(0,_.mix)({},i,a.attr(),s);u=(0,_.mix)(u,t.style),this.updateShape(t,e,u,!1,n),this.updateLinkPoints(t,r)}},"single-node"),fu("ellipse",{options:{size:[80,40],style:{x:0,y:0,stroke:vu.defaultNode.style.stroke,fill:vu.defaultNode.style.fill,lineWidth:vu.defaultNode.style.lineWidth},labelCfg:{style:{fill:vu.nodeLabel.style.fill,fontSize:vu.nodeLabel.style.fontSize,fontFamily:vu.windowFontFamily}},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:vu.defaultNode.linkPoints.size,lineWidth:vu.defaultNode.linkPoints.lineWidth,fill:vu.defaultNode.linkPoints.fill,stroke:vu.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20},stateStyles:(0,y.__assign)({},vu.nodeStateStyles)},shapeType:"ellipse",labelPosition:"center",drawShape:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).icon,r=void 0===n?{}:n,i=this.getShapeStyle(t),o=e.addShape("ellipse",{attrs:i,className:"ellipse-keyShape",name:"ellipse-keyShape",draggable:!0});e.shapeMap["ellipse-keyShape"]=o;var a=r.width,s=r.height,u=r.show,l=r.text;return u&&(e.shapeMap["".concat(this.type,"-icon")]=l?e.addShape("text",{attrs:(0,y.__assign)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},r),className:"".concat(this.type,"-icon"),name:"".concat(this.type,"-icon"),draggable:!0}):e.addShape("image",{attrs:(0,y.__assign)({x:-a/2,y:-s/2},r),className:"".concat(this.type,"-icon"),name:"".concat(this.type,"-icon"),draggable:!0})),this.drawLinkPoints(t,e),o},drawLinkPoints:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).linkPoints,r=void 0===n?{}:n,i=r.top,o=r.left,a=r.right,s=r.bottom,u=r.size,l=r.r,c=(0,y.__rest)(r,["top","left","right","bottom","size","r"]),h=this.getSize(t),f=h[0]/2,p=h[1]/2;o&&(e.shapeMap["link-point-left"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:-f,y:0,r:u/2||l||5}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0})),a&&(e.shapeMap["link-point-right"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:f,y:0,r:u/2||l||5}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0})),i&&(e.shapeMap["link-point-top"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:0,y:-p,r:u/2||l||5}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0})),s&&(e.shapeMap["link-point-bottom"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:0,y:p,r:u/2||l||5}),className:"link-point-bottom",name:"link-point-bottom",isAnchorPoint:!0}))},getShapeStyle:function(t){var e=(this.mergeStyle||this.getOptions(t)).style,n={stroke:t.color},r=(0,_.mix)({},e,n),i=this.getSize(t),o=i[0]/2,a=i[1]/2;return(0,y.__assign)({x:0,y:0,rx:o,ry:a},r)},update:function(t,e,n){var r=e.getContainer(),i=this.getOptions({}).style,o=this.getSize(t),a={stroke:t.color,rx:o[0]/2,ry:o[1]/2},s=e.get("keyShape"),u=(0,_.mix)({},i,s.attr(),a);u=(0,_.mix)(u,t.style),this.updateShape(t,e,u,!0,n),this.updateLinkPoints(t,r)}},"single-node"),fu("diamond",{options:{size:[80,80],style:{stroke:vu.defaultNode.style.stroke,fill:vu.defaultNode.style.fill,lineWidth:vu.defaultNode.style.lineWidth},labelCfg:{style:{fill:vu.nodeLabel.style.fill,fontSize:vu.nodeLabel.style.fontSize,fontFamily:vu.windowFontFamily}},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:vu.defaultNode.linkPoints.size,lineWidth:vu.defaultNode.linkPoints.lineWidth,fill:vu.defaultNode.linkPoints.fill,stroke:vu.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20},stateStyles:(0,y.__assign)({},vu.nodeStateStyles)},shapeType:"diamond",labelPosition:"center",drawShape:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).icon,r=void 0===n?{}:n,i=this.getShapeStyle(t),o=e.addShape("path",{attrs:i,className:"".concat(this.type,"-keyShape"),name:"".concat(this.type,"-keyShape"),draggable:!0});e.shapeMap["".concat(this.type,"-keyShape")]=o;var a=r.width,s=r.height,u=r.show,l=r.text;return u&&(e.shapeMap["".concat(this.type,"-icon")]=l?e.addShape("text",{attrs:(0,y.__assign)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},r),className:"".concat(this.type,"-icon"),name:"".concat(this.type,"-icon"),draggable:!0}):e.addShape("image",{attrs:(0,y.__assign)({x:-a/2,y:-s/2},r),className:"".concat(this.type,"-icon"),name:"".concat(this.type,"-icon"),draggable:!0})),this.drawLinkPoints(t,e),o},drawLinkPoints:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).linkPoints,r=void 0===n?{}:n,i=r.top,o=r.left,a=r.right,s=r.bottom,u=r.size,l=r.r,c=(0,y.__rest)(r,["top","left","right","bottom","size","r"]),h=this.getSize(t),f=h[0],p=h[1];o&&(e.shapeMap["link-point-left"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:-f/2,y:0,r:u/2||l||5}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0})),a&&(e.shapeMap["link-point-right"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:f/2,y:0,r:u/2||l||5}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0})),i&&(e.shapeMap["link-point-top"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:0,y:-p/2,r:u/2||l||5}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0})),s&&(e.shapeMap["link-point-bottom"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:0,y:p/2,r:u/2||l||5}),className:"link-point-bottom",name:"link-point-bottom",isAnchorPoint:!0}))},getPath:function(t){var e=this.getSize(t),n=e[0],r=e[1];return[["M",0,-r/2],["L",n/2,0],["L",0,r/2],["L",-n/2,0],["Z"]]},getShapeStyle:function(t){var e=(this.mergeStyle||this.getOptions(t)).style,n={stroke:t.color},r=(0,_.mix)({},e,n),i=this.getPath(t);return(0,y.__assign)({path:i},r)},update:function(t,e,n){var r=e.getContainer(),i=this.getOptions({}).style,o=this.getPath(t),a={stroke:t.color,path:o},s=e.get("keyShape"),u=(0,_.mix)({},i,s.attr(),a);u=(0,_.mix)(u,t.style),this.updateShape(t,e,u,!0,n),this.updateLinkPoints(t,r)}},"single-node"),fu("triangle",{options:{size:40,direction:"up",style:{stroke:vu.defaultNode.style.stroke,fill:vu.defaultNode.style.fill,lineWidth:vu.defaultNode.style.lineWidth},labelCfg:{style:{fill:vu.nodeLabel.style.fill,fontSize:vu.nodeLabel.style.fontSize},offset:15},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:vu.defaultNode.linkPoints.size,lineWidth:vu.defaultNode.linkPoints.lineWidth,fill:vu.defaultNode.linkPoints.fill,stroke:vu.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20,offset:6},stateStyles:(0,y.__assign)({},vu.nodeStateStyles)},shapeType:"triangle",labelPosition:"bottom",drawShape:function(t,e){var n=this.mergeStyle||this.getOptions(t),r=n.icon,i=void 0===r?{}:r,o=n.direction,a=this.getShapeStyle(t),s=t.direction||o,u=e.addShape("path",{attrs:a,className:"".concat(this.type,"-keyShape"),name:"".concat(this.type,"-keyShape"),draggable:!0});e.shapeMap["".concat(this.type,"-keyShape")]=u;var l=i.width,c=i.height,h=i.show,f=i.offset,p=i.text;if(h)if(p)e.shapeMap["".concat(this.type,"-icon")]=e.addShape("text",{attrs:(0,y.__assign)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},i),className:"".concat(this.type,"-icon"),name:"".concat(this.type,"-icon"),draggable:!0});else{var d=-l/2,g=-c/2;"up"!==s&&"down"!==s||(g+=f),"left"!==s&&"right"!==s||(d+=f),e.shapeMap["".concat(this.type,"-icon")]=e.addShape("image",{attrs:(0,y.__assign)({x:d,y:g},i),className:"".concat(this.type,"-icon"),name:"".concat(this.type,"-icon"),draggable:!0})}return this.drawLinkPoints(t,e),u},drawLinkPoints:function(t,e){var n=this.mergeStyle||this.getOptions(t),r=n.linkPoints,i=void 0===r?{}:r,o=n.direction,a=t.direction||o,s=i.top,u=i.left,l=i.right,c=i.bottom,h=i.size,f=i.r,p=(0,y.__rest)(i,["top","left","right","bottom","size","r"]),d=this.getSize(t)[0];if(u){var g=null,v=d*Math.sin(1/3*Math.PI),m=d*Math.sin(1/3*Math.PI);"up"===a?g=[-m,v]:"down"===a?g=[-m,-v]:"left"===a&&(g=[-m,m-v]),g&&(e.shapeMap["link-point-left"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},p),{x:g[0],y:g[1],r:h/2||f||5}),className:"link-point-left",name:"link-point-left"}))}if(l){var _=null;v=d*Math.sin(1/3*Math.PI),m=d*Math.sin(1/3*Math.PI),"up"===a?_=[m,v]:"down"===a?_=[m,-v]:"right"===a&&(_=[m,m-v]),_&&(e.shapeMap["link-point-right"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},p),{x:_[0],y:_[1],r:h/2||f||5}),className:"link-point-right",name:"link-point-right"}))}if(s){var b=null;v=d*Math.sin(1/3*Math.PI),m=d*Math.sin(1/3*Math.PI),"up"===a?b=[m-v,-v]:"left"===a?b=[m,-v]:"right"===a&&(b=[-m,-v]),b&&(e.shapeMap["link-point-top"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},p),{x:b[0],y:b[1],r:h/2||f||5}),className:"link-point-top",name:"link-point-top"}))}if(c){var x=null;v=d*Math.sin(1/3*Math.PI),m=d*Math.sin(1/3*Math.PI),"down"===a?x=[-m+v,v]:"left"===a?x=[m,v]:"right"===a&&(x=[-m,v]),x&&(e.shapeMap["link-point-bottom"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},p),{x:x[0],y:x[1],r:h/2||f||5}),className:"link-point-bottom",name:"link-point-bottom"}))}},getPath:function(t){var e=(this.mergeStyle||this.getOptions(t)).direction,n=t.direction||e,r=this.getSize(t)[0],i=r*Math.sin(1/3*Math.PI),o=r*Math.sin(1/3*Math.PI),a=[["M",-o,i],["L",0,-i],["L",o,i],["Z"]];return"down"===n?a=[["M",-o,-i],["L",o,-i],["L",0,i],["Z"]]:"left"===n?a=[["M",-o,o-i],["L",o,-o],["L",o,o],["Z"]]:"right"===n&&(a=[["M",o,o-i],["L",-o,o],["L",-o,-o],["Z"]]),a},getShapeStyle:function(t){var e=(this.mergeStyle||this.getOptions(t)).style,n={stroke:t.color},r=(0,_.mix)({},e,n),i=this.getPath(t);return(0,y.__assign)({path:i},r)},update:function(t,e,n){var r=e.getContainer(),i=this.getOptions({}).style,o=this.getPath(t),a={stroke:t.color,path:o},s=e.get("keyShape"),u=(0,_.mix)({},i,s.attr(),a);u=(0,_.mix)(u,t.style),this.updateShape(t,e,u,!0,n),this.updateLinkPoints(t,r)},updateLinkPoints:function(t,e){var n=this.getOptions({}),r=n.linkPoints,i=n.direction,o=t.direction||i,a=e.shapeMap["link-point-left"]||e.find((function(t){return"link-point-left"===t.get("className")})),s=e.shapeMap["link-point-right"]||e.find((function(t){return"link-point-right"===t.get("className")})),u=e.shapeMap["link-point-top"]||e.find((function(t){return"link-point-top"===t.get("className")})),l=e.shapeMap["link-point-bottom"]||e.find((function(t){return"link-point-bottom"===t.get("className")})),c=r,h=a||s||u||l;h&&(c=h.attr());var f=(0,_.mix)({},c,t.linkPoints),p=f.fill,d=f.stroke,g=f.lineWidth,v=f.size/2;v||(v=f.r);var m=t.linkPoints?t.linkPoints:{left:void 0,right:void 0,top:void 0,bottom:void 0},b=m.left,x=m.right,w=m.top,E=m.bottom,S=this.getSize(t)[0],C={r:v,fill:p,stroke:d,lineWidth:g},A=null,T=S*Math.sin(1/3*Math.PI),k=S*Math.sin(1/3*Math.PI);"up"===o?A=[-k,T]:"down"===o?A=[-k,-T]:"left"===o&&(A=[-k,k-T]),A&&(a?b||void 0===b?a.attr((0,y.__assign)((0,y.__assign)({},C),{x:A[0],y:A[1]})):(a.remove(),delete e.shapeMap["link-point-left"]):b&&(e.shapeMap["link-point-left"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},C),{x:A[0],y:A[1]}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0})));var M=null;"up"===o?M=[k,T]:"down"===o?M=[k,-T]:"right"===o&&(M=[k,k-T]),M&&(s?x||void 0===x?s.attr((0,y.__assign)((0,y.__assign)({},C),{x:M[0],y:M[1]})):(s.remove(),delete e.shapeMap["link-point-right"]):x&&(e.shapeMap["link-point-right"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},C),{x:M[0],y:M[1]}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0})));var P=null;"up"===o?P=[k-T,-T]:"left"===o?P=[k,-T]:"right"===o&&(P=[-k,-T]),P&&(u?w||void 0===w?u.attr((0,y.__assign)((0,y.__assign)({},C),{x:P[0],y:P[1]})):(u.remove(),delete e.shapeMap["link-point-top"]):w&&(e.shapeMap["link-point-top"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},C),{x:P[0],y:P[1]}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0})));var I=null;"down"===o?I=[-k+T,T]:"left"===o?I=[k,T]:"right"===o&&(I=[-k,T]),I&&(l?E||void 0===E?l.attr((0,y.__assign)((0,y.__assign)({},C),{x:I[0],y:I[1]})):(l.remove(),delete e.shapeMap["link-point-bottom"]):E&&(e.shapeMap["link-point-bottom"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},C),{x:I[0],y:I[1]}),className:"link-point-bottom",name:"link-point-bottom",isAnchorPoint:!0})))}},"single-node"),fu("modelRect",{options:{size:[185,70],style:{radius:5,stroke:"#69c0ff",fill:"#ffffff",lineWidth:vu.defaultNode.style.lineWidth,fillOpacity:1},labelCfg:{style:{fill:"#595959",fontSize:14,fontFamily:vu.windowFontFamily},offset:30},descriptionCfg:{style:{fontSize:12,fill:"#bfbfbf",fontFamily:vu.windowFontFamily},paddingTop:0},preRect:{show:!0,width:4,fill:"#40a9ff",radius:2},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:10,lineWidth:1,fill:"#72CC4A",stroke:"#72CC4A"},logoIcon:{show:!0,x:0,y:0,img:"https://gw.alipayobjects.com/zos/basement_prod/4f81893c-1806-4de4-aff3-9a6b266bc8a2.svg",width:16,height:16,offset:0},stateIcon:{show:!0,x:0,y:0,img:"https://gw.alipayobjects.com/zos/basement_prod/300a2523-67e0-4cbf-9d4a-67c077b40395.svg",width:16,height:16,offset:-5},anchorPoints:[[0,.5],[1,.5]]},shapeType:"modelRect",drawShape:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).preRect,r=void 0===n?{}:n,i=this.getShapeStyle(t),o=this.getSize(t),a=o[0],s=o[1],u=e.addShape("rect",{attrs:i,className:"".concat(this.type,"-keyShape"),name:"".concat(this.type,"-keyShape"),draggable:!0});e.shapeMap["".concat(this.type,"-keyShape")]=u;var l=r.show,c=(0,y.__rest)(r,["show"]);return l&&(e.shapeMap["pre-rect"]=e.addShape("rect",{attrs:(0,y.__assign)({x:-a/2,y:-s/2,height:s},c),className:"pre-rect",name:"pre-rect",draggable:!0})),this.drawLogoIcon(t,e),this.drawStateIcon(t,e),this.drawLinkPoints(t,e),u},drawLogoIcon:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).logoIcon,r=void 0===n?{}:n,i=this.getSize(t)[0];if(r.show){var o=r.width,a=r.height,s=r.x,u=r.y,l=r.offset,c=r.text,h=(0,y.__rest)(r,["width","height","x","y","offset","text"]);e.shapeMap["rect-logo-icon"]=c?e.addShape("text",{attrs:(0,y.__assign)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},h),className:"rect-logo-icon",name:"rect-logo-icon",draggable:!0}):e.addShape("image",{attrs:(0,y.__assign)((0,y.__assign)({},h),{x:s||-i/2+o+l,y:u||-a/2,width:o,height:a}),className:"rect-logo-icon",name:"rect-logo-icon",draggable:!0})}},drawStateIcon:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).stateIcon,r=void 0===n?{}:n,i=this.getSize(t)[0];if(r.show){var o=r.width,a=r.height,s=r.x,u=r.y,l=r.offset,c=r.text,h=(0,y.__rest)(r,["width","height","x","y","offset","text"]);e.shapeMap["rect-state-icon"]=c?e.addShape("text",{attrs:(0,y.__assign)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},h),className:"rect-state-icon",name:"rect-state-icon",draggable:!0}):e.addShape("image",{attrs:(0,y.__assign)((0,y.__assign)({},h),{x:s||i/2-o+l,y:u||-a/2,width:o,height:a}),className:"rect-state-icon",name:"rect-state-icon",draggable:!0})}},drawLinkPoints:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).linkPoints,r=void 0===n?{}:n,i=r.top,o=r.left,a=r.right,s=r.bottom,u=r.size,l=r.r,c=(0,y.__rest)(r,["top","left","right","bottom","size","r"]),h=this.getSize(t),f=h[0],p=h[1];o&&(e.shapeMap["link-point-left"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:-f/2,y:0,r:u/2||l||5}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0})),a&&(e.shapeMap["link-point-right"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:f/2,y:0,r:u/2||l||5}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0})),i&&(e.shapeMap["link-point-top"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:0,y:-p/2,r:u/2||l||5}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0})),s&&(e.shapeMap["link-point-bottom"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},c),{x:0,y:p/2,r:u/2||l||5}),className:"link-point-bottom",name:"link-point-bottom",isAnchorPoint:!0}))},drawLabel:function(t,e){var n=this.getOptions(t),r=n.labelCfg,i=void 0===r?{}:r,o=n.logoIcon,a=void 0===o?{}:o,s=n.descriptionCfg,u=void 0===s?{}:s,l=this.getSize(t)[0],c=null,h=a.show,f=a.width,p=-l/2+i.offset;h&&(p=-l/2+f+i.offset);var d=i.style,g=u.style,v=u.paddingTop;return(0,_.isString)(t.description)?(c=e.addShape("text",{attrs:(0,y.__assign)((0,y.__assign)({},d),{x:p,y:-5,text:t.label}),className:"text-shape",name:"text-shape",draggable:!0}),e.shapeMap["text-shape"]=c,e.shapeMap["rect-description"]=e.addShape("text",{attrs:(0,y.__assign)((0,y.__assign)({},g),{x:p,y:17+(v||0),text:t.description}),className:"rect-description",name:"rect-description",draggable:!0})):(c=e.addShape("text",{attrs:(0,y.__assign)((0,y.__assign)({},d),{x:p,y:7,text:t.label}),className:"text-shape",name:"text-shape",draggable:!0}),e.shapeMap["text-shape"]=c),c},getShapeStyle:function(t){var e=(this.mergeStyle||this.getOptions(t)).style,n={stroke:t.color},r=(0,_.mix)({},e,n),i=this.getSize(t),o=r.width||i[0],a=r.height||i[1];return(0,y.__assign)({x:-o/2,y:-a/2,width:o,height:a},r)},update:function(t,e){var n=this.mergeStyle||this.getOptions(t),r=n.style,i=void 0===r?{}:r,o=n.labelCfg,a=void 0===o?{}:o,s=n.descriptionCfg,u=void 0===s?{}:s,l=this.getSize(t),c=l[0],h=l[1];e.get("keyShape").attr((0,y.__assign)((0,y.__assign)({},i),{x:-c/2,y:-h/2,width:c,height:h}));var f=e.getContainer(),p=f.shapeMap["rect-logo-icon"]||f.find((function(t){return"rect-logo-icon"===t.get("className")})),d=p?p.attr():{},g=(0,_.mix)({},d,t.logoIcon),v=g.width;void 0===v&&(v=this.options.logoIcon.width);var m=t.logoIcon?t.logoIcon.show:void 0,b=a.offset,x=-c/2+v+b;m||void 0===m||(x=-c/2+b);var w=f.shapeMap["node-label"]||f.find((function(t){return"node-label"===t.get("className")})),E=f.shapeMap["rect-description"]||f.find((function(t){return"rect-description"===t.get("className")}));if(t.label)if(w){var S=t.labelCfg?t.labelCfg.style:{},C=(0,_.mix)({},w.attr(),S);t.label&&(C.text=t.label),C.x=x,(0,_.isString)(t.description)&&(C.y=-5),E&&(E.resetMatrix(),E.attr({x})),w.resetMatrix(),w.attr(C)}else f.shapeMap["node-label"]=f.addShape("text",{attrs:(0,y.__assign)((0,y.__assign)({},a.style),{x,y:t.description?-5:7,text:t.label}),className:"node-label",name:"node-label",draggable:!0});if((0,_.isString)(t.description)){var A=u.paddingTop;if(E){S=t.descriptionCfg?t.descriptionCfg.style:{};var T=(0,_.mix)({},E.attr(),S);(0,_.isString)(t.description)&&(T.text=t.description),T.x=x,E.resetMatrix(),E.attr((0,y.__assign)((0,y.__assign)({},T),{y:17+(A||0)}))}else f.shapeMap["rect-description"]=f.addShape("text",{attrs:(0,y.__assign)((0,y.__assign)({},u.style),{x,y:17+(A||0),text:t.description}),className:"rect-description",name:"rect-description",draggable:!0})}var k=f.shapeMap["pre-rect"]||f.find((function(t){return"pre-rect"===t.get("className")}));if(k&&!k.destroyed){var M=(0,_.mix)({},k.attr(),t.preRect);k.attr((0,y.__assign)((0,y.__assign)({},M),{x:-c/2,y:-h/2,height:h}))}if(p&&!p.destroyed)if(m||void 0===m){var P=g.width,I=g.height,O=g.x,R=g.y,L=g.offset,D=(0,y.__rest)(g,["width","height","x","y","offset"]);p.attr((0,y.__assign)((0,y.__assign)({},D),{x:O||-c/2+P+L,y:R||-I/2,width:P,height:I}))}else p.remove(),delete f.shapeMap["pre-rect"];else m&&this.drawLogoIcon(t,f);var N=f.shapeMap["rect-state-icon"]||f.find((function(t){return"rect-state-icon"===t.get("className")})),B=N?N.attr():{},z=(0,_.mix)({},B,t.stateIcon);if(N){z.show||void 0===z.show||(N.remove(),delete f.shapeMap["rect-state-icon"]);var F=z.width,Z=(I=z.height,O=z.x,R=z.y,z.offset),j=(0,y.__rest)(z,["width","height","x","y","offset"]);N.attr((0,y.__assign)((0,y.__assign)({},j),{x:O||c/2-F+Z,y:R||-I/2,width:F,height:I}))}else z.show&&this.drawStateIcon(t,f);this.updateLinkPoints(t,f)}},"single-node"),fu("star",{options:{size:60,style:{stroke:vu.defaultNode.style.stroke,fill:vu.defaultNode.style.fill,lineWidth:vu.defaultNode.style.lineWidth},labelCfg:{style:{fill:vu.nodeLabel.style.fill,fontSize:vu.nodeLabel.style.fontSize,fontFamily:vu.windowFontFamily}},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:vu.defaultNode.linkPoints.size,lineWidth:vu.defaultNode.linkPoints.lineWidth,fill:vu.defaultNode.linkPoints.fill,stroke:vu.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20},stateStyles:(0,y.__assign)({},vu.nodeStateStyles)},shapeType:"star",labelPosition:"center",drawShape:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).icon,r=void 0===n?{}:n,i=this.getShapeStyle(t),o=e.addShape("path",{attrs:i,className:"".concat(this.type,"-keyShape"),name:"".concat(this.type,"-keyShape"),draggable:!0});e.shapeMap["".concat(this.type,"-keyShape")]=o;var a=r.width,s=r.height,u=r.show,l=r.text;return u&&(e.shapeMap["".concat(this.type,"-icon")]=l?e.addShape("text",{attrs:(0,y.__assign)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},r),className:"".concat(this.type,"-icon"),name:"".concat(this.type,"-icon"),draggable:!0}):e.addShape("image",{attrs:(0,y.__assign)({x:-a/2,y:-s/2},r),className:"".concat(this.type,"-icon"),name:"".concat(this.type,"-icon"),draggable:!0})),this.drawLinkPoints(t,e),o},drawLinkPoints:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).linkPoints,r=void 0===n?{}:n,i=r.top,o=r.left,a=r.right,s=r.leftBottom,u=r.rightBottom,l=r.size,c=r.r,h=(0,y.__rest)(r,["top","left","right","leftBottom","rightBottom","size","r"]),f=this.getSize(t)[0];if(a){var p=Math.cos(.1*Math.PI)*f,d=Math.sin(.1*Math.PI)*f;e.shapeMap["link-point-right"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},h),{x:p,y:-d,r:l/2||c||5}),className:"link-point-right",name:"link-point-right"})}i&&(p=Math.cos(.5*Math.PI)*f,d=Math.sin(.5*Math.PI)*f,e.shapeMap["link-point-top"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},h),{x:p,y:-d,r:l/2||c||5}),className:"link-point-top",name:"link-point-top"})),o&&(p=Math.cos(.9*Math.PI)*f,d=Math.sin(.9*Math.PI)*f,e.shapeMap["link-point-left"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},h),{x:p,y:-d,r:l/2||c||5}),className:"link-point-left",name:"link-point-left"})),s&&(p=Math.cos(1.3*Math.PI)*f,d=Math.sin(1.3*Math.PI)*f,e.shapeMap["link-point-bottom"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},h),{x:p,y:-d,r:l/2||c||5}),className:"link-point-left-bottom",name:"link-point-left-bottom"})),u&&(p=Math.cos(1.7*Math.PI)*f,d=Math.sin(1.7*Math.PI)*f,e.shapeMap["link-point-right-bottom"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},h),{x:p,y:-d,r:l/2||c||5}),className:"link-point-right-bottom",name:"link-point-right-bottom"}))},getPath:function(t){for(var e=this.getSize(t)[0],n=3*e/8,r=t.innerR||n,i=[],o=0;o<5;o++){var a=Math.cos((18+72*o)/180*Math.PI)*e,s=Math.sin((18+72*o)/180*Math.PI)*e,u=Math.cos((54+72*o)/180*Math.PI)*r,l=Math.sin((54+72*o)/180*Math.PI)*r;0===o?i.push(["M",a,-s]):i.push(["L",a,-s]),i.push(["L",u,-l])}return i.push(["Z"]),i},getShapeStyle:function(t){var e=(this.mergeStyle||this.getOptions(t)).style,n={stroke:t.color},r=(0,_.mix)({},e,n),i=this.getPath(t);return(0,y.__assign)({path:i},r)},update:function(t,e,n){var r=e.getContainer(),i=this.getOptions({}).style,o=this.getPath(t),a={stroke:t.color,path:o},s=e.get("keyShape"),u=(0,_.mix)({},i,s.attr(),a);u=(0,_.mix)(u,t.style),this.updateShape(t,e,u,!0,n),this.updateLinkPoints(t,r)},updateLinkPoints:function(t,e){var n=this.getOptions({}).linkPoints,r=e.shapeMap["link-point-left"]||e.find((function(t){return"link-point-left"===t.get("className")})),i=e.shapeMap["link-point-right"]||e.find((function(t){return"link-point-right"===t.get("className")})),o=e.shapeMap["link-point-top"]||e.find((function(t){return"link-point-top"===t.get("className")})),a=e.shapeMap["link-point-left-bottom"]||e.find((function(t){return"link-point-left-bottom"===t.get("className")})),s=e.shapeMap["link-point-left-bottom"]||e.find((function(t){return"link-point-right-bottom"===t.get("className")})),u=n,l=r||i||o||a||s;l&&(u=l.attr());var c=(0,_.mix)({},u,t.linkPoints),h=c.fill,f=c.stroke,p=c.lineWidth,d=c.size/2;d||(d=c.r);var g=t.linkPoints?t.linkPoints:{left:void 0,right:void 0,top:void 0,leftBottom:void 0,rightBottom:void 0},v=g.left,m=g.right,b=g.top,x=g.leftBottom,w=g.rightBottom,E=this.getSize(t)[0],S={r:d,fill:h,stroke:f,lineWidth:p},C=Math.cos(.1*Math.PI)*E,A=Math.sin(.1*Math.PI)*E;i?m||void 0===m?i.attr((0,y.__assign)((0,y.__assign)({},S),{x:C,y:-A})):(i.remove(),delete e.shapeMap["link-point-right"]):m&&(e.shapeMap["link-point-right"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},S),{x:C,y:-A}),className:"link-point-right",name:"link-point-right",isAnchorPoint:!0})),C=Math.cos(.5*Math.PI)*E,A=Math.sin(.5*Math.PI)*E,o?b||void 0===b?o.attr((0,y.__assign)((0,y.__assign)({},S),{x:C,y:-A})):(o.remove(),delete e.shapeMap["link-point-top"]):b&&(e.shapeMap["link-point-top"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},S),{x:C,y:-A}),className:"link-point-top",name:"link-point-top",isAnchorPoint:!0})),C=Math.cos(.9*Math.PI)*E,A=Math.sin(.9*Math.PI)*E,r?v||void 0===v?r.attr((0,y.__assign)((0,y.__assign)({},S),{x:C,y:-A})):(r.remove(),delete e.shapeMap["link-point-left"]):v&&(e.shapeMap["link-point-left"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},S),{x:C,y:-A}),className:"link-point-left",name:"link-point-left",isAnchorPoint:!0})),C=Math.cos(1.3*Math.PI)*E,A=Math.sin(1.3*Math.PI)*E,a?x||void 0===x?a.attr((0,y.__assign)((0,y.__assign)({},S),{x:C,y:-A})):(a.remove(),delete e.shapeMap["link-point-left-bottom"]):x&&(e.shapeMap["link-point-left-bottom"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},S),{x:C,y:-A}),className:"link-point-left-bottom",name:"link-point-left-bottom",isAnchorPoint:!0})),C=Math.cos(1.7*Math.PI)*E,A=Math.sin(1.7*Math.PI)*E,s?w||void 0===w?s.attr((0,y.__assign)((0,y.__assign)({},S),{x:C,y:-A})):(a.remove(),delete e.shapeMap["link-point-right-bottom"]):w&&(e.shapeMap["link-point-right-bottom"]=e.addShape("circle",{attrs:(0,y.__assign)((0,y.__assign)({},S),{x:C,y:-A}),className:"link-point-right-bottom",name:"link-point-right-bottom",isAnchorPoint:!0}))}},"single-node");var kk=su.defaultSubjectColors;fu("donut",{options:{size:vu.defaultNode.size,style:{x:0,y:0,stroke:vu.defaultNode.style.stroke,fill:vu.defaultNode.style.fill,lineWidth:vu.defaultNode.style.lineWidth},labelCfg:{style:{fill:vu.nodeLabel.style.fill,fontSize:vu.nodeLabel.style.fontSize,fontFamily:vu.windowFontFamily}},linkPoints:{top:!1,right:!1,bottom:!1,left:!1,size:vu.defaultNode.linkPoints.size,lineWidth:vu.defaultNode.linkPoints.lineWidth,fill:vu.defaultNode.linkPoints.fill,stroke:vu.defaultNode.linkPoints.stroke},icon:{show:!1,img:"https://gw.alipayobjects.com/zos/bmw-prod/5d015065-8505-4e7a-baec-976f81e3c41d.svg",width:20,height:20},stateStyles:(0,y.__assign)({},vu.nodeStateStyles)},shapeType:"circle",labelPosition:"center",drawShape:function(t,e){var n=(this.mergeStyle||this.getOptions(t)).icon,r=void 0===n?{}:n,i=this.getShapeStyle(t),o=(0,_.deepMix)({},r,t.icon),a=e.addShape("circle",{attrs:i,className:"".concat(this.type,"-keyShape"),draggable:!0,name:"".concat(this.type,"-keyShape")});e.shapeMap["".concat(this.type,"-keyShape")]=a;var s=o.width,u=o.height,l=o.show,c=o.text;l&&(e.shapeMap["".concat(this.type,"-icon")]=c?e.addShape("text",{attrs:(0,y.__assign)({x:0,y:0,fontSize:12,fill:"#000",stroke:"#000",textBaseline:"middle",textAlign:"center"},o),className:"".concat(this.type,"-icon"),name:"".concat(this.type,"-icon"),draggable:!0}):e.addShape("image",{attrs:(0,y.__assign)({x:-s/2,y:-u/2},o),className:"".concat(this.type,"-icon"),name:"".concat(this.type,"-icon"),draggable:!0}));var h=a.attr("r"),f=.6*h,p=(h+f)/2,d=t,g=d.donutAttrs,v=void 0===g?{}:g,m=d.donutColorMap,b=void 0===m?{}:m,x=Object.keys(v).length;if(v&&x>1){var w=[],E=0;if(Object.keys(v).forEach((function(t){var e=v[t]||0;(0,_.isNumber)(e)&&(w.push({key:t,value:e,color:b[t]}),E+=e)})),E){var S=h-f;if(1===x)return void(e.shapeMap["fan-shape-0"]=e.addShape("circle",{attrs:{r:p,x:0,y:0,stroke:w[0].color||kk[0],lineWidth:S},name:"fan-shape-0"}));var C=[p,0],A=0;w.forEach((function(t,n){var r=t.value/E;if(!(r<.001))if(r>.999&&(r=1),1!==r){t.percent=r,t.angle=r*Math.PI*2,t.beginAgnle=A,A+=t.angle,t.endAngle=A,t.arcBegin=C,t.arcEnd=[p*Math.cos(t.endAngle),-p*Math.sin(t.endAngle)];var i=t.angle>Math.PI?1:0,o=[["M",t.arcBegin[0],t.arcBegin[1]],["A",p,p,0,i,0,t.arcEnd[0],t.arcEnd[1]],["L",t.arcEnd[0],t.arcEnd[1]]];e.shapeMap["fan-shape-".concat(n)]=e.addShape("path",{attrs:{path:o,lineWidth:S,stroke:t.color||kk[n%kk.length]},name:"fan-shape-".concat(n)}),C=t.arcEnd}else e.shapeMap["fan-shape-".concat(n)]=e.addShape("circle",{attrs:{r:p,x:0,y:0,stroke:t.color||kk[n%kk.length],lineWidth:S},name:"fan-shape-".concat(n)})}))}}return this.drawLinkPoints(t,e),a},update:void 0},"circle");var Mk=function(t){var e=t.x,n=t.y;return{x:e,y:n,centerX:e,centerY:n,minX:e,minY:n,maxX:e,maxY:n,height:0,width:0}},Pk=function(t){for(var e=[],n={},r=t.length-1;r>=0;r--){var i=t[r];i.id="".concat(i.x,"|||").concat(i.y),n[i.id]=i,e.push(i)}return e},Ik=function(t){return Pk(t)},Ok=function(t,e){return t.width||t.height?{centerX:t.centerX,centerY:t.centerY,minX:t.minX-e,minY:t.minY-e,maxX:t.maxX+e,maxY:t.maxY+e,height:t.height+2*e,width:t.width+2*e}:t},Rk=function(t,e,n){var r=function(t,e){var n=Math.abs(t.x-e.centerX),r=Math.abs(t.y-e.centerY);return 0===n&&0===r?0:n/e.width>r/e.height}(e,t);if(0===r){var i=t.centerX,o=t.centerY;return n.y<e.y?o=t.minY:n.x>e.x?i=t.maxX:n.x<e.x?i=t.minX:n.x===e.x&&(o=t.maxY),{x:i,y:o}}return r?{x:e.x>t.centerX?t.maxX:t.minX,y:e.y}:{x:e.x,y:e.y>t.centerY?t.maxY:t.minY}},Lk=function(t,e){var n=Math.min(t.minX,e.minX),r=Math.min(t.minY,e.minY),i=Math.max(t.maxX,e.maxX),o=Math.max(t.maxY,e.maxY);return{centerX:(n+i)/2,centerY:(r+o)/2,minX:n,minY:r,maxX:i,maxY:o,height:o-r,width:i-n}},Dk=function(t){return[{x:t.minX,y:t.minY},{x:t.maxX,y:t.minY},{x:t.maxX,y:t.maxY},{x:t.minX,y:t.maxY}]},Nk=function(t,e){var n=t.x,r=t.y;return n<e.minX||n>e.maxX||r<e.minY||r>e.maxY},Bk=function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},zk=function(t,e,n,r,i){return Bk(t,e)+Bk(t,n)+function(t,e){var n=0;return e.forEach((function(e){e&&(t.x===e.x&&(n+=-2),t.y===e.y&&(n+=-2))})),n}(t,[e,n,r,i])},Fk=function t(e,n,r,i,o){void 0===o&&(o=0),e.unshift(n[i]),r[i]&&r[i]!==i&&o<=100&&t(e,n,r,r[i],o+1)},Zk=function(t,e){var n=t.indexOf(e);n>-1&&t.splice(n,1)},jk=function(t,e,n,r){var i=n.x-t.x,o=n.y-t.y,a=r.x-t.x,s=r.y-t.y,u=n.x-e.x,l=n.y-e.y,c=r.x-e.x,h=r.y-e.y;return(i*s-o*a)*(u*h-l*c)<=0&&(i*l-o*u)*(a*h-s*c)<=0},Uk=function(t,e,n){if(n.width||n.height){var r=Dk(n),i=r[0],o=r[1],a=r[2],s=r[3];return jk(t,e,i,o)||jk(t,e,i,s)||jk(t,e,o,a)||jk(t,e,a,s)}return!1},Gk=function(t,e,n,r){var i=[];return t.forEach((function(t){if(t!==e&&(t.x===e.x||t.y===e.y)){if(Uk(t,e,n)||Uk(t,e,r))return;i.push(t)}})),Pk(i)},Vk=function(t,e){var n=[],r=t[0];return n.push("M".concat(r.x," ").concat(r.y)),t.forEach((function(r,i){var o=t[i+1],a=t[i+2];if(o&&a)if(function(t,e,n){return!(t.x===e.x&&e.x===n.x||t.y===e.y&&e.y===n.y)}(r,o,a)){var s=function(t,e,n,r){var i=Bk(t,e),o=Bk(n,e);return i<r&&(r=i),o<r&&(r=o),[{x:e.x-r/i*(e.x-t.x),y:e.y-r/i*(e.y-t.y)},{x:e.x-r/o*(e.x-n.x),y:e.y-r/o*(e.y-n.y)}]}(r,o,a,e),u=s[0],l=s[1];n.push("L".concat(u.x," ").concat(u.y)),n.push("Q".concat(o.x," ").concat(o.y," ").concat(l.x," ").concat(l.y)),n.push("L".concat(l.x," ").concat(l.y))}else n.push("L".concat(o.x," ").concat(o.y));else o&&n.push("L".concat(o.x," ").concat(o.y))})),n.join("")},Wk=function(t,e,n,r,i){var o,a;if(n&&n.getType()?"combo"===n.getType()?((o=n.getKeyShape().getCanvasBBox()||Mk(t)).centerX=(o.minX+o.maxX)/2,o.centerY=(o.minY+o.maxY)/2):o=n.getBBox():o=Mk(t),r&&r.getType())if("combo"===r.getType()){var s=r.getKeyShape().getBBox();if(s){var u=r.getModel(),l=u.x,c=u.y;(a={x:l,y:c,width:s.width,height:s.height,minX:s.minX+l,maxX:s.maxX+l,minY:s.minY+c,maxY:s.maxY+c}).centerX=(a.minX+a.maxX)/2,a.centerY=(a.minY+a.maxY)/2}else a=Mk(e)}else a=r&&r.getBBox();else a=Mk(e);var h=Ok(o,i),f=Ok(a,i),p=Rk(h,t,e),d=Rk(f,e,t),g=function(t){void 0===t&&(t=[]);var e=[],n=[];t.forEach((function(t){e.push(t.x),n.push(t.y)}));var r=Math.min.apply(Math,e),i=Math.max.apply(Math,e),o=Math.min.apply(Math,n),a=Math.max.apply(Math,n);return{centerX:(r+i)/2,centerY:(o+a)/2,maxX:i,maxY:a,minX:r,minY:o,height:a-o,width:i-r}}([p,d]),v=Lk(h,g),m=Lk(f,g),y=[];y=y.concat(Dk(v)).concat(Dk(m));var _={x:(t.x+e.x)/2,y:(t.y+e.y)/2};[g,v,m].forEach((function(t){y=y.concat(function(t,e){return function(t,e){return e<t.minX||e>t.maxX?[]:[{x:e,y:t.minY},{x:e,y:t.maxY}]}(t,e.x).concat(function(t,e){return e<t.minY||e>t.maxY?[]:[{x:t.minX,y:e},{x:t.maxX,y:e}]}(t,e.y))}(t,_).filter((function(t){return Nk(t,h)&&Nk(t,f)})))})),[{x:p.x,y:d.y},{x:d.x,y:p.y}].forEach((function(t){Nk(t,h)&&Nk(t,f)&&y.push(t)})),y.unshift(p),y.push(d);var b=function(t,e,n,r,i,o,a){var s=[],u=[e],l={},c={},h={};c[e.id]=0,h[e.id]=zk(e,n,e);var f,p,d={};for(t.forEach((function(t){d[t.id]=t}));u.length;){if(f=void 0,p=1/0,u.forEach((function(t){h[t.id]<=p&&(p=h[t.id],f=t)})),f===n){var g=[];return Fk(g,d,l,n.id),g}Zk(u,f),s.push(f),Gk(t,f,r,i).forEach((function(t){if(-1===s.indexOf(t)){-1===u.indexOf(t)&&u.push(t);var r=h[f.id]+Bk(f,t);c[t.id]&&r>=c[t.id]||(l[t.id]=f.id,c[t.id]=r,h[t.id]=c[t.id]+zk(t,n,e,o,a))}}))}return[e,n]}(y=Pk(y),p,d,o,a,t,e);return b.unshift(t),b.push(e),Ik(b)},Hk={offset:20,maxAllowedDirectionChange:Math.PI/2,maximumLoops:2e3,gridSize:10,directions:[{stepX:1,stepY:0},{stepX:-1,stepY:0},{stepX:0,stepY:1},{stepX:0,stepY:-1}],get penalties(){return{0:0,45:this.gridSize/2,90:this.gridSize/2}},distFunc:function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},fallbackRoute:function(t,e,n,r,i){return Ik(Wk(t,e,n,r,i.offset))}},Xk=(Math.PI,function(t,e){var n=Math.round(Math.abs(t/e));return n<0?0:(t<0?-1:1)*n}),Yk=function(t,e){var n=e.x-t.x,r=e.y-t.y;return n||r?Math.atan2(r,n):0},qk=function(t,e){var n=Math.abs(t-e);return n>Math.PI?2*Math.PI-n:n},Kk=function(t,e,n){for(var r=1/0,i=0,o=e.length;i<o;i++){var a=n(t,e[i]);a<r&&(r=a)}return r},Qk=function(t,e,n,r,i){var o=[];if(!n)return[t];var a=i.directions,s=i.offset,u=n.getBBox(),l=e.x>u.minX&&e.x<u.maxX&&e.y>u.minY&&e.y<u.maxY,c=Ok(u,s);for(var h in c)c[h]=Xk(c[h],i.gridSize);if(l){for(var f=0,p=a;f<p.length;f++){var d=p[f],g=[[{x:c.minX,y:c.minY},{x:c.maxX,y:c.minY}],[{x:c.minX,y:c.minY},{x:c.minX,y:c.maxY}],[{x:c.maxX,y:c.minY},{x:c.maxX,y:c.maxY}],[{x:c.minX,y:c.maxY},{x:c.maxX,y:c.maxY}]];for(h=0;h<4;h++){var v=g[h],m=su.getLineIntersect(t,{x:t.x+d.stepX*c.width,y:t.y+d.stepY*c.height},v[0],v[1]);m&&!Uk(t,m,u)&&(m.id="".concat(m.x,"|||").concat(m.y),o.push(m))}}return o}var y=Rk(c,t,r);return y.id="".concat(y.x,"|||").concat(y.y),[y]},Jk=function(t,e,n,r){var i=Yk(t,e);if(!n[t.id]){var o=Yk(r,t);return qk(o,i)}var a=Yk({x:n[t.id].x,y:n[t.id].y},t);return qk(a,i)},$k=function(t,e,n,r,i,o,a){var s=[r],u=t.id,l=t.x,c=t.y,h={x:l,y:c,id:u};for(Jk(h,o,e,n)&&s.unshift({x:o.x===r.x?r.x:h.x*a,y:o.y===r.y?r.y:h.y*a});e[u]&&e[u].id!==u;){var f={x:l,y:c,id:u},p=e[u].id,d=e[u].x,g=e[u].y,v={x:d,y:g,id:p};Jk(v,f,e,n)&&s.unshift({x:v.x===f.x?s[0].x:v.x*a,y:v.y===f.y?s[0].y:v.y*a}),u=p,l=d,c=g}var m=l,y=c;return s[0].x=m===n.x?i.x:s[0].x,s[0].y=y===n.y?i.y:s[0].y,s.unshift(i),s};pu("polyline",{options:{color:vu.defaultEdge.color,size:vu.defaultEdge.size,style:{radius:0,offset:15,x:0,y:0,stroke:vu.defaultEdge.style.stroke,lineAppendWidth:vu.defaultEdge.style.lineAppendWidth},labelCfg:{style:{fill:vu.edgeLabel.style.fill,fontSize:vu.edgeLabel.style.fontSize,fontFamily:vu.windowFontFamily}},routeCfg:{obstacles:[],maxAllowedDirectionChange:Math.PI,maximumLoops:500,gridSize:10},stateStyles:(0,y.__assign)({},vu.edgeStateStyles)},shapeType:"polyline",labelPosition:"center",drawShape:function(t,e){var n=this.getShapeStyle(t);0===n.radius&&delete n.radius;var r=e.addShape("path",{className:"edge-shape",name:"edge-shape",attrs:n});return e.shapeMap["edge-shape"]=r,r},getShapeStyle:function(t){var e=this.options.style,n={stroke:t.color},r=(0,_.mix)({},e,n,t.style);t=this.getPathPoints(t),this.radius=r.radius,this.offset=r.offset;var i=t.startPoint,o=t.endPoint,a=this.getControlPoints(t),s=[i];a&&(s=s.concat(a)),s.push(o);var u=t.sourceNode,l=t.targetNode,c=r.radius,h=this.options.routeCfg,f=(0,_.mix)({},h,t.routeCfg);f.offset=r.offset;var p=this.getPath(s,u,l,c,f);return((0,_.isArray)(p)&&p.length<=1||(0,_.isString)(p)&&-1===p.indexOf("L"))&&(p="M0 0, L0 0"),(isNaN(i.x)||isNaN(i.y)||isNaN(o.x)||isNaN(o.y))&&(p="M0 0, L0 0"),(0,_.mix)({},vu.defaultEdge.style,r,{lineWidth:t.size,path:p})},updateShapeStyle:function(t,e){var n=e.getContainer();if(e.isVisible()){var r={stroke:t.color},i=n.shapeMap["edge-shape"]||n.find((function(t){return"edge-shape"===t.get("className")}))||e.getKeyShape(),o=t.size,a=(t=this.getPathPoints(t)).startPoint,s=t.endPoint,u=this.getControlPoints(t),l=[a];u&&(l=l.concat(u)),l.push(s);var c=i.attr(),h=(0,_.mix)({},r,c,t.style),f=t.sourceNode,p=t.targetNode,d=h.radius,g=this.options.routeCfg,v=(0,_.mix)({},g,t.routeCfg);v.offset=h.offset;var m=this.getPath(l,f,p,d,v);((0,_.isArray)(m)&&m.length<=1||(0,_.isString)(m)&&-1===m.indexOf("L"))&&(m="M0 0, L0 0"),(isNaN(a.x)||isNaN(a.y)||isNaN(s.x)||isNaN(s.y))&&(m="M0 0, L0 0"),c.endArrow&&!1===h.endArrow&&(t.style.endArrow={path:""}),c.startArrow&&!1===h.startArrow&&(t.style.startArrow={path:""});var y=(0,_.mix)(r,i.attr(),{lineWidth:o,path:m},t.style);i&&i.attr(y)}},getPath:function(t,e,n,r,i){var o=i.offset,a=i.simple;if(!o||t.length>2){if(r)return Vk(t,r);var s=[];return(0,_.each)(t,(function(t,e){0===e?s.push(["M",t.x,t.y]):s.push(["L",t.x,t.y])})),s}var u=a?Wk(t[t.length-1],t[0],n,e,o):function(t,e,n,r,i){if(isNaN(t.x)||isNaN(e.x))return[];var o=(0,_.deepMix)(Hk,i);o.obstacles=o.obstacles||[];var a=o.gridSize,s=function(t,e,n){var r={};return t.forEach((function(t){if(t)for(var i=Ok(t.getBBox(),n),o=Xk(i.minX,e);o<=Xk(i.maxX,e);o+=1)for(var a=Xk(i.minY,e);a<=Xk(i.maxY,e);a+=1)r["".concat(o,"|||").concat(a)]=!0})),r}(o.obstacles.concat([n,r]),a,o.offset),u={x:Xk(t.x,a),y:Xk(t.y,a)},l={x:Xk(e.x,a),y:Xk(e.y,a)};t.id="".concat(u.x,"|||").concat(u.y),e.id="".concat(l.x,"|||").concat(l.y);var c=Qk(u,t,n,l,o),h=Qk(l,e,r,u,o);c.forEach((function(t){delete s[t.id]})),h.forEach((function(t){delete s[t.id]}));for(var f={},p={},d={},g={},v={},m=0;m<c.length;m++){var y=c[m];f[y.id]=y,g[y.id]=0,v[y.id]=Kk(y,h,o.distFunc)}for(var b,x,w,E,S,C,A,T=o.maximumLoops,k=o.penalties;Object.keys(f).length>0&&T>0&&(b=void 0,x=1/0,Object.keys(f).forEach((function(t){var e=f[t].id;v[e]<=x&&(x=v[e],b=f[e])})),b);){if(h.findIndex((function(t){return t.x===b.x&&t.y===b.y}))>-1)return $k(b,d,u,e,t,l,a);for(delete f[b.id],p[b.id]=!0,m=0;m<o.directions.length;m++)w=o.directions[m],p[(E={x:b.x+w.stepX,y:b.y+w.stepY,id:"".concat(Math.round(b.x)+w.stepX,"|||").concat(Math.round(b.y)+w.stepY)}).id]||(A=Jk(b,E,d,u))>o.maxAllowedDirectionChange||s[E.id]||(f[E.id]||(f[E.id]=E),S=o.distFunc(b,E)+(isNaN(k[A])?a:k[A]),C=g[b.id]+S,g[E.id]&&C>=g[E.id]||(d[E.id]=b,g[E.id]=C,v[E.id]=C+Kk(E,h,o.distFunc)));T-=1}return o.fallbackRoute(t,e,n,r,o)}(t[0],t[t.length-1],e,n,i);return u&&u.length?r?Vk(u,r):su.pointsToPolygon(u):"M0 0, L0 0"}},"single-edge");var tM=dS.cloneEvent,eM=dS.isNaN,nM=Math.abs,rM=["shift","ctrl","alt","control"];const iM={getDefaultCfg:function(){return{direction:"both",enableOptimize:!1,scalableRange:0,allowDragOnItem:!1}},getEvents:function(){return{dragstart:"onMouseDown",drag:"onMouseMove",dragend:"onMouseUp","canvas:click":"onMouseUp",keyup:"onKeyUp",focus:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onMouseUp"}},updateViewport:function(t){var e=this.origin,n=+t.clientX,r=+t.clientY;if(!eM(n)&&!eM(r)){var i=n-e.x,o=r-e.y;"x"===this.get("direction")?o=0:"y"===this.get("direction")&&(i=0),this.origin={x:n,y:r};var a=this.graph.get("width"),s=this.graph.get("height"),u=this.graph.get("canvas").getCanvasBBox(),l=this.scalableRange,c=this.scalableRange;l<1&&l>-1&&(l*=a,c*=s),(u.minX<=a+l&&u.minX+i>a+l||u.maxX+l>=0&&u.maxX+l+i<0)&&(i=0),(u.minY<=s+c&&u.minY+o>s+c||u.maxY+c>=0&&u.maxY+c+o<0)&&(o=0),this.graph.translate(i,o)}},onTouchStart:function(t){var e=t.originalEvent.touches,n=e[0],r=e[1];n&&r||(t.preventDefault(),this.onMouseDown(t))},onMouseDown:function(t){var e=this,n=t.originalEvent;if((!n||t.name===hu.TOUCHSTART||0===n.button)&&(t.name===hu.TOUCHSTART||"undefined"==typeof window||!window.event||window.event.buttons||window.event.button)&&this.shouldBegin.call(this,t)&&!e.keydown){var r=t.target,i=r&&r.isCanvas&&r.isCanvas();if((this.allowDragOnItem||i)&&(e.origin={x:t.clientX,y:t.clientY},e.dragging=!1,this.enableOptimize)){for(var o=this.graph,a=o.getEdges(),s=0,u=a.length;s<u;s++){var l=a[s].get("group").get("children");l&&l.forEach((function(t){t.set("ori-visibility",t.get("ori-visibility")||t.get("visible")),t.hide()}))}for(var c=o.getNodes(),h=0,f=c.length;h<f;h++)for(var p=0,d=c[h].getContainer().get("children");p<d.length;p++){var g=d[p];g.get("isKeyShape")||(g.set("ori-visibility",g.get("ori-visibility")||g.get("visible")),g.hide())}}}},onTouchMove:function(t){var e=t.originalEvent.touches,n=e[0],r=e[1];n&&r?this.onMouseUp(t):(t.preventDefault(),this.onMouseMove(t))},onMouseMove:function(t){var e=this.graph;if(!this.keydown){var n=t.target,r=n&&n.isCanvas&&n.isCanvas();if((this.allowDragOnItem||r)&&(t=tM(t),this.origin)){if(this.dragging)t.type="drag",e.emit("canvas:drag",t);else{if(nM(this.origin.x-t.clientX)+nM(this.origin.y-t.clientY)<10)return;this.shouldBegin.call(this,t)&&(t.type="dragstart",e.emit("canvas:dragstart",t),this.originPosition={x:t.clientX,y:t.clientY},this.dragging=!0)}this.shouldUpdate.call(this,t)&&this.updateViewport(t)}}},onMouseUp:function(t){var e,n,r=this.graph;if(!this.keydown){var i=r.getZoom(),o=r.get("modeController"),a=null===(n=null===(e=null==o?void 0:o.modes[o.mode])||void 0===e?void 0:e.filter((function(t){return"zoom-canvas"===t.type})))||void 0===n?void 0:n[0],s=a?a.optimizeZoom||.1:0;if(this.enableOptimize){for(var u=r.getEdges(),l=0,c=u.length;l<c;l++){var h=u[l].get("group").get("children");h&&h.forEach((function(t){t.get("ori-visibility")&&t.show()}))}if(i>s)for(var f=r.getNodes(),p=0,d=f.length;p<d;p++)for(var g=0,v=f[p].getContainer().get("children");g<v.length;g++){var m=v[g];m.get("isKeyShape")||m.get("ori-visibility")&&m.show()}}this.dragging?(t=tM(t),this.shouldEnd.call(this,t)&&this.updateViewport(t),t.type="dragend",t.dx=t.clientX-this.originPosition.x,t.dy=t.clientY-this.originPosition.y,r.emit("canvas:dragend",t),this.endDrag()):this.origin=null}},endDrag:function(){this.origin=null,this.dragging=!1,this.dragbegin=!1},onKeyDown:function(t){var e=t.key;e&&(rM.indexOf(e.toLowerCase())>-1?this.keydown=!0:this.keydown=!1)},onKeyUp:function(){this.keydown=!1,this.origin=null,this.dragging=!1,this.dragbegin=!1}},oM={getDefaultCfg:function(){return{updateEdge:!0,delegateStyle:{},enableDelegate:!1,onlyChangeComboSize:!1,comboActiveState:"",selectedState:"selected",enableOptimize:!1,enableDebounce:!1,enableStack:!0}},getEvents:function(){return{"node:dragstart":"onDragStart","node:drag":"onDrag","node:dragend":"onDragEnd","combo:dragenter":"onDragEnter","combo:dragleave":"onDragLeave","combo:drop":"onDropCombo","node:drop":"onDropNode","canvas:drop":"onDropCanvas",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onDragEnd"}},validationCombo:function(t){return!(!this.origin||!t||t.destroyed)&&"combo"===t.getType()},onTouchStart:function(t){if(t.item){try{var e=t.originalEvent.touches,n=e[0],r=e[1];if(n&&r)return;t.preventDefault()}catch(t){console.warn("Touch original event not exist!")}this.onDragStart(t)}},onTouchMove:function(t){try{var e=t.originalEvent.touches,n=e[0],r=e[1];if(n&&r)return void this.onDragEnd(t);t.preventDefault()}catch(t){console.warn("Touch original event not exist!")}this.onDrag(t)},onDragStart:function(t){var e=this;if(this.currentShouldEnd=!0,this.shouldBegin.call(this,t)){var n=t.item;if(n&&!n.destroyed&&!n.hasLocked()){n.getContainer().set("capture",!1),this.cachedCaptureItems||(this.cachedCaptureItems=[]),this.cachedCaptureItems.push(n);var r=t.target;if(r&&r.get("isAnchorPoint"))return;var i=this.graph;this.targets=[],this.targetCombo=null;var o=i.findAllByState("node",this.selectedState),a=n.get("id"),s=o.filter((function(t){var e=t.get("id");return a===e}));0===s.length?this.targets.push(n):o.length>1?o.forEach((function(t){t.hasLocked()||e.targets.push(t)})):this.targets.push(n);var u=[];this.targets.forEach((function(t){u.push((0,_.clone)(t.getModel()))})),this.set("beforeDragNodes",u),this.hidenEdge={},this.get("updateEdge")&&this.enableOptimize&&!this.enableDelegate&&this.targets.forEach((function(t){t.getEdges().forEach((function(t){t.isVisible()&&(e.hidenEdge[t.getID()]=!0,t.hide())}))})),this.origin={x:t.x,y:t.y},this.point={},this.originPoint={}}}},onDrag:function(t){var e=this;this.origin&&this.shouldUpdate.call(this,t)&&(this.get("enableDelegate")?this.updateDelegate(t):this.enableDebounce?this.debounceUpdate({targets:this.targets,graph:this.graph,point:this.point,origin:this.origin,evt:t,updateEdge:this.get("updateEdge")}):this.targets.map((function(n){e.update(n,t)})))},onDragEnd:function(t){var e,n=this;if(this.origin){null===(e=this.cachedCaptureItems)||void 0===e||e.forEach((function(t){t.getContainer().set("capture",!0)})),this.cachedCaptureItems=[],this.delegateRect&&(this.delegateRect.remove(),this.delegateRect=null),this.get("updateEdge")&&this.enableOptimize&&!this.enableDelegate&&this.targets.forEach((function(t){t.getEdges().forEach((function(t){n.hidenEdge[t.getID()]&&t.show(),t.refresh()}))})),this.hidenEdge={};var r=this.graph;if(r.get("enabledStack")&&this.enableStack){var i={before:{nodes:[],edges:[],combos:[]},after:{nodes:[],edges:[],combos:[]}};this.get("beforeDragNodes").forEach((function(t){i.before.nodes.push({id:t.id,x:t.x,y:t.y})})),this.targets.forEach((function(t){var e=t.getModel();i.after.nodes.push({id:e.id,x:e.x,y:e.y})})),r.pushStack("update",(0,_.clone)(i))}r.emit("dragnodeend",{items:this.targets,targetItem:null}),this.point={},this.origin=null,this.originPoint={},this.targets.length=0,this.targetCombo=null}},onDropCombo:function(t){var e=t.item;if(this.currentShouldEnd=this.shouldEnd.call(this,t,e),this.updatePositions(t,!this.currentShouldEnd),this.currentShouldEnd&&this.validationCombo(e)){var n=this.graph;if(this.comboActiveState&&n.setItemState(e,this.comboActiveState,!1),this.targetCombo=e,this.onlyChangeComboSize)n.updateCombos();else{var r=e.getModel();this.targets.map((function(t){t.getModel().comboId!==r.id&&n.updateComboTree(t,r.id)})),n.updateCombo(e)}n.emit("dragnodeend",{items:this.targets,targetItem:this.targetCombo})}},onDropCanvas:function(t){var e=this.graph;this.currentShouldEnd=this.shouldEnd.call(this,t,void 0),this.updatePositions(t,!this.currentShouldEnd),this.targets&&0!==this.targets.length&&this.currentShouldEnd&&(this.onlyChangeComboSize?e.updateCombos():this.targets.map((function(t){t.getModel().comboId&&e.updateComboTree(t)})))},onDropNode:function(t){if(this.targets&&0!==this.targets.length){var e=this,n=t.item,r=e.graph,i=n.getModel().comboId,o=i?r.findById(i):void 0;if(this.currentShouldEnd=this.shouldEnd.call(this,t,o),this.updatePositions(t,!this.currentShouldEnd),this.currentShouldEnd){if(this.onlyChangeComboSize)r.updateCombos();else if(i){var a=r.findById(i);e.comboActiveState&&r.setItemState(a,e.comboActiveState,!1),this.targets.map((function(t){var e=t.getModel();i!==e.comboId&&r.updateComboTree(t,i)})),r.updateCombo(a)}else this.targets.map((function(t){t.getModel().comboId&&r.updateComboTree(t)}));r.emit("dragnodeend",{items:this.targets,targetItem:n})}}},onDragEnter:function(t){var e=t.item;if(this.validationCombo(e)){var n=this.graph;this.comboActiveState&&n.setItemState(e,this.comboActiveState,!0)}},onDragLeave:function(t){var e=t.item;if(this.validationCombo(e)){var n=this.graph;this.comboActiveState&&n.setItemState(e,this.comboActiveState,!1)}},updatePositions:function(t,e){var n=this;this.targets&&0!==this.targets.length&&(this.get("enableDelegate")?this.enableDebounce?this.debounceUpdate({targets:this.targets,graph:this.graph,point:this.point,origin:this.origin,evt:t,updateEdge:this.get("updateEdge"),updateFunc:this.update}):e||this.targets.map((function(e){return n.update(e,t)})):this.targets.map((function(r){return n.update(r,t,e)})))},update:function(t,e,n){var r=this.origin,i=t.get("model"),o=t.get("id");this.point[o]||(this.point[o]={x:i.x||0,y:i.y||0});var a=e.x-r.x+this.point[o].x,s=e.y-r.y+this.point[o].y;n&&(a+=r.x-e.x,s+=r.y-e.y);var u={x:a,y:s};this.get("updateEdge")?this.graph.updateItem(t,u,!1):t.updatePosition(u)},debounceUpdate:(0,_.debounce)((function(t){var e=t.targets,n=t.graph,r=t.point,i=t.origin,o=t.evt,a=t.updateEdge;t.updateFunc,e.map((function(t){var e=t.get("model"),s=t.get("id");r[s]||(r[s]={x:e.x||0,y:e.y||0});var u={x:o.x-i.x+r[s].x,y:o.y-i.y+r[s].y};a?n.updateItem(t,u,!1):t.updatePosition(u)}))}),50,!0),updateDelegate:function(t){var e=this.graph;if(this.delegateRect){var n=t.x-this.origin.x+this.originPoint.minX,r=t.y-this.origin.y+this.originPoint.minY;this.delegateRect.attr({x:n,y:r})}else{var i=e.get("group"),o=(0,_.deepMix)({},ih.delegateStyle,this.delegateStyle),a=this.calculationGroupPosition(t),s=a.x,u=a.y,l=a.width,c=a.height,h=a.minX,f=a.minY;this.originPoint={x:s,y:u,width:l,height:c,minX:h,minY:f},this.delegateRect=i.addShape("rect",{attrs:(0,y.__assign)({width:l,height:c,x:s,y:u},o),name:"rect-delegate-shape"}),this.delegate=this.delegateRect,this.delegateRect.set("capture",!1)}},calculationGroupPosition:function(t){var e=this.targets;0===e.length&&e.push(t.item);for(var n=1/0,r=-1/0,i=1/0,o=-1/0,a=0;a<e.length;a++){var s=e[a].getBBox(),u=s.minX,l=s.minY,c=s.maxX,h=s.maxY;u<n&&(n=u),l<i&&(i=l),c>r&&(r=c),h>o&&(o=h)}return{x:Math.floor(n),y:Math.floor(i),width:Math.ceil(r)-Math.floor(n),height:Math.ceil(o)-Math.floor(i),minX:n,minY:i}}},aM={getDefaultCfg:function(){return{trigger:"mouseenter",activeState:"active",inactiveState:"inactive",resetSelected:!1,shouldUpdate:function(){return!0}}},getEvents:function(){return"mouseenter"===this.get("trigger")?{"node:mouseenter":"setAllItemStates","combo:mouseenter":"setAllItemStates","node:mouseleave":"clearActiveState","combo:mouseleave":"clearActiveState"}:{"node:click":"setAllItemStates","combo:click":"setAllItemStates","canvas:click":"clearActiveState","node:touchstart":"setOnTouchStart","combo:touchstart":"setOnTouchStart","canvas:touchstart":"clearOnTouchStart"}},setOnTouchStart:function(t){try{var e=t.originalEvent.touches,n=e[0],r=e[1];if(n&&r)return;t.preventDefault()}catch(t){console.warn("Touch original event not exist!")}this.setAllItemStates(t)},clearOnTouchStart:function(t){try{var e=t.originalEvent.touches,n=e[0],r=e[1];if(n&&r)return;t.preventDefault()}catch(t){console.warn("Touch original event not exist!")}this.clearActiveState(t)},setAllItemStates:function(t){var e=t.item,n=this.graph;if(this.item=e,this.shouldUpdate(t.item,{event:t,action:"activate"})){for(var r=this.activeState,i=this.inactiveState,o=n.getNodes(),a=n.getCombos(),s=n.getEdges(),u=n.get("vedges"),l=o.length,c=a.length,h=s.length,f=u.length,p=0;p<l;p++){var d=o[p],g=d.hasState("selected");this.resetSelected&&g&&n.setItemState(d,"selected",!1),n.setItemState(d,r,!1),i&&n.setItemState(d,i,!0)}for(p=0;p<c;p++){var v=a[p];g=v.hasState("selected"),this.resetSelected&&g&&n.setItemState(v,"selected",!1),n.setItemState(v,r,!1),i&&n.setItemState(v,i,!0)}for(p=0;p<h;p++){var m=s[p];n.setItemState(m,r,!1),i&&n.setItemState(m,i,!0)}for(p=0;p<f;p++){var y=u[p];n.setItemState(y,r,!1),i&&n.setItemState(y,i,!0)}i&&n.setItemState(e,i,!1),n.setItemState(e,r,!0);var _=e.getEdges(),b=_.length;for(p=0;p<b;p++){var x;x=(m=_[p]).getSource()===e?m.getTarget():m.getSource(),i&&n.setItemState(x,i,!1),n.setItemState(x,r,!0),n.setItemState(m,i,!1),n.setItemState(m,r,!0),m.toFront()}n.emit("afteractivaterelations",{item:t.item,action:"activate"})}},clearActiveState:function(t){var e=this,n=e.get("graph");if(e.shouldUpdate(t.item,{event:t,action:"deactivate"})){var r=this.activeState,i=this.inactiveState,o=n.get("autoPaint");n.setAutoPaint(!1);for(var a=n.getNodes()||[],s=n.getCombos()||[],u=n.getEdges()||[],l=n.get("vedges")||[],c=a.length,h=s.length,f=u.length,p=l.length,d=0;d<c;d++){var g=a[d];n.clearItemStates(g,[r,i])}for(d=0;d<h;d++){var v=s[d];n.clearItemStates(v,[r,i])}for(d=0;d<f;d++){var m=u[d];n.clearItemStates(m,[r,i,"deactivate"])}for(d=0;d<p;d++){var y=l[d];n.clearItemStates(y,[r,i,"deactivate"])}n.paint(),n.setAutoPaint(o),n.emit("afteractivaterelations",{item:t.item||e.get("item"),action:"deactivate"})}}};var sM=Math.min,uM=Math.max,lM=Math.abs,cM="shift",hM=["drag","shift","ctrl","alt","control"];const fM={getDefaultCfg:function(){return{brushStyle:{fill:"#EEF6FF",fillOpacity:.4,stroke:"#DDEEFE",lineWidth:1},onSelect:function(){},onDeselect:function(){},selectedState:"selected",trigger:cM,includeEdges:!0,selectedEdges:[],selectedNodes:[]}},getEvents:function(){return hM.indexOf(this.trigger.toLowerCase())>-1||(this.trigger=cM,console.warn("Behavior brush-select 的 trigger 参数不合法，请输入 'drag'、'shift'、'ctrl' 或 'alt'")),"drag"===this.trigger?{dragstart:"onMouseDown",drag:"onMouseMove",dragend:"onMouseUp","canvas:click":"clearStates"}:{dragstart:"onMouseDown",drag:"onMouseMove",dragend:"onMouseUp","canvas:click":"clearStates",keyup:"onKeyUp",keydown:"onKeyDown"}},onMouseDown:function(t){var e=t.item,n=this.brush;e||("drag"===this.trigger||this.keydown)&&(this.selectedNodes&&0!==this.selectedNodes.length&&this.clearStates(),n||(n=this.createBrush()),this.originPoint={x:t.canvasX,y:t.canvasY},n.attr({width:0,height:0}),n.show(),this.dragging=!0)},onMouseMove:function(t){this.dragging&&("drag"===this.trigger||this.keydown)&&this.updateBrush(t)},onMouseUp:function(t){this.graph,(this.brush||this.dragging)&&("drag"===this.trigger||this.keydown)&&(this.brush.remove(!0),this.brush=null,this.getSelectedNodes(t),this.dragging=!1)},clearStates:function(){var t=this.graph,e=this.selectedState,n=t.findAllByState("node",e),r=t.findAllByState("edge",e);n.forEach((function(n){return t.setItemState(n,e,!1)})),r.forEach((function(n){return t.setItemState(n,e,!1)})),this.selectedNodes=[],this.selectedEdges=[],this.onDeselect&&this.onDeselect(this.selectedNodes,this.selectedEdges),t.emit("nodeselectchange",{selectedItems:{nodes:[],edges:[]},select:!1})},getSelectedNodes:function(t){var e=this,n=this,r=n.graph,i=n.originPoint,o=n.shouldUpdate,a=this.selectedState,s={x:t.x,y:t.y},u=r.getPointByCanvas(i.x,i.y),l=sM(s.x,u.x),c=uM(s.x,u.x),h=sM(s.y,u.y),f=uM(s.y,u.y),p=[],d=[];r.getNodes().forEach((function(t){if(t.isVisible()){var e=t.getBBox();if(e.centerX>=l&&e.centerX<=c&&e.centerY>=h&&e.centerY<=f&&o(t,"select")){p.push(t);var n=t.getModel();d.push(n.id),r.setItemState(t,a,!0)}}}));var g=[];this.includeEdges&&p.forEach((function(t){t.getOutEdges().forEach((function(t){if(t.isVisible()){var n=t.getModel(),i=n.source,a=n.target;d.includes(i)&&d.includes(a)&&o(t,"select")&&(g.push(t),r.setItemState(t,e.selectedState,!0))}}))})),this.selectedEdges=g,this.selectedNodes=p,this.onSelect&&this.onSelect(p,g),r.emit("nodeselectchange",{selectedItems:{nodes:p,edges:g},select:!0})},createBrush:function(){var t=this.graph.get("canvas").addShape("rect",{attrs:this.brushStyle,capture:!1,name:"brush-shape"});return this.brush=t,this.delegate=t,t},updateBrush:function(t){var e=this.originPoint;this.brush.attr({width:lM(t.canvasX-e.x),height:lM(t.canvasY-e.y),x:sM(t.canvasX,e.x),y:sM(t.canvasY,e.y)})},onKeyDown:function(t){var e=t.key;if(e){var n=this.trigger.toLowerCase(),r=e.toLowerCase();this.keydown=r===n||"control"===r&&"ctrl"===n||"ctrl"===r&&"control"===n}},onKeyUp:function(){this.brush&&(this.brush.remove(!0),this.brush=null,this.dragging=!1),this.keydown=!1}};var pM="shift",dM=["shift","ctrl","alt","control"];const gM={getDefaultCfg:function(){return{multiple:!0,trigger:pM,selectedState:"selected"}},getEvents:function(){var t=this;return dM.indexOf(t.trigger.toLowerCase())>-1||(t.trigger=pM,console.warn("Behavior brush-select 的 trigger 参数不合法，请输入 'drag'、'shift'、'ctrl' 或 'alt'")),t.multiple?{"node:click":"onClick","combo:click":"onClick","canvas:click":"onCanvasClick",keyup:"onKeyUp",keydown:"onKeyDown"}:{"node:click":"onClick","combo:click":"onClick","canvas:click":"onCanvasClick"}},onClick:function(t){var e=this,n=t.item;if(n&&!n.destroyed){n.getType();var r=e.graph,i=e.keydown,o=e.multiple,a=e.shouldUpdate;if(e.shouldBegin.call(e,t)){if(!i||!o){var s=r.findAllByState("node",e.selectedState).concat(r.findAllByState("combo",e.selectedState));(0,_.each)(s,(function(t){t!==n&&r.setItemState(t,e.selectedState,!1)}))}if(n.hasState(e.selectedState)){a.call(e,t)&&r.setItemState(n,e.selectedState,!1);var u=r.findAllByState("node",e.selectedState),l=r.findAllByState("combo",e.selectedState);r.emit("nodeselectchange",{target:n,selectedItems:{nodes:u,combos:l},select:!1})}else a.call(e,t)&&r.setItemState(n,e.selectedState,!0),u=r.findAllByState("node",e.selectedState),l=r.findAllByState("combo",e.selectedState),r.emit("nodeselectchange",{target:n,selectedItems:{nodes:u,combos:l},select:!0})}}},onCanvasClick:function(){var t=this,e=this.graph,n=e.findAllByState("node",this.selectedState);(0,_.each)(n,(function(n){e.setItemState(n,t.selectedState,!1)}));var r=e.findAllByState("combo",this.selectedState);(0,_.each)(r,(function(n){e.setItemState(n,t.selectedState,!1)})),e.emit("nodeselectchange",{selectedItems:{nodes:[],edges:[],combos:[]},select:!1})},onKeyDown:function(t){var e=t.key;e&&(e.toLowerCase()===this.trigger.toLowerCase()||"control"===e.toLowerCase()?this.keydown=!0:this.keydown=!1)},onKeyUp:function(){this.keydown=!1}};var vM=ut;const mM={getDefaultCfg:function(){return{sensitivity:2,minZoom:void 0,maxZoom:void 0,enableOptimize:!1,optimizeZoom:.1,fixSelectedItems:{fixAll:!1,fixLineWidth:!1,fixLabel:!1,fixState:"selected"},animate:!1,animateCfg:{duration:500}}},getEvents:function(){var t=this.fixSelectedItems;return t.fixState||(t.fixState="selected"),t.fixAll&&(t.fixLineWidth=!0,t.fixLabel=!0),{wheel:"onWheel",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd"}},onTouchStart:function(t){var e=t.originalEvent.touches,n=e[0],r=e[1];t.preventDefault(),r&&(this.shouldBegin&&!this.shouldBegin.call(this,t)||(this.startPoint={pageX:n.pageX,pageY:n.pageY},this.moveable=!0,r&&(this.endPoint={pageX:r.pageX,pageY:r.pageY}),this.originScale=this.graph.getZoom()||this.currentScale||1))},onTouchMove:function(t){if(this.moveable){t.preventDefault();var e=t.originalEvent.touches,n=e[0],r=e[1];if(r){this.endPoint||(this.endPoint={pageX:r.pageX,pageY:r.pageY});var i=function(t,e){return Math.hypot(e.x-t.x,e.y-t.y)},o=i({x:n.pageX,y:n.pageY},{x:r.pageX,y:r.pageY})/i({x:this.startPoint.pageX,y:this.startPoint.pageY},{x:this.endPoint.pageX,y:this.endPoint.pageY}),a=this.originScale*o;this.currentScale=a;var s=this.get("minZoom")||this.graph.get("minZoom");if(!(a>(this.get("maxZoom")||this.graph.get("maxZoom"))||a<s)){var u=this.get("animate"),l=this.get("animateCfg"),c=this.graph.get("canvas").getPointByClient(t.clientX,t.clientY);this.graph.zoomTo(a,{x:c.x,y:c.y},u,l),this.graph.emit("wheelzoom",t)}}}},onTouchEnd:function(){this.moveable=!1,this.endPoint=null},onWheel:function(t){var e=this,n=this.graph,r=this.fixSelectedItems;if((!this.shouldBegin||this.shouldBegin.call(this,t))&&this.shouldUpdate.call(this,t)){t.preventDefault();var i,o=n.get("canvas").getPointByClient(t.clientX,t.clientY),a=this.get("sensitivity"),s=n.getZoom();i=s*(t.wheelDelta<0?1-.05*a:1/(1-.05*a));var u=this.get("minZoom")||n.get("minZoom");if(!(i>(this.get("maxZoom")||n.get("maxZoom"))||i<u)){if(this.get("enableOptimize")){var l=this.get("optimizeZoom"),c=this.get("optimized"),h=n.getNodes(),f=n.getEdges(),p=h.length,d=f.length;if(!c){for(var g=0;g<p;g++)if(!(A=h[g]).destroyed)for(var v=(Y=A.get("group").get("children")).length,m=0;m<v;m++)(N=Y[m]).destoryed||N.get("isKeyShape")||(N.set("ori-visibility",N.get("ori-visibility")||N.get("visible")),N.hide());for(var y=0;y<d;y++)for(v=(Y=(X=f[y]).get("group").get("children")).length,m=0;m<v;m++)(N=Y[m]).set("ori-visibility",N.get("ori-visibility")||N.get("visible")),N.hide();this.set("optimized",!0)}clearTimeout(this.get("timeout"));var b=setTimeout((function(){var t=n.getZoom();if(e.get("optimized")){e.set("optimized",!1);for(var r=0;r<p;r++){var i=h[r],o=(c=i.get("group").get("children")).length;if(t<l)(s=(g=i.getKeyShape()).get("ori-visibility"))&&g.show();else for(var a=0;a<o;a++){var s=(m=c[a]).get("ori-visibility");!m.get("visible")&&s&&s&&m.show()}}for(var u=0;u<d;u++){var c,g,v=f[u];if(o=(c=v.get("group").get("children")).length,t<l)(s=(g=v.getKeyShape()).get("ori-visibility"))&&g.show();else for(a=0;a<o;a++){var m;(m=c[a]).get("visible")||(s=m.get("ori-visibility"))&&m.show()}}}}),100);this.set("timeout",b)}if(s<=1){var x=void 0,w=void 0;if(r.fixAll||r.fixLineWidth||r.fixLabel){x=n.findAllByState("node",r.fixState),w=n.findAllByState("edge",r.fixState);for(var E=s/i,S=x.length,C=0;C<S;C++){var A,T=(A=x[C]).getContainer(),k=A.getModel(),M=A.getOriginStyle(),P=A.getStateStyle(r.fixState),I=A.get("shapeFactory").getShape(k.type).getStateStyle(r.fixState,A)[r.fixState];if(r.fixAll){if(i<=1){var O=(0,_.clone)(T.getMatrix());O||(O=[1,0,0,0,1,0,0,0,1]);var R=A.getModel(),L=R.x,D=R.y;O=vM(O,[["t",-L,-D],["s",E,E],["t",L,D]]),T.setMatrix(O)}}else for(v=(Y=T.get("children")).length,m=0;m<v;m++){var N=Y[m],B=void 0,z=void 0;if(r.fixLabel&&"text"===N.get("type")){B=N.attr("fontSize")||12;var F=P[N.get("name")],Z=I[N.get("name")],j=F?F.fontSize:12,U=Z?Z.fontSize:12,G=j||U||12;if(i<=1&&N.attr("fontSize",G/i),z)break}if(r.fixLineWidth&&N.get("isKeyShape")){z=N.attr("lineWidth")||0;var V=P.lineWidth||I.lineWidth||M.lineWidth||0;if(i<=1&&N.attr("lineWidth",V/i),B)break}}}for(var W=w.length,H=0;H<W;H++){var X,Y=(T=(X=w[H]).getContainer()).get("children");for(k=X.getModel(),P=X.getStateStyle(r.fixState),I=X.get("shapeFactory").getShape(k.type).getStateStyle(r.fixState,X)[r.fixState],v=Y.length,m=0;m<v&&(N=Y[m],B=void 0,z=void 0,!r.fixLabel&&!r.fixAll||"text"!==N.get("type")||(B=N.attr("fontSize")||12,F=P[N.get("name")],Z=I[N.get("name")],j=F?F.fontSize:12,U=Z?Z.fontSize:12,G=j||U||12,i<=1&&N.attr("fontSize",G/i),!z))&&(!r.fixLineWidth&&!r.fixAll||!N.get("isKeyShape")||(z=N.attr("lineWidth")||0,V=P.lineWidth||I.lineWidth||1,i<=1&&N.attr("lineWidth",V/i),!B));m++);}}}var q=this.get("animate"),K=this.get("animateCfg");n.zoomTo(i,{x:o.x,y:o.y},q,K),n.emit("wheelzoom",t)}}}},yM={onMouseEnter:function(t){var e=t.item;this.currentTarget=e,this.showTooltip(t),this.graph.emit("tooltipchange",{item:t.item,action:"show"})},onMouseMove:function(t){this.shouldUpdate(t)?this.currentTarget&&t.item===this.currentTarget&&this.updatePosition(t):this.hideTooltip()},onMouseLeave:function(t){this.shouldEnd(t)&&(this.hideTooltip(),this.graph.emit("tooltipchange",{item:this.currentTarget,action:"hide"}),this.currentTarget=null)},showTooltip:function(t){var e=this.container;if(t.item&&!t.item.destroyed){e||(e=this.createTooltip(this.graph.get("canvas")),this.container=e);var n=this.formatText(t.item.get("model"),t);e.innerHTML=n,jS(this.container,{visibility:"visible"}),this.updatePosition(t)}},hideTooltip:function(){jS(this.container,{visibility:"hidden"})},updatePosition:function(t){var e=this.get("shouldBegin"),n=this,r=n.width,i=n.height,o=n.container,a=n.graph;if(e(t)){var s=a.getPointByClient(t.clientX,t.clientY),u=a.getCanvasByPoint(s.x,s.y),l=u.x,c=u.y,h=o.getBoundingClientRect();l>r/2?l-=h.width:l+=this.offset,c>i/2?c-=h.height:c+=this.offset;var f="".concat(l,"px"),p="".concat(c,"px");jS(this.container,{left:f,top:p,visibility:"visible"})}else jS(o,{visibility:"hidden"})},createTooltip:function(t){var e=t.get("el");e.style.position="relative";var n=RS('<div class="g6-tooltip g6-'.concat(this.item,'-tooltip"></div>'));return e.parentNode.appendChild(n),jS(n,{position:"absolute",visibility:"visible"}),this.width=t.get("width"),this.height=t.get("height"),this.container=n,this.graph.get("tooltips").push(n),n}},_M=(0,y.__assign)({getDefaultCfg:function(){return{item:"node",offset:12,formatText:function(t){return t.label}}},getEvents:function(){return{"node:mouseenter":"onMouseEnter","node:mouseleave":"onMouseLeave","node:mousemove":"onMouseMove",afterremoveitem:"onMouseLeave"}}},yM),bM=(0,y.__assign)({getDefaultCfg:function(){return{item:"edge",offset:12,formatText:function(t){return"source: ".concat(t.source," target: ").concat(t.target)}}},getEvents:function(){return{"edge:mouseenter":"onMouseEnter","edge:mouseleave":"onMouseLeave","edge:mousemove":"onMouseMove",afterremoveitem:"onMouseLeave"}}},yM);var xM="click",wM=["click","dblclick"];const EM={getDefaultCfg:function(){return{trigger:xM,onChange:function(){}}},getEvents:function(){var t,e;return wM.includes(this.trigger)?e=this.trigger:(e=xM,console.warn("Behavior collapse-expand 的 trigger 参数不合法，请输入 'click' 或 'dblclick'")),(t={})["node:".concat(e)]="onNodeClick",t.touchstart="onNodeClick",t},onNodeClick:function(t){var e=t.item;if(e){var n=this.graph.findDataById(e.get("id"));if(n){var r=n.children;if(r&&0!==r.length){var i=!n.collapsed;this.shouldBegin(t,i)&&(n.collapsed=i,e.getModel().collapsed=i,this.graph.emit("itemcollapsed",{item:t.item,collapsed:i}),this.shouldUpdate(t,i)&&(this.onChange(e,i),this.graph.layout()))}}}}};var SM=dS.calculationItemsBBox,CM=function t(e,n){if(!1!==n(e)&&e){var r=e.get("combos");if(0===r.length)return!1;(0,_.each)(r,(function(e){t(e,n)}))}};const AM={getDefaultCfg:function(){return{enableDelegate:!1,delegateStyle:{},onlyChangeComboSize:!1,activeState:"",selectedState:"selected"}},getEvents:function(){return{"combo:dragstart":"onDragStart","combo:drag":"onDrag","combo:dragend":"onDragEnd","combo:drop":"onDrop","node:drop":"onNodeDrop","combo:dragenter":"onDragEnter","combo:dragleave":"onDragLeave"}},validationCombo:function(t){var e=t.item;return!(!e||e.destroyed||!this.shouldUpdate.call(this,t)||"combo"!==e.getType())},onDragStart:function(t){var e=this,n=this.graph,r=t.item;if(this.currentShouldEnd=!0,this.validationCombo(t)){this.targets=[];var i=n.findAllByState("combo",this.selectedState),o=r.get("id"),a=i.filter((function(t){var e=t.get("id");return o===e}));0===a.length?this.targets.push(r):this.targets=i,this.activeState&&this.targets.map((function(t){var r=t.getModel();if(r.parentId){var i=n.findById(r.parentId);i&&n.setItemState(i,e.activeState,!0)}})),this.point={},this.originPoint={},this.origin={x:t.x,y:t.y},this.currentItemChildCombos=[],CM(r,(function(t){if(t.destroyed)return!1;var n=t.getModel();return e.currentItemChildCombos.push(n.id),!0}))}},onDrag:function(t){var e=this;if(this.origin&&this.validationCombo(t))if(this.enableDelegate)this.updateDelegate(t);else{if(this.activeState){var n=this.graph,r=t.item,i=r.getModel(),o=n.getCombos(),a=r.getBBox(),s=a.centerX,u=a.centerY,l=a.width,c=o.filter((function(t){var n=t.getModel();return i.parentId,n.id!==i.id&&!e.currentItemChildCombos.includes(n.id)}));c.map((function(t){var r=t.getBBox(),i=r.centerX,o=r.centerY,a=r.width,c=s-i,h=u-o,f=2*Math.sqrt(c*c+h*h);l+a-f>.8*l?n.setItemState(t,e.activeState,!0):n.setItemState(t,e.activeState,!1)}))}(0,_.each)(this.targets,(function(n){e.updateCombo(n,t)}))}},updatePositions:function(t,e){var n=this;(this.enableDelegate||e)&&(0,_.each)(this.targets,(function(r){n.updateCombo(r,t,e)}))},onDrop:function(t){var e=this,n=t.item;if(this.currentShouldEnd=this.shouldEnd.call(this,t,n),this.updatePositions(t,!this.currentShouldEnd),this.currentShouldEnd&&n&&this.targets&&!n.destroyed){var r=this.graph,i=n.getModel();this.targets.map((function(t){t.getModel().parentId!==i.id?(e.activeState&&r.setItemState(n,e.activeState,!1),e.onlyChangeComboSize?r.updateCombo(t):r.updateComboTree(t,i.id)):r.updateCombo(n)})),this.end(n,t),this.endComparison=!0}},onNodeDrop:function(t){var e=this;if(this.targets&&0!==this.targets.length){var n=this.graph,r=t.item.getModel().comboId,i=r?n.findById(r):void 0;if(this.currentShouldEnd=this.shouldEnd.call(this,t,i),this.updatePositions(t,!this.currentShouldEnd),this.currentShouldEnd){var o;if(r){if(this.activeState){var a=n.findById(r);n.setItemState(a,this.activeState,!1)}this.targets.map((function(t){e.onlyChangeComboSize?n.updateCombo(t):r!==t.getID()&&(o=n.findById(r),r!==t.getModel().parentId&&n.updateComboTree(t,r))}))}else this.targets.map((function(t){e.onlyChangeComboSize?n.updateCombo(t):t.getModel().comboId&&n.updateComboTree(t)}));this.endComparison=!0,this.end(o,t)}}},onDragEnter:function(t){if(this.origin&&this.validationCombo(t)){var e=t.item,n=this.graph;this.activeState&&n.setItemState(e,this.activeState,!0)}},onDragLeave:function(t){if(this.origin&&this.validationCombo(t)){var e=t.item,n=this.graph;this.activeState&&n.setItemState(e,this.activeState,!1)}},onDragEnd:function(t){if(this.targets&&0!==this.targets.length){var e=t.item;this.currentShouldEnd&&this.updatePositions(t);var n=this.getParentCombo(e.getModel().parentId),r=this.graph;n&&this.activeState&&r.setItemState(n,this.activeState,!1),this.end(void 0,t)}},end:function(t,e){var n=this;if(this.origin){var r=this.graph;this.delegateShape&&(r.get("delegateGroup").clear(),this.delegateShape=null),t&&this.activeState&&r.setItemState(t,this.activeState,!1),t||this.targets.map((function(t){n.onlyChangeComboSize?r.updateCombo(t):r.updateComboTree(t)})),this.point=[],this.origin=null,this.originPoint=null,this.targets.length=0}},traverse:function(t,e){var n=this;if(!1!==e(t)&&t){var r=t.get("combos");(0,_.each)(r,(function(t){n.traverse(t,e)}));var i=t.get("nodes");(0,_.each)(i,(function(t){n.traverse(t,e)}))}},updateCombo:function(t,e,n){var r=this;this.traverse(t,(function(t){return!t.destroyed&&(r.updateSignleItem(t,e,n),!0)}))},updateSignleItem:function(t,e,n){var r=this.origin,i=this.graph,o=t.getModel(),a=t.get("id");this.point[a]||(this.point[a]={x:o.x,y:o.y});var s=e.x-r.x+this.point[a].x,u=e.y-r.y+this.point[a].y;n&&(s+=r.x-e.x,u+=r.y-e.y),i.updateItem(t,{x:s,y:u})},getParentCombo:function(t){var e=this.graph;if(t){var n=e.findById(t);if(n)return n}},updateDelegate:function(t){var e=this.graph;if(this.delegateShape){var n=t.x-this.origin.x+this.originPoint.minX,r=t.y-this.origin.y+this.originPoint.minY;this.delegateShape.attr({x:n,y:r})}else{var i,o=e.get("delegateGroup"),a=(i=this.targets.length>1?SM(this.targets):this.targets[0].getBBox()).x,s=i.y,u=i.width,l=i.height,c=i.minX,h=i.minY;this.originPoint={x:a,y:s,width:u,height:l,minX:c,minY:h};var f=(0,y.__assign)((0,y.__assign)({},ih.delegateStyle),this.delegateStyle);this.delegateShape=o.addShape("rect",{attrs:(0,y.__assign)({width:i.width,height:i.height,x:i.x,y:i.y},f),name:"combo-delegate-shape"}),this.delegateShape.set("capture",!1),this.delegate=this.delegateShape}}};var TM="dblclick",kM=["click","dblclick"];const MM={getDefaultCfg:function(){return{trigger:TM,relayout:!0}},getEvents:function(){var t,e;return kM.includes(this.trigger)?e=this.trigger:(e=TM,console.warn("Behavior collapse-expand-group 的 trigger 参数不合法，请输入 'click' 或 'dblclick'")),(t={})["combo:".concat(e)]="onComboClick",t},onComboClick:function(t){var e=t.item,n=this.graph,r=this.relayout;if(e&&!e.destroyed&&"combo"===e.getType()){var i=e.getModel().id;i&&(n.collapseExpandCombo(i),r&&n.get("layout")?n.layout():n.refreshPositions())}}};var PM=dS.isPolygonsIntersect,IM=dS.pathToPoints,OM="shift",RM=["drag","shift","ctrl","alt","control"];const LM={getDefaultCfg:function(){return{delegateStyle:{fill:"#EEF6FF",fillOpacity:.4,stroke:"#DDEEFE",lineWidth:1},onSelect:function(){},onDeselect:function(){},selectedState:"selected",trigger:OM,includeEdges:!0,selectedEdges:[],selectedNodes:[]}},getEvents:function(){return RM.indexOf(this.trigger.toLowerCase())>-1||(this.trigger=OM,console.warn("Behavior lasso-select 的 trigger 参数不合法，请输入 'drag'、'shift'、'ctrl' 或 'alt'")),"drag"===this.trigger?{dragstart:"onDragStart",drag:"onDragMove",dragend:"onDragEnd","canvas:click":"clearStates"}:{dragstart:"onDragStart",drag:"onDragMove",dragend:"onDragEnd",keyup:"onKeyUp",keydown:"onKeyDown","canvas:click":"clearStates"}},onDragStart:function(t){var e=this.lasso;t.item||("drag"===this.trigger||this.keydown)&&(this.selectedNodes&&0!==this.selectedNodes.length&&this.clearStates(),e||(e=this.createLasso()),this.dragging=!0,this.originPoint={x:t.x,y:t.y},this.points.push(this.originPoint),e.show())},onDragMove:function(t){this.dragging&&("drag"===this.trigger||this.keydown)&&(this.points.push({x:t.x,y:t.y}),this.updateLasso(t))},onDragEnd:function(t){(this.lasso||this.dragging)&&("drag"===this.trigger||this.keydown)&&(this.points.push(this.originPoint),this.getSelectedItems(),this.lasso.remove(!0),this.lasso=null,this.points=[],this.dragging=!1)},getLassoPath:function(){var t=this.points,e=[];return t.length&&(t.forEach((function(t,n){0===n?e.push(["M",t.x,t.y]):e.push(["L",t.x,t.y])})),e.push(["L",t[0].x,t[0].y])),e},clearStates:function(){var t=this.graph,e=this.selectedState,n=t.findAllByState("node",e),r=t.findAllByState("edge",e);n.forEach((function(n){return t.setItemState(n,e,!1)})),r.forEach((function(n){return t.setItemState(n,e,!1)})),this.onDeselect&&this.onDeselect(this.selectedNodes,this.selectedEdges),this.selectedNodes=[],this.selectedEdges=[],t.emit("nodeselectchange",{selectedItems:{nodes:[],edges:[]},select:!1})},getSelectedItems:function(){var t=this,e=this.graph,n=this.shouldUpdate,r=this.points.map((function(t){return[e.getCanvasByPoint(t.x,t.y).x,e.getCanvasByPoint(t.x,t.y).y]})),i=this.selectedState,o=[],a=[];e.getNodes().forEach((function(t){if(t.isVisible()&&function(t,e){var n,r=t.getKeyShape();if("path"===t.get("type"))n=IM(r.attr("path"));else{var i=r.getCanvasBBox();n=[[i.minX,i.minY],[i.maxX,i.minY],[i.maxX,i.maxY],[i.minX,i.maxY]]}return PM(e,n)}(t,r)&&n(t,"select")){o.push(t);var s=t.getModel();a.push(s.id),e.setItemState(t,i,!0)}}));var s=[];this.includeEdges&&o.forEach((function(r){r.getOutEdges().forEach((function(r){if(r.isVisible()){var i=r.getModel(),o=i.source,u=i.target;a.includes(o)&&a.includes(u)&&n(r,"select")&&(s.push(r),e.setItemState(r,t.selectedState,!0))}}))})),this.selectedEdges=s,this.selectedNodes=o,this.onSelect&&this.onSelect(o,s),e.emit("nodeselectchange",{selectedItems:{nodes:o,edges:s},select:!0})},createLasso:function(){var t=this.graph.get("delegateGroup").addShape("path",{attrs:(0,y.__assign)({path:[]},this.delegateStyle),capture:!1,name:"lasso-shape"});return this.lasso=t,this.delegate=t,this.points=[],t},updateLasso:function(t){this.lasso.attr({path:this.getLassoPath()})},onKeyDown:function(t){var e=t.key;e&&(e.toLowerCase()===this.trigger.toLowerCase()?this.keydown=!0:this.keydown=!1)},onKeyUp:function(){this.lasso&&(this.lasso.remove(!0),this.lasso=null,this.points=[],this.dragging=!1),this.keydown=!1}};var DM="click",NM=["click","drag"],BM=void 0,zM=["shift","ctrl","control","alt","meta",void 0];const FM={getDefaultCfg:function(){return{trigger:DM,key:BM,edgeConfig:{},getEdgeConfig:void 0}},getEvents:function(){var t,e=this;return NM.indexOf(e.trigger.toLowerCase())>-1||(e.trigger=DM,console.warn("Behavior create-edge 的 trigger 参数不合法，请输入 'click'，'drag'")),e.key&&-1===zM.indexOf(e.key.toLowerCase())&&(e.trigger=BM,console.warn("Behavior create-edge 的 key 参数不合法，请输入 'shift'，'ctrl'，'alt'，'control'，或 undefined")),"drag"===e.trigger?t={"node:dragstart":"onClick","combo:dragstart":"onClick",drag:"updateEndPoint","node:drop":"onClick","combo:drop":"onClick",dragend:"onDragEnd"}:"click"===e.trigger&&(t={"node:click":"onClick",mousemove:"updateEndPoint","edge:click":"cancelCreating","canvas:click":"cancelCreating","combo:click":"onClick"}),e.key&&(t.keydown="onKeyDown",t.keyup="onKeyUp"),t},onDragEnd:function(t){var e=this;if(!e.key||e.keydown){var n=t.item;n&&n.getID()!==e.source&&"node"===n.getType()||e.cancelCreating({item:e.edge,x:t.x,y:t.y})}},onClick:function(t){var e=this;if(!e.key||e.keydown){var n=t.item,r=e.graph,i=n.getModel(),o=e.getEdgeConfig;if(e.addingEdge&&e.edge){if(!e.shouldEnd.call(e,t))return;var a=void 0;a=o&&(0,_.isFunction)(o)?o({source:e.source,target:i.id}):e.edgeConfig;var s=(0,y.__assign)({target:i.id},a);if(e.source===i.id&&(s.type="loop"),r.emit("beforecreateedge",{}),r.updateItem(e.edge,s,!1),r.get("enabledStack")){var u=(0,y.__assign)((0,y.__assign)({},e.edge.getModel()),{itemType:"edge"}),l={};l.edges=[u],r.pushStack("add",{before:{},after:l})}r.emit("aftercreateedge",{edge:e.edge}),e.edge.getKeyShape().set("capture",!0),e.edge=null,e.addingEdge=!1}else{if(!e.shouldBegin.call(e,t))return;a=void 0,a=o&&(0,_.isFunction)(o)?o({source:i.id,target:i.id}):e.edgeConfig,e.edge=r.addItem("edge",(0,y.__assign)({source:i.id,target:i.id},a),!1),e.source=i.id,e.addingEdge=!0,e.edge.getKeyShape().set("capture",!1)}}},updateEndPoint:function(t){var e=this;if(!e.key||e.keydown){var n={x:t.x,y:t.y};e.graph.findById(e.source)?e.addingEdge&&e.edge&&e.graph.updateItem(e.edge,{target:n},!1):e.addingEdge=!1}},cancelCreating:function(t){var e=this;if(!e.key||e.keydown){var n=e.graph,r=t.item;if(e.addingEdge&&t.target&&t.target.isCanvas&&t.target.isCanvas())return n.removeItem(e.edge,!1),e.edge=null,void(e.addingEdge=!1);e.addingEdge&&e.edge===r&&(n.removeItem(e.edge,!1),e.edge=null,e.addingEdge=!1)}},onKeyDown:function(t){var e=this,n=t.key;n&&(n.toLowerCase()===e.key.toLowerCase()?e.keydown=!0:e.keydown=!1)},onKeyUp:function(){var t=this;t.addingEdge&&t.edge&&(t.graph.removeItem(t.edge,!1),t.addingEdge=!1,t.edge=null),this.keydown=!1}};var ZM="ctrl",jM=["shift","ctrl","alt","control"];const UM={getDefaultCfg:function(){return{trigger:ZM,combinedKey:"1",functionName:"fitView",functionParams:[]}},getEvents:function(){return jM.indexOf(this.trigger.toLowerCase())>-1||(this.trigger=ZM,console.warn("Behavior shortcuts-fit-view 的 trigger 参数 '".concat(this.trigger,"' 不合法，请输入 'drag'、'shift'、'ctrl' 或 'alt'"))),this.combinedKey===this.trigger&&(this.combinedKey=void 0),{keyup:"onKeyUp",keydown:"onKeyDown"}},onKeyDown:function(t){var e=t.key;if(e){var n=this.trigger.toLowerCase(),r=e.toLowerCase();this.triggerKeydown||(this.triggerKeydown=r===n||"control"===r&&"ctrl"===n||"ctrl"===r&&"control"===n);var i=this.graph;if(!i[this.functionName])return console.warn("Behavior shortcuts-fit-view 的 functionName 参数 '".concat(this.functionName,"' 不合法，它不是 Graph 的一个函数名")),{};if(!this.triggerKeydown||this.combinedKey){var o=this.combinedKey.toLowerCase();this.triggerKeydown&&(r===o||"control"===r&&"ctrl"===o||"ctrl"===r&&"control"===o)&&(this.functionParams&&this.functionParams.length?i[this.functionName].apply(i,this.functionParams):i[this.functionName]())}else this.functionParams&&this.functionParams.length?i[this.functionName].apply(i,this.functionParams):i[this.functionName]()}},onKeyUp:function(){this.brush&&(this.brush.remove(!0),this.brush=null,this.dragging=!1),this.triggerKeydown=!1}};var GM=["shift","ctrl","alt","control"];const VM={getDefaultCfg:function(){return{direction:"both",enableOptimize:!1,zoomKey:"ctrl",scalableRange:0}},getEvents:function(){return this.zoomKey&&-1!==GM.indexOf(this.zoomKey)||(this.zoomKey="ctrl"),{wheel:"onWheel"}},onWheel:function(t){var e=this,n=this.graph,r=t["".concat(this.zoomKey,"Key")];if("control"===this.zoomKey&&(r=t.ctrlKey),r){var i=n.get("canvas").getPointByClient(t.clientX,t.clientY),o=n.getZoom();t.wheelDelta>0?o+=.05*o:o-=.05*o,n.zoomTo(o,{x:i.x,y:i.y})}else{var a=t.deltaX||t.movementX,s=t.deltaY||t.movementY;!s&&navigator.userAgent.indexOf("Firefox")>-1&&(s=125*-t.wheelDelta/3);var u=this.graph.get("width"),l=this.graph.get("height"),c=this.graph.get("canvas").getCanvasBBox(),h=this.scalableRange,f=this.scalableRange;h<1&&h>-1&&(h*=u,f*=l);var p=c.minX,d=c.maxX,g=c.minY,v=c.maxY;a>0?d<-h?a=0:d-a<-h&&(a=d+h):a<0&&(p>u+h?a=0:p-a>u+h&&(a=p-(u+h))),s>0?v<-f?s=0:v-s<-f&&(s=v+f):s<0&&(g>l+f?s=0:g-s>l+f&&(s=g-(l+f))),"x"===this.get("direction")?s=0:"y"===this.get("direction")&&(a=0),n.translate(-a,-s)}if(t.preventDefault(),this.get("enableOptimize")){var m=this.get("optimizeZoom"),y=this.get("optimized"),_=n.getNodes(),b=n.getEdges(),x=_.length,w=b.length;if(!y){for(var E=0;E<x;E++){var S=_[E];if(!S.destroyed)for(var C=(k=S.get("group").get("children")).length,A=0;A<C;A++)(M=k[A]).destoryed||M.get("isKeyShape")||(M.set("ori-visibility",M.get("ori-visibility")||M.get("visible")),M.hide())}for(var T=0;T<w;T++){var k;for(C=(k=b[T].get("group").get("children")).length,A=0;A<C;A++){var M;(M=k[A]).set("ori-visibility",M.get("ori-visibility")||M.get("visible")),M.hide()}}this.set("optimized",!0)}clearTimeout(this.get("timeout"));var P=setTimeout((function(){var t=n.getZoom();if(e.get("optimized")){e.set("optimized",!1);for(var r=0;r<x;r++){var i=_[r],o=(l=i.get("group").get("children")).length;if(t<m)(s=(c=i.getKeyShape()).get("ori-visibility"))&&c.show();else for(var a=0;a<o;a++){var s=(f=l[a]).get("ori-visibility");!f.get("visible")&&s&&s&&f.show()}}for(var u=0;u<w;u++){var l,c,h=b[u];if(o=(l=h.get("group").get("children")).length,t<m)(s=(c=h.getKeyShape()).get("ori-visibility"))&&c.show();else for(a=0;a<o;a++){var f;(f=l[a]).get("visible")||(s=f.get("ori-visibility"))&&f.show()}}}}),100);this.set("timeout",P)}}};var WM={"drag-canvas":iM,"zoom-canvas":mM,"drag-node":oM,"activate-relations":aM,"brush-select":fM,"click-select":gM,"lasso-select":LM,tooltip:_M,"edge-tooltip":bM,"collapse-expand":EM,"drag-combo":AM,"collapse-expand-combo":MM,"create-edge":FM,"shortcuts-call":UM,"scroll-canvas":VM};(0,_.each)(WM,(function(t,e){gu(e,t)}));var HM=(0,y.__assign)((0,y.__assign)({},i),mu),XM=Tk.Grid,YM=Tk.Minimap,qM=Tk.Bundling,KM=Tk.Menu,QM=Tk.Fisheye,JM=Tk.ToolBar,$M=Tk.Tooltip,tP=Tk.TimeBar,eP=Tk.ImageMinimap,nP=Tk.EdgeFilterLens,rP=Tk.SnapLine,iP=Tk.Legend;const oP={version:(ih.version,"4.5.1"),Graph:NS,TreeGraph:ZS,Util:dS,Layout:nS,TreeLayout:vS,registerLayout:mS,Global:ih,registerBehavior:gu,registerCombo:du,registerEdge:pu,registerNode:fu,Minimap:Tk.Minimap,Grid:Tk.Grid,Bundling:Tk.Bundling,Menu:Tk.Menu,ToolBar:Tk.ToolBar,Tooltip:Tk.Tooltip,Legend:Tk.Legend,TimeBar:tP,SnapLine:rP,Fisheye:QM,ImageMinimap:eP,EdgeFilterLens:nP,Algorithm:HM,Arrow:nu,Marker:ru,Shape:iu};var aP="4.5.1"},6846:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(6917),i=n(8395),o=function(){function t(t){void 0===t&&(t={}),this.matrix=[1,0,0,0,1,0,0,0,1],this.isTransposed=!1,Object.assign(this,t),this.init()}return t.prototype.init=function(){var t=this.start,e=this.end,n={x:(t.x+e.x)/2,y:(t.y+e.y)/2};this.center=n,this.width=Math.abs(e.x-t.x),this.height=Math.abs(e.y-t.y)},t.prototype._swapDim=function(t){var e=this[t];if(e){var n=e.start;e.start=e.end,e.end=n}},t.prototype.getCenter=function(){return this.center},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.convertDim=function(t,e){var n=this[e],r=n.start;return r+t*(n.end-r)},t.prototype.invertDim=function(t,e){var n=this[e],r=n.start;return(t-r)/(n.end-r)},t.prototype.convertPoint=function(t){return t},t.prototype.invertPoint=function(t){return t},t.prototype.applyMatrix=function(t,e,n){void 0===n&&(n=0);var r=this.matrix,o=[t,e,n];return i.transformMat3(o,o,r),o},t.prototype.invertMatrix=function(t,e,n){void 0===n&&(n=0);var o=this.matrix,a=r.default.invert([],o),s=[t,e,n];return i.transformMat3(s,s,a),s},t.prototype.convert=function(t){var e=this.convertPoint(t),n=e.x,r=e.y,i=this.applyMatrix(n,r,1);return{x:i[0],y:i[1]}},t.prototype.invert=function(t){var e=this.invertMatrix(t.x,t.y,1);return this.invertPoint({x:e[0],y:e[1]})},t.prototype.rotate=function(t){var e=this.matrix,n=this.center;return r.default.translate(e,e,[-n.x,-n.y]),r.default.rotate(e,e,t),r.default.translate(e,e,[n.x,n.y]),this},t.prototype.reflect=function(t){return"x"===t?this._swapDim("x"):this._swapDim("y"),this},t.prototype.scale=function(t,e){var n=this.matrix,i=this.center;return r.default.translate(n,n,[-i.x,-i.y]),r.default.scale(n,n,[t,e]),r.default.translate(n,n,[i.x,i.y]),this},t.prototype.translate=function(t,e){var n=this.matrix;return r.default.translate(n,n,[t,e]),this},t.prototype.transpose=function(){return this.isTransposed=!this.isTransposed,this},t}();e.default=o},8324:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(655),i=n(6846),o=n(1069),a=n(3418),s=n(2993),u=function(t){function e(e){var n=t.call(this,r.__assign({projection:"EPSG3857",zoom:7,mapCenter:[116.400146,39.926588]},e))||this;return n.type="geo",n.isGeo=!0,e.center?n.center=e.center:n.center=n.mapCenter,n._init(),n}return r.__extends(e,t),e.prototype._init=function(){var t=this.start,e=this.end;this.center=a.toLngLat(this.center),this.width=Math.abs(e.x-t.x),this.height=Math.abs(e.y-t.y),this.crs=o.getCRS(this.projection)},e.prototype.getZoom=function(){return this.zoom},e.prototype.setZoom=function(t){this.zoom=t},e.prototype.setCenter=function(t){this.center=a.toLngLat(t)},e.prototype.getCenter=function(){return this.center},e.prototype.convertPoint=function(t){var e=[t.x,t.y],n=this.project(a.toLngLat(e),this.zoom).round(),r=this.getPixelOrigin(),i=n.subtract(r);return{x:i.x,y:i.y}},e.prototype.invertPoint=function(t){var e=s.toPoint(t),n=this.getPixelOrigin(),r=e.add(n),i=this.unproject(r,this.zoom);return{x:i.lng,y:i.lat}},e.prototype.layerPointToLatLng=function(t){var e=this.getPixelOrigin(),n=t.add(e);return this.unproject(n,this.zoom)},e.prototype.latLngToLayerPoint=function(t){var e=this.project(a.toLngLat(t),this.zoom).round(),n=this.getPixelOrigin();return e.subtract(n)},e.prototype.getPixelOrigin=function(){var t=this.width/2,e=this.height/2;return this.crs.lngLatToPoint(a.toLngLat(this.center),this.zoom).subtract({y:e,x:t})},e.prototype.project=function(t,e){var n=void 0===e?this.zoom:e;return this.crs.lngLatToPoint(a.toLngLat(t),n)},e.prototype.unproject=function(t,e){var n=void 0===e?this.zoom:e;return this.crs.pointToLngLat(s.toPoint(t),n)},e.prototype.distance=function(t,e){return this.crs.distance(a.toLngLat(t),a.toLngLat(e))},e}(i.default);e.default=u},3341:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(248),i=n(3282),o=n(4881),a=n(9242),s=.5/(Math.PI*i.sphericalMercator.R),u=new o.Transformation(s,.5,-s,.5);e.epsg3857=a.mix({},r.earth,{code:"EPSG:3857",projection:i.sphericalMercator,transformation:u}),e.epsg900913=a.mix({},e.epsg3857,{code:"EPSG:900913"})},9298:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(248),i=n(8425),o=n(4881),a=n(9242),s=new o.Transformation(1/180,1,-1/180,.5);e.epsg4326=a.mix({},r.earth,{code:"EPSG:4326",projection:i.lngLatProjection,transformation:s})},623:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(7181),i=n(8425),o=n(4881),a=n(9242),s=new o.Transformation(1,0,-1,0);e.simple=a.mix({},r.CRS,{projection:i.lngLatProjection,transformation:s,scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var n=e.lng-t.lng,r=e.lat-t.lat;return Math.sqrt(n*n+r*r)},infinite:!0})},7181:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(2077),i=n(3418),o=n(6355),a=n(3282),s=n(4881),u=n(3199),l=.5/(Math.PI*a.sphericalMercator.R),c=new s.Transformation(l,.5,-l,.5);e.CRS={wrapLng:[-180,180],wrapLat:null,projection:a.sphericalMercator,transformation:c,lngLatToPoint:function(t,e){var n=this.projection.project(t),r=this.scale(e);return this.transformation.transform(n,r)},pointToLngLat:function(t,e){var n=this.scale(e),r=this.transformation.untransform(t,n);return this.projection.unproject(r)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},zoom:function(t){return Math.log(t/256)/Math.LN2},scale:function(t){return 256*Math.pow(2,t)},getProjectedBounds:function(t){if(this.infinite)return new r.Bounds([[1/0,1/0],[1/0,1/0]]);var e=this.projection.bounds,n=this.scale(t),i=this.transformation.transform(e.min,n),o=this.transformation.transform(e.max,n);return new r.Bounds(i,o)},infinite:!1,wrapLngLat:function(t){var e=Array.isArray(this.wrapLng)?o.wrapNum(t.lng,this.wrapLng,!0):t.lng,n=Array.isArray(this.wrapLat)?o.wrapNum(t.lat,this.wrapLat,!0):t.lat,r=t.alt;return new i.LngLat(e,n,r)},wrapLngLatBounds:function(t){var e=t.getCenter(),n=this.wrapLngLat(e),r=e.lat-n.lat,o=e.lng-n.lng;if(0===r&&0===o)return t;var a=t.getSouthWest(),s=t.getNorthEast(),l=new i.LngLat(a.lng-o,a.lat-r),c=new i.LngLat(s.lng-o,s.lat-r);return new u.LngLatBounds(l,c)}}},248:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(7181),i=n(9242);e.earth=i.mix({},r.CRS,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var n=Math.PI/180,r=t.lat*n,i=e.lat*n,o=Math.sin((e.lat-t.lat)*n/2),a=Math.sin((e.lng-t.lng)*n/2),s=o*o+Math.cos(r)*Math.cos(i)*a*a,u=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*u}})},1069:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(248),i=n(3341),o=n(9298),a=n(623),s={epsg3857:i.epsg3857,epsg4326:o.epsg4326,simple:a.simple,earth:r.earth,epsg900913:i.epsg900913};e.getCRS=function(t){return s[t.toLowerCase()]}},2077:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(2993),i=function(){function t(t,e){if(t){var n=e?[t,e]:t;if(Array.isArray(n))for(var r=0,i=n.length;r<i;r+=1)this.extend(n[r])}}return t.prototype.extend=function(t){var e=r.toPoint(t);return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(e.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(e.y,this.max.y)):(this.min=e.clone(),this.max=e.clone()),this},t.prototype.getCenter=function(t){return new r.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},t.prototype.getBottomLeft=function(){return new r.Point(this.min.x,this.max.y)},t.prototype.getTopRight=function(){return new r.Point(this.max.x,this.min.y)},t.prototype.getBottomRight=function(){return this.max},t.prototype.getTopLeft=function(){return this.min},t.prototype.getSize=function(){return this.max.subtract(this.min)},t.prototype.contains=function(e){var n,i,a=e;return(a=a instanceof r.Point||"number"==typeof a[0]?r.toPoint(a):o(a))instanceof t?(n=a.min,i=a.max):n=i=e,n.x>=this.min.x&&i.x<=this.max.x&&n.y>=this.min.y&&i.y<=this.max.y},t.prototype.intersect=function(t){var e=o(t),n=this.min,r=this.max,i=e.min,a=e.max,s=a.x>=n.x&&i.x<=r.x,u=a.y>=n.y&&i.y<=r.y;return s&&u},t.prototype.overlaps=function(t){var e=o(t),n=this.min,r=this.max,i=e.min,a=e.max,s=a.x>n.x&&i.x<r.x,u=a.y>n.y&&i.y<r.y;return s&&u},t.prototype.isValid=function(){return!(!this.min||!this.max)},t}();function o(t,e){return!t||t instanceof i?t:new i(t,e)}e.Bounds=i,e.toBounds=o},3199:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(3418),i=function(){function t(t,e){if(t){var n=e?[t,e]:t;if(Array.isArray(n))for(var r=0,i=n.length;r<i;r+=1)this.extend(n[r])}}return t.prototype.extend=function(e){var n,i,a=this.southWest,s=this.northEast;if(e instanceof r.LngLat)n=e,i=e;else{if(!(e instanceof t))return e&&Array.isArray(e)?Array.isArray(e[0])?this.extend(o(e)):this.extend(r.toLngLat(e)):this;if(n=e.southWest,i=e.northEast,!n||!i)return this}return a||s?(a.lat=Math.min(n.lat,a.lat),a.lng=Math.min(n.lng,a.lng),s.lat=Math.max(i.lat,s.lat),s.lng=Math.max(i.lng,s.lng)):(this.southWest=new r.LngLat(n.lng,n.lat),this.northEast=new r.LngLat(i.lng,i.lat)),this},t.prototype.pad=function(e){var n=this.southWest,i=this.northEast,o=Math.abs(n.lat-i.lat)*e,a=Math.abs(n.lng-i.lng)*e;return new t(new r.LngLat(n.lng-a,n.lat-o),new r.LngLat(i.lng+a,i.lat+o))},t.prototype.getCenter=function(){return new r.LngLat((this.southWest.lng+this.northEast.lng)/2,(this.southWest.lat+this.northEast.lat)/2)},t.prototype.getSouthWest=function(){return this.southWest},t.prototype.getNorthEast=function(){return this.northEast},t.prototype.getNorthWest=function(){return new r.LngLat(this.getWest(),this.getNorth())},t.prototype.getSouthEast=function(){return new r.LngLat(this.getEast(),this.getSouth())},t.prototype.getWest=function(){return this.southWest.lng},t.prototype.getSouth=function(){return this.southWest.lat},t.prototype.getNorth=function(){return this.northEast.lat},t.prototype.getEast=function(){return this.northEast.lng},t.prototype.contains=function(e){var n=e;n=Array.isArray(n)&&"number"==typeof n[0]||n instanceof r.LngLat||"lat"in n?r.toLngLat(n):o(n);var i,a,s=this.southWest,u=this.northEast;return n instanceof t?(i=n.getSouthWest(),a=n.getNorthEast()):i=a=n,i.lat>=s.lat&&a.lat<=u.lat&&i.lng>=s.lng&&a.lng<=u.lng},t.prototype.intersects=function(t){var e=o(t),n=this.southWest,r=this.northEast,i=e.getSouthWest(),a=e.getNorthEast(),s=a.lat>=n.lat&&i.lat<=r.lat,u=a.lng>=n.lng&&i.lng<=r.lng;return s&&u},t.prototype.overlaps=function(t){var e=o(t),n=this.southWest,r=this.northEast,i=e.getSouthWest(),a=e.getNorthEast(),s=a.lat>n.lat&&i.lat<r.lat,u=a.lng>n.lng&&i.lng<r.lng;return s&&u},t.prototype.toBBoxString=function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},t.prototype.equals=function(t,e){if(!t)return!1;var n=o(t);return this.southWest.equals(n.getSouthWest(),e)&&this.northEast.equals(n.getNorthEast(),e)},t.prototype.isValid=function(){return!(!this.southWest||!this.northEast)},t}();function o(t,e){return t instanceof i?t:void 0!==e?new i(t,e):new i(t)}e.LngLatBounds=i,e.toLngLatBounds=o},3418:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(248),i=n(6355),o=n(3199),a=function(){function t(t,e,n){if(isNaN(e)||isNaN(t))throw new Error("无效的经纬度参数: ("+t+",' "+e);this.lat=+e,this.lng=+t,void 0!==n&&(this.alt=+n)}return t.prototype.equals=function(t,e){if(!t)return!1;var n=s(t);return void 0!==n&&Math.max(Math.abs(this.lat-n.lat),Math.abs(this.lng-n.lng))<=(void 0===e?1e-9:e)},t.prototype.toString=function(t){return"LngLat("+i.formatNum(this.lng,t)+", "+i.formatNum(this.lat,t)+")"},t.prototype.distanceTo=function(t){return r.earth.distance(this,s(t))},t.prototype.wrap=function(){return r.earth.wrapLngLat(this)},t.prototype.toBounds=function(t){var e=180*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return o.toLngLatBounds([this.lng-n,this.lat-e],[this.lng+n,this.lat+e])},t.prototype.clone=function(){return new t(this.lng,this.lat,this.alt)},t}();function s(t,e,n){if(t instanceof a)return t;if(Array.isArray(t)&&"object"!=typeof t[0]){if(3===t.length)return new a(t[0],t[1],t[2]);if(2===t.length)return new a(t[0],t[1])}if(null==t)throw new Error("无效的经纬度参数: ("+t+", "+e+")");if("object"==typeof t&&"lat"in t)return new a(t.lng,"lng"in t?t.lat:0,t.alt);if(void 0===e)throw new Error("无效的经纬度参数: ("+t+", "+e+")");return new a(Number(t),e,n)}e.LngLat=a,e.toLngLat=s},2993:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(6355),i=function(){function t(t,e,n){this.x=n?Math.round(t):t,this.y=n?Math.round(e):e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.add=function(t,e,n){return this.clone()._add(o(t,e,n))},t.prototype._add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.subtract=function(t,e,n){return this.clone()._subtract(o(t,e,n))},t.prototype._subtract=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.divideBy=function(t){return this.clone()._divideBy(t)},t.prototype._divideBy=function(t){return this.x/=t,this.y/=t,this},t.prototype.multiplyBy=function(t){return this.clone()._multiplyBy(t)},t.prototype._multiplyBy=function(t){return this.x*=t,this.y*=t,this},t.prototype.scaleBy=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.unscaleBy=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.round=function(){return this.clone()._round()},t.prototype._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},t.prototype.floor=function(){return this.clone()._floor()},t.prototype._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},t.prototype.ceil=function(){return this.clone()._ceil()},t.prototype._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},t.prototype.trunc=function(){return this.clone()._trunc()},t.prototype._trunc=function(){return this.x=r.trunc(this.x),this.y=r.trunc(this.y),this},t.prototype.distanceTo=function(t){var e=o(t),n=e.x-this.x,r=e.y-this.y;return Math.sqrt(n*n+r*r)},t.prototype.equals=function(t,e){var n=o(t);return Math.max(Math.abs(this.x-n.x),Math.abs(this.y-n.y))<=(void 0===e?1e-9:e)},t.prototype.contains=function(t){var e=o(t);return Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},t.prototype.toString=function(){return"Point("+r.formatNum(this.x)+", "+r.formatNum(this.y)+")"},t}();function o(t,e,n){return t instanceof i?t:Array.isArray(t)?new i(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new i(t.x,t.y):new i(t,e,n)}e.Point=i,e.toPoint=o},8425:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(3418),i=n(2077),o=n(2993);e.lngLatProjection={project:function(t){return new o.Point(t.lng,t.lat)},unproject:function(t){return new r.LngLat(t.x,t.y)},bounds:new i.Bounds([-180,-90],[180,90])}},3282:(t,e,n)=>{"use strict";e.__esModule=!0;var r,i=n(3418),o=n(2077),a=n(2993);e.sphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,n=this.MAX_LATITUDE,r=Math.max(Math.min(n,t.lat),-n),i=Math.sin(r*e);return new a.Point(this.R*t.lng*e,this.R*Math.log((1+i)/(1-i))/2)},unproject:function(t){var e=180/Math.PI;return new i.LngLat(t.x*e/this.R,(2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e)},bounds:(r=6378137*Math.PI,new o.Bounds([-r,-r],[r,r]))}},4881:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(2993),i=function(){function t(t,e,n,r){if(Array.isArray(t))return this.a=t[0],this.b=t[1],this.c=t[2],void(this.d=t[3]);this.a=t,this.b=e,this.c=n,this.d=r}return t.prototype.transform=function(t,e){return this._transform(t.clone(),e)},t.prototype._transform=function(t,e){var n=e||1;return t.x=n*(this.a*t.x+this.b),t.y=n*(this.c*t.y+this.d),t},t.prototype.untransform=function(t,e){var n=e||1;return new r.Point((t.x/n-this.b)/this.a,(t.y/n-this.d)/this.c)},t}();e.Transformation=i},6086:(t,e,n)=>{"use strict";var r=n(8324);e.fG=r;var i=n(2077);e.YZ=i.Bounds,i.toBounds;var o=n(3418);o.LngLat,e.WN=o.toLngLat;var a=n(3199);a.LngLatBounds,e.Dv=a.toLngLatBounds;var s=n(2993);e.E9=s.Point,s.toPoint},6355:(t,e)=>{"use strict";e.__esModule=!0,e.trunc=function(t){return t>0?Math.floor(t):Math.ceil(t)},e.formatNum=function(t,e){var n=Math.pow(10,void 0===e?6:e);return Math.round(t*n)/n},e.wrapNum=function(t,e,n){var r=e[1],i=e[0],o=r-i;return t===r&&n?t:((t-i)%o+o)%o+i}},6917:(t,e,n)=>{"use strict";e.__esModule=!0;var r=n(1502);r.translate=function(t,e,n){var i=Array(9);return r.fromTranslation(i,n),r.multiply(t,i,e)},r.rotate=function(t,e,n){var i=Array(9);return r.fromRotation(i,n),r.multiply(t,i,e)},r.scale=function(t,e,n){var i=Array(9);return r.fromScaling(i,n),r.multiply(t,i,e)},r.transform=function(t,e){for(var n=[].concat(t),i=0,o=e.length;i<o;i+=1){var a=e[i];switch(a[0]){case"t":r.translate(n,n,[a[1],a[2]]);break;case"s":r.scale(n,n,[a[1],a[2]]);break;case"r":r.rotate(n,n,a[1])}}return n},e.default=r},4988:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setMatrixArrayType=function(t){e.ARRAY_TYPE=t},e.toRadian=function(t){return t*r},e.equals=function(t,e){return Math.abs(t-e)<=n*Math.max(1,Math.abs(t),Math.abs(e))};var n=e.EPSILON=1e-6;e.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,e.RANDOM=Math.random;var r=Math.PI/180},1502:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=function(){var t=new r.ARRAY_TYPE(9);return r.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},e.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},e.clone=function(t){var e=new r.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromValues=function(t,e,n,i,o,a,s,u,l){var c=new r.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=n,c[3]=i,c[4]=o,c[5]=a,c[6]=s,c[7]=u,c[8]=l,c},e.set=function(t,e,n,r,i,o,a,s,u,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.transpose=function(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},e.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=c*a-s*l,f=-c*o+s*u,p=l*o-a*u,d=n*h+r*f+i*p;return d?(d=1/d,t[0]=h*d,t[1]=(-c*r+i*l)*d,t[2]=(s*r-i*a)*d,t[3]=f*d,t[4]=(c*n-i*u)*d,t[5]=(-s*n+i*o)*d,t[6]=p*d,t[7]=(-l*n+r*u)*d,t[8]=(a*n-r*o)*d,t):null},e.adjoint=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8];return t[0]=a*c-s*l,t[1]=i*l-r*c,t[2]=r*s-i*a,t[3]=s*u-o*c,t[4]=n*c-i*u,t[5]=i*o-n*s,t[6]=o*l-a*u,t[7]=r*u-n*l,t[8]=n*a-r*o,t},e.determinant=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8];return e*(l*o-a*u)+n*(-l*i+a*s)+r*(u*i-o*s)},e.multiply=i,e.translate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=n[0],p=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=f*r+p*a+l,t[7]=f*i+p*s+c,t[8]=f*o+p*u+h,t},e.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=Math.sin(n),p=Math.cos(n);return t[0]=p*r+f*a,t[1]=p*i+f*s,t[2]=p*o+f*u,t[3]=p*a-f*r,t[4]=p*s-f*i,t[5]=p*u-f*o,t[6]=l,t[7]=c,t[8]=h,t},e.scale=function(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},e.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},e.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,h=r*s,f=i*a,p=i*s,d=i*u,g=o*a,v=o*s,m=o*u;return t[0]=1-h-d,t[3]=c-m,t[6]=f+v,t[1]=c+m,t[4]=1-l-d,t[7]=p-g,t[2]=f-v,t[5]=p+g,t[8]=1-l-h,t},e.normalFromMat4=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],p=e[11],d=e[12],g=e[13],v=e[14],m=e[15],y=n*s-r*a,_=n*u-i*a,b=n*l-o*a,x=r*u-i*s,w=r*l-o*s,E=i*l-o*u,S=c*g-h*d,C=c*v-f*d,A=c*m-p*d,T=h*v-f*g,k=h*m-p*g,M=f*m-p*v,P=y*M-_*k+b*T+x*A-w*C+E*S;return P?(P=1/P,t[0]=(s*M-u*k+l*T)*P,t[1]=(u*A-a*M-l*C)*P,t[2]=(a*k-s*A+l*S)*P,t[3]=(i*k-r*M-o*T)*P,t[4]=(n*M-i*A+o*C)*P,t[5]=(r*A-n*k-o*S)*P,t[6]=(g*E-v*w+m*x)*P,t[7]=(v*b-d*E-m*_)*P,t[8]=(d*w-g*b+m*y)*P,t):null},e.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},e.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},e.subtract=o,e.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},e.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},e.equals=function(t,e){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=e[0],p=e[1],d=e[2],g=e[3],v=e[4],m=e[5],y=e[6],_=e[7],b=e[8];return Math.abs(n-f)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-p)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-d)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-g)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-v)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-m)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(l-y)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-_)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(h-b)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))};var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(4988));function i(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=n[0],p=n[1],d=n[2],g=n[3],v=n[4],m=n[5],y=n[6],_=n[7],b=n[8];return t[0]=f*r+p*a+d*l,t[1]=f*i+p*s+d*c,t[2]=f*o+p*u+d*h,t[3]=g*r+v*a+m*l,t[4]=g*i+v*s+m*c,t[5]=g*o+v*u+m*h,t[6]=y*r+_*a+b*l,t[7]=y*i+_*s+b*c,t[8]=y*o+_*u+b*h,t}function o(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}e.mul=i,e.sub=o},8395:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0,e.create=o,e.clone=function(t){var e=new i.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.length=a,e.fromValues=s,e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.set=function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t},e.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},e.subtract=u,e.multiply=l,e.divide=c,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},e.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},e.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},e.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},e.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t},e.distance=h,e.squaredDistance=f,e.squaredLength=p,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},e.normalize=d,e.dot=g,e.cross=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t},e.lerp=function(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t},e.hermite=function(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*l+i[0]*c,t[1]=e[1]*s+n[1]*u+r[1]*l+i[1]*c,t[2]=e[2]*s+n[2]*u+r[2]*l+i[2]*c,t},e.bezier=function(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,h=3*u*a,f=u*o;return t[0]=e[0]*l+n[0]*c+r[0]*h+i[0]*f,t[1]=e[1]*l+n[1]*c+r[1]*h+i[1]*f,t[2]=e[2]*l+n[2]*c+r[2]*h+i[2]*f,t},e.random=function(t,e){e=e||1;var n=2*i.RANDOM()*Math.PI,r=2*i.RANDOM()-1,o=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*o,t[1]=Math.sin(n)*o,t[2]=r*e,t},e.transformMat4=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t},e.transformMat3=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},e.transformQuat=function(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],l=e[2],c=i*l-o*u,h=o*s-r*l,f=r*u-i*s,p=i*f-o*h,d=o*c-r*f,g=r*h-i*c,v=2*a;return c*=v,h*=v,f*=v,p*=2,d*=2,g*=2,t[0]=s+c+p,t[1]=u+h+d,t[2]=l+f+g,t},e.rotateX=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},e.rotateY=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},e.rotateZ=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},e.angle=function(t,e){var n=s(t[0],t[1],t[2]),r=s(e[0],e[1],e[2]);d(n,n),d(r,r);var i=g(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)},e.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},e.equals=function(t,e){var n=t[0],r=t[1],o=t[2],a=e[0],s=e[1],u=e[2];return Math.abs(n-a)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-u)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))};var r,i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(4988));function o(){var t=new i.ARRAY_TYPE(3);return i.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function a(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}function s(t,e,n){var r=new i.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=n,r}function u(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function l(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function c(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function h(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)}function f(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function p(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function d(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function g(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}e.sub=u,e.mul=l,e.div=c,e.dist=h,e.sqrDist=f,e.len=a,e.sqrLen=p,e.forEach=(r=o(),function(t,e,n,i,o,a){var s,u=void 0;for(e||(e=3),n||(n=0),s=i?Math.min(i*e+n,t.length):t.length,u=n;u<s;u+=e)r[0]=t[u],r[1]=t[u+1],r[2]=t[u+2],o(r,r,a),t[u]=r[0],t[u+1]=r[1],t[u+2]=r[2];return t})},1746:function(t){var e;"undefined"!=typeof self&&self,e=function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=31)}([function(t,e,n){"use strict";var r=n(4);e.a=function(t){return Array.isArray?Array.isArray(t):Object(r.a)(t,"Array")}},function(t,e,n){"use strict";e.a=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)}},function(t,e,n){"use strict";var r=n(0),i=n(13);e.a=function(t,e){if(t)if(Object(r.a)(t))for(var n=0,o=t.length;n<o&&!1!==e(t[n],n);n++);else if(Object(i.a)(t))for(var a in t)if(t.hasOwnProperty(a)&&!1===e(t[a],a))break}},function(t,e,n){"use strict";var r=n(4);e.a=function(t){return Object(r.a)(t,"Function")}},function(t,e,n){"use strict";var r={}.toString;e.a=function(t,e){return r.call(t)==="[object "+e+"]"}},function(t,e,n){"use strict";var r=n(4);e.a=function(t){return Object(r.a)(t,"Number")}},function(t,e,n){"use strict";e.a=function(t){return null==t}},function(t,e,n){var r=n(33).mix;t.exports={assign:r}},function(t,e,n){"use strict";var r=n(4);e.a=function(t){return Object(r.a)(t,"String")}},function(t,e,n){"use strict";var r=n(15),i=n(4);e.a=function(t){if(!Object(r.a)(t)||!Object(i.a)(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}},function(t,e,n){"use strict";var r=n(6);e.a=function(t){return Object(r.a)(t)?"":t.toString()}},function(t,e,n){var r=n(18),i=function(){function t(t,e){void 0===e&&(e={}),this.options=e,this.rootNode=r(t,e)}return t.prototype.execute=function(){throw new Error("please override this method")},t}();t.exports=i},function(t,e,n){"use strict";var r=n(1);e.a=function(t,e){return!!Object(r.a)(t)&&t.indexOf(e)>-1}},function(t,e,n){"use strict";e.a=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e}},function(t,e,n){"use strict";var r=n(2),i=n(1);e.a=function(t,e){if(!Object(i.a)(t))return t;var n=[];return Object(r.a)(t,(function(t,r){e(t,r)&&n.push(t)})),n}},function(t,e,n){"use strict";e.a=function(t){return"object"==typeof t&&null!==t}},function(t,e,n){"use strict";function r(t,e){for(var n in e)e.hasOwnProperty(n)&&"constructor"!==n&&void 0!==e[n]&&(t[n]=e[n])}e.a=function(t,e,n,i){return e&&r(t,e),n&&r(t,n),i&&r(t,i),t}},function(t,e,n){var r=n(30),i=["LR","RL","TB","BT","H","V"],o=["LR","RL","H"],a=i[0];t.exports=function(t,e,n){var s=e.direction||a;if(e.isHorizontal=function(t){return o.indexOf(t)>-1}(s),s&&-1===i.indexOf(s))throw new TypeError("Invalid direction: "+s);if(s===i[0])n(t,e);else if(s===i[1])n(t,e),t.right2left();else if(s===i[2])n(t,e);else if(s===i[3])n(t,e),t.bottom2top();else if(s===i[4]||s===i[5]){var u=r(t,e),l=u.left,c=u.right;n(l,e),n(c,e),e.isHorizontal?l.right2left():l.bottom2top(),c.translate(l.x-c.x,l.y-c.y),t.x=l.x,t.y=c.y;var h=t.getBoundingBox();e.isHorizontal?h.top<0&&t.translate(0,-h.top):h.left<0&&t.translate(-h.left,0)}var f=e.fixedRoot;return void 0===f&&(f=!0),f&&t.translate(-(t.x+t.width/2+t.hgap),-(t.y+t.height/2+t.vgap)),t}},function(t,e,n){var r=n(7),i={getId:function(t){return t.id||t.name},getPreH:function(t){return t.preH||0},getPreV:function(t){return t.preV||0},getHGap:function(t){return t.hgap||18},getVGap:function(t){return t.vgap||18},getChildren:function(t){return t.children},getHeight:function(t){return t.height||36},getWidth:function(t){var e=t.label||" ";return t.width||18*e.split("").length}};function o(t,e){var n=this;if(n.vgap=n.hgap=0,t instanceof o)return t;n.data=t;var r=e.getHGap(t),i=e.getVGap(t);return n.preH=e.getPreH(t),n.preV=e.getPreV(t),n.width=e.getWidth(t),n.height=e.getHeight(t),n.width+=n.preH,n.height+=n.preV,n.id=e.getId(t),n.x=n.y=0,n.depth=0,n.children||(n.children=[]),n.addGap(r,i),n}r.assign(o.prototype,{isRoot:function(){return 0===this.depth},isLeaf:function(){return 0===this.children.length},addGap:function(t,e){var n=this;n.hgap+=t,n.vgap+=e,n.width+=2*t,n.height+=2*e},eachNode:function(t){for(var e,n=[this];e=n.shift();)t(e),n=e.children.concat(n)},DFTraverse:function(t){this.eachNode(t)},BFTraverse:function(t){for(var e,n=[this];e=n.shift();)t(e),n=n.concat(e.children)},getBoundingBox:function(){var t={left:Number.MAX_VALUE,top:Number.MAX_VALUE,width:0,height:0};return this.eachNode((function(e){t.left=Math.min(t.left,e.x),t.top=Math.min(t.top,e.y),t.width=Math.max(t.width,e.x+e.width),t.height=Math.max(t.height,e.y+e.height)})),t},translate:function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.eachNode((function(n){n.x+=t,n.y+=e,n.x+=n.preH,n.y+=n.preV}))},right2left:function(){var t=this,e=t.getBoundingBox();t.eachNode((function(t){t.x=t.x-2*(t.x-e.left)-t.width})),t.translate(e.width,0)},bottom2top:function(){var t=this,e=t.getBoundingBox();t.eachNode((function(t){t.y=t.y-2*(t.y-e.top)-t.height})),t.translate(0,e.height)}}),t.exports=function(t,e,n){void 0===e&&(e={});var a,s=new o(t,e=r.assign({},i,e)),u=[s];if(!n&&!t.collapsed)for(;a=u.shift();)if(!a.data.collapsed){var l=e.getChildren(a.data),c=l?l.length:0;if(a.children=new Array(c),l&&c)for(var h=0;h<c;h++){var f=new o(l[h],e);a.children[h]=f,u.push(f),f.parent=a,f.depth=a.depth+1}}return s}},function(t,e,n){"use strict";var r=n(6),i=n(20);e.a=function(t,e){var n=Object(i.a)(e),o=n.length;if(Object(r.a)(t))return!o;for(var a=0;a<o;a+=1){var s=n[a];if(e[s]!==t[s]||!(s in t))return!1}return!0}},function(t,e,n){"use strict";var r=n(2),i=n(3),o=Object.keys?function(t){return Object.keys(t)}:function(t){var e=[];return Object(r.a)(t,(function(n,r){Object(i.a)(t)&&"prototype"===r||e.push(r)})),e};e.a=o},function(t,e,n){"use strict";var r=n(1),i=Array.prototype.splice;e.a=function(t,e){if(!Object(r.a)(t))return[];for(var n=t?e.length:0,o=n-1;n--;){var a=void 0,s=e[n];n!==o&&s===a||(a=s,i.call(t,s,1))}return t}},function(t,e,n){"use strict";var r=n(12),i=n(2);e.a=function(t){var e=[];return Object(i.a)(t,(function(t){Object(r.a)(e,t)||e.push(t)})),e}},function(t,e,n){"use strict";var r=n(0),i=n(3),o=n(24);e.a=function(t,e){if(!e)return{0:t};if(!Object(i.a)(e)){var n=Object(r.a)(e)?e:e.replace(/\s+/g,"").split("*");e=function(t){for(var e="_",r=0,i=n.length;r<i;r++)e+=t[n[r]]&&t[n[r]].toString();return e}}return Object(o.a)(t,e)}},function(t,e,n){"use strict";var r=n(2),i=n(0),o=n(3),a=Object.prototype.hasOwnProperty;e.a=function(t,e){if(!e||!Object(i.a)(t))return{};var n,s={},u=Object(o.a)(e)?e:function(t){return t[e]};return Object(r.a)(t,(function(t){n=u(t),a.call(s,n)?s[n].push(t):s[n]=[t]})),s}},function(t,e,n){"use strict";e.a=function(t,e){return t.hasOwnProperty(e)}},function(t,e,n){"use strict";var r=n(2),i=n(3),o=Object.values?function(t){return Object.values(t)}:function(t){var e=[];return Object(r.a)(t,(function(n,r){Object(i.a)(t)&&"prototype"===r||e.push(n)})),e};e.a=o},function(t,e,n){"use strict";var r={}.toString;e.a=function(t){return r.call(t).replace(/^\[object /,"").replace(/]$/,"")}},function(t,e,n){"use strict";var r=Object.prototype;e.a=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||r)}},function(t,e,n){"use strict";var r=n(15),i=n(1),o=n(8),a=function(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Object(o.a)(t)||Object(o.a)(e))return!1;if(Object(i.a)(t)||Object(i.a)(e)){if(t.length!==e.length)return!1;for(var n=!0,s=0;s<t.length&&(n=a(t[s],e[s]));s++);return n}if(Object(r.a)(t)||Object(r.a)(e)){var u=Object.keys(t),l=Object.keys(e);if(u.length!==l.length)return!1;for(n=!0,s=0;s<u.length&&(n=a(t[u[s]],e[u[s]]));s++);return n}return!1};e.a=a},function(t,e,n){var r=n(18);t.exports=function(t,e){for(var n=r(t.data,e,!0),i=r(t.data,e,!0),o=t.children.length,a=Math.round(o/2),s=e.getSide||function(t,e){return e<a?"right":"left"},u=0;u<o;u++){var l=t.children[u];"right"===s(l,u)?i.children.push(l):n.children.push(l)}return n.eachNode((function(t){t.isRoot()||(t.side="left")})),i.eachNode((function(t){t.isRoot()||(t.side="right")})),{left:n,right:i}}},function(t,e,n){var r={compactBox:n(32),dendrogram:n(114),indented:n(116),mindmap:n(118)};t.exports=r},function(t,e,n){var r=n(11),i=n(113),o=n(17),a=n(7),s=function(t){var e,n;function r(){return t.apply(this,arguments)||this}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,r.prototype.execute=function(){return o(this.rootNode,this.options,i)},r}(r),u={};t.exports=function(t,e){return e=a.assign({},u,e),new s(t,e).execute()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(12);n.d(e,"contains",(function(){return r.a})),n.d(e,"includes",(function(){return r.a}));var i=n(34);n.d(e,"difference",(function(){return i.a}));var o=n(35);n.d(e,"find",(function(){return o.a}));var a=n(36);n.d(e,"findIndex",(function(){return a.a}));var s=n(37);n.d(e,"firstValue",(function(){return s.a}));var u=n(38);n.d(e,"flatten",(function(){return u.a}));var l=n(39);n.d(e,"flattenDeep",(function(){return l.a}));var c=n(40);n.d(e,"getRange",(function(){return c.a}));var h=n(41);n.d(e,"pull",(function(){return h.a}));var f=n(21);n.d(e,"pullAt",(function(){return f.a}));var p=n(42);n.d(e,"reduce",(function(){return p.a}));var d=n(43);n.d(e,"remove",(function(){return d.a}));var g=n(44);n.d(e,"sortBy",(function(){return g.a}));var v=n(45);n.d(e,"union",(function(){return v.a}));var m=n(22);n.d(e,"uniq",(function(){return m.a}));var y=n(46);n.d(e,"valuesOfKey",(function(){return y.a}));var _=n(47);n.d(e,"head",(function(){return _.a}));var b=n(48);n.d(e,"last",(function(){return b.a}));var x=n(49);n.d(e,"startsWith",(function(){return x.a}));var w=n(50);n.d(e,"endsWith",(function(){return w.a}));var E=n(14);n.d(e,"filter",(function(){return E.a}));var S=n(51);n.d(e,"every",(function(){return S.a}));var C=n(52);n.d(e,"some",(function(){return C.a}));var A=n(53);n.d(e,"group",(function(){return A.a}));var T=n(24);n.d(e,"groupBy",(function(){return T.a}));var k=n(23);n.d(e,"groupToMap",(function(){return k.a}));var M=n(54);n.d(e,"getWrapBehavior",(function(){return M.a}));var P=n(55);n.d(e,"wrapBehavior",(function(){return P.a}));var I=n(56);n.d(e,"number2color",(function(){return I.a}));var O=n(57);n.d(e,"parseRadius",(function(){return O.a}));var R=n(58);n.d(e,"clamp",(function(){return R.a}));var L=n(59);n.d(e,"fixedBase",(function(){return L.a}));var D=n(60);n.d(e,"isDecimal",(function(){return D.a}));var N=n(61);n.d(e,"isEven",(function(){return N.a}));var B=n(62);n.d(e,"isInteger",(function(){return B.a}));var z=n(63);n.d(e,"isNegative",(function(){return z.a}));var F=n(64);n.d(e,"isNumberEqual",(function(){return F.a}));var Z=n(65);n.d(e,"isOdd",(function(){return Z.a}));var j=n(66);n.d(e,"isPositive",(function(){return j.a}));var U=n(67);n.d(e,"maxBy",(function(){return U.a}));var G=n(68);n.d(e,"minBy",(function(){return G.a}));var V=n(69);n.d(e,"mod",(function(){return V.a}));var W=n(70);n.d(e,"toDegree",(function(){return W.a}));var H=n(71);n.d(e,"toInteger",(function(){return H.a}));var X=n(72);n.d(e,"toRadian",(function(){return X.a}));var Y=n(73);n.d(e,"forIn",(function(){return Y.a}));var q=n(25);n.d(e,"has",(function(){return q.a}));var K=n(74);n.d(e,"hasKey",(function(){return K.a}));var Q=n(75);n.d(e,"hasValue",(function(){return Q.a}));var J=n(20);n.d(e,"keys",(function(){return J.a}));var $=n(19);n.d(e,"isMatch",(function(){return $.a}));var tt=n(26);n.d(e,"values",(function(){return tt.a}));var et=n(76);n.d(e,"lowerCase",(function(){return et.a}));var nt=n(77);n.d(e,"lowerFirst",(function(){return nt.a}));var rt=n(78);n.d(e,"substitute",(function(){return rt.a}));var it=n(79);n.d(e,"upperCase",(function(){return it.a}));var ot=n(80);n.d(e,"upperFirst",(function(){return ot.a}));var at=n(27);n.d(e,"getType",(function(){return at.a}));var st=n(81);n.d(e,"isArguments",(function(){return st.a}));var ut=n(0);n.d(e,"isArray",(function(){return ut.a}));var lt=n(1);n.d(e,"isArrayLike",(function(){return lt.a}));var ct=n(82);n.d(e,"isBoolean",(function(){return ct.a}));var ht=n(83);n.d(e,"isDate",(function(){return ht.a}));var ft=n(84);n.d(e,"isError",(function(){return ft.a}));var pt=n(3);n.d(e,"isFunction",(function(){return pt.a}));var dt=n(85);n.d(e,"isFinite",(function(){return dt.a}));var gt=n(6);n.d(e,"isNil",(function(){return gt.a}));var vt=n(86);n.d(e,"isNull",(function(){return vt.a}));var mt=n(5);n.d(e,"isNumber",(function(){return mt.a}));var yt=n(13);n.d(e,"isObject",(function(){return yt.a}));var _t=n(15);n.d(e,"isObjectLike",(function(){return _t.a}));var bt=n(9);n.d(e,"isPlainObject",(function(){return bt.a}));var xt=n(28);n.d(e,"isPrototype",(function(){return xt.a}));var wt=n(87);n.d(e,"isRegExp",(function(){return wt.a}));var Et=n(8);n.d(e,"isString",(function(){return Et.a}));var St=n(4);n.d(e,"isType",(function(){return St.a}));var Ct=n(88);n.d(e,"isUndefined",(function(){return Ct.a}));var At=n(89);n.d(e,"isElement",(function(){return At.a}));var Tt=n(90);n.d(e,"requestAnimationFrame",(function(){return Tt.a}));var kt=n(91);n.d(e,"clearAnimationFrame",(function(){return kt.a}));var Mt=n(92);n.d(e,"augment",(function(){return Mt.a}));var Pt=n(93);n.d(e,"clone",(function(){return Pt.a}));var It=n(94);n.d(e,"debounce",(function(){return It.a}));var Ot=n(95);n.d(e,"memoize",(function(){return Ot.a}));var Rt=n(96);n.d(e,"deepMix",(function(){return Rt.a}));var Lt=n(2);n.d(e,"each",(function(){return Lt.a}));var Dt=n(97);n.d(e,"extend",(function(){return Dt.a}));var Nt=n(98);n.d(e,"indexOf",(function(){return Nt.a}));var Bt=n(99);n.d(e,"isEmpty",(function(){return Bt.a}));var zt=n(29);n.d(e,"isEqual",(function(){return zt.a}));var Ft=n(100);n.d(e,"isEqualWith",(function(){return Ft.a}));var Zt=n(101);n.d(e,"map",(function(){return Zt.a}));var jt=n(102);n.d(e,"mapValues",(function(){return jt.a}));var Ut=n(16);n.d(e,"mix",(function(){return Ut.a})),n.d(e,"assign",(function(){return Ut.a}));var Gt=n(103);n.d(e,"get",(function(){return Gt.a}));var Vt=n(104);n.d(e,"set",(function(){return Vt.a}));var Wt=n(105);n.d(e,"pick",(function(){return Wt.a}));var Ht=n(106);n.d(e,"throttle",(function(){return Ht.a}));var Xt=n(107);n.d(e,"toArray",(function(){return Xt.a}));var Yt=n(10);n.d(e,"toString",(function(){return Yt.a}));var qt=n(108);n.d(e,"uniqueId",(function(){return qt.a}));var Kt=n(109);n.d(e,"noop",(function(){return Kt.a}));var Qt=n(110);n.d(e,"identity",(function(){return Qt.a}));var Jt=n(111);n.d(e,"size",(function(){return Jt.a}));var $t=n(112);n.d(e,"Cache",(function(){return $t.a}))},function(t,e,n){"use strict";var r=n(14),i=n(12);e.a=function(t,e){return void 0===e&&(e=[]),Object(r.a)(t,(function(t){return!Object(i.a)(e,t)}))}},function(t,e,n){"use strict";var r=n(3),i=n(19),o=n(0),a=n(9);e.a=function(t,e){if(!Object(o.a)(t))return null;var n;if(Object(r.a)(e)&&(n=e),Object(a.a)(e)&&(n=function(t){return Object(i.a)(t,e)}),n)for(var s=0;s<t.length;s+=1)if(n(t[s]))return t[s];return null}},function(t,e,n){"use strict";e.a=function(t,e,n){void 0===n&&(n=0);for(var r=n;r<t.length;r++)if(e(t[r],r))return r;return-1}},function(t,e,n){"use strict";var r=n(6),i=n(0);e.a=function(t,e){for(var n=null,o=0;o<t.length;o++){var a=t[o][e];if(!Object(r.a)(a)){n=Object(i.a)(a)?a[0]:a;break}}return n}},function(t,e,n){"use strict";var r=n(0);e.a=function(t){if(!Object(r.a)(t))return[];for(var e=[],n=0;n<t.length;n++)e=e.concat(t[n]);return e}},function(t,e,n){"use strict";var r=n(0),i=function(t,e){if(void 0===e&&(e=[]),Object(r.a)(t))for(var n=0;n<t.length;n+=1)i(t[n],e);else e.push(t);return e};e.a=i},function(t,e,n){"use strict";var r=n(0),i=n(14);e.a=function(t){if(!(t=Object(i.a)(t,(function(t){return!isNaN(t)}))).length)return{min:0,max:0};if(Object(r.a)(t[0])){for(var e=[],n=0;n<t.length;n++)e=e.concat(t[n]);t=e}var o=Math.max.apply(null,t);return{min:Math.min.apply(null,t),max:o}}},function(t,e,n){"use strict";var r=Array.prototype,i=r.splice,o=r.indexOf;e.a=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r++)for(var a=e[r],s=-1;(s=o.call(t,a))>-1;)i.call(t,s,1);return t}},function(t,e,n){"use strict";var r=n(2),i=n(0),o=n(9);e.a=function(t,e,n){if(!Object(i.a)(t)&&!Object(o.a)(t))return t;var a=n;return Object(r.a)(t,(function(t,n){a=e(a,t,n)})),a}},function(t,e,n){"use strict";var r=n(1),i=n(21);e.a=function(t,e){var n=[];if(!Object(r.a)(t))return n;for(var o=-1,a=[],s=t.length;++o<s;){var u=t[o];e(u,o,t)&&(n.push(u),a.push(o))}return Object(i.a)(t,a),n}},function(t,e,n){"use strict";var r=n(0),i=n(8),o=n(3);e.a=function(t,e){var n;if(Object(o.a)(e))n=function(t,n){return e(t)-e(n)};else{var a=[];Object(i.a)(e)?a.push(e):Object(r.a)(e)&&(a=e),n=function(t,e){for(var n=0;n<a.length;n+=1){var r=a[n];if(t[r]>e[r])return 1;if(t[r]<e[r])return-1}return 0}}return t.sort(n),t}},function(t,e,n){"use strict";var r=n(22);e.a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Object(r.a)([].concat.apply([],t))}},function(t,e,n){"use strict";var r=n(2),i=n(0),o=n(6);e.a=function(t,e){var n=[],a={};return t.forEach((function(t){var s=t[e];Object(o.a)(s)||(Object(i.a)(s)||(s=[s]),Object(r.a)(s,(function(t){a[t]||(n.push(t),a[t]=!0)})))})),n}},function(t,e,n){"use strict";e.a=function(t){if(Object(r.a)(t))return t[0]};var r=n(1)},function(t,e,n){"use strict";e.a=function(t){if(Object(r.a)(t))return t[t.length-1]};var r=n(1)},function(t,e,n){"use strict";var r=n(0),i=n(8);e.a=function(t,e){return!(!Object(r.a)(t)&&!Object(i.a)(t))&&t[0]===e}},function(t,e,n){"use strict";var r=n(0),i=n(8);e.a=function(t,e){return!(!Object(r.a)(t)&&!Object(i.a)(t))&&t[t.length-1]===e}},function(t,e,n){"use strict";e.a=function(t,e){for(var n=0;n<t.length;n++)if(!e(t[n],n))return!1;return!0}},function(t,e,n){"use strict";e.a=function(t,e){for(var n=0;n<t.length;n++)if(e(t[n],n))return!0;return!1}},function(t,e,n){"use strict";var r=n(23);e.a=function(t,e){if(!e)return[t];var n=Object(r.a)(t,e),i=[];for(var o in n)i.push(n[o]);return i}},function(t,e,n){"use strict";e.a=function(t,e){return t["_wrap_"+e]}},function(t,e,n){"use strict";e.a=function(t,e){if(t["_wrap_"+e])return t["_wrap_"+e];var n=function(n){t[e](n)};return t["_wrap_"+e]=n,n}},function(t,e,n){"use strict";var r={};e.a=function(t){var e=r[t];if(!e){for(var n=t.toString(16),i=n.length;i<6;i++)n="0"+n;e="#"+n,r[t]=e}return e}},function(t,e,n){"use strict";var r=n(0);e.a=function(t){var e=0,n=0,i=0,o=0;return Object(r.a)(t)?1===t.length?e=n=i=o=t[0]:2===t.length?(e=i=t[0],n=o=t[1]):3===t.length?(e=t[0],n=o=t[1],i=t[2]):(e=t[0],n=t[1],i=t[2],o=t[3]):e=n=i=o=t,{r1:e,r2:n,r3:i,r4:o}}},function(t,e,n){"use strict";e.a=function(t,e,n){return t<e?e:t>n?n:t}},function(t,e,n){"use strict";e.a=function(t,e){var n=e.toString(),r=n.indexOf(".");if(-1===r)return Math.round(t);var i=n.substr(r+1).length;return i>20&&(i=20),parseFloat(t.toFixed(i))}},function(t,e,n){"use strict";var r=n(5);e.a=function(t){return Object(r.a)(t)&&t%1!=0}},function(t,e,n){"use strict";var r=n(5);e.a=function(t){return Object(r.a)(t)&&t%2==0}},function(t,e,n){"use strict";var r=n(5),i=Number.isInteger?Number.isInteger:function(t){return Object(r.a)(t)&&t%1==0};e.a=i},function(t,e,n){"use strict";var r=n(5);e.a=function(t){return Object(r.a)(t)&&t<0}},function(t,e,n){"use strict";e.a=function(t,e,n){return void 0===n&&(n=1e-5),Math.abs(t-e)<n}},function(t,e,n){"use strict";var r=n(5);e.a=function(t){return Object(r.a)(t)&&t%2!=0}},function(t,e,n){"use strict";var r=n(5);e.a=function(t){return Object(r.a)(t)&&t>0}},function(t,e,n){"use strict";var r=n(2),i=n(0),o=n(3);e.a=function(t,e){if(Object(i.a)(t)){var n,a,s=t[0];return n=Object(o.a)(e)?e(t[0]):t[0][e],Object(r.a)(t,(function(t){(a=Object(o.a)(e)?e(t):t[e])>n&&(s=t,n=a)})),s}}},function(t,e,n){"use strict";var r=n(2),i=n(0),o=n(3);e.a=function(t,e){if(Object(i.a)(t)){var n,a,s=t[0];return n=Object(o.a)(e)?e(t[0]):t[0][e],Object(r.a)(t,(function(t){(a=Object(o.a)(e)?e(t):t[e])<n&&(s=t,n=a)})),s}}},function(t,e,n){"use strict";e.a=function(t,e){return(t%e+e)%e}},function(t,e,n){"use strict";var r=180/Math.PI;e.a=function(t){return r*t}},function(t,e,n){"use strict";e.a=parseInt},function(t,e,n){"use strict";var r=Math.PI/180;e.a=function(t){return r*t}},function(t,e,n){"use strict";var r=n(2);e.a=r.a},function(t,e,n){"use strict";var r=n(25);e.a=r.a},function(t,e,n){"use strict";var r=n(12),i=n(26);e.a=function(t,e){return Object(r.a)(Object(i.a)(t),e)}},function(t,e,n){"use strict";var r=n(10);e.a=function(t){return Object(r.a)(t).toLowerCase()}},function(t,e,n){"use strict";var r=n(10);e.a=function(t){var e=Object(r.a)(t);return e.charAt(0).toLowerCase()+e.substring(1)}},function(t,e,n){"use strict";e.a=function(t,e){return t&&e?t.replace(/\\?\{([^{}]+)\}/g,(function(t,n){return"\\"===t.charAt(0)?t.slice(1):void 0===e[n]?"":e[n]})):t}},function(t,e,n){"use strict";var r=n(10);e.a=function(t){return Object(r.a)(t).toUpperCase()}},function(t,e,n){"use strict";var r=n(10);e.a=function(t){var e=Object(r.a)(t);return e.charAt(0).toUpperCase()+e.substring(1)}},function(t,e,n){"use strict";var r=n(4);e.a=function(t){return Object(r.a)(t,"Arguments")}},function(t,e,n){"use strict";var r=n(4);e.a=function(t){return Object(r.a)(t,"Boolean")}},function(t,e,n){"use strict";var r=n(4);e.a=function(t){return Object(r.a)(t,"Date")}},function(t,e,n){"use strict";var r=n(4);e.a=function(t){return Object(r.a)(t,"Error")}},function(t,e,n){"use strict";var r=n(5);e.a=function(t){return Object(r.a)(t)&&isFinite(t)}},function(t,e,n){"use strict";e.a=function(t){return null===t}},function(t,e,n){"use strict";var r=n(4);e.a=function(t){return Object(r.a)(t,"RegExp")}},function(t,e,n){"use strict";e.a=function(t){return void 0===t}},function(t,e,n){"use strict";e.a=function(t){return t instanceof Element||t instanceof HTMLDocument}},function(t,e,n){"use strict";e.a=function(t){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,16)})(t)}},function(t,e,n){"use strict";e.a=function(t){(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout)(t)}},function(t,e,n){"use strict";var r=n(16),i=n(3);e.a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=t[0],o=1;o<t.length;o++){var a=t[o];Object(i.a)(a)&&(a=a.prototype),Object(r.a)(n.prototype,a)}}},function(t,e,n){"use strict";var r=n(0),i=function(t){if("object"!=typeof t||null===t)return t;var e;if(Object(r.a)(t)){e=[];for(var n=0,o=t.length;n<o;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=i(t[n]):e[n]=t[n]}else for(var a in e={},t)"object"==typeof t[a]&&null!=t[a]?e[a]=i(t[a]):e[a]=t[a];return e};e.a=i},function(t,e,n){"use strict";e.a=function(t,e,n){var r;return function(){var i=this,o=arguments,a=function(){r=null,n||t.apply(i,o)},s=n&&!r;clearTimeout(r),r=setTimeout(a,e),s&&t.apply(i,o)}}},function(t,e,n){"use strict";var r=n(3);e.a=function(t,e){if(!Object(r.a)(t))throw new TypeError("Expected a function");var n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=e?e.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var s=t.apply(this,r);return a.set(o,s),s};return n.cache=new Map,n}},function(t,e,n){"use strict";var r=n(0),i=n(9);function o(t,e,n,a){for(var s in n=n||0,a=a||5,e)if(e.hasOwnProperty(s)){var u=e[s];null!==u&&Object(i.a)(u)?(Object(i.a)(t[s])||(t[s]={}),n<a?o(t[s],u,n+1,a):t[s]=e[s]):Object(r.a)(u)?(t[s]=[],t[s]=t[s].concat(u)):void 0!==u&&(t[s]=u)}}e.a=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r+=1)o(t,e[r]);return t}},function(t,e,n){"use strict";var r=n(16),i=n(3);e.a=function(t,e,n,o){Object(i.a)(e)||(n=e,e=t,t=function(){});var a=Object.create?function(t,e){return Object.create(t,{constructor:{value:e}})}:function(t,e){function n(){}n.prototype=t;var r=new n;return r.constructor=e,r},s=a(e.prototype,t);return t.prototype=Object(r.a)(s,t.prototype),t.superclass=a(e.prototype,e),Object(r.a)(s,n),Object(r.a)(t,o),t}},function(t,e,n){"use strict";var r=n(1);e.a=function(t,e){if(!Object(r.a)(t))return-1;var n=Array.prototype.indexOf;if(n)return n.call(t,e);for(var i=-1,o=0;o<t.length;o++)if(t[o]===e){i=o;break}return i}},function(t,e,n){"use strict";var r=n(6),i=n(1),o=n(27),a=n(28),s=Object.prototype.hasOwnProperty;e.a=function(t){if(Object(r.a)(t))return!0;if(Object(i.a)(t))return!t.length;var e=Object(o.a)(t);if("Map"===e||"Set"===e)return!t.size;if(Object(a.a)(t))return!Object.keys(t).length;for(var n in t)if(s.call(t,n))return!1;return!0}},function(t,e,n){"use strict";var r=n(3),i=n(29);e.a=function(t,e,n){return Object(r.a)(n)?!!n(t,e):Object(i.a)(t,e)}},function(t,e,n){"use strict";var r=n(2),i=n(1);e.a=function(t,e){if(!Object(i.a)(t))return t;var n=[];return Object(r.a)(t,(function(t,r){n.push(e(t,r))})),n}},function(t,e,n){"use strict";var r=n(6),i=n(13),o=function(t){return t};e.a=function(t,e){void 0===e&&(e=o);var n={};return Object(i.a)(t)&&!Object(r.a)(t)&&Object.keys(t).forEach((function(r){n[r]=e(t[r],r)})),n}},function(t,e,n){"use strict";var r=n(8);e.a=function(t,e,n){for(var i=0,o=Object(r.a)(e)?e.split("."):e;t&&i<o.length;)t=t[o[i++]];return void 0===t||i<o.length?n:t}},function(t,e,n){"use strict";var r=n(13),i=n(8),o=n(5);e.a=function(t,e,n){var a=t,s=Object(i.a)(e)?e.split("."):e;return s.forEach((function(t,e){e<s.length-1?(Object(r.a)(a[t])||(a[t]=Object(o.a)(s[e+1])?[]:{}),a=a[t]):a[t]=n})),t}},function(t,e,n){"use strict";var r=n(2),i=n(9),o=Object.prototype.hasOwnProperty;e.a=function(t,e){if(null===t||!Object(i.a)(t))return{};var n={};return Object(r.a)(e,(function(e){o.call(t,e)&&(n[e]=t[e])})),n}},function(t,e,n){"use strict";e.a=function(t,e,n){var r,i,o,a,s=0;n||(n={});var u=function(){s=!1===n.leading?0:Date.now(),r=null,a=t.apply(i,o),r||(i=o=null)},l=function(){var l=Date.now();s||!1!==n.leading||(s=l);var c=e-(l-s);return i=this,o=arguments,c<=0||c>e?(r&&(clearTimeout(r),r=null),s=l,a=t.apply(i,o),r||(i=o=null)):r||!1===n.trailing||(r=setTimeout(u,c)),a};return l.cancel=function(){clearTimeout(r),s=0,r=i=o=null},l}},function(t,e,n){"use strict";var r=n(1);e.a=function(t){return Object(r.a)(t)?Array.prototype.slice.call(t):[]}},function(t,e,n){"use strict";var r={};e.a=function(t){return r[t=t||"g"]?r[t]+=1:r[t]=1,t+r[t]}},function(t,e,n){"use strict";e.a=function(){}},function(t,e,n){"use strict";e.a=function(t){return t}},function(t,e,n){"use strict";e.a=function(t){return Object(r.a)(t)?0:Object(i.a)(t)?t.length:Object.keys(t).length};var r=n(6),i=n(1)},function(t,e,n){"use strict";var r=function(){function t(){this.map={}}return t.prototype.has=function(t){return void 0!==this.map[t]},t.prototype.get=function(t,e){var n=this.map[t];return void 0===n?e:n},t.prototype.set=function(t,e){this.map[t]=e},t.prototype.clear=function(){this.map={}},t.prototype.delete=function(t){delete this.map[t]},t.prototype.size=function(){return Object.keys(this.map).length},t}();e.a=r},function(t,e){function n(t,e,n,r){void 0===r&&(r=[]);var i=this;i.w=t||0,i.h=e||0,i.y=n||0,i.x=0,i.c=r||[],i.cs=r.length,i.prelim=0,i.mod=0,i.shift=0,i.change=0,i.tl=null,i.tr=null,i.el=null,i.er=null,i.msel=0,i.mser=0}function r(t,e,n){n?t.y+=e:t.x+=e,t.children.forEach((function(t){r(t,e,n)}))}function i(t,e){var n=e?t.y:t.x;return t.children.forEach((function(t){n=Math.min(i(t,e),n)})),n}function o(t,e){r(t,-i(t,e),e)}function a(t,e,n){n?e.y=t.x:e.x=t.x,t.c.forEach((function(t,r){a(t,e.children[r],n)}))}function s(t,e,n){void 0===n&&(n=0),e?(t.x=n,n+=t.width):(t.y=n,n+=t.height),t.children.forEach((function(t){s(t,e,n)}))}n.fromNode=function(t,e){if(!t)return null;var r=[];return t.children.forEach((function(t){r.push(n.fromNode(t,e))})),e?new n(t.height,t.width,t.x,r):new n(t.width,t.height,t.y,r)},t.exports=function(t,e){void 0===e&&(e={});var r=e.isHorizontal;function i(t){0===t.cs?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function u(t,e,n){for(var r=t.c[e-1],i=r.mod,o=t.c[e],a=o.mod;null!==r&&null!==o;){f(r)>n.low&&(n=n.nxt);var s=i+r.prelim+r.w-(a+o.prelim);s>0&&(a+=s,l(t,e,n.index,s));var u=f(r),p=f(o);u<=p&&null!==(r=h(r))&&(i+=r.mod),u>=p&&null!==(o=c(o))&&(a+=o.mod)}!r&&o?function(t,e,n,r){var i=t.c[0].el;i.tl=n;var o=r-n.mod-t.c[0].msel;i.mod+=o,i.prelim-=o,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}(t,e,o,a):r&&!o&&function(t,e,n,r){var i=t.c[e].er;i.tr=n;var o=r-n.mod-t.c[e].mser;i.mod+=o,i.prelim-=o,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}(t,e,r,i)}function l(t,e,n,r){t.c[e].mod+=r,t.c[e].msel+=r,t.c[e].mser+=r,function(t,e,n,r){if(n!==e-1){var i=e-n;t.c[n+1].shift+=r/i,t.c[e].shift-=r/i,t.c[e].change-=r-r/i}}(t,e,n,r)}function c(t){return 0===t.cs?t.tl:t.c[0]}function h(t){return 0===t.cs?t.tr:t.c[t.cs-1]}function f(t){return t.y+t.h}function p(t,e,n){for(;null!==n&&t>=n.low;)n=n.nxt;return{low:t,index:e,nxt:n}}s(t,r);var d=n.fromNode(t,r);return function t(e){if(0!==e.cs){t(e.c[0]);for(var n=p(f(e.c[0].el),0,null),r=1;r<e.cs;++r){t(e.c[r]);var o=f(e.c[r].er);u(e,r,n),n=p(o,r,n)}!function(t){t.prelim=(t.c[0].prelim+t.c[0].mod+t.c[t.cs-1].mod+t.c[t.cs-1].prelim+t.c[t.cs-1].w)/2-t.w/2}(e),i(e)}else i(e)}(d),function t(e,n){n+=e.mod,e.x=e.prelim+n,function(t){for(var e=0,n=0,r=0;r<t.cs;r++)n+=(e+=t.c[r].shift)+t.c[r].change,t.c[r].mod+=n}(e);for(var r=0;r<e.cs;r++)t(e.c[r],n)}(d,0),a(d,t,r),o(t,r),t}},function(t,e,n){var r=n(11),i=n(115),o=n(17),a=n(7),s=function(t){var e,n;function r(){return t.apply(this,arguments)||this}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,r.prototype.execute=function(){var t=this;return t.rootNode.width=0,o(t.rootNode,t.options,i)},r}(r),u={};t.exports=function(t,e){return e=a.assign({},u,e),new s(t,e).execute()}},function(t,e,n){var r=n(7);function i(t,e){void 0===t&&(t=0),void 0===e&&(e=[]);var n=this;n.x=n.y=0,n.leftChild=n.rightChild=null,n.height=0,n.children=e}var o={isHorizontal:!0,nodeSep:20,nodeSize:20,rankSep:200,subTreeSep:10};function a(t,e,n){n?(e.x=t.x,e.y=t.y):(e.x=t.y,e.y=t.x),t.children.forEach((function(t,r){a(t,e.children[r],n)}))}t.exports=function(t,e){void 0===e&&(e={}),e=r.assign({},o,e);var n,s=0,u=function t(e){if(!e)return null;e.width=0,e.depth&&e.depth>s&&(s=e.depth);var n=e.children,r=n.length,o=new i(e.height,[]);return n.forEach((function(e,n){var i=t(e);o.children.push(i),0===n&&(o.leftChild=i),n===r-1&&(o.rightChild=i)})),o.originNode=e,o.isLeaf=e.isLeaf(),o}(t);return function t(e){if(e.isLeaf||0===e.children.length)e.drawingDepth=s;else{var n=e.children.map((function(e){return t(e)})),r=Math.min.apply(null,n);e.drawingDepth=r-1}return e.drawingDepth}(u),function t(r){r.x=r.drawingDepth*e.rankSep,r.isLeaf?(r.y=0,n&&(r.y=n.y+n.height+e.nodeSep,r.originNode.parent!==n.originNode.parent&&(r.y+=e.subTreeSep)),n=r):(r.children.forEach((function(e){t(e)})),r.y=(r.leftChild.y+r.rightChild.y)/2)}(u),a(u,t,e.isHorizontal),t}},function(t,e,n){var r=n(11),i=n(117),o=n(30),a=n(7),s=["LR","RL","H"],u=s[0],l=function(t){var e,n;function r(){return t.apply(this,arguments)||this}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,r.prototype.execute=function(){var t=this.options,e=this.rootNode;t.isHorizontal=!0;var n=t.indent,r=void 0===n?20:n,a=t.dropCap,l=void 0===a||a,c=t.direction||u;if(c&&-1===s.indexOf(c))throw new TypeError("Invalid direction: "+c);if(c===s[0])i(e,r,l);else if(c===s[1])i(e,r,l),e.right2left();else if(c===s[2]){var h=o(e,t),f=h.left,p=h.right;i(f,r,l),f.right2left(),i(p,r,l);var d=f.getBoundingBox();p.translate(d.width,0),e.x=p.x-e.width/2}return e},r}(r),c={};t.exports=function(t,e){return e=a.assign({},c,e),new l(t,e).execute()}},function(t,e){t.exports=function(t,e,n){var r=null;t.eachNode((function(t){!function(t,e,n,r){var i="function"==typeof n?n(t):n*t.depth;if(!r)try{if(t.id===t.parent.children[0].id)return t.x+=i,void(t.y=e?e.y:0)}catch(t){}t.x+=i,t.y=e?e.y+e.height:0}(t,r,e,n),r=t}))}},function(t,e,n){var r=n(11),i=n(119),o=n(17),a=n(7),s=function(t){var e,n;function r(){return t.apply(this,arguments)||this}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,r.prototype.execute=function(){return o(this.rootNode,this.options,i)},r}(r),u={};t.exports=function(t,e){return e=a.assign({},u,e),new s(t,e).execute()}},function(t,e,n){var r=n(7);function i(t,e){var n=0;return t.children.length?t.children.forEach((function(t){n+=i(t,e)})):n=t.height,t._subTreeSep=e.getSubTreeSep(t.data),t.totalHeight=Math.max(t.height,n)+2*t._subTreeSep,t.totalHeight}function o(t){var e=t.children,n=e.length;if(n){e.forEach((function(t){o(t)}));var r=e[0],i=e[n-1],a=i.y-r.y+i.height,s=0;if(e.forEach((function(t){s+=t.totalHeight})),a>t.height)t.y=r.y+a/2-t.height/2;else if(1!==e.length||t.height>s){var u=t.y+(t.height-a)/2-r.y;e.forEach((function(t){t.translate(0,u)}))}else t.y=(r.y+r.height/2+i.y+i.height/2)/2-t.height/2}}var a={getSubTreeSep:function(){return 0}};t.exports=function(t,e){void 0===e&&(e={}),e=r.assign({},a,e),t.parent={x:0,width:0,height:0,y:0},t.BFTraverse((function(t){t.x=t.parent.x+t.parent.width})),t.parent=null,i(t,e),t.startY=0,t.y=t.totalHeight/2-t.height/2,t.eachNode((function(t){var e=t.children,n=e.length;if(n){var r=e[0];if(r.startY=t.startY+t._subTreeSep,1===n)r.y=t.y+t.height/2-r.height/2;else{r.y=r.startY+r.totalHeight/2-r.height/2;for(var i=1;i<n;i++){var o=e[i];o.startY=e[i-1].startY+e[i-1].totalHeight,o.y=o.startY+o.totalHeight/2-o.height/2}}}})),o(t)}}])},t.exports=e()},5461:(t,e,n)=>{"use strict";n.r(e),n.d(e,{$XMLHttpRequest:()=>_e,$location:()=>be,$window:()=>ye,AttributeType:()=>mu,BKDRHash:()=>I,BaseLayer:()=>Yd,BasePostProcessingPass:()=>cs,BlendType:()=>du,CameraUniform:()=>wu,CityBuildingLayer:()=>Vg,Control:()=>Tu,CoordinateSystem:()=>Ei,CoordinateUniform:()=>Vi,DOM:()=>r,Earth:()=>up,EarthLayer:()=>am,FrequencyController:()=>dn,GaodeMap:()=>Ac,GaodeMapV2:()=>zc,HeatmapLayer:()=>$g,ImageLayer:()=>ev,ImageTileLayer:()=>cv,InteractionEvent:()=>zi,LRUCache:()=>hn,Layers:()=>ku,LineLayer:()=>wv,Logo:()=>Mu,Map:()=>od,MapServiceEvent:()=>xu,Mapbox:()=>Ed,Marker:()=>Lu,MarkerLayer:()=>Bu,PassType:()=>Ra,PointLayer:()=>Xv,PolygonLayer:()=>Qv,Popup:()=>Zu,PositionType:()=>bu,RasterLayer:()=>tm,Satistics:()=>i,Scale:()=>Pu,ScaleTypes:()=>gu,Scene:()=>Nl,SceneEventList:()=>Eu,Source:()=>zr,StyleScaleType:()=>vu,TYPES:()=>Ur,Version:()=>Fl,WindLayer:()=>km,Zoom:()=>Iu,aProjectFlat:()=>rn,anchorTranslate:()=>xn,anchorType:()=>pn,applyAnchorClass:()=>wn,bBoxToBounds:()=>cn,bindAll:()=>fn,boundsContains:()=>ln,container:()=>au,createLayerContainer:()=>lu,createSceneContainer:()=>uu,decodePickingColor:()=>yn,dispatchMapCameraParams:()=>Jt,dispatchMouseDown:()=>he,dispatchMouseMove:()=>fe,dispatchMouseUp:()=>pe,dispatchPointerDown:()=>se,dispatchPointerMove:()=>ue,dispatchPointerUp:()=>le,dispatchTouchEnd:()=>Qt,dispatchTouchMove:()=>Kt,dispatchTouchStart:()=>qt,djb2hash:()=>O,encodePickingColor:()=>_n,extent:()=>Ye,generateColorRamp:()=>bn,getArrayBuffer:()=>We,getImage:()=>He,getJSON:()=>Ve,gl:()=>qi,isColor:()=>vn,isMini:()=>ve,isMiniAli:()=>de,isWeChatMiniProgram:()=>ge,latitude:()=>en,lazyInject:()=>iu,lazyMultiInject:()=>ou,lngLatToMeters:()=>Je,lnglatDistance:()=>an,longitude:()=>tn,metersToLngLat:()=>$e,miniWindow:()=>me,packCircleVertex:()=>_u,padBounds:()=>un,project:()=>sn,rgb2arr:()=>mn,tranfrormCoord:()=>Ke,unProjectFlat:()=>on,validateLngLat:()=>nn,version:()=>iw});var r={};n.r(r),n.d(r,{DPR:()=>Be,addClass:()=>Ae,create:()=>Se,empty:()=>Ie,getClass:()=>Pe,getContainer:()=>xe,getViewPortScale:()=>Ne,hasClass:()=>ke,printCanvas:()=>De,remove:()=>Ce,removeClass:()=>Te,setClass:()=>Me,setTransform:()=>Re,splitWords:()=>Ee,triggerResize:()=>Le,trim:()=>we});var i={};n.r(i),n.d(i,{getColumn:()=>Mn,getSatByColumn:()=>Pn,max:()=>En,mean:()=>An,min:()=>Sn,mode:()=>Tn,statMap:()=>kn,sum:()=>Cn});var o={},a={},s=function(t){return a[t]},u=function(t,e){a[t]=e},l=function(t,e){o[t]=e},c={},h={};function f(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function p(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var r in t)r in e||n.push(e[r]=r)})),n}function d(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}var g=function(t){var e=new RegExp('[",\n\r]'),n=t.charCodeAt(0);function r(t,e){var r,i=[],o=t.length,a=0,s=0,u=o<=0,l=!1;function f(){if(u)return h;if(l)return l=!1,c;var e,r,i=a;if(34===t.charCodeAt(i)){for(;a++<o&&34!==t.charCodeAt(a)||34===t.charCodeAt(++a););return(e=a)>=o?u=!0:10===(r=t.charCodeAt(a++))?l=!0:13===r&&(l=!0,10===t.charCodeAt(a)&&++a),t.slice(i+1,e-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=t.charCodeAt(e=a++)))l=!0;else if(13===r)l=!0,10===t.charCodeAt(a)&&++a;else if(r!==n)continue;return t.slice(i,e)}return u=!0,t.slice(i,o)}for(10===t.charCodeAt(o-1)&&--o,13===t.charCodeAt(o-1)&&--o;(r=f())!==h;){for(var p=[];r!==c&&r!==h;)p.push(r),r=f();e&&null==(p=e(p,s++))||i.push(p)}return i}function i(e,n){return e.map((function(e){return n.map((function(t){return a(e[t])})).join(t)}))}function o(e){return e.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?function(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":function(t){return t<0?"-"+d(-t,6):t>9999?"+"+d(t,6):d(t,4)}(t.getUTCFullYear())+"-"+d(t.getUTCMonth()+1,2)+"-"+d(t.getUTCDate(),2)+(i?"T"+d(e,2)+":"+d(n,2)+":"+d(r,2)+"."+d(i,3)+"Z":r?"T"+d(e,2)+":"+d(n,2)+":"+d(r,2)+"Z":n||e?"T"+d(e,2)+":"+d(n,2)+"Z":"")}(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,i,o=r(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=f(t);return function(r,i){return e(n(r),i,t)}}(t,e):f(t)}));return o.columns=i||[],o},parseRows:r,format:function(e,n){return null==n&&(n=p(e)),[n.map(a).join(t)].concat(i(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=p(t)),i(t,e).join("\n")},formatRows:function(t){return t.map(o).join("\n")},formatRow:o,formatValue:a}}(","),v=g.parse,m=(g.parseRows,g.format,g.formatBody,g.formatRows,g.formatRow,g.formatValue,n(4942)),y=n(2982),_=n(8163),b=n.n(_);function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function E(t,e){var n=e.x,r=e.y,i=e.x1,o=e.y1,a=e.coordinates,s=[];return t.forEach((function(t,e){var u=[];if(n&&r&&(u=[parseFloat(t[n]),parseFloat(t[r])]),n&&r&&i&&o&&(u=[[parseFloat(t[n]),parseFloat(t[r])],[parseFloat(t[i]),parseFloat(t[o])]]),a){var l="Polygon";Array.isArray(a[0])||(l="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(l="LineString");var c={type:l,coordinates:(0,y.Z)(t[a])};b()(c,!0),u=c.coordinates}var h=w(w({},t),{},{_id:e,coordinates:u});s.push(h)})),{dataArray:s}}var S=6371008.8,C={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*S,kilometers:6371.0088,kilometres:6371.0088,meters:S,metres:S,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:S/1852,radians:1,yards:6967335.223679999};function A(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function T(t){return t%360*Math.PI/180}function k(t,e){!function(t,e){var n,r,i,o,a,s,u,l,c,h,f=0,p="FeatureCollection"===t.type,d="Feature"===t.type,g=p?t.features.length:1;for(n=0;n<g;n++){for(s=p?t.features[n].geometry:d?t.geometry:t,l=p?t.features[n].properties:d?t.properties:{},c=p?t.features[n].bbox:d?t.bbox:void 0,h=p?t.features[n].id:d?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,f,l,c,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],f,l,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,f,l,c,h))return!1;f++}}(t,(function(t,n,r,i,o){var a,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==e(A(t,r,{bbox:i,id:o}),n,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<t.coordinates.length;u++){var l=t.coordinates[u];if(!1===e(A({type:a,coordinates:l},r),n,u))return!1}}))}function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function P(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function I(t){var e=0;t+="x";for(var n=Math.floor(65745979961613.07),r=0;r<t.length;r++)e>n&&(e=Math.floor(e/137)),e=131*e+t.charCodeAt(r);return e}function O(t){for(var e=5381,n=(t=t.toString()).length;n;)e=33*e^t.charCodeAt(--n);return e>>>0}var R=n(885),L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function D(t){this.message=t}function N(t){for(var e,n,r,i,o="",a=0,s=(t=String(t)).length%3;a<t.length;){if((n=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255||(i=t.charCodeAt(a++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");o+=L.charAt((e=n<<16|r<<8|i)>>18&63)+L.charAt(e>>12&63)+L.charAt(e>>6&63)+L.charAt(63&e)}return s?o.slice(0,s-3)+"===".substring(s):o}D.prototype=new Error,D.prototype.name="InvalidCharacterError";var B,z=n(5671),F=n(3144),Z=function(){function t(e,n){(0,z.Z)(this,t),this.buffers=e,this.type=n}return(0,F.Z)(t,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,e,n){throw new Error("not implemented")}}]),t}();B="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,n){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window;const j="undefined"!=typeof my&&my&&"function"==typeof my.showToast?my.getSystemInfoSync().pixelRatio:B.devicePixelRatio;var U=n(136),G=n(2963),V=n(1120),W=(0,F.Z)((function t(e,n){(0,z.Z)(this,t),(0,m.Z)(this,"cancelBubble",void 0),(0,m.Z)(this,"cancelable",void 0),(0,m.Z)(this,"target",void 0),(0,m.Z)(this,"currentTarget",void 0),(0,m.Z)(this,"preventDefault",void 0),(0,m.Z)(this,"stopPropagation",void 0),(0,m.Z)(this,"type",void 0),(0,m.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),H=n(7326);function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Y=new WeakMap,q=function(){function t(){(0,z.Z)(this,t),Y.set(this,{})}return(0,F.Z)(t,[{key:"addEventListener",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Y.get(this);r||(r={}),r[t]||(r[t]=[]),r[t].push(e),Y.set(this,r),n.capture,n.once,n.passive}},{key:"removeEventListener",value:function(t,e){var n=Y.get(this);if(n){var r=n[t];if(r&&r.length>0)for(var i=r.length;i--;i>0)if(r[i]===e){r.splice(i,1);break}}}},{key:"dispatchEvent",value:function(t){var e=Y.get(this)[t.type];if(e){var n,r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(e);try{for(r.s();!(n=r.n()).done;)(0,n.value)(t)}catch(t){r.e(t)}finally{r.f()}}}}]),t}();var K=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;return(0,z.Z)(this,i),t=r.call(this),(0,m.Z)((0,H.Z)(t),"childNodes",void 0),t.childNodes=[],t}return(0,F.Z)(i,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),i}(q);var Q,J,$,tt,et=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;return(0,z.Z)(this,i),t=r.call(this),(0,m.Z)((0,H.Z)(t),"className",void 0),(0,m.Z)((0,H.Z)(t),"children",void 0),t.className="",t.children=[],t}return(0,F.Z)(i,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),i}(K);if("undefined"!=typeof my&&my&&"function"==typeof my.showToast){var nt=my.getSystemInfoSync();Q=nt.screenWidth,J=nt.screenHeight,$=nt.windowWidth,tt=nt.windowHeight}else{var rt=B.innerWidth,it=B.innerHeight;Q=rt,J=it,$=rt,tt=it}var ot={width:Q,height:J,availWidth:$,availHeight:tt,availLeft:0,availTop:0},at=ot.availWidth,st=ot.availHeight,ut={style:[]};function lt(t,e){var n,r;"parentNode"in t||(n=0===e?function(){return null}:1===e?function(){return ut}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:n})),"parentElement"in t||(r=0===e?function(){return null}:1===e?function(){return ut}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:r}))}function ct(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:at+"px",height:st+"px",margin:"0px",padding:"0px"})}function ht(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=at,t.clientHeight=st),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function ft(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=at,t.offsetHeight=st)}function pt(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=at,t.scrollHeight=st)}function dt(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function gt(){}var vt=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1?arguments[1]:void 0;return(0,z.Z)(this,i),t=r.call(this),(0,m.Z)((0,H.Z)(t),"className",void 0),(0,m.Z)((0,H.Z)(t),"children",void 0),(0,m.Z)((0,H.Z)(t),"focus",void 0),(0,m.Z)((0,H.Z)(t),"blur",void 0),(0,m.Z)((0,H.Z)(t),"insertBefore",void 0),(0,m.Z)((0,H.Z)(t),"appendChild",void 0),(0,m.Z)((0,H.Z)(t),"removeChild",void 0),(0,m.Z)((0,H.Z)(t),"remove",void 0),(0,m.Z)((0,H.Z)(t),"innerHTML",void 0),(0,m.Z)((0,H.Z)(t),"tagName",void 0),t.className="",t.children=[],t.focus=gt,t.blur=gt,t.insertBefore=gt,t.appendChild=gt,t.removeChild=gt,t.remove=gt,t.innerHTML="",t.tagName=e.toUpperCase(),lt((0,H.Z)(t),n),ct((0,H.Z)(t)),dt((0,H.Z)(t)),ht((0,H.Z)(t)),ft((0,H.Z)(t)),pt((0,H.Z)(t)),t}return(0,F.Z)(i)}(et);var mt=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){return(0,z.Z)(this,i),r.call(this,t)}return(0,F.Z)(i,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),i}(vt);var yt=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.call(this,"video")}return(0,F.Z)(i)}(mt),_t={};function bt(){return _t}var xt=(0,F.Z)((function t(){(0,z.Z)(this,t);var e=bt(),n=e.createImage&&e.createImage()||{};return"tagName"in n||(n.tagName="IMG",n.__proto__=t.prototype),lt(n),dt(n),Object.assign(n,{addEventListener:function(t,e){n["on".concat(t)]=e.bind(n)},removeEventListener:function(t){n["on".concat(t)]=null}}),n})),wt={href:"",protocol:"",host:""};function Et(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,V.Z)(t);if(e){var i=(0,V.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,G.Z)(this,n)}}var St=function(t){(0,U.Z)(n,t);var e=Et(n);function n(){return(0,z.Z)(this,n),e.call(this,"body",0)}return(0,F.Z)(n,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,n){}},{key:"dispatchEvent",value:function(t){}}]),n}(vt),Ct=function(t){(0,U.Z)(n,t);var e=Et(n);function n(){return(0,z.Z)(this,n),e.call(this,"html",0)}return(0,F.Z)(n,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),n}(vt),At={},Tt={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:wt,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new xt:"video"===t?new yt:new vt(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,n){At[t]||(At[t]=[]),At[t].push(e)},removeEventListener:function(t,e){var n=At[t];if(n&&n.length>0)for(var r=n.length;r--;r>0)if(n[r]===e){n.splice(r,1);break}},dispatchEvent:function(t){var e=t.type,n=At[e];if(n)for(var r=0;r<n.length;r++)n[r](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new W(t)}};Tt.documentElement=new Ct,Tt.head=new vt("head"),Tt.body=new St;var kt,Mt,Pt,It,Ot=Object,Rt=n(1002),Lt=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"_w",void 0),(0,m.Z)(this,"_h",void 0),(0,m.Z)(this,"_data",void 0);var e=arguments.length;if(2===e){if("number"==typeof arguments[0]&&"number"==typeof arguments[1])return this._w=arguments[0],this._h=arguments[1],void(this._data=new Uint8ClampedArray(this._w*this._h*4))}else 3===e&&"object"===(0,Rt.Z)(arguments[0])&&"number"==typeof arguments[1]&&"number"==typeof arguments[2]&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,F.Z)(t,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),t}();if("undefined"!=typeof my&&my&&"function"==typeof my.showToast){var Dt=my.getSystemInfoSync();kt=Dt.system,Mt=Dt.platform,Pt=Dt.language}else{var Nt={versions:(It=B.navigator.userAgent,{trident:It.indexOf("Trident")>-1,presto:It.indexOf("Presto")>-1,webKit:It.indexOf("AppleWebKit")>-1,gecko:It.indexOf("Gecko")>-1&&-1===It.indexOf("KHTML"),mobile:!!It.match(/AppleWebKit.*Mobile.*/),ios:!!It.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:It.indexOf("Android")>-1||It.indexOf("Linux")>-1,iPhone:It.indexOf("iPhone")>-1,iPad:It.indexOf("iPad")>-1,webApp:-1===It.indexOf("Safari"),weixin:It.indexOf("MicroMessenger")>-1,qq:" qq"===It.match(/\sQQ/i)}),language:(B.navigator.browserLanguage||B.navigator.language).toLowerCase()};Nt.versions.android?Mt="android":Nt.versions.trident?Mt="IE":Nt.versions.presto?Mt="Opera":Nt.versions.webKit?Mt="webKit":Nt.versions.gecko?Mt="Firefox":Nt.versions.mobile?Mt="mobile":Nt.versions.ios?Mt="ios":Nt.versions.iPhone?Mt="iPhone":Nt.versions.iPad?Mt="ipad":Nt.versions.webApp?Mt="webApp":Nt.versions.weixin?Mt="weixin":Nt.versions.qq&&(Mt="qq"),kt=B.navigator.userAgent,Pt=Nt.language}var Bt=-1!==kt.toLowerCase().indexOf("android")?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",zt="Mozilla/5.0 (".concat(Bt,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Pt),Ft={platform:Mt,language:Pt,appVersion:"5.0 (".concat(Bt,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:zt},Zt=0,jt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";(0,z.Z)(this,t),(0,m.Z)(this,"href",void 0),0!=e.indexOf("http://")&&0!=e.indexOf("https://")?this.href=n+e:this.href=e}return(0,F.Z)(t,null,[{key:"createObjectURL",value:function(t){var e=t.buffers[0],n=t.type,r=function(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=0;i<r;i++)e+=String.fromCharCode(n[i]);return N(e)}(e);return"data:".concat(n,";base64, ")+r}}]),t}();var Ut=new Map,Gt=new Map,Vt=new Map,Wt=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;return(0,z.Z)(this,i),t=r.call(this),(0,m.Z)((0,H.Z)(t),"onabort",void 0),(0,m.Z)((0,H.Z)(t),"onerror",void 0),(0,m.Z)((0,H.Z)(t),"onload",void 0),(0,m.Z)((0,H.Z)(t),"onloadstart",void 0),(0,m.Z)((0,H.Z)(t),"onprogress",void 0),(0,m.Z)((0,H.Z)(t),"ontimeout",void 0),(0,m.Z)((0,H.Z)(t),"onloadend",void 0),(0,m.Z)((0,H.Z)(t),"onreadystatechange",void 0),(0,m.Z)((0,H.Z)(t),"readyState",void 0),(0,m.Z)((0,H.Z)(t),"response",void 0),(0,m.Z)((0,H.Z)(t),"responseText",void 0),(0,m.Z)((0,H.Z)(t),"_responseType",void 0),(0,m.Z)((0,H.Z)(t),"responseXML",void 0),(0,m.Z)((0,H.Z)(t),"status",void 0),(0,m.Z)((0,H.Z)(t),"statusText",void 0),(0,m.Z)((0,H.Z)(t),"upload",void 0),(0,m.Z)((0,H.Z)(t),"withCredentials",void 0),(0,m.Z)((0,H.Z)(t),"timeout",void 0),(0,m.Z)((0,H.Z)(t),"_url",void 0),(0,m.Z)((0,H.Z)(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Ut.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return(0,F.Z)(i,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=Vt.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Gt.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\n")}},{key:"getResponseHeader",value:function(t){return Gt.get("responseHeader")[t]}},{key:"open",value:function(t,e,n){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var n=Ut.get("requestHeader");n[t]=e,Ut.set("requestHeader",n)}},{key:"addEventListener",value:function(t,e){var n=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||n,e.call(n,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),i}(q);(0,m.Z)(Wt,"UNSEND",void 0),(0,m.Z)(Wt,"OPENED",void 0),(0,m.Z)(Wt,"HEADERS_RECEIVED",void 0),(0,m.Z)(Wt,"LOADING",void 0),(0,m.Z)(Wt,"DONE",void 0),Wt.UNSEND=0,Wt.OPENED=1,Wt.HEADERS_RECEIVED=2,Wt.LOADING=3,Wt.DONE=4;var Ht=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){var e;return(0,z.Z)(this,i),e=r.call(this,t),(0,m.Z)((0,H.Z)(e),"touches",void 0),(0,m.Z)((0,H.Z)(e),"targetTouches",void 0),(0,m.Z)((0,H.Z)(e),"changedTouches",void 0),e.touches=[],e.targetTouches=[],e.changedTouches=[],e.target=bt(),e.currentTarget=bt(),e}return(0,F.Z)(i)}(W);function Xt(t){var e=t||{},n=e.x,r=void 0===n?0:n,i=e.y,o=void 0===i?0:i,a=e.clientX,s=void 0===a?0:a,u=e.clientY,l=void 0===u?0:u;-1!==Object.keys(t).indexOf("x")?(t.pageX=t.clientX=r,t.pageY=t.clientY=o):(t.x=s,t.y=l)}function Yt(t){return function(e){var n=new Ht(t);n.changedTouches=e.changedTouches,n.touches=e.touches,n.targetTouches=Array.prototype.slice.call(e.touches),n.timeStamp=e.timeStamp,n.changedTouches.forEach((function(t){return Xt(t)})),n.touches.forEach((function(t){return Xt(t)})),n.targetTouches.forEach((function(t){return Xt(t)})),Tt.dispatchEvent(n)}}var qt=Yt("touchstart"),Kt=Yt("touchmove"),Qt=Yt("touchend"),Jt=("mapCameaParams",function(t){t.type="mapCameaParams",Tt.dispatchEvent(t)});var $t=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){var e;return(0,z.Z)(this,i),e=r.call(this,t),(0,m.Z)((0,H.Z)(e),"buttons",void 0),(0,m.Z)((0,H.Z)(e),"which",void 0),(0,m.Z)((0,H.Z)(e),"pointerId",void 0),(0,m.Z)((0,H.Z)(e),"bubbles",void 0),(0,m.Z)((0,H.Z)(e),"button",void 0),(0,m.Z)((0,H.Z)(e),"width",void 0),(0,m.Z)((0,H.Z)(e),"height",void 0),(0,m.Z)((0,H.Z)(e),"pressure",void 0),(0,m.Z)((0,H.Z)(e),"isPrimary",void 0),(0,m.Z)((0,H.Z)(e),"pointerType",void 0),(0,m.Z)((0,H.Z)(e),"altKey",void 0),(0,m.Z)((0,H.Z)(e),"ctrlKey",void 0),(0,m.Z)((0,H.Z)(e),"metaKey",void 0),(0,m.Z)((0,H.Z)(e),"shiftKey",void 0),e.target=bt(),e.currentTarget=bt(),e}return(0,F.Z)(i)}(W),te=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],ee=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0];function ne(t,e,n){for(var r=new $t(t),i=0;i<te.length;i++){var o=te[i];r[o]=e[o]||ee[i]}return r.type=t,r.target=bt(),r.currentTarget=bt(),r.buttons=function(t){var e=0;return"touchstart"!==t&&"touchmove"!==t&&"pointerdown"!==t&&"pointermove"!==t||(e=1),e}(t),r.which=r.buttons,r.pointerId=(e.identifier||0)+2,r.bubbles=!0,r.cancelable=!0,r.button=0,r.width=2*(e.radiusX||.5),r.height=2*(e.radiusY||.5),r.pressure=e.force||.5,r.isPrimary=function(t){return re===t.identifier}(e),r.pointerType="touch",r.altKey=n.altKey,r.ctrlKey=n.ctrlKey,r.metaKey=n.metaKey,r.shiftKey=n.shiftKey,n.preventDefault&&(r.preventDefault=function(){n.preventDefault()}),r}var re=null;function ie(t){null===re&&(re=t.identifier)}function oe(t){re===t.identifier&&(re=null)}function ae(t){return function(e){for(var n=e.changedTouches,r=0;r<n.length;r++){var i=n[r];0===r&&"pointerdown"===t?ie(i):"pointerup"!==t&&"pointercancel"!==t||oe(i);var o=ne(t,i,e);Tt.dispatchEvent(o)}}}var se=ae("pointerdown"),ue=ae("pointermove"),le=ae("pointerup");function ce(t){return function(e){e.type=t,Tt.dispatchEvent(e)}}!function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){return(0,z.Z)(this,i),r.call(this,t)}(0,F.Z)(i)}(W);var he=ce("mousedown"),fe=ce("mousemove"),pe=ce("mouseup"),de="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast,ge="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),ve=de||ge,me={atob:function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new D("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i="",o=0,a=0;r=e.charAt(a++);~r&&(n=o%4?64*n+r:r,o++%4)?i+=String.fromCharCode(255&n>>(-2*o&6)):0)r=L.indexOf(r);return i},btoa:N,devicePixelRatio:j,Blob:Z,document:Tt,Element:et,Event:W,EventTarget:q,HTMLCanvasElement:Ot,HTMLElement:vt,HTMLMediaElement:mt,HTMLVideoElement:yt,Image:xt,ImageData:Lt,navigator:Ft,Node:K,requestAnimationFrame:function(t){var e=bt();return e.requestAnimationFrame?e.requestAnimationFrame(t):function(t){var e=Date.now(),n=Math.max(Zt+23,e);return setTimeout((function(){t(Zt=n)}),n-e)}(t)},cancelAnimationFrame:function(t){var e=bt();return e.cancelAnimationFrame?e.cancelAnimationFrame(t):clearTimeout(t)},screen:ot,XMLHttpRequest:Wt,performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,n){return{duration:0}},now:function(){}},URL:jt,WebGLRenderingContext:{GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:0x10000000000000000,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},WebGL2RenderingContext:{},addEventListener:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Tt.addEventListener(t,e,n)},removeEventListener:function(t,e,n){Tt.removeEventListener(t,e)},dispatchEvent:function(t){Tt.dispatchEvent(t)},innerWidth:ot.availWidth,innerHeight:ot.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ye=ve?me:B,_e=ve?Wt:B.XMLHttpRequest,be=ve?wt:B.location;function xe(t){var e=t;return"string"==typeof t&&(e=ye.document.getElementById(t)),e}function we(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function Ee(t){return we(t).split(/\s+/)}function Se(t,e,n){var r=ye.document.createElement(t);return r.className=e||"",n&&n.appendChild(r),r}function Ce(t){var e=t.parentNode;e&&e.removeChild(t)}function Ae(t,e){if(void 0!==t.classList)for(var n=Ee(e),r=0,i=n.length;r<i;r++)t.classList.add(n[r]);else if(!ke(t,e)){var o=Pe(t);Me(t,(o?o+" ":"")+e)}}function Te(t,e){void 0!==t.classList?t.classList.remove(e):Me(t,we((" "+Pe(t)+" ").replace(" "+e+" "," ")))}function ke(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=Pe(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function Me(t,e){t instanceof HTMLElement?t.className=e:t.className.baseVal=e}function Pe(t){return t instanceof SVGElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function Ie(t){for(;t&&t.firstChild;)t.removeChild(t.firstChild)}var Oe=function(t){var e,n,r=null==ye||null===(e=ye.document)||void 0===e||null===(n=e.documentElement)||void 0===n?void 0:n.style;if(!r)return t[0];for(var i in t)if(t[i]&&t[i]in r)return t[i];return t[0]}(["transform","WebkitTransform"]);function Re(t,e){t.style[Oe]=e}function Le(){if("function"==typeof Event)ye.dispatchEvent(new Event("resize"));else{var t=ye.document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,ye,0),ye.dispatchEvent(t)}}function De(t){var e=["padding: "+(t.height/2-8)+"px "+t.width/2+"px;","line-height: "+t.height+"px;","background-image: url("+t.toDataURL()+");"];console.log("%c\n",e.join(""))}function Ne(){var t,e=ye.document.querySelector('meta[name="viewport"]');if(!e)return 1;var n=(null===(t=e.content)||void 0===t?void 0:t.split(",")).find((function(t){var e=t.split("="),n=(0,R.Z)(e,2),r=n[0];return n[1],"initial-scale"===r}));return n?1*n.split("=")[1]:1}var Be=Ne()<1?1:ye.devicePixelRatio,ze=n(9611);function Fe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Ze(t,e,n){return Ze=Fe()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&(0,ze.Z)(i,n.prototype),i},Ze.apply(null,arguments)}function je(t){var e="function"==typeof Map?new Map:void 0;return je=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return Ze(t,arguments,(0,V.Z)(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,ze.Z)(r,t)},je(t)}var Ue=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t,e,n){var o;return(0,z.Z)(this,i),o=r.call(this,t),(0,m.Z)((0,H.Z)(o),"status",void 0),(0,m.Z)((0,H.Z)(o),"url",void 0),o.status=e,o.url=n,o.name=o.constructor.name,o.message=t,o}return(0,F.Z)(i,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),i}(je(Error));function Ge(t){var e=new _e;for(var n in e.open("GET",t.url,!0),t.headers)t.headers.hasOwnProperty(n)&&e.setRequestHeader(n,t.headers[n]);return e.withCredentials="include"===t.credentials,e}var Ve=function(t,e){var n=Ge(t);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var r;try{r=JSON.parse(n.response)}catch(t){return e(t)}e(null,r)}else 401===n.status?e(new Ue("".concat(n.statusText),n.status,t.url)):e(new Ue(n.statusText,n.status,t.url))},n.send(),n},We=function(t,e){var n=Ge(t);return n.responseType="arraybuffer",n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){var r=n.response;if(0===r.byteLength&&200===n.status)return e(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?e(null,{data:r,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):e(new Ue(n.statusText,n.status,t.url))},n.send(),n},He=function(t,e){return We(t,(function(t,n){if(t)e(t);else if(n){var r=new ye.Image;r.crossOrigin="anonymous";var i=ye.URL||ye.webkitURL;r.onload=function(){e(null,r),i.revokeObjectURL(r.src)};var o=new ye.Blob([new Uint8Array(n.data)],{type:"image/png"});r.src=n.data.byteLength?i.createObjectURL(o):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}}))},Xe=2*Math.PI*6378137/2;function Ye(t){var e=[1/0,1/0,-1/0,-1/0];return t.forEach((function(t){var n=t.coordinates;qe(e,n)})),e}function qe(t,e){return Array.isArray(e[0])?e.forEach((function(e){qe(t,e)})):(t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])),t}function Ke(t,e){return Qe(t,e)}function Qe(t,e){return Array.isArray(t[0])?t.map((function(t){return Qe(t,e)})):e(t)}function Je(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1},r=(t=nn(t,e))[0],i=t[1],o=r*Xe/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*Xe/180,n.enable&&(o=Number(o.toFixed(n.decimal)),a=Number(a.toFixed(n.decimal))),3===t.length?[o,a,t[2]]:[o,a]}function $e(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=t[0],r=t[1],i=n/Xe*180,o=r/Xe*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),null!=e&&(i=Number(i.toFixed(e)),o=Number(o.toFixed(e))),3===t.length?[i,o,t[2]]:[i,o]}function tn(t){if(null==t)throw new Error("lng is required");return(t>180||t<-180)&&((t%=360)>180&&(t=-360+t),t<-180&&(t=360+t),0===t&&(t=0)),t}function en(t){if(null==t)throw new Error("lat is required");return(t>90||t<-90)&&((t%=180)>90&&(t=-180+t),t<-90&&(t=180+t),0===t&&(t=0)),t}function nn(t,e){if(!1===e)return t;var n=tn(t[0]),r=en(t[1]);return r>85&&(r=85),r<-85&&(r=-85),3===t.length?[n,r,t[2]]:[n,r]}function rn(t){var e=85.0511287798,n=Math.max(Math.min(e,t[1]),-e),r=256<<20,i=Math.PI/180,o=t[0]*i,a=n*i;return a=Math.log(Math.tan(Math.PI/4+a/2)),o=r*(.5/Math.PI*o+.5),a=r*(-.5/Math.PI*a+(i=.5)),[Math.floor(o),Math.floor(a)]}function on(t){var e=.5/Math.PI,n=-.5/Math.PI,r=.5,i=256<<20,o=(0,R.Z)(t,2),a=o[0],s=o[1];return a=(a/i-.5)/e,s=(s/i-r)/n,s=2*(Math.atan(Math.pow(Math.E,s))-Math.PI/4),[a/(r=Math.PI/180),s/r]}function an(t,e,n){var r=T(e[1]-t[1]),i=T(e[0]-t[0]),o=T(t[1]),a=T(e[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return function(t,e){void 0===e&&(e="kilometers");var n=C[e];if(!n)throw new Error(e+" units is invalid");return t*n}(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function sn(t){var e=Math.PI/180,n=85.0511287798,r=6378137,i=Math.max(Math.min(n,t[1]),-n),o=Math.sin(i*e);return[r*t[0]*e,r*Math.log((1+o)/(1-o))/2]}function un(t,e){var n=Math.abs(t[1][1]-t[0][1])*e,r=Math.abs(t[1][0]-t[0][0])*e;return[[t[0][0]-r,t[0][1]-n],[t[1][0]+r,t[1][1]+n]]}function ln(t,e){return t[0][0]<=e[0][0]&&t[0][1]<=e[0][1]&&t[1][0]>=e[1][0]&&t[1][1]>=e[1][1]}function cn(t){return[[t[0],t[1]],[t[2],t[3]]]}var hn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;(0,z.Z)(this,t),(0,m.Z)(this,"limit",void 0),(0,m.Z)(this,"cache",void 0),(0,m.Z)(this,"destroy",void 0),(0,m.Z)(this,"order",void 0),this.limit=e,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return(0,F.Z)(t,[{key:"clear",value:function(){var t=this;this.order.forEach((function(e){t.delete(e)})),this.cache={},this.order=[]}},{key:"get",value:function(t){var e=this.cache[t];return e&&(this.deleteOrder(t),this.appendOrder(t)),e}},{key:"set",value:function(t,e){this.cache[t]?(this.delete(t),this.cache[t]=e,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=e,this.appendOrder(t))}},{key:"delete",value:function(t){var e=this.cache[t];e&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(e,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var e=this.order.findIndex((function(e){return e===t}));e>=0&&this.order.splice(e,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,e){return null}}]),t}();function fn(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}var pn,dn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;(0,z.Z)(this,t),(0,m.Z)(this,"duration",16),(0,m.Z)(this,"timestamp",(new Date).getTime()),this.duration=e}return(0,F.Z)(t,[{key:"run",value:function(t){var e=(new Date).getTime(),n=e-this.timestamp;this.timestamp=e,n>=this.duration&&t()}}]),t}(),gn=n(2650);function vn(t){return"string"==typeof t&&!!gn.ZP(t)}function mn(t){var e=gn.ZP(t),n=[0,0,0,0];return null!=e&&(n[0]=e.r/255,n[1]=e.g/255,n[2]=e.b/255,n[3]=e.opacity),n}function yn(t){return(t&&t[0])+256*(t&&t[1])+65536*(t&&t[2])-1}function _n(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}function bn(t){var e=ye.document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;for(var r,i=n.createLinearGradient(0,0,256,1),o=t.positions[0],a=t.positions[t.positions.length-1],s=0;s<t.colors.length;++s){var u=(t.positions[s]-o)/(a-o);i.addColorStop(u,t.colors[s])}return n.fillStyle=i,n.fillRect(0,0,256,1),r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),ve?{data:r,width:256,height:1}:new ImageData(r,256,1)}!function(t){t.CENTER="center",t.TOP="top",t["TOP-LEFT"]="top-left",t["TOP-RIGHT"]="top-right",t.BOTTOM="bottom",t["BOTTOM-LEFT"]="bottom-left",t.LEFT="left",t.RIGHT="right"}(pn||(pn={}));var xn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function wn(t,e,n){var r=t.classList;for(var i in xn)xn.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(e))}function En(t){if(0===t.length)throw new Error("max requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]>e&&(e=t[n]);return 1*e}function Sn(t){if(0===t.length)throw new Error("min requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]<e&&(e=t[n]);return 1*e}function Cn(t){if(0===t.length)return 0;for(var e=1*t[0],n=1;n<t.length;n++)e+=1*t[n];return e}function An(t){if(0===t.length)throw new Error("mean requires at least one data point");return Cn(t)/t.length}function Tn(t){if(0===t.length)throw new Error("mean requires at least one data point");if(t.length<3)return t[0];t.sort();for(var e=t[0],n=NaN,r=0,i=1,o=1;o<t.length+1;o++)t[o]!==e?(i>r&&(r=i,n=e),i=1,e=t[o]):i++;return 1*n}var kn={min:Sn,max:En,mean:An,sum:Cn,mode:Tn};function Mn(t,e){return t.map((function(t){return t[e]}))}function Pn(t,e){return kn[t](e)}var In=n(236),On=n.n(In),Rn=n(7037),Ln=n.n(Rn),Dn=n(3560),Nn=n.n(Dn),Bn=n(361),zn=n.n(Bn);function Fn(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function Zn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function jn(t,e){return t(e={exports:{}},e.exports),e.exports}var Un=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t&&"number"==typeof t.length&&t.length>=0&&t.length%1==0},t.exports=e.default}));Zn(Un);var Gn=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];var r=e.pop();return t.call(this,e,r)}},t.exports=e.default}));Zn(Gn);var Vn=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.fallback=o,e.wrap=a;var n,r=e.hasSetImmediate="function"==typeof setImmediate&&setImmediate,i=e.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function o(t){setTimeout(t,0)}function a(t){return function(e){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return t((function(){return e.apply(void 0,n)}))}}n=r?setImmediate:i?process.nextTick:o,e.default=a(n)}));Zn(Vn),Vn.fallback,Vn.wrap,Vn.hasSetImmediate,Vn.hasNextTick;var Wn=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return(0,Hn.isAsync)(t)?function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];var r=e.pop(),i=t.apply(this,e);return o(i,r)}:(0,n.default)((function(e,n){var r;try{r=t.apply(this,e)}catch(t){return n(t)}if(r&&"function"==typeof r.then)return o(r,n);n(null,r)}))};var n=i(Gn),r=i(Vn);function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){return t.then((function(t){a(e,null,t)}),(function(t){a(e,t&&t.message?t:new Error(t))}))}function a(t,e,n){try{t(e,n)}catch(t){(0,r.default)((function(t){throw t}),t)}}t.exports=e.default}));Zn(Wn);var Hn=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.isAsyncIterable=e.isAsyncGenerator=e.isAsync=void 0;var n,r=(n=Wn)&&n.__esModule?n:{default:n};function i(t){return"AsyncFunction"===t[Symbol.toStringTag]}e.default=function(t){if("function"!=typeof t)throw new Error("expected a function");return i(t)?(0,r.default)(t):t},e.isAsync=i,e.isAsyncGenerator=function(t){return"AsyncGenerator"===t[Symbol.toStringTag]},e.isAsyncIterable=function(t){return"function"==typeof t[Symbol.asyncIterator]}}));Zn(Hn),Hn.isAsyncIterable,Hn.isAsyncGenerator,Hn.isAsync;var Xn=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(void 0===e&&(e=t.length),!e)throw new Error("arity is undefined");function n(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[e-1]?t.apply(this,r):new Promise((function(i,o){r[e-1]=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];if(t)return o(t);i(e.length>1?e:e[0])},t.apply(n,r)}))}return Object.defineProperty(n,"name",{configurable:!0,value:"awaitable("+t.name+")"}),n},t.exports=e.default}));Zn(Xn);var Yn=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=o(Un),r=o(Hn),i=o(Xn);function o(t){return t&&t.__esModule?t:{default:t}}e.default=(0,i.default)((function(t,e,i){var o=(0,n.default)(e)?[]:{};t(e,(function(t,e,n){(0,r.default)(t)((function(t){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[e]=r,n(t)}))}),(function(t){return i(t,o)}))}),3),t.exports=e.default}));Zn(Yn);var qn=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){function e(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(null!==t){var r=t;t=null,r.apply(this,e)}}return Object.assign(e,t),e},t.exports=e.default}));Zn(qn);var Kn=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},t.exports=e.default}));Zn(Kn);var Qn=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if((0,n.default)(t))return function(t){var e=-1,n=t.length;return function(){return++e<n?{value:t[e],key:e}:null}}(t);var e,i,o,a,s=(0,r.default)(t);return s?function(t){var e=-1;return function(){var n=t.next();return n.done?null:(e++,{value:n.value,key:e})}}(s):(i=(e=t)?Object.keys(e):[],o=-1,a=i.length,function(){var t=i[++o];return o<a?{value:e[t],key:t}:null})};var n=i(Un),r=i(Kn);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}));Zn(Qn);var Jn=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(null===t)throw new Error("Callback was already called.");var r=t;t=null,r.apply(this,e)}},t.exports=e.default}));Zn(Jn);var $n=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default={},t.exports=e.default}));Zn($n);var tr=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,i){var o=!1,a=!1,s=!1,u=0,l=0;function c(){u>=e||s||o||(s=!0,t.next().then((function(t){var e=t.value,r=t.done;if(!a&&!o){if(s=!1,r)return o=!0,void(u<=0&&i(null));u++,n(e,l,h),l++,c()}})).catch(f))}function h(t,e){if(u-=1,!a)return t?f(t):!1===t?(o=!0,void(a=!0)):e===r.default||o&&u<=0?(o=!0,i(null)):void c()}function f(t){a||(s=!1,o=!0,i(t))}c()};var n,r=(n=$n)&&n.__esModule?n:{default:n};t.exports=e.default}));Zn(tr);var er=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=s(qn),r=s(Qn),i=s(Jn),o=s(tr),a=s($n);function s(t){return t&&t.__esModule?t:{default:t}}e.default=function(t){return function(e,s,u){if(u=(0,n.default)(u),t<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!e)return u(null);if((0,Hn.isAsyncGenerator)(e))return(0,o.default)(e,t,s,u);if((0,Hn.isAsyncIterable)(e))return(0,o.default)(e[Symbol.asyncIterator](),t,s,u);var l=(0,r.default)(e),c=!1,h=!1,f=0,p=!1;function d(t,e){if(!h)if(f-=1,t)c=!0,u(t);else if(!1===t)c=!0,h=!0;else{if(e===a.default||c&&f<=0)return c=!0,u(null);p||g()}}function g(){for(p=!0;f<t&&!c;){var e=l();if(null===e)return c=!0,void(f<=0&&u(null));f+=1,s(e.value,e.key,(0,i.default)(d))}p=!1}g()}},t.exports=e.default}));Zn(er);var nr=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=o(er),r=o(Hn),i=o(Xn);function o(t){return t&&t.__esModule?t:{default:t}}e.default=(0,i.default)((function(t,e,i,o){return(0,n.default)(e)(t,(0,r.default)(i),o)}),4),t.exports=e.default}));Zn(nr);var rr=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=i(nr),r=i(Xn);function i(t){return t&&t.__esModule?t:{default:t}}e.default=(0,r.default)((function(t,e,r){return(0,n.default)(t,1,e,r)}),3),t.exports=e.default}));Zn(rr);var ir=Zn(jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return(0,n.default)(r.default,t,e)};var n=i(Yn),r=i(rr);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}))),or=function(){function t(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];this.args=[],this.tasks=[]}return t.prototype.call=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,ir(this.tasks)},t.prototype.tap=function(t,e){var n=this;this.tasks.push((function(r){e.apply(void 0,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Fn(arguments[e]));return t}(n.args)),r(null,t)}))},t}(),ar=jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=l(Un),r=l($n),i=l(nr),o=l(qn),a=l(Jn),s=l(Hn),u=l(Xn);function l(t){return t&&t.__esModule?t:{default:t}}function c(t,e,n){n=(0,o.default)(n);var i=0,s=0,u=t.length,l=!1;function c(t,e){!1===t&&(l=!0),!0!==l&&(t?n(t):++s!==u&&e!==r.default||n(null))}for(0===u&&n(null);i<u;i++)e(t[i],i,(0,a.default)(c))}function h(t,e,n){return(0,i.default)(t,1/0,e,n)}e.default=(0,u.default)((function(t,e,r){return((0,n.default)(t)?c:h)(t,(0,s.default)(e),r)}),3),t.exports=e.default}));Zn(ar);var sr=Zn(jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return(0,r.default)(n.default,t,e)};var n=i(ar),r=i(Yn);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}))),ur=function(){function t(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];this.tasks=[]}return t.prototype.promise=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return sr(this.tasks)},t.prototype.tapPromise=function(t,e){var n=this;this.tasks.push((function(r){return i=n,o=void 0,s=function(){return function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(n){switch(n.label){case 0:return[4,e()];case 1:return n.sent(),r(null,t),[2]}}))},new((a=void 0)||(a=Promise))((function(t,e){function n(t){try{u(s.next(t))}catch(t){e(t)}}function r(t){try{u(s.throw(t))}catch(t){e(t)}}function u(e){e.done?t(e.value):function(t){return t instanceof a?t:new a((function(e){e(t)}))}(e.value).then(n,r)}u((s=s.apply(i,o||[])).next())}));var i,o,a,s}))},t}(),lr=Zn(jn((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=a(qn),r=a(Jn),i=a(Hn),o=a(Xn);function a(t){return t&&t.__esModule?t:{default:t}}e.default=(0,o.default)((function(t,e){if(e=(0,n.default)(e),!Array.isArray(t))return e(new Error("First argument to waterfall must be an array of functions"));if(!t.length)return e();var o=0;function a(e){(0,i.default)(t[o++]).apply(void 0,e.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||o===t.length?e.apply(void 0,[n].concat(r)):void a(r)}a([])})),t.exports=e.default}))),cr=function(){function t(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];this.tasks=[]}return t.prototype.call=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return lr(this.tasks)},t.prototype.tap=function(t,e){0===this.tasks.length?this.tasks.push((function(t){var n=e();t(!!n&&null,n)})):this.tasks.push((function(n,r){r(!!e()&&null,t)}))},t}(),hr=function(){function t(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];this.tasks=[]}return t.prototype.call=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return ir(this.tasks)},t.prototype.tap=function(t,e){this.tasks.push((function(n){n(e(),t)}))},t}(),fr=n(6729),pr=n.n(fr),dr=n(9848),gr=n.n(dr);function vr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function mr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?vr(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function yr(t,e){var n=e.radius,r=void 0===n?40:n,i=e.maxZoom,o=void 0===i?18:i,a=e.minZoom,s=void 0===a?0:a,u=e.zoom,l=void 0===u?2:u;if(t.pointIndex){var c=t.pointIndex.getClusters(t.extent,Math.floor(l));return t.dataArray=c.map((function(t,e){return mr({coordinates:t.geometry.coordinates,_id:e+1},t.properties)})),t}var h=new(gr())({radius:r,minZoom:s,maxZoom:o}),f={type:"FeatureCollection",features:[]};return f.features=t.dataArray.map((function(t){return{type:"Feature",geometry:{type:"Point",coordinates:t.coordinates},properties:mr({},t)}})),h.load(f.features),h}function _r(t){if(0===t.length)return 0;for(var e,n=t[0],r=0,i=1;i<t.length;i++)e=n+1*t[i],Math.abs(n)>=Math.abs(t[i])?r+=n-e+t[i]:r+=t[i]-e+n,n=e;return n+1*r}var br={min:function(t){if(0===t.length)throw new Error("min requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]<e&&(e=t[n]);return e},max:function(t){if(0===t.length)throw new Error("max requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]>e&&(e=t[n]);return e},mean:function(t){if(0===t.length)throw new Error("mean requires at least one data point");return _r(t)/t.length},sum:_r};function xr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function wr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?xr(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Er(t,e){if(Array.isArray(e))return e}var Sr=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t,e){var n;return(0,z.Z)(this,i),n=r.call(this),(0,m.Z)((0,H.Z)(n),"data",void 0),(0,m.Z)((0,H.Z)(n),"extent",void 0),(0,m.Z)((0,H.Z)(n),"hooks",{init:new or}),(0,m.Z)((0,H.Z)(n),"parser",{type:"geojson"}),(0,m.Z)((0,H.Z)(n),"transforms",[]),(0,m.Z)((0,H.Z)(n),"cluster",!1),(0,m.Z)((0,H.Z)(n),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,m.Z)((0,H.Z)(n),"mapService",void 0),(0,m.Z)((0,H.Z)(n),"invalidExtent",!1),(0,m.Z)((0,H.Z)(n),"originData",void 0),(0,m.Z)((0,H.Z)(n),"rawData",void 0),(0,m.Z)((0,H.Z)(n),"cfg",{}),(0,m.Z)((0,H.Z)(n),"clusterIndex",void 0),n.originData=t,n.initCfg(e),n.hooks.init.tap("parser",(function(){n.excuteParser()})),n.hooks.init.tap("cluster",(function(){n.initCluster()})),n.hooks.init.tap("transform",(function(){n.executeTrans()})),n.init(),n}return(0,F.Z)(i,[{key:"setData",value:function(t,e){this.rawData=t,this.originData=t,this.initCfg(e),this.init(),this.emit("update")}},{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,1/0)}},{key:"updateClusterData",value:function(t){var e=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,o=n.field,a=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,a.forEach((function(t){t.id||(t.properties.point_count=1)})),(o||Nn()(i))&&(a=a.map((function(t){var n=t.id;if(n){var r,a=e.clusterIndex.getLeaves(n,1/0).map((function(t){return t.properties}));if(Ln()(i)&&o){var s=function(t,e){return t.map((function(t){return 1*t[e]}))}(a,o);r=br[i](s)}Nn()(i)&&(r=i(a)),t.properties.stat=r}else t.properties.point_count=1;return t}))),this.data=s("geojson")({type:"FeatureCollection",features:a}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var e=this.parser.type;if("geojson"!==(void 0===e?"geojson":e)||this.cluster)return t<this.data.dataArray.length?this.data.dataArray[t]:"null";var n=t<this.originData.features.length?this.originData.features[t]:"null",r=zn()(n);if(0!==this.transforms.length){var i=this.data.dataArray.find((function(e){return e._id===t}));r.properties=i}return r}},{key:"getFeatureId",value:function(t,e){var n=this.data.dataArray.find((function(e){return e[t]===name}));return null==n?void 0:n._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(t){var e=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(e=un(cn(this.extent),t)),e[0].concat(e[1])}},{key:"initCfg",value:function(t){this.cfg=On()(this.cfg,t,Er);var e=this.cfg;e&&(e.parser&&(this.parser=e.parser),e.transforms&&(this.transforms=e.transforms),this.cluster=e.cluster||!1,e.clusterOptions&&(this.cluster=!0,this.clusterOptions=wr(wr({},this.clusterOptions),e.clusterOptions)))}},{key:"excuteParser",value:function(){var t=this.parser,e=t.type||"geojson";if("imagetile"!==e){var n=s(e);this.data=n(this.originData,t),this.extent=Ye(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}else this.data={tileurl:this.originData,dataArray:[]}}},{key:"executeTrans",value:function(){var t=this;this.transforms.forEach((function(e){var n=function(t){return o[t]}(e.type)(t.data,e);Object.assign(t.data,n)}))}},{key:"initCluster",value:function(){if(this.cluster){var t=this.clusterOptions||{};this.clusterIndex=yr(this.data,t)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),i}(fr.EventEmitter);function Cr(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Ar(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ar(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Ar(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Tr=6378e3,kr=Math.PI/3,Mr=[0,kr,2*kr,3*kr,4*kr,5*kr];function Pr(t){return t[0]}function Ir(t){return t[1]}function Or(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Rr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Or(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Or(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Lr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Dr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Lr(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Lr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}u("geojson",(function(t,e){var n=[],r={};return t.features=t.features.filter((function(t){var e=t.geometry;return null!=t&&e&&e.type&&e.coordinates&&e.coordinates.length>0})),b()(t,!0),0===t.features.length?{dataArray:[],featureKeys:r}:(k(t,(function(t,e){var r=function(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}(t),i=e,o=P(P({},t.properties),{},{coordinates:r,_id:i});n.push(o)})),{dataArray:n,featureKeys:r})})),u("image",(function(t,e){var n=e.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=new Promise((function(e){!function(t,e){var n=t,r=[];if("string"==typeof n)He({url:n},(function(t,n){r.push(n),e(r)}));else{var i=n.length,o=0;n.forEach((function(t){He({url:t},(function(t,n){o++,r.push(n),o===i&&e(r)}))}))}}(t,(function(t){e(t)}))}));return{originData:t,images:i,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]}})),u("csv",(function(t,e){return E(v(t),e)})),u("json",E),u("raster",(function(t,e){var n=e.extent,r=e.width,i=e.height,o=e.min,a=e.max;return{_id:1,dataArray:[{_id:1,data:Array.from(t),width:r,height:i,min:o,max:a,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]}})),l("cluster",yr),l("filter",(function(t,e){var n=e.callback;return n&&(t.dataArray=t.dataArray.filter(n)),t})),l("join",(function(t,e){var n=e.sourceField,r=e.targetField,i=e.data,o={};return i.forEach((function(t){o[t[n]]=t})),t.dataArray=t.dataArray.map((function(t){var e=t[r];return Dr(Dr({},t),o[e])})),t})),l("map",(function(t,e){var n=e.callback;return n&&(t.dataArray=t.dataArray.map(n)),t})),l("grid",(function(t,e){var n=t.dataArray,r=e.size,i=void 0===r?10:r,o=i/(2*Math.PI*Tr)*(256<<20)/2,a=function(t,e){var n,r,i=1/0,o=-1/0,a=Cr(t);try{for(a.s();!(r=a.n()).done;)n=r.value.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}catch(t){a.e(t)}finally{a.f()}var s=function(t,e){var n=t/Tr*(180/Math.PI),r=function(t,e){return e/Tr*(180/Math.PI)/Math.cos(t*Math.PI/180)}(e,t);return{yOffset:n,xOffset:r}}(e,(i+o)/2);if(s.xOffset<=0||s.yOffset<=0)return{gridHash:{},gridOffset:s};var u,l={},c=Cr(t);try{for(c.s();!(u=c.n()).done;){var h=u.value,f=h.coordinates[1],p=h.coordinates[0];if(Number.isFinite(f)&&Number.isFinite(p)){var d=Math.floor((f+90)/s.yOffset),g=Math.floor((p+180)/s.xOffset),v="".concat(d,"-").concat(g);l[v]=l[v]||{count:0,points:[]},l[v].count+=1,l[v].points.push(h)}}}catch(t){c.e(t)}finally{c.f()}return{gridHash:l,gridOffset:s}}(n,i),s=function(t,e,n){return Object.keys(t).reduce((function(r,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),l={};if(n.field&&n.method){var c=Mn(t[i].points,n.field);l[n.method]=kn[n.method](c)}return Object.assign(l,{_id:o,coordinates:rn([e.xOffset*(u+.5)-180,e.yOffset*(s+.5)-90]),rawData:t[i].points,count:t[i].count}),r.push(l),r}),[])}(a.gridHash,a.gridOffset,e);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:s}})),l("hexagon",(function(t,e){var n=t.dataArray,r=e.size,i=void 0===r?10:r,o=e.method,a=void 0===o?"sum":o,s=i/(2*Math.PI*6378e3)*(256<<20)/2,u=n.map((function(t){var e=rn(t.coordinates),n=(0,R.Z)(e,2),r=n[0],i=n[1];return Rr(Rr({},t),{},{coordinates:[r,i]})})),l=function(){var t,e,n,r=0,i=0,o=1,a=1,s=Pr,u=Ir;function l(t){var r,i={},o=[],a=t.length;for(r=0;r<a;++r)if(!isNaN(c=+s.call(null,l=t[r],r,t))&&!isNaN(h=+u.call(null,l,r,t))){var l,c,h,f=Math.round(h/=n),p=Math.round(c=c/e-(1&f)/2),d=h-f;if(3*Math.abs(d)>1){var g=c-p,v=p+(c<p?-1:1)/2,m=f+(h<f?-1:1),y=c-v,_=h-m;g*g+d*d>y*y+_*_&&(p=v+(1&f?1:-1)/2,f=m)}var b=p+"-"+f,x=i[b];x?x.push(l):(o.push(x=i[b]=[l]),x.x=(p+(1&f)/2)*e,x.y=f*n)}return o}function c(t){var e=0,n=0;return Mr.map((function(r){var i=Math.sin(r)*t,o=-Math.cos(r)*t,a=i-e,s=o-n;return e=i,n=o,[a,s]}))}return l.hexagon=function(e){return"m"+c(null==e?t:+e).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(i/n),l=Math.round(r/e),c=u*n;c<a+t;c+=n,++u)for(var h=l*e+(1&u)*e/2;h<o+e/2;h+=e)s.push([h,c]);return s},l.mesh=function(){var e=c(t).slice(0,4).join("l");return l.centers().map((function(t){return"M"+t+"m"+e})).join("")},l.x=function(t){return arguments.length?(s=t,l):s},l.y=function(t){return arguments.length?(u=t,l):u},l.radius=function(r){return arguments.length?(e=2*(t=+r)*Math.sin(kr),n=1.5*t,l):t},l.size=function(t){return arguments.length?(r=i=0,o=+t[0],a=+t[1],l):[o-r,a-i]},l.extent=function(t){return arguments.length?(r=+t[0][0],i=+t[0][1],o=+t[1][0],a=+t[1][1],l):[[r,i],[o,a]]},l.radius(1)}().radius(s).x((function(t){return t.coordinates[0]})).y((function(t){return t.coordinates[1]}));return{dataArray:l(u).map((function(t,n){var r;if(e.field&&a){var i=Mn(t,e.field);t[a]=kn[a](i)}return r={},(0,m.Z)(r,e.method,t[a]),(0,m.Z)(r,"count",t.length),(0,m.Z)(r,"rawData",t),(0,m.Z)(r,"coordinates",[t.x,t.y]),(0,m.Z)(r,"_id",n),r})),radius:s,xOffset:s,yOffset:s,type:"hexagon"}}));var Nr=[{lng1:100,lat1:30,lng2:130,lat2:30}],Br={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};const zr=Sr;n(8660);var Fr,Zr=n(6700),jr=n(4879),Ur={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Gr=n(1745),Vr=n.n(Gr);function Wr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Hr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Wr(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Wr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Xr(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Yr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Yr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function qr(t,e,n){var r,i=Xr(e);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.icon,s=o.xOffset;t[a.id]=Hr(Hr({},a),{},{x:s,y:n,image:a.image,width:a.width,height:a.height})}}catch(t){i.e(t)}finally{i.f()}}function Kr(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function Qr(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Jr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Jr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function $r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ti(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$r(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ei=function(){for(var t=[],e=32;e<128;e++)t.push(String.fromCharCode(e));return t}();function ni(t,e,n,r){t.font="".concat(r," ").concat(n,"px ").concat(e),t.fillStyle="black",t.textBaseline="middle"}function ri(t,e){for(var n=0;n<t.length;n++)e.data[4*n+3]=t[n]}var ii,oi=(0,Zr.b2)()(Fr=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"fontAtlas",void 0),(0,m.Z)(this,"iconFontMap",void 0),(0,m.Z)(this,"iconFontGlyphs",{}),(0,m.Z)(this,"fontOptions",void 0),(0,m.Z)(this,"key",void 0),(0,m.Z)(this,"cache",new hn(3))}return(0,F.Z)(t,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:ei,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var e=this;t.forEach((function(t){e.iconFontGlyphs[t.name]=t.unicode}))}},{key:"addIconFont",value:function(t,e){this.iconFontMap.set(t,e)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=ti(ti({},this.fontOptions),t),this.key=this.getKey();var e=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==e.length){var r=this.generateFontAtlas(this.key,e,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,e,n){var r=this.fontOptions,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,s=r.buffer,u=r.sdf,l=r.radius,c=r.cutoff,h=r.iconfont,f=n&&n.data;f||((f=ye.document.createElement("canvas")).width=1024);var p=f.getContext("2d");ni(p,i,a,o);var d=function(t){var e=t.characterSet,n=t.getFontWidth,r=t.fontHeight,i=t.buffer,o=t.maxCanvasWidth,a=t.mapping,s=void 0===a?{}:a,u=t.xOffset,l=void 0===u?0:u,c=t.yOffset,h=void 0===c?0:c,f=0,p=l;Array.from(e).forEach((function(t,e){if(!s[t]){var r=n(t,e);p+30>o&&(p=0,f++),s[t]={x:p,y:h+30*f,width:30,height:30,advance:r},p+=30}}));var d=r+2*i;return{mapping:s,xOffset:p,yOffset:h+f*d,canvasHeight:Kr(h+(f+1)*d)}}(ti({getFontWidth:function(t){return p.measureText(t).width},fontHeight:1*a,buffer:s,characterSet:e,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),g=d.mapping,v=d.canvasHeight,m=d.xOffset,y=d.yOffset,_=p.getImageData(0,0,f.width,f.height);if(f.height=v,p.putImageData(_,0,0),ni(p,i,a,o),u){var b,x=new(Vr())(a,s,l,c,i,o),w=p.getImageData(0,0,x.size,x.size),E=Qr(e);try{for(E.s();!(b=E.n()).done;){var S=b.value;if(h){var C=String.fromCharCode(parseInt(S.replace("&#x","").replace(";",""),16));ri(x.draw(C),w)}else ri(x.draw(S),w);p.putImageData(w,g[S].x,g[S].y)}}catch(t){E.e(t)}finally{E.f()}}else{var A,T=Qr(e);try{for(T.s();!(A=T.n()).done;){var k=A.value;p.fillText(k,g[k].x,g[k].y+1*a)}}catch(t){T.e(t)}finally{T.f()}}return{xOffset:m,yOffset:y,mapping:g,data:f,width:f.width,height:f.height}}},{key:"getKey",value:function(){return"key"}},{key:"getNewChars",value:function(t,e){var n=this.cache.get(t);if(!n)return e;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(e).forEach((function(t){o.has(t)||r.push(t)})),r}}]),t}())||Fr;var ai,si,ui=(0,Zr.b2)()(ii=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"canvasHeight",128),(0,m.Z)((0,H.Z)(t),"texture",void 0),(0,m.Z)((0,H.Z)(t),"canvas",void 0),(0,m.Z)((0,H.Z)(t),"iconData",void 0),(0,m.Z)((0,H.Z)(t),"iconMap",void 0),(0,m.Z)((0,H.Z)(t),"ctx",void 0),(0,m.Z)((0,H.Z)(t),"loadingImageCount",0),t}return(0,F.Z)(i,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ye.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(t,e){var n=this,r=new Image;if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:64}),this.updateIconMap(),this.loadImage(e).then((function(e){r=e;var i=n.iconData.find((function(e){return e.id===t}));i&&(i.image=r,i.width=r.width,i.height=r.height),n.update()}))}},{key:"addImageMini",value:function(t,e,n){var r=this,i=n.getSceneConfig().canvas,o=i.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:64}),this.updateIconMap(),this.loadImageMini(e,i).then((function(e){o=e;var n=r.iconData.find((function(e){return e.id===t}));n&&(n.image=o,n.width=o.width,n.height=o.height),r.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter((function(e){return e.id!==t})),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(e){var n=t.iconMap[e],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,l=void 0===u?64:u,c=Math.max(s,l)/64,h=l/c,f=s/c;o&&t.ctx.drawImage(o,r+(64-f)/2,i+(64-h)/2,f,h)}))}},{key:"updateIconMap",value:function(){var t=function(t,e,n){var r,i=0,o=0,a=0,s=[],u={},l=Xr(t);try{for(l.s();!(r=l.n()).done;){var c=r.value;if(!u[c.id]){var h=c.size;i+h+3>1024&&(qr(u,s,o),i=0,o=a+o+3,a=0,s=[]),s.push({icon:c,xOffset:i}),i=i+h+3,a=Math.max(a,h)}}}catch(t){l.e(t)}finally{l.f()}return s.length>0&&qr(u,s,o),{mapping:u,canvasHeight:Kr(a+o+3)}}(this.iconData),e=t.mapping,n=t.canvasHeight;this.iconMap=e,this.canvasHeight=n}},{key:"loadImage",value:function(t){return new Promise((function(e,n){if(t instanceof HTMLImageElement)e(t);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e(r)},r.onerror=function(){n(new Error("Could not load image at "+t))},r.src=t instanceof File?URL.createObjectURL(t):t}}))}},{key:"loadImageMini",value:function(t,e){return new Promise((function(n,r){var i=e.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(new Error("Could not load image at "+t))},i.src=t}))}}]),i}(fr.EventEmitter))||ii,li=n(5975),ci=(0,Zr.b2)()(ai=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"viewport",void 0),(0,m.Z)(this,"overridedViewProjectionMatrix",void 0),(0,m.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,m.Z)(this,"jitteredProjectionMatrix",void 0),(0,m.Z)(this,"viewMatrixInverse",void 0),(0,m.Z)(this,"cameraPosition",void 0)}return(0,F.Z)(t,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=li.create(),li.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),e=(0,R.Z)(t,2);return[e[0],e[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,e){var n=li.fromTranslation(li.create(),[t,e,0]);this.jitteredProjectionMatrix=li.multiply(li.create(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=li.multiply(li.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),t}())||ai;function hi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var fi,pi,di=(0,Zr.b2)()(si=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"container",void 0),(0,m.Z)(this,"controlCorners",void 0),(0,m.Z)(this,"controlContainer",void 0),(0,m.Z)(this,"scene",void 0),(0,m.Z)(this,"mapsService",void 0),(0,m.Z)(this,"controls",[]),(0,m.Z)(this,"unAddControls",[])}return(0,F.Z)(t,[{key:"init",value:function(t,e){this.container=t.container,this.scene=e,this.mapsService=e.get(Ur.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,e){e.get(Ur.IMapService).map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find((function(e){return e.controlOption.name===t}))}},{key:"removeControl",value:function(t){var e=this.controls.indexOf(t);return e>-1&&this.controls.splice(e,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach((function(e){e.addTo(t.scene),t.controls.push(e)})),this.unAddControls=[]}},{key:"destroy",value:function(){var t,e=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return hi(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?hi(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.controls);try{for(e.s();!(t=e.n()).done;)t.value.remove()}catch(t){e.e(t)}finally{e.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},e="l7-",n=this.controlContainer=Se("div",e+"control-container",this.container);function r(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=r.map((function(t){return e+t})).join(" ");t[r.join("")]=Se("div",i,n)}r(["top","left"]),r(["top","right"]),r(["bottom","left"]),r(["bottom","right"]),r(["top","center"]),r(["right","center"]),r(["left","center"]),r(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&Ce(this.controlCorners[t]);this.controlContainer&&Ce(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),t}())||si,gi=(0,Zr.b2)()(fi=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"container",void 0),(0,m.Z)(this,"scene",void 0),(0,m.Z)(this,"mapsService",void 0),(0,m.Z)(this,"markers",[]),(0,m.Z)(this,"markerLayers",[]),(0,m.Z)(this,"unAddMarkers",[]),(0,m.Z)(this,"unAddMarkerLayers",[])}return(0,F.Z)(t,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var e=this.markerLayers.indexOf(t);e>-1&&this.markerLayers.splice(e,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach((function(e){e.addTo(t.scene),t.markers.push(e)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach((function(e){t.markerLayers.push(e),e.addTo(t.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Ur.IMapService)}},{key:"destroy",value:function(){this.markers.forEach((function(t){t.remove()})),this.markers=[],this.markerLayers.forEach((function(t){t.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),t}())||fi,vi=(0,Zr.b2)()(pi=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"scene",void 0),(0,m.Z)(this,"popup",void 0),(0,m.Z)(this,"mapsService",void 0),(0,m.Z)(this,"unAddPopup",void 0)}return(0,F.Z)(t,[{key:"removePopup",value:function(t){t.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(t){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(t.addTo(this.scene),this.popup=t):this.unAddPopup=t}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Ur.IMapService)}}]),t}())||pi,mi=n(2492),yi=n.n(mi);const _i={MapToken:"您正在使用 Demo测试地图token，如果生产环境中使用去对应地图请注册Token",SDK:"请确认引入了mapbox-gl api且在L7之前引入"};var bi;function xi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function wi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?xi(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xi(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ei,Si={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Ci={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Ai=(0,Zr.b2)()(bi=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"sceneConfigCache",{}),(0,m.Z)(this,"layerConfigCache",{})}return(0,F.Z)(t,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return _i[t]}},{key:"setSceneConfig",value:function(t,e){this.sceneConfigCache[t]=wi(wi({},Si),e)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,e,n){this.layerConfigCache[e]=wi({},yi()({},this.sceneConfigCache[t],Ci,n))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),t}())||bi,Ti=n(3269),ki=n(3229),Mi=n(8333),Pi=Math.PI/180,Ii=4003e4;function Oi(t){var e=t.latitude,n=void 0===e?0:e,r=t.zoom,i=void 0===r?0:r,o=t.scale,a=t.highPrecision,s=void 0!==a&&a,u=t.flipY,l=void 0!==u&&u,c={},h=512*(o=void 0!==o?o:Math.pow(2,i)),f=Math.cos(n*Pi),p=h/360,d=p/f,g=h/Ii/f;if(c.pixelsPerMeter=[g,-g,g],c.metersPerPixel=[1/g,-1/g,1/g],c.pixelsPerDegree=[p,-d,g],c.degreesPerPixel=[1/p,-1/d,1/g],s){var v=Pi*Math.tan(n*Pi)/f,m=p*v/2,y=h/Ii*v,_=y/d*g;c.pixelsPerDegree2=[0,-m,y],c.pixelsPerMeter2=[_,0,_],l&&(c.pixelsPerDegree2[1]=-c.pixelsPerDegree2[1],c.pixelsPerMeter2[1]=-c.pixelsPerMeter2[1])}return l&&(c.pixelsPerMeter[1]=-c.pixelsPerMeter[1],c.metersPerPixel[1]=-c.metersPerPixel[1],c.pixelsPerDegree[1]=-c.pixelsPerDegree[1],c.degreesPerPixel[1]=-c.degreesPerPixel[1]),c}!function(t){t[t.LNGLAT=1]="LNGLAT",t[t.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",t[t.VECTOR_TILE=3]="VECTOR_TILE",t[t.IDENTITY=4]="IDENTITY",t[t.P20=5]="P20",t[t.P20_OFFSET=6]="P20_OFFSET",t[t.METER_OFFSET=7]="METER_OFFSET",t[t.P20_2=8]="P20_2"}(Ei||(Ei={}));var Ri,Li,Di,Ni,Bi,zi,Fi,Zi,ji,Ui,Gi,Vi={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Wi=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Hi=(Ri=(0,Zr.b2)(),Li=(0,Zr.f3)(Ur.ICameraService),Ri((Ni=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"needRefresh",!0),(0,Ti.Z)(this,"cameraService",Bi,this),(0,m.Z)(this,"coordinateSystem",void 0),(0,m.Z)(this,"viewportCenter",void 0),(0,m.Z)(this,"viewportCenterProjection",void 0),(0,m.Z)(this,"pixelsPerDegree",void 0),(0,m.Z)(this,"pixelsPerDegree2",void 0),(0,m.Z)(this,"pixelsPerMeter",void 0)}return(0,F.Z)(t,[{key:"refresh",value:function(){var t=this.cameraService.getZoom(),e=this.cameraService.getZoomScale(),n=this.cameraService.getCenter(),r=Oi({latitude:n[1],zoom:t}),i=r.pixelsPerMeter,o=r.pixelsPerDegree;this.viewportCenter=n,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=i,this.pixelsPerDegree=o,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Ei.LNGLAT||this.coordinateSystem===Ei.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Ei.LNGLAT_OFFSET?this.calculateLnglatOffset(n,t):this.coordinateSystem===Ei.P20_OFFSET&&this.calculateLnglatOffset(n,t,e,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,e,n,r){var i=Oi({latitude:t[1],zoom:e,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),l=this.cameraService.getProjectionMatrix(),c=li.multiply([],l,u),h=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,e));this.viewportCenterProjection=Mi.fF([],[h[0],h[1],0,1],c),u=this.cameraService.getViewMatrixUncentered()||u,c=li.multiply([],l,u),c=li.multiply([],c,Wi),this.cameraService.setViewProjectionMatrix(c),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}]),t}(),Bi=(0,ki.Z)(Ni.prototype,"cameraService",[Li],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Di=Ni))||Di),Xi=n(396),Yi=n.n(Xi);!function(t){t.Hover="hover",t.Click="click",t.Select="select",t.Active="active",t.Drag="drag"}(zi||(zi={}));var qi,Ki,Qi,Ji,$i,to,eo,no,ro,io,oo,ao,so={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},uo=(Fi=(0,Zr.b2)(),Zi=(0,Zr.f3)(Ur.IMapService),Fi((Ui=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,Ti.Z)((0,H.Z)(t),"mapService",Gi,(0,H.Z)(t)),(0,m.Z)((0,H.Z)(t),"hammertime",void 0),(0,m.Z)((0,H.Z)(t),"lastClickTime",0),(0,m.Z)((0,H.Z)(t),"lastClickXY",[-1,-1]),(0,m.Z)((0,H.Z)(t),"clickTimer",void 0),(0,m.Z)((0,H.Z)(t),"$containter",void 0),(0,m.Z)((0,H.Z)(t),"onDrag",(function(e){var n=t.interactionEvent(e);n.type=so[n.type],t.emit(zi.Drag,n)})),(0,m.Z)((0,H.Z)(t),"onHammer",(function(e){e.srcEvent.stopPropagation();var n=t.interactionEvent(e);t.emit(zi.Hover,n)})),(0,m.Z)((0,H.Z)(t),"onTouch",(function(e){var n=e.touches[0];t.onHover({x:n.pageX,y:n.pageY,type:"touch"})})),(0,m.Z)((0,H.Z)(t),"onHover",(function(e){var n=e.clientX,r=e.clientY,i=e.type,o=t.mapService.getMapContainer();if(o)if(ve)n=n-o.left-0,r=r-o.top-0;else{var a=o.getBoundingClientRect(),s=a.top;n=n-a.left-o.clientLeft,r=r-s-o.clientTop}var u=t.mapService.containerToLngLat([n,r]);if("click"!==i)"touch"!==i?"click"!==i&&"dblclick"!==i&&t.emit(zi.Hover,{x:n,y:r,lngLat:u,type:i,target:e}):t.isDoubleTap(n,r,u);else{if(!ve&&"ontouchstart"in document.documentElement==1)return;t.isDoubleTap(n,r,u)}})),t}return(0,F.Z)(i,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(zi.Hover)}},{key:"triggerHover",value:function(t){var e=t.x,n=t.y;this.emit(zi.Hover,{x:e,y:n})}},{key:"triggerSelect",value:function(t){this.emit(zi.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(zi.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(t){this.onHover({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t)if(ve)ye.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var e=new(Yi().Manager)(t);e.add(new(Yi().Tap)({event:"dblclick",taps:2})),e.add(new(Yi().Tap)({event:"click"})),e.add(new(Yi().Pan)({threshold:0,pointers:0})),e.add(new(Yi().Press)({})),e.on("dblclick click",this.onHammer),e.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("mousemove",this.onHover),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=e}}},{key:"removeEventListenerOnMap",value:function(){if(ve)ye.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(t){var e,n,r=t.type;"touch"===t.pointerType?(n=Math.floor(t.pointers[0].clientY),e=Math.floor(t.pointers[0].clientX)):(n=Math.floor(t.srcEvent.y),e=Math.floor(t.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;e-=o.left,n-=a}return{x:e,y:n,lngLat:this.mapService.containerToLngLat([e,n]),type:r,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,e,n){var r=this,i=(new Date).getTime(),o="click";i-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-e)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(zi.Hover,{x:t,y:e,lngLat:n,type:o})):(this.lastClickTime=i,this.lastClickXY=[t,e],this.clickTimer=setTimeout((function(){o="click",r.emit(zi.Hover,{x:t,y:e,lngLat:n,type:o})}),400))}}]),i}(pr()),Gi=(0,ki.Z)(Ui.prototype,"mapService",[Zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ji=Ui))||ji),lo=n(5861),co=n(7757),ho=n.n(co),fo=0;function po(t){if(ve)return null;var e=t;if("string"==typeof t&&(e=document.getElementById(t)),e){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(fo++),n.classList.add("l7-scene"),e.appendChild(n),n}return null}function go(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function vo(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?go(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):go(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}!function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.MAX_EXT=32776]="MAX_EXT",t[t.MIN_EXT=32775]="MIN_EXT",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.CULL_FACE=2884]="CULL_FACE",t[t.BLEND=3042]="BLEND",t[t.DITHER=3024]="DITHER",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.TEXTURE1=33985]="TEXTURE1",t[t.TEXTURE2=33986]="TEXTURE2",t[t.TEXTURE3=33987]="TEXTURE3",t[t.TEXTURE4=33988]="TEXTURE4",t[t.TEXTURE5=33989]="TEXTURE5",t[t.TEXTURE6=33990]="TEXTURE6",t[t.TEXTURE7=33991]="TEXTURE7",t[t.TEXTURE8=33992]="TEXTURE8",t[t.TEXTURE9=33993]="TEXTURE9",t[t.TEXTURE10=33994]="TEXTURE10",t[t.TEXTURE11=33995]="TEXTURE11",t[t.TEXTURE12=33996]="TEXTURE12",t[t.TEXTURE13=33997]="TEXTURE13",t[t.TEXTURE14=33998]="TEXTURE14",t[t.TEXTURE15=33999]="TEXTURE15",t[t.TEXTURE16=34e3]="TEXTURE16",t[t.TEXTURE17=34001]="TEXTURE17",t[t.TEXTURE18=34002]="TEXTURE18",t[t.TEXTURE19=34003]="TEXTURE19",t[t.TEXTURE20=34004]="TEXTURE20",t[t.TEXTURE21=34005]="TEXTURE21",t[t.TEXTURE22=34006]="TEXTURE22",t[t.TEXTURE23=34007]="TEXTURE23",t[t.TEXTURE24=34008]="TEXTURE24",t[t.TEXTURE25=34009]="TEXTURE25",t[t.TEXTURE26=34010]="TEXTURE26",t[t.TEXTURE27=34011]="TEXTURE27",t[t.TEXTURE28=34012]="TEXTURE28",t[t.TEXTURE29=34013]="TEXTURE29",t[t.TEXTURE30=34014]="TEXTURE30",t[t.TEXTURE31=34015]="TEXTURE31",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"}(qi||(qi={}));var mo,yo,_o,bo,xo,wo,Eo,So,Co,Ao=(Ki=(0,Zr.b2)(),Qi=(0,Zr.f3)(Ur.IRendererService),Ji=(0,Zr.f3)(Ur.IGlobalConfigService),$i=(0,Zr.f3)(Ur.IInteractionService),to=(0,Zr.f3)(Ur.ILayerService),Ki((no=function(){function t(){var e=this;(0,z.Z)(this,t),(0,Ti.Z)(this,"rendererService",ro,this),(0,Ti.Z)(this,"configService",io,this),(0,Ti.Z)(this,"interactionService",oo,this),(0,Ti.Z)(this,"layerService",ao,this),(0,m.Z)(this,"pickingFBO",void 0),(0,m.Z)(this,"width",0),(0,m.Z)(this,"height",0),(0,m.Z)(this,"alreadyInPicking",!1),(0,m.Z)(this,"pickBufferScale",1),(0,m.Z)(this,"lastPickTime",(new Date).getTime()),(0,m.Z)(this,"pickFromPickingFBO",(function(t,n){var r,i=n.x,o=n.y,a=n.lngLat,s=n.type,u=n.target,l=!1,c=e.rendererService,h=(c.getViewportSize,c.readPixels),f=c.getContainer,p=e.getContainerSize(f()),d=p.width,g=p.height;d*=Be,g*=Be;var v,m=t.getLayerConfig(),y=m.enableHighlight,_=m.enableSelect,b=i*Be,x=o*Be;if(b>d-1*Be||b<0||x>g-1*Be||x<0)return!1;if(0!==(v=h({x:Math.floor(b/e.pickBufferScale),y:Math.floor((g-(o+1)*Be)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]||0!==v[1]||0!==v[2]){var w=yn(v),E=t.getSource().getFeatureById(w);w!==t.getCurrentPickId()&&"mousemove"===s&&(s="mouseenter");var S={x:i,y:o,type:s,lngLat:a,featureId:w,feature:E,target:u};E&&(l=!0,t.setCurrentPickId(w),e.triggerHoverOnLayer(t,S))}else{var C={x:i,y:o,lngLat:a,type:null!==t.getCurrentPickId()&&"mousemove"===s?"mouseout":"un"+s,featureId:null,target:u,feature:null};e.triggerHoverOnLayer(t,vo(vo({},C),{},{type:"unpick"})),e.triggerHoverOnLayer(t,C),t.setCurrentPickId(null)}if(y&&e.highlightPickedFeature(t,v),_&&"click"===s&&(null===(r=v)||void 0===r?void 0:r.toString())!==[0,0,0,0].toString()){var A=yn(v);null===t.getCurrentSelectedId()||A!==t.getCurrentSelectedId()?(e.selectFeature(t,v),t.setCurrentSelectedId(A)):(e.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return l}))}var e,n,r;return(0,F.Z)(t,[{key:"init",value:function(t){var e=this.rendererService,n=e.createTexture2D,r=e.createFramebuffer,i=(e.getViewportSize,e.getContainer),o=this.getContainerSize(i()),a=o.width,s=o.height;a*=Be,s*=Be,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=r({color:n({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale),wrapS:qi.CLAMP_TO_EDGE,wrapT:qi.CLAMP_TO_EDGE})}),this.interactionService.on(zi.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(r=(0,lo.Z)(ho().mark((function t(e,n,r){var i,o,a,s=this;return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=this.rendererService,o=i.useFramebuffer,a=i.clear,i.getContainer,this.resizePickingFBO(),o(this.pickingFBO,(function(){a({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.hooks.beforePickingEncode.call(),e.renderModels(),e.hooks.afterPickingEncode.call();var t=s.pickBox(e,n);r(t)}));case 3:case"end":return t.stop()}}),t,this)}))),function(t,e,n){return r.apply(this,arguments)})},{key:"pickBox",value:function(t,e){var n,r=this,i=e.map((function(t){var e=t<0?0:t;return Math.floor(e*Be/r.pickBufferScale)})),o=(0,R.Z)(i,4),a=o[0],s=o[1],u=o[2],l=o[3],c=this.rendererService,h=(c.getViewportSize,c.readPixels),f=c.getContainer,p=this.getContainerSize(f()),d=p.width,g=p.height;if(g*=Be,a>((d*=Be)-1)*Be/this.pickBufferScale||u<0||s>(g-1)*Be/this.pickBufferScale||l<0)return[];var v=Math.min(d/this.pickBufferScale,u)-a,m=Math.min(g/this.pickBufferScale,l)-s;n=h({x:a,y:Math.floor(g/this.pickBufferScale-(l+1)),width:v,height:m,data:new Uint8Array(v*m*4),framebuffer:this.pickingFBO});for(var y=[],_={},b=0;b<n.length/4;b+=1){var x=yn(n.slice(4*b,4*b+4));if(-1!==x&&!_[x]){var w=t.getSource().getFeatureById(x);y.push(w),_[x]=!0}}return y}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/Be,height:t.height/Be}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:(n=(0,lo.Z)(ho().mark((function t(e){var n;return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.layerService.isMapDragging())&&this.layerService.getShaderPickStat()){t.next=2;break}return t.abrupt("return");case 2:if(this.alreadyInPicking=!0,!((n=(new Date).getTime())-this.lastPickTime>10||"contextmenu"===e.type)){t.next=7;break}return t.next=7,this.pickingLayers(e);case 7:this.lastPickTime=n,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,e=this.getContainerSize(t()),n=e.width,r=e.height;n*=Be,r*=Be,this.width===n&&this.height===r||(this.pickingFBO.resize({width:Math.round(n/this.pickBufferScale),height:Math.round(r/this.pickBufferScale)}),this.width=n,this.height=r)}},{key:"pickingLayers",value:(e=(0,lo.Z)(ho().mark((function t(e){var n,r,i,o=this;return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=this.rendererService).getViewportSize,r=n.useFramebuffer,i=n.clear,n.getContainer,this.resizePickingFBO(),r(this.pickingFBO,(function(){o.layerService.getRenderList().filter((function(t){return t.needPick(e.type)})).reverse().some((function(t){return i({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels(!0),t.hooks.afterPickingEncode.call(),o.pickFromPickingFBO(t,e)&&!t.getLayerConfig().enablePropagation}))}));case 3:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(t,e){var n,r,i,o;o=!0,null==(n=e)||null===(r=n.target)||void 0===r||null===(i=r.path)||void 0===i||i.map((function(t){var e;null!=t&&t.classList&&(null==t||null===(e=t.classList)||void 0===e||e.forEach((function(t){"l7-marker"!==t&&"l7-popup"!==t||(o=!1)})))})),o&&t.emit(e.type,e)}},{key:"highlightPickedFeature",value:function(t,e){var n=(0,R.Z)(e,3),r=n[0],i=n[1],o=n[2];t.hooks.beforeHighlight.call([r,i,o])}},{key:"selectFeature",value:function(t,e){var n=(0,R.Z)(e,3),r=n[0],i=n[1],o=n[2];t.hooks.beforeSelect.call([r,i,o])}}]),t}(),ro=(0,ki.Z)(no.prototype,"rendererService",[Qi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),io=(0,ki.Z)(no.prototype,"configService",[Ji],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oo=(0,ki.Z)(no.prototype,"interactionService",[$i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ao=(0,ki.Z)(no.prototype,"layerService",[to],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eo=no))||eo),To=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,z.Z)(this,t),(0,m.Z)(this,"autoStart",void 0),(0,m.Z)(this,"startTime",0),(0,m.Z)(this,"oldTime",0),(0,m.Z)(this,"running",!1),(0,m.Z)(this,"elapsedTime",0),this.autoStart=e}return(0,F.Z)(t,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}]),t}(),ko=(mo=(0,Zr.b2)(),yo=(0,Zr.f3)(Ur.IRendererService),_o=(0,Zr.f3)(Ur.IMapService),bo=(0,Zr.f3)(Ur.IGlobalConfigService),mo((wo=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"clock",new To),(0,m.Z)(this,"alreadyInRendering",!1),(0,m.Z)(this,"layers",[]),(0,m.Z)(this,"layerList",[]),(0,m.Z)(this,"layerRenderID",void 0),(0,m.Z)(this,"sceneInited",!1),(0,m.Z)(this,"animateInstanceCount",0),(0,m.Z)(this,"shaderPicking",!0),(0,m.Z)(this,"enableRender",!0),(0,Ti.Z)(this,"renderService",Eo,this),(0,Ti.Z)(this,"mapService",So,this),(0,Ti.Z)(this,"configService",Co,this)}return(0,F.Z)(t,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach((function(t){t.inited||t.init()})),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find((function(e){return e.id===t}))}},{key:"getLayerByName",value:function(t){return this.layers.find((function(e){return e.name===t}))}},{key:"cleanRemove",value:function(t,e){if(e){var n=e.layerChildren.indexOf(t);n>-1&&e.layerChildren.splice(n,1)}else{var r=this.layers.indexOf(t);r>-1&&this.layers.splice(r,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(t,e){if(e){var n=e.layerChildren.indexOf(t);n>-1&&e.layerChildren.splice(n,1)}else{var r=this.layers.indexOf(t);r>-1&&this.layers.splice(r,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){!this.alreadyInRendering&&this.enableRender&&(this.alreadyInRendering=!0,this.clear(),this.layerList.forEach((function(t){t.hooks.beforeRenderData.call(),t.hooks.beforeRender.call(),t.render(),t.hooks.afterRender.call()})),this.alreadyInRendering=!1)}},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter((function(t){return t.inited})).filter((function(t){return t.isVisible()})).forEach((function(e){t.layerList.push(e),e.layerChildren.filter((function(t){return t.inited})).filter((function(t){return t.isVisible()})).forEach((function(e){t.layerList.push(e)}))})),this.layerList.sort((function(t,e){return t.zIndex-e.zIndex}))}},{key:"destroy",value:function(){this.layers.forEach((function(t){t.layerChildren&&(t.layerChildren.forEach((function(t){return t.destroy()})),t.layerChildren=[]),t.destroy()})),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"isMapDragging",value:function(){return this.mapService.dragging}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ye.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var t=mn(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){ye.cancelAnimationFrame(this.layerRenderID)}}]),t}(),Eo=(0,ki.Z)(wo.prototype,"renderService",[yo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),So=(0,ki.Z)(wo.prototype,"mapService",[_o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Co=(0,ki.Z)(wo.prototype,"configService",[bo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xo=wo))||xo);function Mo(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var Po,Io,Oo,Ro,Lo,Do,No=n(4293),Bo=n.n(No),zo=function(){function t(e){var n=this;(0,z.Z)(this,t),(0,m.Z)(this,"name",void 0),(0,m.Z)(this,"type",void 0),(0,m.Z)(this,"scale",void 0),(0,m.Z)(this,"descriptor",void 0),(0,m.Z)(this,"featureBufferLayout",[]),(0,m.Z)(this,"needRescale",!1),(0,m.Z)(this,"needRemapping",!1),(0,m.Z)(this,"needRegenerateVertices",!1),(0,m.Z)(this,"featureRange",{startIndex:0,endIndex:1/0}),(0,m.Z)(this,"vertexAttribute",void 0),(0,m.Z)(this,"defaultCallback",(function(t){var e;return 0===t.length?(null===(e=n.scale)||void 0===e?void 0:e.defaultValues)||[]:t.map((function(t,e){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[e].func)(t)}))})),this.setProps(e)}return(0,F.Z)(t,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var e;if(null!==(e=this.scale)&&void 0!==e&&e.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,(0,y.Z)(t));if(!Bo()(r))return[r]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),t}(),Fo=["buffer","update","name"];function Zo(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function jo(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Zo(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Zo(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Uo,Go,Vo,Wo,Ho,Xo,Yo,qo,Ko,Qo,Jo,$o,ta,ea,na,ra,ia,oa,aa,sa,ua,la,ca,ha,fa,pa,da,ga,va,ma,ya,_a,ba,xa=(Po={},(0,m.Z)(Po,qi.FLOAT,4),(0,m.Z)(Po,qi.UNSIGNED_BYTE,1),(0,m.Z)(Po,qi.UNSIGNED_SHORT,2),Po),wa=(Io=(0,Zr.b2)(),Oo=(0,Zr.f3)(Ur.IRendererService),Io((Lo=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"attributesAndIndices",void 0),(0,Ti.Z)(this,"rendererService",Do,this),(0,m.Z)(this,"attributes",[]),(0,m.Z)(this,"triangulation",void 0),(0,m.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,F.Z)(t,[{key:"registerStyleAttribute",value:function(t){var e=this.getLayerStyleAttribute(t.name||"");return e?e.setProps(t):(e=new zo(t),this.attributes.push(e)),e}},{key:"updateStyleAttribute",value:function(t,e,n){var r=this.getLayerStyleAttribute(t);r||(r=this.registerStyleAttribute(jo(jo({},e),{},{name:t})));var i=e.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find((function(e){return e.name===t}))}},{key:"getLayerAttributeScale",value:function(t){var e,n=this.getLayerStyleAttribute(t),r=null==n||null===(e=n.scale)||void 0===e?void 0:e.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=this.attributes.find((function(e){return e.name===t}));if(i&&i.descriptor){var o=i.descriptor,a=o.update,s=o.buffer,u=o.size,l=void 0===u?0:u,c=xa[s.type||qi.FLOAT];if(a){var h=this.featureLayout,f=h.elements,p=h.sizePerElement,d=f.slice(n,r);if(!d.length)return;var g=d[0].offset,v=g*l*c,m=d.map((function(t,n){for(var r=t.featureIdx,i=t.vertices,o=t.normals,s=i.length/p,u=[],l=0;l<s;l++){var c=o?o.slice(3*l,3*l+3):[];u.push.apply(u,(0,y.Z)(a(e[r],r,i.slice(l*p,l*p+p),n,c)))}return u})).reduce((function(t,e){return t.push.apply(t,(0,y.Z)(e)),t}),[]);i.vertexAttribute.updateBuffer({data:m,offset:v})}}}},{key:"createAttributesAndIndices",value:function(t,e,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);var i=this.attributes.map((function(t){return t.resetDescriptor(),t.descriptor})),o=0,a=[],s=3;t.forEach((function(t,e){var u=r.triangulation(t,n),l=u.indices,c=u.vertices,h=u.normals,f=u.size;l.forEach((function(t){a.push(t+o)})),s=f;var p=c.length/f;r.featureLayout.sizePerElement=s,r.featureLayout.elements.push({featureIdx:e,vertices:c,normals:h,offset:o}),o+=p;for(var d=function(n){var r=(null==h?void 0:h.slice(3*n,3*n+3))||[],o=c.slice(n*f,n*f+f);i.forEach((function(i,a){var s;i&&i.update&&(s=i.buffer.data).push.apply(s,(0,y.Z)(i.update(t,e,o,n,r)))}))},g=0;g<p;g++)d(g)}));var u=this.rendererService,l=u.createAttribute,c=u.createBuffer,h=u.createElements,f={};i.forEach((function(t,e){if(t){var n=t.buffer,i=(t.update,t.name,Mo(t,Fo)),o=l(jo({buffer:c(n)},i));f[t.name||""]=o,r.attributes[e].vertexAttribute=o}}));var p=h({data:a,type:qi.UNSIGNED_INT,count:a.length});return this.attributesAndIndices={attributes:f,elements:p},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach((function(t){t.vertexAttribute&&t.vertexAttribute.destroy()})),null===(t=this.attributesAndIndices)||void 0===t||t.elements.destroy(),this.attributes=[]}}]),t}(),Do=(0,ki.Z)(Lo.prototype,"rendererService",[Oo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ro=Lo))||Ro),Ea=n(7709),Sa=n.n(Ea);var Ca,Aa=(Uo=(0,Zr.b2)(),Go=(0,Zr.f3)(Ur.SceneID),Vo=(0,Zr.f3)(Ur.IIconService),Wo=(0,Zr.f3)(Ur.IFontService),Ho=(0,Zr.f3)(Ur.IControlService),Xo=(0,Zr.f3)(Ur.IGlobalConfigService),Yo=(0,Zr.f3)(Ur.IMapService),qo=(0,Zr.f3)(Ur.ICoordinateSystemService),Ko=(0,Zr.f3)(Ur.IRendererService),Qo=(0,Zr.f3)(Ur.ILayerService),Jo=(0,Zr.f3)(Ur.ICameraService),$o=(0,Zr.f3)(Ur.IInteractionService),ta=(0,Zr.f3)(Ur.IPickingService),ea=(0,Zr.f3)(Ur.IShaderModuleService),na=(0,Zr.f3)(Ur.IMarkerService),ra=(0,Zr.f3)(Ur.IPopupService),Uo((oa=function(t){(0,U.Z)(o,t);var e,n,r,i=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,V.Z)(n);if(r){var i=(0,V.Z)(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return(0,G.Z)(this,t)});function o(){var t;return(0,z.Z)(this,o),t=i.call(this),(0,m.Z)((0,H.Z)(t),"destroyed",!1),(0,m.Z)((0,H.Z)(t),"loaded",!1),(0,m.Z)((0,H.Z)(t),"loadFont",!1),(0,m.Z)((0,H.Z)(t),"fontFamily",""),(0,Ti.Z)((0,H.Z)(t),"id",aa,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"iconService",sa,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"fontService",ua,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"controlService",la,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"configService",ca,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"map",ha,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"coordinateSystemService",fa,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"rendererService",pa,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"layerService",da,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"cameraService",ga,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"interactionService",va,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"pickingService",ma,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"shaderModuleService",ya,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"markerService",_a,(0,H.Z)(t)),(0,Ti.Z)((0,H.Z)(t),"popupService",ba,(0,H.Z)(t)),(0,m.Z)((0,H.Z)(t),"inited",!1),(0,m.Z)((0,H.Z)(t),"initPromise",void 0),(0,m.Z)((0,H.Z)(t),"rendering",!1),(0,m.Z)((0,H.Z)(t),"$container",void 0),(0,m.Z)((0,H.Z)(t),"canvas",void 0),(0,m.Z)((0,H.Z)(t),"markerContainer",void 0),(0,m.Z)((0,H.Z)(t),"hooks",void 0),(0,m.Z)((0,H.Z)(t),"handleWindowResized",(function(){t.emit("resize"),t.$container&&(t.initContainer(),Le(),t.coordinateSystemService.needRefresh=!0,t.render())})),(0,m.Z)((0,H.Z)(t),"handleMapCameraChanged",(function(e){t.cameraService.update(e),t.render()})),t.hooks={init:new ur},t}return(0,F.Z)(o,[{key:"init",value:function(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,lo.Z)(ho().mark((function t(){return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){e.map.onCameraChanged((function(n){e.cameraService.init(),e.cameraService.update(n),"GAODE2.x"!==e.map.version&&t()})),"GAODE2.x"!==e.map.version?e.map.init():t()}));case 2:if("GAODE2.x"!==e.map.version||!e.map.initViewPort){t.next=6;break}return t.next=5,e.map.init();case 5:e.map.initViewPort();case 6:e.map.onCameraChanged(e.handleMapCameraChanged),e.map.addMarkerContainer(),e.markerService.addMarkers(),e.markerService.addMarkerLayers(),e.popupService.initPopup(),e.interactionService.init(),e.interactionService.on(zi.Drag,e.addSceneEvent.bind(e));case 13:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",(0,lo.Z)(ho().mark((function t(){var n,r;return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=po(e.configService.getSceneConfig(e.id).id||""),e.$container=n,!n){t.next=11;break}return e.canvas=Se("canvas","",n),e.setCanvas(),t.next=7,e.rendererService.init(e.canvas,e.configService.getSceneConfig(e.id));case 7:Sa()(e.$container,e.handleWindowResized),ye.matchMedia&&(null===(r=ye.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===r||r.addListener(e.handleWindowResized)),t.next=12;break;case 11:console.error("容器 id 不存在");case 12:e.pickingService.init(e.id);case 13:case"end":return t.stop()}}),t)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,lo.Z)(ho().mark((function t(){return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){e.map.onCameraChanged((function(n){e.cameraService.init(),e.cameraService.update(n),"GAODE2.x"!==e.map.version&&t()})),e.map.initMiniMap()}));case 2:e.map.onCameraChanged(e.handleMapCameraChanged),e.interactionService.init(),e.interactionService.on(zi.Drag,e.addSceneEvent.bind(e));case 5:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",(0,lo.Z)(ho().mark((function n(){var r;return ho().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.canvas,e.$container=r||null,!e.$container){n.next=7;break}return n.next=5,e.rendererService.init(t.canvas,e.configService.getSceneConfig(e.id));case 5:n.next=8;break;case 7:console.error("容器 id 不存在");case 8:e.pickingService.init(e.id);case 9:case"end":return n.stop()}}),n)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t),this.render()}},{key:"render",value:(e=(0,lo.Z)(ho().mark((function t(){return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.rendering&&!this.destroyed){t.next=2;break}return t.abrupt("return");case 2:if(this.rendering=!0,this.inited){t.next=15;break}return t.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!this.loadFont||!document.fonts){t.next=10;break}return t.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 18:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"addFontFace",value:function(t,e){this.fontFamily=t;var n=document.createElement("style");n.type="text/css",n.innerText="\n        @font-face{\n            font-family: '".concat(t,"';\n            src: url('").concat(e,"') format('woff2'),\n            url('").concat(e,"') format('woff'),\n            url('").concat(e,"') format('truetype');\n        }"),document.getElementsByTagName("head")[0].appendChild(n),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(t){var e,n=null===(e=this.$container)||void 0===e?void 0:e.getElementsByTagName("canvas")[0];return this.render(),"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;null!==t&&(this.markerContainer=Se("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t,e,n,r=this;this.inited?(this.emit("destroy"),this.layerService.destroy(),setTimeout((function(){r.rendererService.destroy()})),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),null===(t=this.$container)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Ea.unbind)(this.$container,this.handleWindowResized),ye.matchMedia&&(null===(n=ye.matchMedia("screen and (min-resolution: 2dppx)"))||void 0===n||n.removeListener(this.handleWindowResized))):this.destroyed=!0}},{key:"initContainer",value:function(){var t,e,n=Be,r=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,i=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,o=this.canvas;o&&(o.width=r*n,o.height=i*n),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var t,e,n=Be,r=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,i=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,o=this.canvas;o.width=r*n,o.height=i*n,o.style.width="100%",o.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),o}(fr.EventEmitter),aa=(0,ki.Z)(oa.prototype,"id",[Go],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sa=(0,ki.Z)(oa.prototype,"iconService",[Vo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ua=(0,ki.Z)(oa.prototype,"fontService",[Wo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),la=(0,ki.Z)(oa.prototype,"controlService",[Ho],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ca=(0,ki.Z)(oa.prototype,"configService",[Xo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ha=(0,ki.Z)(oa.prototype,"map",[Yo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fa=(0,ki.Z)(oa.prototype,"coordinateSystemService",[qo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pa=(0,ki.Z)(oa.prototype,"rendererService",[Ko],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),da=(0,ki.Z)(oa.prototype,"layerService",[Qo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ga=(0,ki.Z)(oa.prototype,"cameraService",[Jo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),va=(0,ki.Z)(oa.prototype,"interactionService",[$o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ma=(0,ki.Z)(oa.prototype,"pickingService",[ta],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ya=(0,ki.Z)(oa.prototype,"shaderModuleService",[ea],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_a=(0,ki.Z)(oa.prototype,"markerService",[na],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ba=(0,ki.Z)(oa.prototype,"popupService",[ra],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ia=oa))||ia),Ta=n(4908),ka=n.n(Ta),Ma=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Pa(t){var e={};return t=t.replace(Ma,(function(t,n,r){var i=r.split(":"),o=i[0].trim(),a="";switch(i.length>1&&(a=i[1].trim()),n){case"bool":a="true"===a;break;case"float":case"int":a=Number(a);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":a=a?a.replace("[","").replace("]","").split(",").reduce((function(t,e){return t.push(Number(e.trim())),t}),[]):new Array(function(t){var e=0;switch(t){case"vec2":case"ivec2":e=2;break;case"vec3":case"ivec3":e=3;break;case"vec4":case"ivec4":case"mat2":e=4;break;case"mat3":e=9;break;case"mat4":e=16}return e}(n)).fill(0)}return e[o]=a,"uniform ".concat(n," ").concat(o,";\n")})),{content:t,uniforms:e}}function Ia(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Oa(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ia(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ia(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ra,La,Da="#define PI 3.14159265359",Na=/precision\s+(high|low|medium)p\s+float/,Ba=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,za=(0,Zr.b2)()(Ca=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"moduleCache",{}),(0,m.Z)(this,"rawContentCache",{})}return(0,F.Z)(t,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Da,fs:Da}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\n\nvec2 unpack_float(float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n",fs:""}),this.registerModule("projection",{vs:"#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n\n#define COORDINATE_SYSTEM_LNGLAT 1.0\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n\n#define COORDINATE_SYSTEM_P20_2 8.0\n\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrix;\nuniform float u_Zoom : 1;\nuniform float u_ZoomScale : 1;\n\nuniform float u_CoordinateSystem;\nuniform vec2 u_ViewportCenter;\nuniform vec4 u_ViewportCenterProjection;\nuniform vec3 u_PixelsPerDegree;\nuniform vec3 u_PixelsPerDegree2;\nuniform vec3 u_PixelsPerMeter;\n\nuniform vec2 u_ViewportSize;\nuniform float u_DevicePixelRatio;\nuniform float u_FocalDistance;\nuniform vec3 u_CameraPosition;\n\n// uniform mat4 u_Mvp;\n\n// web mercator coords -> world coords\nvec2 project_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\nfloat project_scale(float meters) {\n  return meters * u_PixelsPerMeter.z;\n}\n\n\n// offset coords -> world coords\nvec4 project_offset(vec4 offset) {\n  float dy = offset.y;\n  dy = clamp(dy, -1., 1.);\n  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\n  return vec4(offset.xyz * pixels_per_unit, offset.w);\n}\n\nvec3 project_normal(vec3 normal) {\n  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\n  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\n\nvec3 project_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // normals generated by the polygon tesselator are in lnglat offsets instead of meters\n    return normalize(vector * u_PixelsPerDegree);\n  }\n  return project_normal(vector);\n}\n// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01\n// reverse Y\nvec3 reverse_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\n    return vector * vec3(1.0, -1.0, 1.0);\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0\n    return vector;\n  }\n  return vector;\n}\n\nvec4 project_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    float X = position.x - u_ViewportCenter.x;\n    float Y = position.y - u_ViewportCenter.y;\n    return project_offset(vec4(X, Y, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return vec4(\n      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // return vec4(\n    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), \n    //   project_scale(position.z), \n    //   position.w);\n\n     return vec4(\n      position.xy, \n      project_scale(position.z), \n      position.w);\n  }\n  return position;\n\n  // TODO: 瓦片坐标系 & 常规世界坐标系\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\n  return offset * u_FocalDistance;\n}\n\nfloat project_pixel_allmap(float pixel) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    return pixel * pow(2.0, u_Zoom);\n  }\n  return pixel;\n}\n\n// 适配纹理贴图的等像素大小\nfloat project_pixel_texture(float pixel) {\n  // mapbox zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    return pixel * pow(0.5, u_Zoom);\n  }\n\n  // amap2 zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n  }\n\n  // amap zoom > 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return pixel * pow(0.5, u_Zoom);\n  }\n  \n  // amap zoom < 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return pixel * pow(2.0, (20.0 - u_Zoom));\n  }\n  return pixel * 2.0;\n}\n\nfloat project_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n  }\n  return pixel;\n}\nvec2 project_pixel(vec2 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n  }\n  return pixel * -1.;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    position.w *= u_PixelsPerMeter.z;\n  }\n\n  return viewProjectionMatrix * position + center;\n}\n\n// Projects from common space coordinates to clip space\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(\n    position,\n    u_ViewProjectionMatrix,\n    u_ViewportCenterProjection\n  );\n}\n\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\n  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n     pos.w = pos.w / u_PixelsPerMeter.z;\n  }\n  return pos;\n}\n\n\nbool isEqual( float a,  float b) {\n    return  a< b + 0.001 && a > b - 0.001;\n}",fs:""}),this.registerModule("project",{vs:"\n#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\n  float maxs=85.0511287798;\n  float lat=max(min(maxs,lnglat.y),-maxs);\n  float scale= 268435456.;\n  float d=PI/180.;\n  float x=lnglat.x*d;\n  float y=lat*d;\n  y=log(tan((PI/4.)+(y/2.)));\n\n  float a=.5/PI,\n  b=.5,\n  c=-.5/PI;\n  d=.5;\n  x=scale*(a*x+b);\n  y=scale*(c*y+d);\n  return vec2(x,y);\n}\n\nvec2 unProjectFlat(vec2 px){\n  float a=.5/PI;\n  float b=.5;\n  float c=-.5/PI;\n  float d=.5;\n  float scale = 268435456.;\n  float x=(px.x/scale-b)/a;\n  float y=(px.y/scale-d)/c;\n  y=(atan(pow(E,y))-(PI/4.))*2.;\n  d=PI/180.;\n  float lat=y/d;\n  float lng=x/d;\n  return vec2(lng,lat);\n}\n\nfloat pixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}\n\n// gaode2.0\nvec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标\n  float t = lnglat.x;\n  float e = lnglat.y;\n  float Sm = 180.0 / PI;\n  float Tm = 6378137.0;\n  float Rm = PI / 180.0;\n  float r = 85.0511287798;\n  e = max(min(r, e), -r);\n  t *= Rm;\n  e *= Rm;\n  e = log(tan(PI / 4.0 + e / 2.0));\n  return vec2(t * Tm, e * Tm);\n}\n\nvec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度\n  float Sm = 57.29577951308232; //180 / Math.PI\n  float Tm = 6378137.0;\n  float t = point.x;\n  float e = point.y;\n  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\n\n\nfloat customPixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}\n"}),this.registerModule("lighting",{vs:"// Blinn-Phong model\n// apply lighting in vertex shader instead of fragment shader\n// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\n\nstruct DirectionalLight {\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n};\n\nstruct SpotLight {\n  vec3 position;\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n  float constant;\n  float linear;\n  float quadratic;\n  float angle;\n  float blur;\n  float exponent;\n};\n\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\n\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\n  vec3 lightDir = normalize(light.direction);\n  // diffuse shading\n  float diff = max(dot(normal, lightDir), 0.0);\n  // Blinn-Phong specular shading\n  vec3 halfwayDir = normalize(lightDir + viewDir);\n  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\n\n  vec3 ambient = light.ambient * u_Ambient;\n  vec3 diffuse = light.diffuse * diff * u_Diffuse;\n  vec3 specular = light.specular * spec * u_Specular;\n\n  return ambient + diffuse + specular;\n}\n\n// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {\n//   vec3 lightDir = normalize(light.position - fragPos);\n//   // diffuse shading\n//   float diff = max(dot(normal, lightDir), 0.0);\n//   // specular shading\n//   vec3 reflectDir = reflect(-lightDir, normal);\n//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);\n//   // attenuation\n//   float distance = length(light.position - fragPos);\n//   float attenuation = 1.0 / (light.constant + light.linear * distance +\n//           light.quadratic * (distance * distance));\n\n//   vec3 ambient = light.ambient * u_Ambient;\n//   vec3 diffuse = light.diffuse * diff * u_Diffuse;\n//   vec3 specular = light.specular * spec * u_Specular;\n\n//   float spotEffect = dot(normalize(light.direction), -lightDir);\n//   float spotCosCutoff = cos(light.angle / 180.0 * PI);\n//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);\n//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);\n//   if (spotEffect > spotCosCutoff) {\n//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);\n//   } else {\n//     spotEffect = 0.0;\n//   }\n\n//   return ambient + attenuation * (spotEffect * diffuse + specular);\n// }\n\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\n  vec3 weight = vec3(0.0);\n  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\n    if (i >= u_NumOfDirectionalLights) {\n      break;\n    }\n    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n  }\n  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {\n  //   if (i >= u_NumOfSpotLights) {\n  //     break;\n  //   }\n  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);\n  // }\n  return weight;\n}\n",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n      // //cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(vec3(1, -10.5, 12));\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n      // //lambert\n    float lambert = dot(worldNormal, lightDir);\n        //specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n        //sum to light weight\n    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\n\n    return lightWeight;\n}\n",fs:""}),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\n\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\nuniform float u_shaderPick;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  if(u_shaderPick < 0.5) {\n    return;\n  }\n  // compares only in highlight stage\n  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\n\nfloat setPickingOrder(float z) {\n   bool selected = bool(v_PickingResult.a);\n   return selected ? z + 1. : 0.;\n}\n",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_shaderPick;\n\nuniform float u_activeMix: 0;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color, float weight) {\n  bool selected = bool(v_PickingResult.a);\n\n  if (selected) {\n    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  // TODO: 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, 1.0));\n  }\n  \n}\n\n// TODO: 优化水波点 blend additive 模式下有的拾取效果 \nvec4 filterColorAnimate(vec4 color) {\n  // TODO: 过滤多余的 shader 计算\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, color.a));\n  }\n}\n\nvec4 filterColorWithLight(vec4 color, float lightWeight) {\n  // TODO: 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, lightWeight));\n  }\n}\n\n"}),this.registerModule("styleMapping",{vs:"attribute float a_vertexId;\n\nuniform mat4 u_cellTypeLayout;      // 描述数据纹理 cell 结构的矩阵\nuniform sampler2D u_dataTexture;    // 数据纹理\n\nbool hasOpacity() { // 判断 cell 中是否存在 opacity 的数据\n  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasStrokeOpacity() { // 判断 cell 中是否存在 strokeOpacity 的数据\n  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasStrokeWidth() { // 判断 cell 中是否存在 strokeWidth 的数据\n  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasStroke() { // 判断 cell 中是否存在 stroke 的数据\n  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasOffsets() { // 判断 cell 中是否存在 offsets 的数据\n  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\nbool hasThetaOffset() { // 判断 cell 中是否存在 thetaOffset 的数据\n  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\n\n// 根据坐标位置先是计算 uv ，然后根据 uv 从数据纹理中取值\nfloat pos2value(vec2 pos, float columnWidth, float rowHeight) {\n  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;\n  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);\n  return texture2D(u_dataTexture, vec2(u, v)).r;\n}\n\n/*\n  currentRow 当前行\n  currentColumn 当前列\n  columnCount 有多少列\n  nextStep 需要计算当前 cell 后的第几个 cell （当前 cell 则 nextStep = 0）\n*/\nvec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {\n  float nextColumn = currentColumn;\n  float nextRow = currentRow;\n  if(currentColumn + nextStep <= columnCount){\n    nextColumn = currentColumn + nextStep;\n  } else {\n    nextColumn = mod(currentColumn + nextStep, columnCount); // 不会出现跨两行\n    nextRow = currentRow + 1.0;\n  }\n  return vec2(nextColumn, nextRow);\n}\n\n// 计算当前单个 cell 的大小\nfloat calCellCount() { \n  //   u_cellTypeLayout\n  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - 几行几列\n  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 表示有数据映射、0.0 表示没有\n  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset\n  //   0.0, 0.0, 0.0, 0.0\n  \n  return  u_cellTypeLayout[1][0] +        // opacity\n          u_cellTypeLayout[1][1] +        // strokeOpacity\n          u_cellTypeLayout[1][2] +        // strokeWidth\n          u_cellTypeLayout[1][3] * 4.0 +  // stroke\n          u_cellTypeLayout[2][0] * 2.0 +  // offsets\n          u_cellTypeLayout[2][1];         // thetaOffset\n}",fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:"\n// 计算 thetaOffset 和标示在 cell 中取值位置的偏移量 textureOffset\nvec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\n  if(!hasThetaOffset()) { // 数据纹理中不存在 thetaOffset 的时候取默认值（用户在 style 中传入的是常量）\n    return vec2(u_thetaOffset, textureOffset);\n  } else {\n    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);\n    return vec2(textureThetaOffset, textureOffset + 1.0);\n  }\n}\n",fs:""}),this.registerModule("styleMappingCalOpacity",{vs:"\n// 计算 opacity 和标示在 cell 中取值位置的偏移量 textureOffset\nvec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\n  if(!hasOpacity()) { // 数据纹理中不存在 opacity 的时候取默认值（用户在 style 中传入的是常量）\n    return vec2(u_opacity, textureOffset);\n  } else {\n    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);\n    return vec2(textureOpacity, textureOffset + 1.0);\n  }\n}\n",fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:"\n// 计算 strokeOpaicty 和标示在 cell 中取值位置的偏移量 textureOffset\nvec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\n  if(!hasStrokeOpacity()) {\n    return vec2(u_stroke_opacity, textureOffset);\n  } else {\n    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);\n    return vec2(textureStrokeOpacity, textureOffset + 1.0);\n  }\n}\n",fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:"\n// 计算 strokeWidth 和标示在 cell 中取值位置的偏移量 textureOffset\nvec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\n  if(!hasStrokeWidth()) {\n    return vec2(u_stroke_width, textureOffset);\n  } else {\n    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);\n    return vec2(textureStrokeWidth, textureOffset + 1.0);\n  }\n}\n",fs:""})}},{key:"registerModule",value:function(t,e){if(!this.rawContentCache[t]){var n=e.vs,r=e.fs,i=e.uniforms,o=Pa(n),a=o.content,s=o.uniforms,u=Pa(r),l=u.content,c=u.uniforms;this.rawContentCache[t]={fs:l,uniforms:Oa(Oa(Oa({},s),c),i),vs:a}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var e=this;if(this.moduleCache[t])return this.moduleCache[t];var n=this.rawContentCache[t].vs,r=this.rawContentCache[t].fs,i=this.processModule(n,[],"vs"),o=i.content,a=i.includeList,s=this.processModule(r,[],"fs"),u=s.content,l=s.includeList,c=u,h=ka()(a.concat(l).concat(t)).reduce((function(t,n){return Oa(Oa({},t),e.rawContentCache[n].uniforms)}),{});return Na.test(u)||(c="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"+u),this.moduleCache[t]={fs:c.trim(),uniforms:h,vs:o.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,e,n){var r=this;return{content:t.replace(Ba,(function(t,i){var o=i.split(" ")[0].replace(/"/g,"");if(e.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return e.push(o),r.processModule(a,e,n).content})),includeList:e}}}]),t}())||Ca;function Fa(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=(0,V.Z)(t)););return t}function Za(){return Za="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=Fa(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Za.apply(this,arguments)}!function(t){t.Normal="normal",t.PostProcessing="post-processing"}(Ra||(Ra={}));var ja,Ua=(0,Zr.b2)()(La=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"shaderModuleService",void 0),(0,m.Z)(this,"rendererService",void 0),(0,m.Z)(this,"cameraService",void 0),(0,m.Z)(this,"mapService",void 0),(0,m.Z)(this,"interactionService",void 0),(0,m.Z)(this,"layerService",void 0),(0,m.Z)(this,"config",void 0)}return(0,F.Z)(t,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Ra.Normal}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(Ur.IRendererService),this.cameraService=t.getContainer().get(Ur.ICameraService),this.mapService=t.getContainer().get(Ur.IMapService),this.interactionService=t.getContainer().get(Ur.IInteractionService),this.layerService=t.getContainer().get(Ur.ILayerService),this.shaderModuleService=t.getContainer().get(Ur.IShaderModuleService)}},{key:"render",value:function(t){}}]),t}())||La;var Ga,Va,Wa,Ha,Xa,Ya=(0,Zr.b2)()(ja=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,e){Za((0,V.Z)(i.prototype),"init",this).call(this,t,e)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),i}(Ua))||ja;function qa(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Ka(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ka(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Ka(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Qa,Ja=(Ga=(0,Zr.b2)(),Va=(0,Zr.f3)(Ur.IPostProcessor),Ga((Ha=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"passes",[]),(0,Ti.Z)(this,"postProcessor",Xa,this),(0,m.Z)(this,"layer",void 0),(0,m.Z)(this,"renderFlag",void 0),(0,m.Z)(this,"width",0),(0,m.Z)(this,"height",0)}var e;return(0,F.Z)(t,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(e=(0,lo.Z)(ho().mark((function t(){var e,n,r;return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=qa(this.passes),t.prev=1,e.s();case 3:if((n=e.n()).done){t.next=9;break}return r=n.value,t.next=7,r.render(this.layer);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),e.e(t.t0);case 14:return t.prev=14,e.f(),t.finish(14);case 17:this.layer.renderModels();case 18:case"end":return t.stop()}}),t,this,[[1,11,14,17]])}))),function(){return e.apply(this,arguments)})},{key:"resize",value:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e)}},{key:"add",value:function(t,e){t.getType()===Ra.PostProcessing?this.postProcessor.add(t,this.layer,e):(t.init(this.layer,e),this.passes.push(t))}},{key:"insert",value:function(t,e,n){t.init(this.layer,e),this.passes.splice(n,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),t}(),Xa=(0,ki.Z)(Ha.prototype,"postProcessor",[Va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wa=Ha))||Wa);function $a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ts(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$a(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var es,ns=(0,Zr.b2)()(Qa=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"pickingFBO",void 0),(0,m.Z)((0,H.Z)(t),"layer",void 0),(0,m.Z)((0,H.Z)(t),"width",0),(0,m.Z)((0,H.Z)(t),"height",0),(0,m.Z)((0,H.Z)(t),"alreadyInRendering",!1),(0,m.Z)((0,H.Z)(t),"pickFromPickingFBO",(function(e){var n=e.x,r=e.y,i=e.lngLat,o=e.type;if(t.layer.isVisible()&&t.layer.needPick(o)){var a,s=t.rendererService,u=s.getViewportSize,l=s.readPixels,c=s.useFramebuffer,h=u(),f=h.width,p=h.height,d=t.layer.getLayerConfig(),g=d.enableHighlight,v=d.enableSelect,m=n*Be,y=r*Be;m>f||m<0||y>p||y<0||c(t.pickingFBO,(function(){var e;if(0!==(a=l({x:Math.round(m),y:Math.round(p-(r+1)*Be),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO}))[0]||0!==a[1]||0!==a[2]){var s=yn(a),u=t.layer.getSource().getFeatureById(s),c={x:n,y:r,type:o,lngLat:i,featureId:s,feature:u};u&&(t.layer.setCurrentPickId(s),t.triggerHoverOnLayer(c))}else{var h={x:n,y:r,lngLat:i,type:null===t.layer.getCurrentPickId()?"un"+o:"mouseout",featureId:null,feature:null};t.triggerHoverOnLayer(ts(ts({},h),{},{type:"unpick"})),t.triggerHoverOnLayer(h),t.layer.setCurrentPickId(null)}g&&t.highlightPickedFeature(a),v&&"click"===o&&(null===(e=a)||void 0===e?void 0:e.toString())!==[0,0,0,0].toString()&&t.selectFeature(a)}))}})),t}return(0,F.Z)(i,[{key:"getType",value:function(){return Ra.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,e){Za((0,V.Z)(i.prototype),"init",this).call(this,t,e),this.layer=t;var n=this.rendererService,r=n.createTexture2D,o=n.createFramebuffer,a=(0,n.getViewportSize)(),s=a.width,u=a.height;this.pickingFBO=o({color:r({width:s,height:u,wrapS:qi.CLAMP_TO_EDGE,wrapT:qi.CLAMP_TO_EDGE})}),this.interactionService.on(zi.Hover,this.pickFromPickingFBO),this.interactionService.on(zi.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(zi.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var e=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){o({framebuffer:e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=e.layer.multiPassRenderer.getRenderFlag();e.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),e.layer.multiPassRenderer.setRenderFlag(n),e.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var e=(0,R.Z)(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var e=(0,R.Z)(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var e=_n(t.featureId);this.selectFeature(new Uint8Array(e))}},{key:"highlightFeatureHandle",value:function(t){var e=_n(t.featureId);this.highlightPickedFeature(new Uint8Array(e))}}]),i}(Ua))||Qa,rs=n(1700),is=n.n(rs),os=n(8929),as=n.n(os);function ss(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function us(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ss(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ss(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ls,cs=(0,Zr.b2)()(es=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"shaderModuleService",void 0),(0,m.Z)(this,"rendererService",void 0),(0,m.Z)(this,"config",void 0),(0,m.Z)(this,"quad","attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}"),(0,m.Z)(this,"enabled",!0),(0,m.Z)(this,"renderToScreen",!1),(0,m.Z)(this,"model",void 0),(0,m.Z)(this,"name",void 0),(0,m.Z)(this,"optionsToUpdate",{})}return(0,F.Z)(t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return Ra.PostProcessing}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(Ur.IRendererService),this.shaderModuleService=t.getContainer().get(Ur.IShaderModuleService);var n=this.rendererService,r=n.createAttribute,i=n.createBuffer,o=n.createModel,a=this.setupShaders(),s=a.vs,u=a.fs,l=a.uniforms;this.model=o({vs:s,fs:u,attributes:{a_Position:r({buffer:i({data:[-4,-4,4,-4,0,4],type:qi.FLOAT}),size:2})},uniforms:us(us({u_Texture:null},l),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(t){var e=this,n=t.multiPassRenderer.getPostProcessor(),r=this.rendererService,i=r.useFramebuffer,o=r.getViewportSize,a=r.clear,s=o(),u=s.width,l=s.height;i(this.renderToScreen?null:n.getWriteFBO(),(function(){a({framebuffer:n.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),e.model.draw({uniforms:us({u_Texture:n.getReadFBO(),u_ViewportSize:[u,l]},e.convertOptionsToUniforms(e.optionsToUpdate))})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=us(us({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var e={};return Object.keys(t).forEach((function(n){Bo()(t[n])||(e["u_".concat(is()(as()(n)))]=t[n])})),e}}]),t}())||es;function hs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function fs(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?hs(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hs(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ps,ds=(0,Zr.b2)()(ls=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:fs(fs({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return Bo()(t.blurRadius)||(e.u_BlurDir=[t.blurRadius,0]),e}}]),i}(cs))||ls;function gs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function vs(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?gs(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gs(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ms,ys=(0,Zr.b2)()(ps=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:vs(vs({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return Bo()(t.blurRadius)||(e.u_BlurDir=[0,t.blurRadius]),e}}]),i}(cs))||ps;function _s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function bs(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_s(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var xs,ws=(0,Zr.b2)()(ms=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:'varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n\n#pragma include "common"\n\nfloat scale = PI / u_Size;\n\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\n  float s = sin(u_Angle), c = cos(u_Angle);\n  vec2 tex = texCoord * texSize - u_Center * texSize;\n  vec2 point = vec2(\n    c * tex.x - s * tex.y,\n    s * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  vec3 cmy = 1.0 - color.rgb;\n  float k = min(cmy.x, min(cmy.y, cmy.z));\n  cmy = (cmy - k) / (1.0 - k);\n  cmy = clamp(\n    cmy * 10.0 - 3.0 + vec3(\n      pattern(u_Angle + 0.26179, texSize, texCoord),\n      pattern(u_Angle + 1.30899, texSize, texCoord),\n      pattern(u_Angle, texSize, texCoord)\n    ),\n    0.0,\n    1.0\n  );\n  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\n  return vec4(1.0 - cmy - k, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var t=this.shaderModuleService.getModule("colorhalftone-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:bs(bs({},r),{},{u_ViewportSize:[o,a]})}}}]),i}(cs))||ms;var Es,Ss=(0,Zr.b2)()(xs=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}"}),this.shaderModuleService.getModule("copy-pass")}}]),i}(cs))||xs;function Cs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function As(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Cs(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Cs(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ts,ks=(0,Zr.b2)()(Es=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\n  tex.y /= 0.866025404;\n  tex.x -= tex.y * 0.5;\n  vec2 a;\n  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n    a = vec2(floor(tex.x), floor(tex.y));\n  }\n  else a = vec2(ceil(tex.x), ceil(tex.y));\n  vec2 b = vec2(ceil(tex.x), floor(tex.y));\n  vec2 c = vec2(floor(tex.x), ceil(tex.y));\n  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\n  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\n  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\n  float alen = length(TEX - A);\n  float blen = length(TEX - B);\n  float clen = length(TEX - C);\n  vec2 choice;\n  if (alen < blen) {\n    if (alen < clen) choice = a;\n    else choice = c;\n  } else {\n    if (blen < clen) choice = b;\n    else choice = c;\n  }\n  choice.x += choice.y * 0.5;\n  choice.y *= 0.866025404;\n  choice *= u_Scale / texSize;\n  return texture2D(texture, choice + u_Center);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:As(As({},r),{},{u_ViewportSize:[o,a]})}}}]),i}(cs))||Es;function Ms(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ps(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ms(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ms(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Is,Os=(0,Zr.b2)()(Ts=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\n\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 dx = vec2(1.0 / texSize.x, 0.0);\n  vec2 dy = vec2(0.0, 1.0 / texSize.y);\n  vec4 color = texture2D(texture, texCoord);\n  float bigTotal = 0.0;\n  float smallTotal = 0.0;\n  vec3 bigAverage = vec3(0.0);\n  vec3 smallAverage = vec3(0.0);\n  for (float x = -2.0; x <= 2.0; x += 1.0) {\n    for (float y = -2.0; y <= 2.0; y += 1.0) {\n      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\n      bigAverage += sample;\n      bigTotal += 1.0;\n      if (abs(x) + abs(y) < 2.0) {\n        smallAverage += sample;\n        smallTotal += 1.0;\n      }\n    }\n  }\n  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\n  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\n  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var t=this.shaderModuleService.getModule("ink-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:Ps(Ps({},r),{},{u_ViewportSize:[o,a]})}}}]),i}(cs))||Ts;var Rs,Ls=(0,Zr.b2)()(Is=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\n\nfloat rand(vec2 co) {\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\n  float diff = (rand(texCoord) - 0.5) * u_Amount;\n  color.r += diff;\n  color.g += diff;\n  color.b += diff;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),i}(cs))||Is;var Ds,Ns,Bs,zs,Fs,Zs,js,Us=(0,Zr.b2)()(Rs=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform float u_Amount : 0.5;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js\nvec4 sepia_filterColor(vec4 color) {\n  float r = color.r;\n  float g = color.g;\n  float b = color.b;\n  color.r =\n    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\n  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\n  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),i}(cs))||Rs,Gs=(Ds=(0,Zr.b2)(),Ns=(0,Zr.f3)(Ur.IRendererService),Bs=(0,Zr.zY)(),Ds((Fs=function(){function t(){(0,z.Z)(this,t),(0,Ti.Z)(this,"rendererService",Zs,this),(0,m.Z)(this,"passes",[]),(0,m.Z)(this,"readFBO",void 0),(0,m.Z)(this,"writeFBO",void 0)}var e;return(0,F.Z)(t,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:(e=(0,lo.Z)(ho().mark((function t(e){var n,r;return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<this.passes.length)){t.next=10;break}return(r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),t.next=6,r.render(e);case 6:n!==this.passes.length-1&&this.swap();case 7:n++,t.next=1;break;case 10:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"resize",value:function(t,e){this.readFBO.resize({width:t,height:e}),this.writeFBO.resize({width:t,height:e})}},{key:"add",value:function(t,e,n){t.init(e,n),this.passes.push(t)}},{key:"insert",value:function(t,e,n,r){t.init(n,r),this.passes.splice(e,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find((function(e){return e.getName()===t}))}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),t}(),Zs=(0,ki.Z)(Fs.prototype,"rendererService",[Ns],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,ki.Z)(Fs.prototype,"init",[Bs],Object.getOwnPropertyDescriptor(Fs.prototype,"init"),Fs.prototype),zs=Fs))||zs);var Vs,Ws,Hs,Xs,Ys,qs=(0,Zr.b2)()(js=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getType",value:function(){return Ra.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,e){Za((0,V.Z)(i.prototype),"init",this).call(this,t,e)}},{key:"render",value:function(t){var e=this.rendererService,n=e.useFramebuffer,r=e.clear;n(null,(function(){r({color:[0,0,0,0],depth:1,stencil:0}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)}))}}]),i}(Ua))||js;function Ks(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Qs(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ks(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ks(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Js="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}";function $s(t,e){for(var n=0,r=1/e,i=t;i>0;)n+=r*(i%e),i=Math.floor(i/e),r/=e;return n}var tu=1,eu=(Vs=(0,Zr.b2)(),Ws=(0,Zr.f3)(Ur.IShaderModuleService),Vs((Xs=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,Ti.Z)((0,H.Z)(t),"shaderModuleService",Ys,(0,H.Z)(t)),(0,m.Z)((0,H.Z)(t),"haltonSequence",[]),(0,m.Z)((0,H.Z)(t),"accumulatingId",0),(0,m.Z)((0,H.Z)(t),"frame",0),(0,m.Z)((0,H.Z)(t),"timer",void 0),(0,m.Z)((0,H.Z)(t),"sampleRenderTarget",void 0),(0,m.Z)((0,H.Z)(t),"prevRenderTarget",void 0),(0,m.Z)((0,H.Z)(t),"outputRenderTarget",void 0),(0,m.Z)((0,H.Z)(t),"copyRenderTarget",void 0),(0,m.Z)((0,H.Z)(t),"blendModel",void 0),(0,m.Z)((0,H.Z)(t),"outputModel",void 0),(0,m.Z)((0,H.Z)(t),"copyModel",void 0),t}return(0,F.Z)(i,[{key:"getType",value:function(){return Ra.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,e){Za((0,V.Z)(i.prototype),"init",this).call(this,t,e);var n=this.rendererService,r=n.createFramebuffer,o=n.createTexture2D;this.sampleRenderTarget=r({color:o({width:1,height:1,wrapS:qi.CLAMP_TO_EDGE,wrapT:qi.CLAMP_TO_EDGE})}),this.prevRenderTarget=r({color:o({width:1,height:1,wrapS:qi.CLAMP_TO_EDGE,wrapT:qi.CLAMP_TO_EDGE})}),this.outputRenderTarget=r({color:o({width:1,height:1,wrapS:qi.CLAMP_TO_EDGE,wrapT:qi.CLAMP_TO_EDGE})}),this.copyRenderTarget=r({color:o({width:1,height:1,wrapS:qi.CLAMP_TO_EDGE,wrapT:qi.CLAMP_TO_EDGE})});for(var a=0;a<30;a++)this.haltonSequence.push([$s(a,2),$s(a,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\n\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  vec4 texel1 = texture2D(u_Diffuse1, v_UV);\n  vec4 texel2 = texture2D(u_Diffuse2, v_UV);\n  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}\n"),this.outputModel=this.createTriangleModel("copy-pass",Js,{blend:{enable:!0,func:{srcRGB:qi.ONE,dstRGB:qi.ONE_MINUS_SRC_ALPHA,srcAlpha:qi.ONE,dstAlpha:qi.ONE_MINUS_SRC_ALPHA},equation:{rgb:qi.FUNC_ADD,alpha:qi.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Js)}},{key:"render",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var l=t.multiPassRenderer.getPostProcessor().getReadFBO();o(l,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)}));var c=function n(r){e.accumulatingId&&r===e.accumulatingId&&(e.isFinished()||(e.doRender(t),ye.requestAnimationFrame((function(){n(r)}))))};this.accumulatingId=tu++,this.timer=ye.setTimeout((function(){c(e.accumulatingId)}),50)}},{key:"doRender",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height,l=t.getLayerConfig().jitterScale,c=void 0===l?1:l,h=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*h[0]-1)/s*c,(2*h[1]-1)/u*c),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),o(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.sampleRenderTarget}),t.render()})),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var f=t.getLayerConfig();o(this.outputRenderTarget,(function(){e.blendModel.draw({uniforms:{u_opacity:f.opacity||1,u_MixRatio:0===e.frame?1:.9,u_Diffuse1:e.sampleRenderTarget,u_Diffuse2:0===e.frame?t.multiPassRenderer.getPostProcessor().getReadFBO():e.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,(function(){e.outputModel.draw({uniforms:{u_Texture:e.outputRenderTarget}})})),o(t.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){e.copyModel.draw({uniforms:{u_Texture:e.copyRenderTarget}})})),t.multiPassRenderer.getPostProcessor().render(t));var p=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=p,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ye.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,e,n){this.shaderModuleService.registerModule(t,{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:e});var r=this.shaderModuleService.getModule(t),i=r.vs,o=r.fs,a=r.uniforms,s=this.rendererService,u=s.createAttribute,l=s.createBuffer;return(0,s.createModel)(Qs({vs:i,fs:o,attributes:{a_Position:u({buffer:l({data:[-4,-4,4,-4,0,4],type:qi.FLOAT}),size:2})},uniforms:Qs({},a),depth:{enable:!1},count:3},n))}}]),i}(Ua),Ys=(0,ki.Z)(Xs.prototype,"shaderModuleService",[Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hs=Xs))||Hs),nu=new Zr.W2;nu.bind(Ur.IGlobalConfigService).to(Ai).inSingletonScope(),(0,Zr.GW)((0,Zr.b2)(),fr.EventEmitter),nu.bind(Ur.IEventEmitter).to(fr.EventEmitter);var ru=(0,jr.Z)(nu,!1),iu=function(t){var e=ru.lazyInject(t);return function(t,n,r){e.call(this,t,n),r&&(r.initializer=function(){return t[n]})}},ou=function(t){var e=ru.lazyMultiInject(t);return function(t,n,r){e.call(this,t,n),r&&(r.initializer=function(){return t[n]})}};const au=nu;var su=0;function uu(){var t=new Zr.W2;return t.parent=nu,t.bind(Ur.SceneID).toConstantValue("".concat(su++)),t.bind(Ur.IShaderModuleService).to(za).inSingletonScope(),t.bind(Ur.ILayerService).to(ko).inSingletonScope(),t.bind(Ur.ISceneService).to(Aa).inSingletonScope(),t.bind(Ur.ICameraService).to(ci).inSingletonScope(),t.bind(Ur.ICoordinateSystemService).to(Hi).inSingletonScope(),t.bind(Ur.IInteractionService).to(uo).inSingletonScope(),t.bind(Ur.IPickingService).to(Ao).inSingletonScope(),t.bind(Ur.IControlService).to(di).inSingletonScope(),t.bind(Ur.IMarkerService).to(gi).inSingletonScope(),t.bind(Ur.IIconService).to(ui).inSingletonScope(),t.bind(Ur.IFontService).to(oi).inSingletonScope(),t.bind(Ur.IPopupService).to(vi).inSingletonScope(),t.bind(Ur.INormalPass).to(Ya).whenTargetNamed("clear"),t.bind(Ur.INormalPass).to(ns).whenTargetNamed("pixelPicking"),t.bind(Ur.INormalPass).to(qs).whenTargetNamed("render"),t.bind(Ur.INormalPass).to(eu).whenTargetNamed("taa"),t.bind(Ur.IFactoryNormalPass).toFactory((function(t){return function(e){return t.container.getNamed(Ur.INormalPass,e)}})),t.bind(Ur.IPostProcessingPass).to(Ss).whenTargetNamed("copy"),t.bind(Ur.IPostProcessingPass).to(ds).whenTargetNamed("blurH"),t.bind(Ur.IPostProcessingPass).to(ys).whenTargetNamed("blurV"),t.bind(Ur.IPostProcessingPass).to(Ls).whenTargetNamed("noise"),t.bind(Ur.IPostProcessingPass).to(Us).whenTargetNamed("sepia"),t.bind(Ur.IPostProcessingPass).to(ws).whenTargetNamed("colorHalftone"),t.bind(Ur.IPostProcessingPass).to(ks).whenTargetNamed("hexagonalPixelate"),t.bind(Ur.IPostProcessingPass).to(Os).whenTargetNamed("ink"),t.bind(Ur.IFactoryPostProcessingPass).toFactory((function(t){return function(e){var n=t.container.getNamed(Ur.IPostProcessingPass,e);return n.setName(e),n}})),t}function lu(t){var e=new Zr.W2;return e.parent=t,e.bind(Ur.IStyleAttributeService).to(wa).inSingletonScope(),e.bind(Ur.IMultiPassRenderer).to(Ja).inSingletonScope(),e.bind(Ur.IPostProcessor).to(Gs).inSingletonScope(),e}var cu=n(4691),hu=n.n(cu),fu=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function pu(t){return fu.indexOf(t)}var du,gu,vu,mu;function yu(t,e){return 256*(t=hu()(Math.floor(t),0,255))+hu()(Math.floor(e),0,255)}function _u(t){var e=t.color,n=t.radius,r=t.tileX,i=t.tileY,o=t.shape,a=t.opacity,s=t.stroke,u=t.strokeWidth,l=t.strokeOpacity,c=[],h=[],f=[],p=[yu(e[0],e[1]),yu(e[2],e[3])],d=[yu(s[0],s[1]),yu(s[2],s[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(t){var e=(0,R.Z)(t,2),s=e[0],g=e[1];c.push([].concat(p,[8388608*(s+1)+2097152*(g+1)+131072*pu(o)+n,524288*(r+512)+64*(i+512)])),h.push([].concat(d,[u,l])),f.push([a,0,0,0])})),{packedBuffer:c,packedBuffer2:h,packedBuffer3:f}}!function(t){t.normal="normal",t.additive="additive",t.subtractive="subtractive",t.min="min",t.max="max",t.none="none"}(du||(du={})),function(t){t.LINEAR="linear",t.POWER="power",t.LOG="log",t.IDENTITY="identity",t.TIME="time",t.QUANTILE="quantile",t.QUANTIZE="quantize",t.THRESHOLD="threshold",t.CAT="cat"}(gu||(gu={})),function(t){t.CONSTANT="constant",t.VARIABLE="variable"}(vu||(vu={})),function(t){t[t.Attribute=0]="Attribute",t[t.InstancedAttribute=1]="InstancedAttribute",t[t.Uniform=2]="Uniform"}(mu||(mu={}));var bu,xu=["mapload","mapchange"],wu={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Eu=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];function Su(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Cu(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Su(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Su(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}!function(t){t.TOPRIGHT="topright",t.TOPLEFT="topleft",t.BOTTOMRIGHT="bottomright",t.BOTTOMLEFT="bottomleft",t.TOPCENTER="topcenter",t.BOTTOMCENTER="bottomcenter",t.LEFTCENTER="leftcenter",t.RIGHTCENTER="rightcenter"}(bu||(bu={}));var Au=0,Tu=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){var e;return(0,z.Z)(this,i),e=r.call(this),(0,m.Z)((0,H.Z)(e),"controlOption",void 0),(0,m.Z)((0,H.Z)(e),"container",void 0),(0,m.Z)((0,H.Z)(e),"sceneContainer",void 0),(0,m.Z)((0,H.Z)(e),"mapsService",void 0),(0,m.Z)((0,H.Z)(e),"renderService",void 0),(0,m.Z)((0,H.Z)(e),"layerService",void 0),(0,m.Z)((0,H.Z)(e),"controlService",void 0),(0,m.Z)((0,H.Z)(e),"isShow",void 0),e.controlOption=Cu(Cu({},e.getDefault()),t||{}),e}return(0,F.Z)(i,[{key:"getDefault",value:function(){return{position:bu.TOPRIGHT,name:"".concat(Au++)}}},{key:"setPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bu.BOTTOMRIGHT,e=this.controlService;return e&&e.removeControl(this),this.controlOption.position=t,e&&e.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(t){this.mapsService=t.get(Ur.IMapService),this.renderService=t.get(Ur.IRendererService),this.layerService=t.get(Ur.ILayerService),this.controlService=t.get(Ur.IControlService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd();var e=this.container,n=this.controlOption.position,r=this.controlService.controlCorners[n];return Ae(e,"l7-control"),-1!==n.indexOf("bottom")?r.insertBefore(e,r.firstChild):r.appendChild(e),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){Ae(this.container,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){Te(this.container,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Ce(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var e=this.mapsService.getContainer();null!==e&&e.focus()}}}]),i}(fr.EventEmitter);var ku=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){var e;return(0,z.Z)(this,i),e=r.call(this,t),(0,m.Z)((0,H.Z)(e),"layerControlInputs",void 0),(0,m.Z)((0,H.Z)(e),"layers",void 0),(0,m.Z)((0,H.Z)(e),"lastZIndex",void 0),(0,m.Z)((0,H.Z)(e),"handlingClick",void 0),(0,m.Z)((0,H.Z)(e),"layersLink",void 0),(0,m.Z)((0,H.Z)(e),"baseLayersList",void 0),(0,m.Z)((0,H.Z)(e),"separator",void 0),(0,m.Z)((0,H.Z)(e),"overlaysList",void 0),(0,m.Z)((0,H.Z)(e),"form",void 0),e.layerControlInputs=[],e.layers=[],e.lastZIndex=0,e.handlingClick=!1,e.initLayers(),fn(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,H.Z)(e)),e}return(0,F.Z)(i,[{key:"getDefault",value:function(){return{collapsed:!0,position:bu.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var t=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach((function(e){e.layer.on("remove",t.onLayerChange),e.layer.on("add",t.onLayerChange)})),this.container}},{key:"addVisualLayer",value:function(t,e){return this.addLayer(t,e,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var t=this.renderService.getViewportSize().height;Ae(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var e=t-(this.container.offsetTop+50);return e<this.form.clientHeight?(Ae(this.form,"l7-control-layers-scrollbar"),this.form.style.height=e+"px"):Te(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Te(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var t=this;this.mapsService&&(this.mapsService.off("click",this.collapse),this.layers.forEach((function(e){e.layer.off("remove",t.onLayerChange),e.layer.off("add",t.onLayerChange)})))}},{key:"initLayout",value:function(){var t="l7-control-layers",e=this.container=Se("div",t),n=this.controlOption.collapsed;e.setAttribute("aria-haspopup","true");var r=this.form=Se("form",t+"-list");n&&(this.mapsService.on("click",this.collapse),e.addEventListener("mouseenter",this.expand),e.addEventListener("mouseleave",this.collapse)),this.layersLink=Se("a",t+"-toggle",e),this.layersLink.title="Layers",n||this.expand(),this.baseLayersList=Se("div",t+"-base",r),this.separator=Se("div",t+"-separator",r),this.overlaysList=Se("div",t+"-overlays",r),e.appendChild(r)}},{key:"initLayers",value:function(){var t=this,e=this.controlOption,n=e.baseLayers,r=void 0===n?{}:n,i=e.overlayers,o=void 0===i?{}:i;Object.keys(r).forEach((function(e,n){t.addLayer(r[e],e,!1)})),Object.keys(o).forEach((function(e,n){t.addLayer(o[e],e,!0)}))}},{key:"update",value:function(){if(!this.container)return this;var t,e,n,r;Ie(this.baseLayersList),Ie(this.overlaysList),this.layerControlInputs=[];var i=0;for(n=0;n<this.layers.length;n++)r=this.layers[n],this.addItem(r),e=e||r.overlay,t=t||!r.overlay,i+=r.overlay?0:1;return this.controlOption.hideSingleBase&&(t=t&&i>1,this.baseLayersList.style.display=t?"":"none"),this.separator.style.display=e&&t?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var t,e,n=this.layerControlInputs,r=this.mapsService.getZoom(),i=n.length-1;i>=0;i--)if(t=n[i],(e=this.layerService.getLayer(t.layerId))&&e.inited){var o=e.getMinZoom(),a=e.getMaxZoom();t.disabled=r<o||r>a}}},{key:"addLayer",value:function(t,e,n){this.mapsService&&(t.on("add",this.onLayerChange),t.on("remove",this.onLayerChange)),this.layers.push({layer:t,name:e,overlay:n});var r=this.controlOption,i=r.sortLayers,o=r.sortFunction,a=r.autoZIndex;i&&this.layers.sort((function(t,e){return o(t.layer,e.layer,t.name,e.name)})),a&&t.setZIndex&&(this.lastZIndex++,t.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(t){this.handlingClick||this.update();var e=this.layerService.getLayer(t.target.layerId),n=null!=e&&e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;n&&this.emit(n,e)}},{key:"createRadioElement",value:function(t,e){var n='<input type="radio" class="l7-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=n,r.firstChild}},{key:"addItem",value:function(t){var e,n=document.createElement("label"),r=this.layerService.getLayer(t.layer.id),i=r&&r.inited&&t.layer.isVisible();t.overlay?((e=document.createElement("input")).type="checkbox",e.className="l7-control-layers-selector",e.defaultChecked=i):e=this.createRadioElement("l7-base-layers",i),this.layerControlInputs.push(e),e.layerId=t.layer.id,e.addEventListener("click",this.onInputClick);var o=document.createElement("span");o.innerHTML=" "+t.name;var a=document.createElement("div");return n.appendChild(a),a.appendChild(e),a.appendChild(o),(t.overlay?this.overlaysList:this.baseLayersList).appendChild(n),this.checkDisabledLayers(),n}},{key:"onInputClick",value:function(){var t,e,n=this.layerControlInputs,r=[],i=[];this.handlingClick=!0;for(var o=n.length-1;o>=0;o--)t=n[o],e=this.layerService.getLayer(t.layerId),t.checked?r.push(e):t.checked||i.push(e);i.forEach((function(t){t.hide()})),r.forEach((function(t){t.show()})),this.handlingClick=!1}}]),i}(Tu);var Mu=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getDefault",value:function(){return{position:bu.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var t=Se("div","l7-control-logo"),e=Se("a","l7-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://antv.alipay.com/l7",e.setAttribute("aria-label","AntV logo"),e.setAttribute("rel","noopener nofollow"),t.appendChild(e),t}},{key:"onRemove",value:function(){return null}}]),i}(Tu);var Pu=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){var e;return(0,z.Z)(this,i),e=r.call(this,t),(0,m.Z)((0,H.Z)(e),"mScale",void 0),(0,m.Z)((0,H.Z)(e),"iScale",void 0),fn(["update"],(0,H.Z)(e)),e}return(0,F.Z)(i,[{key:"getDefault",value:function(){return{position:bu.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var t="l7-control-scale",e=Se("div",t);this.addScales(t+"-line",e);var n=this.controlOption.updateWhenIdle;return this.mapsService.on(n?"moveend":"mapmove",this.update),this.mapsService.on(n?"zoomend":"zoomchange",this.update),this.update(),e}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var t=this.mapsService,e=this.controlOption.maxWidth,n=t.getSize()[1]/2,r=t.containerToLngLat([0,n]),i=t.containerToLngLat([e,n]),o=an([r.lng,r.lat],[i.lng,i.lat]);this.updateScales(o)}},{key:"updateScales",value:function(t){var e=this.controlOption,n=e.metric,r=e.imperial;n&&t&&this.updateMetric(t),r&&t&&this.updateImperial(t)}},{key:"updateMetric",value:function(t){var e=this.getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this.updateScale(this.mScale,n,e/t)}},{key:"updateImperial",value:function(t){var e,n,r,i=3.2808399*t;i>5280?(e=i/5280,n=this.getRoundNum(e),this.updateScale(this.iScale,n+" mi",n/e)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}},{key:"updateScale",value:function(t,e,n){var r=this.controlOption.maxWidth;t.style.width=Math.round(r*n)+"px",t.innerHTML=e}},{key:"getRoundNum",value:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"addScales",value:function(t,e){var n=this.controlOption,r=n.metric,i=n.imperial;r&&(this.mScale=Se("div",t,e)),i&&(this.iScale=Se("div",t,e))}}]),i}(Tu);var Iu=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){var e;return(0,z.Z)(this,i),e=r.call(this,t),(0,m.Z)((0,H.Z)(e),"disabled",void 0),(0,m.Z)((0,H.Z)(e),"zoomInButton",void 0),(0,m.Z)((0,H.Z)(e),"zoomOutButton",void 0),fn(["updateDisabled","zoomIn","zoomOut"],(0,H.Z)(e)),e}return(0,F.Z)(i,[{key:"getDefault",value:function(){return{position:bu.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var t="l7-control-zoom",e=Se("div",t+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,t+"-in",e,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,t+"-out",e,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(t,e,n,r,i){var o=Se("a",n,r);return o.innerHTML=t,o.title=e,o.href="javascript:void(0)",o.addEventListener("click",i),o}},{key:"updateDisabled",value:function(){var t=this.mapsService,e="l7-disabled";Te(this.zoomInButton,e),Te(this.zoomOutButton,e),(this.disabled||t.getZoom()<=t.getMinZoom())&&Ae(this.zoomOutButton,e),(this.disabled||t.getZoom()>=t.getMaxZoom())&&Ae(this.zoomInButton,e)}}]),i}(Tu);function Ou(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ru(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ou(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ou(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Lu=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){var e;return(0,z.Z)(this,i),e=r.call(this),(0,m.Z)((0,H.Z)(e),"markerOption",void 0),(0,m.Z)((0,H.Z)(e),"defaultMarker",void 0),(0,m.Z)((0,H.Z)(e),"popup",void 0),(0,m.Z)((0,H.Z)(e),"mapsService",void 0),(0,m.Z)((0,H.Z)(e),"sceneSerive",void 0),(0,m.Z)((0,H.Z)(e),"lngLat",void 0),(0,m.Z)((0,H.Z)(e),"scene",void 0),(0,m.Z)((0,H.Z)(e),"added",!1),(0,m.Z)((0,H.Z)(e),"eventHandle",(function(t){e.emit(t.type,{target:t,data:e.markerOption.extData,lngLat:e.lngLat})})),e.markerOption=Ru(Ru({},e.getDefault()),t),fn(["update","onMove","onUp","addDragHandler","onMapClick"],(0,H.Z)(e)),e.init(),e}return(0,F.Z)(i,[{key:"getDefault",value:function(){return{element:void 0,anchor:pn.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(Ur.IMapService),this.sceneSerive=t.get(Ur.ISceneService);var e=this.markerOption,n=e.element;return e.draggable,this.mapsService.getMarkerContainer().appendChild(n),this.registerMarkerEvent(n),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&Ce(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var e=this;if(!this.added)return this.once("added",(function(){e.setElement(t)})),this;var n=this.markerOption.element;return n&&Ce(n),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",(function(){t.openPopup()})),this;var e=this.popup;return e?(e.isOpen()||e.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",(function(){t.closePopup()}));var e=this.popup;return e&&e.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;return t?(t.isOpen()?t.remove():t.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(this.mapsService){var t=this.markerOption,e=t.element,n=t.anchor;this.updatePosition(),Re(e,"".concat(xn[n]))}}},{key:"onMapClick",value:function(t){var e=this.markerOption.element;this.popup&&e&&this.togglePopup()}},{key:"updatePosition",value:function(){if(this.mapsService){var t=this.markerOption,e=t.element,n=t.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.getBounds(),s=this.mapsService.lngLatToContainer([i,o]);if(e){e.style.display="block",e.style.whiteSpace="nowrap";var u=this.mapsService.getContainer(),l=0,c=0;if(u&&(l=u.scrollWidth,c=u.scrollHeight),Math.abs(a[0][0])>180||Math.abs(a[1][0])>180){if(s.x>l){var h=this.mapsService.lngLatToContainer([i-360,o]);s.x=h.x}if(s.x<0){var f=this.mapsService.lngLatToContainer([i+360,o]);s.x=f.x}}(s.x>l||s.x<0||s.y>c||s.y<0)&&(e.style.display="none"),e.style.left=s.x+n[0]+"px",e.style.top=s.y-n[1]+"px"}}}},{key:"init",value:function(){var t=this,e=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!e){this.defaultMarker=!0,e=Se("div"),this.markerOption.element=e;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),e.appendChild(o)}Ae(e,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,o=(null===(r=t.markerOption)||void 0===r?void 0:r.style)&&(null===(i=t.markerOption)||void 0===i?void 0:i.style[n]);e&&(e.style[n]=o)})),e.addEventListener("click",(function(e){t.onMapClick(e)})),e.addEventListener("click",this.eventHandle),wn(e,i,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(t){throw new Error("Method not implemented.")}},{key:"onUp",value:function(t){throw new Error("Method not implemented.")}}]),i}(fr.EventEmitter);function Du(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Nu(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Du(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Du(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Bu=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){var e,n;return(0,z.Z)(this,i),n=r.call(this),(0,m.Z)((0,H.Z)(n),"markers",[]),(0,m.Z)((0,H.Z)(n),"markerLayerOption",void 0),(0,m.Z)((0,H.Z)(n),"clusterIndex",void 0),(0,m.Z)((0,H.Z)(n),"points",[]),(0,m.Z)((0,H.Z)(n),"clusterMarkers",[]),(0,m.Z)((0,H.Z)(n),"mapsService",void 0),(0,m.Z)((0,H.Z)(n),"scene",void 0),(0,m.Z)((0,H.Z)(n),"zoom",void 0),(0,m.Z)((0,H.Z)(n),"bbox",void 0),n.markerLayerOption=yi()(n.getDefault(),t),fn(["update"],(0,H.Z)(n)),n.zoom=(null===(e=n.markerLayerOption.clusterOption)||void 0===e?void 0:e.zoom)||-99,n}return(0,F.Z)(i,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(t){return this.scene=t,this.mapsService=t.get(Ur.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(t){this.markerLayerOption.cluster&&this.addPoint(t,this.markers.length),this.markers.push(t)}},{key:"removeMarker",value:function(t){this.markers.indexOf(t);var e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}},{key:"hide",value:function(){this.markers.map((function(t){t.getElement().style.opacity="0"})),this.clusterMarkers.map((function(t){t.getElement().style.opacity="0"}))}},{key:"show",value:function(){this.markers.map((function(t){t.getElement().style.opacity="1"})),this.clusterMarkers.map((function(t){t.getElement().style.opacity="1"}))}},{key:"getMarkers",value:function(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var t=this;this.getMarkers().forEach((function(e){e.addTo(t.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(t){t.remove()})),this.clusterMarkers.forEach((function(t){t.remove()})),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(t,e){var n=t.getLnglat(),r={geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:Nu(Nu({},t.getExtData()),{},{marker_id:e})};this.points.push(r)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var t=this.markerLayerOption.clusterOption,e=t.radius,n=t.minZoom,r=void 0===n?0:n,i=t.maxZoom;this.clusterIndex=new(gr())({radius:e,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(t,e){var n=this,r=t[0].concat(t[1]),i=this.clusterIndex.getClusters(r,e);this.clusterMarkers.forEach((function(t){t.remove()})),this.clusterMarkers=[],i.forEach((function(t){var e,r=n.markerLayerOption.clusterOption,i=r.field,o=r.method;if(t.properties&&null!==(e=t.properties)&&void 0!==e&&e.cluster_id){var a,s=n.getLeaves(null===(a=t.properties)||void 0===a?void 0:a.cluster_id);if(t.properties.clusterData=s,i&&o){var u=Pn(o,Mn(null==s?void 0:s.map((function(t){return(0,m.Z)({},i,t.properties[i])})),i)),l="point_"+o;t.properties[l]=u.toFixed(2)}}var c=n.clusterMarker(t);n.clusterMarkers.push(c),c.addTo(n.scene)}))}},{key:"getLeaves",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t?this.clusterIndex.getLeaves(t,e,n):null}},{key:"clusterMarker",value:function(t){var e=this.markerLayerOption.clusterOption.element,n=void 0===e?this.generateElement.bind(this):e;return new Lu({element:n(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]})}},{key:"normalMarker",value:function(t){var e=t.properties.marker_id;return this.markers[e]}},{key:"update",value:function(){var t=this.mapsService.getZoom(),e=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!ln(this.bbox,e))&&(this.bbox=un(e,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(t){var e=Se("div","l7-marker-cluster"),n=Se("div","",e),r=Se("span","",n),i=this.markerLayerOption.clusterOption,o=i.field,a=i.method;t.properties.point_count=t.properties.point_count||1;var s=o&&a?t.properties["point_"+a]||t.properties[o]:t.properties.point_count;return r.textContent=s,e}}]),i}(fr.EventEmitter);function zu(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Fu(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?zu(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zu(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Zu=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){var e;return(0,z.Z)(this,i),e=r.call(this),(0,m.Z)((0,H.Z)(e),"popupOption",void 0),(0,m.Z)((0,H.Z)(e),"mapsService",void 0),(0,m.Z)((0,H.Z)(e),"sceneSerive",void 0),(0,m.Z)((0,H.Z)(e),"lngLat",void 0),(0,m.Z)((0,H.Z)(e),"content",void 0),(0,m.Z)((0,H.Z)(e),"closeButton",void 0),(0,m.Z)((0,H.Z)(e),"timeoutInstance",void 0),(0,m.Z)((0,H.Z)(e),"container",void 0),(0,m.Z)((0,H.Z)(e),"tip",void 0),(0,m.Z)((0,H.Z)(e),"scene",void 0),e.popupOption=Fu(Fu({},e.getdefault()),t),fn(["update","onClickClose","remove"],(0,H.Z)(e)),e}return(0,F.Z)(i,[{key:"addTo",value:function(t){var e=this;return this.mapsService=t.get(Ur.IMapService),this.sceneSerive=t.get(Ur.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout((function(){e.mapsService.on("click",e.onClickClose)}),30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(t){var e,n=window.document.createDocumentFragment(),r=window.document.createElement("body");for(r.innerHTML=t;e=r.firstChild;)n.appendChild(e);return this.setDOMContent(n)}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(t){return this.setDOMContent(window.document.createTextNode(t))}},{key:"setMaxWidth",value:function(t){return this.popupOption.maxWidth=t,this.update(),this}},{key:"setDOMContent",value:function(t){return this.createContent(),this.content.appendChild(t),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Ce(this.content),this.content=Se("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Se("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(t,e,n){var r=window.document.createElement(t);return void 0!==e&&(r.className=e),n&&n.appendChild(r),r}},{key:"removeDom",value:function(t){t.parentNode&&t.parentNode.removeChild(t)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:pn.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(t){t.stopPropagation&&t.stopPropagation(),this.remove()}},{key:"update",value:function(){var t=this,e=this.lngLat,n=this.popupOption,r=n.className,i=n.maxWidth,o=n.anchor;if(this.mapsService&&e&&this.content){var a=this.mapsService.getMarkerContainer();!this.container&&a&&(this.container=this.creatDom("div","l7-popup",a),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),r&&r.split(" ").forEach((function(e){return t.container.classList.add(e)})),this.popupOption.stopPropagation&&["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(e){t.container.addEventListener(e,(function(t){t.stopPropagation()}))})),this.container.style.whiteSpace="nowrap"),i&&this.container.style.maxWidth!==i&&(this.container.style.maxWidth=i),this.updatePosition(),Re(this.container,"".concat(xn[o])),wn(this.container,o,"popup")}}},{key:"updatePosition",value:function(){if(this.mapsService){var t=this.lngLat,e=t.lng,n=t.lat,r=this.popupOption.offsets,i=this.mapsService.lngLatToContainer([e,n]);this.container.style.left=i.x+r[0]+"px",this.container.style.top=i.y-r[1]+"px"}}}]),i}(fr.EventEmitter);!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-marker-container {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  position: absolute;\n}\n\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n\n.l7-marker-cluster {\n  background-clip: padding-box;\n  border-radius: 20px;\n  background-color: rgba(181, 226, 140, 0.6);\n  width: 40px;\n  height: 40px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-left: 5px;\n  margin-top: 5px;\n  text-align: center;\n  border-radius: 15px;\n  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  background-color: rgba(110, 204, 57, 0.6);\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n\n.l7-popup-anchor-bottom,\n.l7-popup-anchor-bottom-left,\n.l7-popup-anchor-bottom-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n\n.l7-popup-close-button {\n  position: absolute;\n  right: 0;\n  top: 0;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n  background-color: transparent;\n}\n\n.l7-popup-close-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n  position: relative;\n  background: #fff;\n  border-radius: 3px;\n  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  padding: 10px 10px 15px;\n  pointer-events: auto;\n}\n\n/* layers control */\n\n.l7-control-layers {\n  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);\n          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);\n  background: #fff;\n  border-radius: 5px;\n}\n.l7-popup-anchor-top,\n.l7-popup-anchor-top-left,\n.l7-popup-anchor-top-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n\n.l7-popup-anchor-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n\n.l7-popup-anchor-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n  z-index: 5;\n}\n.l7-popup-tip {\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n  z-index: 1;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n\n.l7-popup-anchor-top-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top: none;\n  border-left: none;\n  border-bottom-color: #fff;\n}\n\n.l7-popup-anchor-top-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n\n.l7-popup-anchor-bottom .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-bottom: none;\n  border-top-color: #fff;\n}\n\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-bottom: none;\n  border-left: none;\n  border-top-color: #fff;\n}\n\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-bottom: none;\n  border-right: none;\n  border-top-color: #fff;\n}\n\n.l7-popup-anchor-left .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-left: none;\n  border-right-color: #fff;\n}\n\n.l7-popup-anchor-right .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n\n.l7-popup-close-button {\n  position: absolute;\n  right: 0;\n  top: 0;\n  border: 0;\n  padding: 0;\n  font-size: 25px;\n  line-height: 20px;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n  background-color: transparent;\n}\n\n.l7-popup-close-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n  position: relative;\n  background: #fff;\n  border-radius: 3px;\n  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  padding: 10px 10px 15px;\n  pointer-events: auto;\n}\n\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n\n.l7-popup-track-pointer {\n  display: none;\n}\n\n.l7-popup-track-pointer * {\n  pointer-events: none;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n\n.l7-map:hover .l7-popup-track-pointer {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n\n.l7-popup-close-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n  position: relative;\n  background: #fff;\n  border-radius: 3px;\n  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  padding: 10px 10px 15px;\n  pointer-events: auto;\n}\n\n/* general toolbar styles */\n\n.l7-bar {\n  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);\n          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);\n  border-radius: 4px;\n}\n.l7-bar a,\n.l7-bar a:hover {\n  background-color: #fff;\n  width: 30px;\n  height: 30px;\n  font-size: 20px;\n  display: block;\n  text-align: center;\n  text-decoration: none;\n  color: #8e9dab;\n}\n.l7-bar a,\n.l7-control-layers-toggle {\n  background-position: 50% 50%;\n  background-repeat: no-repeat;\n  display: block;\n}\n.l7-bar a:hover {\n  background-color: #f4f4f4;\n}\n.l7-bar a:first-child {\n  border-top-left-radius: 2px;\n  border-top-right-radius: 2px;\n}\n.l7-bar a:last-child {\n  border-bottom-left-radius: 2px;\n  border-bottom-right-radius: 2px;\n  border-bottom: none;\n}\n.l7-bar a.l7-disabled {\n  cursor: default;\n  background-color: #f4f4f4;\n  color: #bbb;\n}\n\n/* control positioning */\n\n.l7-control-container {\n  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;\n}\n.l7-control-hide {\n  display: none;\n}\n.l7-control {\n  position: relative;\n  z-index: 800;\n  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control {\n  float: left;\n  clear: both;\n}\n.l7-top,\n.l7-bottom {\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-top {\n  top: 0;\n}\n.l7-right {\n  right: 0;\n}\n.l7-bottom {\n  bottom: 0;\n}\n.l7-left {\n  left: 0;\n}\n.l7-center {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.l7-bottom.l7-center,\n.l7-top.l7-center {\n  width: 100%;\n}\n.l7-right.l7-center,\n.l7-left.l7-center {\n  height: 100%;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n\n.l7-top.l7-center,\n.l7-left.l7-center {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n\n.l7-bottom.l7-center,\n.l7-right.l7-center {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n\n.l7-center .l7-control {\n  margin-right: 10px;\n  margin-bottom: 10px;\n}\n\n.l7-control {\n  float: left;\n  clear: both;\n}\n.l7-right .l7-control {\n  float: right;\n}\n.l7-top .l7-control {\n  margin-top: 10px;\n}\n.l7-bottom .l7-control {\n  margin-bottom: 10px;\n}\n.l7-left .l7-control {\n  margin-left: 10px;\n}\n.l7-right .l7-control {\n  margin-right: 10px;\n}\n\n/* attribution and scale controls */\n\n.l7-control-container .l7-control-attribution {\n  background: #fff;\n  background: rgba(255, 255, 255, 0.7);\n  margin: 0;\n}\n.l7-control-attribution,\n.l7-control-scale-line {\n  padding: 0 5px;\n  color: #333;\n}\n.l7-control-attribution a {\n  text-decoration: none;\n}\n.l7-control-attribution a:hover {\n  text-decoration: underline;\n}\n.l7-container .l7-control-attribution,\n.l7-container .l7-control-scale {\n  font-size: 11px;\n  padding: 5px 5px 2px 5px;\n  background: rgba(255, 255, 255, 0.7);\n}\n.l7-left .l7-control-scale {\n  margin-left: 5px;\n}\n.l7-bottom .l7-control-scale {\n  margin-bottom: 5px;\n}\n.l7-control-scale-line {\n  border: 2px solid #000;\n  border-top: none;\n  color: #000;\n  line-height: 1.1;\n  padding: 2px 5px 1px;\n  font-size: 11px;\n  white-space: nowrap;\n  overflow: hidden;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n\n  background: #fff;\n}\n.l7-control-scale-line:not(:first-child) {\n  border-top: 2px solid #777;\n  border-bottom: none;\n  margin-top: -2px;\n}\n.l7-control-scale-line:not(:first-child):not(:last-child) {\n  border-bottom: 2px solid #777;\n}\n\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  -webkit-box-shadow: none;\n          box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  border: 2px solid rgba(0, 0, 0, 0.2);\n  background-clip: padding-box;\n}\n/*logo */\n\n.l7-ctrl-logo {\n  background-size: 100% 100%;\n  width: 89px;\n  height: 16px;\n  margin: 0 0 -3px -3px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  background-repeat: no-repeat;\n  cursor: pointer;\n  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');\n}\n\n/* layers control */\n\n.l7-control-layers {\n  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);\n          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);\n  background: #fff;\n  border-radius: 2px;\n}\n.l7-control-layers-toggle {\n  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');\n  width: 30px;\n  height: 30px;\n  background-size: 20px 20px;\n}\n\n.l7-touch .l7-control-layers-toggle {\n  width: 44px;\n  height: 44px;\n}\n.l7-control-layers .l7-control-layers-list,\n.l7-control-layers-expanded .l7-control-layers-toggle {\n  display: none;\n}\n.l7-control-layers-expanded .l7-control-layers-list {\n  display: block;\n  position: relative;\n}\n.l7-control-layers-expanded {\n  padding: 6px 10px 6px 6px;\n  color: #59626b;\n  background: #fff;\n}\n.l7-control-layers-scrollbar {\n  overflow-y: scroll;\n  overflow-x: hidden;\n  padding-right: 5px;\n}\n.l7-control-layers-selector {\n  margin-top: 2px;\n  position: relative;\n  top: 1px;\n}\n.l7-control-layers label {\n  display: block;\n  padding: 8px;\n}\n.l7-control-layers label input[type='radio'],\n.l7-control-layers label input[type='checkbox'] {\n  width: 14px;\n  height: 14px;\n  margin: 0;\n}\n.l7-control-layers-separator {\n  height: 0;\n  border-top: 1px solid #d8d8d8;\n  margin: 5px -10px 5px -6px;\n}\n.mapboxgl-ctrl-logo {\n  display: none !important;\n}\n.amap-logo {\n  display: none !important;\n}\n");var ju,Uu,Gu,Vu,Wu,Hu,Xu,Yu,qu,Ku,Qu,Ju,$u,tl,el=n(8307),nl=n.n(el),rl=function(){function t(e,n){(0,z.Z)(this,t),(0,m.Z)(this,"attribute",void 0),(0,m.Z)(this,"buffer",void 0);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return(0,F.Z)(t,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),t}(),il=(ju={},(0,m.Z)(ju,qi.POINTS,"points"),(0,m.Z)(ju,qi.LINES,"lines"),(0,m.Z)(ju,qi.LINE_LOOP,"line loop"),(0,m.Z)(ju,qi.LINE_STRIP,"line strip"),(0,m.Z)(ju,qi.TRIANGLES,"triangles"),(0,m.Z)(ju,qi.TRIANGLE_FAN,"triangle fan"),(0,m.Z)(ju,qi.TRIANGLE_STRIP,"triangle strip"),ju),ol=(Uu={},(0,m.Z)(Uu,qi.STATIC_DRAW,"static"),(0,m.Z)(Uu,qi.DYNAMIC_DRAW,"dynamic"),(0,m.Z)(Uu,qi.STREAM_DRAW,"stream"),Uu),al=(Gu={},(0,m.Z)(Gu,qi.BYTE,"int8"),(0,m.Z)(Gu,qi.UNSIGNED_INT,"int16"),(0,m.Z)(Gu,qi.INT,"int32"),(0,m.Z)(Gu,qi.UNSIGNED_BYTE,"uint8"),(0,m.Z)(Gu,qi.UNSIGNED_SHORT,"uint16"),(0,m.Z)(Gu,qi.UNSIGNED_INT,"uint32"),(0,m.Z)(Gu,qi.FLOAT,"float"),Gu),sl=(Vu={},(0,m.Z)(Vu,qi.ALPHA,"alpha"),(0,m.Z)(Vu,qi.LUMINANCE,"luminance"),(0,m.Z)(Vu,qi.LUMINANCE_ALPHA,"luminance alpha"),(0,m.Z)(Vu,qi.RGB,"rgb"),(0,m.Z)(Vu,qi.RGBA,"rgba"),(0,m.Z)(Vu,qi.RGBA4,"rgba4"),(0,m.Z)(Vu,qi.RGB5_A1,"rgb5 a1"),(0,m.Z)(Vu,qi.RGB565,"rgb565"),(0,m.Z)(Vu,qi.DEPTH_COMPONENT,"depth"),(0,m.Z)(Vu,qi.DEPTH_STENCIL,"depth stencil"),Vu),ul=(Wu={},(0,m.Z)(Wu,qi.DONT_CARE,"dont care"),(0,m.Z)(Wu,qi.NICEST,"nice"),(0,m.Z)(Wu,qi.FASTEST,"fast"),Wu),ll=(Hu={},(0,m.Z)(Hu,qi.NEAREST,"nearest"),(0,m.Z)(Hu,qi.LINEAR,"linear"),(0,m.Z)(Hu,qi.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,m.Z)(Hu,qi.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,m.Z)(Hu,qi.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,m.Z)(Hu,qi.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Hu),cl=(Xu={},(0,m.Z)(Xu,qi.REPEAT,"repeat"),(0,m.Z)(Xu,qi.CLAMP_TO_EDGE,"clamp"),(0,m.Z)(Xu,qi.MIRRORED_REPEAT,"mirror"),Xu),hl=(Yu={},(0,m.Z)(Yu,qi.NONE,"none"),(0,m.Z)(Yu,qi.BROWSER_DEFAULT_WEBGL,"browser"),Yu),fl=(qu={},(0,m.Z)(qu,qi.NEVER,"never"),(0,m.Z)(qu,qi.ALWAYS,"always"),(0,m.Z)(qu,qi.LESS,"less"),(0,m.Z)(qu,qi.LEQUAL,"lequal"),(0,m.Z)(qu,qi.GREATER,"greater"),(0,m.Z)(qu,qi.GEQUAL,"gequal"),(0,m.Z)(qu,qi.EQUAL,"equal"),(0,m.Z)(qu,qi.NOTEQUAL,"notequal"),qu),pl=(Ku={},(0,m.Z)(Ku,qi.FUNC_ADD,"add"),(0,m.Z)(Ku,qi.MIN_EXT,"min"),(0,m.Z)(Ku,qi.MAX_EXT,"max"),(0,m.Z)(Ku,qi.FUNC_SUBTRACT,"subtract"),(0,m.Z)(Ku,qi.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Ku),dl=(Qu={},(0,m.Z)(Qu,qi.ZERO,"zero"),(0,m.Z)(Qu,qi.ONE,"one"),(0,m.Z)(Qu,qi.SRC_COLOR,"src color"),(0,m.Z)(Qu,qi.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,m.Z)(Qu,qi.SRC_ALPHA,"src alpha"),(0,m.Z)(Qu,qi.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,m.Z)(Qu,qi.DST_COLOR,"dst color"),(0,m.Z)(Qu,qi.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,m.Z)(Qu,qi.DST_ALPHA,"dst alpha"),(0,m.Z)(Qu,qi.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,m.Z)(Qu,qi.CONSTANT_COLOR,"constant color"),(0,m.Z)(Qu,qi.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,m.Z)(Qu,qi.CONSTANT_ALPHA,"constant alpha"),(0,m.Z)(Qu,qi.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,m.Z)(Qu,qi.SRC_ALPHA_SATURATE,"src alpha saturate"),Qu),gl=(Ju={},(0,m.Z)(Ju,qi.NEVER,"never"),(0,m.Z)(Ju,qi.ALWAYS,"always"),(0,m.Z)(Ju,qi.LESS,"less"),(0,m.Z)(Ju,qi.LEQUAL,"lequal"),(0,m.Z)(Ju,qi.GREATER,"greater"),(0,m.Z)(Ju,qi.GEQUAL,"gequal"),(0,m.Z)(Ju,qi.EQUAL,"equal"),(0,m.Z)(Ju,qi.NOTEQUAL,"notequal"),Ju),vl=($u={},(0,m.Z)($u,qi.ZERO,"zero"),(0,m.Z)($u,qi.KEEP,"keep"),(0,m.Z)($u,qi.REPLACE,"replace"),(0,m.Z)($u,qi.INVERT,"invert"),(0,m.Z)($u,qi.INCR,"increment"),(0,m.Z)($u,qi.DECR,"decrement"),(0,m.Z)($u,qi.INCR_WRAP,"increment wrap"),(0,m.Z)($u,qi.DECR_WRAP,"decrement wrap"),$u),ml=(tl={},(0,m.Z)(tl,qi.FRONT,"front"),(0,m.Z)(tl,qi.BACK,"back"),tl),yl=function(){function t(e,n){(0,z.Z)(this,t),(0,m.Z)(this,"buffer",void 0);var r=n.data,i=n.usage,o=n.type;this.buffer=e.buffer({data:r,usage:ol[i||qi.STATIC_DRAW],type:al[o||qi.UNSIGNED_BYTE]})}return(0,F.Z)(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var e=t.data,n=t.offset;this.buffer.subdata(e,n)}}]),t}(),_l=function(){function t(e,n){(0,z.Z)(this,t),(0,m.Z)(this,"elements",void 0);var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=e.elements({data:r,usage:ol[i||qi.STATIC_DRAW],type:al[o||qi.UNSIGNED_BYTE],count:a})}return(0,F.Z)(t,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var e=t.data;this.elements.subdata(e)}},{key:"destroy",value:function(){}}]),t}(),bl=function(){function t(e,n){(0,z.Z)(this,t),(0,m.Z)(this,"framebuffer",void 0);var r=n.width,i=n.height,o=n.color,a=n.colors,s=(n.depth,n.stencil,{width:r,height:i});Array.isArray(a)&&(s.colors=a.map((function(t){return t.get()}))),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=e.framebuffer(s)}return(0,F.Z)(t,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.framebuffer.resize(e,n)}}]),t}(),xl=n(6719),wl=n.n(xl),El=n(8630),Sl=n.n(El);function Cl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Al(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Cl(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Cl(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Tl,kl=function(){function t(e,n){(0,z.Z)(this,t),(0,m.Z)(this,"reGl",void 0),(0,m.Z)(this,"destroyed",!1),(0,m.Z)(this,"drawCommand",void 0),(0,m.Z)(this,"drawPickCommand",void 0),(0,m.Z)(this,"drawParams",void 0),(0,m.Z)(this,"options",void 0),(0,m.Z)(this,"uniforms",{}),this.reGl=e;var r=n.vs,i=n.fs,o=n.attributes,a=n.uniforms,s=n.primitive,u=n.count,l=n.elements,c=n.depth,h=n.blend,f=n.stencil,p=n.cull,d=n.instances,g={};this.options=n,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach((function(t){g[t]=e.prop(t)})));var v={};Object.keys(o).forEach((function(t){v[t]=o[t].get()}));var y={attributes:v,frag:i,uniforms:g,vert:r,blend:{},primitive:il[void 0===s?qi.TRIANGLES:s]};d&&(y.instances=d),u&&(y.count=u),l&&(y.elements=l.get()),this.initDepthDrawParams({depth:c},y),this.initBlendDrawParams({blend:h},y),this.initStencilDrawParams({stencil:f},y),this.initCullDrawParams({cull:p},y),this.drawCommand=e(y);var _=zn()(y);_.blend=Al(Al({},_.blend),{},{enable:!1}),this.drawPickCommand=e(_),this.drawParams=y}return(0,F.Z)(t,[{key:"addUniforms",value:function(t){this.uniforms=Al(Al({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,e){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=Al(Al({},this.uniforms),this.extractUniforms(t.uniforms||{})),r={};Object.keys(n).forEach((function(t){var e=(0,Rt.Z)(n[t]);"boolean"===e||"number"===e||Array.isArray(n[t])||n[t].BYTES_PER_ELEMENT?r[t]=n[t]:r[t]=n[t].get()})),e?this.drawPickCommand(r):this.drawCommand(r)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(t){t.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,e){var n=t.depth;n&&(e.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:fl[n.func||qi.LESS],range:n.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,e){var n=t.blend;if(n){var r=n.enable,i=n.func,o=n.equation,a=n.color,s=void 0===a?[0,0,0,0]:a;e.blend={enable:!!r,func:{srcRGB:dl[i&&i.srcRGB||qi.SRC_ALPHA],srcAlpha:dl[i&&i.srcAlpha||qi.SRC_ALPHA],dstRGB:dl[i&&i.dstRGB||qi.ONE_MINUS_SRC_ALPHA],dstAlpha:dl[i&&i.dstAlpha||qi.ONE_MINUS_SRC_ALPHA]},equation:{rgb:pl[o&&o.rgb||qi.FUNC_ADD],alpha:pl[o&&o.alpha||qi.FUNC_ADD]},color:s}}}},{key:"initStencilDrawParams",value:function(t,e){var n=t.stencil;if(n){var r=n.enable,i=n.mask,o=void 0===i?-1:i,a=n.func,s=void 0===a?{cmp:qi.ALWAYS,ref:0,mask:-1}:a,u=n.opFront,l=void 0===u?{fail:qi.KEEP,zfail:qi.KEEP,zpass:qi.KEEP}:u,c=n.opBack,h=void 0===c?{fail:qi.KEEP,zfail:qi.KEEP,zpass:qi.KEEP}:c;e.stencil={enable:!!r,mask:o,func:Al(Al({},s),{},{cmp:gl[s.cmp]}),opFront:{fail:vl[l.fail],zfail:vl[l.zfail],zpass:vl[l.zpass]},opBack:{fail:vl[h.fail],zfail:vl[h.zfail],zpass:vl[h.zpass]}}}}},{key:"initCullDrawParams",value:function(t,e){var n=t.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?qi.BACK:i;e.cull={enable:!!r,face:ml[o]}}}},{key:"extractUniforms",value:function(t){var e=this,n={};return Object.keys(t).forEach((function(r){e.extractUniformsRecursively(r,t[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(t,e,n,r){var i=this;null===e||"number"==typeof e||"boolean"==typeof e||Array.isArray(e)&&"number"==typeof e[0]||wl()(e)||""===e||"resize"in e?n["".concat(r&&r+".").concat(t)]=e:(Sl()(e)&&Object.keys(e).forEach((function(o){i.extractUniformsRecursively(o,e[o],n,"".concat(r&&r+".").concat(t))})),Array.isArray(e)&&e.forEach((function(e,o){Object.keys(e).forEach((function(a){i.extractUniformsRecursively(a,e[a],n,"".concat(r&&r+".").concat(t,"[").concat(o,"]"))}))})))}}]),t}(),Ml=function(){function t(e,n){(0,z.Z)(this,t),(0,m.Z)(this,"texture",void 0),(0,m.Z)(this,"width",void 0),(0,m.Z)(this,"height",void 0),(0,m.Z)(this,"isDistroy",!1);var r=n.data,i=n.type,o=void 0===i?qi.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,l=void 0!==u&&u,c=n.format,h=void 0===c?qi.RGBA:c,f=n.mipmap,p=void 0!==f&&f,d=n.wrapS,g=void 0===d?qi.CLAMP_TO_EDGE:d,v=n.wrapT,y=void 0===v?qi.CLAMP_TO_EDGE:v,_=n.aniso,b=void 0===_?0:_,x=n.alignment,w=void 0===x?1:x,E=n.premultiplyAlpha,S=void 0!==E&&E,C=n.mag,A=void 0===C?qi.NEAREST:C,T=n.min,k=void 0===T?qi.NEAREST:T,M=n.colorSpace,P=void 0===M?qi.BROWSER_DEFAULT_WEBGL:M;this.width=a,this.height=s;var I={width:a,height:s,type:al[o],format:sl[h],wrapS:cl[g],wrapT:cl[y],mag:ll[A],min:ll[k],alignment:w,flipY:l,colorSpace:hl[P],premultiplyAlpha:S,aniso:b};r&&(I.data=r),"number"==typeof p?I.mipmap=ul[p]:"boolean"==typeof p&&(I.mipmap=p),this.texture=e.texture(I)}return(0,F.Z)(t,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.texture.resize(e,n),this.width=e,this.height=n}},{key:"destroy",value:function(){this.isDistroy||this.texture.destroy(),this.isDistroy=!0}}]),t}(),Pl=(0,Zr.b2)()(Tl=function(){function t(){var e=this;(0,z.Z)(this,t),(0,m.Z)(this,"extensionObject",void 0),(0,m.Z)(this,"gl",void 0),(0,m.Z)(this,"$container",void 0),(0,m.Z)(this,"canvas",void 0),(0,m.Z)(this,"width",void 0),(0,m.Z)(this,"height",void 0),(0,m.Z)(this,"isDirty",void 0),(0,m.Z)(this,"createModel",(function(t){return new kl(e.gl,t)})),(0,m.Z)(this,"createAttribute",(function(t){return new rl(e.gl,t)})),(0,m.Z)(this,"createBuffer",(function(t){return new yl(e.gl,t)})),(0,m.Z)(this,"createElements",(function(t){return new _l(e.gl,t)})),(0,m.Z)(this,"createTexture2D",(function(t){return new Ml(e.gl,t)})),(0,m.Z)(this,"createFramebuffer",(function(t){return new bl(e.gl,t)})),(0,m.Z)(this,"useFramebuffer",(function(t,n){e.gl({framebuffer:t?t.get():null})(n)})),(0,m.Z)(this,"clear",(function(t){var n=t.color,r=t.depth,i=t.stencil,o=t.framebuffer,a=void 0===o?null:o,s={color:n,depth:r,stencil:i};s.framebuffer=null===a?a:a.get(),e.gl.clear(s)})),(0,m.Z)(this,"viewport",(function(t){var n=t.x,r=t.y,i=t.width,o=t.height;e.gl._gl.viewport(n,r,i,o),e.width=i,e.height=o,e.gl._refresh()})),(0,m.Z)(this,"readPixels",(function(t){var n=t.framebuffer,r={x:t.x,y:t.y,width:t.width,height:t.height};return n&&(r.framebuffer=n.get()),e.gl.read(r)})),(0,m.Z)(this,"getViewportSize",(function(){return{width:e.gl._gl.drawingBufferWidth,height:e.gl._gl.drawingBufferHeight}})),(0,m.Z)(this,"getContainer",(function(){return ve?e.canvas:null===(t=e.canvas)||void 0===t?void 0:t.parentElement;var t})),(0,m.Z)(this,"getCanvas",(function(){return e.canvas})),(0,m.Z)(this,"getGLContext",(function(){return e.gl._gl})),(0,m.Z)(this,"destroy",(function(){e.gl.destroy()}))}var e;return(0,F.Z)(t,[{key:"init",value:(e=(0,lo.Z)(ho().mark((function t(e,n){var r=this;return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.canvas=e,t.next=3,new Promise((function(t,e){nl()({canvas:r.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(n,r){!n&&r||e(n),t(r)}})}));case 3:this.gl=t.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null})}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),t}())||Tl;function Il(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ol(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Il(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Il(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Rl,Ll,Dl,Nl=function(){function t(e){(0,z.Z)(this,t),(0,m.Z)(this,"sceneService",void 0),(0,m.Z)(this,"mapService",void 0),(0,m.Z)(this,"controlService",void 0),(0,m.Z)(this,"layerService",void 0),(0,m.Z)(this,"iconService",void 0),(0,m.Z)(this,"markerService",void 0),(0,m.Z)(this,"popupService",void 0),(0,m.Z)(this,"fontService",void 0),(0,m.Z)(this,"interactionService",void 0),(0,m.Z)(this,"container",void 0);var n=e.id,r=e.map,i=e.canvas,o=e.hasBaseMap,a=uu();this.container=a,r.setContainer(a,n,i,o),a.bind(Ur.IRendererService).to(Pl).inSingletonScope(),this.sceneService=a.get(Ur.ISceneService),this.mapService=a.get(Ur.IMapService),this.iconService=a.get(Ur.IIconService),this.fontService=a.get(Ur.IFontService),this.controlService=a.get(Ur.IControlService),this.layerService=a.get(Ur.ILayerService),this.markerService=a.get(Ur.IMarkerService),this.interactionService=a.get(Ur.IInteractionService),this.popupService=a.get(Ur.IPopupService),ve?this.sceneService.initMiniScene(e):(this.initComponent(n),this.sceneService.init(e),this.initControl())}return(0,F.Z)(t,[{key:"map",get:function(){return this.mapService.map}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(t){return this.sceneService.exportPng(t)}},{key:"exportMap",value:function(t){return this.sceneService.exportPng(t)}},{key:"registerRenderService",value:function(t){var e=this;this.sceneService.loaded?new t(this).init():this.on("loaded",(function(){new t(e).init()}))}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var e=lu(this.container);t.setContainer(e,this.container),this.sceneService.addLayer(t)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(t,e){this.layerService.remove(t,e)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,e){this.fontService.addIconFont(t,e)}},{key:"addIconFonts",value:function(t){var e=this;t.forEach((function(t){var n=(0,R.Z)(t,2),r=n[0],i=n[1];e.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(t,e){this.sceneService.addFontFace(t,e)}},{key:"addImage",value:function(t,e){ve?this.iconService.addImageMini(t,e,this.sceneService):this.iconService.addImage(t,e)}},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,e){this.fontService.addIconGlyphs(e)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"on",value:function(t,e){-1===Eu.indexOf(t)?this.mapService.on(t,e):this.sceneService.on(t,e)}},{key:"once",value:function(t,e){-1===Eu.indexOf(t)?this.mapService.once(t,e):this.sceneService.once(t,e)}},{key:"off",value:function(t,e){-1===Eu.indexOf(t)?this.mapService.off(t,e):this.sceneService.off(t,e)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,e){return this.mapService.setCenter(t,e)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,e){this.mapService.panBy(t,e)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,e){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(t,e||Ol(Ol({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(t,e){this.mapService.setZoomAndCenter(t,e)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,e){this.container.bind(Ur.IPostProcessingPass).to(t).whenTargetNamed(e)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:xe(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),e=t.logoVisible,n=t.logoPosition;e&&this.addControl(new Mu({position:n}))}}]),t}();function Bl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function zl(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Bl(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Bl(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Fl,Zl=(Rl=iu(Ur.IGlobalConfigService),Ll=function(){function t(e){(0,z.Z)(this,t),(0,Ti.Z)(this,"configService",Dl,this),(0,m.Z)(this,"config",void 0),this.config=e}return(0,F.Z)(t,[{key:"setContainer",value:function(t,e,n,r){t.bind(Ur.MapConfig).toConstantValue(zl(zl({},this.config),{},{id:e,canvas:n,hasBaseMap:r})),t.bind(Ur.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),t}(),Dl=(0,ki.Z)(Ll.prototype,"configService",[Rl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ll),jl=n(1618),Ul=n.n(jl),Gl=n(7160);function Vl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Wl(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Vl(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Vl(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Hl(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={top:0,right:0,bottom:0,left:0};if("number"==typeof t)return{top:t,right:t,bottom:t,left:t};if(Array.isArray(t)){if(4===t.length)return{top:t[0],right:t[1],bottom:t[2],left:t[3]};if(2===t.length)return{top:t[0],right:t[1],bottom:t[0],left:t[1]}}return Wl(Wl({},e),t)}!function(t){t["GAODE1.x"]="GAODE1.x",t["GAODE2.x"]="GAODE2.x",t.MAPBOX="MAPBOX",t.L7MAP="L7MAP",t.GLOBEL="GLOBEL"}(Fl||(Fl={}));var Xl,Yl,ql,Kl,Ql,Jl,$l,tc,ec,nc,rc,ic={dark:"amap://styles/2a09079c3daac9420ee53b67307a8006?isPublic=true",light:"amap://styles/1fd9f8ef9751298f11f5c56968312c70?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"},oc=Math.PI/180,ac=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"projectionMatrix",li.create()),(0,m.Z)(this,"viewMatrix",li.create()),(0,m.Z)(this,"viewProjectionMatrix",li.create()),(0,m.Z)(this,"ViewProjectionMatrixUncentered",li.create()),(0,m.Z)(this,"viewUncenteredMatrix",li.create()),(0,m.Z)(this,"zoom",void 0),(0,m.Z)(this,"center",void 0)}return(0,F.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.zoom,n=void 0===e?1:e,r=t.pitch,i=void 0===r?0:r,o=t.bearing,a=void 0===o?0:o,s=t.center,u=void 0===s?[0,0]:s,l=t.offsetOrigin,c=void 0===l?[0,0]:l,h=t.cameraHeight,f=void 0===h?1:h,p=t.aspect,d=void 0===p?1:p,g=t.near,v=void 0===g?.1:g,m=t.far,y=void 0===m?1e3:m,_=t.fov,b=void 0===_?0:_;this.zoom=n,this.center=u;var x=i*oc,w=(360-a)*oc;li.perspective(this.projectionMatrix,b,d,v,y);var E=Gl.fromValues(f*Math.sin(x)*Math.sin(w),-f*Math.sin(x)*Math.cos(w),f*Math.cos(x)),S=Gl.fromValues(-Math.cos(x)*Math.sin(w),Math.cos(x)*Math.cos(w),Math.sin(x));li.lookAt(this.viewMatrix,E,Gl.fromValues(0,0,0),S),this.viewUncenteredMatrix=li.clone(this.viewMatrix),li.translate(this.viewMatrix,this.viewMatrix,Gl.fromValues(-c[0],c[1],0)),li.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),li.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var t=(0,R.Z)(this.center,2);return[t[0],t[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){var n=85.0511287798,r=Math.max(Math.min(n,t[1]),-n),i=256<<20,o=Math.PI/180,a=t[0]*o,s=r*o;return s=Math.log(Math.tan(Math.PI/4+s/2)),[a=i*(.5/Math.PI*a+.5)-215440491,s=-(i*(-.5/Math.PI*s+(o=.5))-106744817)]}}]),t}(),sc=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];function uc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function lc(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?uc(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):uc(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n");var cc=0;window.forceWebGL=!0;var hc="15cd8a57710d40c9b7c0e3cc120f1200",fc=!1,pc=[],dc=(Xl=(0,Zr.b2)(),Yl=(0,Zr.f3)(Ur.IGlobalConfigService),ql=(0,Zr.f3)(Ur.MapConfig),Kl=(0,Zr.f3)(Ur.ICoordinateSystemService),Ql=(0,Zr.f3)(Ur.IEventEmitter),Xl(($l=function(){function t(){var e=this;(0,z.Z)(this,t),(0,m.Z)(this,"version",Fl["GAODE1.x"]),(0,m.Z)(this,"map",void 0),(0,m.Z)(this,"dragging",!1),(0,m.Z)(this,"bgColor","rgba(0, 0, 0, 0)"),(0,Ti.Z)(this,"configService",tc,this),(0,Ti.Z)(this,"config",ec,this),(0,Ti.Z)(this,"coordinateSystemService",nc,this),(0,Ti.Z)(this,"eventEmitter",rc,this),(0,m.Z)(this,"markerContainer",void 0),(0,m.Z)(this,"$mapContainer",void 0),(0,m.Z)(this,"viewport",void 0),(0,m.Z)(this,"cameraChangedCallback",void 0),(0,m.Z)(this,"handleCameraChanged",(function(t){var n=t.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,l=n.aspect,c=n.position,h=e.getCenter(),f=h.lng,p=h.lat;if(e.emit("mapchange"),e.cameraChangedCallback){e.viewport.syncWithMapCamera({aspect:l,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:e.map.getZoom()-1,center:[f,p],offsetOrigin:[c.x,c.y]});var d=e.config.offsetZoom,g=void 0===d?12:d;e.viewport.getZoom()>g?e.coordinateSystemService.setCoordinateSystem(Ei.P20_OFFSET):e.coordinateSystemService.setCoordinateSystem(Ei.P20),e.cameraChangedCallback(e.viewport)}}))}var e;return(0,F.Z)(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();if(null!==t){var e=t.getElementsByClassName("amap-maps")[0];this.markerContainer=Se("div","l7-marker-container",e)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==xu.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(t,e)}},{key:"off",value:function(t,e){-1!==xu.indexOf(t)?this.eventEmitter.off(t,e):this.map.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return null===(t=this.map.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(null!=t&&t.padding){var e=this.getCenter(),n=this.getSize(),r=(0,R.Z)(n,2),i=(r[0],r[1],Hl(t.padding)),o=this.lngLatToPixel([e.lng,e.lat]),a=[(i.right-i.left)/2,(i.bottom-i.top)/2];return this.pixelToLngLat([o.x-a[0],o.y-a[1]])}var s=this.map.getCenter();return{lng:s.getLng(),lat:s.getLat()}}},{key:"setCenter",value:function(t,e){if(null!=e&&e.padding){var n=Hl(e.padding),r=this.lngLatToPixel(t),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().toBounds(),e=t.getNorthEast(),n=t.getSouthWest(),r=this.getCenter(),i=r.lng>e.getLng()||r.lng<n.getLng()?180-e.getLng():e.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,e.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.get("zooms")[0]-1}},{key:"getMaxZoom",value:function(){return this.map.get("zooms")[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(t,e)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,e){this.map.setZoomAndCenter(t,e)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyle(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"pixelToLngLat",value:function(t){var e=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:e.getLng(),lat:e.getLat()}}},{key:"lngLatToPixel",value:function(t){var e=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:e.getX(),y:e.getY()}}},{key:"containerToLngLat",value:function(t){var e=new AMap.Pixel(t[0],t[1]),n=this.map.containerToLngLat(e);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(t){var e=new AMap.LngLat(t[0],t[1]),n=this.map.lngLatToContainer(e);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToCoord",value:function(t){var e=this.map.lngLatToGeodeticCoord(t);return[e.x,-e.y]}},{key:"lngLatToMercator",value:function(t,e){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(t),o=li.create();return li.translate(o,o,Gl.fromValues(i[0],i[1],e)),li.scale(o,o,Gl.fromValues(r[0],r[1],r[2])),li.rotateX(o,o,n[0]),li.rotateY(o,o,n[1]),li.rotateZ(o,o,n[2]),o}},{key:"init",value:(e=(0,lo.Z)(ho().mark((function t(){var e,n,r,i,o,a,s,u,l,c,h,f,p,d,g=this;return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config,n=e.id,r=e.style,i=void 0===r?"light":r,o=e.minZoom,a=void 0===o?0:o,s=e.maxZoom,u=void 0===s?18:s,l=e.token,c=void 0===l?hc:l,h=e.mapInstance,f=e.plugin,p=void 0===f?[]:f,d=Mo(e,sc),t.next=3,new Promise((function(t){var e=function(){if(h)g.map=h,g.$mapContainer=g.map.getContainer(),setTimeout((function(){g.map.on("camerachange",g.handleCameraChanged),t()}),30);else{g.$mapContainer=g.creatAmapContainer(n);var e=lc({mapStyle:g.getMapStyle(i),zooms:[a,u],viewMode:"3D"},d);e.zoom&&(e.zoom+=1);var r=new AMap.Map(g.$mapContainer,e);r.on("camerachange",g.handleCameraChanged),g.map=r,setTimeout((function(){t()}),10)}};fc||h?fc&&window.AMap||h?e():pc.push(e):(c===hc&&console.warn(g.configService.getSceneWarninfo("MapToken")),fc=!0,p.push("Map3D"),Ul().load({key:c,version:"1.4.15",plugins:p}).then((function(t){e(),pc.length&&(pc.forEach((function(t){return t()})),pc=[])})).catch((function(t){throw new Error(t)})))}));case 3:this.map.on("dragstart",(function(){return g.dragging=!0,""})),this.map.on("dragend",(function(){return g.dragging=!1,""})),this.viewport=new ac;case 6:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"meterToCoord",value:function(t,e){var n=AMap.GeometryUtil.distance(Ze(AMap.LngLat,(0,y.Z)(t)),Ze(AMap.LngLat,(0,y.Z)(e))),r=this.lngLatToCoord(t),i=(0,R.Z)(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(e),u=(0,R.Z)(s,2),l=u[0],c=u[1];return Math.sqrt(Math.pow(o-l,2)+Math.pow(a-c,2))/n}},{key:"exportMap",value:function(t){var e,n=null===(e=this.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-layer")[0];return"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"destroy",value:function(){var t,e;this.map.destroy(),null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),delete window.initAMap;var n=document.getElementById("amap-script");n&&document.head.removeChild(n)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"getMapStyle",value:function(t){return ic[t]?ic[t]:t}},{key:"creatAmapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_amap_div"+cc++,e.appendChild(n),n}}]),t}(),tc=(0,ki.Z)($l.prototype,"configService",[Yl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ec=(0,ki.Z)($l.prototype,"config",[ql],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nc=(0,ki.Z)($l.prototype,"coordinateSystemService",[Kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rc=(0,ki.Z)($l.prototype,"eventEmitter",[Ql],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jl=$l))||Jl);var gc,vc,mc,yc,_c,bc,xc,wc,Ec,Sc,Cc,Ac=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getServiceConstructor",value:function(){return dc}}]),i}(Zl),Tc={dark:"amap://styles/dark",light:"amap://styles/light",normal:"amap://styles/normal",blank:"amap://styles/1a91e7ec761981d85b35f3099ff781a3"},kc=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"projectionMatrix",li.create()),(0,m.Z)(this,"viewMatrix",li.create()),(0,m.Z)(this,"viewProjectionMatrix",li.create()),(0,m.Z)(this,"ViewProjectionMatrixUncentered",li.create()),(0,m.Z)(this,"viewUncenteredMatrix",li.create()),(0,m.Z)(this,"zoom",void 0),(0,m.Z)(this,"center",void 0)}return(0,F.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.zoom,n=void 0===e?1:e,r=t.center,i=void 0===r?[0,0]:r,o=t.offsetOrigin,a=void 0===o?[0,0]:o,s=t.cameraPosition,u=void 0===s?[0,0,0]:s,l=t.up,c=void 0===l?[0,1,0]:l,h=t.lookAt,f=void 0===h?[0,0,0]:h,p=t.aspect,d=void 0===p?1:p,g=t.near,v=void 0===g?.1:g,m=t.far,_=void 0===m?1e3:m,b=t.fov,x=void 0===b?45:b;this.zoom=n,this.center=i,li.perspective(this.projectionMatrix,x/180*Math.PI,d,v,_);var w=Gl.fromValues.apply(Gl,(0,y.Z)(u)),E=Gl.fromValues.apply(Gl,(0,y.Z)(f)),S=Gl.fromValues.apply(Gl,(0,y.Z)(c));li.lookAt(this.viewMatrix,w,E,S),this.viewUncenteredMatrix=li.clone(this.viewMatrix),li.translate(this.viewMatrix,this.viewMatrix,Gl.fromValues(-a[0],a[1],0)),li.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),li.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var t=(0,R.Z)(this.center,2);return[t[0],t[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){var n=85.0511287798,r=Math.max(Math.min(n,t[1]),-n),i=256<<20,o=Math.PI/180,a=t[0]*o,s=r*o;return s=Math.log(Math.tan(Math.PI/4+s/2)),[a=i*(.5/Math.PI*a+.5)-215440491,s=-(i*(-.5/Math.PI*s+(o=.5))-106744817)]}}]),t}(),Mc=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"];function Pc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ic(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Pc(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Pc(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".amap-logo{\n display: none !important;\n}\n");var Oc=0;window.forceWebGL=!0;var Rc="ff533602d57df6f8ab3b0fea226ae52f",Lc=!1,Dc=[],Nc=(gc=(0,Zr.b2)(),vc=(0,Zr.f3)(Ur.IGlobalConfigService),mc=(0,Zr.f3)(Ur.MapConfig),yc=(0,Zr.f3)(Ur.ICoordinateSystemService),_c=(0,Zr.f3)(Ur.IEventEmitter),gc((xc=function(){function t(){var e=this;(0,z.Z)(this,t),(0,m.Z)(this,"version",Fl["GAODE2.x"]),(0,m.Z)(this,"map",void 0),(0,m.Z)(this,"dragging",!1),(0,m.Z)(this,"sceneCenter",void 0),(0,m.Z)(this,"sceneCenterMKT",void 0),(0,m.Z)(this,"bgColor","rgba(0, 0, 0, 0)"),(0,Ti.Z)(this,"configService",wc,this),(0,Ti.Z)(this,"config",Ec,this),(0,Ti.Z)(this,"coordinateSystemService",Sc,this),(0,Ti.Z)(this,"eventEmitter",Cc,this),(0,m.Z)(this,"markerContainer",void 0),(0,m.Z)(this,"$mapContainer",void 0),(0,m.Z)(this,"viewport",void 0),(0,m.Z)(this,"cameraChangedCallback",void 0),(0,m.Z)(this,"handleViewChanged",(function(t){var n=e.map.customCoords.getCameraParams(),r=n.fov,i=n.near,o=n.far,a=n.aspect,s=n.position,u=n.lookAt,l=n.up;e.emit("mapchange");var c=t.zoom,h=e.map.customCoords.getCenter();e.cameraChangedCallback&&(e.viewport.syncWithMapCamera({aspect:a,far:o,fov:r,cameraPosition:s,lookAt:u,up:l,near:i,zoom:c-1,center:h,offsetOrigin:[s[0],s[1]]}),e.coordinateSystemService.setCoordinateSystem(Ei.P20_2),e.cameraChangedCallback(e.viewport))}))}var e;return(0,F.Z)(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"setCustomCoordCenter",value:function(t){var e;this.sceneCenter=t,this.sceneCenterMKT=(e=this.map.getProjection()).project.apply(e,(0,y.Z)(this.sceneCenter))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMKT}},{key:"lngLatToCoord",value:function(t){var e=this.map.getProjection().project;return this.sceneCenter||(this.map.customCoords.setCenter(t),this.setCustomCoordCenter(t)),this._sub(e(t[0],t[1]),this.sceneCenterMKT)}},{key:"lngLatToCoords",value:function(t){var e=this;return t.map((function(t){return"number"==typeof t[0]?e.lngLatToCoord(t):t.map((function(t){return e.lngLatToCoord(t)}))}))}},{key:"addMarkerContainer",value:function(){if(this.map){var t=this.map.getContainer();if(null!==t){var e=t.getElementsByClassName("amap-maps")[0];e.style.zIndex="auto",this.markerContainer=Se("div","l7-marker-container2",e)}}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==xu.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(t,e)}},{key:"off",value:function(t,e){-1!==xu.indexOf(t)?this.eventEmitter.off(t,e):this.map.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return null===(t=this.map.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap2"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(null!=t&&t.padding){var e=this.getCenter(),n=this.getSize(),r=(0,R.Z)(n,2),i=(r[0],r[1],Hl(t.padding)),o=this.lngLatToPixel([e.lng,e.lat]),a=[(i.right-i.left)/2,(i.bottom-i.top)/2];return this.pixelToLngLat([o.x-a[0],o.y-a[1]])}var s=this.map.getCenter();return{lng:s.getLng(),lat:s.getLat()}}},{key:"setCenter",value:function(t,e){if(null!=e&&e.padding){var n=Hl(e.padding),r=this.lngLatToPixel(t),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds(),e=t.getNorthEast(),n=t.getSouthWest(),r=this.getCenter(),i=r.lng>e.getLng()||r.lng<n.getLng()?180-e.getLng():e.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,e.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.getZooms()[0]-1}},{key:"getMaxZoom",value:function(){return this.map.getZooms()[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(t,e)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,e){this.map.setZoomAndCenter(t,e)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyle(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"pixelToLngLat",value:function(t){var e=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:e.getLng(),lat:e.getLat()}}},{key:"lngLatToPixel",value:function(t){var e=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:e.getX(),y:e.getY()}}},{key:"containerToLngLat",value:function(t){var e=new AMap.Pixel(t[0],t[1]),n=this.map.containerToLngLat(e);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(t){var e=new AMap.LngLat(t[0],t[1]),n=this.map.lngLatToContainer(e);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToMercator",value:function(t,e){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.map.customCoords.lngLatToCoord(t),o=li.create();return li.translate(o,o,Gl.fromValues(i[0],i[1],e)),li.scale(o,o,Gl.fromValues(r[0],r[1],r[2])),li.rotateX(o,o,n[0]),li.rotateY(o,o,n[1]),li.rotateZ(o,o,n[2]),o}},{key:"init",value:(e=(0,lo.Z)(ho().mark((function t(){var e,n,r,i,o,a,s,u,l,c,h,f,p,d,g,v,m=this;return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config,n=e.id,r=e.style,i=void 0===r?"light":r,o=e.minZoom,a=void 0===o?0:o,s=e.maxZoom,u=void 0===s?18:s,l=e.token,c=void 0===l?Rc:l,h=e.mapInstance,f=e.plugin,p=void 0===f?[]:f,d=e.version,g=void 0===d?"2.0":d,v=Mo(e,Mc),t.next=3,new Promise((function(t){var e=function(){if(h){var e;m.map=h,m.$mapContainer=m.map.getContainer();var r=m.map.getCenter();null===(e=m.map.customCoords)||void 0===e||e.setCenter([r.lng,r.lat]),m.setCustomCoordCenter([r.lng,r.lat]),setTimeout((function(){m.map.on("viewchange",m.handleViewChanged),t()}),30)}else{m.$mapContainer=m.creatAmapContainer(n);var o=Ic({mapStyle:m.getMapStyle(i),zooms:[a,u],viewMode:"3D"},v);o.zoom&&(o.zoom+=1);var s=new AMap.Map(m.$mapContainer,o);m.map=s;var l=s.getCenter();s.customCoords.setCenter([l.lng,l.lat]),m.setCustomCoordCenter([l.lng,l.lat]),s.on("viewchange",m.handleViewChanged),setTimeout((function(){t()}),10)}};m.viewport=new kc,Lc||h?Lc&&window.AMap||h?e():Dc.push(e):(c===Rc&&console.warn(m.configService.getSceneWarninfo("MapToken")),Lc=!0,p.push("Map3D"),Ul().load({key:c,version:g,plugins:p}).then((function(t){e(),Dc.length&&(Dc.forEach((function(t){return t()})),Dc=[])})).catch((function(t){throw new Error(t)})))}));case 3:this.map.on("dragstart",(function(){return m.dragging=!0,""})),this.map.on("dragend",(function(){return m.dragging=!1,""}));case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"meterToCoord",value:function(t,e){var n=AMap.GeometryUtil.distance(Ze(AMap.LngLat,(0,y.Z)(t)),Ze(AMap.LngLat,(0,y.Z)(e))),r=this.lngLatToCoord(t),i=(0,R.Z)(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(e),u=(0,R.Z)(s,2),l=u[0],c=u[1];return Math.sqrt(Math.pow(o-l,2)+Math.pow(a-c,2))/n}},{key:"exportMap",value:function(t){var e,n=null===(e=this.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-layer")[0];return"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"destroy",value:function(){var t,e;this.map.destroy(),null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),delete window.initAMap;var n=document.getElementById("amap-script");n&&document.head.removeChild(n)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"initViewPort",value:function(){var t,e=null===(t=this.map.customCoords)||void 0===t?void 0:t.getCameraParams(),n=e.fov,r=e.near,i=e.far,o=e.aspect,a=e.position,s=e.lookAt,u=e.up;this.emit("mapchange");var l=this.map.customCoords.getCenter(),c=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:o,far:i,fov:n,cameraPosition:a,lookAt:s,near:r,up:u,zoom:c-1,center:l,offsetOrigin:[a[0],a[1]]}),this.coordinateSystemService.setCoordinateSystem(Ei.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(t,e){var n=[0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n}},{key:"getMapStyle",value:function(t){return Tc[t]?Tc[t]:t}},{key:"creatAmapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_amap_div"+Oc++,e.appendChild(n),n}}]),t}(),wc=(0,ki.Z)(xc.prototype,"configService",[vc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ec=(0,ki.Z)(xc.prototype,"config",[mc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sc=(0,ki.Z)(xc.prototype,"coordinateSystemService",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cc=(0,ki.Z)(xc.prototype,"eventEmitter",[_c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bc=xc))||bc);var Bc,zc=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getServiceConstructor",value:function(){return Nc}}]),i}(Zl),Fc=n(9874),Zc=n.n(Fc);function jc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Uc(t,e,n){var r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function Gc(t,e,n){return Math.min(n,Math.max(e,t))}function Vc(t,e,n){return t*(1-n)+e*n}function Wc(t,e,n,r){var i=new(Zc())(t,e,n,r);return function(t){return i.solve(t)}}var Hc=Wc(.25,.1,.25,1);function Xc(){return!(ve||!ye.matchMedia)&&(null==Bc&&(Bc=ye.matchMedia("(prefers-reduced-motion: reduce)")),Bc.matches)}function Yc(t,e){var n,r={},i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return jc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jc(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in t&&(r[o]=t[o])}}catch(t){i.e(t)}finally{i.f()}return r}var qc=ve?Date.now.bind(Date):ye.performance&&ye.performance.now?ye.performance.now.bind(ye.performance):Date.now.bind(Date),Kc=ye.requestAnimationFrame||ye.mozRequestAnimationFrame||ye.webkitRequestAnimationFrame||ye.msRequestAnimationFrame,Qc=ye.cancelAnimationFrame||ye.mozCancelAnimationFrame||ye.webkitCancelAnimationFrame||ye.msCancelAnimationFrame;function Jc(t){var e=Kc(t);return{cancel:function(){return Qc(e)}}}var $c=6371008.8,th=function(){function t(e,n){if((0,z.Z)(this,t),(0,m.Z)(this,"lng",void 0),(0,m.Z)(this,"lat",void 0),isNaN(e)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(n,")"));if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return(0,F.Z)(t,[{key:"wrap",value:function(){return new t(Uc(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(t){var e=Math.PI/180,n=this.lat*e,r=t.lat*e,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return $c*Math.acos(Math.min(i,1))}}],[{key:"convert",value:function(e){if(e instanceof t)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new t(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"===(0,Rt.Z)(e)&&null!==e){var n="lng"in e?e.lng:e.lon;return new t(Number(n),Number(e.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),t}(),eh=function(){function t(e,n){(0,z.Z)(this,t),(0,m.Z)(this,"ne",void 0),(0,m.Z)(this,"sw",void 0),e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}return(0,F.Z)(t,[{key:"setNorthEast",value:function(t){return this.ne=t instanceof th?new th(t.lng,t.lat):th.convert(t),this}},{key:"setSouthWest",value:function(t){return this.sw=t instanceof th?new th(t.lng,t.lat):th.convert(t),this}},{key:"extend",value:function(e){var n,r,i=this.sw,o=this.ne;if(e instanceof th)n=e,r=e;else{if(!(e instanceof t)){if(Array.isArray(e)){if(4===e.length||e.every(Array.isArray)){var a=e;return this.extend(t.convert(a))}var s=e;return this.extend(th.convert(s))}return this}if(n=e.sw,r=e.ne,!n||!r)return this}return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this.sw=new th(n.lng,n.lat),this.ne=new th(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new th((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new th(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new th(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(t){var e=th.convert(t),n=e.lng,r=e.lat,i=this.sw.lat<=r&&r<=this.ne.lat,o=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(o=this.sw.lng>=n&&n>=this.ne.lng),i&&o}}],[{key:"convert",value:function(e){return e instanceof t?e:new t(e)}}]),t}(),nh=function(){function t(e,n){(0,z.Z)(this,t),(0,m.Z)(this,"x",void 0),(0,m.Z)(this,"y",void 0),this.x=e,this.y=n}return(0,F.Z)(t,[{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"_add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"add",value:function(t){return this.clone()._add(t)}},{key:"_sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"sub",value:function(t){return this.clone()._sub(t)}},{key:"_multByPoint",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multByPoint",value:function(t){return this.clone()._multByPoint(t)}},{key:"_divByPoint",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divByPoint",value:function(t){return this.clone()._divByPoint(t)}},{key:"_mult",value:function(t){return this.x*=t,this.y*=t,this}},{key:"mult",value:function(t){return this.clone()._mult(t)}},{key:"_div",value:function(t){return this.x/=t,this.y/=t,this}},{key:"div",value:function(t){return this.clone()._div(t)}},{key:"_rotate",value:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(t){return this.clone()._rotate(t)}},{key:"_rotateAround",value:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this}},{key:"roateAround",value:function(t,e){return this.clone()._rotateAround(t,e)}},{key:"_matMult",value:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this}},{key:"matMult",value:function(t){return this.clone()._matMult(t)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var t=this.y;return this.y=this.x,this.x=-t,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"dist",value:function(t){return Math.sqrt(this.distSqr(t))}},{key:"distSqr",value:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(t){return Math.atan2(this.y-t.y,this.x-t.x)}},{key:"angleWith",value:function(t){return this.angleWithSep(t.x,t.y)}},{key:"angleWithSep",value:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)}}],[{key:"convert",value:function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e}}]),t}(),rh=n(9685),ih=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if((0,z.Z)(this,t),(0,m.Z)(this,"top",void 0),(0,m.Z)(this,"bottom",void 0),(0,m.Z)(this,"left",void 0),(0,m.Z)(this,"right",void 0),isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=r,this.right=i}return(0,F.Z)(t,[{key:"interpolate",value:function(t,e,n){return null!=e.top&&null!=t.top&&(this.top=Vc(t.top,e.top,n)),null!=e.bottom&&null!=t.bottom&&(this.bottom=Vc(t.bottom,e.bottom,n)),null!=e.left&&null!=t.left&&(this.left=Vc(t.left,e.left,n)),null!=e.right&&null!=t.right&&(this.right=Vc(t.right,e.right,n)),this}},{key:"getCenter",value:function(t,e){var n=Gc((this.left+t-this.right)/2,0,t),r=Gc((this.top+e-this.bottom)/2,0,e);return new nh(n,r)}},{key:"equals",value:function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}},{key:"clone",value:function(){return new t(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),t}(),oh=2*Math.PI*$c;function ah(t){return oh*Math.cos(t*Math.PI/180)}function sh(t){return(180+t)/360}function uh(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function lh(t,e){return t/ah(e)}function ch(t){var e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}var hh=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,z.Z)(this,t),(0,m.Z)(this,"x",void 0),(0,m.Z)(this,"y",void 0),(0,m.Z)(this,"z",void 0),this.x=+e,this.y=+n,this.z=+r}return(0,F.Z)(t,[{key:"toLngLat",value:function(){return new th(360*this.x-180,ch(this.y))}},{key:"toAltitude",value:function(){return this.z*ah(ch(this.y))}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/oh*(t=ch(this.y),1/Math.cos(t*Math.PI/180));var t}}],[{key:"fromLngLat",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=th.convert(e);return new t(sh(r.lng),uh(r.lat),lh(n,r.lat))}}]),t}();function fh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ph=function(){function t(e,n,r,i,o){(0,z.Z)(this,t),(0,m.Z)(this,"tileSize",void 0),(0,m.Z)(this,"tileZoom",void 0),(0,m.Z)(this,"lngRange",void 0),(0,m.Z)(this,"latRange",void 0),(0,m.Z)(this,"maxValidLatitude",void 0),(0,m.Z)(this,"scale",void 0),(0,m.Z)(this,"width",void 0),(0,m.Z)(this,"height",void 0),(0,m.Z)(this,"angle",void 0),(0,m.Z)(this,"rotationMatrix",void 0),(0,m.Z)(this,"pixelsToGLUnits",void 0),(0,m.Z)(this,"cameraToCenterDistance",void 0),(0,m.Z)(this,"mercatorMatrix",void 0),(0,m.Z)(this,"projMatrix",void 0),(0,m.Z)(this,"invProjMatrix",void 0),(0,m.Z)(this,"alignedProjMatrix",void 0),(0,m.Z)(this,"pixelMatrix",void 0),(0,m.Z)(this,"pixelMatrixInverse",void 0),(0,m.Z)(this,"glCoordMatrix",void 0),(0,m.Z)(this,"labelPlaneMatrix",void 0),(0,m.Z)(this,"_fov",void 0),(0,m.Z)(this,"_pitch",void 0),(0,m.Z)(this,"_zoom",void 0),(0,m.Z)(this,"_renderWorldCopies",void 0),(0,m.Z)(this,"_minZoom",void 0),(0,m.Z)(this,"_maxZoom",void 0),(0,m.Z)(this,"_minPitch",void 0),(0,m.Z)(this,"_maxPitch",void 0),(0,m.Z)(this,"_center",void 0),(0,m.Z)(this,"zoomFraction",void 0),(0,m.Z)(this,"unmodified",void 0),(0,m.Z)(this,"edgeInsets",void 0),(0,m.Z)(this,"constraining",void 0),(0,m.Z)(this,"posMatrixCache",void 0),(0,m.Z)(this,"alignedPosMatrixCache",void 0),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new th(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new ih,this.posMatrixCache={},this.alignedPosMatrixCache={}}return(0,F.Z)(t,[{key:"minZoom",get:function(){return this._minZoom},set:function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}},{key:"minPitch",get:function(){return this._minPitch},set:function(t){this._minPitch!==t&&(this._minPitch=t,this._pitch=Math.max(this._pitch,t))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(t){this._maxPitch!==t&&(this._maxPitch=t,this._pitch=Math.min(this._pitch,t))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new nh(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(t){var e,n=-Uc(t,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=(e=new rh.WT(4),rh.WT!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e),function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u}(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(t){var e=Gc(t,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==e&&(this.unmodified=!1,this._pitch=e,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this.unmodified=!1,this._fov=t/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(t){var e=Math.min(Math.max(t,this._minZoom),this._maxZoom);this._zoom!==e&&(this.unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this.unmodified=!1,this._center=t,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(t){this.edgeInsets.equals(t)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,t,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var e=new t(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e.center=this._center,e.zoom=this.zoom,e.angle=this.angle,e.fov=this._fov,e.pitch=this._pitch,e.unmodified=this.unmodified,e.edgeInsets=this.edgeInsets.clone(),e.calcMatrices(),e}},{key:"isPaddingEqual",value:function(t){return this.edgeInsets.equals(t)}},{key:"interpolatePadding",value:function(t,e,n){this.unmodified=!1,this.edgeInsets.interpolate(t,e,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(t){return Math.pow(2,t)}},{key:"scaleZoom",value:function(t){return Math.log(t)/Math.LN2}},{key:"project",value:function(t){var e=Gc(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new nh(sh(t.lng)*this.worldSize,uh(e)*this.worldSize)}},{key:"unproject",value:function(t){return new hh(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(t,e){var n=this.pointCoordinate(e),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(t),o=new hh(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(t){var e=new Float64Array([t.x,t.y,0,1]),n=new Float64Array([t.x,t.y,1,1]);Mi.fF(e,e,this.pixelMatrixInverse),Mi.fF(n,n,this.pixelMatrixInverse);var r=e[3],i=n[3],o=e[0]/r,a=n[0]/i,s=e[1]/r,u=n[1]/i,l=e[2]/r,c=n[2]/i,h=l===c?0:(0-l)/(c-l);return new hh(Vc(o,a,h)/this.worldSize,Vc(s,u,h)/this.worldSize)}},{key:"getBounds",value:function(){return(new eh).extend(this.pointLocation(new nh(0,0))).extend(this.pointLocation(new nh(this.width,0))).extend(this.pointLocation(new nh(this.width,this.height))).extend(this.pointLocation(new nh(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new eh([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new nh(0,0)),e=new Float32Array([t.x*this.worldSize,t.y*this.worldSize,0,1]);return Mi.fF(e,e,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var t=this._pitch,e=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new nh(0,e))}},{key:"getCameraQueryGeometry",value:function(t){var e=this.getCameraPoint();if(1===t.length)return[t[0],e];var n,r=e.x,i=e.y,o=e.x,a=e.y,s=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return fh(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fh(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(t);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(t){s.e(t)}finally{s.f()}return[new nh(r,i),new nh(o,i),new nh(o,a),new nh(r,a),new nh(r,i)]}},{key:"coordinatePoint",value:function(t){var e=Mi.al(t.x*this.worldSize,t.y*this.worldSize,0,1);return Mi.fF(e,e,this.pixelMatrix),new nh(e[0]/e[3],e[1]/e[3])}},{key:"locationPoint",value:function(t){return this.coordinatePoint(this.locationCoordinate(t))}},{key:"pointLocation",value:function(t){return this.coordinateLocation(this.pointCoordinate(t))}},{key:"locationCoordinate",value:function(t){return hh.fromLngLat(t)}},{key:"coordinateLocation",value:function(t){return t.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var t,e,n,r,i=-90,o=90,a=-180,s=180,u=this.size,l=this.unmodified;if(this.latRange){var c=this.latRange;i=uh(c[1])*this.worldSize,t=(o=uh(c[0])*this.worldSize)-i<u.y?u.y/(o-i):0}if(this.lngRange){var h=this.lngRange;a=sh(h[0])*this.worldSize,e=(s=sh(h[1])*this.worldSize)-a<u.x?u.x/(s-a):0}var f=this.point,p=Math.max(e||0,t||0);if(p)return this.center=this.unproject(new nh(e?(s+a)/2:f.x,t?(o+i)/2:f.y)),ve?this.zoom=Math.max(this.zoom,Math.max(-1,this.minZoom)):this.zoom+=this.scaleZoom(p),this.unmodified=l,void(this.constraining=!1);if(this.latRange){var d=f.y,g=u.y/2;d-g<i&&(r=i+g),d+g>o&&(r=o-g)}if(this.lngRange){var v=f.x,m=u.x/2;v-m<a&&(n=a+m),v+m>s&&(n=s-m)}void 0===n&&void 0===r||(this.center=this.unproject(new nh(void 0!==n?n:f.x,void 0!==r?r:f.y))),this.unmodified=l,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var t=this._fov/2,e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(t)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+e.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(Gc(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);li.perspective(c,this._fov,this.width/this.height,l,u),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,li.scale(c,c,[1,-1,1]),li.translate(c,c,[0,0,-this.cameraToCenterDistance]),li.rotateX(c,c,this._pitch),li.rotateZ(c,c,this.angle),li.translate(c,c,[-a,-s,0]),this.mercatorMatrix=li.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),li.scale(c,c,[1,1,lh(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=li.invert([],this.projMatrix);var h=this.width%2/2,f=this.height%2/2,p=Math.cos(this.angle),d=Math.sin(this.angle),g=a-Math.round(a)+p*h+d*f,v=s-Math.round(s)+p*f+d*h,m=new Float64Array(c);if(li.translate(m,m,[g>.5?g-1:g,v>.5?v-1:v,0]),this.alignedProjMatrix=m,c=li.create(),li.scale(c,c,[this.width/2,-this.height/2,1]),li.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=li.create(),li.scale(c,c,[1,-1,1]),li.translate(c,c,[-1,-1,0]),li.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=li.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=li.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),t}(),dh=(0,F.Z)((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,z.Z)(this,t),(0,m.Z)(this,"type",void 0),yi()(this,n),this.type=e}));var gh=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){var e;(0,z.Z)(this,i),e=r.call(this),(0,m.Z)((0,H.Z)(e),"transform",void 0),(0,m.Z)((0,H.Z)(e),"options",void 0),(0,m.Z)((0,H.Z)(e),"moving",void 0),(0,m.Z)((0,H.Z)(e),"zooming",void 0),(0,m.Z)((0,H.Z)(e),"rotating",void 0),(0,m.Z)((0,H.Z)(e),"pitching",void 0),(0,m.Z)((0,H.Z)(e),"padding",void 0),(0,m.Z)((0,H.Z)(e),"bearingSnap",void 0),(0,m.Z)((0,H.Z)(e),"easeEndTimeoutID",void 0),(0,m.Z)((0,H.Z)(e),"easeStart",void 0),(0,m.Z)((0,H.Z)(e),"easeOptions",void 0),(0,m.Z)((0,H.Z)(e),"easeId",void 0),(0,m.Z)((0,H.Z)(e),"onEaseFrame",void 0),(0,m.Z)((0,H.Z)(e),"onEaseEnd",void 0),(0,m.Z)((0,H.Z)(e),"easeFrameId",void 0),(0,m.Z)((0,H.Z)(e),"renderFrameCallback",(function(){var t=Math.min((qc()-e.easeStart)/e.easeOptions.duration,1);e.onEaseFrame(e.easeOptions.easing(t)),t<1?e.easeFrameId=e.requestRenderFrame(e.renderFrameCallback):e.stop()})),e.options=t;var n=t.minZoom,o=t.maxZoom,a=t.minPitch,s=t.maxPitch,u=t.renderWorldCopies;return e.moving=!1,e.zooming=!1,e.bearingSnap=t.bearingSnap,e.transform=new ph(n,o,a,s,u),e}return(0,F.Z)(i,[{key:"requestRenderFrame",value:function(t){return 0}},{key:"cancelRenderFrame",value:function(t){}},{key:"getCenter",value:function(){var t=this.transform.center,e=t.lng,n=t.lat;return new th(e,n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(t,e){return this.jumpTo({center:t},e)}},{key:"setPitch",value:function(t,e){return this.jumpTo({pitch:t},e),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(t,e,n){return this.easeTo(yi()({center:t},e),n)}},{key:"zoomOut",value:function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}},{key:"setBearing",value:function(t,e){return this.jumpTo({bearing:t},e),this}},{key:"setZoom",value:function(t,e){return this.jumpTo({zoom:t},e),this}},{key:"zoomIn",value:function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}},{key:"zoomTo",value:function(t,e,n){return this.easeTo(yi()({zoom:t},e),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(t,e){return this.jumpTo({padding:t},e),this}},{key:"rotateTo",value:function(t,e,n){return this.easeTo(yi()({bearing:t},e),n)}},{key:"resetNorth",value:function(t,e){return this.rotateTo(0,yi()({duration:1e3},t),e),this}},{key:"resetNorthPitch",value:function(t,e){return this.easeTo(yi()({bearing:0,pitch:0,duration:1e3},t),e),this}},{key:"fitBounds",value:function(t,e,n){return this.fitInternal(this.cameraForBounds(t,e),e,n)}},{key:"cameraForBounds",value:function(t,e){return t=eh.convert(t),this.cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),0,e)}},{key:"snapToNorth",value:function(t,e){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(t,e):this}},{key:"jumpTo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,o=!1;return t.zoom&&n.zoom!==+t.zoom&&(r=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=th.convert(t.center)),t.bearing&&n.bearing!==+t.bearing&&(i=!0,n.bearing=+t.bearing),t.pitch&&n.pitch!==+t.pitch&&(o=!0,n.pitch=+t.pitch),null==t.padding||n.isPaddingEqual(t.padding)||(n.padding=t.padding),this.emit("movestart",new dh("movestart",e)),this.emit("move",new dh("move",e)),r&&(this.emit("zoomstart",new dh("zoomstart",e)),this.emit("zoom",new dh("zoom",e)),this.emit("zoomend",new dh("zoomend",e))),i&&(this.emit("rotatestart",new dh("rotatestart",e)),this.emit("rotate",new dh("rotate",e)),this.emit("rotateend",new dh("rotateend",e))),o&&(this.emit("pitchstart",new dh("pitchstart",e)),this.emit("pitch",new dh("pitch",e)),this.emit("pitchend",new dh("pitchend",e))),this.emit("moveend",new dh("moveend",e))}},{key:"easeTo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;(!1===(e=yi()({offset:[0,0],duration:500,easing:Hc},e)).animate||!e.essential&&Xc())&&(e.duration=0);var r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),u=e.zoom?+e.zoom:i,l=e.bearing?this.normalizeBearing(e.bearing,o):o,c=e.pitch?+e.pitch:a,h=e.padding?e.padding:r.padding,f=nh.convert(e.offset),p=r.centerPoint.add(f),d=r.pointLocation(p),g=th.convert(e.center||d);this.normalizeCenter(g);var v,m,y=r.project(d),_=r.project(g).sub(y),b=r.zoomScale(u-i);e.around&&(v=th.convert(e.around),m=r.locationPoint(v));var x={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||u!==i,this.rotating=this.rotating||o!==l,this.pitching=this.pitching||c!==a,this.padding=!r.isPaddingEqual(h),this.easeId=e.easeId,this.prepareEase(n,e.noMoveStart,x),clearTimeout(this.easeEndTimeoutID),this.ease((function(e){if(t.zooming&&(r.zoom=Vc(i,u,e)),t.rotating&&(r.bearing=Vc(o,l,e)),t.pitching&&(r.pitch=Vc(a,c,e)),t.padding&&(r.interpolatePadding(s,h,e),p=r.centerPoint.add(f)),v)r.setLocationAtPoint(v,m);else{var d=r.zoomScale(r.zoom-i),g=u>i?Math.min(2,b):Math.max(.5,b),x=Math.pow(g,1-e),w=r.unproject(y.add(_.mult(e*x)).mult(d));r.setLocationAtPoint(r.renderWorldCopies?w.wrap():w,p)}t.fireMoveEvents(n)}),(function(e){t.afterEase(n,e)}),e),this}},{key:"flyTo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!e.essential&&Xc()){var r=Yc(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),e=yi()({offset:[0,0],speed:1.2,curve:1.42,easing:Hc},e);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l=e.zoom?Gc(+e.zoom,i.minZoom,i.maxZoom):o,c=e.bearing?this.normalizeBearing(e.bearing,a):a,h=e.pitch?+e.pitch:s,f="padding"in e?e.padding:i.padding,p=i.zoomScale(l-o),d=nh.convert(e.offset),g=i.centerPoint.add(d),v=i.pointLocation(g),m=th.convert(e.center||v);this.normalizeCenter(m);var y=i.project(v),_=i.project(m).sub(y),b=e.curve,x=Math.max(i.width,i.height),w=x/p,E=_.mag();if("minZoom"in e){var S=Gc(Math.min(e.minZoom,o,l),i.minZoom,i.maxZoom),C=x/i.zoomScale(S-o);b=Math.sqrt(C/E*2)}var A=b*b;function T(t){var e=(w*w-x*x+(t?-1:1)*A*A*E*E)/(2*(t?w:x)*A*E);return Math.log(Math.sqrt(e*e+1)-e)}function k(t){return(Math.exp(t)-Math.exp(-t))/2}function M(t){return(Math.exp(t)+Math.exp(-t))/2}function P(t){return k(t)/M(t)}var I=T(0),O=function(t){return M(I)/M(I+b*t)},R=function(t){return x*((M(I)*P(I+b*t)-k(I))/A)/E},L=(T(1)-I)/b;if(Math.abs(E)<1e-6||!isFinite(L)){if(Math.abs(x-w)<1e-6)return this.easeTo(e,n);var D=w<x?-1:1;L=Math.abs(Math.log(w/x))/b,R=function(){return 0},O=function(t){return Math.exp(D*b*t)}}if("duration"in e)e.duration=+e.duration;else{var N="screenSpeed"in e?+e.screenSpeed/b:+e.speed;e.duration=1e3*L/N}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this.zooming=!0,this.rotating=a!==c,this.pitching=h!==s,this.padding=!i.isPaddingEqual(f),this.prepareEase(n,!1),this.ease((function(e){var r=e*L,p=1/O(r);i.zoom=1===e?l:o+i.scaleZoom(p),t.rotating&&(i.bearing=Vc(a,c,e)),t.pitching&&(i.pitch=Vc(s,h,e)),t.padding&&(i.interpolatePadding(u,f,e),g=i.centerPoint.add(d));var v=1===e?m:i.unproject(y.add(_.mult(R(r))).mult(p));i.setLocationAtPoint(i.renderWorldCopies?v.wrap():v,g),t.fireMoveEvents(n)}),(function(){return t.afterEase(n)}),e),this}},{key:"fitScreenCoordinates",value:function(t,e,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(nh.convert(t)),this.transform.pointLocation(nh.convert(e)),n,r),r,i)}},{key:"stop",value:function(t,e){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,e)}return this}},{key:"normalizeBearing",value:function(t,e){t=Uc(t,-180,180);var n=Math.abs(t-e);return Math.abs(t-360-e)<n&&(t-=360),Math.abs(t+360-e)<n&&(t+=360),t}},{key:"normalizeCenter",value:function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(t){this.emit("move",new dh("move",t)),this.zooming&&this.emit("zoom",new dh("zoom",t)),this.rotating&&this.emit("rotate",new dh("rotate",t)),this.pitching&&this.emit("rotate",new dh("pitch",t))}},{key:"prepareEase",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,e||n.moving||this.emit("movestart",new dh("movestart",t)),this.zooming&&!n.zooming&&this.emit("zoomstart",new dh("zoomstart",t)),this.rotating&&!n.rotating&&this.emit("rotatestart",new dh("rotatestart",t)),this.pitching&&!n.pitching&&this.emit("pitchstart",new dh("pitchstart",t))}},{key:"afterEase",value:function(t,e){if(!this.easeId||!e||this.easeId!==e){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new dh("zoomend",t)),r&&this.emit("rotateend",new dh("rotateend",t)),i&&this.emit("pitchend",new dh("pitchend",t)),this.emit("moveend",new dh("moveend",t))}}},{key:"ease",value:function(t,e,n){!1===n.animate||0===n.duration?(t(1),e()):(this.easeStart=qc(),this.easeOptions=n,this.onEaseFrame=t,this.onEaseEnd=e,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(t,e,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=yi()({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=yi()(i,r.padding);var a=this.transform,s=a.padding,u=a.project(th.convert(t)),l=a.project(th.convert(e)),c=u.rotate(-n*Math.PI/180),h=l.rotate(-n*Math.PI/180),f=new nh(Math.max(c.x,h.x),Math.max(c.y,h.y)),p=new nh(Math.min(c.x,h.x),Math.min(c.y,h.y)),d=f.sub(p),g=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,v=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(v<0||g<0)){var m=Math.min(a.scaleZoom(a.scale*Math.min(g,v)),r.maxZoom),y=nh.convert(r.offset),_=(r.padding.left-r.padding.right)/2,b=(r.padding.top-r.padding.bottom)/2,x=new nh(y.x+_,y.y+b).mult(a.scale/a.zoomScale(m));return{center:a.unproject(u.add(l).div(2).sub(x)),zoom:m,bearing:n}}}},{key:"fitInternal",value:function(t,e,n){return t?(delete(e=yi()(t,e)).padding,e.linear?this.easeTo(e,n):this.flyTo(e,n)):this}}]),i}(fr.EventEmitter);function vh(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return mh(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mh(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function mh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var yh={};const _h=yh;yh.create=function(t,e,n){var r=ye.document.createElement(t);return void 0!==e&&(r.className=e),n&&n.appendChild(r),r},yh.createNS=function(t,e){return ye.document.createElementNS(t,e)};var bh=ye.document&&ye.document.documentElement.style;function xh(t){if(!bh)return t[0];var e,n=vh(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r in bh)return r}}catch(t){n.e(t)}finally{n.f()}return t[0]}var wh,Eh=xh(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);yh.disableDrag=function(){bh&&Eh&&(wh=bh[Eh],bh[Eh]="none")},yh.enableDrag=function(){bh&&Eh&&(bh[Eh]=wh)};var Sh=xh(["transform","WebkitTransform"]);yh.setTransform=function(t,e){t.style[Sh]=e};var Ch=!1;try{var Ah=Object.defineProperty({},"passive",{get:function(){Ch=!0}});ye.addEventListener("test",Ah,Ah),ye.removeEventListener("test",Ah,Ah)}catch(t){Ch=!1}yh.addEventListener=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&Ch?t.addEventListener(e,n,r):t.addEventListener(e,n,r.capture)},yh.removeEventListener=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&Ch?t.removeEventListener(e,n,r):t.removeEventListener(e,n,r.capture)};var Th=function t(e){e.preventDefault(),e.stopPropagation(),ye.removeEventListener("click",t,!0)};yh.suppressClick=function(){ve||(ye.addEventListener("click",Th,!0),setTimeout((function(){ye.removeEventListener("click",Th,!0)}),0))},yh.mousePos=function(t,e){if(ve)return new nh(e.clientX-t.left-0,e.clientY-t.top-0);var n=t.getBoundingClientRect();return new nh(e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop)},yh.touchPos=function(t,e){if(ve){var n,r=[],i=vh(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;r.push(new nh(o.clientX-t.left,o.clientY-t.top))}}catch(t){i.e(t)}finally{i.f()}return r}var a,s=t.getBoundingClientRect(),u=[],l=vh(e);try{for(l.s();!(a=l.n()).done;){var c=a.value;u.push(new nh(c.clientX-s.left-t.clientLeft,c.clientY-s.top-t.clientTop))}}catch(t){l.e(t)}finally{l.f()}return u},yh.mouseButton=function(t){return ve&&void 0!==ye.InstallTrigger&&2===t.button&&t.ctrlKey&&ye.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},yh.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var kh=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t,e,n){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,z.Z)(this,i);var s=_h.mousePos(e.getCanvasContainer(),n),u=e.unproject(s);return o=r.call(this,t,yi()({point:s,lngLat:u,originalEvent:n},a)),(0,m.Z)((0,H.Z)(o),"type",void 0),(0,m.Z)((0,H.Z)(o),"target",void 0),(0,m.Z)((0,H.Z)(o),"originalEvent",void 0),(0,m.Z)((0,H.Z)(o),"point",void 0),(0,m.Z)((0,H.Z)(o),"lngLat",void 0),(0,m.Z)((0,H.Z)(o),"defaultPrevented",void 0),o.defaultPrevented=!1,o.target=e,o}return(0,F.Z)(i,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),i}(dh);var Mh=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t,e,n){var o;(0,z.Z)(this,i);var a="touchend"===t?n.changedTouches:n.touches,s=_h.touchPos(e.getCanvasContainer(),a),u=s.map((function(t){return e.unproject(t)})),l=s.reduce((function(t,e,n,r){return t.add(e.div(r.length))}),new nh(0,0)),c=e.unproject(l);return o=r.call(this,t,{points:s,point:l,lngLats:u,lngLat:c,originalEvent:n}),(0,m.Z)((0,H.Z)(o),"type",void 0),(0,m.Z)((0,H.Z)(o),"target",void 0),(0,m.Z)((0,H.Z)(o),"originalEvent",void 0),(0,m.Z)((0,H.Z)(o),"lngLat",void 0),(0,m.Z)((0,H.Z)(o),"point",void 0),(0,m.Z)((0,H.Z)(o),"points",void 0),(0,m.Z)((0,H.Z)(o),"lngLats",void 0),(0,m.Z)((0,H.Z)(o),"defaultPrevented",void 0),o.defaultPrevented=!1,o}return(0,F.Z)(i,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),i}(dh);var Ph=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t,e,n){var o;return(0,z.Z)(this,i),o=r.call(this,t,{originalEvent:n}),(0,m.Z)((0,H.Z)(o),"type",void 0),(0,m.Z)((0,H.Z)(o),"originalEvent",void 0),(0,m.Z)((0,H.Z)(o),"defaultPrevented",void 0),(0,m.Z)((0,H.Z)(o),"target",void 0),o.defaultPrevented=!1,o}return(0,F.Z)(i,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),i}(dh),Ih=function(){function t(e){(0,z.Z)(this,t),(0,m.Z)(this,"map",void 0),(0,m.Z)(this,"delayContextMenu",void 0),(0,m.Z)(this,"contextMenuEvent",void 0),this.map=e}return(0,F.Z)(t,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(t){this.map.emit(t.type,new kh(t.type,this.map,t))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new kh("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(t){this.delayContextMenu?this.contextMenuEvent=t:this.map.emit(t.type,new kh(t.type,this.map,t)),this.map.listeners("contextmenu")&&t.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),t}(),Oh=function(){function t(e,n){(0,z.Z)(this,t),(0,m.Z)(this,"map",void 0),(0,m.Z)(this,"el",void 0),(0,m.Z)(this,"container",void 0),(0,m.Z)(this,"enabled",void 0),(0,m.Z)(this,"active",void 0),(0,m.Z)(this,"startPos",void 0),(0,m.Z)(this,"lastPos",void 0),(0,m.Z)(this,"box",void 0),(0,m.Z)(this,"clickTolerance",void 0),this.map=e,this.el=e.getCanvasContainer(),this.container=e.getContainer(),this.clickTolerance=n.clickTolerance||1}return(0,F.Z)(t,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(_h.disableDrag(),this.startPos=this.lastPos=e,this.active=!0)}},{key:"mousemoveWindow",value:function(t,e){if(this.active){var n=e;if(!(this.lastPos.equals(n)||!this.box&&n.dist(this.startPos)<this.clickTolerance)){var r=this.startPos;this.lastPos=n,this.box||(this.box=_h.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",t));var i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);_h.setTransform(this.box,"translate(".concat(i,"px,").concat(a,"px)")),this.box&&(this.box.style.width="".concat(o-i,"px"),this.box.style.height="".concat(s-a,"px"))}}}},{key:"mouseupWindow",value:function(t,e){var n=this;if(this.active&&0===t.button){var r=this.startPos,i=e;if(this.reset(),_h.suppressClick(),r.x!==i.x||r.y!==i.y)return this.map.emit("boxzoomend",new dh("boxzoomend",{originalEvent:t})),{cameraAnimation:function(t){return t.fitScreenCoordinates(r,i,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",t)}}},{key:"keydown",value:function(t){this.active&&27===t.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",t))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(_h.remove(this.box),this.box=null),_h.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(t,e){return this.map.emit(t,new dh(t,{originalEvent:e}))}}]),t}();const Rh=Oh;var Lh=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"enabled",void 0),(0,m.Z)(this,"active",void 0),this.reset()}return(0,F.Z)(t,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(t,e){return t.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();var Dh=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"type","renderFrame"),(0,m.Z)((0,H.Z)(t),"timeStamp",void 0),t}return(0,F.Z)(i)}(dh);function Nh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Bh={linearity:.3,easing:Wc(0,0,.3,1)},zh=yi()({deceleration:2500,maxSpeed:1400},Bh),Fh=yi()({deceleration:20,maxSpeed:1400},Bh),Zh=yi()({deceleration:1e3,maxSpeed:360},Bh),jh=yi()({deceleration:1e3,maxSpeed:90},Bh),Uh=function(){function t(e){(0,z.Z)(this,t),(0,m.Z)(this,"map",void 0),(0,m.Z)(this,"inertiaBuffer",void 0),this.map=e,this.clear()}return(0,F.Z)(t,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(t){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:qc(),settings:t})}},{key:"drainInertiaBuffer",value:function(){for(var t=this.inertiaBuffer,e=qc();t.length>0&&e-t[0].time>160;)t.shift()}},{key:"onMoveEnd",value:function(t){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var e,n={zoom:0,bearing:0,pitch:0,pan:new nh(0,0),pinchAround:void 0,around:void 0},r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Nh(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Nh(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.inertiaBuffer);try{for(r.s();!(e=r.n()).done;){var i=e.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(t){r.e(t)}finally{r.f()}var o=this.inertiaBuffer[this.inertiaBuffer.length-1].time-this.inertiaBuffer[0].time,a={};if(n.pan.mag()){var s=Vh(n.pan.mag(),o,yi()({},zh,t||{}));a.offset=n.pan.mult(s.amount/n.pan.mag()),a.center=this.map.transform.center,Gh(a,s)}if(n.zoom){var u=Vh(n.zoom,o,Fh);a.zoom=this.map.transform.zoom+u.amount,Gh(a,u)}if(n.bearing){var l=Vh(n.bearing,o,Zh);a.bearing=this.map.transform.bearing+Gc(l.amount,-179,179),Gh(a,l)}if(n.pitch){var c=Vh(n.pitch,o,jh);a.pitch=this.map.transform.pitch+c.amount,Gh(a,c)}if(a.zoom||a.bearing){var h=void 0===n.pinchAround?n.around:n.pinchAround;a.around=h?this.map.unproject(h):this.map.getCenter()}return this.clear(),yi()(a,{noMoveStart:!0})}}}]),t}();function Gh(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Vh(t,e,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=Gc(t*i/(e/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:a*(s/2)}}var Wh={panStep:100,bearingStep:15,pitchStep:10};function Hh(t){return t*(2-t)}const Xh=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"enabled",void 0),(0,m.Z)(this,"active",void 0),(0,m.Z)(this,"panStep",void 0),(0,m.Z)(this,"bearingStep",void 0),(0,m.Z)(this,"pitchStep",void 0);var e=Wh;this.panStep=e.panStep,this.bearingStep=e.bearingStep,this.pitchStep=e.pitchStep}return(0,F.Z)(t,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Hh,zoom:n?Math.round(u)+n*(t.shiftKey?2:1):u,bearing:s.getBearing()+r*e.bearingStep,pitch:s.getPitch()+i*e.pitchStep,offset:[-o*e.panStep,-a*e.panStep],center:s.getCenter()},{originalEvent:t})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();var Yh,qh=function(){function t(e,n){(0,z.Z)(this,t),(0,m.Z)(this,"mousedownPos",void 0),(0,m.Z)(this,"clickTolerance",void 0),(0,m.Z)(this,"map",void 0),this.map=e,this.clickTolerance=n.clickTolerance}return(0,F.Z)(t,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(t){return this.firePreventable(new Ph(t.type,this.map,t))}},{key:"mousedown",value:function(t,e){return this.mousedownPos=e,this.firePreventable(new kh(t.type,this.map,t))}},{key:"mouseup",value:function(t){this.map.emit(t.type,new kh(t.type,this.map,t))}},{key:"click",value:function(t,e){this.mousedownPos&&this.mousedownPos.dist(e)>=this.clickTolerance||this.map.emit(t.type,new kh(t.type,this.map,t))}},{key:"dblclick",value:function(t){return this.firePreventable(new kh(t.type,this.map,t))}},{key:"mouseover",value:function(t){this.map.emit(t.type,new kh(t.type,this.map,t))}},{key:"mouseout",value:function(t){this.map.emit(t.type,new kh(t.type,this.map,t))}},{key:"touchstart",value:function(t){return this.firePreventable(new Mh(t.type,this.map,t))}},{key:"touchmove",value:function(t){this.map.emit(t.type,new Mh(t.type,this.map,t))}},{key:"touchend",value:function(t){this.map.emit(t.type,new Mh(t.type,this.map,t))}},{key:"touchcancel",value:function(t){this.map.emit(t.type,new Mh(t.type,this.map,t))}},{key:"firePreventable",value:function(t){if(this.map.emit(t.type,t),t.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),t}(),Kh=(Yh={},(0,m.Z)(Yh,0,1),(0,m.Z)(Yh,2,2),Yh),Qh=function(){function t(e){(0,z.Z)(this,t),(0,m.Z)(this,"enabled",void 0),(0,m.Z)(this,"active",void 0),(0,m.Z)(this,"lastPoint",void 0),(0,m.Z)(this,"eventButton",void 0),(0,m.Z)(this,"moved",void 0),(0,m.Z)(this,"clickTolerance",void 0),this.reset(),this.clickTolerance=e.clickTolerance||1}return(0,F.Z)(t,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(t,e){if(!this.lastPoint){var n=_h.mouseButton(t);this.correctButton(t,n)&&(this.lastPoint=e,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(t,e){var n=this.lastPoint;if(n)if(t.preventDefault(),function(t,e){var n=Kh[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this.eventButton))this.reset();else if(this.moved||!(e.dist(n)<this.clickTolerance))return this.moved=!0,this.lastPoint=e,this.move(n,e)}},{key:"mouseupWindow",value:function(t){this.lastPoint&&_h.mouseButton(t)===this.eventButton&&(this.moved&&_h.suppressClick(),this.reset())}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(t,e){return!1}},{key:"move",value:function(t,e){}}]),t}();var Jh=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"mousedown",value:function(t,e){Za((0,V.Z)(i.prototype),"mousedown",this).call(this,t,e),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(t,e){return{around:e,panDelta:e.sub(t)}}},{key:"correctButton",value:function(t,e){return 0===e&&!t.ctrlKey}}]),i}(Qh);var $h=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"correctButton",value:function(t,e){return 0===e&&t.ctrlKey||2===e}},{key:"move",value:function(t,e){var n=-.5*(e.y-t.y);if(n)return this.active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(t){t.preventDefault()}}]),i}(Qh);var tf=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"contextmenu",value:function(t){t.preventDefault()}},{key:"correctButton",value:function(t,e){return 0===e&&t.ctrlKey||2===e}},{key:"move",value:function(t,e){var n=.8*(e.x-t.x);if(n)return this.active=!0,{bearingDelta:n}}}]),i}(Qh),ef=4.000244140625,nf=function(){function t(e,n){var r=this;(0,z.Z)(this,t),(0,m.Z)(this,"map",void 0),(0,m.Z)(this,"el",void 0),(0,m.Z)(this,"enabled",void 0),(0,m.Z)(this,"active",void 0),(0,m.Z)(this,"zooming",void 0),(0,m.Z)(this,"aroundCenter",void 0),(0,m.Z)(this,"around",void 0),(0,m.Z)(this,"aroundPoint",void 0),(0,m.Z)(this,"type",void 0),(0,m.Z)(this,"lastValue",void 0),(0,m.Z)(this,"timeout",void 0),(0,m.Z)(this,"finishTimeout",void 0),(0,m.Z)(this,"lastWheelEvent",void 0),(0,m.Z)(this,"lastWheelEventTime",void 0),(0,m.Z)(this,"startZoom",void 0),(0,m.Z)(this,"targetZoom",void 0),(0,m.Z)(this,"delta",void 0),(0,m.Z)(this,"easing",void 0),(0,m.Z)(this,"prevEase",void 0),(0,m.Z)(this,"frameId",void 0),(0,m.Z)(this,"handler",void 0),(0,m.Z)(this,"defaultZoomRate",void 0),(0,m.Z)(this,"wheelZoomRate",void 0),(0,m.Z)(this,"onScrollFrame",(function(){if(r.frameId&&(r.frameId=null,r.isActive())){var t=r.map.transform;if(0!==r.delta){var e="wheel"===r.type&&Math.abs(r.delta)>ef?r.wheelZoomRate:r.defaultZoomRate,n=2/(1+Math.exp(-Math.abs(r.delta*e)));r.delta<0&&0!==n&&(n=1/n);var i="number"==typeof r.targetZoom?t.zoomScale(r.targetZoom):t.scale;r.targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(i*n))),"wheel"===r.type&&(r.startZoom=t.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var o,a="number"==typeof r.targetZoom?r.targetZoom:t.zoom,s=r.startZoom,u=r.easing,l=!1;if("wheel"===r.type&&s&&u){var c=Math.min((qc()-r.lastWheelEventTime)/200,1);o=Vc(s,a,u(c)),c<1?r.frameId||(r.frameId=!0):l=!0}else o=a,l=!0;return r.active=!0,l&&(r.active=!1,r.finishTimeout=setTimeout((function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!l,zoomDelta:o-t.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}})),this.map=e,this.el=e.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=.01,this.wheelZoomRate=.0022222222222222222}return(0,F.Z)(t,[{key:"setZoomRate",value:function(t){this.defaultZoomRate=t}},{key:"setWheelZoomRate",value:function(t){this.wheelZoomRate=t}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(t){this.isEnabled()||(this.enabled=!0,this.aroundCenter=t&&"center"===t.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(t){if(this.isEnabled()){var e=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,n=qc(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==e&&e%ef==0?this.type="wheel":0!==e&&Math.abs(e)<4?this.type="trackpad":r>400?(this.type=null,this.lastValue=e,this.timeout=setTimeout(this.onTimeout,40,t)):this.type||(this.type=Math.abs(r*e)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,e+=this.lastValue)),t.shiftKey&&e&&(e/=4),this.type&&(this.lastWheelEvent=t,this.delta-=e,this.active||this.start(t)),t.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(t){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(t)}},{key:"start",value:function(t){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var e=_h.mousePos(this.el,t);this.around=th.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(e)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(t){var e=Hc;if(this.prevEase){var n=this.prevEase,r=(qc()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01;e=Wc(o,Math.sqrt(.0729-o*o),.25,1)}return this.prevEase={start:qc(),duration:t,easing:e},e}}]),t}();const rf=nf;var of=function(){function t(e,n){(0,z.Z)(this,t),(0,m.Z)(this,"clickZoom",void 0),(0,m.Z)(this,"tapZoom",void 0),this.clickZoom=e,this.tapZoom=n}return(0,F.Z)(t,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),t}(),af=function(){function t(e,n,r){(0,z.Z)(this,t),(0,m.Z)(this,"inertiaOptions",void 0),(0,m.Z)(this,"el",void 0),(0,m.Z)(this,"mousePan",void 0),(0,m.Z)(this,"touchPan",void 0),this.el=e,this.mousePan=n,this.touchPan=r}return(0,F.Z)(t,[{key:"enable",value:function(t){this.inertiaOptions=t||{},this.mousePan.enable(),this.touchPan.enable(),ve||this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),ve||this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),t}(),sf=function(){function t(e,n,r){(0,z.Z)(this,t),(0,m.Z)(this,"mouseRotate",void 0),(0,m.Z)(this,"mousePitch",void 0),(0,m.Z)(this,"pitchWithRotate",void 0),this.pitchWithRotate=e.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}return(0,F.Z)(t,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),t}(),uf=function(){function t(e,n,r,i){(0,z.Z)(this,t),(0,m.Z)(this,"el",void 0),(0,m.Z)(this,"touchZoom",void 0),(0,m.Z)(this,"touchRotate",void 0),(0,m.Z)(this,"tapDragZoom",void 0),(0,m.Z)(this,"rotationDisabled",void 0),(0,m.Z)(this,"enabled",void 0),this.el=e,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return(0,F.Z)(t,[{key:"enable",value:function(t){this.touchZoom.enable(t),this.rotationDisabled||this.touchRotate.enable(t),this.tapDragZoom.enable(),ve||this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),ve||this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),t}();function lf(t,e){for(var n={},r=0;r<t.length;r++)n[t[r].identifier]=e[r];return n}function cf(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var hf=function(){function t(e){(0,z.Z)(this,t),(0,m.Z)(this,"numTouches",void 0),(0,m.Z)(this,"centroid",void 0),(0,m.Z)(this,"startTime",void 0),(0,m.Z)(this,"aborted",void 0),(0,m.Z)(this,"touches",void 0),this.reset(),this.numTouches=e.numTouches}return(0,F.Z)(t,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(t,e,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(t){var e,n=new nh(0,0),r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return cf(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?cf(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(t);try{for(r.s();!(e=r.n()).done;){var i=e.value;n._add(i)}}catch(t){r.e(t)}finally{r.f()}return n.div(t.length)}(e),this.touches=lf(n,e)))}},{key:"touchmove",value:function(t,e,n){if(!this.aborted&&this.centroid){var r=lf(n,e);for(var i in this.touches)if(this.touches[i]){var o=this.touches[i],a=r[i];(!a||a.dist(o)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),t}(),ff=function(){function t(e){(0,z.Z)(this,t),(0,m.Z)(this,"singleTap",void 0),(0,m.Z)(this,"numTaps",void 0),(0,m.Z)(this,"lastTime",void 0),(0,m.Z)(this,"lastTap",void 0),(0,m.Z)(this,"count",void 0),this.singleTap=new hf(e),this.numTaps=e.numTaps,this.reset()}return(0,F.Z)(t,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(t,e,n){this.singleTap.touchstart(t,e,n)}},{key:"touchmove",value:function(t,e,n){this.singleTap.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){var r=this.singleTap.touchend(t,e,n);if(r){var i=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),t}(),pf=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"enabled",void 0),(0,m.Z)(this,"active",void 0),(0,m.Z)(this,"swipePoint",void 0),(0,m.Z)(this,"swipeTouch",void 0),(0,m.Z)(this,"tapTime",void 0),(0,m.Z)(this,"tap",void 0),this.tap=new ff({numTouches:1,numTaps:1}),this.reset()}return(0,F.Z)(t,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(t,e,n){this.swipePoint||(this.tapTime&&t.timeStamp-this.tapTime>500&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=e[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(t,e,n))}},{key:"touchmove",value:function(t,e,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=e[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,t.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){this.tapTime?this.swipePoint&&0===n.length&&this.reset():this.tap.touchend(t,e,n)&&(this.tapTime=t.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),df=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"enabled",void 0),(0,m.Z)(this,"active",void 0),(0,m.Z)(this,"zoomIn",void 0),(0,m.Z)(this,"zoomOut",void 0),this.zoomIn=new ff({numTouches:1,numTaps:2}),this.zoomOut=new ff({numTouches:2,numTaps:1}),this.reset()}return(0,F.Z)(t,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(t,e,n){this.zoomIn.touchstart(t,e,n),this.zoomOut.touchstart(t,e,n)}},{key:"touchmove",value:function(t,e,n){this.zoomIn.touchmove(t,e,n),this.zoomOut.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){var r=this,i=this.zoomIn.touchend(t,e,n),o=this.zoomOut.touchend(t,e,n);return i?(this.active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}}):o?(this.active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),gf=function(){function t(e){(0,z.Z)(this,t),(0,m.Z)(this,"enabled",void 0),(0,m.Z)(this,"active",void 0),(0,m.Z)(this,"touches",void 0),(0,m.Z)(this,"minTouches",void 0),(0,m.Z)(this,"clickTolerance",void 0),(0,m.Z)(this,"sum",void 0),this.minTouches=1,this.clickTolerance=e.clickTolerance||1,this.reset()}return(0,F.Z)(t,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new nh(0,0)}},{key:"touchstart",value:function(t,e,n){return this.calculateTransform(t,e,n)}},{key:"touchmove",value:function(t,e,n){if(this.active)return t.preventDefault(),this.calculateTransform(t,e,n)}},{key:"touchend",value:function(t,e,n){this.calculateTransform(t,e,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(t,e,n){n.length>0&&(this.active=!0);var r=lf(n,e),i=new nh(0,0),o=new nh(0,0),a=0;for(var s in r)if(r[s]){var u=r[s],l=this.touches[s];l&&(i._add(u),o._add(u.sub(l)),a++,r[s]=u)}if(this.touches=r,!(a<this.minTouches)&&o.mag()){var c=o.div(a);if(this.sum._add(c),!(this.sum.mag()<this.clickTolerance))return{around:i.div(a),panDelta:c}}}}]),t}(),vf=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"enabled",void 0),(0,m.Z)(this,"active",void 0),(0,m.Z)(this,"firstTwoTouches",void 0),(0,m.Z)(this,"vector",void 0),(0,m.Z)(this,"startVector",void 0),(0,m.Z)(this,"aroundCenter",void 0),this.reset()}return(0,F.Z)(t,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(t){}},{key:"move",value:function(t,e,n){}},{key:"touchstart",value:function(t,e,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([e[0],e[1]]))}},{key:"touchmove",value:function(t,e,n){if(this.firstTwoTouches){t.preventDefault();var r=(0,R.Z)(this.firstTwoTouches,2),i=r[0],o=r[1],a=mf(n,e,i),s=mf(n,e,o);if(a&&s){var u=this.aroundCenter?null:a.add(s).div(2);return this.move([a,s],u,t)}}}},{key:"touchend",value:function(t,e,n){if(this.firstTwoTouches){var r=(0,R.Z)(this.firstTwoTouches,2),i=r[0],o=r[1],a=mf(n,e,i),s=mf(n,e,o);a&&s||(this.active&&_h.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(t){this.enabled=!0,this.aroundCenter=!!t&&"center"===t.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();function mf(t,e,n){for(var r=0;r<t.length;r++)if(t[r].identifier===n)return e[r]}function yf(t){return Math.abs(t.y)>Math.abs(t.x)}var _f=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"valid",void 0),(0,m.Z)((0,H.Z)(t),"firstMove",void 0),(0,m.Z)((0,H.Z)(t),"lastPoints",void 0),t}return(0,F.Z)(i,[{key:"reset",value:function(){Za((0,V.Z)(i.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(t){this.lastPoints=t,yf(t[0].sub(t[1]))&&(this.valid=!1)}},{key:"move",value:function(t,e,n){var r=t[0].sub(this.lastPoints[0]),i=t[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid)return this.lastPoints=t,this.active=!0,{pitchDelta:(r.y+i.y)/2*-.5}}},{key:"gestureBeginsVertically",value:function(t,e,n){if(void 0!==this.valid)return this.valid;var r=t.mag()>=2,i=e.mag()>=2;if(r||i){if(!r||!i)return void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<100&&void 0;var o=t.y>0==e.y>0;return yf(t)&&yf(e)&&o}}}]),i}(vf);function bf(t,e){return 180*t.angleWith(e)/Math.PI}var xf=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"minDiameter",void 0),t}return(0,F.Z)(i,[{key:"reset",value:function(){Za((0,V.Z)(i.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(t){this.startVector=this.vector=t[0].sub(t[1]),this.minDiameter=t[0].dist(t[1])}},{key:"move",value:function(t,e){var n=this.vector;if(this.vector=t[0].sub(t[1]),this.active||!this.isBelowThreshold(this.vector))return this.active=!0,{bearingDelta:bf(this.vector,n),pinchAround:e}}},{key:"isBelowThreshold",value:function(t){this.minDiameter=Math.min(this.minDiameter,t.mag());var e=25/(Math.PI*this.minDiameter)*360,n=bf(t,this.startVector);return Math.abs(n)<e}}]),i}(vf);function wf(t,e){return Math.log(t/e)/Math.LN2}var Ef=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"distance",void 0),(0,m.Z)((0,H.Z)(t),"startDistance",void 0),t}return(0,F.Z)(i,[{key:"reset",value:function(){Za((0,V.Z)(i.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(t){this.startDistance=this.distance=t[0].dist(t[1])}},{key:"move",value:function(t,e){var n=this.distance;if(this.distance=t[0].dist(t[1]),this.active||!(Math.abs(wf(this.distance,this.startDistance))<.1))return this.active=!0,{zoomDelta:wf(this.distance,n),pinchAround:e}}}]),i}(vf);function Sf(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Cf(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Cf(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Cf(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Af=function(t){return t.zoom||t.drag||t.pitch||t.rotate};function Tf(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var kf=function(){function t(e,n){var r=this;(0,z.Z)(this,t),(0,m.Z)(this,"map",void 0),(0,m.Z)(this,"el",void 0),(0,m.Z)(this,"handlers",void 0),(0,m.Z)(this,"eventsInProgress",void 0),(0,m.Z)(this,"frameId",void 0),(0,m.Z)(this,"inertia",void 0),(0,m.Z)(this,"bearingSnap",void 0),(0,m.Z)(this,"handlersById",void 0),(0,m.Z)(this,"updatingCamera",void 0),(0,m.Z)(this,"changes",void 0),(0,m.Z)(this,"previousActiveHandlers",void 0),(0,m.Z)(this,"bearingChanged",void 0),(0,m.Z)(this,"listeners",void 0),(0,m.Z)(this,"handleWindowEvent",(function(t){r.handleEvent(t,"".concat(t.type,"Window"))})),(0,m.Z)(this,"handleEvent",(function(t,e){if("blur"!==t.type){r.updatingCamera=!0;var n,i="renderFrame"===t.type?void 0:t,o={needsRenderFrame:!1},a={},s={},u=t.touches?r.getMapTouches(t.touches):void 0,l=u?_h.touchPos(r.el,u):_h.mousePos(r.el,t),c=Sf(r.handlers);try{for(c.s();!(n=c.n()).done;){var h=n.value,f=h.handlerName,p=h.handler,d=h.allowed;if(p.isEnabled()){var g=void 0;if(r.blockedByActive(s,d,f))p.reset();else{var v=e||t.type;p&&p[v]&&(g=p[v](t,l,u),r.mergeIHandlerResult(o,a,g,f,i),g&&g.needsRenderFrame&&r.triggerRenderFrame())}(g||p.isActive())&&(s[f]=p)}}}catch(t){c.e(t)}finally{c.f()}var m={};for(var y in r.previousActiveHandlers)s[y]||(m[y]=i);r.previousActiveHandlers=s,(Object.keys(m).length||Tf(o))&&(r.changes.push([o,a,m]),r.triggerRenderFrame()),(Object.keys(s).length||Tf(o))&&r.map.stop(!0),r.updatingCamera=!1;var _=o.cameraAnimation;_&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],_(r.map))}else r.stop()})),this.map=e,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new Uh(e),this.bearingSnap=n.bearingSnap,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var i=this.el;if(this.listeners=[],ve)ye.document.addEventListener("touchstart",(function(t){r.handleEvent(t)}),{}),ye.document.addEventListener("touchmove",(function(t){r.handleEvent(t)}),{}),ye.document.addEventListener("touchend",(function(t){r.handleEvent(t)}),{}),ye.document.addEventListener("touchcancel",(function(t){r.handleEvent(t)}),{});else{this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var o,a=Sf(this.listeners);try{for(a.s();!(o=a.n()).done;){var s=(0,R.Z)(o.value,3),u=s[0],l=s[1],c=s[2];_h.addEventListener(u,l,u===window.document?this.handleWindowEvent:this.handleEvent,c)}}catch(t){a.e(t)}finally{a.f()}}}return(0,F.Z)(t,[{key:"destroy",value:function(){var t,e=Sf(this.listeners);try{for(e.s();!(t=e.n()).done;){var n=(0,R.Z)(t.value,3),r=n[0],i=n[1],o=n[2];_h.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(t){e.e(t)}finally{e.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var t,e=Sf(this.handlers);try{for(e.s();!(t=e.n()).done;)t.value.handler.reset()}catch(t){e.e(t)}finally{e.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var t,e=Sf(this.handlers);try{for(e.s();!(t=e.n()).done;)if(t.value.handler.isActive())return!0}catch(t){e.e(t)}finally{e.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(Af(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(t,e,n,r,i){if(n){yi()(t,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(e.zoom=o),void 0!==n.panDelta&&(e.drag=o),void 0!==n.pitchDelta&&(e.pitch=o),void 0!==n.bearingDelta&&(e.rotate=o)}}},{key:"triggerRenderFrame",value:function(){var t=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame((function(e){delete t.frameId,t.handleEvent(new Dh("renderFrame",{timeStamp:e})),t.applyChanges()})))}},{key:"addDefaultHandlers",value:function(t){var e=this.map,n=e.getCanvasContainer();this.add("mapEvent",new qh(e,t));var r=e.boxZoom=new Rh(e,t);this.add("boxZoom",r);var i=new df,o=new Lh;e.doubleClickZoom=new of(o,i),this.add("tapZoom",i),this.add("clickZoom",o);var a=new pf;this.add("tapDragZoom",a);var s=e.touchPitch=new _f;this.add("touchPitch",s);var u=new $h(t),l=new tf(t);e.dragRotate=new sf(t,u,l),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",l,["mouseRotate"]);var c=new Jh(t),h=new gf(t);e.dragPan=new af(n,c,h),this.add("mousePan",c),this.add("touchPan",h,["touchZoom","touchRotate"]);var f=new xf,p=new Ef;e.touchZoomRotate=new uf(n,p,f,a),this.add("touchRotate",f,["touchPan","touchZoom"]),this.add("touchZoom",p,["touchPan","touchRotate"]);var d=e.scrollZoom=new rf(e,this);this.add("scrollZoom",d,["mousePan"]);var g=e.keyboard=new Xh;this.add("keyboard",g),this.add("blockableMapEvent",new Ih(e));for(var v=0,m=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];v<m.length;v++){var y=m[v];t.interactive&&t[y]&&e[y].enable(t[y])}}},{key:"add",value:function(t,e,n){this.handlers.push({handlerName:t,handler:e,allowed:n}),this.handlersById[t]=e}},{key:"blockedByActive",value:function(t,e,n){for(var r in t)if(r!==n&&(!e||e.indexOf(r)<0))return!0;return!1}},{key:"getMapTouches",value:function(t){var e,n=[],r=Sf(t);try{for(r.s();!(e=r.n()).done;){var i=e.value,o=i.target;(ve||this.el.contains(o))&&n.push(i)}}catch(t){r.e(t)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var t,e={},n={},r={},i=Sf(this.changes);try{for(i.s();!(t=i.n()).done;){var o=(0,R.Z)(t.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(e.panDelta=(e.panDelta||new nh(0,0))._add(a.panDelta)),a.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(e.around=a.around),void 0!==a.pinchAround&&(e.pinchAround=a.pinchAround),a.noInertia&&(e.noInertia=a.noInertia),yi()(n,s),yi()(r,u)}}catch(t){i.e(t)}finally{i.f()}this.updateMapTransform(e,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(t,e,n){var r=this.map,i=r.transform;if(!Tf(t))return this.fireEvents(e,n);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,u=t.pitchDelta,l=t.pinchAround,c=t.around;void 0!==l&&(c=l),r.stop(!0),c=c||r.transform.centerPoint;var h=i.pointLocation(o?c.sub(o):c);s&&(i.bearing+=s),u&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,c),this.map.update(),t.noInertia||this.inertia.record(t),this.fireEvents(e,n)}},{key:"fireEvents",value:function(t,e){var n=this,r=Af(this.eventsInProgress),i=Af(t),o={};for(var a in t)if(t[a]){var s=t[a].originalEvent;this.eventsInProgress[a]||(o["".concat(a,"start")]=s),this.eventsInProgress[a]=t[a]}for(var u in!r&&i&&this.fireEvent("movestart",i.originalEvent),o)o[u]&&this.fireEvent(u,o[u]);for(var l in t.rotate&&(this.bearingChanged=!0),i&&this.fireEvent("move",i.originalEvent),t)if(t[l]){var c=t[l].originalEvent;this.fireEvent(l,c)}var h,f={};for(var p in this.eventsInProgress)if(this.eventsInProgress[p]){var d=this.eventsInProgress[p],g=d.handlerName,v=d.originalEvent;this.handlersById[g].isActive()||(delete this.eventsInProgress[p],h=e[g]||v,f["".concat(p,"end")]=h)}for(var m in f)f[m]&&this.fireEvent(m,f[m]);var y=Af(this.eventsInProgress);if((r||i)&&!y){this.updatingCamera=!0;var _=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),b=function(t){return 0!==t&&-n.bearingSnap<t&&t<n.bearingSnap};_?(b(_.bearing||this.map.getBearing())&&(_.bearing=0),this.map.easeTo(_,{originalEvent:h})):(this.map.emit("moveend",new dh("moveend",{originalEvent:h})),b(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(t,e){this.map.emit(t,new dh(t,e?{originalEvent:e}:{}))}}]),t}();const Mf=kf;var Pf=n(3493),If=n.n(Pf),Of=function(){function t(e){var n=this;(0,z.Z)(this,t),(0,m.Z)(this,"map",void 0),(0,m.Z)(this,"updateHash",void 0),(0,m.Z)(this,"hashName",void 0),(0,m.Z)(this,"onHashChange",(function(){var t=n.getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(+t)}))){var e=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(t[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1})),(0,m.Z)(this,"getCurrentHash",(function(){var t,e=window.location.hash.replace("#","");return n.hashName?(e.split("&").map((function(t){return t.split("=")})).forEach((function(e){e[0]===n.hashName&&(t=e)})),(t&&t[1]||"").split("/")):e.split("/")})),(0,m.Z)(this,"updateHashUnthrottled",(function(){var t=n.getHashString();try{window.history.replaceState(window.history.state,"",t)}catch(t){}})),this.hashName=e&&encodeURIComponent(e),this.updateHash=If()(this.updateHashUnthrottled,300)}return(0,F.Z)(t,[{key:"addTo",value:function(t){return this.map=t,ye.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return ye.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(t){var e=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(e.lng*i)/i,a=Math.round(e.lat*i)/i,s=this.map.getBearing(),u=this.map.getPitch(),l="";if(l+=t?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o),(s||u)&&(l+="/".concat(Math.round(10*s)/10)),u&&(l+="/".concat(Math.round(u))),this.hashName){var c=this.hashName,h=!1,f=window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===c?(h=!0,"".concat(e,"=").concat(l)):t})).filter((function(t){return t}));return h||f.push("".concat(c,"=").concat(l)),"#".concat(f.join("&"))}return"#".concat(l)}}]),t}();const Rf=Of;var Lf=null,Df=[],Nf=(ye.performance,function(t){var e=t;if(null!=Lf){var n=e-Lf;Df.push(n)}Lf=e});function Bf(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return zf(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zf(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function zf(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const Ff=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"queue",void 0),(0,m.Z)(this,"id",void 0),(0,m.Z)(this,"cleared",void 0),(0,m.Z)(this,"currentlyRunning",void 0),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return(0,F.Z)(t,[{key:"add",value:function(t){var e=++this.id;return this.queue.push({callback:t,id:e,cancelled:!1}),e}},{key:"remove",value:function(t){var e,n=this.currentlyRunning,r=Bf(n?this.queue.concat(n):this.queue);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i.id===t)return void(i.cancelled=!0)}}catch(t){r.e(t)}finally{r.f()}}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.currentlyRunning=this.queue;this.queue=[];var n,r=Bf(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(t),this.cleared))break}}catch(t){r.e(t)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),t}();!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var Zf={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0},jf=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){var e;if((0,z.Z)(this,i),e=r.call(this,yi()({},Zf,t)),(0,m.Z)((0,H.Z)(e),"doubleClickZoom",void 0),(0,m.Z)((0,H.Z)(e),"dragRotate",void 0),(0,m.Z)((0,H.Z)(e),"dragPan",void 0),(0,m.Z)((0,H.Z)(e),"touchZoomRotate",void 0),(0,m.Z)((0,H.Z)(e),"scrollZoom",void 0),(0,m.Z)((0,H.Z)(e),"keyboard",void 0),(0,m.Z)((0,H.Z)(e),"touchPitch",void 0),(0,m.Z)((0,H.Z)(e),"boxZoom",void 0),(0,m.Z)((0,H.Z)(e),"handlers",void 0),(0,m.Z)((0,H.Z)(e),"container",void 0),(0,m.Z)((0,H.Z)(e),"canvas",void 0),(0,m.Z)((0,H.Z)(e),"canvasContainer",void 0),(0,m.Z)((0,H.Z)(e),"renderTaskQueue",new Ff),(0,m.Z)((0,H.Z)(e),"frame",void 0),(0,m.Z)((0,H.Z)(e),"trackResize",!0),(0,m.Z)((0,H.Z)(e),"hash",void 0),(0,m.Z)((0,H.Z)(e),"onWindowOnline",(function(){e.update()})),(0,m.Z)((0,H.Z)(e),"onWindowResize",(function(t){e.trackResize&&e.resize({originalEvent:t}).update()})),ve?e.initMiniContainer():e.initContainer(),e.resize(),e.handlers=new Mf((0,H.Z)(e),e.options),"undefined"!=typeof window&&(window.addEventListener("online",e.onWindowOnline,!1),window.addEventListener("resize",e.onWindowResize,!1),window.addEventListener("orientationchange",e.onWindowResize,!1)),!ve){var n="string"==typeof t.hash&&t.hash||void 0;t.hash&&(e.hash=new Rf(n).addTo((0,H.Z)(e)))}return e.hash&&e.hash.onHashChange()||(e.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(e.resize(),e.fitBounds(t.bounds,yi()({},t.fitBoundsOptions,{duration:0})))),e}return(0,F.Z)(i,[{key:"resize",value:function(t){var e=this.containerDimensions(),n=e[0],r=e[1];if(this.transform.resize(n,r),ve)return this;var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new ye.Event("movestart",t)),this.emit("move",new ye.Event("move",t))),this.emit("resize",new ye.Event("resize",t)),i&&this.emit("moveend",new ye.Event("moveend",t)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(t){return this.transform.locationPoint(th.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation(nh.convert(t))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){this.transform.setMaxBounds(eh.convert(t))}},{key:"setStyle",value:function(t){}},{key:"setMinZoom",value:function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(t){this.transform.renderWorldCopies=!!t}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(t){return this.update(),this.renderTaskQueue.add(t)}},{key:"cancelRenderFrame",value:function(t){return this.renderTaskQueue.remove(t)}},{key:"triggerRepaint",value:function(){var t=this;this.frame||(this.frame=Jc((function(e){Nf(e),t.frame=null,t.update(e)})))}},{key:"update",value:function(t){var e=this;this.frame||(this.frame=Jc((function(n){Nf(n),e.frame=null,e.renderTaskQueue.run(t)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var t=this.container;t.classList.add("l7-map");var e=this.canvasContainer=Se("div","l7-canvas-container",t);this.options.interactive&&e.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var t=0,e=0;return this.container&&(ve?(t=this.container.width/ye.devicePixelRatio,e=this.container.height/ye.devicePixelRatio):(t=this.container.clientWidth,e=this.container.clientHeight)),[t,e]}}]),i}(gh);!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var Uf,Gf,Vf,Wf,Hf,Xf,Yf,qf,Kf,Qf,Jf,$f={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0},tp=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(t){var e;return(0,z.Z)(this,i),e=r.call(this,yi()({},$f,t)),(0,m.Z)((0,H.Z)(e),"doubleClickZoom",void 0),(0,m.Z)((0,H.Z)(e),"dragRotate",void 0),(0,m.Z)((0,H.Z)(e),"dragPan",void 0),(0,m.Z)((0,H.Z)(e),"touchZoomRotate",void 0),(0,m.Z)((0,H.Z)(e),"scrollZoom",void 0),(0,m.Z)((0,H.Z)(e),"keyboard",void 0),(0,m.Z)((0,H.Z)(e),"touchPitch",void 0),(0,m.Z)((0,H.Z)(e),"boxZoom",void 0),(0,m.Z)((0,H.Z)(e),"handlers",void 0),(0,m.Z)((0,H.Z)(e),"container",void 0),(0,m.Z)((0,H.Z)(e),"canvas",void 0),(0,m.Z)((0,H.Z)(e),"canvasContainer",void 0),(0,m.Z)((0,H.Z)(e),"renderTaskQueue",new Ff),(0,m.Z)((0,H.Z)(e),"frame",void 0),(0,m.Z)((0,H.Z)(e),"trackResize",!0),(0,m.Z)((0,H.Z)(e),"onWindowOnline",(function(){e.update()})),(0,m.Z)((0,H.Z)(e),"onWindowResize",(function(t){e.trackResize&&e.resize({originalEvent:t}).update()})),e.initContainer(),e.resize(),e.handlers=new Mf((0,H.Z)(e),e.options),"undefined"!=typeof window&&(window.addEventListener("online",e.onWindowOnline,!1),window.addEventListener("resize",e.onWindowResize,!1),window.addEventListener("orientationchange",e.onWindowResize,!1)),e}return(0,F.Z)(i,[{key:"resize",value:function(t){var e=this.containerDimensions(),n=e[0],r=e[1];this.transform.resize(n,r);var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Event("movestart",t)),this.emit("move",new Event("move",t))),this.emit("resize",new Event("resize",t)),i&&this.emit("moveend",new Event("moveend",t)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(t){return this.transform.locationPoint(th.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation(nh.convert(t))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){this.transform.setMaxBounds(eh.convert(t))}},{key:"setStyle",value:function(t){}},{key:"setMinZoom",value:function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(t){this.transform.renderWorldCopies=!!t}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(t){return this.update(),this.renderTaskQueue.add(t)}},{key:"cancelRenderFrame",value:function(t){return this.renderTaskQueue.remove(t)}},{key:"triggerRepaint",value:function(){var t=this;this.frame||(this.frame=Jc((function(e){Nf(e),t.frame=null,t.update(e)})))}},{key:"update",value:function(t){var e=this;this.frame||(this.frame=Jc((function(n){Nf(n),e.frame=null,e.renderTaskQueue.run(t)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var t=this.container;t.classList.add("l7-map");var e=this.canvasContainer=Se("div","l7-canvas-container",t);this.options.interactive&&e.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var t=0,e=0;return this.container&&(t=this.container.clientWidth||400,e=this.container.clientHeight||300),[t,e]}},{key:"resizeCanvas",value:function(t,e){var n=Be||1;this.canvas.width=n*t,this.canvas.height=n*e,this.canvas.style.width="".concat(t,"px"),this.canvas.style.height="".concat(e,"px")}}]),i}(gh),ep=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"xzReg",.6*-Math.PI),(0,m.Z)(this,"yReg",.2*Math.PI),(0,m.Z)(this,"earthCameraRadius",200),(0,m.Z)(this,"earthCameraZoom",1),(0,m.Z)(this,"cameraPosition",Gl.create()),(0,m.Z)(this,"viewport",void 0),(0,m.Z)(this,"projectionMatrix",li.create()),(0,m.Z)(this,"modelMatrix",li.create()),(0,m.Z)(this,"viewMatrix",li.create()),(0,m.Z)(this,"viewProjectionMatrix",li.create()),(0,m.Z)(this,"ViewProjectionMatrixUncentered",li.create()),(0,m.Z)(this,"viewUncenteredMatrix",li.create())}return(0,F.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.viewportHeight,n=void 0===e?1:e,r=t.viewportWidth,i=(void 0===r?1:r)/n;li.perspective(this.projectionMatrix,20,i,.1,1e4);var o=this.earthCameraRadius*Math.cos(this.xzReg),a=this.earthCameraRadius*Math.sin(this.xzReg),s=this.earthCameraRadius*Math.sin(this.yReg);this.cameraPosition=Gl.fromValues(o,s,a),Gl.normalize(this.cameraPosition,this.cameraPosition),Gl.multiply(this.cameraPosition,this.cameraPosition,Gl.fromValues(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),Gl.scale(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);var u=Gl.create();Gl.cross(u,this.cameraPosition,Gl.fromValues(0,1,0));var l=Gl.fromValues(0,1,0);Gl.cross(l,u,this.cameraPosition);var c=Gl.fromValues(0,0,0);li.lookAt(this.viewMatrix,this.cameraPosition,c,l),this.viewUncenteredMatrix=li.clone(this.viewMatrix),li.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),li.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"rotateY",value:function(t){this.xzReg+=t*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"rotateX",value:function(t){this.yReg+=t*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"scaleZoom",value:function(t){this.earthCameraZoom+=t,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}},{key:"getZoom",value:function(){return 4}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[0,0]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return this.modelMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),np={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},rp=["id","attributionControl","style","rotation","mapInstance"];function ip(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function op(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ip(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ip(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ap={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},sp=(Uf=(0,Zr.b2)(),Gf=(0,Zr.f3)(Ur.MapConfig),Vf=(0,Zr.f3)(Ur.IGlobalConfigService),Wf=(0,Zr.f3)(Ur.ICoordinateSystemService),Hf=(0,Zr.f3)(Ur.IEventEmitter),Uf((Yf=function(){function t(){var e=this;(0,z.Z)(this,t),(0,m.Z)(this,"version",Fl.GLOBEL),(0,m.Z)(this,"map",void 0),(0,m.Z)(this,"dragging",!1),(0,m.Z)(this,"bgColor","#000"),(0,Ti.Z)(this,"config",qf,this),(0,Ti.Z)(this,"configService",Kf,this),(0,Ti.Z)(this,"coordinateSystemService",Qf,this),(0,Ti.Z)(this,"eventEmitter",Jf,this),(0,m.Z)(this,"viewport",void 0),(0,m.Z)(this,"markerContainer",void 0),(0,m.Z)(this,"cameraChangedCallback",void 0),(0,m.Z)(this,"$mapContainer",void 0),(0,m.Z)(this,"handleCameraChanging",void 0),(0,m.Z)(this,"handleCameraTimer",void 0),(0,m.Z)(this,"handleCameraChanged",(function(t){e.emit("mapchange"),e.handleCameraChanging=!0,e.handleCameraTimer&&clearTimeout(e.handleCameraTimer),e.handleCameraTimer=setTimeout((function(){e.handleCameraChanging=!1}),2e3);t.type&&t.originalEvent&&("wheel"===t.originalEvent.type&&e.viewport.scaleZoom(.01*Math.sign(t.originalEvent.wheelDelta)*-1),Math.abs(t.originalEvent.movementX)>Math.abs(t.originalEvent.movementY)?t.originalEvent.movementX>0?e.viewport.rotateY(.02):t.originalEvent.movementX<0&&e.viewport.rotateY(-.02):t.originalEvent.movementY>0?e.viewport.rotateX(.02):t.originalEvent.movementY<0&&e.viewport.rotateX(-.02));var n=e.config.offsetCoordinate,r=void 0===n||n;e.viewport.syncWithMapCamera({viewportHeight:e.map.transform.height,viewportWidth:e.map.transform.width}),e.viewport.getZoom()>12&&r?e.coordinateSystemService.setCoordinateSystem(Ei.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(Ei.LNGLAT),e.cameraChangedCallback(e.viewport)}))}var e;return(0,F.Z)(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=Se("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==xu.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(ap[t]||t,e)}},{key:"off",value:function(t,e){this.map.off(ap[t]||t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,e){this.map.zoomIn(t,e)}},{key:"zoomOut",value:function(t,e){this.map.zoomOut(t,e)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.panTo([t,e])}},{key:"fitBounds",value:function(t,e){this.map.fitBounds(t,e)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){!0===t.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===t.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===t.dragEnable&&this.map.dragPan.disable(),!0===t.dragEnable&&this.map.dragPan.enable(),!1===t.rotateEnable&&this.map.dragRotate.disable(),!0===t.dragEnable&&this.map.dragRotate.enable(),!1===t.keyboardEnable&&this.map.keyboard.disable(),!0===t.keyboardEnable&&this.map.keyboard.enable(),!1===t.zoomEnable&&this.map.scrollZoom.disable(),!0===t.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,e){this.map.flyTo({zoom:t,center:e})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToMercator",value:function(t,e){throw new Error("not implement")}},{key:"getModelMatrix",value:function(t,e,n){throw new Error("not implement")}},{key:"init",value:(e=(0,lo.Z)(ho().mark((function t(){var e,n,r,i,o,a,s,u;return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,e.attributionControl,i=e.style,o=void 0===i?"light":i,a=e.rotation,s=void 0===a?0:a,e.mapInstance,u=Mo(e,rp),this.viewport=new ep,this.$mapContainer=this.creatAmapContainer(r),this.map=new tp(op({container:this.$mapContainer,style:this.getMapStyle(o),bearing:s},u)),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged({});case 7:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){var t,e;null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"rotateY",value:function(t){var e=t||{},n=e.force,r=void 0!==n&&n,i=e.reg,o=void 0===i?.01:i;this.handleCameraChanging&&!r||this.viewport&&(this.viewport.rotateY(o),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}},{key:"creatAmapContainer",value:function(t){var e=t;return"string"==typeof t&&(e=document.getElementById(t)),e}},{key:"getMapStyle",value:function(t){return"string"!=typeof t?t:np[t]?np[t]:t}}]),t}(),qf=(0,ki.Z)(Yf.prototype,"config",[Gf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kf=(0,ki.Z)(Yf.prototype,"configService",[Vf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qf=(0,ki.Z)(Yf.prototype,"coordinateSystemService",[Wf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jf=(0,ki.Z)(Yf.prototype,"eventEmitter",[Hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xf=Yf))||Xf);var up=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getServiceConstructor",value:function(){return sp}}]),i}(Zl);function lp(t,e){var n=Mi.fF([],e,t);return Mi.bA(n,n,1/n[3]),n}var cp=n(1437);function hp(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}var fp=Math.PI,pp=fp/4,dp=fp/180,gp=180/fp,vp=4003e4;function mp(t){return Math.pow(2,t)}function yp(t,e){var n=(0,R.Z)(t,2),r=n[0],i=n[1];hp(Number.isFinite(r)&&Number.isFinite(e)),hp(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*dp;return[(e*=512)*(r*dp+fp)/(2*fp),e*(fp-Math.log(Math.tan(pp+.5*o)))/(2*fp)]}function _p(t,e){var n=(0,R.Z)(t,2),r=n[0],i=n[1],o=r/(e*=512)*(2*fp)-fp,a=2*(Math.atan(Math.exp(fp-i/e*(2*fp)))-pp);return[o*gp,a*gp]}function bp(t){var e=t.latitude,n=t.longitude,r=t.zoom,i=t.scale,o=t.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:mp(r),hp(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=512*i,l=Math.cos(e*dp),c=u/360,h=c/l,f=u/vp/l;if(s.pixelsPerMeter=[f,-f,f],s.metersPerPixel=[1/f,-1/f,1/f],s.pixelsPerDegree=[c,-h,f],s.degreesPerPixel=[1/c,-1/h,1/f],a){var p=dp*Math.tan(e*dp)/l,d=c*p/2,g=u/vp*p,v=g/h*f;s.pixelsPerDegree2=[0,-d,g],s.pixelsPerMeter2=[v,0,v]}return s}function xp(t){var e=t.height,n=t.pitch,r=t.bearing,i=t.altitude,o=t.center,a=void 0===o?null:o,s=t.flipY,u=void 0!==s&&s,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return li.translate(l,l,[0,0,-i]),li.scale(l,l,[1,1,1/e]),li.rotateX(l,l,-n*dp),li.rotateZ(l,l,r*dp),u&&li.scale(l,l,[1,-1,1]),a&&li.translate(l,l,Gl.negate([],a)),l}function wp(t){var e=t.width,n=t.height,r=t.pitch,i=function(t){var e=t.width,n=t.height,r=t.altitude,i=void 0===r?1.5:r,o=t.pitch,a=t.nearZMultiplier,s=void 0===a?1:a,u=t.farZMultiplier,l=void 0===u?1:u,c=(void 0===o?0:o)*dp,h=Math.atan(.5/i),f=Math.sin(h)*i/Math.sin(Math.PI/2-c-h),p=Math.cos(Math.PI/2-c)*f+i;return{fov:2*Math.atan(n/2/i),aspect:e/n,focalDistance:i,near:s,far:p*l}}({width:e,height:n,altitude:t.altitude,pitch:r,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),o=i.fov,a=i.aspect,s=i.near,u=i.far;return li.perspective([],o,a,s,u)}function Ep(t,e){var n=(0,R.Z)(t,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return hp(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),lp(e,[r,i,a,1])}function Sp(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=(0,R.Z)(t,3),i=r[0],o=r[1],a=r[2];if(hp(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=lp(e,[i,o,a,1]);return s}var u=lp(e,[i,o,0,1]),l=lp(e,[i,o,1,1]),c=u[2],h=l[2],f=c===h?0:((n||0)-c)/(h-c);return cp.t7([],u,l,f)}var Cp=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ap=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,r=e.height,i=e.viewMatrix,o=void 0===i?Cp:i,a=e.projectionMatrix,s=void 0===a?Cp:a;(0,z.Z)(this,t),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=s;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];li.multiply(u,u,this.projectionMatrix),li.multiply(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];li.scale(l,l,[this.width/2,-this.height/2,1]),li.translate(l,l,[1,-1,0]),li.multiply(l,l,this.viewProjectionMatrix);var c=li.invert([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=c,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,F.Z)(t,[{key:"equals",value:function(e){return e instanceof t&&e.width===this.width&&e.height===this.height&&li.equals(e.projectionMatrix,this.projectionMatrix)&&li.equals(e.viewMatrix,this.viewMatrix)}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=this.projectPosition(t),o=Ep(i,this.pixelProjectionMatrix),a=(0,R.Z)(o,2),s=a[0],u=a[1],l=r?u:this.height-u;return 2===t.length?[s,l]:[s,l,o[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=e.targetZ,o=(0,R.Z)(t,3),a=o[0],s=o[1],u=o[2],l=r?s:this.height-s,c=i&&i*this.pixelsPerMeter,h=Sp([a,l,u],this.pixelUnprojectionMatrix,c),f=this.unprojectPosition(h),p=(0,R.Z)(f,3),d=p[0],g=p[1],v=p[2];return Number.isFinite(u)?[d,g,v]:Number.isFinite(i)?[d,g,i]:[d,g]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),n=(0,R.Z)(e,2);return[n[0],n[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),n=(0,R.Z)(e,2);return[n[0],n[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]||this.scale,t}},{key:"unprojectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]||this.scale,t}}]),t}();function Tp(t){var e=t.width,n=t.height,r=t.bounds,i=t.minExtent,o=void 0===i?0:i,a=t.maxZoom,s=void 0===a?24:a,u=t.padding,l=void 0===u?0:u,c=t.offset,h=void 0===c?[0,0]:c,f=(0,R.Z)(r,2),p=(0,R.Z)(f[0],2),d=p[0],g=p[1],v=(0,R.Z)(f[1],2),m=v[0],y=v[1];Number.isFinite(l)?l={top:l,bottom:l,left:l,right:l}:hp(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var _=new Fp({width:e,height:n,longitude:0,latitude:0,zoom:0}),b=_.project([d,y]),x=_.project([m,g]),w=[Math.max(Math.abs(x[0]-b[0]),o),Math.max(Math.abs(x[1]-b[1]),o)],E=[e-l.left-l.right-2*Math.abs(h[0]),n-l.top-l.bottom-2*Math.abs(h[1])];hp(E[0]>0&&E[1]>0);var S=E[0]/w[0],C=E[1]/w[1],A=(l.right-l.left)/2/S,T=(l.bottom-l.top)/2/C,k=[(x[0]+b[0])/2+A,(x[1]+b[1])/2+T],M=_.unproject(k),P=_.zoom+Math.log2(Math.abs(Math.min(S,C)));return{longitude:M[0],latitude:M[1],zoom:Math.min(P,s)}}var kp,Mp,Pp,Ip,Op,Rp,Lp,Dp,Np,Bp,zp,Fp=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,a=void 0===o?0:o,s=n.longitude,u=void 0===s?0:s,l=n.zoom,c=void 0===l?0:l,h=n.pitch,f=void 0===h?0:h,p=n.bearing,d=void 0===p?0:p,g=n.altitude,v=void 0===g?1.5:g,m=n.nearZMultiplier,y=n.farZMultiplier;(0,z.Z)(this,e),r=r||1,i=i||1;var _=mp(c);v=Math.max(.75,v);var b=yp([u,a],_);b[2]=0;var x=wp({width:r,height:i,pitch:f,bearing:d,altitude:v,nearZMultiplier:m||1/i,farZMultiplier:y||1.01}),w=xp({height:i,center:b,pitch:f,bearing:d,altitude:v,flipY:!0});return(t=(0,G.Z)(this,(0,V.Z)(e).call(this,{width:r,height:i,viewMatrix:w,projectionMatrix:x}))).latitude=a,t.longitude=u,t.zoom=c,t.pitch=f,t.bearing=d,t.altitude=v,t.scale=_,t.center=b,t.pixelsPerMeter=bp((0,H.Z)((0,H.Z)(t))).pixelsPerMeter[2],Object.freeze((0,H.Z)((0,H.Z)(t))),t}return(0,U.Z)(e,t),(0,F.Z)(e,[{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return yp(t,e)}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return _p(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,n=Sp(t.pos,this.pixelUnprojectionMatrix),r=yp(e,this.scale),i=cp.IH([],r,cp.tk([],n));return _p(cp.IH([],this.center,i),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=Tp(Object.assign({width:r,height:i,bounds:t},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new e({width:r,height:i,longitude:a,latitude:s,zoom:u})}}]),e}(Ap),Zp=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"viewport",void 0)}return(0,F.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.center,n=t.zoom,r=t.pitch,i=t.bearing,o=t.viewportHeight,a=t.viewportWidth;this.viewport=new Fp({width:a,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),jp={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Up=["id","attributionControl","style","rotation","mapInstance"],Gp=["id","attributionControl","style","rotation","mapInstance","canvas","hasBaseMap"];function Vp(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Wp(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Vp(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Vp(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Hp={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Xp=(kp=(0,Zr.b2)(),Mp=(0,Zr.f3)(Ur.MapConfig),Pp=(0,Zr.f3)(Ur.IGlobalConfigService),Ip=(0,Zr.f3)(Ur.ICoordinateSystemService),Op=(0,Zr.f3)(Ur.IEventEmitter),kp((Lp=function(){function t(){var e=this;(0,z.Z)(this,t),(0,m.Z)(this,"version",Fl.L7MAP),(0,m.Z)(this,"map",void 0),(0,m.Z)(this,"dragging",!1),(0,m.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,Ti.Z)(this,"config",Dp,this),(0,Ti.Z)(this,"configService",Np,this),(0,Ti.Z)(this,"coordinateSystemService",Bp,this),(0,Ti.Z)(this,"eventEmitter",zp,this),(0,m.Z)(this,"viewport",void 0),(0,m.Z)(this,"markerContainer",void 0),(0,m.Z)(this,"cameraChangedCallback",void 0),(0,m.Z)(this,"$mapContainer",void 0),(0,m.Z)(this,"handleMiniCameraChanged",(function(t,n,r,i,o){var a=e.config.offsetCoordinate,s=void 0===a||a;e.viewport.syncWithMapCamera({bearing:i,center:[t,n],viewportHeight:e.map.transform.height,pitch:o,viewportWidth:e.map.transform.width,zoom:r,cameraHeight:0}),e.viewport.getZoom()>12&&s?e.coordinateSystemService.setCoordinateSystem(Ei.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(Ei.LNGLAT),e.cameraChangedCallback(e.viewport)})),(0,m.Z)(this,"handleCameraChanged",(function(){var t=e.map.getCenter(),n=t.lat,r=t.lng,i=e.config.offsetCoordinate,o=void 0===i||i;e.emit("mapchange"),e.viewport.syncWithMapCamera({bearing:e.map.getBearing(),center:[r,n],viewportHeight:e.map.transform.height,pitch:e.map.getPitch(),viewportWidth:e.map.transform.width,zoom:e.map.getZoom(),cameraHeight:0}),e.viewport.getZoom()>12&&o?e.coordinateSystemService.setCoordinateSystem(Ei.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(Ei.LNGLAT),e.cameraChangedCallback(e.viewport)}))}var e,n;return(0,F.Z)(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=Se("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==xu.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(Hp[t]||t,e)}},{key:"off",value:function(t,e){this.map.off(Hp[t]||t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,e){this.map.zoomIn(t,e)}},{key:"zoomOut",value:function(t,e){this.map.zoomOut(t,e)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.panTo([t,e])}},{key:"fitBounds",value:function(t,e){this.map.fitBounds(t,e)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){!0===t.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===t.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===t.dragEnable&&this.map.dragPan.disable(),!0===t.dragEnable&&this.map.dragPan.enable(),!1===t.rotateEnable&&this.map.dragRotate.disable(),!0===t.dragEnable&&this.map.dragRotate.enable(),!1===t.keyboardEnable&&this.map.keyboard.disable(),!0===t.keyboardEnable&&this.map.keyboard.enable(),!1===t.zoomEnable&&this.map.scrollZoom.disable(),!0===t.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,e){this.map.flyTo({zoom:t,center:e})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToMercator",value:function(t,e){throw new Error("not implement")}},{key:"getModelMatrix",value:function(t,e,n){throw new Error("not implement")}},{key:"init",value:(n=(0,lo.Z)(ho().mark((function t(){var e,n,r,i,o,a,s,u,l,c=this;return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,e.attributionControl,i=e.style,o=void 0===i?"light":i,a=e.rotation,s=void 0===a?0:a,u=e.mapInstance,l=Mo(e,Up),this.viewport=new Zp,u?(this.map=u,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(r),this.map=new jf(Wp({container:this.$mapContainer,style:this.getMapStyle(o),bearing:s},l))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",(function(){return c.dragging=!0,""})),this.map.on("dragend",(function(){return c.dragging=!1,""})),this.handleCameraChanged();case 8:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"initMiniMap",value:(e=(0,lo.Z)(ho().mark((function t(){var e,n,r,i,o,a,s,u,l,c,h,f=this;return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(e=this.config).id,e.attributionControl,n=e.style,r=void 0===n?"light":n,i=e.rotation,o=void 0===i?0:i,e.mapInstance,a=e.canvas,s=void 0===a?null:a,u=e.hasBaseMap,l=void 0!==u&&u,c=Mo(e,Gp),this.viewport=new Zp,this.$mapContainer=s,this.map=new jf(Wp({container:this.$mapContainer,style:this.getMapStyle(r),bearing:o,canvas:s},c)),l?(h=this.map.getCenter(),this.handleMiniCameraChanged(h.lng,h.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),ye.document.addEventListener("mapCameaParams",(function(t){var e=t.e,n=e.longitude,r=e.latitude,i=e.scale,o=e.bearing,a=e.pitch;f.handleMiniCameraChanged(n,r,i-1.25,o,a)}))):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){var t,e;null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var e=t;return"string"==typeof t&&(e=document.getElementById(t)),e}},{key:"getMapStyle",value:function(t){return"string"!=typeof t?t:jp[t]?jp[t]:t}}]),t}(),Dp=(0,ki.Z)(Lp.prototype,"config",[Mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Np=(0,ki.Z)(Lp.prototype,"configService",[Pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bp=(0,ki.Z)(Lp.prototype,"coordinateSystemService",[Ip],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zp=(0,ki.Z)(Lp.prototype,"eventEmitter",[Op],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rp=Lp))||Rp);var Yp,qp,Kp,Qp,Jp,$p,td,ed,nd,rd,id,od=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getServiceConstructor",value:function(){return Xp}}]),i}(Zl),ad=n(6158),sd=n.n(ad),ud=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"viewport",void 0)}return(0,F.Z)(t,[{key:"syncWithMapCamera",value:function(t){var e=t.center,n=t.zoom,r=t.pitch,i=t.bearing,o=t.viewportHeight,a=t.viewportWidth;this.viewport=new Fp({width:a,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),ld={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},cd=["id","attributionControl","style","token","rotation","mapInstance"];function hd(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function fd(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?hd(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hd(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}"),window.mapboxgl=sd();var pd={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},dd=0,gd="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",vd=(Yp=(0,Zr.b2)(),qp=(0,Zr.f3)(Ur.MapConfig),Kp=(0,Zr.f3)(Ur.IGlobalConfigService),Qp=(0,Zr.f3)(Ur.ICoordinateSystemService),Jp=(0,Zr.f3)(Ur.IEventEmitter),Yp((td=function(){function t(){var e=this;(0,z.Z)(this,t),(0,m.Z)(this,"version",Fl.MAPBOX),(0,m.Z)(this,"map",void 0),(0,m.Z)(this,"dragging",!1),(0,m.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,Ti.Z)(this,"config",ed,this),(0,Ti.Z)(this,"configService",nd,this),(0,Ti.Z)(this,"coordinateSystemService",rd,this),(0,Ti.Z)(this,"eventEmitter",id,this),(0,m.Z)(this,"viewport",void 0),(0,m.Z)(this,"markerContainer",void 0),(0,m.Z)(this,"cameraChangedCallback",void 0),(0,m.Z)(this,"$mapContainer",void 0),(0,m.Z)(this,"handleCameraChanged",(function(){var t=e.map.getCenter().wrap(),n=t.lat,r=t.lng;e.emit("mapchange"),e.viewport.syncWithMapCamera({bearing:e.map.getBearing(),center:[r,n],viewportHeight:e.map.transform.height,pitch:e.map.getPitch(),viewportWidth:e.map.transform.width,zoom:e.map.getZoom(),cameraHeight:0});var i=e.config.offsetZoom,o=void 0===i?12:i;e.viewport.getZoom()>o?e.coordinateSystemService.setCoordinateSystem(Ei.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(Ei.LNGLAT),e.cameraChangedCallback(e.viewport)}))}var e;return(0,F.Z)(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=Se("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==xu.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(pd[t]||t,e)}},{key:"off",value:function(t,e){this.map.off(pd[t]||t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,e){this.map.zoomIn(t,e)}},{key:"zoomOut",value:function(t,e){this.map.zoomOut(t,e)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(t,e){this.panTo([t,e])}},{key:"fitBounds",value:function(t,e){this.map.fitBounds(t,e)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){!0===t.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===t.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===t.dragEnable&&this.map.dragPan.disable(),!0===t.dragEnable&&this.map.dragPan.enable(),!1===t.rotateEnable&&this.map.dragRotate.disable(),!0===t.rotateEnable&&this.map.dragRotate.enable(),!1===t.keyboardEnable&&this.map.keyboard.disable(),!0===t.keyboardEnable&&this.map.keyboard.enable(),!1===t.zoomEnable&&this.map.scrollZoom.disable(),!0===t.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,e){this.map.flyTo({zoom:t,center:e})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToCoord",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(t,0),r=n.x,i=n.y;return[r-e.x,i-e.y]}},{key:"lngLatToMercator",value:function(t,e){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),a=o.meterInMercatorCoordinateUnits(),s=li.create();return li.translate(s,s,Gl.fromValues(o.x-i.x,o.y-i.y,o.z||0-i.z)),li.scale(s,s,Gl.fromValues(a*r[0],-a*r[1],a*r[2])),li.rotateX(s,s,n[0]),li.rotateY(s,s,n[1]),li.rotateZ(s,s,n[2]),s}},{key:"init",value:(e=(0,lo.Z)(ho().mark((function t(){var e,n,r,i,o,a,s,u,l,c,h,f,p,d=this;return ho().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,i=e.attributionControl,o=void 0!==i&&i,a=e.style,s=void 0===a?"light":a,u=e.token,l=void 0===u?gd:u,c=e.rotation,h=void 0===c?0:c,f=e.mapInstance,p=Mo(e,cd),this.viewport=new ud,f||window.mapboxgl||console.error(this.configService.getSceneWarninfo("SDK")),l!==gd||"blank"===s||window.mapboxgl.accessToken||f||console.warn(this.configService.getSceneWarninfo("MapToken")),f||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=l),f?(this.map=f,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(r),this.map=new window.mapboxgl.Map(fd({container:this.$mapContainer,style:this.getMapStyle(s),attributionControl:o,bearing:h},p))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",(function(){return d.dragging=!0,""})),this.map.on("dragend",(function(){return d.dragging=!1,""})),this.handleCameraChanged();case 11:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){var t,e;null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,e){var n=new(sd().LngLat)(t[0],t[1]),r=new(sd().LngLat)(e[0],e[1]),i=n.distanceTo(r),o=sd().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),a=sd().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),s=o.x,u=o.y,l=a.x,c=a.y;return 4194304*Math.sqrt(Math.pow(s-l,2)+Math.pow(u-c,2))*2/i}},{key:"exportMap",value:function(t){var e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var e=t;"string"==typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+dd++,e.appendChild(n),n}},{key:"getMapStyle",value:function(t){return"string"!=typeof t?t:ld[t]?ld[t]:t}}]),t}(),ed=(0,ki.Z)(td.prototype,"config",[qp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nd=(0,ki.Z)(td.prototype,"configService",[Kp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rd=(0,ki.Z)(td.prototype,"coordinateSystemService",[Qp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),id=(0,ki.Z)(td.prototype,"eventEmitter",[Jp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$p=td))||$p);!function(t,e){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".mapboxgl-ctrl-logo {\n display: none !important;\n}\n");var md,yd,_d,bd,xd,wd,Ed=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getServiceConstructor",value:function(){return vd}}]),i}(Zl),Sd=n(3218),Cd=n.n(Sd),Ad=(md=(0,Zr.b2)(),yd=(0,Zr.f3)(Ur.IGlobalConfigService),md((bd=function(){function t(){(0,z.Z)(this,t),(0,Ti.Z)(this,"configService",xd,this),(0,m.Z)(this,"enabled",void 0)}return(0,F.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=(e.rendererService,e.postProcessingPassFactory),i=e.normalPassFactory;t.hooks.init.tap("MultiPassRendererPlugin",(function(){var e=t.getLayerConfig(),o=e.enableMultiPassRenderer,a=e.passes,s=void 0===a?[]:a;n.enabled=!!o&&!1!==t.getLayerConfig().enableMultiPassRenderer,n.enabled&&(t.multiPassRenderer=n.createMultiPassRenderer(t,s,r,i),t.multiPassRenderer.setRenderFlag(!0))})),t.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){}))}},{key:"createMultiPassRenderer",value:function(t,e,n,r){var i=t.multiPassRenderer,o=t.getLayerConfig(),a=o.enablePicking;return o.enableTAA,a&&i.add(r("pixelPicking")),i}}]),t}(),xd=(0,ki.Z)(bd.prototype,"configService",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d=bd))||_d),Td=(wd={},(0,m.Z)(wd,du.additive,{enable:!0,func:{srcRGB:qi.ONE,dstRGB:qi.ONE,srcAlpha:1,dstAlpha:1}}),(0,m.Z)(wd,du.none,{enable:!1}),(0,m.Z)(wd,du.normal,{enable:!0,func:{srcRGB:qi.SRC_ALPHA,dstRGB:qi.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,m.Z)(wd,du.subtractive,{enable:!0,func:{srcRGB:qi.ONE,dstRGB:qi.ONE,srcAlpha:qi.ZERO,dstAlpha:qi.ONE_MINUS_SRC_COLOR},equation:{rgb:qi.FUNC_SUBTRACT,alpha:qi.FUNC_SUBTRACT}}),(0,m.Z)(wd,du.max,{enable:!0,func:{srcRGB:qi.ONE,dstRGB:qi.ONE},equation:{rgb:qi.MAX_EXT}}),(0,m.Z)(wd,du.min,{enable:!0,func:{srcRGB:qi.ONE,dstRGB:qi.ONE},equation:{rgb:qi.MIN_EXT}}),wd),kd=n(1763),Md=n.n(kd),Pd=n(1469),Id=n.n(Pd);function Od(t,e,n,r,i){e.updateStyleAttribute(t,n,r,i)}function Rd(t,e,n){Ln()(n)?Od(t,e,n,(function(t){return t})):Md()(n)?Od(t,e,[n],void 0):Id()(n)&&2===n.length&&(Ln()(n[0])&&Nn()(n[1])||Ln()(n[0])&&Id()(n[1])&&Md()(n[1][0])&&Md()(n[1][1]))?Od(t,e,n[0],n[1]):Od(t,e,[1],void 0)}function Ld(t,e,n){Ln()(n)?Od(t,e,n,(function(t){return t})):Id()(n)&&2===n.length&&Ln()(n[0])&&Nn()(n[1])?Od(t,e,n[0],n[1]):Id()(n)&&2===n.length&&Md()(n[0])&&Md()(n[1])?Od(t,e,n,void 0):Od(t,e,[0,0],void 0)}var Dd,Nd,Bd,zd=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]],Fd=["passes"],Zd=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"];function jd(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ud(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Gd(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ud(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ud(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Vd,Wd,Hd,Xd=0,Yd=(Dd=iu(Ur.IGlobalConfigService),Nd=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,z.Z)(this,i),t=r.call(this),(0,m.Z)((0,H.Z)(t),"id","".concat(Xd++)),(0,m.Z)((0,H.Z)(t),"name","".concat(Xd)),(0,m.Z)((0,H.Z)(t),"type",void 0),(0,m.Z)((0,H.Z)(t),"visible",!0),(0,m.Z)((0,H.Z)(t),"zIndex",0),(0,m.Z)((0,H.Z)(t),"minZoom",void 0),(0,m.Z)((0,H.Z)(t),"maxZoom",void 0),(0,m.Z)((0,H.Z)(t),"inited",!1),(0,m.Z)((0,H.Z)(t),"layerModelNeedUpdate",!1),(0,m.Z)((0,H.Z)(t),"pickedFeatureID",null),(0,m.Z)((0,H.Z)(t),"selectedFeatureID",null),(0,m.Z)((0,H.Z)(t),"styleNeedUpdate",!1),(0,m.Z)((0,H.Z)(t),"rendering",void 0),(0,m.Z)((0,H.Z)(t),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,m.Z)((0,H.Z)(t),"hooks",{init:new hr,afterInit:new hr,beforeRender:new hr,beforeRenderData:new cr,afterRender:new or,beforePickingEncode:new or,afterPickingEncode:new or,beforeHighlight:new or(["pickedColor"]),afterHighlight:new or,beforeSelect:new or(["pickedColor"]),afterSelect:new or,beforeDestroy:new or,afterDestroy:new or}),(0,m.Z)((0,H.Z)(t),"models",[]),(0,m.Z)((0,H.Z)(t),"multiPassRenderer",void 0),(0,m.Z)((0,H.Z)(t),"plugins",void 0),(0,m.Z)((0,H.Z)(t),"sourceOption",void 0),(0,m.Z)((0,H.Z)(t),"layerModel",void 0),(0,m.Z)((0,H.Z)(t),"sceneContainer",void 0),(0,m.Z)((0,H.Z)(t),"layerChildren",[]),(0,Ti.Z)((0,H.Z)(t),"configService",Bd,(0,H.Z)(t)),(0,m.Z)((0,H.Z)(t),"shaderModuleService",void 0),(0,m.Z)((0,H.Z)(t),"cameraService",void 0),(0,m.Z)((0,H.Z)(t),"coordinateService",void 0),(0,m.Z)((0,H.Z)(t),"iconService",void 0),(0,m.Z)((0,H.Z)(t),"fontService",void 0),(0,m.Z)((0,H.Z)(t),"pickingService",void 0),(0,m.Z)((0,H.Z)(t),"rendererService",void 0),(0,m.Z)((0,H.Z)(t),"layerService",void 0),(0,m.Z)((0,H.Z)(t),"interactionService",void 0),(0,m.Z)((0,H.Z)(t),"mapService",void 0),(0,m.Z)((0,H.Z)(t),"styleAttributeService",void 0),(0,m.Z)((0,H.Z)(t),"layerSource",void 0),(0,m.Z)((0,H.Z)(t),"postProcessingPassFactory",void 0),(0,m.Z)((0,H.Z)(t),"normalPassFactory",void 0),(0,m.Z)((0,H.Z)(t),"animateOptions",{enable:!1}),(0,m.Z)((0,H.Z)(t),"container",void 0),(0,m.Z)((0,H.Z)(t),"encodedData",void 0),(0,m.Z)((0,H.Z)(t),"configSchema",void 0),(0,m.Z)((0,H.Z)(t),"currentPickId",null),(0,m.Z)((0,H.Z)(t),"rawConfig",void 0),(0,m.Z)((0,H.Z)(t),"needUpdateConfig",void 0),(0,m.Z)((0,H.Z)(t),"pendingStyleAttributes",[]),(0,m.Z)((0,H.Z)(t),"scaleOptions",{}),(0,m.Z)((0,H.Z)(t),"animateStartTime",void 0),(0,m.Z)((0,H.Z)(t),"aniamateStatus",!1),(0,m.Z)((0,H.Z)(t),"bottomColor","rgba(0, 0, 0, 0)"),(0,m.Z)((0,H.Z)(t),"isDestroied",!1),(0,m.Z)((0,H.Z)(t),"sourceEvent",(function(){t.dataState.dataSourceNeedUpdate=!0;var e=t.getLayerConfig(),n=e.autoFit,r=e.fitBoundsOptions;n&&t.fitBounds(r),t.emit("dataUpdate"),t.reRender()})),t.name=e.name||t.id,t.zIndex=e.zIndex||0,t.rawConfig=e,t}return(0,F.Z)(i,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){if(this.inited){var e=this.container.get(Ur.SceneID);(function(t,e){t.opacity&&Rd("opacity",e,t.opacity),t.strokeWidth&&Rd("strokeWidth",e,t.strokeWidth),t.strokeOpacity&&Rd("strokeOpacity",e,t.strokeOpacity),t.stroke&&function(t,e,n){Ln()(n)?Od(t,e,n,void 0):Id()(n)&&2===n.length&&(Ln()(n[0])&&Nn()(n[1])||Ln()(n[0])&&Id()(n[1])&&n[1].length>0)?Od(t,e,n[0],n[1]):Od(t,e,"#fff",void 0)}("stroke",e,t.stroke),t.offsets&&Ld("offsets",e,t.offsets),t.textOffset&&Ld("textOffset",e,t.textOffset),t.thetaOffset&&Rd("thetaOffset",e,t.thetaOffset)})(t,this),this.configService.setLayerConfig(e,this.id,Gd(Gd(Gd({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}else this.needUpdateConfig=Gd(Gd({},this.needUpdateConfig),t)}},{key:"setContainer",value:function(t,e){this.container=t,this.sceneContainer=e}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(t){this.bottomColor=t}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:function(){var t=this,e=this.container.get(Ur.SceneID),n=this.rawConfig.enableMultiPassRenderer,r=void 0!==n&&n;this.configService.setLayerConfig(e,this.id,{enableMultiPassRenderer:r}),this.iconService=this.container.get(Ur.IIconService),this.fontService=this.container.get(Ur.IFontService),this.rendererService=this.container.get(Ur.IRendererService),this.layerService=this.container.get(Ur.ILayerService),this.interactionService=this.container.get(Ur.IInteractionService),this.pickingService=this.container.get(Ur.IPickingService),this.mapService=this.container.get(Ur.IMapService),this.cameraService=this.container.get(Ur.ICameraService),this.coordinateService=this.container.get(Ur.ICoordinateSystemService),this.shaderModuleService=this.container.get(Ur.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Ur.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Ur.IFactoryNormalPass),this.styleAttributeService=this.container.get(Ur.IStyleAttributeService),this.multiPassRenderer=this.container.get(Ur.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach((function(e){var n=e.attributeName,r=e.attributeField,i=e.attributeValues,o=e.updateOptions;t.styleAttributeService.updateStyleAttribute(n,{scale:Gd({field:r},t.splitValuesAndCallbackInAttribute(i,t.getLayerConfig()[n]))},o)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Ur.ILayerPlugin);var i,o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return jd(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jd(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.plugins);try{for(o.s();!(i=o.n()).done;)i.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(t){o.e(t)}finally{o.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Gd(Gd({},this.getDefaultConfig()),this.rawConfig));var t=this.getLayerConfig().animateOption;null!=t&&t.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(t,e,n){return this.updateStyleAttribute("color",t,e,n),this}},{key:"texture",value:function(t,e,n){return this.updateStyleAttribute("texture",t,e,n),this}},{key:"rotate",value:function(t,e,n){return this.updateStyleAttribute("rotate",t,e,n),this}},{key:"size",value:function(t,e,n){return this.updateStyleAttribute("size",t,e,n),this}},{key:"filter",value:function(t,e,n){return this.updateStyleAttribute("filter",t,e,n),this}},{key:"shape",value:function(t,e,n){var r,i,o,a=null===(r=this.styleAttributeService)||void 0===r||null===(i=r.getLayerStyleAttribute("shape"))||void 0===i||null===(o=i.scale)||void 0===o?void 0:o.field,s=t;return this.updateStyleAttribute("shape",t,e,n),function(t,e,n){"string"==typeof e&&"string"==typeof n&&e!==n&&zd.map((function(r){r.includes(e)&&r.includes(n)&&(t.dataState.dataSourceNeedUpdate=!0)}))}(this,a,s),this}},{key:"label",value:function(t,e,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:e,updateOptions:n}),this}},{key:"animate",value:function(t){var e={};return Cd()(t)?(e.enable=!0,e=Gd(Gd({},e),t)):e.enable=t,this.updateLayerConfig({animateOption:e}),this}},{key:"source",value:function(t,e){return null!=t&&t.data?(this.setSource(t),this):(this.sourceOption={data:t,options:e},this)}},{key:"setData",value:function(t,e){var n=this;return this.inited?this.layerSource.setData(t,e):this.on("inited",(function(){n.layerSource.setData(t,e)})),this}},{key:"style",value:function(t){var e=this,n=t.passes,r=Mo(t,Fd);return n&&function(t){return t.map((function(t){return"string"==typeof t&&(t=[t,{}]),t}))}(n).forEach((function(t){var n=e.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(t[0]);n&&n.updateOptions(t[1])})),this.rawConfig=Gd(Gd({},this.rawConfig),r),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(t,e){return Cd()(t)?this.scaleOptions=Gd(Gd({},this.scaleOptions),t):this.scaleOptions[t]=e,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return 0!==this.getEncodedData().length&&this.renderModels(),this}},{key:"active",value:function(t){var e={};return e.enableHighlight=!!Cd()(t)||t,Cd()(t)?(e.enableHighlight=!0,t.color&&(e.highlightColor=t.color),t.mix&&(e.activeMix=t.mix)):e.enableHighlight=!!t,this.updateLayerConfig(e),this}},{key:"setActive",value:function(t,e){var n=this;if(Cd()(t)){var r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:Cd()(e)?e.color:this.getLayerConfig().highlightColor,activeMix:Cd()(e)?e.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:Cd()(e)?e.color:this.getLayerConfig().highlightColor,activeMix:Cd()(e)?e.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(_n(t)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(t){var e={};return e.enableSelect=!!Cd()(t)||t,Cd()(t)?(e.enableSelect=!0,t.color&&(e.selectColor=t.color),t.mix&&(e.selectMix=t.mix)):e.enableSelect=!!t,this.updateLayerConfig(e),this}},{key:"setSelect",value:function(t,e){var n=this;if(Cd()(t)){var r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:Cd()(e)?e.color:this.getLayerConfig().selectColor,selectMix:Cd()(e)?e.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:Cd()(e)?e.color:this.getLayerConfig().selectColor,selectMix:Cd()(e)?e.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(_n(t)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(t){this.updateLayerConfig({blend:t}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),e=this.getLayerConfig(),n=e.visible,r=e.minZoom,i=void 0===r?-1/0:r,o=e.maxZoom;return!!n&&t>=i&&t<=(void 0===o?1/0:o)}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(t){return this.getLayerConfig()[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var e=this.getSource().extent;return e.some((function(t){return Math.abs(t)===1/0}))||this.mapService.fitBounds([[e[0],e[1]],[e[2],e[3]]],t),this}},{key:"destroy",value:function(){this.isDestroied||(this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach((function(t){return t.destroy()})),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices})).length}},{key:"setSource",value:function(t){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.inited&&this.layerSource.cluster){var e=this.mapService.getZoom();this.layerSource.updateClusterData(e)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(t){var e=this.styleAttributeService.getLayerAttributeScale(t);return e?e.ticks?e.ticks().map((function(n){return(0,m.Z)({value:n},t,e(n))})):e.invertExtent?e.range().map((function(n){return(0,m.Z)({value:e.invertExtent(n)},t,n)})):void 0:[]}},{key:"pick",value:function(t){var e=t.x,n=t.y;this.interactionService.triggerHover({x:e,y:n})}},{key:"boxSelect",value:function(t,e){this.pickingService.boxPickLayer(this,t,e)}},{key:"buildLayerModel",value:function(t){var e=t.moduleName,n=t.vertexShader,r=t.fragmentShader,i=t.triangulation,o=t.segmentNumber,a=Mo(t,Zd);this.shaderModuleService.registerModule(e,{vs:n,fs:r});var s=this.shaderModuleService.getModule(e),u=s.vs,l=s.fs,c=s.uniforms,h=this.rendererService.createModel,f=this.styleAttributeService.createAttributesAndIndices(this.encodedData,i,o);return h(Gd({attributes:f.attributes,uniforms:c,fs:l,vs:u,elements:f.elements,blend:Td[du.normal]},a))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){var e=this.getLayerConfig(),n=e.enableHighlight,r=void 0===n||n,i=e.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(t)||-1!==this.eventNames().indexOf("un"+t);return"click"!==t&&"dblclick"!==t||!o||(a=!0),"mousemove"!==t||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(t){var e=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach((function(n){n.draw({uniforms:e.layerModel.getUninforms()},t)}))),this}},{key:"updateStyleAttribute",value:function(t,e,n,r){this.inited?this.styleAttributeService.updateStyleAttribute(t,{scale:Gd({field:e},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[e]))},r):this.pendingStyleAttributes.push({attributeName:t,attributeField:e,attributeValues:n,updateOptions:r})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(t,e){return{values:Nn()(t)?void 0:t||e,callback:Nn()(t)?t:void 0}}}]),i}(fr.EventEmitter),Bd=(0,ki.Z)(Nd.prototype,"configService",[Dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd),qd=n(8446),Kd=n.n(qd);function Qd(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Jd=(Vd=iu(Ur.IGlobalConfigService),Wd=function(){function t(e){(0,z.Z)(this,t),(0,m.Z)(this,"triangulation",void 0),(0,m.Z)(this,"createTexture2D",void 0),(0,m.Z)(this,"layer",void 0),(0,m.Z)(this,"dataTexture",void 0),(0,m.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,m.Z)(this,"rowCount",void 0),(0,m.Z)(this,"cacheStyleProperties",void 0),(0,m.Z)(this,"cellLength",void 0),(0,m.Z)(this,"cellProperties",void 0),(0,m.Z)(this,"cellTypeLayout",void 0),(0,m.Z)(this,"stylePropertyesExist",void 0),(0,m.Z)(this,"dataTextureTest",void 0),(0,Ti.Z)(this,"configService",Hd,this),(0,m.Z)(this,"shaderModuleService",void 0),(0,m.Z)(this,"rendererService",void 0),(0,m.Z)(this,"iconService",void 0),(0,m.Z)(this,"fontService",void 0),(0,m.Z)(this,"styleAttributeService",void 0),(0,m.Z)(this,"mapService",void 0),(0,m.Z)(this,"cameraService",void 0),(0,m.Z)(this,"layerService",void 0),this.layer=e,this.rendererService=e.getContainer().get(Ur.IRendererService),this.shaderModuleService=e.getContainer().get(Ur.IShaderModuleService),this.styleAttributeService=e.getContainer().get(Ur.IStyleAttributeService),this.mapService=e.getContainer().get(Ur.IMapService),this.iconService=e.getContainer().get(Ur.IIconService),this.fontService=e.getContainer().get(Ur.IFontService),this.cameraService=e.getContainer().get(Ur.ICameraService),this.layerService=e.getContainer().get(Ur.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var n=this.rendererService.createTexture2D;this.createTexture2D=n,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8ClampedArray(4),mag:qi.NEAREST,min:qi.NEAREST,width:1,height:1}))}return(0,F.Z)(t,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var e=!1;return Kd()(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(e=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),Kd()(t.opacity,this.cacheStyleProperties.opacity)||(e=!0,this.cacheStyleProperties.opacity=t.opacity),Kd()(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(e=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),Kd()(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(e=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),Kd()(t.stroke,this.cacheStyleProperties.stroke)||(e=!0,this.cacheStyleProperties.stroke=t.stroke),Kd()(t.offsets,this.cacheStyleProperties.offsets)||(e=!0,this.cacheStyleProperties.offsets=t.offsets),void 0===this.dataTexture&&(e=!0),e}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),void 0===t.opacity||Md()(t.opacity)||(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),void 0===t.strokeOpacity||Md()(t.strokeOpacity)||(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),void 0===t.strokeWidth||Md()(t.strokeWidth)||(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),void 0===t.stroke||this.isStaticColor(t.stroke)||(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),void 0===t.offsets||this.isOffsetStatic(t.offsets)||(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),void 0===t.thetaOffset||Md()(t.thetaOffset)||(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return!!Ln()(t)&&!!(0,gn.ZP)(t)}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var e=mn(t);return e[0]=e[0]?e[0]:0,e[1]=e[1]?e[1]:0,e[2]=e[2]?e[2]:0,e[3]=e[3]?e[3]:0,e}return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Id()(t)&&2===t.length&&Md()(t[0])&&Md()(t[1]))}},{key:"patchMod",value:function(t,e){for(var n=0;n<e;n++)t.push(-1)}},{key:"patchData",value:function(t,e,n){var r,i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Qd(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qd(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(n);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.attr,s=o.count,u=e[a];void 0!==u?"stroke"===a?t.push.apply(t,(0,y.Z)(mn(u))):"offsets"===a?this.isOffsetStatic(u)?t.push(-u[0],u[1]):t.push(0,0):t.push(Md()(u)?u:1):this.patchMod(t,s)}}catch(t){i.e(t)}finally{i.f()}}},{key:"calDataFrame",value:function(t,e,n){for(var r=e.length,i=Math.ceil(r*t/this.DATA_TEXTURE_WIDTH),o=i*this.DATA_TEXTURE_WIDTH,a=[],s=0;s<r;s++){var u=e[s];this.patchData(a,u,n)}for(var l=a.length;l<o;l++)a.push(-1);return{data:a,width:this.DATA_TEXTURE_WIDTH,height:i}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig().blend;return Td[du[void 0===t?"normal":t]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}}]),t}(),Hd=(0,ki.Z)(Wd.prototype,"configService",[Vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wd),$d=n(9187),tg=n.n($d);function eg(t){return t/180*Math.acos(-1)}function ng(t){var e=eg(t[0])+Math.PI/2,n=eg(t[1]),r=100+.4*Math.random(),i=r*Math.cos(n)*Math.cos(e);return[r*Math.cos(n)*Math.sin(e),r*Math.sin(n),i]}function rg(t,e){var n=li.create(),r=li.create(),i=Gl.fromValues(0,1,0),o=Gl.fromValues(0,0,0);t=void 0!==t?t:1;for(var a=2+(void 0!==(e=e||{}).segments?e.segments:32),s=2*a,u=[],l=[],c=[],h=[],f=[],p=[],d=0;d<=a;d++){for(var g=d/a,v=g*Math.PI,m=0;m<=s;m++){var _=m/s,b=_*Math.PI*2;li.identity(r),li.rotateZ(r,r,-v),li.identity(n),li.rotateY(n,n,b),Gl.transformMat4(o,i,r),Gl.transformMat4(o,o,n),Gl.scale(o,o,-t),c.push(o.slice()),h.push.apply(h,(0,y.Z)(o.slice())),Gl.normalize(o,o),f.push.apply(f,(0,y.Z)(o.slice())),p.push([_,1-g]),h.push(_,1-g)}if(d>0)for(var x=c.length,w=x-2*(s+1);w+s+2<x;w++)u.push([w,w+1,w+s+1]),l.push(w,w+1,w+s+1),u.push([w+s+1,w+1,w+s+2]),l.push(w+s+1,w+1,w+s+2)}return{cells:u,positions:c,uvs:p,positionsArr:h,indicesArr:l,normalArr:f}}var ig=cp.Ue(),og=(cp.Ue(),cp.Ue()),ag=cp.Ue(),sg=cp.Ue();function ug(t,e,n,r,i){cp.IH(t,n,r),cp.Fv(t,t),e=cp.al(-t[1],t[0]);var o=cp.al(-n[1],n[0]);return[i/cp.AK(e,o),e]}function lg(t,e){return cp.t8(t,-e[1],e[0])}function cg(t,e,n){return cp.lu(t,e,n),cp.Fv(t,t),t}function hg(t,e){return t[0]===e[0]&&t[1]===e[1]}var fg,pg,dg,gg=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,z.Z)(this,t),(0,m.Z)(this,"complex",void 0),(0,m.Z)(this,"join",void 0),(0,m.Z)(this,"cap",void 0),(0,m.Z)(this,"miterLimit",void 0),(0,m.Z)(this,"thickness",void 0),(0,m.Z)(this,"normal",void 0),(0,m.Z)(this,"lastFlip",-1),(0,m.Z)(this,"miter",cp.al(0,0)),(0,m.Z)(this,"started",!1),(0,m.Z)(this,"dash",!1),(0,m.Z)(this,"totalDistance",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,F.Z)(t,[{key:"extrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a=t[o-1],s=e[o-1],u=t[o],l=e[o],c=o<t.length-1?t[o+1]:null,h=o<e.length-1?e[o+1]:null;i+=this.segment_gaode2(n,i,a,u,c,s,l,h)}if(this.dash)for(var f=0;f<n.positions.length/6;f++)n.positions[6*f+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null;r+=this.segment(e,r,o,a,s)}if(this.dash)for(var u=0;u<e.positions.length/6;u++)e.positions[6*u+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,n,r,i,o,a,s){var u=0,l=t.indices,c=t.positions,h=t.normals,f="square"===this.cap,p="bevel"===this.join,d=rn([a[0],a[1]]),g=rn([o[0],o[1]]);cg(og,r,n);var v=0;if(this.dash&&(v=this.lineSegmentDistance(d,g),this.totalDistance+=v),this.normal||(this.normal=cp.Ue(),lg(this.normal,og)),!this.started)if(this.started=!0,f){var m=cp.Ue(),_=cp.Ue();cp.IH(m,this.normal,og),cp.IH(_,this.normal,og),h.push(_[0],_[1],0),h.push(m[0],m[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-v,-this.thickness,0|n[2]),c.push(n[0],n[1],0|n[2],this.totalDistance-v,this.thickness,0|n[2])}else this.extrusions(c,h,n,this.normal,this.thickness,this.totalDistance-v);if(l.push(e+0,e+1,e+2),i){hg(r,i)&&cp.IH(i,r,cp.Fv(i,cp.$X(i,r,n))),cg(ag,i,r);var b=ug(sg,cp.Ue(),og,ag,this.thickness),x=(0,R.Z)(b,2),w=x[0],E=x[1],S=cp.AK(sg,this.normal)<0?-1:1,C=p;C||"miter"!==this.join||w>this.miterLimit&&(C=!0),C?(h.push(this.normal[0],this.normal[1],0),h.push(E[0],E[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*S,0|r[2]),l.push.apply(l,(0,y.Z)(this.lastFlip!==-S?[e,e+2,e+3]:[e+2,e+1,e+3])),l.push(e+2,e+3,e+4),lg(ig,ag),cp.JG(this.normal,ig),h.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*S,0|r[2]),u+=3):(this.extrusions(c,h,r,E,w,this.totalDistance),l.push.apply(l,(0,y.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),S=-1,cp.JG(this.normal,E),u+=2),this.lastFlip=S}else{if(lg(this.normal,og),f){var A=cp.Ue(),T=cp.Ue();cp.lu(T,og,this.normal),cp.IH(A,og,this.normal),h.push(T[0],T[1],0),h.push(A[0],A[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2])}else this.extrusions(c,h,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,(0,y.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),u+=2}return u}},{key:"segment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,l="square"===this.cap,c="bevel"===this.join,h=rn([r[0],r[1]]),f=rn([n[0],n[1]]);cg(og,h,f);var p=0;if(this.dash&&(p=this.lineSegmentDistance(h,f),this.totalDistance+=p),this.normal||(this.normal=cp.Ue(),lg(this.normal,og)),!this.started)if(this.started=!0,l){var d=cp.Ue(),g=cp.Ue();cp.IH(d,this.normal,og),cp.IH(g,this.normal,og),u.push(g[0],g[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2])}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),i){var v=rn([i[0],i[1]]);hg(h,v)&&cp.IH(v,h,cp.Fv(v,cp.$X(v,h,f))),cg(ag,v,h);var m=ug(sg,cp.Ue(),og,ag,this.thickness),_=(0,R.Z)(m,2),b=_[0],x=_[1],w=cp.AK(sg,this.normal)<0?-1:1,E=c;E||"miter"!==this.join||b>this.miterLimit&&(E=!0),E?(u.push(this.normal[0],this.normal[1],0),u.push(x[0],x[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*w,0|r[2]),a.push.apply(a,(0,y.Z)(this.lastFlip!==-w?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),lg(ig,ag),cp.JG(this.normal,ig),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*w,0|r[2]),o+=3):(this.extrusions(s,u,r,x,b,this.totalDistance),a.push.apply(a,(0,y.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),w=-1,cp.JG(this.normal,x),o+=2),this.lastFlip=w}else{if(lg(this.normal,og),l){var S=cp.Ue(),C=cp.Ue();cp.lu(C,og,this.normal),cp.IH(S,og,this.normal),u.push(C[0],C[1],0),u.push(S[0],S[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2])}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,(0,y.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2}return o}},{key:"extrusions",value:function(t,e,n,r,i,o){e.push(r[0],r[1],0),e.push(r[0],r[1],0),t.push(n[0],n[1],0|n[2],o,-i,0|n[2]),t.push(n[0],n[1],0|n[2],o,i,0|n[2])}},{key:"lineSegmentDistance",value:function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}}]),t}();function vg(t){if(Md()(t[0]))return t;if(Md()(t[0][0]))throw new Error("当前数据不支持标注");if(Md()(t[0][0][0])){var e=0,n=0,r=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],n+=t[1],r++}))})),[e/r,n/r,0]}throw new Error("当前数据不支持标注")}function mg(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t[0][0],r=t[0][t[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var i=t[0].length,o=tg().flatten(t),a=o.vertices,s=o.dimensions,u=[],l=[],c=[],h=0;h<a.length/s;h++)2===s?u.push(a[2*h],a[2*h+1],1,-1,-1):u.push(a[3*h],a[3*h+1],1,-1,-1),c.push(0,0,1);var f=tg()(o.vertices,o.holes,o.dimensions);l.push.apply(l,(0,y.Z)(f));for(var p=function(t){var n=o.vertices.slice(t*s,(t+1)*s),r=o.vertices.slice((t+1)*s,(t+2)*s);0===r.length&&(r=o.vertices.slice(0,s));var i=u.length/5;u.push(n[0],n[1],1,0,0,r[0],r[1],1,.1,0,n[0],n[1],0,0,.8,r[0],r[1],0,.1,.8);var a=yg([r[0],r[1],1],[n[0],n[1],0],[n[0],n[1],1],e);c.push.apply(c,(0,y.Z)(a).concat((0,y.Z)(a),(0,y.Z)(a),(0,y.Z)(a))),l.push.apply(l,(0,y.Z)([1,2,0,3,2,1].map((function(t){return t+i}))))},d=0;d<i;d++)p(d);return{positions:u,index:l,normals:c}}function yg(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=Gl.create(),o=Gl.create(),a=Gl.create();r&&(t=Je(t),e=Je(e),n=Je(n));var s=Gl.fromValues.apply(Gl,(0,y.Z)(t)),u=Gl.fromValues.apply(Gl,(0,y.Z)(e)),l=Gl.fromValues.apply(Gl,(0,y.Z)(n));Gl.sub(i,l,u),Gl.sub(o,s,u),Gl.cross(a,i,o);var c=Gl.create();return Gl.normalize(c,a),c}function _g(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/t,r=[],i=0;i<t;i++)r.push(n*i+e*Math.PI/12);var o=r.map((function(t){return[Math.sin(t+Math.PI/4),Math.cos(t+Math.PI/4),0]}));return o}function bg(){return _g(30)}function xg(){return _g(4)}function wg(){return _g(3)}function Eg(){return _g(6,1)}function Sg(){return _g(5)}!function(t){t.CYLINDER="cylinder",t.SQUARECOLUMN="squareColumn",t.TRIANGLECOLUMN="triangleColumn",t.HEXAGONCOLUMN="hexagonColumn",t.PENTAGONCOLUMN="pentagonColumn"}(pg||(pg={})),function(t){t.CIRCLE="circle",t.SQUARE="square",t.TRIANGLE="triangle",t.HEXAGON="hexagon",t.PENTAGON="pentagon"}(dg||(dg={}));var Cg=(fg={},(0,m.Z)(fg,dg.CIRCLE,bg),(0,m.Z)(fg,dg.HEXAGON,Eg),(0,m.Z)(fg,dg.TRIANGLE,wg),(0,m.Z)(fg,dg.SQUARE,xg),(0,m.Z)(fg,dg.PENTAGON,Sg),(0,m.Z)(fg,pg.CYLINDER,bg),(0,m.Z)(fg,pg.HEXAGONCOLUMN,Eg),(0,m.Z)(fg,pg.TRIANGLECOLUMN,wg),(0,m.Z)(fg,pg.SQUARECOLUMN,xg),(0,m.Z)(fg,pg.PENTAGONCOLUMN,Sg),fg),Ag={};function Tg(t){var e=vg(t.coordinates);return{vertices:[].concat((0,y.Z)(e),(0,y.Z)(e),(0,y.Z)(e),(0,y.Z)(e)),indices:[0,1,2,2,3,0],size:e.length}}function kg(t){var e=ng(vg(t.coordinates));return{vertices:[].concat((0,y.Z)(e),(0,y.Z)(e),(0,y.Z)(e),(0,y.Z)(e)),indices:[0,1,2,2,3,0],size:e.length}}function Mg(t){var e=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Ag&&Ag[t])return Ag[t];var n=mg([Cg[t]?Cg[t]():Cg.cylinder()],e);return Ag[t]=n,n}(t.shape,!1);return{vertices:e.positions,indices:e.index,normals:e.normals,size:5}}function Pg(t){var e=vg(t.coordinates);return{vertices:(0,y.Z)(e),indices:[0],size:e.length}}function Ig(t){var e=t.coordinates,n=t.originCoordinates,r=t.version,i=new gg({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=e;Array.isArray(o[0][0])||(o=[e]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],l=a[s];i.extrude_gaode2(u,l)}}else{var c=e;Array.isArray(c[0][0])||(c=[e]),c.forEach((function(t){i.extrude(t)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,size:6}}function Og(t){var e=t.coordinates,n=tg().flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:tg()(r,o,i),vertices:r,size:i}}function Rg(t){var e=t.coordinates,n=tg().flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:tg()(r,o,i),vertices:Lg(r),size:i+4}}function Lg(t){for(var e=[],n=function(t){for(var e=t[0],n=t[1],r=t[0],i=t[1],o=0,a=0,s=0,u=0;u<t.length;u+=2){var l=t[u],c=t[u+1];l&&c&&(e=Math.max(l,e),n=Math.max(c,n),r=Math.min(l,r),i=Math.min(c,i),o+=l,a+=c,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(e-r,2)+Math.pow(n-i,2))/2}}(t),r=n.center,i=n.radius,o=0;o<t.length;o+=2){var a=t[o],s=t[o+1];e.push.apply(e,[a,s,0].concat((0,y.Z)(r),[i]))}return e}function Dg(t){var e=mg(t.coordinates,!0);return{vertices:e.positions,indices:e.index,normals:e.normals,size:5}}function Ng(t){var e,n,r,i,o,a=(e=t.shape,o=Cg[e]?Cg[e]():Cg.circle(),-1===["cylinder","triangleColumn","hexagonColumn","squareColumn"].indexOf(e)?(n=[o],r=tg().flatten(n),i=tg()(r.vertices,r.holes,r.dimensions),{positions:r.vertices,index:i}):function(t){var e=t[0][0],n=t[0][t[0].length-1];e[0]===n[0]&&e[1]===n[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var r=t[0].length,i=tg().flatten(t),o=i.vertices,a=i.dimensions,s=[],u=[],l=0;l<o.length/a;l++)2===a?s.push(o[2*l],o[2*l+1],1):s.push(o[3*l],o[3*l+1],1);var c=tg()(i.vertices,i.holes,i.dimensions);u.push.apply(u,(0,y.Z)(c));for(var h=function(t){var e=i.vertices.slice(t*a,(t+1)*a),n=i.vertices.slice((t+1)*a,(t+2)*a);0===n.length&&(n=i.vertices.slice(0,a));var r=s.length/3;s.push(e[0],e[1],1,n[0],n[1],1,e[0],e[1],0,n[0],n[1],0),u.push.apply(u,(0,y.Z)([0,2,1,2,3,1].map((function(t){return t+r}))))},f=0;f<r;f++)h(f);return{positions:s,index:u}}([o]));return{vertices:a.positions,indices:a.index,size:3}}function Bg(t){var e=t.coordinates;return{vertices:[].concat((0,y.Z)(e[0]),[0,0,1,e[1][0],e[0][1],0,1,1],(0,y.Z)(e[1]),[0,1,0],(0,y.Z)(e[0]),[0,0,1],(0,y.Z)(e[1]),[0,1,0,e[0][0],e[1][1],0,0,0]),indices:[0,1,2,3,4,5],size:5}}function zg(t,e){for(var n=e||30,r=t.coordinates,i=[],o=[],a=function(t){i.push(t,1,t,r[0][0],r[0][1],r[1][0],r[1][1],t,-1,t,r[0][0],r[0][1],r[1][0],r[1][1]),t!==n-1&&o.push.apply(o,(0,y.Z)([0,1,2,1,3,2].map((function(e){return 2*t+e}))))},s=0;s<n;s++)a(s);return{vertices:i,indices:o,size:7}}function Fg(t){var e=t.coordinates;2===e.length&&e.push(0),t.size;var n=Zg(-1,1),r=Zg(1,1),i=Zg(-1,-1),o=Zg(1,-1);return{vertices:[].concat((0,y.Z)(e),(0,y.Z)(n),(0,y.Z)(e),(0,y.Z)(i),(0,y.Z)(e),(0,y.Z)(o),(0,y.Z)(e),(0,y.Z)(r)),indices:[0,1,2,3,0,2],size:5}}function Zg(t,e){return[(t+1)/2,(e+1)/2]}function jg(){var t=rg(100,{segments:36});return{vertices:t.positionsArr,indices:t.indicesArr,size:5,normals:t.normalArr}}function Ug(){var t=rg(140,{segments:36});return{vertices:t.positionsArr,indices:t.indicesArr,size:5,normals:t.normalArr}}var Gg=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"cityCenter",void 0),(0,m.Z)((0,H.Z)(t),"cityMinSize",void 0),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.baseColor,i=void 0===r?"rgb(16,16,16)":r,o=t.brightColor,a=void 0===o?"rgb(255,176,38)":o,s=t.windowColor,u=void 0===s?"rgb(30,60,89)":s,l=t.time,c=void 0===l?0:l,h=t.sweep,f=void 0===h?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:h;return{u_cityCenter:f.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*f.sweepRadius,u_circleSweep:f.enable?1:0,u_circleSweepColor:mn(f.sweepColor).slice(0,3),u_circleSweepSpeed:f.sweepSpeed,u_opacity:n,u_baseColor:mn(i),u_brightColor:mn(a),u_windowColor:mn(u),u_time:this.layer.getLayerAnimateTime()||c}}},{key:"calCityGeo",value:function(){var t=(0,R.Z)(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3];if("GAODE2.x"===this.mapService.version){this.cityCenter=this.mapService.lngLatToCoord([(r+e)/2,(i+n)/2]);var o=this.mapService.lngLatToCoord([r,i]),a=this.mapService.lngLatToCoord([e,n]);this.cityMinSize=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2))/4}else{var s=r-e,u=i-n;this.cityCenter=[(r+e)/2,(i+n)/2],this.cityMinSize=Math.sqrt(Math.pow(s,2)+Math.pow(u,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\n\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvarying vec4 v_Color;\nuniform mat4 u_Mvp;\n\nuniform float u_circleSweep;\nuniform vec2 u_cityCenter;\n\nvarying float v_worldDis;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n   v_texCoord = a_Uv;\n\n  if(u_circleSweep > 0.0) {\n     vec2 lnglatscale = vec2(0.0);\n    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {\n      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);\n    }\n    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);\n  }\n \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'uniform float u_opacity: 1.0;\nuniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\nuniform float u_near : 0;\nuniform float u_far : 1;\nvarying vec4 v_Color;\nvarying vec2 v_texCoord;\nuniform float u_Zoom : 1;\nuniform float u_time;\n\nuniform float u_circleSweep;\nuniform float u_cityMinSize;\nuniform vec3 u_circleSweepColor;\nuniform float u_circleSweepSpeed;\n\nvarying float v_worldDis;\n\n#pragma include "picking"\n\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\n    float s = step(hot, n);\n    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\n\n    return mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\n\nfloat LinearizeDepth()\n{\n    float z = gl_FragCoord.z * 2.0 - 1.0;\n    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\n\nvec3 fog(vec3 color, vec3 fogColor, float depth){\n    float fogFactor=clamp(depth,0.0,1.0);\n    vec3 output_color=mix(fogColor,color,fogFactor);\n    return output_color;\n}\n\nfloat sdRect(vec2 p, vec2 sz) {\n  vec2 d = abs(p) - sz;\n  float outside = length(max(d, 0.));\n  float inside = min(max(d.x, d.y), 0.);\n  return outside + inside;\n}\n\nvoid main() {\n  gl_FragColor = v_Color;\n  vec3 baseColor = u_baseColor.xyz;\n  vec3 brightColor = u_brightColor.xyz;\n  vec3 windowColor = u_windowColor.xyz;\n  float targetColId = 5.;\n  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\n  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\n  if(v_texCoord.x < 0.) { //顶部颜色\n       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\n       gl_FragColor = vec4( foggedColor, v_Color.w);\n  }else { // 侧面颜色\n        vec2 st = v_texCoord;\n        vec2  UvScale = v_texCoord;\n        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\n        float tStart = 0.25 * tStep;\n        float tEnd = 0.75 * tStep;\n        float u = mod(UvScale.x, tStep);\n        float v = mod(UvScale.y, tStep);\n        float ux = floor(UvScale.x/tStep);\n        float uy = floor(UvScale.y/tStep);\n        float n = random(vec2(ux,uy));\n        float lightP = u_time;\n        float head = 1.0- step(0.005,st.y);\n        /*step3*/\n        // 将窗户颜色和墙面颜色区别开来\n        float sU = step(tStart, u) - step(tEnd, u);\n        float sV = step(tStart, v) - step(tEnd, v);\n        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\n        float dist = sdRect(vec2(u,v), windowSize);\n        float s = sU * sV;\n\n        float curColId = floor(UvScale.x / tStep);\n        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\n\n        float mLightP = mod(lightP, 2.);\n        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\n        if(ux == targetColId){\n            n =0.;\n        }\n        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );\n        float hot = smoothstep(1.0,0.0,timeP);\n        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\n        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);\n        float sFinal = s * sCol * sRow;\n        color += mix(baseColor, brightColor, sFinal*n);\n        if (st.y<0.01){\n        color = baseColor;\n         }\n        if(head ==1.0) { // 顶部亮线\n            color = brightColor;\n        }\n        color = color * v_Color.rgb;\n\n        vec3 foggedColor = fog(color,fogColor,depth);\n\n        gl_FragColor = vec4(foggedColor,1.0);\n  }\n\n\n  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {\n    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);\n    gl_FragColor.rgb += r * r * u_circleSweepColor;\n  }\n   \n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Dg})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:mu.Attribute,descriptor:{name:"a_Normal",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?10:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_Uv",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(t,e,n,r){return t.size,[n[3],n[4]]}}})}}]),i}(Jd);var Vg=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"type","PolygonLayer"),t}return(0,F.Z)(i,[{key:"buildModels",value:function(){this.layerModel=new Gg(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(t){this.updateLayerConfig({time:t})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),i}(Yd);var Wg=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig();return{u_opacity:t.opacity||1,u_coverage:t.coverage||.9,u_angle:t.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:'precision highp float;\r\n// 多边形顶点坐标\r\nattribute vec3 a_Position;\r\n// 多边形经纬度坐标\r\nattribute vec3 a_Pos;\r\nattribute float a_Size;\r\nattribute vec4 a_Color;\r\nuniform vec2 u_radius;\r\nuniform float u_coverage: 0.9;\r\nuniform float u_angle: 0;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat4 u_Mvp;\r\nvarying vec4 v_color;\r\n\r\nuniform vec2 u_SceneCenterMKT;\r\n\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\n\r\nvoid main() {\r\n  v_color = a_Color;\r\n\r\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\n  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n  // gl_Position = project_common_position_to_clipspace(project_pos);\r\n\r\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // 将经纬度转换为高德2.0需要的平面坐标\r\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\n    gl_Position = u_Mvp * (project_pos);\r\n  } else {\r\n     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n    gl_Position = project_common_position_to_clipspace(project_pos);\r\n  }\r\n\r\n  setPickingColor(a_PickingColor);\r\n}\r\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Ng,depth:{enable:!1},primitive:qi.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:mu.Attribute,descriptor:{name:"a_Pos",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e){var n="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[n[0],n[1],0]}}})}}]),i}(Jd);var Hg,Xg=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig();return{u_opacity:t.opacity||1,u_coverage:t.coverage||1,u_angle:t.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:'precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\n\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_SceneCenterMKT;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n  // vec2 lnglat = (a_Pos.xy + offset); \n  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n  // gl_Position = project_common_position_to_clipspace(project_pos);\n  // float lightWeight = calc_lighting(project_pos);\n  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // vec2 lnglat = (a_Pos.xy + offset); \n    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n\n    // float lightWeight = calc_lighting(project_pos);\n    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n  \n    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 经纬度\n    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // 将经纬度转换为高德2.0需要的平面坐标\n    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\n\n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n  \n    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n  } else {\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n    \n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n    \n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Mg,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mu.Attribute,descriptor:{name:"a_Normal",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:mu.Attribute,descriptor:{name:"a_Pos",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e){var n="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[n[0],n[1],0]}}})}}]),i}(Jd);function Yg(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function qg(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Yg(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Yg(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Kg=(0,Zr.b2)()(Hg=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"texture",void 0),(0,m.Z)((0,H.Z)(t),"colorTexture",void 0),(0,m.Z)((0,H.Z)(t),"heatmapFramerBuffer",void 0),(0,m.Z)((0,H.Z)(t),"intensityModel",void 0),(0,m.Z)((0,H.Z)(t),"colorModel",void 0),(0,m.Z)((0,H.Z)(t),"shapeType",void 0),t}return(0,F.Z)(i,[{key:"render",value:function(){var t=this,e=this.rendererService,n=e.clear;(0,e.useFramebuffer)(this.heatmapFramerBuffer,(function(){n({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.heatmapFramerBuffer}),t.drawIntensityMode()})),this.layer.styleNeedUpdate&&this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var t,e=this.rendererService,n=e.createFramebuffer,r=(e.clear,e.getViewportSize),i=e.createTexture2D,o=(e.useFramebuffer,this.styleAttributeService.getLayerStyleAttribute("shape")),a=(null==o||null===(t=o.scale)||void 0===t?void 0:t.field)||"heatmap";this.shapeType=a,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel="heatmap"===a?this.buildHeatmapColor():this.build3dHeatMap();var s=r(),u=s.width,l=s.height;return this.heatmapFramerBuffer=n({color:i({width:Math.floor(u/4),height:Math.floor(l/4),wrapS:qi.CLAMP_TO_EDGE,wrapT:qi.CLAMP_TO_EDGE,min:qi.LINEAR,mag:qi.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:mu.Attribute,descriptor:{name:"a_Dir",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size;return[void 0===i?1:i]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#define GAUSS_COEF  0.3989422804014327\n\n#pragma include "projection"\n\nvoid main(){\n    v_weight = a_Size;\n    float ZERO = 1.0 / 255.0 / 16.0;\n    float extrude_x = a_Dir.x * 2.0 -1.0;\n    float extrude_y = a_Dir.y * 2.0 -1.0;\n    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\n    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\n    v_extrude = extrude_dir * S;\n\n    vec2 offset = project_pixel(v_extrude * u_radius);\n    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n    } else {\n        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n    }\n}\n',fragmentShader:"precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);\n    gl_FragColor = vec4(val, 1., 1., 1.);\n}\n",triangulation:Fg,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:qi.ONE,srcAlpha:1,dstRGB:qi.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:"precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\nvoid main() {\n  v_texCoord = a_Uv;\n  v_intensity = texture2D(u_texture, v_texCoord).r;\n  gl_Position = vec4(a_Position.xy, 0, 1.);\n}\n",fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\n\nvoid main(){\n     float intensity = texture2D(u_texture, v_texCoord).r;\n    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\n    gl_FragColor =color;\n    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n\n}\n"});var t=this.shaderModuleService.getModule("heatmapColor"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService,o=i.createAttribute,a=i.createElements,s=i.createBuffer;return(0,i.createModel)({vs:e,fs:n,attributes:{a_Position:o({buffer:s({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:qi.FLOAT}),size:3}),a_Uv:o({buffer:s({data:[0,1,1,1,0,0,1,0],type:qi.FLOAT}),size:2})},uniforms:qg({},r),depth:{enable:!1},blend:this.getBlend(),count:6,elements:a({data:[0,2,1,2,3,1],type:qi.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.intensity,r=void 0===n?10:n,i=t.radius,o=void 0===i?5:i;this.intensityModel.draw({uniforms:{u_opacity:e||1,u_radius:o,u_intensity:r}})}},{key:"drawColorMode",value:function(){var t=this.layer.getLayerConfig().opacity;this.colorModel.draw({uniforms:{u_opacity:t||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var t=this.layer.getLayerConfig().opacity,e=li.create();li.invert(e,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:t||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,y.Z)(e)}})}},{key:"build3dHeatMap",value:function(){var t=(0,this.rendererService.getViewportSize)(),e=function(t,e){for(var n=[],r=[],i=[],o=t+1,a=e+1,s=t/2,u=e/2,l=0;l<a;l++)for(var c=l-u,h=0;h<o;h++){var f=h-s;r.push(f/s,-c/u,0),i.push(h/t),i.push(1-l/e)}for(var p=0;p<e;p++)for(var d=0;d<t;d++){var g=d+o*p,v=d+o*(p+1),m=d+1+o*(p+1),y=d+1+o*p;n.push(g,v,y),n.push(v,m,y)}return{vertices:r,indices:n,uvs:i}}(t.width/4,t.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\n\n\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n    float t2 = t * t;\n    float one_minus_t = 1.0 - t;\n    float one_minus_t2 = one_minus_t * one_minus_t;\n    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\n    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\n  v_texCoord = a_Uv;\n\n  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）\n\n  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点\n\tvec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点\n\n\tvec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）\n\tvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\n\n  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）\n\tinverseP2 = inverseP2 / inverseP2.w;\n\n\tfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??\n\tvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\n\n  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\n  float fh;\n\n  v_intensity = texture2D(u_texture, v_texCoord).r;\n  fh = toBezier(v_intensity, b).y;\n  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n \n}\n',fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\n\nvoid main(){\n   \n     float intensity = texture2D(u_texture, v_texCoord).r;\n    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\n    gl_FragColor = color;\n    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;\n     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n"});var n=this.shaderModuleService.getModule("heatmap3dColor"),r=n.vs,i=n.fs,o=n.uniforms,a=this.rendererService,s=a.createAttribute,u=a.createElements,l=a.createBuffer;return(0,a.createModel)({vs:r,fs:i,attributes:{a_Position:s({buffer:l({data:e.vertices,type:qi.FLOAT}),size:3}),a_Uv:s({buffer:l({data:e.uvs,type:qi.FLOAT}),size:2})},primitive:qi.TRIANGLES,uniforms:qg({},o),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:qi.SRC_ALPHA,srcAlpha:1,dstRGB:qi.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:u({data:e.indices,type:qi.UNSIGNED_INT,count:e.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var e=bn(this.layer.getLayerConfig().rampColors);this.colorTexture=t({data:new Uint8Array(e.data),width:e.width,height:e.height,wrapS:qi.CLAMP_TO_EDGE,wrapT:qi.CLAMP_TO_EDGE,min:qi.NEAREST,mag:qi.NEAREST,flipY:!1})}}]),i}(Jd))||Hg;var Qg=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig();return{u_opacity:t.opacity||1,u_coverage:t.coverage||.9,u_angle:t.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:'precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_SceneCenterMKT;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n    \n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n \n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));\n    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));\n    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\n    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Ng,depth:{enable:!1},primitive:qi.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:mu.Attribute,descriptor:{name:"a_Pos",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e){var n="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[n[0],n[1],0]}}})}}]),i}(Jd);const Jg={heatmap:Kg,heatmap3d:Kg,grid:Wg,grid3d:Xg,hexagon:Qg};var $g=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"type","HeatMapLayer"),t}return(0,F.Z)(i,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new Jg[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var t=this;return"heatmap"===this.getModelType()?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach((function(e){return e.draw({uniforms:t.layerModel.getUninforms()})})),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}}]),i}(Yd);const tv={image:function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"texture",void 0),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture}}},{key:"initModels",value:function(){var t=this,e=this.layer.getSource(),n=this.rendererService.createTexture2D;if(this.texture=n({height:0,width:0}),ve){var r=this.layerService.sceneService.getSceneConfig().canvas.createImage();r.crossOrigin="anonymous",r.src=e.data.originData,r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()}}else e.data.images.then((function(e){t.texture=n({data:e[0],width:e[0].width,height:e[0].height}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()}));return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:Bg,primitive:qi.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_Uv",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}}]),i}(Jd)};var ev=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"type","ImageLayer"),t}return(0,F.Z)(i,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new tv[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{image:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"image"}}]),i}(Yd),nv=n(6086),rv=180/Math.PI,iv=/\{([zxy])\}/g,ov=function(){function t(e,n,r,i){(0,z.Z)(this,t),(0,m.Z)(this,"tile",void 0),(0,m.Z)(this,"name",void 0),(0,m.Z)(this,"imageLayer",void 0),this.name=e,this.tile=e.split("_").map((function(t){return Number(t)}));var o={x:this.tile[0],y:this.tile[1],z:this.tile[2]},a=this.getTileURL(o,n),s=this.tileLnglatBounds(this.tile),u=s.getWest(),l=s.getSouth(),c=s.getEast(),h=s.getNorth(),f=new ev({zIndex:-999});f.source(a,{parser:{type:"image",extent:[u,l,c,h]}}),f.setContainer(r,i),f.init(),this.imageLayer=f}return(0,F.Z)(t,[{key:"destroy",value:function(){this.imageLayer.clearModels(),this.imageLayer.destroy()}},{key:"getTileURL",value:function(t,e){return t.s||(t.s=String.fromCharCode(97+Math.floor(3*Math.random()))),iv.lastIndex=0,e.replace(iv,(function(e,n){return t[n]}))}},{key:"tileLnglatBounds",value:function(t){var e=this.tile2lng(t[0]+1,t[2]),n=this.tile2lng(t[0],t[2]),r=this.tile2lat(t[1]+1,t[2]),i=this.tile2lat(t[1],t[2]);return(0,nv.Dv)([n,i],[e,r])}},{key:"tile2lng",value:function(t,e){return t/Math.pow(2,e)*360-180}},{key:"tile2lat",value:function(t,e){var n=Math.PI-2*Math.PI*t/Math.pow(2,e);return rv*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}}]),t}(),av=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return""};(0,z.Z)(this,t),(0,m.Z)(this,"limit",void 0),(0,m.Z)(this,"order",void 0),(0,m.Z)(this,"cache",void 0),(0,m.Z)(this,"destroy",void 0),this.limit=e,this.destroy=n,this.order=[],this.clear()}return(0,F.Z)(t,[{key:"clear",value:function(){var t=this;this.order.forEach((function(e){t.delete(e)})),this.cache={},this.order=[]}},{key:"get",value:function(t){var e=this.cache[t];return e&&(this.deleteOrder(t),this.appendOrder(t)),e}},{key:"set",value:function(t,e){this.cache[t]?(this.delete(t),this.cache[t]=e,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=e,this.appendOrder(t))}},{key:"delete",value:function(t){var e=this.cache[t];e&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(e,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var e=this.order.findIndex((function(e){return e===t}));e>=0&&this.order.splice(e,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}}]),t}(),sv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;(0,z.Z)(this,t),(0,m.Z)(this,"cache",void 0),this.cache=new av(e,n)}return(0,F.Z)(t,[{key:"getTile",value:function(t){return this.cache.get(t)}},{key:"setTile",value:function(t,e){this.cache.set(e,t)}},{key:"destory",value:function(){this.cache.clear()}},{key:"setNeedUpdate",value:function(){var t=this;this.cache.order.forEach((function(e){t.cache.get(e).needUpdate=!0}))}}]),t}(),uv=function(){function t(e){(0,z.Z)(this,t),(0,m.Z)(this,"tileList",{}),(0,m.Z)(this,"tileCache",void 0),(0,m.Z)(this,"updateTileList",void 0),(0,m.Z)(this,"tileZoom",void 0),(0,m.Z)(this,"noPruneRange",void 0),(0,m.Z)(this,"url",void 0),(0,m.Z)(this,"resolution",void 0),(0,m.Z)(this,"maxSourceZoom",void 0),(0,m.Z)(this,"crstype",void 0),(0,m.Z)(this,"currentCrs",void 0),(0,m.Z)(this,"layerService",void 0),(0,m.Z)(this,"layer",void 0),this.layerService=e.layerService,this.layer=e.layer,this.url=e.url,this.resolution="low"===e.resolution?-1:0,this.maxSourceZoom=e.maxSourceZoom,this.crstype=e.crstype,this.currentCrs=new nv.fG.default({start:{x:0,y:0},end:{x:0,y:0},projection:this.crstype}).crs,this.destroyTile=this.destroyTile.bind(this),this.tileCache=new sv(30,this.destroyTile),this.updateTileList=[],this.removeTiles=this.removeTiles.bind(this)}return(0,F.Z)(t,[{key:"calCurrentTiles",value:function(t){var e=this,n=t.NE,r=t.SW,i=t.tileCenter,o=t.currentZoom,a=t.minSourceZoom,s=t.minZoom,u=t.maxZoom;if(!(o>=this.maxSourceZoom)){var l=Math.floor(o)+this.resolution;if(this.tileZoom=l>this.maxSourceZoom?this.maxSourceZoom:l,o<s||o>=u||o<a)this.removeTiles();else{this.updateTileList=[];var c=this.currentCrs.lngLatToPoint((0,nv.WN)(i.lng,i.lat),this.tileZoom).divideBy(256).floor(),h=this.getPixelBounds(n,r,i,this.tileZoom,this.currentCrs),f=this.pxBoundsToTileRange(h);if(this.noPruneRange=new nv.YZ(f.getBottomLeft().subtract([4,-4]),f.getTopRight().add([4,-4])),!(isFinite(f.min.x)&&isFinite(f.min.y)&&isFinite(f.max.x)&&isFinite(f.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var p=f.min.y;p<=f.max.y;p++)for(var d=f.min.x;d<=f.max.x;d++){var g=[d,p,this.tileZoom],v=this.tileList[g.join("_")];v?v.current=!0:(this.tileList[g.join("_")]={current:!0,coords:g},this.updateTileList.push(g))}this.updateTileList.sort((function(t,e){var n=t,r=e;return Math.pow(1*n[0]-c.x,2)+Math.pow(1*n[1]-c.y,2)-(Math.pow(1*r[0]-c.x,2)+Math.pow(1*r[1]-c.y,2))})),this.pruneTiles(),this.updateTileList.forEach((function(t){var n=t.join("_");e.tileList[n].current&&e.requestTile(n)}))}}}},{key:"pxBoundsToTileRange",value:function(t){return new nv.YZ(t.min.divideBy(256).floor(),t.max.divideBy(256).ceil().subtract([1,1]))}},{key:"getPixelBounds",value:function(t,e,n,r,i){var o,a,s=r,u=i.lngLatToPoint((0,nv.WN)(t.lng,t.lat),s),l=i.lngLatToPoint((0,nv.WN)(e.lng,e.lat),s),c=i.lngLatToPoint((0,nv.WN)(n.lng,n.lat),s),h=c.y-u.y,f=l.y-c.y;if(n.lng-t.lng>0||n.lng-e.lng<0){var p=256*Math.pow(2,s)/360*(180-t.lng)+256*Math.pow(2,s)/360*(e.lng+180);n.lng-t.lng>0?a=p-(o=256*Math.pow(2,s)/360*(n.lng-t.lng)):o=p-(a=256*Math.pow(2,s)/360*(e.lng-n.lng))}else o=256*Math.pow(2,s)/360*(n.lng-e.lng),a=256*Math.pow(2,s)/360*(t.lng-n.lng);return new nv.YZ(c.subtract(o,h),c.add(a,f))}},{key:"pruneTiles",value:function(){var t=this;Object.keys(this.tileList).map((function(e){var n=t.tileList[e].coords;n[2]===t.tileZoom&&t.noPruneRange.contains(new nv.E9(n[0],n[1]))||(t.tileList[e].current=!1)})),Object.keys(this.tileList).map((function(e){var n=t.tileList[e];n.retain=n.current})),Object.keys(this.tileList).map((function(e){var n=t.tileList[e];if(n.current&&!n.active){var r=e.split("_").map((function(t){return Number(t)})),i=(0,R.Z)(r,3),o=i[0],a=i[1],s=i[2];t.retainParent(o,a,s,s-5)||t.retainChildren(o,a,s,s+2)}})),this.removeOutTiles()}},{key:"requestTile",value:function(t){var e=this.tileList[t];if(e){var n=this.tileCache.getTile(t);if(n)n.imageLayer.show(),e.current=!0,e.retain=!0,e.active=!0,this.pruneTiles();else{var r=lu(this.layer.sceneContainer);(n=new ov(t,this.url,r,this.layer.sceneContainer)).name=t,e.current=!0,e.retain=!0,e.active=!0,this.layer.layerChildren.push(n.imageLayer),this.tileCache.setTile(n,t),this.pruneTiles(),this.layerService.updateLayerRenderList(),this.layerService.renderLayers()}}}},{key:"retainParent",value:function(t,e,n,r){var i=Math.floor(t/2),o=Math.floor(e/2),a=n-1,s=this.tileList[[i,o,a].join("_")];return s&&s.active?(s.retain=!0,!0):(s&&s.loaded&&(s.retain=!0),a>r&&this.retainParent(i,o,a,r))}},{key:"retainChildren",value:function(t,e,n,r){for(var i=2*t;i<2*t+2;i++)for(var o=2*e;o<2*e+2;o++){var a=[i,o,n+1].join("_"),s=this.tileList[a];s&&s.active?s.retain=!0:(s&&s.loaded&&(s.retain=!0),n+1<r&&this.retainChildren(i,o,n+1,r))}}},{key:"destroyTile",value:function(t){var e=this.layer.layerChildren.indexOf(t.imageLayer);e>-1&&this.layer.layerChildren.splice(e,1),t.imageLayer.destroy(),this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),t=null}},{key:"removeOutTiles",value:function(){for(var t in this.tileList)if(!this.tileList[t].retain){var e=this.tileCache.getTile(t);e&&e.imageLayer.hide(),delete this.tileList[t]}}},{key:"removeTiles",value:function(){this.layer.layerChildren.forEach((function(t){t.destroy()})),this.layer.layerChildren=[],this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.tileList={},this.tileCache.destory()}}]),t}();const lv={imageTile:function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"tileLayer",void 0),(0,m.Z)((0,H.Z)(t),"timestamp",void 0),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){return{}}},{key:"tile",value:function(){var t=this.mapService.getBounds(),e=(0,R.Z)(t,2),n=e[0],r=e[1],i={lng:r[0],lat:r[1]},o={lng:n[0],lat:n[1]};this.tileLayer.calCurrentTiles({NE:i,SW:o,tileCenter:this.mapService.getCenter(),currentZoom:this.mapService.getZoom(),minSourceZoom:this.mapService.getMinZoom(),minZoom:this.mapService.getMinZoom(),maxZoom:this.mapService.getMaxZoom()})}},{key:"initModels",value:function(){var t=this;this.layer.zIndex=-999;var e=this.layer.getLayerConfig(),n=e.resolution,r=void 0===n?"low":n,i=e.maxSourceZoom,o=void 0===i?17:i,a=this.layer.getSource();return a.data.tileurl&&(this.tileLayer=new uv({url:a.data.tileurl,layerService:this.layerService,layer:this.layer,resolution:r,maxSourceZoom:o,crstype:"epsg3857"}),this.tile(),this.mapService.on("mapchange",(function(e){t.timestamp&&(clearTimeout(t.timestamp),t.timestamp=null),t.timestamp=setTimeout((function(){t.mapService.getZoom()>=2&&t.tile()}),500)}))),[this.layer.buildLayerModel({moduleName:"ImageTileLayer",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\n#pragma include "projection"\nvoid main() {\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nvoid main() {\n  gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n",triangulation:Bg,primitive:qi.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){this.tileLayer.removeTiles()}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){}}]),i}(Jd)};var cv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"type","ImageTileLayer"),t}return(0,F.Z)(i,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new lv[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{imageTile:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"imageTile"}}]),i}(Yd);var hv={solid:0,dash:1},fv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"texture",void 0),(0,m.Z)((0,H.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:qi.NEAREST,min:qi.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.sourceColor,r=t.targetColor,i=t.textureBlend,o=void 0===i?"normal":i,a=t.lineType,s=void 0===a?"solid":a,u=t.dashArray,l=void 0===u?[10,5]:u,c=t.forward,h=void 0===c||c,f=t.lineTexture,p=void 0!==f&&f,d=t.iconStep,g=void 0===d?100:d,v=t.segmentNumber,m=void 0===v?30:v,y=t.thetaOffset,_=void 0===y?.314:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:e,thetaOffset:_})){this.judgeStyleAttributes({opacity:e,thetaOffset:_});var b=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,b,this.cellProperties),w=x.data,E=x.width,S=x.height;this.rowCount=S,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:qi.LUMINANCE,type:qi.FLOAT,width:E,height:S}):this.createTexture2D({flipY:!0,data:[1],format:qi.LUMINANCE,type:qi.FLOAT,width:1,height:1})}2===l.length&&l.push(0,0);var C=0,A=[0,0,0,0],T=[0,0,0,0];return n&&r&&(A=mn(n),T=mn(r),C=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Md()(_)?_:0,u_opacity:Md()(e)?e:1,u_textureBlend:"normal"===o?0:1,segmentNumber:m,u_line_type:hv[s||"solid"],u_dash_array:l,u_blur:.9,u_lineDir:h?1:-1,u_texture:this.texture,u_line_texture:p?1:0,u_icon_step:g,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:C,u_sourceColor:A,u_targetColor:T}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig().segmentNumber,e=void 0===t?30:t;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n// varying vec2 v_normal;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_lineDir: 1.0;\nvarying vec4 v_dash_array;\n\nuniform float u_thetaOffset: 0.314;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalThetaOffset"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][1] = thetaOffsetAndOffset.r;\n  textureOffset = thetaOffsetAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  \n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  if(u_line_type == LineTypeDash) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n\n      vec2 s = source;\n      vec2 t = target;\n      \n      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n        s = unProjCustomCoord(source);\n        t = unProjCustomCoord(target);\n      }\n      float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n  \n  if(u_aimate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n      if(u_lineDir != 1.0) {\n        d_distance_ratio = 1.0 - d_distance_ratio;\n      }\n  }\n\n   styleMappingMat[3].b = d_distance_ratio;\n\n  // styleMappingMat[0][1] - arcThetaOffset\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n  styleMappingMat[3].r = d_segmentIndex;\n\n  if(LineTexture == u_line_texture) { // 开启贴图模式\n\n    float arcDistrance = length(source - target); // 起始点和终点的距离\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      arcDistrance *= 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      // arcDistrance *= 8.0;\n      arcDistrance = project_pixel_allmap(arcDistrance);\n    }\n    v_iconMapUV = a_iconMapUV;\n\n    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变\n    float texCount = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n     styleMappingMat[3].g = texCount;\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size); // 定点位置偏移\n     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_segmentIndex = styleMappingMat[3].r;   // 当前顶点在弧线中所处的分段位置\n  float d_distance_ratio = styleMappingMat[3].b; // 当前顶点在弧线中所处的分段比例\n\n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n  \n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n   float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_aimate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_aimate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\n      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 当存在贴图时在底色上贴上贴图\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));\n    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);\n\n    float count = styleMappingMat[3].g; // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_aimate.x == Animate) {\n      time = u_time / u_aimate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n    float v = styleMappingMat[3].a; // 横向 v\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_aimate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_aimate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n    \n  } else {\n     gl_FragColor = filterColor(gl_FragColor);\n  }\n  // gl_FragColor = filterColor(gl_FragColor);\n}',triangulation:zg,depth:{enable:!1},blend:this.getBlend(),segmentNumber:e})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:mu.Attribute,descriptor:{name:"a_Instance",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:4,update:function(t,e,n,r){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}}]),i}(Jd);var pv={solid:0,dash:1},dv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"texture",void 0),(0,m.Z)((0,H.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:qi.NEAREST,min:qi.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.sourceColor,r=t.targetColor,i=t.textureBlend,o=void 0===i?"normal":i,a=t.lineType,s=void 0===a?"solid":a,u=t.dashArray,l=void 0===u?[10,5]:u,c=t.lineTexture,h=void 0!==c&&c,f=t.iconStep,p=void 0===f?100:f,d=t.segmentNumber,g=void 0===d?30:d,v=t.globalArcHeight,m=void 0===v?10:v;2===l.length&&l.push(0,0);var y=0,_=[0,0,0,0],b=[0,0,0,0];if(n&&r&&(_=mn(n),b=mn(r),y=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:e})){this.judgeStyleAttributes({opacity:e});var x=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,x,this.cellProperties),E=w.data,S=w.width,C=w.height;this.rowCount=C,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:qi.LUMINANCE,type:qi.FLOAT,width:S,height:C}):this.createTexture2D({flipY:!0,data:[1],format:qi.LUMINANCE,type:qi.FLOAT,width:1,height:1})}return{u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:100,u_global_height:m,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Md()(e)?e:1,u_textureBlend:"normal"===o?0:1,segmentNumber:g,u_line_type:pv[s]||0,u_dash_array:l,u_texture:this.texture,u_line_texture:h?1:0,u_icon_step:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:y,u_sourceColor:_,u_targetColor:b}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig().segmentNumber,e=void 0===t?30:t;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n// varying vec2 v_normal;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // TODO: + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // TODO: 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_aimate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  styleMappingMat[3].g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nvarying mat4 styleMappingMat;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = styleMappingMat[3].g; // 当前点位距离占线总长的比例\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n   float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_aimate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_aimate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\n\n      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_aimate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = styleMappingMat[3].b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_aimate.x == Animate) {\n      time = u_time / u_aimate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = styleMappingMat[3].a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_aimate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_aimate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',triangulation:zg,blend:this.getBlend(),segmentNumber:e})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:mu.Attribute,descriptor:{name:"a_Instance",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:4,update:function(t,e,n,r){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}}]),i}(Jd);var gv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.sourceColor,r=t.targetColor,i=t.forward,o=void 0===i||i,a=t.segmentNumber,s=void 0===a?30:a,u=t.thetaOffset,l=void 0===u?.314:u,c=0,h=[0,0,0,0],f=[0,0,0,0];return n&&r&&(h=mn(n),f=mn(r),c=1),{u_thetaOffset:l,u_opacity:Md()(e)?e:1,segmentNumber:s,u_blur:.9,u_lineDir:o?1:-1,u_linearColor:c,u_sourceColor:h,u_targetColor:f}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig().segmentNumber,e=void 0===t?30:t;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n// varying vec2 v_normal;\n\nuniform float u_lineDir: 1.0;\n\n// 偏移量\nuniform float u_thetaOffset: 0.314;\n\nuniform float u_opacity: 1.0;\nvarying float v_distance_ratio;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = u_thetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n  \n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  v_distance_ratio = segmentIndex / segmentNumber;\n  \n  if(u_aimate.x == Animate && u_lineDir != 1.0) {\n      v_distance_ratio = 1.0 - v_distance_ratio;\n  }\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n}\n',fragmentShader:'#define LineTypeSolid 0.0\n#define Animate 0.0\n\nuniform float u_opacity;\nuniform float u_blur : 0.9;\n// varying vec2 v_normal;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n\nuniform float segmentNumber;\nvarying float v_distance_ratio;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n#pragma include "picking"\n\nvoid main() {\n\n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n  \n \n  gl_FragColor.a *= u_opacity;\n\n  if(u_aimate.x == Animate) {\n      float animateSpeed = u_time / u_aimate.y; // 运动速度\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\n      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n  }\n}',triangulation:zg,depth:{enable:!1},blend:this.getBlend(),segmentNumber:e})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:mu.Attribute,descriptor:{name:"a_Instance",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:4,update:function(t,e,n,r){return[n[3],n[4],n[5],n[6]]}}})}}]),i}(Jd);var vv={solid:0,dash:1},mv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"texture",void 0),(0,m.Z)((0,H.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:qi.NEAREST,min:qi.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.sourceColor,r=t.targetColor,i=t.textureBlend,o=void 0===i?"normal":i,a=t.lineType,s=void 0===a?"solid":a,u=t.dashArray,l=void 0===u?[10,5]:u,c=t.lineTexture,h=void 0!==c&&c,f=t.iconStep,p=void 0===f?100:f,d=t.segmentNumber,g=void 0===d?30:d;2===l.length&&l.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var v=0,m=[0,0,0,0],y=[0,0,0,0];if(n&&r&&(m=mn(n),y=mn(r),v=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:e})){this.judgeStyleAttributes({opacity:e});var _=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,_,this.cellProperties),x=b.data,w=b.width,E=b.height;this.rowCount=E,this.dataTexture=this.cellLength>0&&x.length>0?this.createTexture2D({flipY:!0,data:x,format:qi.LUMINANCE,type:qi.FLOAT,width:w,height:E}):this.createTexture2D({flipY:!0,data:[1],format:qi.LUMINANCE,type:qi.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Md()(e)?e:1,u_textureBlend:"normal"===o?0:1,segmentNumber:g,u_line_type:vv[s]||0,u_dash_array:l,u_texture:this.texture,u_line_texture:h?1:0,u_icon_step:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:m,u_targetColor:y}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n// varying vec2 v_normal;\n\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n    vec2 x = mix(source, target, ratio);\n    vec2 center = mix(source, target, 0.5);\n    float dSourceCenter = distance(source, center);\n    float dXCenter = distance(x, center);\n    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n     float vertex_height = paraboloid(source, target, segmentRatio);\n\n    return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n    );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = 0.314;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  return mid;\n}\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    vec2 mid = midPoint(source, target);\n    vec3 x = vec3(source.x, mid.x, target.x);\n    vec3 y = vec3(source.y, mid.y, target.y);\n    return vec2(bezier3(x ,t), bezier3(y,t));\n  }else {\n    if(abs(angularDist - PI) < 0.001) {\n      return (1.0 - t) * source + t * target;\n    }\n    float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n    float b = sin(t * angularDist) / sin(angularDist);\n    vec2 sin_source = sin(source);\n    vec2 cos_source = cos(source);\n    vec2 sin_target = sin(target);\n    vec2 cos_target = cos(target);\n    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n    float z = a * sin_source.y + b * sin_target.y;\n    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n  }\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // dataset 数据集\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = radians(a_Instance.rg);\n  vec2 target = radians(a_Instance.ba);\n  float angularDist = getAngularDist(source, target);\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  if(u_line_type == LineTypeDash) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    total_Distance = total_Distance*8.0;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n  if(u_aimate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  v_distance_ratio = segmentIndex / segmentNumber;\n  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\n  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n\n  styleMappingMat[3].g = a_Position.x; // 该顶点在弧线上的分段排序\n  if(LineTexture == u_line_texture) { // 开启贴图模式  \n    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;\n    float d_arcDistrance = length(source - target);\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      d_arcDistrance = d_arcDistrance * 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      d_arcDistrance = project_pixel_allmap(d_arcDistrance);\n    }\n    float d_pixelLen = project_pixel(u_icon_step)/8.0;\n    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // 贴图在弧线上重复的数量\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nvarying mat4 styleMappingMat;\n\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0;\n  float d_segmentIndex = styleMappingMat[3].g;\n  \n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n   float flag = 0.;\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  // 设置弧线的动画模式\n  if(u_aimate.x == Animate) {\n      animateSpeed = u_time / u_aimate.y;\n      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\n      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 设置弧线的贴图\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\n    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);\n    float count = styleMappingMat[3].b; // 贴图在弧线上重复的数量\n    float u = fract(arcRadio * count - animateSpeed * count);\n    // float u = fract(arcRadio * count - animateSpeed);\n    if(u_aimate.x == Animate) {\n      u = gl_FragColor.a/opacity;\n    }\n\n    float v = styleMappingMat[3].a; // 线图层贴图部分的 v 坐标值\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n    \n    // 设置贴图和底色的叠加模式\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  // gl_FragColor = filterColor(gl_FragColor);\n}',triangulation:zg,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:mu.Attribute,descriptor:{name:"a_Instance",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:4,update:function(t,e,n,r){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}}]),i}(Jd);var yv={solid:0,dash:1},_v=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"texture",void 0),(0,m.Z)((0,H.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:qi.NEAREST,min:qi.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.sourceColor,r=t.targetColor,i=t.textureBlend,o=void 0===i?"normal":i,a=t.lineType,s=void 0===a?"solid":a,u=t.dashArray,l=void 0===u?[10,5,0,0]:u,c=t.lineTexture,h=void 0!==c&&c,f=t.iconStep,p=void 0===f?100:f,d=t.vertexHeightScale,g=void 0===d?20:d,v=t.borderWidth,m=void 0===v?0:v,y=t.borderColor,_=void 0===y?"#ccc":y;2===l.length&&l.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var b=0,x=[0,0,0,0],w=[0,0,0,0];if(n&&r&&(x=mn(n),w=mn(r),b=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:e})){this.judgeStyleAttributes({opacity:e});var E=this.layer.getEncodedData(),S=this.calDataFrame(this.cellLength,E,this.cellProperties),C=S.data,A=S.width,T=S.height;this.rowCount=T,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:qi.LUMINANCE,type:qi.FLOAT,width:A,height:T}):this.createTexture2D({flipY:!0,data:[1],format:qi.LUMINANCE,type:qi.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Md()(e)?e:1,u_textureBlend:"normal"===o?0:1,u_line_type:yv[s],u_dash_array:l,u_texture:this.texture,u_line_texture:h?1:0,u_icon_step:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:m,u_borderColor:mn(_),u_linearColor:b,u_sourceColor:x,u_targetColor:w,u_vertexScale:g}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\n\nuniform float u_vertexScale: 1.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\n\n\nuniform float u_linearColor: 0;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  float d_distance_ratio; // 当前点位距离占线总长的比例\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  d_texPixelLen = project_pixel(u_icon_step);\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  if(u_line_type == LineTypeDash) {\n    d_distance_ratio = a_Distance / a_Total_Distance;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n  }\n  if(u_aimate.x == Animate || u_linearColor == 1.0) {\n      d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n  v_color = a_Color;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n\n  vec2 offset = project_pixel(size.xy);\n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n\n  // 设置数据集的参数\n  styleMappingMat[3][0] = d_distance_ratio; // 当前点位距离占线总长的比例\n  styleMappingMat[3][1] = a_Distance;       // 当前顶点的距离\n  styleMappingMat[3][2] = d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  styleMappingMat[3][3] = texV;             // 线图层贴图部分的 v 坐标值\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float((a_Position.z)) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0 + h, 1.0)); // 额外除 8.0 是为了和gaode1.x的高度兼容\n  } else {\n    float lineHeight = a_Size.y;\n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);\n    }\n    \n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_blur : 0.99;\nuniform float u_line_type: 0.0;\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\n\nuniform float u_borderWidth: 0.0;\nuniform vec4 u_borderColor;\nvarying vec4 v_color;\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\n// dash\nuniform float u_dash_offset : 0.0;\nuniform float u_dash_ratio : 0.1;\nvarying vec4 v_dash_array;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // 控制运动\n\nvarying mat4 styleMappingMat;\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  // anti-alias\n  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));\n  gl_FragColor.a *= opacity; // 全局透明度\n  if(u_aimate.x == Animate) {\n      animateSpeed = u_time / u_aimate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);\n      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n // dash line\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    float aDistance = styleMappingMat[3].g;      // 当前顶点的距离\n    float d_texPixelLen = styleMappingMat[3].b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = styleMappingMat[3].a;  // 线图层贴图部分的 v 坐标值\n\n    // v = max(smoothstep(0.95, 1.0, v), v);\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    \n    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));\n    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));\n     vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  } else {\n\n    float v = styleMappingMat[3].a;\n    float borderWidth = min(0.5, u_borderWidth);\n    // 绘制 border\n    if(borderWidth > 0.0) {\n      float borderOuterWidth = borderWidth/2.0;\n\n      if(v >= 1.0 - borderWidth || v <= borderWidth) {\n        if(v > borderWidth) {\n          float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);\n          gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);\n        } else if(v <= borderWidth) {\n          float linear = smoothstep(0.0, 1.0, v/borderWidth);\n          gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);\n        }\n      }\n\n      if(v < borderOuterWidth) {\n        gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);\n      } else if(v > 1.0 - borderOuterWidth) {\n        gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n      }\n    }\n\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  \n  \n  \n}\n',triangulation:Ig,primitive:qi.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.layer.getLayerConfig().lineType,this.styleAttributeService.registerStyleAttribute({name:"distance",type:mu.Attribute,descriptor:{name:"a_Distance",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:mu.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0],o[1]]:[o,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mu.Attribute,descriptor:{name:"a_Normal",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:mu.Attribute,descriptor:{name:"a_Miter",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}},{key:"loadImage",value:function(t){return new Promise((function(e,n){if(t instanceof HTMLImageElement)e(t);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e(r)},r.onerror=function(){n(new Error("Could not load image at "+t))},r.src=t instanceof File?URL.createObjectURL(t):t}}))}}]),i}(Jd);var bv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"texture",void 0),(0,m.Z)((0,H.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:qi.NEAREST,min:qi.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.sourceColor,r=t.targetColor,i=t.textureBlend,o=void 0===i?"normal":i,a=t.heightfixed,s=void 0!==a&&a,u=t.lineTexture,l=void 0!==u&&u,c=t.iconStep,h=void 0===c?100:c,f=t.iconStepCount,p=void 0===f?1:f;this.rendererService.getDirty()&&this.texture.bind();var d=0,g=[0,0,0,0],v=[0,0,0,0];if(n&&r&&(g=mn(n),v=mn(r),d=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:e})){this.judgeStyleAttributes({opacity:e});var m=this.layer.getEncodedData(),y=this.calDataFrame(this.cellLength,m,this.cellProperties),_=y.data,b=y.width,x=y.height;this.rowCount=x,this.dataTexture=this.cellLength>0&&_.length>0?this.createTexture2D({flipY:!0,data:_,format:qi.LUMINANCE,type:qi.FLOAT,width:b,height:x}):this.createTexture2D({flipY:!0,data:[1],format:qi.LUMINANCE,type:qi.FLOAT,width:1,height:1})}return{u_heightfixed:Number(s),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Md()(e)?e:1,u_textureBlend:"normal"===o?0:1,u_texture:this.texture,u_line_texture:l?1:0,u_iconStepCount:p,u_icon_step:h,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:d,u_sourceColor:g,u_targetColor:v}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvarying vec4 v_color;\nvarying float v_blur;\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\n\n\nuniform float u_linearColor: 0;\n\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "light"\n#pragma include "styleMappingCalOpacity"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  float d_distance_ratio; // 当前点位距离占线总长的比例\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    d_texPixelLen = project_pixel(u_icon_step);\n  } else {\n    d_texPixelLen = u_icon_step;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  if(u_aimate.x == Animate || u_linearColor == 1.0) {\n      d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n\n  float miter = (a_Miter + 1.0)/2.0;\n  // 设置数据集的参数\n  styleMappingMat[3][0] = d_distance_ratio; // 当前点位距离占线总长的比例\n  styleMappingMat[3][1] = a_Distance;       // 当前顶点的距离\n  styleMappingMat[3][2] = d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  styleMappingMat[3][3] = miter;          // 线图层贴图部分的 v 坐标值 0 - 1\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float originSize = a_Size.x;  // 固定高度\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    originSize = project_pixel(a_Size.x);\n  }\n\n  float wallHeight = originSize * miter;\n  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\n\n  v_blur = min(project_pixel(2.0) / originSize, 0.05);\n\n  // v_lightWeight = lightWeight;\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n  // v_color = a_Color;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define LineTypeSolid 0.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nuniform float u_iconStepCount;\n\nvarying vec4 v_color;\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\n// dash\nuniform float u_dash_offset : 0.0;\nuniform float u_dash_ratio : 0.1;\n\nvarying vec2 v_iconMapUV;\nvarying float v_blur;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // 控制运动\n\nvarying mat4 styleMappingMat;\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = styleMappingMat[3].r; // 当前点位距离占线总长的比例\n  float v = styleMappingMat[3].a;\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, v);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity; // 全局透明度\n  if(u_aimate.x == Animate) {\n      animateSpeed = u_time / u_aimate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);\n      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = styleMappingMat[3].g;      // 当前顶点的距离\n    float d_texPixelLen = styleMappingMat[3].b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = styleMappingMat[3].a;  // 线图层贴图部分的 v 坐标值\n\n    // 计算纹理间隔 start\n    float flag = 0.0;\n    if(u > 1.0/u_iconStepCount) {\n      flag = 1.0;\n    }\n    u = fract(u*u_iconStepCount);\n    // 计算纹理间隔 end\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    // Tip: 判断纹理间隔\n    if(flag > 0.0) {\n      pattern = vec4(0.0);\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  }\n  \n\n  // blur - AA\n  if(v < v_blur) {\n    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);\n  } else if(v > 1.0 - v_blur) {\n    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n\n    \n  \n  \n}\n',triangulation:Ig,primitive:qi.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.layer.getLayerConfig().lineType,this.styleAttributeService.registerStyleAttribute({name:"distance",type:mu.Attribute,descriptor:{name:"a_Distance",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:mu.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0],o[1]]:[o,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mu.Attribute,descriptor:{name:"a_Normal",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:mu.Attribute,descriptor:{name:"a_Miter",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[o.x,o.y]}}})}}]),i}(Jd);const xv={arc:fv,arcmini:gv,arc3d:dv,greatcircle:mv,wall:bv,line:_v};var wv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"type","LineLayer"),t}return(0,F.Z)(i,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new xv[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{line:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}}[this.getModelType()]}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"line"}}]),i}(Yd);var Ev=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"raiseCount",0),(0,m.Z)((0,H.Z)(t),"raiserepeat",0),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=void 0===e?{enable:!1,speed:.01,repeat:!1}:e,r=t.opacity,i=void 0===r?1:r,o=t.sourceColor,a=t.targetColor,s=t.opacityLinear,u=void 0===s?{enable:!1,dir:"up"}:s,l=t.lightEnable,c=void 0===l||l;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:i})){this.judgeStyleAttributes({opacity:i});var h=this.layer.getEncodedData(),f=this.calDataFrame(this.cellLength,h,this.cellProperties),p=f.data,d=f.width,g=f.height;this.rowCount=g,this.dataTexture=this.cellLength>0&&p.length>0?this.createTexture2D({flipY:!0,data:p,format:qi.LUMINANCE,type:qi.FLOAT,width:d,height:g}):this.createTexture2D({flipY:!0,data:[1],format:qi.LUMINANCE,type:qi.FLOAT,width:1,height:1})}var v=0,m=[0,0,0,0],y=[0,0,0,0];if(o&&a&&(m=mn(o),y=mn(a),v=1),this.raiseCount<1&&this.raiserepeat>0&&n.enable){var _=n.speed,b=void 0===_?.01:_;n.repeat,this.raiseCount+=b,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_r:n.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:"GLOBEL"===this.mapService.version?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Md()(i)?i:1,u_linearColor:v,u_sourceColor:m,u_targetColor:y,u_opacitylinear:Number(u.enable),u_opacitylinear_dir:"up"===u.dir?1:0,u_lightEnable:Number(c)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),e=t.depth,n=void 0===e||e,r=t.animateOption.repeat,i=void 0===r?1:r;return this.raiserepeat=i,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_globel;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\nvarying float v_z;\nvarying float v_lightWeight;\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值\n  v_z = a_Position.z;\n\n  vec2 offset = project_pixel(size.xy);\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);\n\n  // 圆柱光照效果\n  float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;\n  v_lightWeight = lightWeight;\n  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  // gl_Position = project_common_position_to_clipspace(pos);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * pos;\n  } else {\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  \n  if(u_globel > 0.0) {\n    // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度\n    //旋转矩阵mx，创建绕x轴旋转矩阵\n    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\n    float xRadian = getXRadian(a_Pos.y, r);\n    float xcos = cos(xRadian);//求解旋转角度余弦值\n    float xsin = sin(xRadian);//求解旋转角度正弦值\n    mat4 mx = mat4(\n      1,0,0,0,  \n      0,xcos,-xsin,0,  \n      0,xsin,xcos,0,  \n      0,0,0,1);\n\n    //旋转矩阵my，创建绕y轴旋转矩阵\n    float yRadian = getYRadian(a_Pos.x, a_Pos.z);\n    float ycos = cos(yRadian);//求解旋转角度余弦值\n    float ysin = sin(yRadian);//求解旋转角度正弦值\n    mat4 my = mat4(\n      ycos,0,-ysin,0,  \n      0,1,0,0,  \n      ysin,0,ycos,0,  \n      0,0,0,1);\n\n    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\n\nvarying float v_z;\nvarying float v_lightWeight;\n\n#pragma include "picking"\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n\n  // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);\n    gl_FragColor.rgb *= v_lightWeight;\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  // 应用透明度\n  gl_FragColor.a *= opacity;\n\n  // 开启透明度渐变\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;\n  }\n\n  // picking\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Mg,blend:this.getBlend(),cull:{enable:!0,face:"MAPBOX"===this.mapService.version?qi.FRONT:qi.BACK},depth:{enable:n}})]}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t="GLOBEL"===this.mapService.version;this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e,n,r){var i=t.size;if(i){var o=[];return Array.isArray(i)&&(o=2===i.length?[i[0],i[0],i[1]]:i),Array.isArray(i)||(o=[i,i,i]),o}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mu.Attribute,descriptor:{name:"a_Normal",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:mu.Attribute,descriptor:{name:"a_Pos",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(e,n){var r=vg(e.coordinates);return t?ng([r[0],r[1]]):[r[0],r[1],0]}}})}}]),i}(Jd);var Sv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"meter2coord",1),(0,m.Z)((0,H.Z)(t),"isMeter",!1),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.strokeOpacity,i=void 0===r?1:r,o=t.strokeWidth,a=void 0===o?0:o,s=t.stroke,u=void 0===s?"rgba(0,0,0,0)":s,l=t.offsets,c=void 0===l?[0,0]:l,h=t.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,strokeOpacity:i,strokeWidth:a,stroke:u,offsets:c})){this.judgeStyleAttributes({opacity:n,strokeOpacity:i,strokeWidth:a,stroke:u,offsets:c});var f=this.layer.getEncodedData(),p=this.calDataFrame(this.cellLength,f,this.cellProperties),d=p.data,g=p.width,v=p.height;this.rowCount=v,this.dataTexture=this.cellLength>0&&d.length>0?this.createTexture2D({flipY:!0,data:d,format:qi.LUMINANCE,type:qi.FLOAT,width:g,height:v}):this.createTexture2D({flipY:!0,data:[1],format:qi.LUMINANCE,type:qi.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_additive:"additive"===h?1:0,u_globel:this.mapService.version===Fl.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Md()(n)?n:1,u_stroke_opacity:Md()(i)?i:1,u_stroke_width:Md()(a)?a:0,u_stroke_color:this.getStrokeColor(u),u_offsets:this.isOffsetStatic(c)?c:[0,0]}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Tg)}},{key:"initModels",value:function(){var t=this.layer.getLayerConfig().unit,e=void 0===t?"l7size":t,n=this.mapService.version;return"meter"===e&&n!==Fl.L7MAP&&n!==Fl.GLOBEL&&n!==Fl.MAPBOX&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var t=(0,R.Z)(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3],o=[(e+r)/2,(n+i)/2],a=this.mapService.meterToCoord(o,[e,n]),s=this.mapService.meterToCoord(o,[r===e?r+.1:r,i===n?n+.1:i]);this.meter2coord=(a+s)/2}},{key:"buildModels",value:function(){var t="GLOBEL"===this.mapService.version;return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\nuniform float u_globel;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_isMeter;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\n\nuniform float u_blur : 0.0;\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  float newSize = setPickingSize(a_Size);\n\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][1] = strokeOpacityAndOffset.r;\n  textureOffset = strokeOpacityAndOffset.g;\n\n  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][2] = strokeWidthAndOffset.r;\n  textureOffset = strokeWidthAndOffset.g;\n\n  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\n  if(hasStroke()) {\n    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R\n    textureOffset += 1.0;\n\n    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G\n    textureOffset += 1.0;\n\n    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B\n    textureOffset += 1.0;\n\n    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A\n    textureOffset += 1.0;\n  } else {\n    if(u_stroke_color == vec4(0.0)) {\n      styleMappingMat[1][0] = v_color.r;\n      styleMappingMat[1][1] = v_color.g;\n      styleMappingMat[1][2] = v_color.b;\n      styleMappingMat[1][3] = v_color.a;\n    } else {\n      styleMappingMat[1][0] = u_stroke_color.r;\n      styleMappingMat[1][1] = u_stroke_color.g;\n      styleMappingMat[1][2] = u_stroke_color.b;\n      styleMappingMat[1][3] = u_stroke_color.a;\n    }\n  }\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // TODO: billboard\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);\n  if(u_isMeter < 1.0) {\n    // 不以米为实际单位\n    offset = project_pixel(offset);\n  } else {\n    // 以米为实际单位\n    antialiasblur *= pow(19.0 - u_Zoom, 2.0);\n  }\n  \n  \n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n  }\n\n  if(u_globel > 0.0) {\n    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:"#define Animate 0.0\n\nuniform float u_globel;\nuniform float u_additive;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n \n  vec4 textrueStroke = vec4(\n    styleMappingMat[1][0],\n    styleMappingMat[1][1],\n    styleMappingMat[1][2],\n    styleMappingMat[1][3]\n  );\n\n  float opacity = styleMappingMat[0][0];\n  float stroke_opacity = styleMappingMat[0][1];\n  float strokeWidth = styleMappingMat[0][2];\n  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + strokeWidth);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  if(u_globel > 0.0) {\n    // TODO: 地球模式下避免多余片元绘制，同时也能避免有用片元在透明且重叠的情况下无法写入\n    // 付出的代价是边缘会有一些锯齿\n    if(outer_df > antialiasblur + 0.018) discard;\n  }\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n  float PI = 3.14159;\n  float N_RINGS = 3.0;\n  float FREQ = 1.0;\n\n  if(strokeWidth < 0.01) {\n    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);\n  } else {\n    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);\n  }\n\n  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);\n\n  if(u_aimate.x == Animate) {\n    float d = length(v_data.xy);\n    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);\n    \n    // TODO: 根据叠加模式选择效果\n    if(u_additive > 0.0) {\n      gl_FragColor *= intensity;\n    } else {\n      gl_FragColor = vec4(gl_FragColor.xyz, intensity);\n    }\n  \n    // TODO: 优化在水波纹情况下的拾取（a == 0 时无法拾取）\n    if(d < 0.7) {\n      gl_FragColor.a = max(gl_FragColor.a, 0.001);\n    }\n\n    if(u_additive > 0.0) {\n      gl_FragColor = filterColorAnimate(gl_FragColor);\n    } else {\n      gl_FragColor = filterColor(gl_FragColor);\n    }\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n    \n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n  } else {\n    gl_FragColor.a *= opacity_t;\n  }\n}\n",triangulation:t?kg:Tg,depth:{enable:t},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this,e="GLOBEL"===this.mapService.version;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:mu.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,n,r,i){var o;if(e){var a=(0,R.Z)(r,3),s=a[0],u=a[1],l=a[2],c=Gl.fromValues(0,0,1),h=Gl.fromValues(s,0,l),f=s>=0?Gl.angle(c,h):2*Math.PI-Gl.angle(c,h),p=2*Math.PI-Math.asin(u/100),d=li.create();li.rotateY(d,d,f),li.rotateX(d,d,p);var g=Gl.fromValues(1,1,0);Gl.transformMat4(g,g,d),Gl.normalize(g,g);var v=Gl.fromValues(-1,1,0);Gl.transformMat4(v,v,d),Gl.normalize(v,v);var m=Gl.fromValues(-1,-1,0);Gl.transformMat4(m,m,d),Gl.normalize(m,m);var _=Gl.fromValues(1,-1,0);Gl.transformMat4(_,_,d),Gl.normalize(_,_),o=[].concat((0,y.Z)(g),(0,y.Z)(v),(0,y.Z)(m),(0,y.Z)(_))}else o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var b=i%4*3;return[o[b],o[b+1],o[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(e,n,r,i){var o=e.size,a=void 0===o?5:o;return Array.isArray(a)?[a[0]*t.meter2coord]:[a*t.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:mu.Attribute,descriptor:{name:"a_Shape",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(e,n,r,i){var o=e.shape,a=void 0===o?2:o;return[t.layer.getLayerConfig().shape2d.indexOf(a)]}}})}}]),i}(Jd);var Cv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"texture",void 0),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var t=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",(function(){t.updateTexture(),t.layer.render()})),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_stroke_width : 1;\nuniform vec2 u_offsets;\n\nuniform float u_opacity : 1;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  styleMappingMat[1][0] = a_Size;\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping - 数据纹理映射部分的计算\n   v_color = a_Color;\n   v_uv = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n  //  vec2 offset = project_pixel(u_offsets);\n  vec2 offset = project_pixel(textrueOffsets);\n\n  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);\n    } else {\n      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));\n    }\n   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n\n  setPickingColor(a_PickingColor);\n\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\n\nvoid main(){\n      float opacity = styleMappingMat[0][0];\n      float size = max(styleMappingMat[1][0] - 2.0, 0.0);\n      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n      vec4 textureColor;\n\n      // Y = 0.299R + 0.587G + 0.114B // 亮度提取\n\n     \n      textureColor = texture2D(u_texture, pos);\n\n      // Tip: 去除边缘部分 mipmap 导致的混合变暗\n      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n      if(fragmengTocenter >= 0.5) {\n            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n            textureColor.a *= luma;\n      }\n      \n      \n\n      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n            gl_FragColor= textureColor;\n      }else {\n            gl_FragColor= step(0.01, textureColor.z) * v_color;\n      }\n\n      gl_FragColor.a = gl_FragColor.a * opacity;\n      gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Pg,primitive:qi.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_Uv",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(e,n,r,i){var o=t.fontService.mapping,a=e.shape,s=o[t.fontService.getGlyph(a)];return[s.x,s.y]}}})}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,e=this.fontService.canvas;this.texture=t({data:e,mag:qi.LINEAR,min:qi.LINEAR,width:e.width,height:e.height})}},{key:"initIconFontGlyphs",value:function(){var t=this,e=this.layer.getLayerConfig(),n=e.fontWeight,r=void 0===n?"normal":n,i=e.fontFamily,o=void 0===i?"sans-serif":i,a=this.layer.getEncodedData(),s=[];a.forEach((function(e){var n=e.shape,r=void 0===n?"":n;r=r.toString();var i=t.fontService.getGlyph(r);-1===s.indexOf(i)&&s.push(i)})),this.fontService.setFontOptions({characterSet:s,fontWeight:r,fontFamily:o,fontSize:48})}}]),i}(Jd);var Av=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"texture",void 0),(0,m.Z)((0,H.Z)(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void t.layer.renderLayers();t.texture=e({data:t.iconService.getCanvas(),mag:qi.LINEAR,min:qi.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})})),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.offsets,r=void 0===n?[0,0]:n;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:e,offsets:r})){this.judgeStyleAttributes({opacity:e,offsets:r});var i=this.layer.getEncodedData(),o=this.calDataFrame(this.cellLength,i,this.cellProperties),a=o.data,s=o.width,u=o.height;this.rowCount=u,this.dataTexture=this.cellLength>0&&a.length>0?this.createTexture2D({flipY:!0,data:a,format:qi.LUMINANCE,type:qi.FLOAT,width:s,height:u}):this.createTexture2D({flipY:!0,data:[1],format:qi.LUMINANCE,type:qi.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Md()(e)?e:1,u_offsets:this.isOffsetStatic(r)?r:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_stroke_width : 1;\nuniform vec2 u_offsets;\n\nuniform float u_opacity : 1;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  styleMappingMat[1][0] = a_Size;\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping - 数据纹理映射部分的计算\n   v_color = a_Color;\n   v_uv = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n  //  vec2 offset = project_pixel(u_offsets);\n  vec2 offset = project_pixel(textrueOffsets);\n\n  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);\n    } else {\n      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));\n    }\n   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n\n  setPickingColor(a_PickingColor);\n\n}\n',fragmentShader:'\nuniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\n\nvoid main(){\n      float opacity = styleMappingMat[0][0];\n      float size = max(styleMappingMat[1][0] - 2.0, 0.0);\n      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n      vec4 textureColor;\n\n      // Y = 0.299R + 0.587G + 0.114B // 亮度提取\n\n     \n      textureColor = texture2D(u_texture, pos);\n\n      // Tip: 去除边缘部分 mipmap 导致的混合变暗\n      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n      if(fragmengTocenter >= 0.5) {\n            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n            textureColor.a *= luma;\n      }\n      \n      \n\n      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n            gl_FragColor= textureColor;\n      }else {\n            gl_FragColor= step(0.01, textureColor.z) * v_color;\n      }\n\n      gl_FragColor.a = gl_FragColor.a * opacity;\n      gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Pg,primitive:qi.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?5:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_Uv",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.shape]||{x:0,y:0};return[o.x,o.y]}}})}}]),i}(Jd);function Tv(t){var e=t.coordinates;return{vertices:(0,y.Z)(e),indices:[0],size:e.length}}var kv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,i=void 0===r?[0,0]:r;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,offsets:i})){this.judgeStyleAttributes({opacity:n,offsets:i});var o=this.layer.getEncodedData(),a=this.calDataFrame(this.cellLength,o,this.cellProperties),s=a.data,u=a.width,l=a.height;this.rowCount=l,this.dataTexture=this.cellLength>0&&s.length>0?this.createTexture2D({flipY:!0,data:s,format:qi.LUMINANCE,type:qi.FLOAT,width:u,height:l}):this.createTexture2D({flipY:!0,data:[1],format:qi.LUMINANCE,type:qi.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Md()(n)?n:1,u_offsets:this.isOffsetStatic(i)?i:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:'\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = a_Color;\n\n  // cal style mapping - 数据纹理映射部分的计算\nstyleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping\n  \n  // vec2 offset = project_pixel(u_offsets);\n  vec2 offset = project_pixel(textrueOffsets);\n  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\\n  // \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // vec2 offset = project_pixel((u_offsets));\n    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n  } else { // else\n    // vec2 offset = project_pixel(u_offsets);\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nvarying vec4 v_color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n\n  gl_FragColor = v_color;\n  // gl_FragColor.a =gl_FragColor.a * u_opacity;\n  gl_FragColor.a =gl_FragColor.a * opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Tv,depth:{enable:!1},primitive:qi.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:du.additive}}}]),i}(Jd);function Mv(t){var e=t.coordinates;return{vertices:(0,y.Z)(e),indices:[0],size:e.length}}var Pv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,i=void 0===r?[0,0]:r,o=t.blend,a=t.strokeOpacity,s=void 0===a?1:a,u=t.strokeWidth,l=void 0===u?0:u,c=t.stroke,h=void 0===c?"#fff":c;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,offsets:i})){this.judgeStyleAttributes({opacity:n,offsets:i});var f=this.layer.getEncodedData(),p=this.calDataFrame(this.cellLength,f,this.cellProperties),d=p.data,g=p.width,v=p.height;this.rowCount=v,this.dataTexture=this.cellLength>0&&d.length>0?this.createTexture2D({flipY:!0,data:d,format:qi.LUMINANCE,type:qi.FLOAT,width:g,height:v}):this.createTexture2D({flipY:!0,data:[1],format:qi.LUMINANCE,type:qi.FLOAT,width:1,height:1})}return{u_additive:"additive"===o?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Md()(n)?n:1,u_offsets:this.isOffsetStatic(i)?i:[0,0],u_stroke_opacity:Md()(s)?s:1,u_stroke_width:Md()(l)?l:0,u_stroke_color:this.getStrokeColor(h)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:'\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_stroke_width;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\nvarying float v_blur;\nvarying float v_innerRadius;\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = a_Color;\n  v_blur = 1.0 - max(2.0/a_Size, 0.05);\n  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\n\n  // cal style mapping - 数据纹理映射部分的计算\nstyleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n  vec2 textrueOffsets = vec2(0.0, 0.0);\n  if(hasOffsets()) {\n    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n\n    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x\n    textureOffset += 1.0;\n  } else {\n    textrueOffsets = u_offsets;\n  }\n\n  // cal style mapping\n  \n  // vec2 offset = project_pixel(u_offsets);\n  vec2 offset = project_pixel(textrueOffsets);\n  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\\n  // \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // vec2 offset = project_pixel((u_offsets));\n    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n  } else { // else\n    // vec2 offset = project_pixel(u_offsets);\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_additive;\n\nuniform float u_stroke_opacity : 1;\n\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\nvarying vec4 v_color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\nvarying float v_blur;\nvarying float v_innerRadius;\n\n#pragma include "picking"\nvoid main() {\n  vec2 center = vec2(0.5);\n\n  float opacity = styleMappingMat[0][0];\n  // Tip: 片元到中心点的距离 0 - 1\n  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\n  // Tip: 片元的剪切成圆形\n  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\n\n\n  if(v_innerRadius < 0.99) {\n    // 当存在 stroke 且 stroke > 0.01\n    float blurWidth = (1.0 - v_blur)/2.0;\n    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\n    if(fragmengTocenter > v_innerRadius + blurWidth) {\n      gl_FragColor = stroke;\n    } else if(fragmengTocenter > v_innerRadius - blurWidth){\n      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\n      gl_FragColor = mix(v_color, stroke, mixR);\n    } else {\n      gl_FragColor = v_color;\n    }\n  } else {\n    // 当不存在 stroke 或 stroke <= 0.01\n    gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n\n  \n\n  \n  \n  if(u_additive > 0.0) {\n    gl_FragColor *= circleClipOpacity;\n  } else {\n    gl_FragColor.a *= circleClipOpacity;\n  }\n\n}\n',triangulation:Mv,depth:{enable:!1},primitive:qi.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:du.additive}}}]),i}(Jd);function Iv(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const Ov=function(){function t(e,n,r){(0,z.Z)(this,t),(0,m.Z)(this,"boxCells",[]),(0,m.Z)(this,"xCellCount",void 0),(0,m.Z)(this,"yCellCount",void 0),(0,m.Z)(this,"boxKeys",void 0),(0,m.Z)(this,"bboxes",void 0),(0,m.Z)(this,"width",void 0),(0,m.Z)(this,"height",void 0),(0,m.Z)(this,"xScale",void 0),(0,m.Z)(this,"yScale",void 0),(0,m.Z)(this,"boxUid",void 0);var i=this.boxCells;this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0}return(0,F.Z)(t,[{key:"insert",value:function(t,e,n,r,i){this.forEachCell(e,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(t,e,n,r,i){return this.queryHitTest(t,e,n,r,!1,i)}},{key:"hitTest",value:function(t,e,n,r,i){return this.queryHitTest(t,e,n,r,!0,i)}},{key:"insertBoxCell",value:function(t,e,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(t,e,n,r,this.queryCell,a,u,o),i?a.length>0:a}},{key:"queryCell",value:function(t,e,n,r,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l){var c,h=this.bboxes,f=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Iv(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Iv(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(l);try{for(f.s();!(c=f.n()).done;){var p=c.value;if(!u.box[p]){u.box[p]=!0;var d=4*p;if(t<=h[d+2]&&e<=h[d+3]&&n>=h[d+0]&&r>=h[d+1]&&(!s||s(this.boxKeys[p]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[p],x1:h[d],y1:h[d+1],x2:h[d+2],y2:h[d+3]})}}}}catch(t){f.e(t)}finally{f.f()}}return!1}},{key:"forEachCell",value:function(t,e,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(t),l=this.convertToYCellCoord(e),c=this.convertToXCellCoord(n),h=this.convertToYCellCoord(r),f=u;f<=c;f++)for(var p=l;p<=h;p++){var d=this.xCellCount*p+f;if(i.call(this,t,e,n,r,d,o,a,s))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),t}();var Rv=function(){function t(e,n){(0,z.Z)(this,t),(0,m.Z)(this,"width",void 0),(0,m.Z)(this,"height",void 0),(0,m.Z)(this,"grid",void 0),(0,m.Z)(this,"viewportPadding",100),(0,m.Z)(this,"screenRightBoundary",void 0),(0,m.Z)(this,"screenBottomBoundary",void 0),(0,m.Z)(this,"gridRightBoundary",void 0),(0,m.Z)(this,"gridBottomBoundary",void 0),this.width=e,this.height=n,this.viewportPadding=Math.max(e,n),this.grid=new Ov(e+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=e+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=e+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return(0,F.Z)(t,[{key:"placeCollisionBox",value:function(t){var e=t.x1+t.anchorPointX+this.viewportPadding,n=t.y1+t.anchorPointY+this.viewportPadding,r=t.x2+t.anchorPointX+this.viewportPadding,i=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(e,n,r,i)||this.grid.hitTest(e,n,r,i)?{box:[]}:{box:[e,n,r,i]}}},{key:"insertCollisionBox",value:function(t,e){var n={featureIndex:e};this.grid.insert(n,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,e,n){var r=Mi.al(e,n,0,1),i=Mi.Ue(),o=li.fromValues.apply(li,(0,y.Z)(t));return Mi.fF(i,r,o),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}}]),t}();function Lv(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Dv(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Dv(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Dv(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Nv(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0;break;default:e=.5}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:e,verticalAlign:n}}function Bv(t,e,n,r,i){if(i){var o=t[r],a=o.glyph;if(a)for(var s=e[a].advance*o.scale,u=(t[r].x+s)*i,l=n;l<=r;l++)t[l].x-=u}}function zv(t,e,n,r,i,o,a){var s,u=(e-n)*i,l=(-r*a+.5)*o,c=Lv(t);try{for(c.s();!(s=c.n()).done;){var h=s.value;h.x+=u,h.y+=l}}catch(t){c.e(t)}finally{c.f()}}function Fv(t,e,n,r,i,o,a){var s=0,u=-8,l=0,c=t.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,f=c.length;n.forEach((function(t){if(t.split("").forEach((function(t){var n=e[t];n&&(c.push({glyph:t,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a)})),c.length!==f){var n=s-a;l=Math.max(n,l),Bv(c,e,f,c.length-1,h)}s=0,u-=r+5}));var p=Nv(i),d=p.horizontalAlign,g=p.verticalAlign;zv(c,h,d,g,l,r,n.length);var v=u- -8;t.top+=-g*v,t.bottom=t.top-v,t.left+=-d*l,t.right=t.left+l}function Zv(t,e,n,r,i,o,a){var s=0,u=-8,l=0,c=t.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,f=c.length;n.forEach((function(t){var n=e[t];if(n&&(c.push({glyph:t,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a),c.length!==f){var i=s-a;l=Math.max(i,l),Bv(c,e,f,c.length-1,h)}s=0,u-=r+5}));var p=Nv(i),d=p.horizontalAlign,g=p.verticalAlign;zv(c,h,d,g,l,r,n.length);var v=u- -8;t.top+=-g*v,t.bottom=t.top-v,t.left+=-d*l,t.right=t.left+l}function jv(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Uv='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\n// uniform float u_font_size : 24.0;\nuniform float u_opacity : 1.0;\nuniform vec4 u_stroke_color : [0, 0, 0, 1];\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\n\nvarying vec4 v_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\nvoid main() {\n  // get style data mapping\n  float opacity = styleMappingMat[0][0];\n  float strokeWidth = styleMappingMat[0][2];\n  vec4 textrueStroke = vec4(\n    styleMappingMat[1][0],\n    styleMappingMat[1][1],\n    styleMappingMat[1][2],\n    styleMappingMat[1][3]\n  );\n\n  // get sdf from atlas\n  float dist = texture2D(u_sdf_map, v_uv).a;\n\n  // float fontScale = u_font_size / FONT_SIZE;\n\n  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));\n  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));\n  gl_FragColor.a= gl_FragColor.a * alpha;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',Gv='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute float a_Rotate;\n\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying float v_fontScale;\n\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\nuniform float u_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n   styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n\n   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][2] = strokeWidthAndOffset.r;\n  textureOffset = strokeWidthAndOffset.g;\n\n  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\n  if(hasStroke()) {\n    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R\n    textureOffset += 1.0;\n\n    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G\n    textureOffset += 1.0;\n\n    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B\n    textureOffset += 1.0;\n\n    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\n    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A\n    textureOffset += 1.0;\n  } else {\n    if(u_stroke_color == vec4(0.0)) {\n      styleMappingMat[1][0] = v_color.r;\n      styleMappingMat[1][1] = v_color.g;\n      styleMappingMat[1][2] = v_color.b;\n      styleMappingMat[1][3] = v_color.a;\n    } else {\n      styleMappingMat[1][0] = u_stroke_color.r;\n      styleMappingMat[1][1] = u_stroke_color.g;\n      styleMappingMat[1][2] = u_stroke_color.b;\n      styleMappingMat[1][3] = u_stroke_color.a;\n    }\n  }\n  \n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  v_uv = a_tex / u_sdf_map_size;\n\n  // 文本缩放比例\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  \n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n\n  vec4 projected_position;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));\n  } else { // else\n   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n';function Vv(t){var e=this,n=t.id,r=[],i=[];if(!e.glyphInfoMap||!e.glyphInfoMap[n])return{vertices:[],indices:[],size:7};var o=e.glyphInfoMap[n].centroid,a=2===o.length?[o[0],o[1],0]:o;return e.glyphInfoMap[n].glyphQuads.forEach((function(t,e){r.push.apply(r,(0,y.Z)(a).concat([t.tex.x,t.tex.y+t.tex.height,t.tl.x,t.tl.y],(0,y.Z)(a),[t.tex.x+t.tex.width,t.tex.y+t.tex.height,t.tr.x,t.tr.y],(0,y.Z)(a),[t.tex.x+t.tex.width,t.tex.y,t.br.x,t.br.y],(0,y.Z)(a),[t.tex.x,t.tex.y,t.bl.x,t.bl.y])),i.push(0+4*e,1+4*e,2+4*e,2+4*e,3+4*e,0+4*e)})),{vertices:r,indices:i,size:7}}var Wv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"glyphInfo",void 0),(0,m.Z)((0,H.Z)(t),"glyphInfoMap",{}),(0,m.Z)((0,H.Z)(t),"texture",void 0),(0,m.Z)((0,H.Z)(t),"currentZoom",-1),(0,m.Z)((0,H.Z)(t),"extent",void 0),(0,m.Z)((0,H.Z)(t),"textureHeight",0),(0,m.Z)((0,H.Z)(t),"textCount",0),(0,m.Z)((0,H.Z)(t),"preTextStyle",{}),(0,m.Z)((0,H.Z)(t),"buildModels",(function(){return t.initGlyph(),t.updateTexture(),t.filterGlyphs(),t.reBuildModel(),[t.layer.buildLayerModel({moduleName:"pointText",vertexShader:Gv,fragmentShader:Uv,triangulation:Vv.bind((0,H.Z)(t)),depth:{enable:!1},blend:t.getBlend()})]})),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.stroke,i=void 0===r?"#fff":r,o=t.strokeWidth,a=void 0===o?0:o,s=t.textAnchor,u=void 0===s?"center":s,l=t.textAllowOverlap,c=void 0!==l&&l,h=t.halo,f=void 0===h?.5:h,p=t.gamma,d=void 0===p?2:p,g=this.fontService,v=g.canvas,m=g.mapping;if(Object.keys(m).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(m).length),this.preTextStyle={textAnchor:u,textAllowOverlap:c},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,strokeWidth:a,stroke:i})){this.judgeStyleAttributes({opacity:n,strokeWidth:a,stroke:i});var y=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,y,this.cellProperties),b=_.data,x=_.width,w=_.height;this.rowCount=w,this.dataTexture=this.cellLength>0&&b.length>0?this.createTexture2D({flipY:!0,data:b,format:qi.LUMINANCE,type:qi.FLOAT,width:x,height:w}):this.createTexture2D({flipY:!0,data:[1],format:qi.LUMINANCE,type:qi.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Md()(n)?n:1,u_stroke_width:Md()(a)?a:0,u_stroke_color:this.getStrokeColor(i),u_sdf_map:this.texture,u_halo_blur:f,u_gamma_scale:d,u_sdf_map_size:[v.width,v.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var t=this.layer.getLayerConfig(),e=t.textAnchor,n=void 0===e?"center":e,r=t.textAllowOverlap,i=void 0===r||r;return this.preTextStyle={textAnchor:n,textAllowOverlap:i},this.buildModels()}},{key:"needUpdate",value:function(){var t=this.layer.getLayerConfig().textAllowOverlap,e=void 0!==t&&t,n=this.mapService.getZoom(),r=this.mapService.getBounds(),i=ln(this.extent,r);return(!e&&(Math.abs(this.currentZoom-n)>1||!i)||e!==this.preTextStyle.textAllowOverlap)&&(this.reBuildModel(),!0)}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:mu.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.rotate,o=void 0===i?0:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:mu.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(t,e,n,r){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?12:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:mu.Attribute,descriptor:{name:"a_tex",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}},{key:"textExtent",value:function(){return un(this.mapService.getBounds(),.5)}},{key:"initTextFont",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=void 0===e?"400":e,r=t.fontFamily,i=void 0===r?"sans-serif":r,o=this.layer.getEncodedData(),a=[];o.forEach((function(t){var e,n=t.shape,r=void 0===n?"":n,i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return jv(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jv(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(r=r.toString());try{for(i.s();!(e=i.n()).done;){var o=e.value;-1===a.indexOf(o)&&a.push(o)}}catch(t){i.e(t)}finally{i.f()}})),this.fontService.setFontOptions({characterSet:a,fontWeight:n,fontFamily:i,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=void 0===e?"400":e,r=t.fontFamily,i=void 0===r?"sans-serif":r,o=this.layer.getEncodedData(),a=[];o.forEach((function(t){var e=t.shape,n=void 0===e?"":e;n="".concat(n),-1===a.indexOf(n)&&a.push(n)})),this.fontService.setFontOptions({characterSet:a,fontWeight:n,fontFamily:i,iconfont:!0})}},{key:"generateGlyphLayout",value:function(t){var e=this,n=this.fontService.mapping,r=this.layer.getLayerConfig(),i=r.spacing,o=void 0===i?2:i,a=r.textAnchor,s=void 0===a?"center":a,u=this.layer.getEncodedData();this.glyphInfo=u.map((function(r){var i=r.shape,a=void 0===i?"":i,u=r.id,l=r.size,c=void 0===l?1:l,h=r.textOffset,f=void 0===h?[0,0]:h,p=function(t,e,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=t.split("\n"),l=[],c={positionedGlyphs:l,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:t};return s?Zv(c,e,u,n,r,i,o):Fv(c,e,u,n,r,i,o),!!l.length&&c}(a.toString(),n,c,s,"left",o,f,t),d=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=t.positionedGlyphs,o=[],a=Lv(void 0===i?[]:i);try{for(a.s();!(e=a.n()).done;){var s=e.value,u=s.metrics,l=4,c=u.advance*s.scale/2,h=r?[s.x+c,s.y]:[0,0],f=r?[0,0]:[s.x+c+n[0],s.y+n[1]],p=(0-l)*s.scale-c+f[0],d=(0-l)*s.scale+f[1],g=p+u.width*s.scale,v=d+u.height*s.scale,m={x:p,y:d},y={x:g,y:d},_={x:p,y:v},b={x:g,y:v};o.push({tl:m,tr:y,bl:_,br:b,tex:u,glyphOffset:h})}}catch(t){a.e(t)}finally{a.f()}return o}(p,f,!1);return r.shaping=p,r.glyphQuads=d,r.centroid=vg(r.coordinates),r.originCentroid="GAODE2.x"===r.version?vg(r.originCoordinates):r.originCentroid=r.centroid,e.glyphInfoMap[u]={shaping:p,glyphQuads:d,centroid:vg(r.coordinates)},r}))}},{key:"filterGlyphs",value:function(){var t=this,e=this.layer.getLayerConfig(),n=e.padding,r=void 0===n?[4,4]:n,i=e.textAllowOverlap;if(void 0===i||!i){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new Rv(a,s),l=this.glyphInfo.filter((function(e){var n=e.shaping,i=e.id,o=void 0===i?0:i,a="GAODE2.x"===e.version?e.originCentroid:e.centroid,s=e.size/24,l=t.mapService.lngLatToContainer(a),c=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:l.x,anchorPointY:l.y}).box;return!(!c||!c.length||(u.insertCollisionBox(c,o),0))}));l.forEach((function(e){t.glyphInfoMap[e.id]=e}))}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig().iconfont,e=void 0!==t&&t;e?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(e)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,e=this.fontService.canvas;this.textureHeight=e.height,this.texture&&this.texture.destroy(),this.texture=t({data:e,mag:qi.LINEAR,min:qi.LINEAR,width:e.width,height:e.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Gv,fragmentShader:Uv,triangulation:Vv.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),i}(Jd);const Hv={fill:Sv,image:Av,normal:kv,simplePoint:Pv,extrude:Ev,text:Wv,icon:Cv};var Xv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"type","PointLayer"),t}return(0,F.Z)(i,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new Hv[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{normal:{blend:"additive"},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}}[this.getModelType()]}},{key:"getModelType",value:function(){var t=this.getEncodedData(),e=this.getLayerConfig(),n=e.shape2d,r=e.shape3d,i=this.iconService.getIconMap(),o=t.find((function(t){return t.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"normal":"simple"===a?"simplePoint":-1!==(null==n?void 0:n.indexOf(a))?"fill":-1!==(null==r?void 0:r.indexOf(a))?"extrude":i.hasOwnProperty(a)?"image":""!==this.fontService.getGlyph(a)?"icon":"text"}return"normal"}}]),i}(Yd);var Yv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig().opacity,e=void 0===t?1:t;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:e})){this.judgeStyleAttributes({opacity:e});var n=this.layer.getEncodedData(),r=this.calDataFrame(this.cellLength,n,this.cellProperties),i=r.data,o=r.width,a=r.height;this.rowCount=a,this.dataTexture=this.cellLength>0&&i.length>0?this.createTexture2D({flipY:!0,data:i,format:qi.LUMINANCE,type:qi.FLOAT,width:o,height:a}):this.createTexture2D({flipY:!0,data:[1],format:qi.LUMINANCE,type:qi.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Md()(e)?e:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig().pickLight,e=void 0!==t&&t;return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:e?'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvarying float v_lightWeight;\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  v_lightWeight = lightWeight;\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n':'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  styleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:e?'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n#pragma include "picking"\nvarying float v_lightWeight;\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  gl_FragColor = v_Color;\n  // gl_FragColor.a *= u_opacity;\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);\n}\n':'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  gl_FragColor = v_Color;\n  // gl_FragColor.a *= u_opacity;\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:Dg})]}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:mu.Attribute,descriptor:{name:"a_Normal",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?10:i;return Array.isArray(o)?[o[0]]:[o]}}})}}]),i}(Jd);var qv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.opacityLinear,i=void 0===r?{enable:!1,dir:"in"}:r;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var o=this.layer.getEncodedData(),a=this.calDataFrame(this.cellLength,o,this.cellProperties),s=a.data,u=a.width,l=a.height;this.rowCount=l,this.dataTexture=this.cellLength>0&&s.length>0?this.createTexture2D({flipY:!0,data:s,format:qi.LUMINANCE,type:qi.FLOAT,width:u,height:l}):this.createTexture2D({flipY:!0,data:[1],format:qi.LUMINANCE,type:qi.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Md()(n)?n:1,u_opacitylinear:Number(i.enable),u_dir:"in"===i.dir?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig().opacityLinear,e=void 0===t?{enable:!1,dir:"in"}:t;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:e.enable?'attribute vec4 a_Color;\nattribute vec3 a_Position;\n\n\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nuniform float u_opacitylinear: 0.0;\n\nattribute vec3 a_linear;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\n\nvoid main() {\n  if(u_opacitylinear > 0.0) {\n    v_linear = a_linear;\n    v_pos = a_Position.xy;\n  }\n  \n  // cal style mapping - 数据纹理映射部分的计算\nstyleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}':'attribute vec4 a_Color;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat; // 用于将在顶点着色器中计算好的样式值传递给片元\n\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\nstyleMappingMat = mat4(\n    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty\n    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA\n    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]\n    0.0, 0.0, 0.0, 0.0\n  );\n\n  float rowCount = u_cellTypeLayout[0][0];    // 当前的数据纹理有几行\n  float columnCount = u_cellTypeLayout[0][1]; // 当看到数据纹理有几列\n  float columnWidth = 1.0/columnCount;  // 列宽\n  float rowHeight = 1.0/rowCount;       // 行高\n  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets\n  float id = a_vertexId; // 第n个顶点\n  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // 起始点在第几行\n  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // 起始点在第几列\n  \n  // cell 固定顺序 opacity -> strokeOpacity -> strokeWidth -> stroke ... \n  // 按顺序从 cell 中取值、若没有则自动往下取值\n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\n  styleMappingMat[0][0] = opacityAndOffset.r;\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n\n',fragmentShader:e.enable?'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nuniform float u_dir: 1.0;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\n\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  gl_FragColor = v_Color;\n  \n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n  }\n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n':'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat; // 传递从片元中传递的映射数据\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = styleMappingMat[0][0];\n  gl_FragColor = v_Color;\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:e.enable?Rg:Og,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var t;null===(t=this.dataTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().opacityLinear;(void 0===t?{enable:!1,dir:"in"}:t).enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:mu.Attribute,descriptor:{name:"a_linear",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e,n,r,i){return[n[3],n[4],n[5]]}}})}}]),i}(Jd);const Kv={fill:qv,line:_v,extrude:Yv,text:Wv,point_fill:Sv,point_image:Av,point_normal:kv,point_extrude:Ev};var Qv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"type","PolygonLayer"),t}return(0,F.Z)(i,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new Kv[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==e||null===(t=e.scale)||void 0===t?void 0:t.field;return"fill"===n?"fill":"extrude"===n?"extrude":"line"===n?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),e=this.getLayerConfig(),n=e.shape2d,r=e.shape3d,i=this.iconService.getIconMap(),o=t.find((function(t){return t.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null==n?void 0:n.indexOf(a))?"point_fill":-1!==(null==r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]),i}(Yd);var Jv=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"texture",void 0),(0,m.Z)((0,H.Z)(t),"colorTexture",void 0),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.clampLow,i=void 0===r||r,o=t.clampHigh,a=void 0===o||o,s=t.noDataValue,u=void 0===s?-9999999:s,l=t.domain,c=void 0===l?[0,1]:l;return this.updateColorTexure(),{u_opacity:n||1,u_texture:this.texture,u_domain:c,u_clampLow:i,u_clampHigh:void 0!==a?a:i,u_noDataValue:u,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var t=this.layer.getSource(),e=this.rendererService.createTexture2D,n=t.data.dataArray[0];this.texture=e({data:n.data,width:n.width,height:n.height,format:qi.LUMINANCE,type:qi.FLOAT});var r=bn(this.layer.getLayerConfig().rampColors);return this.colorTexture=e({data:r.data,width:r.width,height:r.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\n\nvoid main() {\n\n  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\n  if (value == u_noDataValue)\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\n    gl_FragColor = vec4(0, 0, 0, 0);\n  else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\n    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\n    gl_FragColor = color;\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n  }\n\n\n}\n",triangulation:Bg,primitive:qi.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_Uv",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}},{key:"updateColorTexure",value:function(){var t=this.rendererService.createTexture2D,e=bn(this.layer.getLayerConfig().rampColors);this.colorTexture=t({data:e.data,width:e.width,height:e.height,flipY:!1})}}]),i}(Jd);const $v={raster:Jv,raster3d:Jv};var tm=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"type","RasterLayer"),t}return(0,F.Z)(i,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new $v[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{raster:{},raster3d:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"raster"}}]),i}(Yd);var em=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig().opacity,e=void 0===t?1:t;return{u_opacity:Md()(e)?e:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){return this.layer.zIndex=-997,[this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:"\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nvarying float v_CamreaDistance;\n\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvarying float v_offset;\n\nvoid main() {\n    float EARTH_RADIUS = 100.0;\n    \n    v_Color = a_Color;\n\n    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\n\nvarying vec3 vVertexNormal;\nvarying float v_offset;\nvarying vec4 v_Color;\nvoid main() {\n    \n    \n    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    // TODO: 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",triangulation:jg,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mu.Attribute,descriptor:{name:"a_Normal",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_Uv",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}}]),i}(Jd);var nm=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"texture",void 0),(0,m.Z)((0,H.Z)(t),"earthTime",3.4),(0,m.Z)((0,H.Z)(t),"sunX",1e3),(0,m.Z)((0,H.Z)(t),"sunY",1e3),(0,m.Z)((0,H.Z)(t),"sunZ",1e3),(0,m.Z)((0,H.Z)(t),"sunRadius",Math.sqrt(t.sunX*t.sunX+t.sunY*t.sunY+t.sunZ*t.sunZ)),t}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=t.globelOtions;return null!=e&&e.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY)),{u_ambientRatio:(null==n?void 0:n.ambientRatio)||.6,u_diffuseRatio:(null==n?void 0:n.diffuseRatio)||.4,u_specularRatio:(null==n?void 0:n.specularRatio)||.1,u_sunLight:[this.sunX,this.sunY,this.sunZ],u_texture:this.texture}}},{key:"setEarthTime",value:function(t){this.earthTime=t,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.renderLayers()}},{key:"initModels",value:function(){var t=this,e=this.layer.getLayerConfig().globelOtions;void 0!==(null==e?void 0:e.earthTime)&&this.setEarthTime(e.earthTime);var n=this.layer.getSource(),r=this.rendererService.createTexture2D;return this.texture=r({height:0,width:0}),n.data.images.then((function(e){t.texture=r({data:e[0],width:e[0].width,height:e[0].height}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()})),this.buildModels()}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){return this.layer.zIndex=-998,[this.layer.buildLayerModel({moduleName:"baseEarth",vertexShader:"// attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\n// attribute vec2 a_Extrude;\n// attribute float a_Size;\n// attribute float a_Shape;\n\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform float u_ambientRatio : 0.5;\nuniform float u_diffuseRatio : 0.3;\nuniform float u_specularRatio : 0.2;\nuniform vec3 u_sunLight: [1.0, -10.5, 12.0];\n\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n\n    // cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(u_sunLight);\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n    // lambert\n    float lambert = dot(worldNormal, lightDir);\n    // specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n    //sum to light weight\n    float lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;\n\n    return lightWeight;\n}\n\nvarying float v_lightWeight;\nvoid main() {\n\n    v_texCoord = a_Uv;\n\n    float lightWeight = calc_lighting(vec4(a_Position, 1.0));\n    v_lightWeight = lightWeight;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform sampler2D u_texture;\n\nvarying vec2 v_texCoord;\nvarying float v_lightWeight;\n\n\nvoid main() {\n\n    vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n    color.xyz = color.xyz * v_lightWeight;\n    gl_FragColor = color;\n}\n",triangulation:jg,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mu.Attribute,descriptor:{name:"a_Normal",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_Uv",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}}]),i}(Jd);var rm=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){return(0,z.Z)(this,i),r.apply(this,arguments)}return(0,F.Z)(i,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig().opacity,e=void 0===t?1:t;return{u_opacity:Md()(e)?e:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){return this.layer.zIndex=-999,[this.layer.buildLayerModel({moduleName:"earthBloomSphere",vertexShader:"\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\n\nvoid main() {\n    v_Color = a_Color;\n\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",fragmentShader:"\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\nvarying vec3 vVertexNormal;\n\nvarying vec4 v_Color;\nvoid main() {\n\n\n    float intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));\n    // TODO: 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",triangulation:Ug,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:mu.Attribute,descriptor:{name:"a_Size",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){var i=t.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:mu.Attribute,descriptor:{name:"a_Normal",buffer:{usage:qi.STATIC_DRAW,data:[],type:qi.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_Uv",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}}]),i}(Jd);var im={base:nm,atomSphere:em,bloomSphere:rm},om=["base","atomSphere","bloomSphere"],am=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"type","EarthLayer"),t}return(0,F.Z)(i,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new im[t](this),this.models=this.layerModel.initModels()}},{key:"setEarthTime",value:function(t){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(t):console.error("请在 scene loaded 之后执行该方法！")}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"base";return om.indexOf(n)<0&&(n="base"),n}}]),i}(Yd);function sm(t,e,n){var r=um(t,t.VERTEX_SHADER,e),i=um(t,t.FRAGMENT_SHADER,n);if(!r||!i)return null;var o=t.createProgram();if(!o)return null;if(t.attachShader(o,r),t.attachShader(o,i),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS)){var a=t.getProgramInfoLog(o);return console.warn("Failed to link program: "+a),t.deleteProgram(o),t.deleteShader(i),t.deleteShader(r),null}for(var s=t.getProgramParameter(o,t.ACTIVE_ATTRIBUTES),u=0;u<s;u++){var l=t.getActiveAttrib(o,u);o[l.name]=t.getAttribLocation(o,l.name)}for(var c=t.getProgramParameter(o,t.ACTIVE_UNIFORMS),h=0;h<c;h++){var f=t.getActiveUniform(o,h);o[f.name]=t.getUniformLocation(o,f.name)}return o.vertexShader=r,o.fragmentShader=i,o}function um(t,e,n){var r=t.createShader(e);if(null==r)return console.warn("unable to create shader"),null;if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var i=t.getShaderInfoLog(r);return console.warn("Failed to compile shader: "+i),t.deleteShader(r),null}return r}function lm(t,e,n,r,i){var o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r,i,0,t.RGBA,t.UNSIGNED_BYTE,n),t.bindTexture(t.TEXTURE_2D,null),o}function cm(t,e,n){t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,e)}function hm(t,e){var n=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),n}function fm(t){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;for(var r=n.createLinearGradient(0,0,256,0),i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];r.addColorStop(+a,t[+a])}return n.fillStyle=r,n.fillRect(0,0,256,1),e=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function pm(t,e,n,r){t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(n),t.vertexAttribPointer(n,r,t.FLOAT,!1,0,0)}function dm(t,e,n){t.bindFramebuffer(t.FRAMEBUFFER,e),n&&t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}var gm=function(){function t(e){(0,z.Z)(this,t),(0,m.Z)(this,"width",512),(0,m.Z)(this,"height",512),(0,m.Z)(this,"pixels",void 0),(0,m.Z)(this,"fadeOpacity",void 0),(0,m.Z)(this,"speedFactor",void 0),(0,m.Z)(this,"dropRate",void 0),(0,m.Z)(this,"dropRateBump",void 0),(0,m.Z)(this,"gl",void 0),(0,m.Z)(this,"drawProgram",void 0),(0,m.Z)(this,"fullScreenProgram",void 0),(0,m.Z)(this,"updateProgram",void 0),(0,m.Z)(this,"rampColors",void 0),(0,m.Z)(this,"numParticles",65536),(0,m.Z)(this,"numParticlesSize",void 0),(0,m.Z)(this,"particleStateResolution",void 0),(0,m.Z)(this,"quadBuffer",void 0),(0,m.Z)(this,"particleIndexBuffer",void 0),(0,m.Z)(this,"framebuffer",void 0),(0,m.Z)(this,"colorRampTexture",void 0),(0,m.Z)(this,"backgroundTexture",void 0),(0,m.Z)(this,"screenTexture",void 0),(0,m.Z)(this,"particleStateTexture0",void 0),(0,m.Z)(this,"particleStateTexture1",void 0),(0,m.Z)(this,"windTexture",void 0),(0,m.Z)(this,"windData",void 0),this.gl=e.glContext,this.width=e.imageWidth,this.height=e.imageHeight,this.fadeOpacity=e.fadeOpacity,this.speedFactor=e.speedFactor,this.dropRate=e.dropRate,this.dropRateBump=e.dropRateBump,this.rampColors=e.rampColors,this.init()}return(0,F.Z)(t,[{key:"init",value:function(){var t=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=sm(t,"\n precision mediump float;\n \n attribute float a_index;\n \n uniform sampler2D u_particles;\n uniform float u_particles_res;\n \n varying vec2 v_particle_pos;\n \n void main() {\n     vec4 color = texture2D(u_particles, vec2(\n         fract(a_index / u_particles_res),\n         floor(a_index / u_particles_res) / u_particles_res)\n     );\n                \n     // decode current particle position from the pixel's RGBA value\n     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n                         \n     gl_PointSize = 1.0;\n     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n }","\n precision mediump float;\n \n uniform sampler2D u_wind;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform sampler2D u_color_ramp;\n \n varying vec2 v_particle_pos;\n \n void main() {\n     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n     float speed_t = length(velocity) / length(u_wind_max);\n     \n     // color ramp is encoded in a 16x16 texture    \n     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);  \n \n     gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n }"),this.fullScreenProgram=sm(t,"\n     precision mediump float;\n     \n     attribute vec2 a_pos;\n     \n     varying vec2 v_tex_pos;\n     \n     void main() {\n         v_tex_pos = a_pos;\n         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);\n         gl_PointSize = 100.0;\n }","\n precision mediump float;\n \n uniform sampler2D u_screen;\n uniform float u_opacity;\n varying vec2 v_tex_pos;\n \n void main() {\n     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n     \n     // a hack to guarantee opacity fade out even with a value close to 1.0\n     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n }"),this.updateProgram=sm(t,"\n precision mediump float;\n \n attribute vec2 a_pos;\n \n varying vec2 v_tex_pos;\n \n void main() {\n     v_tex_pos = a_pos;\n     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n     // framebuffer 始终用铺满屏幕的 texture\n }","\n precision highp float;\n \n uniform sampler2D u_particles;\n uniform sampler2D u_wind;\n uniform vec2 u_wind_res;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform float u_rand_seed;\n uniform float u_speed_factor;\n uniform float u_drop_rate;\n uniform float u_drop_rate_bump;\n \n varying vec2 v_tex_pos;\n \n // pseudo-random generator\n const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n float rand(const vec2 co) {\n float t = dot(rand_constants.xy, co);\n     return fract(sin(t) * (rand_constants.z + t));\n }\n     \n // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n vec2 lookup_wind(const vec2 uv) {\n     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n     vec2 px = 1.0 / u_wind_res;\n     vec2 vc = (floor(uv * u_wind_res)) * px;\n     vec2 f = fract(uv * u_wind_res);\n     vec2 tl = texture2D(u_wind, vc).rg;\n     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n     vec2 br = texture2D(u_wind, vc + px).rg;\n     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n }\n \n void main() {\n     vec4 color = texture2D(u_particles, v_tex_pos);\n     vec2 pos = vec2(\n         color.r / 255.0 + color.b,\n         color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n     float speed_t = length(velocity) / length(u_wind_max);\n                 \n     // take EPSG:4236 distortion into account for calculating where the particle moved\n     float distortion = cos(radians(pos.y * 180.0 - 90.0));\n     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n \n     // update particle position, wrapping around the date line\n     pos = fract(1.0 + pos + offset);\n     \n     // a random seed to use for the particle drop\n     vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n     \n     // drop rate is a chance a particle will restart at random position, to avoid degeneration\n     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n     float drop = step(1.0 - drop_rate, rand(seed));\n     \n     vec2 random_pos = vec2(\n         rand(seed + 1.3),\n         rand(seed + 2.1));\n         pos = mix(pos, random_pos, drop);\n         \n     // encode the new particle position back into RGBA\n     gl_FragColor = vec4(\n         fract(pos * 255.0),\n         floor(pos * 255.0) / 255.0);\n }"),this.quadBuffer=hm(t,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=t.createFramebuffer(),this.colorRampTexture=lm(this.gl,this.gl.LINEAR,fm(this.rampColors),16,16);var e=new Uint8Array(this.width*this.height*4);this.backgroundTexture=lm(t,t.NEAREST,e,this.width,this.height),this.screenTexture=lm(t,t.NEAREST,e,this.width,this.height);var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=lm(t,t.NEAREST,r,n,n),this.particleStateTexture1=lm(t,t.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=hm(t,o)}},{key:"setWind",value:function(t){this.windData=t,this.windTexture=function(t,e,n){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.bindTexture(t.TEXTURE_2D,null),r}(this.gl,this.gl.LINEAR,t.image)}},{key:"updateParticelNum",value:function(t){var e=this.gl;if(t!==this.numParticles){this.numParticles=t;var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=lm(e,e.NEAREST,r,n,n),this.particleStateTexture1=lm(e,e.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=hm(e,o)}}},{key:"updateWindDir",value:function(t,e,n,r){this.windData.uMin=t,this.windData.uMax=e,this.windData.vMin=n,this.windData.vMax=r}},{key:"updateColorRampTexture",value:function(t){if(this.isColorChanged(t)){this.rampColors=t;var e=this.gl;e.deleteTexture(this.colorRampTexture),this.colorRampTexture=lm(e,e.LINEAR,fm(t),16,16)}}},{key:"isColorChanged",value:function(t){for(var e=0,n=Object.keys(t);e<n.length;e++){var r=n[e],i=Number(r);if(!this.rampColors[i])return!0;if(this.rampColors[i]&&this.rampColors[i]!==t[i])return!0}return!1}},{key:"reSize",value:function(t,e){if(t!==this.width||e!==this.height){var n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=t,this.height=e;var r=new Uint8Array(t*e*4);this.backgroundTexture=lm(n,n.NEAREST,r,t,e),this.screenTexture=lm(n,n.NEAREST,r,t,e)}}},{key:"draw",value:function(){var t;if(null!==(t=this.windData)&&void 0!==t&&t.image){var e=this.gl;return cm(e,this.windTexture,0),cm(e,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}},{key:"drawScreen",value:function(){var t=this.gl;dm(t,this.framebuffer,this.screenTexture),t.viewport(0,0,this.width,this.height),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),t.disable(t.BLEND),this.pixels=new Uint8Array(4*this.width*this.height),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.pixels),dm(t,null,null),t.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var e=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=e}},{key:"drawFullTexture",value:function(t,e){var n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),cm(n,t,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,e),n.drawArrays(n.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var t=this.gl,e=this.drawProgram;t.useProgram(e),pm(t,this.particleIndexBuffer,e.a_index,1),cm(t,this.colorRampTexture,2),t.uniform1i(e.u_wind,0),t.uniform1i(e.u_particles,1),t.uniform1i(e.u_color_ramp,2),t.uniform1f(e.u_particles_res,this.particleStateResolution),t.uniform2f(e.u_wind_min,this.windData.uMin,this.windData.vMin),t.uniform2f(e.u_wind_max,this.windData.uMax,this.windData.vMax),t.drawArrays(t.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var t=this.gl;dm(t,this.framebuffer,this.particleStateTexture1),t.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var e=this.updateProgram;t.useProgram(e),pm(t,this.quadBuffer,e.a_pos,2),t.uniform1i(e.u_wind,0),t.uniform1i(e.u_particles,1),t.uniform1f(e.u_rand_seed,Math.random()),t.uniform2f(e.u_wind_res,2*this.windData.image.width,2*this.windData.image.height),t.uniform2f(e.u_wind_min,this.windData.uMin,this.windData.vMin),t.uniform2f(e.u_wind_max,this.windData.uMax,this.windData.vMax),t.uniform1f(e.u_speed_factor,this.speedFactor),t.uniform1f(e.u_drop_rate,this.dropRate),t.uniform1f(e.u_drop_rate_bump,this.dropRateBump),t.drawArrays(t.TRIANGLES,0,6);var n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,dm(t,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}]),t}();var vm={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"},mm=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"texture",void 0),(0,m.Z)((0,H.Z)(t),"colorModel",void 0),(0,m.Z)((0,H.Z)(t),"wind",void 0),(0,m.Z)((0,H.Z)(t),"imageCoords",void 0),(0,m.Z)((0,H.Z)(t),"sizeScale",.5),(0,m.Z)((0,H.Z)(t),"frequency",new dn(7.2)),t}return(0,F.Z)(i,[{key:"render",value:function(){var t=this;this.frequency.run((function(){t.drawWind()})),this.drawColorMode()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var t=this,e=this.rendererService.createTexture2D,n=this.layer.getSource();this.texture=e({height:0,width:0});var r=this.rendererService.getGLContext();return this.imageCoords=n.data.dataArray[0].coordinates,n.data.images.then((function(n){var i=t.layer.getLayerConfig(),o=i.uMin,a=void 0===o?-21.32:o,s=i.uMax,u=void 0===s?26.8:s,l=i.vMin,c=void 0===l?-21.57:l,h=i.vMax,f=void 0===h?21.42:h,p=i.fadeOpacity,d=void 0===p?.996:p,g=i.speedFactor,v=void 0===g?.25:g,m=i.dropRate,y=void 0===m?.003:m,_=i.dropRateBump,b=void 0===_?.01:_,x=i.rampColors,w=void 0===x?vm:x,E=i.sizeScale,S=void 0===E?.5:E;t.sizeScale=S;var C=t.getWindSize(),A=C.imageWidth,T=C.imageHeight,k={glContext:r,imageWidth:A,imageHeight:T,fadeOpacity:d,speedFactor:v,dropRate:y,dropRateBump:b,rampColors:w};t.wind=new gm(k),t.wind.setWind({uMin:a,uMax:u,vMin:c,vMax:f,image:n[0]}),t.texture=e({data:n[0],width:n[0].width,height:n[0].height}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()})),this.colorModel=this.layer.buildLayerModel({moduleName:"WindLayer",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}\n",triangulation:Bg,primitive:qi.TRIANGLES,depth:{enable:!1},blend:this.getBlend()}),[this.colorModel]}},{key:"getWindSize",value:function(){var t=this.mapService.lngLatToPixel(this.imageCoords[0]),e=this.mapService.lngLatToPixel(this.imageCoords[1]);return{imageWidth:Math.floor((e.x-t.x)*this.sizeScale),imageHeight:Math.floor((t.y-e.y)*this.sizeScale)}}},{key:"buildModels",value:function(){return this.initModels()}},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.wind)||void 0===e||e.destroy()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:mu.Attribute,descriptor:{name:"a_Uv",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:2,update:function(t,e,n,r){return[n[3],n[4]]}}})}},{key:"drawWind",value:function(){if(this.wind){var t=this.layer.getLayerConfig(),e=t.uMin,n=void 0===e?-21.32:e,r=t.uMax,i=void 0===r?26.8:r,o=t.vMin,a=void 0===o?-21.57:o,s=t.vMax,u=void 0===s?21.42:s,l=t.numParticles,c=void 0===l?65535:l,h=t.fadeOpacity,f=void 0===h?.996:h,p=t.speedFactor,d=void 0===p?.25:p,g=t.dropRate,v=void 0===g?.003:g,m=t.dropRateBump,y=void 0===m?.01:m,_=t.rampColors,b=void 0===_?vm:_,x=t.sizeScale,w=void 0===x?.5:x;if("number"==typeof w&&w!==this.sizeScale){this.sizeScale=w;var E=this.getWindSize(),S=E.imageWidth,C=E.imageHeight;this.wind.reSize(S,C)}this.wind.updateWindDir(n,i,a,u),this.wind.updateParticelNum(c),this.wind.updateColorRampTexture(b),this.wind.fadeOpacity=f,this.wind.speedFactor=d,this.wind.dropRate=v,this.wind.dropRateBump=y;var A=this.wind.draw(),T=A.d,k=A.w,M=A.h;this.rendererService.setBaseState(),this.texture.update({data:T,width:k,height:M})}}},{key:"drawColorMode",value:function(){var t=this.layer.getLayerConfig().opacity;this.colorModel.draw({uniforms:{u_opacity:t||1,u_texture:this.texture}})}}]),i}(Jd);const ym={wind:mm};var _m,bm,xm,wm,Em,Sm,Cm,Am,Tm,km=function(t){(0,U.Z)(i,t);var e,n,r=(e=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=(0,V.Z)(e);if(n){var i=(0,V.Z)(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return(0,G.Z)(this,t)});function i(){var t;(0,z.Z)(this,i);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return t=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,H.Z)(t),"type","WindLayer"),t}return(0,F.Z)(i,[{key:"buildModels",value:function(){var t=this.getModelType();this.layerModel=new ym[t](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){return this.layerModel&&this.layerModel.render(),this}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{wind:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"wind"}}]),i}(Yd);function Mm(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var Pm,Im=(_m=(0,Zr.b2)(),bm=(0,Zr.f3)(Ur.IGlobalConfigService),xm=(0,Zr.f3)(Ur.IMapService),wm=(0,Zr.f3)(Ur.IFontService),_m((Sm=function(){function t(){(0,z.Z)(this,t),(0,Ti.Z)(this,"configService",Cm,this),(0,Ti.Z)(this,"mapService",Am,this),(0,Ti.Z)(this,"fontService",Tm,this)}return(0,F.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tap("DataMappingPlugin",(function(){n.generateMaping(t,{styleAttributeService:r})})),t.hooks.beforeRenderData.tap("DataMappingPlugin",(function(){return t.dataState.dataMappingNeedUpdate=!1,n.generateMaping(t,{styleAttributeService:r}),!0})),t.hooks.beforeRender.tap("DataMappingPlugin",(function(){if(!t.layerModelNeedUpdate){var e=t.getBottomColor(),i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=t.getSource().data.dataArray,s=i.filter((function(t){return t.needRemapping})),u=a;null!=o&&o.needRemapping&&null!=o&&o.scale&&(u=a.filter((function(t){return n.applyAttributeMapping(o,t,e)[0]}))),s.length&&(null!=o&&o.needRemapping?(t.setEncodedData(n.mapping(i,u,void 0,e)),o.needRemapping=!1):t.setEncodedData(n.mapping(s,u,t.getEncodedData(),e)),t.emit("remapping",null))}}))}},{key:"generateMaping",value:function(t,e){var n=this,r=e.styleAttributeService,i=t.getBottomColor(),o=r.getLayerStyleAttributes()||[],a=r.getLayerStyleAttribute("filter"),s=t.getSource().data.dataArray,u=s;null!=a&&a.scale&&(u=s.filter((function(t){return n.applyAttributeMapping(a,t,i)[0]}))),t.setEncodedData(this.mapping(o,u,void 0,i))}},{key:"mapping",value:function(t,e,n,r){var i=this,o=e.map((function(e,o){var a=n?n[o]:{},s=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mm(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mm(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({id:e._id,coordinates:e.coordinates},a);return t.filter((function(t){return void 0!==t.scale})).forEach((function(t){var n=i.applyAttributeMapping(t,e,r);t.needRemapping=!1,"color"===t.name&&(n=n.map((function(t){return mn(t)}))),s[t.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===t.name&&(s.shape=i.fontService.getIconFontKey(s[t.name]))})),s}));return o.length>0&&"GAODE2.x"===this.mapService.version&&("number"==typeof o[0].coordinates[0]?o.filter((function(t){return!t.originCoordinates})).map((function(t){t.version="GAODE2.x",t.originCoordinates=zn()(t.coordinates),t.coordinates=i.mapService.lngLatToCoord(t.coordinates)})):o.filter((function(t){return!t.originCoordinates})).map((function(t){t.version="GAODE2.x",t.originCoordinates=zn()(t.coordinates),t.coordinates=i.mapService.lngLatToCoords(t.coordinates)}))),o}},{key:"applyAttributeMapping",value:function(t,e,n){var r;if(!t.scale)return[];var i=(null==t||null===(r=t.scale)||void 0===r?void 0:r.scalers)||[],o=[];i.forEach((function(n){var r,i=n.field;(e.hasOwnProperty(i)||"variable"===(null===(r=t.scale)||void 0===r?void 0:r.type))&&o.push(e[i])}));var a=t.mapping?t.mapping(o):[];return"color"!==t.name||vn(a[0])?a:[n]}}]),t}(),Cm=(0,ki.Z)(Sm.prototype,"configService",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Am=(0,ki.Z)(Sm.prototype,"mapService",[xm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tm=(0,ki.Z)(Sm.prototype,"fontService",[wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Em=Sm))||Em),Om=(0,Zr.b2)()(Pm=function(){function t(){(0,z.Z)(this,t),(0,m.Z)(this,"mapService",void 0)}return(0,F.Z)(t,[{key:"apply",value:function(t){var e=this;this.mapService=t.getContainer().get(Ur.IMapService),t.hooks.init.tap("DataSourcePlugin",(function(){if(!t.getSource()){var n=t.sourceOption||{data:Nr,options:Br},r=n.data,i=n.options;t.setSource(new zr(r,i))}e.updateClusterData(t)})),t.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){var n=e.updateClusterData(t),r=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,n||r}))}},{key:"updateClusterData",value:function(t){var e=t.getSource(),n=e.cluster,r=e.clusterOptions,i=r.zoom,o=void 0===i?0:i,a=r.maxZoom,s=void 0===a?16:a,u=this.mapService.getZoom()-1,l=t.dataState.dataSourceNeedUpdate;return!!(n&&(l||Math.abs(o-u)>1)&&s>o)&&(e.updateClusterData(Math.floor(u)),!0)}}]),t}())||Pm;function Rm(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Lm(t){var e;return 1===t.length&&(e=t,t=function(t,n){return Rm(e(t),n)}),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}var Dm=Lm(Rm),Nm=Dm.right;Dm.left;const Bm=Nm;var zm=Array.prototype,Fm=(zm.slice,zm.map,Math.sqrt(50)),Zm=Math.sqrt(10),jm=Math.sqrt(2);function Um(t,e,n){var r,i,o,a,s=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(a=Gm(t,e,n))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),e=Math.floor(e/a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(t+s)*a;else for(t=Math.floor(t*a),e=Math.ceil(e*a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(t-s)/a;return r&&o.reverse(),o}function Gm(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=Fm?10:o>=Zm?5:o>=jm?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=Fm?10:o>=Zm?5:o>=jm?2:1)}function Vm(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=Fm?i*=10:o>=Zm?i*=5:o>=jm&&(i*=2),e<t?-i:i}function Wm(t){return null===t?NaN:+t}function Hm(t,e,n){if(null==n&&(n=Wm),r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,o=Math.floor(i),a=+n(t[o],o,t);return a+(+n(t[o+1],o+1,t)-a)*(i-o)}}var Xm="$";function Ym(){}function qm(t,e){var n=new Ym;if(t instanceof Ym)t.each((function(t,e){n.set(e,t)}));else if(Array.isArray(t)){var r,i=-1,o=t.length;if(null==e)for(;++i<o;)n.set(i,t[i]);else for(;++i<o;)n.set(e(r=t[i],i,t),r)}else if(t)for(var a in t)n.set(a,t[a]);return n}Ym.prototype=qm.prototype={constructor:Ym,has:function(t){return Xm+t in this},get:function(t){return this[Xm+t]},set:function(t,e){return this[Xm+t]=e,this},remove:function(t){var e=Xm+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===Xm&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===Xm&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===Xm&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===Xm&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===Xm&&++t;return t},empty:function(){for(var t in this)if(t[0]===Xm)return!1;return!0},each:function(t){for(var e in this)e[0]===Xm&&t(this[e],e.slice(1),this)}};const Km=qm;function Qm(){}var Jm=Km.prototype;Qm.prototype=function(t,e){var n=new Qm;if(t instanceof Qm)t.each((function(t){n.add(t)}));else if(t){var r=-1,i=t.length;if(null==e)for(;++r<i;)n.add(t[r]);else for(;++r<i;)n.add(e(t[r],r,t))}return n}.prototype={constructor:Qm,has:Jm.has,add:function(t){return this[Xm+(t+="")]=t,this},remove:Jm.remove,clear:Jm.clear,values:Jm.keys,size:Jm.size,empty:Jm.empty,each:Jm.each};var $m=Array.prototype,ty=$m.map,ey=$m.slice;function ny(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}var ry={name:"implicit"};function iy(){var t=Km(),e=[],n=[],r=ry;function i(i){var o=i+"",a=t.get(o);if(!a){if(r!==ry)return r;t.set(o,a=e.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();e=[],t=Km();for(var r,o,a=-1,s=n.length;++a<s;)t.has(o=(r=n[a])+"")||t.set(o,e.push(r));return i},i.range=function(t){return arguments.length?(n=ey.call(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return iy(e,n).unknown(r)},ny.apply(i,arguments),i}var oy=n(6257),ay=n(3626);function sy(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function uy(t){return+t}var ly=[0,1];function cy(t){return t}function hy(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function fy(t){var e,n=t[0],r=t[t.length-1];return n>r&&(e=n,n=r,r=e),function(t){return Math.max(n,Math.min(r,t))}}function py(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=hy(i,r),o=n(a,o)):(r=hy(r,i),o=n(o,a)),function(t){return o(r(t))}}function dy(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=hy(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(e){var n=Bm(t,e,1,r)-1;return o[n](i[n](e))}}function gy(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function vy(){var t,e,n,r,i,o,a=ly,s=ly,u=oy.Z,l=cy;function c(){return r=Math.min(a.length,s.length)>2?dy:py,i=o=null,h}function h(e){return isNaN(e=+e)?n:(i||(i=r(a.map(t),s,u)))(t(l(e)))}return h.invert=function(n){return l(e((o||(o=r(s,a.map(t),ay.Z)))(n)))},h.domain=function(t){return arguments.length?(a=ty.call(t,uy),l===cy||(l=fy(a)),c()):a.slice()},h.range=function(t){return arguments.length?(s=ey.call(t),c()):s.slice()},h.rangeRound=function(t){return s=ey.call(t),u=sy,c()},h.clamp=function(t){return arguments.length?(l=t?fy(a):cy,h):l!==cy},h.interpolate=function(t){return arguments.length?(u=t,c()):u},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,r){return t=n,e=r,c()}}function yy(t,e){return vy()(t,e)}var _y,by=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function xy(t){if(!(e=by.exec(t)))throw new Error("invalid format: "+t);var e;return new wy({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function wy(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Ey(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Sy(t){return(t=Ey(Math.abs(t)))?t[1]:NaN}function Cy(t,e){var n=Ey(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}xy.prototype=wy.prototype,wy.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Ay={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return Cy(100*t,e)},r:Cy,s:function(t,e){var n=Ey(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(_y=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Ey(t,Math.max(0,e+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function Ty(t){return t}var ky,My,Py,Iy=Array.prototype.map,Oy=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Ry(t){var e=t.domain;return t.ticks=function(t){var n=e();return Um(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return function(t,e,n,r){var i,o=Vm(t,e,n);switch((r=xy(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Sy(e)/3)))-Sy(Math.abs(t)))}(o,a))||(r.precision=i),Py(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Sy(e)-Sy(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(t){return Math.max(0,-Sy(Math.abs(t)))}(o))||(r.precision=i-2*("%"===r.type))}return My(r)}(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i=e(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),(r=Gm(s,u,n))>0?r=Gm(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=Gm(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,e(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,e(i)),t},t}function Ly(t,e){var n,r=0,i=(t=t.slice()).length-1,o=t[r],a=t[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t}function Dy(t){return Math.log(t)}function Ny(t){return Math.exp(t)}function By(t){return-Math.log(-t)}function zy(t){return-Math.exp(-t)}function Fy(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Zy(t){return function(e){return-t(-e)}}function jy(t){var e,n,r=t(Dy,Ny),i=r.domain,o=10;function a(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(o),n=function(t){return 10===t?Fy:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(o),i()[0]<0?(e=Zy(e),n=Zy(n),t(By,zy)):t(Dy,Ny),r}return r.base=function(t){return arguments.length?(o=+t,a()):o},r.domain=function(t){return arguments.length?(i(t),a()):i()},r.ticks=function(t){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(f=s,s=u,u=f);var l,c,h,f=e(s),p=e(u),d=null==t?10:+t,g=[];if(!(o%1)&&p-f<d){if(f=Math.round(f)-1,p=Math.round(p)+1,s>0){for(;f<p;++f)for(c=1,l=n(f);c<o;++c)if(!((h=l*c)<s)){if(h>u)break;g.push(h)}}else for(;f<p;++f)for(c=o-1,l=n(f);c>=1;--c)if(!((h=l*c)<s)){if(h>u)break;g.push(h)}}else g=Um(f,p,Math.min(p-f,d)).map(n);return r?g.reverse():g},r.tickFormat=function(t,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=My(i)),t===1/0)return i;null==t&&(t=10);var a=Math.max(1,o*t/r.ticks().length);return function(t){var r=t/n(Math.round(e(t)));return r*o<o-.5&&(r*=o),r<=a?i(t):""}},r.nice=function(){return i(Ly(i(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},r}function Uy(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function Gy(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function Vy(t){return t<0?-t*t:t*t}function Wy(t){var e=t(cy,cy),n=1;function r(){return 1===n?t(cy,cy):.5===n?t(Gy,Vy):t(Uy(n),Uy(1/n))}return e.exponent=function(t){return arguments.length?(n=+t,r()):n},Ry(e)}ky=function(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?Ty:(e=Iy.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(t.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?Ty:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(Iy.call(t.numerals,String)),u=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"-":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=xy(t)).fill,n=t.align,h=t.sign,f=t.symbol,p=t.zero,d=t.width,g=t.comma,v=t.precision,m=t.trim,y=t.type;"n"===y?(g=!0,y="g"):Ay[y]||(void 0===v&&(v=12),m=!0,y="g"),(p||"0"===e&&"="===n)&&(p=!0,e="0",n="=");var _="$"===f?i:"#"===f&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",b="$"===f?o:/[%p]/.test(y)?u:"",x=Ay[y],w=/[defgprs%]/.test(y);function E(t){var i,o,u,f=_,E=b;if("c"===y)E=x(t)+E,t="";else{var S=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:x(Math.abs(t),v),m&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),S&&0==+t&&"+"!==h&&(S=!1),f=(S?"("===h?h:l:"-"===h||"("===h?"":h)+f,E=("s"===y?Oy[8+_y/3]:"")+E+(S&&"("===h?")":""),w)for(i=-1,o=t.length;++i<o;)if(48>(u=t.charCodeAt(i))||u>57){E=(46===u?a+t.slice(i+1):t.slice(i))+E,t=t.slice(0,i);break}}g&&!p&&(t=r(t,1/0));var C=f.length+t.length+E.length,A=C<d?new Array(d-C+1).join(e):"";switch(g&&p&&(t=r(A+t,A.length?d-E.length:1/0),A=""),n){case"<":t=f+t+E+A;break;case"=":t=f+A+t+E;break;case"^":t=A.slice(0,C=A.length>>1)+f+t+E+A.slice(C);break;default:t=A+f+t+E}return s(t)}return v=void 0===v?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v)),E.toString=function(){return t+""},E}return{format:h,formatPrefix:function(t,e){var n=h(((t=xy(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Sy(e)/3))),i=Math.pow(10,-r),o=Oy[8+r/3];return function(t){return n(i*t)+o}}}}({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),My=ky.format,Py=ky.formatPrefix;var Hy=new Date,Xy=new Date;function Yy(t,e,n,r){function i(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return i.floor=function(e){return t(e=new Date(+e)),e},i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),e(n,o),t(n)}while(a<n&&n<r);return s},i.filter=function(n){return Yy((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,r){if(t>=t)if(r<0)for(;++r<=0;)for(;e(t,-1),!n(t););else for(;--r>=0;)for(;e(t,1),!n(t););}))},n&&(i.count=function(e,r){return Hy.setTime(+e),Xy.setTime(+r),t(Hy),t(Xy),Math.floor(n(Hy,Xy))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var qy=Yy((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));qy.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Yy((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};const Ky=qy;qy.range;var Qy=Yy((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()}));const Jy=Qy;Qy.range;var $y=1e3,t_=6e4,e_=36e5,n_=864e5,r_=6048e5;function i_(t){return Yy((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*t_)/r_}))}var o_=i_(0),a_=i_(1),s_=i_(2),u_=i_(3),l_=i_(4),c_=i_(5),h_=i_(6),f_=(o_.range,a_.range,s_.range,u_.range,l_.range,c_.range,h_.range,Yy((function(t){t.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*t_)/n_}),(function(t){return t.getDate()-1})));const p_=f_;f_.range;var d_=Yy((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*$y-t.getMinutes()*t_)}),(function(t,e){t.setTime(+t+e*e_)}),(function(t,e){return(e-t)/e_}),(function(t){return t.getHours()}));const g_=d_;d_.range;var v_=Yy((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*$y)}),(function(t,e){t.setTime(+t+e*t_)}),(function(t,e){return(e-t)/t_}),(function(t){return t.getMinutes()}));const m_=v_;v_.range;var y_=Yy((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+e*$y)}),(function(t,e){return(e-t)/$y}),(function(t){return t.getUTCSeconds()}));const __=y_;y_.range;var b_=Yy((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));b_.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?Yy((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):b_:null};const x_=b_;function w_(t){return Yy((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/r_}))}b_.range;var E_=w_(0),S_=w_(1),C_=w_(2),A_=w_(3),T_=w_(4),k_=w_(5),M_=w_(6),P_=(E_.range,S_.range,C_.range,A_.range,T_.range,k_.range,M_.range,Yy((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/n_}),(function(t){return t.getUTCDate()-1})));const I_=P_;P_.range;var O_=Yy((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));O_.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Yy((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};const R_=O_;function L_(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function D_(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function N_(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}O_.range;var B_,z_,F_={"-":"",_:" ",0:"0"},Z_=/^\s*\d+/,j_=/^%/,U_=/[\\^$*+?|[\]().{}]/g;function G_(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function V_(t){return t.replace(U_,"\\$&")}function W_(t){return new RegExp("^(?:"+t.map(V_).join("|")+")","i")}function H_(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function X_(t,e,n){var r=Z_.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function Y_(t,e,n){var r=Z_.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function q_(t,e,n){var r=Z_.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function K_(t,e,n){var r=Z_.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function Q_(t,e,n){var r=Z_.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function J_(t,e,n){var r=Z_.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function $_(t,e,n){var r=Z_.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function tb(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function eb(t,e,n){var r=Z_.exec(e.slice(n,n+1));return r?(t.q=3*r[0]-3,n+r[0].length):-1}function nb(t,e,n){var r=Z_.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function rb(t,e,n){var r=Z_.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function ib(t,e,n){var r=Z_.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function ob(t,e,n){var r=Z_.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function ab(t,e,n){var r=Z_.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function sb(t,e,n){var r=Z_.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function ub(t,e,n){var r=Z_.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function lb(t,e,n){var r=Z_.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function cb(t,e,n){var r=j_.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function hb(t,e,n){var r=Z_.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function fb(t,e,n){var r=Z_.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function pb(t,e){return G_(t.getDate(),e,2)}function db(t,e){return G_(t.getHours(),e,2)}function gb(t,e){return G_(t.getHours()%12||12,e,2)}function vb(t,e){return G_(1+p_.count(Ky(t),t),e,3)}function mb(t,e){return G_(t.getMilliseconds(),e,3)}function yb(t,e){return mb(t,e)+"000"}function _b(t,e){return G_(t.getMonth()+1,e,2)}function bb(t,e){return G_(t.getMinutes(),e,2)}function xb(t,e){return G_(t.getSeconds(),e,2)}function wb(t){var e=t.getDay();return 0===e?7:e}function Eb(t,e){return G_(o_.count(Ky(t)-1,t),e,2)}function Sb(t){var e=t.getDay();return e>=4||0===e?l_(t):l_.ceil(t)}function Cb(t,e){return t=Sb(t),G_(l_.count(Ky(t),t)+(4===Ky(t).getDay()),e,2)}function Ab(t){return t.getDay()}function Tb(t,e){return G_(a_.count(Ky(t)-1,t),e,2)}function kb(t,e){return G_(t.getFullYear()%100,e,2)}function Mb(t,e){return G_((t=Sb(t)).getFullYear()%100,e,2)}function Pb(t,e){return G_(t.getFullYear()%1e4,e,4)}function Ib(t,e){var n=t.getDay();return G_((t=n>=4||0===n?l_(t):l_.ceil(t)).getFullYear()%1e4,e,4)}function Ob(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+G_(e/60|0,"0",2)+G_(e%60,"0",2)}function Rb(t,e){return G_(t.getUTCDate(),e,2)}function Lb(t,e){return G_(t.getUTCHours(),e,2)}function Db(t,e){return G_(t.getUTCHours()%12||12,e,2)}function Nb(t,e){return G_(1+I_.count(R_(t),t),e,3)}function Bb(t,e){return G_(t.getUTCMilliseconds(),e,3)}function zb(t,e){return Bb(t,e)+"000"}function Fb(t,e){return G_(t.getUTCMonth()+1,e,2)}function Zb(t,e){return G_(t.getUTCMinutes(),e,2)}function jb(t,e){return G_(t.getUTCSeconds(),e,2)}function Ub(t){var e=t.getUTCDay();return 0===e?7:e}function Gb(t,e){return G_(E_.count(R_(t)-1,t),e,2)}function Vb(t){var e=t.getUTCDay();return e>=4||0===e?T_(t):T_.ceil(t)}function Wb(t,e){return t=Vb(t),G_(T_.count(R_(t),t)+(4===R_(t).getUTCDay()),e,2)}function Hb(t){return t.getUTCDay()}function Xb(t,e){return G_(S_.count(R_(t)-1,t),e,2)}function Yb(t,e){return G_(t.getUTCFullYear()%100,e,2)}function qb(t,e){return G_((t=Vb(t)).getUTCFullYear()%100,e,2)}function Kb(t,e){return G_(t.getUTCFullYear()%1e4,e,4)}function Qb(t,e){var n=t.getUTCDay();return G_((t=n>=4||0===n?T_(t):T_.ceil(t)).getUTCFullYear()%1e4,e,4)}function Jb(){return"+0000"}function $b(){return"%"}function tx(t){return+t}function ex(t){return Math.floor(+t/1e3)}B_=function(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,s=t.months,u=t.shortMonths,l=W_(i),c=H_(i),h=W_(o),f=H_(o),p=W_(a),d=H_(a),g=W_(s),v=H_(s),m=W_(u),y=H_(u),_={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return u[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:pb,e:pb,f:yb,g:Mb,G:Ib,H:db,I:gb,j:vb,L:mb,m:_b,M:bb,p:function(t){return i[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:tx,s:ex,S:xb,u:wb,U:Eb,V:Cb,w:Ab,W:Tb,x:null,X:null,y:kb,Y:Pb,Z:Ob,"%":$b},b={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return u[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:Rb,e:Rb,f:zb,g:qb,G:Qb,H:Lb,I:Db,j:Nb,L:Bb,m:Fb,M:Zb,p:function(t){return i[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:tx,s:ex,S:jb,u:Ub,U:Gb,V:Wb,w:Hb,W:Xb,x:null,X:null,y:Yb,Y:Kb,Z:Jb,"%":$b},x={a:function(t,e,n){var r=p.exec(e.slice(n));return r?(t.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(t,e,n){var r=h.exec(e.slice(n));return r?(t.w=f[r[0].toLowerCase()],n+r[0].length):-1},b:function(t,e,n){var r=m.exec(e.slice(n));return r?(t.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(t,e,n){var r=g.exec(e.slice(n));return r?(t.m=v[r[0].toLowerCase()],n+r[0].length):-1},c:function(t,n,r){return S(t,e,n,r)},d:rb,e:rb,f:lb,g:$_,G:J_,H:ob,I:ob,j:ib,L:ub,m:nb,M:ab,p:function(t,e,n){var r=l.exec(e.slice(n));return r?(t.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:eb,Q:hb,s:fb,S:sb,u:Y_,U:q_,V:K_,w:X_,W:Q_,x:function(t,e,r){return S(t,n,e,r)},X:function(t,e,n){return S(t,r,e,n)},y:$_,Y:J_,Z:tb,"%":cb};function w(t,e){return function(n){var r,i,o,a=[],s=-1,u=0,l=t.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===t.charCodeAt(s)&&(a.push(t.slice(u,s)),null!=(i=F_[r=t.charAt(++s)])?r=t.charAt(++s):i="e"===r?" ":"0",(o=e[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(t.slice(u,s)),a.join("")}}function E(t,e){return function(n){var r,i,o=N_(1900,void 0,1);if(S(o,t,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(e&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=D_(N_(o.y,0,1))).getUTCDay(),r=i>4||0===i?S_.ceil(r):S_(r),r=I_.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=L_(N_(o.y,0,1))).getDay(),r=i>4||0===i?a_.ceil(r):a_(r),r=p_.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?D_(N_(o.y,0,1)).getUTCDay():L_(N_(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,D_(o)):L_(o)}}function S(t,e,n,r){for(var i,o,a=0,s=e.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=e.charCodeAt(a++))){if(i=e.charAt(a++),!(o=x[i in F_?e.charAt(a++):i])||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=w(n,_),_.X=w(r,_),_.c=w(e,_),b.x=w(n,b),b.X=w(r,b),b.c=w(e,b),{format:function(t){var e=w(t+="",_);return e.toString=function(){return t},e},parse:function(t){var e=E(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",b);return e.toString=function(){return t},e},utcParse:function(t){var e=E(t+="",!0);return e.toString=function(){return t},e}}}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),z_=B_.format,B_.parse,B_.utcFormat,B_.utcParse;var nx,rx,ix,ox,ax,sx,ux=31536e6;function lx(t){return new Date(t)}function cx(t){return t instanceof Date?+t:+new Date(+t)}function hx(t,e,n,r,i,o,a,s,u){var l=yy(cy,cy),c=l.invert,h=l.domain,f=u(".%L"),p=u(":%S"),d=u("%I:%M"),g=u("%I %p"),v=u("%a %d"),m=u("%b %d"),y=u("%B"),_=u("%Y"),b=[[a,1,1e3],[a,5,5e3],[a,15,15e3],[a,30,3e4],[o,1,6e4],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[e,1,2592e6],[e,3,7776e6],[t,1,ux]];function x(s){return(a(s)<s?f:o(s)<s?p:i(s)<s?d:r(s)<s?g:e(s)<s?n(s)<s?v:m:t(s)<s?y:_)(s)}function w(e,n,r,i){if(null==e&&(e=10),"number"==typeof e){var o=Math.abs(r-n)/e,a=Lm((function(t){return t[2]})).right(b,o);a===b.length?(i=Vm(n/ux,r/ux,e),e=t):a?(i=(a=b[o/b[a-1][2]<b[a][2]/o?a-1:a])[1],e=a[0]):(i=Math.max(Vm(n,r,e),1),e=s)}return null==i?e:e.every(i)}return l.invert=function(t){return new Date(c(t))},l.domain=function(t){return arguments.length?h(ty.call(t,cx)):h().map(lx)},l.ticks=function(t,e){var n,r=h(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=w(t,i,o,e))?n.range(i,o+1):[],a?n.reverse():n},l.tickFormat=function(t,e){return null==e?x:u(e)},l.nice=function(t,e){var n=h();return(t=w(t,n[0],n[n.length-1],e))?h(Ly(n,t)):l},l.copy=function(){return gy(l,hx(t,e,n,r,i,o,a,s,u))},l}var fx,px,dx,gx,vx,mx,yx,_x=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,bx=(nx={},(0,m.Z)(nx,gu.LINEAR,(function t(){var e=yy(cy,cy);return e.copy=function(){return gy(e,t())},ny.apply(e,arguments),Ry(e)})),(0,m.Z)(nx,gu.POWER,(function t(){var e=Wy(vy());return e.copy=function(){return gy(e,t()).exponent(e.exponent())},ny.apply(e,arguments),e})),(0,m.Z)(nx,gu.LOG,(function t(){var e=jy(vy()).domain([1,10]);return e.copy=function(){return gy(e,t()).base(e.base())},ny.apply(e,arguments),e})),(0,m.Z)(nx,gu.IDENTITY,(function t(e){var n;function r(t){return isNaN(t=+t)?n:t}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(e=ty.call(t,uy),r):e.slice()},r.unknown=function(t){return arguments.length?(n=t,r):n},r.copy=function(){return t(e).unknown(n)},e=arguments.length?ty.call(e,uy):[0,1],Ry(r)})),(0,m.Z)(nx,gu.TIME,(function(){return ny.apply(hx(Ky,Jy,o_,p_,g_,m_,__,x_,z_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),(0,m.Z)(nx,gu.QUANTILE,(function t(){var e,n=[],r=[],i=[];function o(){var t=0,e=Math.max(1,r.length);for(i=new Array(e-1);++t<e;)i[t-1]=Hm(n,t/e);return a}function a(t){return isNaN(t=+t)?e:r[Bm(i,t)]}return a.invertExtent=function(t){var e=r.indexOf(t);return e<0?[NaN,NaN]:[e>0?i[e-1]:n[0],e<i.length?i[e]:n[n.length-1]]},a.domain=function(t){if(!arguments.length)return n.slice();n=[];for(var e,r=0,i=t.length;r<i;++r)null==(e=t[r])||isNaN(e=+e)||n.push(e);return n.sort(Rm),o()},a.range=function(t){return arguments.length?(r=ey.call(t),o()):r.slice()},a.unknown=function(t){return arguments.length?(e=t,a):e},a.quantiles=function(){return i.slice()},a.copy=function(){return t().domain(n).range(r).unknown(e)},ny.apply(a,arguments)})),(0,m.Z)(nx,gu.QUANTIZE,(function t(){var e,n=0,r=1,i=1,o=[.5],a=[0,1];function s(t){return t<=t?a[Bm(o,t,0,i)]:e}function u(){var t=-1;for(o=new Array(i);++t<i;)o[t]=((t+1)*r-(t-i)*n)/(i+1);return s}return s.domain=function(t){return arguments.length?(n=+t[0],r=+t[1],u()):[n,r]},s.range=function(t){return arguments.length?(i=(a=ey.call(t)).length-1,u()):a.slice()},s.invertExtent=function(t){var e=a.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,o[0]]:e>=i?[o[i-1],r]:[o[e-1],o[e]]},s.unknown=function(t){return arguments.length?(e=t,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return t().domain([n,r]).range(a).unknown(e)},ny.apply(Ry(s),arguments)})),(0,m.Z)(nx,gu.THRESHOLD,(function t(){var e,n=[.5],r=[0,1],i=1;function o(t){return t<=t?r[Bm(n,t,0,i)]:e}return o.domain=function(t){return arguments.length?(n=ey.call(t),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(t){return arguments.length?(r=ey.call(t),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(t){var e=r.indexOf(t);return[n[e-1],n[e]]},o.unknown=function(t){return arguments.length?(e=t,o):e},o.copy=function(){return t().domain(n).range(r).unknown(e)},ny.apply(o,arguments)})),(0,m.Z)(nx,gu.CAT,iy),nx),xx=(rx=(0,Zr.b2)(),ix=(0,Zr.f3)(Ur.IGlobalConfigService),rx((ax=function(){function t(){(0,z.Z)(this,t),(0,Ti.Z)(this,"configService",sx,this),(0,m.Z)(this,"scaleCache",{}),(0,m.Z)(this,"scaleOptions",{})}return(0,F.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tap("FeatureScalePlugin",(function(){n.scaleOptions=t.getScaleOptions();var e=r.getLayerStyleAttributes(),i=t.getSource().data.dataArray;0!==i.length&&n.caculateScalesForAttributes(e||[],i)})),t.hooks.beforeRenderData.tap("FeatureScalePlugin",(function(){n.scaleOptions=t.getScaleOptions();var e=r.getLayerStyleAttributes(),i=t.getSource().data.dataArray;return n.caculateScalesForAttributes(e||[],i),t.layerModelNeedUpdate=!0,!0})),t.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!t.layerModelNeedUpdate){n.scaleOptions=t.getScaleOptions();var e=r.getLayerStyleAttributes();if(e){var i=t.getSource().data.dataArray;if(0===i.length)return;var o=e.filter((function(t){return t.needRescale}));o.length&&n.caculateScalesForAttributes(o,i)}}}))}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,e){var n=this;this.scaleCache={},t.forEach((function(t){if(t.scale){var r=t.scale,i=t.name;r.names=n.parseFields(t.scale.field||[]);var o=[];r.names.forEach((function(r){o.push(n.getOrCreateScale(r,t,e))})),o.some((function(t){return t.type===vu.VARIABLE}))?(r.type=vu.VARIABLE,o.forEach((function(t){var e;if(!r.callback)if(r.values&&"text"!==r.values){var n;if("linear"===(null===(n=t.option)||void 0===n?void 0:n.type)&&r.values.length>2){var o=t.scale.ticks(r.values.length);"color"===i&&t.scale.domain(o)}t.scale.range(r.values)}else"cat"===(null===(e=t.option)||void 0===e?void 0:e.type)&&t.scale.range(t.option.domain)}))):(r.type=vu.CONSTANT,r.defaultValues=o.map((function(t,e){return t.scale(r.names[e])}))),r.scalers=o.map((function(t){return{field:t.field,func:t.scale,option:t.option}})),t.needRescale=!1}}))}},{key:"getOrCreateScale",value:function(t,e,n){[t,e.name].join("_");var r,i=null===(r=e.scale)||void 0===r?void 0:r.values;return this.createScale(t,e.name,i,n)}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:Ln()(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,e,n,r){var i,o,a=this.scaleOptions[e]&&(null===(i=this.scaleOptions[e])||void 0===i?void 0:i.field)===t?this.scaleOptions[e]:this.scaleOptions[t],s={field:t,scale:void 0,type:vu.VARIABLE,option:a};if(!r||!r.length)return a&&a.type?s.scale=this.createDefaultScale(a):(s.scale=iy([t]),s.type=vu.CONSTANT),s;var u=null===(o=r.find((function(e){return!Bo()(e[t])})))||void 0===o?void 0:o[t];if(this.isNumber(t)||Bo()(u)&&!a)s.scale=iy([t]),s.type=vu.CONSTANT;else{var l=a&&a.type||this.getDefaultType(u);"text"===n&&(l=gu.CAT);var c=this.createDefaultScaleConfig(l,t,r);Object.assign(c,a),s.scale=this.createDefaultScale(c),s.option=c}return s}},{key:"getDefaultType",value:function(t){var e=gu.LINEAR;return"string"==typeof t&&(e=_x.test(t)?gu.TIME:gu.CAT),e}},{key:"createDefaultScaleConfig",value:function(t,e,n){var r={type:t},i=(null==n?void 0:n.map((function(t){return t[e]})))||[];return t!==gu.CAT&&t!==gu.QUANTILE?r.domain=function(t,e){var n,r,i,o=t.length,a=-1;for(1;++a<o;)if(null!=(n=t[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=t[a])&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}(i):t===gu.CAT?r.domain=ka()(i):t===gu.QUANTILE&&(r.domain=i),r}},{key:"createDefaultScale",value:function(t){var e=t.type,n=t.domain,r=bx[e]();return n&&r.domain(n),r}}]),t}(),sx=(0,ki.Z)(ax.prototype,"configService",[ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ox=ax))||ox);function Ex(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var Sx,Cx,Ax,Tx=(fx=(0,Zr.b2)(),px=(0,Zr.f3)(Ur.ICameraService),dx=(0,Zr.f3)(Ur.IRendererService),fx((vx=function(){function t(){(0,z.Z)(this,t),(0,Ti.Z)(this,"cameraService",mx,this),(0,Ti.Z)(this,"rendererService",yx,this)}return(0,F.Z)(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){t.models.forEach((function(e){e.addUniforms(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ex(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ex(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t.layerModel.getAnimateUniforms()))}))}))}}]),t}(),mx=(0,ki.Z)(vx.prototype,"cameraService",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yx=(0,ki.Z)(vx.prototype,"rendererService",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gx=vx))||gx),kx=(0,Zr.b2)()(Sx=function(){function t(){(0,z.Z)(this,t)}return(0,F.Z)(t,[{key:"apply",value:function(t){t.hooks.init.tap("LayerModelPlugin",(function(){t.prepareBuildModel(),t.buildModels(),t.styleNeedUpdate=!1})),t.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){return t.prepareBuildModel(),t.clearModels(),t.buildModels(),t.layerModelNeedUpdate=!1,!1}))}}]),t}())||Sx,Mx=(0,Zr.b2)()(Cx=function(){function t(){(0,z.Z)(this,t)}return(0,F.Z)(t,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",(function(){t.updateLayerConfig({});var e=t.getLayerConfig(),n=e.autoFit,r=e.fitBoundsOptions;n&&setTimeout((function(){t.fitBounds(r)}),100)}))}}]),t}())||Cx,Px=["type"];function Ix(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ox(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ix(Object(n),!0).forEach((function(e){(0,m.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ix(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Rx,Lx,Dx,Nx,Bx,zx,Fx,Zx,jx,Ux,Gx,Vx,Wx,Hx,Xx,Yx={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},qx={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Kx={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Qx={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},Jx=(0,Zr.b2)()(Ax=function(){function t(){(0,z.Z)(this,t)}return(0,F.Z)(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",(function(){t.getLayerConfig().enableLighting&&t.models.forEach((function(t){return t.addUniforms(Ox({},(n={u_DirectionalLights:new Array(3).fill(Ox({},Kx)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Ox({},Qx)),u_NumOfSpotLights:0},e&&e.length||(e=[qx]),e.forEach((function(t,e){var r=t.type,i=void 0===r?"directional":r,o=Mo(t,Px),a=Yx[i].lights,s=Yx[i].num,u=n[s];n[a][u]=Ox(Ox({},n[a][u]),o),n[s]++})),n)));var e,n}))}))}}]),t}())||Ax,$x=(0,Zr.b2)()(Rx=function(){function t(){(0,z.Z)(this,t)}return(0,F.Z)(t,[{key:"apply",value:function(t,e){e.rendererService;var n=e.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",(function(){var e=t.getLayerConfig().enablePicking;n.registerStyleAttribute({name:"pickingColor",type:mu.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:qi.FLOAT},size:3,update:function(t,n){var r=t.id;return e?_n(r):[0,0,0]}}})})),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(t){return t.addUniforms({u_PickingStage:1})}))})),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(t){return t.addUniforms({u_PickingStage:2})}))})),t.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.highlightColor,i=n.activeMix,o=void 0===i?0:i,a="string"==typeof r?mn(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:yn(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:2,u_PickingColor:e,u_HighlightColor:a.map((function(t){return 255*t})),u_activeMix:o})}))})),t.hooks.beforeSelect.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.selectColor,i=n.selectMix,o=void 0===i?0:i,a="string"==typeof r?mn(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:yn(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:2,u_PickingColor:e,u_HighlightColor:a.map((function(t){return 255*t})),u_activeMix:o})}))}))}}]),t}())||Rx,tw=(0,Zr.b2)()(Lx=function(){function t(){(0,z.Z)(this,t)}return(0,F.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tap("RegisterStyleAttributePlugin",(function(){n.registerBuiltinAttributes(r)}))}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:mu.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:qi.FLOAT},size:3,update:function(t,e,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}}),t.registerStyleAttribute({name:"filter",type:mu.Attribute,descriptor:{name:"filter",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e){return t.filter?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:mu.Attribute,descriptor:{name:"a_Color",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:4,update:function(t,e){var n=t.color;return n&&n.length?n:[1,1,1,1]}}}),t.registerStyleAttribute({name:"vertexId",type:mu.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:qi.DYNAMIC_DRAW,data:[],type:qi.FLOAT},size:1,update:function(t,e,n,r){return[e]}}})}}]),t}())||Lx,ew=(Dx=(0,Zr.b2)(),Nx=(0,Zr.f3)(Ur.ICameraService),Bx=(0,Zr.f3)(Ur.ICoordinateSystemService),zx=(0,Zr.f3)(Ur.IRendererService),Fx=(0,Zr.f3)(Ur.IMapService),Dx((jx=function(){function t(){(0,z.Z)(this,t),(0,Ti.Z)(this,"cameraService",Ux,this),(0,Ti.Z)(this,"coordinateSystemService",Gx,this),(0,Ti.Z)(this,"rendererService",Vx,this),(0,Ti.Z)(this,"mapService",Wx,this)}return(0,F.Z)(t,[{key:"apply",value:function(t){var e=this,n=this.mapService.version,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){e.coordinateSystemService.refresh(),"GAODE2.x"===n&&(r=e.mapService.map.customCoords.getMVPMatrix(),i=e.mapService.getCustomCoordCenter());var o=e.rendererService.getViewportSize(),a=o.width,s=o.height;t.models.forEach((function(n){var o;n.addUniforms((o={},(0,m.Z)(o,wu.ProjectionMatrix,e.cameraService.getProjectionMatrix()),(0,m.Z)(o,wu.ViewMatrix,e.cameraService.getViewMatrix()),(0,m.Z)(o,wu.ViewProjectionMatrix,e.cameraService.getViewProjectionMatrix()),(0,m.Z)(o,wu.Zoom,e.cameraService.getZoom()),(0,m.Z)(o,wu.ZoomScale,e.cameraService.getZoomScale()),(0,m.Z)(o,wu.FocalDistance,e.cameraService.getFocalDistance()),(0,m.Z)(o,wu.CameraPosition,e.cameraService.getCameraPosition()),(0,m.Z)(o,Vi.CoordinateSystem,e.coordinateSystemService.getCoordinateSystem()),(0,m.Z)(o,Vi.ViewportCenter,e.coordinateSystemService.getViewportCenter()),(0,m.Z)(o,Vi.ViewportCenterProjection,e.coordinateSystemService.getViewportCenterProjection()),(0,m.Z)(o,Vi.PixelsPerDegree,e.coordinateSystemService.getPixelsPerDegree()),(0,m.Z)(o,Vi.PixelsPerDegree2,e.coordinateSystemService.getPixelsPerDegree2()),(0,m.Z)(o,Vi.PixelsPerMeter,e.coordinateSystemService.getPixelsPerMeter()),(0,m.Z)(o,Vi.Mvp,r),(0,m.Z)(o,"u_SceneCenterMKT",i),(0,m.Z)(o,"u_ViewportSize",[a,s]),(0,m.Z)(o,"u_ModelMatrix",e.cameraService.getModelMatrix()),(0,m.Z)(o,"u_DevicePixelRatio",ye.devicePixelRatio),(0,m.Z)(o,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,m.Z)(o,"u_shaderPick",Number(t.getShaderPickStat())),o))}))}))}}]),t}(),Ux=(0,ki.Z)(jx.prototype,"cameraService",[Nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gx=(0,ki.Z)(jx.prototype,"coordinateSystemService",[Bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vx=(0,ki.Z)(jx.prototype,"rendererService",[zx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wx=(0,ki.Z)(jx.prototype,"mapService",[Fx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zx=jx))||Zx),nw=(0,Zr.b2)()(Hx=function(){function t(){(0,z.Z)(this,t)}return(0,F.Z)(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",(function(){t.layerModel&&t.layerModel.needUpdate()}))}}]),t}())||Hx,rw=(0,Zr.b2)()(Xx=function(){function t(){(0,z.Z)(this,t)}return(0,F.Z)(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tap("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(t,{styleAttributeService:r})})),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){t.layerModelNeedUpdate||n.updateStyleAtrribute(t,{styleAttributeService:r})}))}},{key:"updateStyleAtrribute",value:function(t,e){var n=e.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");if(n.getLayerStyleAttribute("shape"),i&&i.needRegenerateVertices)return t.layerModelNeedUpdate=!0,void r.forEach((function(t){return t.needRegenerateVertices=!1}));r.filter((function(t){return t.needRegenerateVertices})).forEach((function(e){n.updateAttributeByFeatureRange(e.name,t.getEncodedData(),e.featureRange.startIndex,e.featureRange.endIndex),e.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(t,e){var n=e.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter((function(t){return t.needRegenerateVertices})).forEach((function(e){n.updateAttributeByFeatureRange(e.name,t.getEncodedData(),e.featureRange.startIndex,e.featureRange.endIndex),e.needRegenerateVertices=!1}))}}]),t}())||Xx;au.bind(Ur.ILayerPlugin).to(Om).inRequestScope(),au.bind(Ur.ILayerPlugin).to(tw).inRequestScope(),au.bind(Ur.ILayerPlugin).to(xx).inRequestScope(),au.bind(Ur.ILayerPlugin).to(Im).inRequestScope(),au.bind(Ur.ILayerPlugin).to(Mx).inRequestScope(),au.bind(Ur.ILayerPlugin).to(rw).inRequestScope(),au.bind(Ur.ILayerPlugin).to(nw).inRequestScope(),au.bind(Ur.ILayerPlugin).to(Ad).inRequestScope(),au.bind(Ur.ILayerPlugin).to(ew).inRequestScope(),au.bind(Ur.ILayerPlugin).to(Tx).inRequestScope(),au.bind(Ur.ILayerPlugin).to(Jx).inRequestScope(),au.bind(Ur.ILayerPlugin).to($x).inRequestScope(),au.bind(Ur.ILayerPlugin).to(kx).inRequestScope();var iw="2.6.33"},9242:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Cache:()=>Ae,assign:()=>Ht,augment:()=>Xt,clamp:()=>et,clearAnimationFrame:()=>Vt,clone:()=>qt,contains:()=>i,debounce:()=>Kt,deepMix:()=>$t,difference:()=>a,each:()=>p,endsWith:()=>G,every:()=>V,extend:()=>te,filter:()=>o,find:()=>y,findIndex:()=>_,firstValue:()=>b,fixedBase:()=>nt,flatten:()=>x,flattenDeep:()=>E,forIn:()=>_t,get:()=>ce,getEllipsisText:()=>Ce,getRange:()=>A,getType:()=>It,getWrapBehavior:()=>K,group:()=>q,groupBy:()=>X,groupToMap:()=>Y,has:()=>bt,hasKey:()=>xt,hasValue:()=>Et,head:()=>Z,identity:()=>be,includes:()=>i,indexOf:()=>ee,isArguments:()=>Ot,isArray:()=>h,isArrayLike:()=>r,isBoolean:()=>Rt,isDate:()=>Lt,isDecimal:()=>it,isElement:()=>Ut,isEmpty:()=>re,isEqual:()=>oe,isEqualWith:()=>ae,isError:()=>Dt,isEven:()=>ot,isFinite:()=>Nt,isFunction:()=>l,isInteger:()=>at,isMatch:()=>g,isNegative:()=>st,isNil:()=>c,isNull:()=>Bt,isNumber:()=>rt,isNumberEqual:()=>ut,isObject:()=>f,isObjectLike:()=>v,isOdd:()=>lt,isPlainObject:()=>m,isPositive:()=>ct,isPrototype:()=>Ft,isRegExp:()=>Zt,isString:()=>D,isType:()=>u,isUndefined:()=>jt,keys:()=>d,last:()=>j,lowerCase:()=>Ct,lowerFirst:()=>At,map:()=>se,mapValues:()=>le,max:()=>S,maxBy:()=>ht,measureTextWidth:()=>Se,memoize:()=>Qt,min:()=>C,minBy:()=>ft,mix:()=>Ht,mod:()=>pt,noop:()=>_e,number2color:()=>$,omit:()=>de,parseRadius:()=>tt,pick:()=>pe,pull:()=>P,pullAt:()=>O,reduce:()=>R,remove:()=>L,requestAnimationFrame:()=>Gt,set:()=>he,size:()=>xe,some:()=>W,sortBy:()=>N,startsWith:()=>U,substitute:()=>Tt,throttle:()=>ge,toArray:()=>ve,toDegree:()=>gt,toInteger:()=>vt,toRadian:()=>yt,toString:()=>St,union:()=>z,uniq:()=>B,uniqueId:()=>ye,upperCase:()=>kt,upperFirst:()=>Mt,values:()=>wt,valuesOfKey:()=>F,wrapBehavior:()=>Q});const r=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},i=function(t,e){return!!r(t)&&t.indexOf(e)>-1},o=function(t,e){if(!r(t))return t;for(var n=[],i=0;i<t.length;i++){var o=t[i];e(o,i)&&n.push(o)}return n},a=function(t,e){return void 0===e&&(e=[]),o(t,(function(t){return!i(e,t)}))};var s={}.toString;const u=function(t,e){return s.call(t)==="[object "+e+"]"},l=function(t){return u(t,"Function")},c=function(t){return null==t},h=function(t){return Array.isArray?Array.isArray(t):u(t,"Array")},f=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e},p=function(t,e){if(t)if(h(t))for(var n=0,r=t.length;n<r&&!1!==e(t[n],n);n++);else if(f(t))for(var i in t)if(t.hasOwnProperty(i)&&!1===e(t[i],i))break},d=Object.keys?function(t){return Object.keys(t)}:function(t){var e=[];return p(t,(function(n,r){l(t)&&"prototype"===r||e.push(r)})),e},g=function(t,e){var n=d(e),r=n.length;if(c(t))return!r;for(var i=0;i<r;i+=1){var o=n[i];if(e[o]!==t[o]||!(o in t))return!1}return!0},v=function(t){return"object"==typeof t&&null!==t},m=function(t){if(!v(t)||!u(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},y=function(t,e){if(!h(t))return null;var n;if(l(e)&&(n=e),m(e)&&(n=function(t){return g(t,e)}),n)for(var r=0;r<t.length;r+=1)if(n(t[r]))return t[r];return null},_=function(t,e,n){void 0===n&&(n=0);for(var r=n;r<t.length;r++)if(e(t[r],r))return r;return-1},b=function(t,e){for(var n=null,r=0;r<t.length;r++){var i=t[r][e];if(!c(i)){n=h(i)?i[0]:i;break}}return n},x=function(t){if(!h(t))return[];for(var e=[],n=0;n<t.length;n++)e=e.concat(t[n]);return e};var w=function(t,e){if(void 0===e&&(e=[]),h(t))for(var n=0;n<t.length;n+=1)w(t[n],e);else e.push(t);return e};const E=w,S=function(t){if(h(t))return t.reduce((function(t,e){return Math.max(t,e)}),t[0])},C=function(t){if(h(t))return t.reduce((function(t,e){return Math.min(t,e)}),t[0])},A=function(t){var e=t.filter((function(t){return!isNaN(t)}));if(!e.length)return{min:0,max:0};if(h(t[0])){for(var n=[],r=0;r<t.length;r++)n=n.concat(t[r]);e=n}var i=S(e);return{min:C(e),max:i}};var T=Array.prototype,k=T.splice,M=T.indexOf;const P=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r++)for(var i=e[r],o=-1;(o=M.call(t,i))>-1;)k.call(t,o,1);return t};var I=Array.prototype.splice;const O=function(t,e){if(!r(t))return[];for(var n=t?e.length:0,i=n-1;n--;){var o=void 0,a=e[n];n!==i&&a===o||(o=a,I.call(t,a,1))}return t},R=function(t,e,n){if(!h(t)&&!m(t))return t;var r=n;return p(t,(function(t,n){r=e(r,t,n)})),r},L=function(t,e){var n=[];if(!r(t))return n;for(var i=-1,o=[],a=t.length;++i<a;){var s=t[i];e(s,i,t)&&(n.push(s),o.push(i))}return O(t,o),n},D=function(t){return u(t,"String")},N=function(t,e){var n;if(l(e))n=function(t,n){return e(t)-e(n)};else{var r=[];D(e)?r.push(e):h(e)&&(r=e),n=function(t,e){for(var n=0;n<r.length;n+=1){var i=r[n];if(t[i]>e[i])return 1;if(t[i]<e[i])return-1}return 0}}return t.sort(n),t};function B(t,e){void 0===e&&(e=new Map);var n=[];if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++){var o=t[r];e.has(o)||(n.push(o),e.set(o,!0))}return n}const z=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return B([].concat.apply([],t))},F=function(t,e){for(var n=[],r={},i=0;i<t.length;i++){var o=t[i][e];if(!c(o)){h(o)||(o=[o]);for(var a=0;a<o.length;a++){var s=o[a];r[s]||(n.push(s),r[s]=!0)}}}return n};function Z(t){if(r(t))return t[0]}function j(t){if(r(t))return t[t.length-1]}const U=function(t,e){return!(!h(t)&&!D(t))&&t[0]===e},G=function(t,e){return!(!h(t)&&!D(t))&&t[t.length-1]===e},V=function(t,e){for(var n=0;n<t.length;n++)if(!e(t[n],n))return!1;return!0},W=function(t,e){for(var n=0;n<t.length;n++)if(e(t[n],n))return!0;return!1};var H=Object.prototype.hasOwnProperty;const X=function(t,e){if(!e||!h(t))return{};for(var n,r={},i=l(e)?e:function(t){return t[e]},o=0;o<t.length;o++){var a=t[o];n=i(a),H.call(r,n)?r[n].push(a):r[n]=[a]}return r};function Y(t,e){if(!e)return{0:t};if(!l(e)){var n=h(e)?e:e.replace(/\s+/g,"").split("*");e=function(t){for(var e="_",r=0,i=n.length;r<i;r++)e+=t[n[r]]&&t[n[r]].toString();return e}}return X(t,e)}const q=function(t,e){if(!e)return[t];var n=Y(t,e),r=[];for(var i in n)r.push(n[i]);return r},K=function(t,e){return t["_wrap_"+e]},Q=function(t,e){if(t["_wrap_"+e])return t["_wrap_"+e];var n=function(n){t[e](n)};return t["_wrap_"+e]=n,n};var J={};const $=function(t){var e=J[t];if(!e){for(var n=t.toString(16),r=n.length;r<6;r++)n="0"+n;e="#"+n,J[t]=e}return e},tt=function(t){var e=0,n=0,r=0,i=0;return h(t)?1===t.length?e=n=r=i=t[0]:2===t.length?(e=r=t[0],n=i=t[1]):3===t.length?(e=t[0],n=i=t[1],r=t[2]):(e=t[0],n=t[1],r=t[2],i=t[3]):e=n=r=i=t,{r1:e,r2:n,r3:r,r4:i}},et=function(t,e,n){return t<e?e:t>n?n:t},nt=function(t,e){var n=e.toString(),r=n.indexOf(".");if(-1===r)return Math.round(t);var i=n.substr(r+1).length;return i>20&&(i=20),parseFloat(t.toFixed(i))},rt=function(t){return u(t,"Number")},it=function(t){return rt(t)&&t%1!=0},ot=function(t){return rt(t)&&t%2==0},at=Number.isInteger?Number.isInteger:function(t){return rt(t)&&t%1==0},st=function(t){return rt(t)&&t<0};function ut(t,e,n){return void 0===n&&(n=1e-5),Math.abs(t-e)<n}const lt=function(t){return rt(t)&&t%2!=0},ct=function(t){return rt(t)&&t>0},ht=function(t,e){if(h(t)){for(var n,r=-1/0,i=0;i<t.length;i++){var o=t[i],a=l(e)?e(o):o[e];a>r&&(n=o,r=a)}return n}},ft=function(t,e){if(h(t)){for(var n,r=1/0,i=0;i<t.length;i++){var o=t[i],a=l(e)?e(o):o[e];a<r&&(n=o,r=a)}return n}},pt=function(t,e){return(t%e+e)%e};var dt=180/Math.PI;const gt=function(t){return dt*t},vt=parseInt;var mt=Math.PI/180;const yt=function(t){return mt*t},_t=p,bt=function(t,e){return t.hasOwnProperty(e)},xt=bt,wt=Object.values?function(t){return Object.values(t)}:function(t){var e=[];return p(t,(function(n,r){l(t)&&"prototype"===r||e.push(n)})),e},Et=function(t,e){return i(wt(t),e)},St=function(t){return c(t)?"":t.toString()},Ct=function(t){return St(t).toLowerCase()},At=function(t){var e=St(t);return e.charAt(0).toLowerCase()+e.substring(1)},Tt=function(t,e){return t&&e?t.replace(/\\?\{([^{}]+)\}/g,(function(t,n){return"\\"===t.charAt(0)?t.slice(1):void 0===e[n]?"":e[n]})):t},kt=function(t){return St(t).toUpperCase()},Mt=function(t){var e=St(t);return e.charAt(0).toUpperCase()+e.substring(1)};var Pt={}.toString;const It=function(t){return Pt.call(t).replace(/^\[object /,"").replace(/]$/,"")},Ot=function(t){return u(t,"Arguments")},Rt=function(t){return u(t,"Boolean")},Lt=function(t){return u(t,"Date")},Dt=function(t){return u(t,"Error")};function Nt(t){return rt(t)&&isFinite(t)}const Bt=function(t){return null===t};var zt=Object.prototype;const Ft=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||zt)},Zt=function(t){return u(t,"RegExp")},jt=function(t){return void 0===t},Ut=function(t){return t instanceof Element||t instanceof HTMLDocument};function Gt(t){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,16)})(t)}function Vt(t){(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout)(t)}function Wt(t,e){for(var n in e)e.hasOwnProperty(n)&&"constructor"!==n&&void 0!==e[n]&&(t[n]=e[n])}function Ht(t,e,n,r){return e&&Wt(t,e),n&&Wt(t,n),r&&Wt(t,r),t}const Xt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=t[0],r=1;r<t.length;r++){var i=t[r];l(i)&&(i=i.prototype),Ht(n.prototype,i)}};var Yt=function(t){if("object"!=typeof t||null===t)return t;var e;if(h(t)){e=[];for(var n=0,r=t.length;n<r;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=Yt(t[n]):e[n]=t[n]}else for(var i in e={},t)"object"==typeof t[i]&&null!=t[i]?e[i]=Yt(t[i]):e[i]=t[i];return e};const qt=Yt,Kt=function(t,e,n){var r;return function(){var i=this,o=arguments,a=function(){r=null,n||t.apply(i,o)},s=n&&!r;clearTimeout(r),r=setTimeout(a,e),s&&t.apply(i,o)}},Qt=function(t,e){if(!l(t))throw new TypeError("Expected a function");var n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=e?e.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var s=t.apply(this,r);return a.set(o,s),s};return n.cache=new Map,n};function Jt(t,e,n,r){for(var i in n=n||0,r=r||5,e)if(e.hasOwnProperty(i)){var o=e[i];null!==o&&m(o)?(m(t[i])||(t[i]={}),n<r?Jt(t[i],o,n+1,r):t[i]=e[i]):h(o)?(t[i]=[],t[i]=t[i].concat(o)):void 0!==o&&(t[i]=o)}}const $t=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r+=1)Jt(t,e[r]);return t},te=function(t,e,n,r){l(e)||(n=e,e=t,t=function(){});var i=Object.create?function(t,e){return Object.create(t,{constructor:{value:e}})}:function(t,e){function n(){}n.prototype=t;var r=new n;return r.constructor=e,r},o=i(e.prototype,t);return t.prototype=Ht(o,t.prototype),t.superclass=i(e.prototype,e),Ht(o,n),Ht(t,r),t},ee=function(t,e){if(!r(t))return-1;var n=Array.prototype.indexOf;if(n)return n.call(t,e);for(var i=-1,o=0;o<t.length;o++)if(t[o]===e){i=o;break}return i};var ne=Object.prototype.hasOwnProperty;const re=function(t){if(c(t))return!0;if(r(t))return!t.length;var e=It(t);if("Map"===e||"Set"===e)return!t.size;if(Ft(t))return!Object.keys(t).length;for(var n in t)if(ne.call(t,n))return!1;return!0};var ie=function(t,e){if(t===e)return!0;if(!t||!e)return!1;if(D(t)||D(e))return!1;if(r(t)||r(e)){if(t.length!==e.length)return!1;for(var n=!0,i=0;i<t.length&&(n=ie(t[i],e[i]));i++);return n}if(v(t)||v(e)){var o=Object.keys(t),a=Object.keys(e);if(o.length!==a.length)return!1;for(n=!0,i=0;i<o.length&&(n=ie(t[o[i]],e[o[i]]));i++);return n}return!1};const oe=ie,ae=function(t,e,n){return l(n)?!!n(t,e):oe(t,e)},se=function(t,e){if(!r(t))return t;for(var n=[],i=0;i<t.length;i++){var o=t[i];n.push(e(o,i))}return n};var ue=function(t){return t};const le=function(t,e){void 0===e&&(e=ue);var n={};return f(t)&&!c(t)&&Object.keys(t).forEach((function(r){n[r]=e(t[r],r)})),n},ce=function(t,e,n){for(var r=0,i=D(e)?e.split("."):e;t&&r<i.length;)t=t[i[r++]];return void 0===t||r<i.length?n:t},he=function(t,e,n){var r=t,i=D(e)?e.split("."):e;return i.forEach((function(t,e){e<i.length-1?(f(r[t])||(r[t]=rt(i[e+1])?[]:{}),r=r[t]):r[t]=n})),t};var fe=Object.prototype.hasOwnProperty;const pe=function(t,e){if(null===t||!m(t))return{};var n={};return p(e,(function(e){fe.call(t,e)&&(n[e]=t[e])})),n},de=function(t,e){return R(t,(function(t,n,r){return e.includes(r)||(t[r]=n),t}),{})},ge=function(t,e,n){var r,i,o,a,s=0;n||(n={});var u=function(){s=!1===n.leading?0:Date.now(),r=null,a=t.apply(i,o),r||(i=o=null)},l=function(){var l=Date.now();s||!1!==n.leading||(s=l);var c=e-(l-s);return i=this,o=arguments,c<=0||c>e?(r&&(clearTimeout(r),r=null),s=l,a=t.apply(i,o),r||(i=o=null)):r||!1===n.trailing||(r=setTimeout(u,c)),a};return l.cancel=function(){clearTimeout(r),s=0,r=i=o=null},l},ve=function(t){return r(t)?Array.prototype.slice.call(t):[]};var me={};const ye=function(t){return me[t=t||"g"]?me[t]+=1:me[t]=1,t+me[t]},_e=function(){},be=function(t){return t};function xe(t){return c(t)?0:r(t)?t.length:Object.keys(t).length}var we,Ee=n(655);const Se=Qt((function(t,e){void 0===e&&(e={});var n=e.fontSize,r=e.fontFamily,i=e.fontWeight,o=e.fontStyle,a=e.fontVariant;return we||(we=document.createElement("canvas").getContext("2d")),we.font=[o,a,i,n+"px",r].join(" "),we.measureText(D(t)?t:"").width}),(function(t,e){return void 0===e&&(e={}),(0,Ee.__spreadArrays)([t],wt(e)).join("")})),Ce=function(t,e,n,r){void 0===r&&(r="...");var i,o,a=Se(r,n),s=D(t)?t:St(t),u=e,l=[];if(Se(t,n)<=e)return t;for(;i=s.substr(0,16),!((o=Se(i,n))+a>u&&o>u);)if(l.push(i),u-=o,!(s=s.substr(16)))return l.join("");for(;i=s.substr(0,1),!((o=Se(i,n))+a>u);)if(l.push(i),u-=o,!(s=s.substr(1)))return l.join("");return""+l.join("")+r},Ae=function(){function t(){this.map={}}return t.prototype.has=function(t){return void 0!==this.map[t]},t.prototype.get=function(t,e){var n=this.map[t];return void 0===n?e:n},t.prototype.set=function(t,e){this.map[t]=e},t.prototype.clear=function(){this.map={}},t.prototype.delete=function(t){delete this.map[t]},t.prototype.size=function(){return Object.keys(this.map).length},t}()},7757:(t,e,n)=>{t.exports=n(5666)},5788:(t,e,n)=>{var r=n(8579);t.exports={Graph:r.Graph,json:n(2485),alg:n(9100),version:r.version}},4774:(t,e,n)=>{var r=n(7163);t.exports=function(t){var e,n={},i=[];function o(i){r.has(n,i)||(n[i]=!0,e.push(i),r.each(t.successors(i),o),r.each(t.predecessors(i),o))}return r.each(t.nodes(),(function(t){e=[],o(t),e.length&&i.push(e)})),i}},7110:(t,e,n)=>{var r=n(7163);function i(t,e,n,o,a,s){r.has(o,e)||(o[e]=!0,n||s.push(e),r.each(a(e),(function(e){i(t,e,n,o,a,s)})),n&&s.push(e))}t.exports=function(t,e,n){r.isArray(e)||(e=[e]);var o=(t.isDirected()?t.successors:t.neighbors).bind(t),a=[],s={};return r.each(e,(function(e){if(!t.hasNode(e))throw new Error("Graph does not have node: "+e);i(t,e,"post"===n,s,o,a)})),a}},3897:(t,e,n)=>{var r=n(9205),i=n(7163);t.exports=function(t,e,n){return i.transform(t.nodes(),(function(i,o){i[o]=r(t,o,e,n)}),{})}},9205:(t,e,n)=>{var r=n(7163),i=n(6129);t.exports=function(t,e,n,r){return function(t,e,n,r){var o,a,s={},u=new i,l=function(t){var e=t.v!==o?t.v:t.w,r=s[e],i=n(t),l=a.distance+i;if(i<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+t+" Weight: "+i);l<r.distance&&(r.distance=l,r.predecessor=o,u.decrease(e,l))};for(t.nodes().forEach((function(t){var n=t===e?0:Number.POSITIVE_INFINITY;s[t]={distance:n},u.add(t,n)}));u.size()>0&&(o=u.removeMin(),(a=s[o]).distance!==Number.POSITIVE_INFINITY);)r(o).forEach(l);return s}(t,String(e),n||o,r||function(e){return t.outEdges(e)})};var o=r.constant(1)},2630:(t,e,n)=>{var r=n(7163),i=n(3070);t.exports=function(t){return r.filter(i(t),(function(e){return e.length>1||1===e.length&&t.hasEdge(e[0],e[0])}))}},3171:(t,e,n)=>{var r=n(7163);t.exports=function(t,e,n){return function(t,e,n){var r={},i=t.nodes();return i.forEach((function(t){r[t]={},r[t][t]={distance:0},i.forEach((function(e){t!==e&&(r[t][e]={distance:Number.POSITIVE_INFINITY})})),n(t).forEach((function(n){var i=n.v===t?n.w:n.v,o=e(n);r[t][i]={distance:o,predecessor:t}}))})),i.forEach((function(t){var e=r[t];i.forEach((function(n){var o=r[n];i.forEach((function(n){var r=o[t],i=e[n],a=o[n],s=r.distance+i.distance;s<a.distance&&(a.distance=s,a.predecessor=i.predecessor)}))}))})),r}(t,e||i,n||function(e){return t.outEdges(e)})};var i=r.constant(1)},9100:(t,e,n)=>{t.exports={components:n(4774),dijkstra:n(9205),dijkstraAll:n(3897),findCycles:n(2630),floydWarshall:n(3171),isAcyclic:n(8149),postorder:n(5979),preorder:n(5340),prim:n(4975),tarjan:n(3070),topsort:n(7034)}},8149:(t,e,n)=>{var r=n(7034);t.exports=function(t){try{r(t)}catch(t){if(t instanceof r.CycleException)return!1;throw t}return!0}},5979:(t,e,n)=>{var r=n(7110);t.exports=function(t,e){return r(t,e,"post")}},5340:(t,e,n)=>{var r=n(7110);t.exports=function(t,e){return r(t,e,"pre")}},4975:(t,e,n)=>{var r=n(7163),i=n(1053),o=n(6129);t.exports=function(t,e){var n,a=new i,s={},u=new o;function l(t){var r=t.v===n?t.w:t.v,i=u.priority(r);if(void 0!==i){var o=e(t);o<i&&(s[r]=n,u.decrease(r,o))}}if(0===t.nodeCount())return a;r.each(t.nodes(),(function(t){u.add(t,Number.POSITIVE_INFINITY),a.setNode(t)})),u.decrease(t.nodes()[0],0);for(var c=!1;u.size()>0;){if(n=u.removeMin(),r.has(s,n))a.setEdge(n,s[n]);else{if(c)throw new Error("Input graph is not connected: "+t);c=!0}t.nodeEdges(n).forEach(l)}return a}},3070:(t,e,n)=>{var r=n(7163);t.exports=function(t){var e=0,n=[],i={},o=[];function a(s){var u=i[s]={onStack:!0,lowlink:e,index:e++};if(n.push(s),t.successors(s).forEach((function(t){r.has(i,t)?i[t].onStack&&(u.lowlink=Math.min(u.lowlink,i[t].index)):(a(t),u.lowlink=Math.min(u.lowlink,i[t].lowlink))})),u.lowlink===u.index){var l,c=[];do{l=n.pop(),i[l].onStack=!1,c.push(l)}while(s!==l);o.push(c)}}return t.nodes().forEach((function(t){r.has(i,t)||a(t)})),o}},7034:(t,e,n)=>{var r=n(7163);function i(t){var e={},n={},i=[];if(r.each(t.sinks(),(function a(s){if(r.has(n,s))throw new o;r.has(e,s)||(n[s]=!0,e[s]=!0,r.each(t.predecessors(s),a),delete n[s],i.push(s))})),r.size(e)!==t.nodeCount())throw new o;return i}function o(){}t.exports=i,i.CycleException=o},6129:(t,e,n)=>{var r=n(7163);function i(){this._arr=[],this._keyIndices={}}t.exports=i,i.prototype.size=function(){return this._arr.length},i.prototype.keys=function(){return this._arr.map((function(t){return t.key}))},i.prototype.has=function(t){return r.has(this._keyIndices,t)},i.prototype.priority=function(t){var e=this._keyIndices[t];if(void 0!==e)return this._arr[e].priority},i.prototype.min=function(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key},i.prototype.add=function(t,e){var n=this._keyIndices;if(t=String(t),!r.has(n,t)){var i=this._arr,o=i.length;return n[t]=o,i.push({key:t,priority:e}),this._decrease(o),!0}return!1},i.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var t=this._arr.pop();return delete this._keyIndices[t.key],this._heapify(0),t.key},i.prototype.decrease=function(t,e){var n=this._keyIndices[t];if(e>this._arr[n].priority)throw new Error("New priority is greater than current priority. Key: "+t+" Old: "+this._arr[n].priority+" New: "+e);this._arr[n].priority=e,this._decrease(n)},i.prototype._heapify=function(t){var e=this._arr,n=2*t,r=n+1,i=t;n<e.length&&(i=e[n].priority<e[i].priority?n:i,r<e.length&&(i=e[r].priority<e[i].priority?r:i),i!==t&&(this._swap(t,i),this._heapify(i)))},i.prototype._decrease=function(t){for(var e,n=this._arr,r=n[t].priority;0!==t&&!(n[e=t>>1].priority<r);)this._swap(t,e),t=e},i.prototype._swap=function(t,e){var n=this._arr,r=this._keyIndices,i=n[t],o=n[e];n[t]=o,n[e]=i,r[o.key]=t,r[i.key]=e}},1053:(t,e,n)=>{"use strict";var r=n(7163);t.exports=o;var i="\0";function o(t){this._isDirected=!r.has(t,"directed")||t.directed,this._isMultigraph=!!r.has(t,"multigraph")&&t.multigraph,this._isCompound=!!r.has(t,"compound")&&t.compound,this._label=void 0,this._defaultNodeLabelFn=r.constant(void 0),this._defaultEdgeLabelFn=r.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children["\0"]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function a(t,e){t[e]?t[e]++:t[e]=1}function s(t,e){--t[e]||delete t[e]}function u(t,e,n,i){var o=""+e,a=""+n;if(!t&&o>a){var s=o;o=a,a=s}return o+""+a+""+(r.isUndefined(i)?"\0":i)}function l(t,e,n,r){var i=""+e,o=""+n;if(!t&&i>o){var a=i;i=o,o=a}var s={v:i,w:o};return r&&(s.name=r),s}function c(t,e){return u(t,e.v,e.w,e.name)}o.prototype._nodeCount=0,o.prototype._edgeCount=0,o.prototype.isDirected=function(){return this._isDirected},o.prototype.isMultigraph=function(){return this._isMultigraph},o.prototype.isCompound=function(){return this._isCompound},o.prototype.setGraph=function(t){return this._label=t,this},o.prototype.graph=function(){return this._label},o.prototype.setDefaultNodeLabel=function(t){return r.isFunction(t)||(t=r.constant(t)),this._defaultNodeLabelFn=t,this},o.prototype.nodeCount=function(){return this._nodeCount},o.prototype.nodes=function(){return r.keys(this._nodes)},o.prototype.sources=function(){return r.filter(this.nodes(),r.bind((function(t){return r.isEmpty(this._in[t])}),this))},o.prototype.sinks=function(){return r.filter(this.nodes(),r.bind((function(t){return r.isEmpty(this._out[t])}),this))},o.prototype.setNodes=function(t,e){var n=arguments;return r.each(t,r.bind((function(t){n.length>1?this.setNode(t,e):this.setNode(t)}),this)),this},o.prototype.setNode=function(t,e){return r.has(this._nodes,t)?(arguments.length>1&&(this._nodes[t]=e),this):(this._nodes[t]=arguments.length>1?e:this._defaultNodeLabelFn(t),this._isCompound&&(this._parent[t]=i,this._children[t]={},this._children["\0"][t]=!0),this._in[t]={},this._preds[t]={},this._out[t]={},this._sucs[t]={},++this._nodeCount,this)},o.prototype.node=function(t){return this._nodes[t]},o.prototype.hasNode=function(t){return r.has(this._nodes,t)},o.prototype.removeNode=function(t){var e=this;if(r.has(this._nodes,t)){var n=function(t){e.removeEdge(e._edgeObjs[t])};delete this._nodes[t],this._isCompound&&(this._removeFromParentsChildList(t),delete this._parent[t],r.each(this.children(t),r.bind((function(t){this.setParent(t)}),this)),delete this._children[t]),r.each(r.keys(this._in[t]),n),delete this._in[t],delete this._preds[t],r.each(r.keys(this._out[t]),n),delete this._out[t],delete this._sucs[t],--this._nodeCount}return this},o.prototype.setParent=function(t,e){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(r.isUndefined(e))e=i;else{for(var n=e+="";!r.isUndefined(n);n=this.parent(n))if(n===t)throw new Error("Setting "+e+" as parent of "+t+" would create create a cycle");this.setNode(e)}return this.setNode(t),this._removeFromParentsChildList(t),this._parent[t]=e,this._children[e][t]=!0,this},o.prototype._removeFromParentsChildList=function(t){delete this._children[this._parent[t]][t]},o.prototype.parent=function(t){if(this._isCompound){var e=this._parent[t];if(e!==i)return e}},o.prototype.children=function(t){if(r.isUndefined(t)&&(t=i),this._isCompound){var e=this._children[t];if(e)return r.keys(e)}else{if(t===i)return this.nodes();if(this.hasNode(t))return[]}},o.prototype.predecessors=function(t){var e=this._preds[t];if(e)return r.keys(e)},o.prototype.successors=function(t){var e=this._sucs[t];if(e)return r.keys(e)},o.prototype.neighbors=function(t){var e=this.predecessors(t);if(e)return r.union(e,this.successors(t))},o.prototype.isLeaf=function(t){return 0===(this.isDirected()?this.successors(t):this.neighbors(t)).length},o.prototype.filterNodes=function(t){var e=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});e.setGraph(this.graph()),r.each(this._nodes,r.bind((function(n,r){t(r)&&e.setNode(r,n)}),this)),r.each(this._edgeObjs,r.bind((function(t){e.hasNode(t.v)&&e.hasNode(t.w)&&e.setEdge(t,this.edge(t))}),this));var n=this,i={};function o(t){var r=n.parent(t);return void 0===r||e.hasNode(r)?(i[t]=r,r):r in i?i[r]:o(r)}return this._isCompound&&r.each(e.nodes(),(function(t){e.setParent(t,o(t))})),e},o.prototype.setDefaultEdgeLabel=function(t){return r.isFunction(t)||(t=r.constant(t)),this._defaultEdgeLabelFn=t,this},o.prototype.edgeCount=function(){return this._edgeCount},o.prototype.edges=function(){return r.values(this._edgeObjs)},o.prototype.setPath=function(t,e){var n=this,i=arguments;return r.reduce(t,(function(t,r){return i.length>1?n.setEdge(t,r,e):n.setEdge(t,r),r})),this},o.prototype.setEdge=function(){var t,e,n,i,o=!1,s=arguments[0];"object"==typeof s&&null!==s&&"v"in s?(t=s.v,e=s.w,n=s.name,2===arguments.length&&(i=arguments[1],o=!0)):(t=s,e=arguments[1],n=arguments[3],arguments.length>2&&(i=arguments[2],o=!0)),t=""+t,e=""+e,r.isUndefined(n)||(n=""+n);var c=u(this._isDirected,t,e,n);if(r.has(this._edgeLabels,c))return o&&(this._edgeLabels[c]=i),this;if(!r.isUndefined(n)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(t),this.setNode(e),this._edgeLabels[c]=o?i:this._defaultEdgeLabelFn(t,e,n);var h=l(this._isDirected,t,e,n);return t=h.v,e=h.w,Object.freeze(h),this._edgeObjs[c]=h,a(this._preds[e],t),a(this._sucs[t],e),this._in[e][c]=h,this._out[t][c]=h,this._edgeCount++,this},o.prototype.edge=function(t,e,n){var r=1===arguments.length?c(this._isDirected,arguments[0]):u(this._isDirected,t,e,n);return this._edgeLabels[r]},o.prototype.hasEdge=function(t,e,n){var i=1===arguments.length?c(this._isDirected,arguments[0]):u(this._isDirected,t,e,n);return r.has(this._edgeLabels,i)},o.prototype.removeEdge=function(t,e,n){var r=1===arguments.length?c(this._isDirected,arguments[0]):u(this._isDirected,t,e,n),i=this._edgeObjs[r];return i&&(t=i.v,e=i.w,delete this._edgeLabels[r],delete this._edgeObjs[r],s(this._preds[e],t),s(this._sucs[t],e),delete this._in[e][r],delete this._out[t][r],this._edgeCount--),this},o.prototype.inEdges=function(t,e){var n=this._in[t];if(n){var i=r.values(n);return e?r.filter(i,(function(t){return t.v===e})):i}},o.prototype.outEdges=function(t,e){var n=this._out[t];if(n){var i=r.values(n);return e?r.filter(i,(function(t){return t.w===e})):i}},o.prototype.nodeEdges=function(t,e){var n=this.inEdges(t,e);if(n)return n.concat(this.outEdges(t,e))}},8579:(t,e,n)=>{t.exports={Graph:n(1053),version:n(2321)}},2485:(t,e,n)=>{var r=n(7163),i=n(1053);function o(t){return r.map(t.nodes(),(function(e){var n=t.node(e),i=t.parent(e),o={v:e};return r.isUndefined(n)||(o.value=n),r.isUndefined(i)||(o.parent=i),o}))}function a(t){return r.map(t.edges(),(function(e){var n=t.edge(e),i={v:e.v,w:e.w};return r.isUndefined(e.name)||(i.name=e.name),r.isUndefined(n)||(i.value=n),i}))}t.exports={write:function(t){var e={options:{directed:t.isDirected(),multigraph:t.isMultigraph(),compound:t.isCompound()},nodes:o(t),edges:a(t)};return r.isUndefined(t.graph())||(e.value=r.clone(t.graph())),e},read:function(t){var e=new i(t.options).setGraph(t.value);return r.each(t.nodes,(function(t){e.setNode(t.v,t.value),t.parent&&e.setParent(t.v,t.parent)})),r.each(t.edges,(function(t){e.setEdge({v:t.v,w:t.w,name:t.name},t.value)})),e}}},7163:(t,e,n)=>{var r;try{r=n(6486)}catch(t){}r||(r=window._),t.exports=r},2321:t=>{t.exports="2.1.4"},1795:(t,e,n)=>{var r=n(5752);function i(t){var e=0;if(t&&t.length>0){e+=Math.abs(o(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(o(t[n]))}return e}function o(t){var e,n,i,o,s,u,l=0,c=t.length;if(c>2){for(u=0;u<c;u++)u===c-2?(i=c-2,o=c-1,s=0):u===c-1?(i=c-1,o=0,s=1):(i=u,o=u+1,s=u+2),e=t[i],n=t[o],l+=(a(t[s][0])-a(e[0]))*Math.sin(a(n[1]));l=l*r.RADIUS*r.RADIUS/2}return l}function a(t){return t*Math.PI/180}t.exports.geometry=function t(e){var n,r=0;switch(e.type){case"Polygon":return i(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)r+=i(e.coordinates[n]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)r+=t(e.geometries[n]);return r}},t.exports.ring=o},8163:(t,e,n)=>{var r=n(1795);function i(t,e){return function(n){return t(n,e)}}function o(t,e){e=!!e,t[0]=a(t[0],e);for(var n=1;n<t.length;n++)t[n]=a(t[n],!e);return t}function a(t,e){return function(t){return r.ring(t)>=0}(t)===e?t:t.reverse()}t.exports=function t(e,n){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(i(t,n)),e;case"GeometryCollection":return e.geometries=e.geometries.map(i(t,n)),e;case"Feature":return e.geometry=t(e.geometry,n),e;case"Polygon":case"MultiPolygon":return function(t,e){return"Polygon"===t.type?t.coordinates=o(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(i(o,e))),t}(e,n);default:return e}}},9874:t=>{function e(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}t.exports=e,e.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},e.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},e.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},e.prototype.solveCurveX=function(t,e){var n,r,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},e.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},9469:(t,e)=>{"use strict";var n,r,i,o,a,s,u,l,c,h,f,p,d,g,v,m,y,_,b,x,w,E,S,C,A;(e.UX||(e.UX={})).TextureCompressionBC="texture-compression-bc",(A=e.OB||(e.OB={})).ClampToEdge="clamp-to-edge",A.Repeat="repeat",A.MirrorRepeat="mirror-repeat",(C=e.$l||(e.$l={})).UniformBuffer="uniform-buffer",C.StorageBuffer="storage-buffer",C.ReadonlyStorageBuffer="readonly-storage-buffer",C.Sampler="sampler",C.ComparisonSampler="comparison-sampler",C.SampledTexture="sampled-texture",C.ReadonlyStorageTexture="readonly-storage-texture",C.WriteonlyStorageTexture="writeonly-storage-texture",(S=e.zi||(e.zi={})).Zero="zero",S.One="one",S.SrcColor="src-color",S.OneMinusSrcColor="one-minus-src-color",S.SrcAlpha="src-alpha",S.OneMinusSrcAlpha="one-minus-src-alpha",S.DstColor="dst-color",S.OneMinusDstColor="one-minus-dst-color",S.DstAlpha="dst-alpha",S.OneMinusDstAlpha="one-minus-dst-alpha",S.SrcAlphaSaturated="src-alpha-saturated",S.BlendColor="blend-color",S.OneMinusBlendColor="one-minus-blend-color",(E=e.db||(e.db={})).Add="add",E.Subtract="subtract",E.ReverseSubtract="reverse-subtract",E.Min="min",E.Max="max",(w=e.wb||(e.wb={})).Never="never",w.Less="less",w.Equal="equal",w.LessEqual="less-equal",w.Greater="greater",w.NotEqual="not-equal",w.GreaterEqual="greater-equal",w.Always="always",(x=e.Wf||(e.Wf={})).None="none",x.Front="front",x.Back="back",(b=e.X9||(e.X9={})).Nearest="nearest",b.Linear="linear",(_=e.zX||(e.zX={})).CCW="ccw",_.CW="cw",(y=e.iD||(e.iD={})).Uint16="uint16",y.Uint32="uint32",(m=e.V||(e.V={})).Vertex="vertex",m.Instance="instance",(e.Ws||(e.Ws={})).Load="load",(v=e.YV||(e.YV={})).PointList="point-list",v.LineList="line-list",v.LineStrip="line-strip",v.TriangleList="triangle-list",v.TriangleStrip="triangle-strip",(g=e.xS||(e.xS={})).Keep="keep",g.Zero="zero",g.Replace="replace",g.Invert="invert",g.IncrementClamp="increment-clamp",g.DecrementClamp="decrement-clamp",g.IncrementWrap="increment-wrap",g.DecrementWrap="decrement-wrap",(d=e.EG||(e.EG={})).Store="store",d.Clear="clear",(p=e.kd||(e.kd={})).E1d="1d",p.E2d="2d",p.E3d="3d",(f=e.EV||(e.EV={})).R8Unorm="r8unorm",f.R8Snorm="r8snorm",f.R8Uint="r8uint",f.R8Sint="r8sint",f.R16Uint="r16uint",f.R16Sint="r16sint",f.R16Float="r16float",f.RG8Unorm="rg8unorm",f.RG8Snorm="rg8snorm",f.RG8Uint="rg8uint",f.RG8Sint="rg8sint",f.R32Uint="r32uint",f.R32Sint="r32sint",f.R32Float="r32float",f.RG16Uint="rg16uint",f.RG16Sint="rg16sint",f.RG16Float="rg16float",f.RGBA8Unorm="rgba8unorm",f.RGBA8UnormSRGB="rgba8unorm-srgb",f.RGBA8Snorm="rgba8snorm",f.RGBA8Uint="rgba8uint",f.RGBA8Sint="rgba8sint",f.BGRA8Unorm="bgra8unorm",f.BGRA8UnormSRGB="bgra8unorm-srgb",f.RGB10A2Unorm="rgb10a2unorm",f.RG11B10Float="rg11b10float",f.RG32Uint="rg32uint",f.RG32Sint="rg32sint",f.RG32Float="rg32float",f.RGBA16Uint="rgba16uint",f.RGBA16Sint="rgba16sint",f.RGBA16Float="rgba16float",f.RGBA32Uint="rgba32uint",f.RGBA32Sint="rgba32sint",f.RGBA32Float="rgba32float",f.Depth32Float="depth32float",f.Depth24Plus="depth24plus",f.Depth24PlusStencil8="depth24plus-stencil8",(h=e.Ek||(e.Ek={})).Float="float",h.Sint="sint",h.Uint="uint",(c=e.p_||(e.p_={})).E1d="1d",c.E2d="2d",c.E2dArray="2d-array",c.Cube="cube",c.CubeArray="cube-array",c.E3d="3d",(l=e.gB||(e.gB={})).Uchar2="uchar2",l.Uchar4="uchar4",l.Char2="char2",l.Char4="char4",l.Uchar2Norm="uchar2norm",l.Uchar4Norm="uchar4norm",l.Char2Norm="char2norm",l.Char4Norm="char4norm",l.Ushort2="ushort2",l.Ushort4="ushort4",l.Short2="short2",l.Short4="short4",l.Ushort2Norm="ushort2norm",l.Ushort4Norm="ushort4norm",l.Short2Norm="short2norm",l.Short4Norm="short4norm",l.Half2="half2",l.Half4="half4",l.Float="float",l.Float2="float2",l.Float3="float3",l.Float4="float4",l.Uint="uint",l.Uint2="uint2",l.Uint3="uint3",l.Uint4="uint4",l.Int="int",l.Int2="int2",l.Int3="int3",l.Int4="int4",(u=e.H7||(e.H7={})).All="all",u.StencilOnly="stencil-only",u.DepthOnly="depth-only",(s=e.mj||(e.mj={})).Error="error",s.Warning="warning",s.Info="info",(e.xL||(e.xL={})).Occlusion="occlusion",(a=e.FB||(e.FB={}))[a.MapRead=1]="MapRead",a[a.MapWrite=2]="MapWrite",a[a.CopySrc=4]="CopySrc",a[a.CopyDst=8]="CopyDst",a[a.Index=16]="Index",a[a.Vertex=32]="Vertex",a[a.Uniform=64]="Uniform",a[a.Storage=128]="Storage",a[a.Indirect=256]="Indirect",a[a.QueryResolve=512]="QueryResolve",(o=e.Yw||(e.Yw={}))[o.Red=1]="Red",o[o.Green=2]="Green",o[o.Blue=4]="Blue",o[o.Alpha=8]="Alpha",o[o.All=15]="All",(i=e.$X||(e.$X={}))[i.Vertex=1]="Vertex",i[i.Fragment=2]="Fragment",i[i.Compute=4]="Compute",(r=e.v2||(e.v2={}))[r.CopySrc=1]="CopySrc",r[r.CopyDst=2]="CopyDst",r[r.Sampled=4]="Sampled",r[r.Storage=8]="Storage",r[r.OutputAttachment=16]="OutputAttachment",(n=e.gc||(e.gc={}))[n.Read=1]="Read",n[n.Write=2]="Write"},8168:(t,e,n)=>{var r=n(8874),i={};for(var o in r)r.hasOwnProperty(o)&&(i[r[o]]=o);var a=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var s in a)if(a.hasOwnProperty(s)){if(!("channels"in a[s]))throw new Error("missing channels property: "+s);if(!("labels"in a[s]))throw new Error("missing channel labels property: "+s);if(a[s].labels.length!==a[s].channels)throw new Error("channel and label counts mismatch: "+s);var u=a[s].channels,l=a[s].labels;delete a[s].channels,delete a[s].labels,Object.defineProperty(a[s],"channels",{value:u}),Object.defineProperty(a[s],"labels",{value:l})}a.rgb.hsl=function(t){var e,n,r=t[0]/255,i=t[1]/255,o=t[2]/255,a=Math.min(r,i,o),s=Math.max(r,i,o),u=s-a;return s===a?e=0:r===s?e=(i-o)/u:i===s?e=2+(o-r)/u:o===s&&(e=4+(r-i)/u),(e=Math.min(60*e,360))<0&&(e+=360),n=(a+s)/2,[e,100*(s===a?0:n<=.5?u/(s+a):u/(2-s-a)),100*n]},a.rgb.hsv=function(t){var e,n,r,i,o,a=t[0]/255,s=t[1]/255,u=t[2]/255,l=Math.max(a,s,u),c=l-Math.min(a,s,u),h=function(t){return(l-t)/6/c+.5};return 0===c?i=o=0:(o=c/l,e=h(a),n=h(s),r=h(u),a===l?i=r-n:s===l?i=1/3+e-r:u===l&&(i=2/3+n-e),i<0?i+=1:i>1&&(i-=1)),[360*i,100*o,100*l]},a.rgb.hwb=function(t){var e=t[0],n=t[1],r=t[2];return[a.rgb.hsl(t)[0],1/255*Math.min(e,Math.min(n,r))*100,100*(r=1-1/255*Math.max(e,Math.max(n,r)))]},a.rgb.cmyk=function(t){var e,n=t[0]/255,r=t[1]/255,i=t[2]/255;return[100*((1-n-(e=Math.min(1-n,1-r,1-i)))/(1-e)||0),100*((1-r-e)/(1-e)||0),100*((1-i-e)/(1-e)||0),100*e]},a.rgb.keyword=function(t){var e=i[t];if(e)return e;var n,o,a,s=1/0;for(var u in r)if(r.hasOwnProperty(u)){var l=(o=t,a=r[u],Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2)+Math.pow(o[2]-a[2],2));l<s&&(s=l,n=u)}return n},a.keyword.rgb=function(t){return r[t]},a.rgb.xyz=function(t){var e=t[0]/255,n=t[1]/255,r=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*e+.7152*n+.0722*r),100*(.0193*e+.1192*n+.9505*r)]},a.rgb.lab=function(t){var e=a.rgb.xyz(t),n=e[0],r=e[1],i=e[2];return r/=100,i/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(n-r),200*(r-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},a.hsl.rgb=function(t){var e,n,r,i,o,a=t[0]/360,s=t[1]/100,u=t[2]/100;if(0===s)return[o=255*u,o,o];e=2*u-(n=u<.5?u*(1+s):u+s-u*s),i=[0,0,0];for(var l=0;l<3;l++)(r=a+1/3*-(l-1))<0&&r++,r>1&&r--,o=6*r<1?e+6*(n-e)*r:2*r<1?n:3*r<2?e+(n-e)*(2/3-r)*6:e,i[l]=255*o;return i},a.hsl.hsv=function(t){var e=t[0],n=t[1]/100,r=t[2]/100,i=n,o=Math.max(r,.01);return n*=(r*=2)<=1?r:2-r,i*=o<=1?o:2-o,[e,100*(0===r?2*i/(o+i):2*n/(r+n)),(r+n)/2*100]},a.hsv.rgb=function(t){var e=t[0]/60,n=t[1]/100,r=t[2]/100,i=Math.floor(e)%6,o=e-Math.floor(e),a=255*r*(1-n),s=255*r*(1-n*o),u=255*r*(1-n*(1-o));switch(r*=255,i){case 0:return[r,u,a];case 1:return[s,r,a];case 2:return[a,r,u];case 3:return[a,s,r];case 4:return[u,a,r];case 5:return[r,a,s]}},a.hsv.hsl=function(t){var e,n,r,i=t[0],o=t[1]/100,a=t[2]/100,s=Math.max(a,.01);return r=(2-o)*a,n=o*s,[i,100*(n=(n/=(e=(2-o)*s)<=1?e:2-e)||0),100*(r/=2)]},a.hwb.rgb=function(t){var e,n,r,i,o,a,s,u=t[0]/360,l=t[1]/100,c=t[2]/100,h=l+c;switch(h>1&&(l/=h,c/=h),r=6*u-(e=Math.floor(6*u)),0!=(1&e)&&(r=1-r),i=l+r*((n=1-c)-l),e){default:case 6:case 0:o=n,a=i,s=l;break;case 1:o=i,a=n,s=l;break;case 2:o=l,a=n,s=i;break;case 3:o=l,a=i,s=n;break;case 4:o=i,a=l,s=n;break;case 5:o=n,a=l,s=i}return[255*o,255*a,255*s]},a.cmyk.rgb=function(t){var e=t[0]/100,n=t[1]/100,r=t[2]/100,i=t[3]/100;return[255*(1-Math.min(1,e*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i)),255*(1-Math.min(1,r*(1-i)+i))]},a.xyz.rgb=function(t){var e,n,r,i=t[0]/100,o=t[1]/100,a=t[2]/100;return n=-.9689*i+1.8758*o+.0415*a,r=.0557*i+-.204*o+1.057*a,e=(e=3.2406*i+-1.5372*o+-.4986*a)>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(e=Math.min(Math.max(0,e),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]},a.xyz.lab=function(t){var e=t[0],n=t[1],r=t[2];return n/=100,r/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(e-n),200*(n-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},a.lab.xyz=function(t){var e,n,r,i=t[0];e=t[1]/500+(n=(i+16)/116),r=n-t[2]/200;var o=Math.pow(n,3),a=Math.pow(e,3),s=Math.pow(r,3);return n=o>.008856?o:(n-16/116)/7.787,e=a>.008856?a:(e-16/116)/7.787,r=s>.008856?s:(r-16/116)/7.787,[e*=95.047,n*=100,r*=108.883]},a.lab.lch=function(t){var e,n=t[0],r=t[1],i=t[2];return(e=360*Math.atan2(i,r)/2/Math.PI)<0&&(e+=360),[n,Math.sqrt(r*r+i*i),e]},a.lch.lab=function(t){var e,n=t[0],r=t[1];return e=t[2]/360*2*Math.PI,[n,r*Math.cos(e),r*Math.sin(e)]},a.rgb.ansi16=function(t){var e=t[0],n=t[1],r=t[2],i=1 in arguments?arguments[1]:a.rgb.hsv(t)[2];if(0===(i=Math.round(i/50)))return 30;var o=30+(Math.round(r/255)<<2|Math.round(n/255)<<1|Math.round(e/255));return 2===i&&(o+=60),o},a.hsv.ansi16=function(t){return a.rgb.ansi16(a.hsv.rgb(t),t[2])},a.rgb.ansi256=function(t){var e=t[0],n=t[1],r=t[2];return e===n&&n===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)},a.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];var n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},a.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var n;return t-=16,[Math.floor(t/36)/5*255,Math.floor((n=t%36)/6)/5*255,n%6/5*255]},a.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},a.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var n=e[0];3===e[0].length&&(n=n.split("").map((function(t){return t+t})).join(""));var r=parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},a.rgb.hcg=function(t){var e,n=t[0]/255,r=t[1]/255,i=t[2]/255,o=Math.max(Math.max(n,r),i),a=Math.min(Math.min(n,r),i),s=o-a;return e=s<=0?0:o===n?(r-i)/s%6:o===r?2+(i-n)/s:4+(n-r)/s+4,e/=6,[360*(e%=1),100*s,100*(s<1?a/(1-s):0)]},a.hsl.hcg=function(t){var e,n=t[1]/100,r=t[2]/100,i=0;return(e=r<.5?2*n*r:2*n*(1-r))<1&&(i=(r-.5*e)/(1-e)),[t[0],100*e,100*i]},a.hsv.hcg=function(t){var e=t[1]/100,n=t[2]/100,r=e*n,i=0;return r<1&&(i=(n-r)/(1-r)),[t[0],100*r,100*i]},a.hcg.rgb=function(t){var e=t[0]/360,n=t[1]/100,r=t[2]/100;if(0===n)return[255*r,255*r,255*r];var i,o=[0,0,0],a=e%1*6,s=a%1,u=1-s;switch(Math.floor(a)){case 0:o[0]=1,o[1]=s,o[2]=0;break;case 1:o[0]=u,o[1]=1,o[2]=0;break;case 2:o[0]=0,o[1]=1,o[2]=s;break;case 3:o[0]=0,o[1]=u,o[2]=1;break;case 4:o[0]=s,o[1]=0,o[2]=1;break;default:o[0]=1,o[1]=0,o[2]=u}return i=(1-n)*r,[255*(n*o[0]+i),255*(n*o[1]+i),255*(n*o[2]+i)]},a.hcg.hsv=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e),r=0;return n>0&&(r=e/n),[t[0],100*r,100*n]},a.hcg.hsl=function(t){var e=t[1]/100,n=t[2]/100*(1-e)+.5*e,r=0;return n>0&&n<.5?r=e/(2*n):n>=.5&&n<1&&(r=e/(2*(1-n))),[t[0],100*r,100*n]},a.hcg.hwb=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},a.hwb.hcg=function(t){var e=t[1]/100,n=1-t[2]/100,r=n-e,i=0;return r<1&&(i=(n-r)/(1-r)),[t[0],100*r,100*i]},a.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},a.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},a.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},a.gray.hsl=a.gray.hsv=function(t){return[0,0,t[0]]},a.gray.hwb=function(t){return[0,100,t[0]]},a.gray.cmyk=function(t){return[0,0,0,t[0]]},a.gray.lab=function(t){return[t[0],0,0]},a.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},a.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}},2085:(t,e,n)=>{var r=n(8168),i=n(4111),o={};Object.keys(r).forEach((function(t){o[t]={},Object.defineProperty(o[t],"channels",{value:r[t].channels}),Object.defineProperty(o[t],"labels",{value:r[t].labels});var e=i(t);Object.keys(e).forEach((function(n){var r=e[n];o[t][n]=function(t){var e=function(e){if(null==e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var n=t(e);if("object"==typeof n)for(var r=n.length,i=0;i<r;i++)n[i]=Math.round(n[i]);return n};return"conversion"in t&&(e.conversion=t.conversion),e}(r),o[t][n].raw=function(t){var e=function(e){return null==e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(r)}))})),t.exports=o},4111:(t,e,n)=>{var r=n(8168);function i(t,e){return function(n){return e(t(n))}}function o(t,e){for(var n=[e[t].parent,t],o=r[e[t].parent][t],a=e[t].parent;e[a].parent;)n.unshift(e[a].parent),o=i(r[e[a].parent][a],o),a=e[a].parent;return o.conversion=n,o}t.exports=function(t){for(var e=function(t){var e=function(){for(var t={},e=Object.keys(r),n=e.length,i=0;i<n;i++)t[e[i]]={distance:-1,parent:null};return t}(),n=[t];for(e[t].distance=0;n.length;)for(var i=n.pop(),o=Object.keys(r[i]),a=o.length,s=0;s<a;s++){var u=o[s],l=e[u];-1===l.distance&&(l.distance=e[i].distance+1,l.parent=i,n.unshift(u))}return e}(t),n={},i=Object.keys(e),a=i.length,s=0;s<a;s++){var u=i[s];null!==e[u].parent&&(n[u]=o(u,e))}return n}},8874:t=>{"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},9818:(t,e,n)=>{var r=n(8874),i=n(6851),o=Object.hasOwnProperty,a={};for(var s in r)o.call(r,s)&&(a[r[s]]=s);var u=t.exports={to:{},get:{}};function l(t,e,n){return Math.min(Math.max(e,t),n)}function c(t){var e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}u.get=function(t){var e,n;switch(t.substring(0,3).toLowerCase()){case"hsl":e=u.get.hsl(t),n="hsl";break;case"hwb":e=u.get.hwb(t),n="hwb";break;default:e=u.get.rgb(t),n="rgb"}return e?{model:n,value:e}:null},u.get.rgb=function(t){if(!t)return null;var e,n,i,a=[0,0,0,1];if(e=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=e[2],e=e[1],n=0;n<3;n++){var s=2*n;a[n]=parseInt(e.slice(s,s+2),16)}i&&(a[3]=parseInt(i,16)/255)}else if(e=t.match(/^#([a-f0-9]{3,4})$/i)){for(i=(e=e[1])[3],n=0;n<3;n++)a[n]=parseInt(e[n]+e[n],16);i&&(a[3]=parseInt(i+i,16)/255)}else if(e=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(n=0;n<3;n++)a[n]=parseInt(e[n+1],0);e[4]&&(e[5]?a[3]=.01*parseFloat(e[4]):a[3]=parseFloat(e[4]))}else{if(!(e=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(e=t.match(/^(\w+)$/))?"transparent"===e[1]?[0,0,0,0]:o.call(r,e[1])?((a=r[e[1]])[3]=1,a):null:null;for(n=0;n<3;n++)a[n]=Math.round(2.55*parseFloat(e[n+1]));e[4]&&(e[5]?a[3]=.01*parseFloat(e[4]):a[3]=parseFloat(e[4]))}for(n=0;n<3;n++)a[n]=l(a[n],0,255);return a[3]=l(a[3],0,1),a},u.get.hsl=function(t){if(!t)return null;var e=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,l(parseFloat(e[2]),0,100),l(parseFloat(e[3]),0,100),l(isNaN(n)?1:n,0,1)]}return null},u.get.hwb=function(t){if(!t)return null;var e=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,l(parseFloat(e[2]),0,100),l(parseFloat(e[3]),0,100),l(isNaN(n)?1:n,0,1)]}return null},u.to.hex=function(){var t=i(arguments);return"#"+c(t[0])+c(t[1])+c(t[2])+(t[3]<1?c(Math.round(255*t[3])):"")},u.to.rgb=function(){var t=i(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},u.to.rgb.percent=function(){var t=i(arguments),e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+n+"%, "+r+"%)":"rgba("+e+"%, "+n+"%, "+r+"%, "+t[3]+")"},u.to.hsl=function(){var t=i(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},u.to.hwb=function(){var t=i(arguments),e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},u.to.keyword=function(t){return a[t.slice(0,3)]}},6767:(t,e,n)=>{"use strict";var r=n(9818),i=n(2085),o=[].slice,a=["keyword","gray","hex"],s={};Object.keys(i).forEach((function(t){s[o.call(i[t].labels).sort().join("")]=t}));var u={};function l(t,e){if(!(this instanceof l))return new l(t,e);if(e&&e in a&&(e=null),e&&!(e in i))throw new Error("Unknown model: "+e);var n,c;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof l)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var h=r.get(t);if(null===h)throw new Error("Unable to parse color from string: "+t);this.model=h.model,c=i[this.model].channels,this.color=h.value.slice(0,c),this.valpha="number"==typeof h.value[c]?h.value[c]:1}else if(t.length){this.model=e||"rgb",c=i[this.model].channels;var f=o.call(t,0,c);this.color=p(f,c),this.valpha="number"==typeof t[c]?t[c]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var d=Object.keys(t);"alpha"in t&&(d.splice(d.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var g=d.sort().join("");if(!(g in s))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=s[g];var v=i[this.model].labels,m=[];for(n=0;n<v.length;n++)m.push(t[v[n]]);this.color=p(m)}if(u[this.model])for(c=i[this.model].channels,n=0;n<c;n++){var y=u[this.model][n];y&&(this.color[n]=y(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function c(t,e,n){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(u[t]||(u[t]=[]))[e]=n})),t=t[0],function(r){var i;return arguments.length?(n&&(r=n(r)),(i=this[t]()).color[e]=r,i):(i=this[t]().color[e],n&&(i=n(i)),i)}}function h(t){return function(e){return Math.max(0,Math.min(t,e))}}function f(t){return Array.isArray(t)?t:[t]}function p(t,e){for(var n=0;n<e;n++)"number"!=typeof t[n]&&(t[n]=0);return t}l.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in r.to?this:this.rgb(),n=1===(e=e.round("number"==typeof t?t:1)).valpha?e.color:e.color.concat(this.valpha);return r.to[e.model](n)},percentString:function(t){var e=this.rgb().round("number"==typeof t?t:1),n=1===e.valpha?e.color:e.color.concat(this.valpha);return r.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=i[this.model].channels,n=i[this.model].labels,r=0;r<e;r++)t[n[r]]=this.color[r];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new l(this.color.map(function(t){return function(e){return function(t,e){return Number(t.toFixed(e))}(e,t)}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new l(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:c("rgb",0,h(255)),green:c("rgb",1,h(255)),blue:c("rgb",2,h(255)),hue:c(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:c("hsl",1,h(100)),lightness:c("hsl",2,h(100)),saturationv:c("hsv",1,h(100)),value:c("hsv",2,h(100)),chroma:c("hcg",1,h(100)),gray:c("hcg",2,h(100)),white:c("hwb",1,h(100)),wblack:c("hwb",2,h(100)),cyan:c("cmyk",0,h(100)),magenta:c("cmyk",1,h(100)),yellow:c("cmyk",2,h(100)),black:c("cmyk",3,h(100)),x:c("xyz",0,h(100)),y:c("xyz",1,h(100)),z:c("xyz",2,h(100)),l:c("lab",0,h(100)),a:c("lab",1),b:c("lab",2),keyword:function(t){return arguments.length?new l(t):i[this.model].keyword(this.color)},hex:function(t){return arguments.length?new l(t):r.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],n=0;n<t.length;n++){var r=t[n]/255;e[n]=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color,e=.3*t[0]+.59*t[1]+.11*t[2];return l.rgb(e,e,e)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),n=e.color[0];return n=(n=(n+t)%360)<0?360+n:n,e.color[0]=n,e},mix:function(t,e){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);var n=t.rgb(),r=this.rgb(),i=void 0===e?.5:e,o=2*i-1,a=n.alpha()-r.alpha(),s=((o*a==-1?o:(o+a)/(1+o*a))+1)/2,u=1-s;return l.rgb(s*n.red()+u*r.red(),s*n.green()+u*r.green(),s*n.blue()+u*r.blue(),n.alpha()*i+r.alpha()*(1-i))}},Object.keys(i).forEach((function(t){if(-1===a.indexOf(t)){var e=i[t].channels;l.prototype[t]=function(){if(this.model===t)return new l(this);if(arguments.length)return new l(arguments,t);var n="number"==typeof arguments[e]?e:this.valpha;return new l(f(i[this.model][t].raw(this.color)).concat(n),t)},l[t]=function(n){return"number"==typeof n&&(n=p(o.call(arguments),e)),new l(n,t)}}})),t.exports=l},2650:(t,e,n)=>{"use strict";function r(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function i(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function o(){}n.d(e,{ZP:()=>x,B8:()=>C});var a=.7,s=1/a,u="\\s*([+-]?\\d+)\\s*",l="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",c="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",h=/^#([0-9a-f]{3,8})$/,f=new RegExp("^rgb\\("+[u,u,u]+"\\)$"),p=new RegExp("^rgb\\("+[c,c,c]+"\\)$"),d=new RegExp("^rgba\\("+[u,u,u,l]+"\\)$"),g=new RegExp("^rgba\\("+[c,c,c,l]+"\\)$"),v=new RegExp("^hsl\\("+[l,c,c]+"\\)$"),m=new RegExp("^hsla\\("+[l,c,c,l]+"\\)$"),y={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function _(){return this.rgb().formatHex()}function b(){return this.rgb().formatRgb()}function x(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=h.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?w(e):3===n?new A(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?E(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?E(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=f.exec(t))?new A(e[1],e[2],e[3],1):(e=p.exec(t))?new A(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=d.exec(t))?E(e[1],e[2],e[3],e[4]):(e=g.exec(t))?E(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=v.exec(t))?P(e[1],e[2]/100,e[3]/100,1):(e=m.exec(t))?P(e[1],e[2]/100,e[3]/100,e[4]):y.hasOwnProperty(t)?w(y[t]):"transparent"===t?new A(NaN,NaN,NaN,0):null}function w(t){return new A(t>>16&255,t>>8&255,255&t,1)}function E(t,e,n,r){return r<=0&&(t=e=n=NaN),new A(t,e,n,r)}function S(t){return t instanceof o||(t=x(t)),t?new A((t=t.rgb()).r,t.g,t.b,t.opacity):new A}function C(t,e,n,r){return 1===arguments.length?S(t):new A(t,e,n,null==r?1:r)}function A(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function T(){return"#"+M(this.r)+M(this.g)+M(this.b)}function k(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function M(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function P(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new O(t,e,n,r)}function I(t){if(t instanceof O)return new O(t.h,t.s,t.l,t.opacity);if(t instanceof o||(t=x(t)),!t)return new O;if(t instanceof O)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),s=NaN,u=a-i,l=(a+i)/2;return u?(s=e===a?(n-r)/u+6*(n<r):n===a?(r-e)/u+2:(e-n)/u+4,u/=l<.5?a+i:2-a-i,s*=60):u=l>0&&l<1?0:s,new O(s,u,l,t.opacity)}function O(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function R(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}r(o,x,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:_,formatHex:_,formatHsl:function(){return I(this).formatHsl()},formatRgb:b,toString:b}),r(A,C,i(o,{brighter:function(t){return t=null==t?s:Math.pow(s,t),new A(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?a:Math.pow(a,t),new A(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:T,formatHex:T,formatRgb:k,toString:k})),r(O,(function(t,e,n,r){return 1===arguments.length?I(t):new O(t,e,n,null==r?1:r)}),i(o,{brighter:function(t){return t=null==t?s:Math.pow(s,t),new O(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?a:Math.pow(a,t),new O(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new A(R(t>=240?t-240:t+120,i,r),R(t,i,r),R(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}))},8122:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o,M:()=>a});var r=n(6257),i=n(7896);function o(t,e){return((0,i.v)(e)?i.Z:a)(t,e)}function a(t,e){var n,i=e?e.length:0,o=t?Math.min(i,t.length):0,a=new Array(o),s=new Array(i);for(n=0;n<o;++n)a[n]=(0,r.Z)(t[n],e[n]);for(;n<i;++n)s[n]=e[n];return function(t){for(n=0;n<o;++n)s[n]=a[n](t);return s}}},3626:(t,e,n)=>{"use strict";function r(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}n.d(e,{Z:()=>r})},7896:(t,e,n)=>{"use strict";function r(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(n=0;n<r;++n)i[n]=t[n]*(1-o)+e[n]*o;return i}}function i(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}n.d(e,{Z:()=>r,v:()=>i})},6257:(t,e,n)=>{"use strict";n.d(e,{Z:()=>m});var r=n(2650);function i(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}function o(t){return function(){return t}}function a(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):o(isNaN(t)?e:t)}const s=function t(e){var n=function(t){return 1==(t=+t)?a:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):o(isNaN(e)?n:e)}}(e);function i(t,e){var i=n((t=(0,r.B8)(t)).r,(e=(0,r.B8)(e)).r),o=n(t.g,e.g),s=n(t.b,e.b),u=a(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=o(e),t.b=s(e),t.opacity=u(e),t+""}}return i.gamma=t,i}(1);function u(t){return function(e){var n,i,o=e.length,a=new Array(o),s=new Array(o),u=new Array(o);for(n=0;n<o;++n)i=(0,r.B8)(e[n]),a[n]=i.r||0,s[n]=i.g||0,u[n]=i.b||0;return a=t(a),s=t(s),u=t(u),i.opacity=1,function(t){return i.r=a(t),i.g=s(t),i.b=u(t),i+""}}}u((function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),o=t[r],a=t[r+1],s=r>0?t[r-1]:2*o-a,u=r<e-1?t[r+2]:2*a-o;return i((n-r/e)*e,s,o,a,u)}})),u((function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),o=t[(r+e-1)%e],a=t[r%e],s=t[(r+1)%e],u=t[(r+2)%e];return i((n-r/e)*e,o,a,s,u)}}));var l=n(8122);function c(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}var h=n(3626);function f(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=m(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var p=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,d=new RegExp(p.source,"g");function g(t,e){var n,r,i,o=p.lastIndex=d.lastIndex=0,a=-1,s=[],u=[];for(t+="",e+="";(n=p.exec(t))&&(r=d.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:(0,h.Z)(n,r)})),o=d.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,r=0;r<e;++r)s[(n=u[r]).i]=n.x(t);return s.join("")})}var v=n(7896);function m(t,e){var n,i=typeof e;return null==e||"boolean"===i?o(e):("number"===i?h.Z:"string"===i?(n=(0,r.ZP)(e))?(e=n,s):g:e instanceof r.ZP?s:e instanceof Date?c:(0,v.v)(e)?v.Z:Array.isArray(e)?l.M:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?f:h.Z)(t,e)}},9187:t=>{"use strict";function e(t,e,o){o=o||2;var a,s,u,h,f,d,g,v=e&&e.length,m=v?e[0]*o:t.length,y=n(t,0,m,o,!0),_=[];if(!y||y.next===y.prev)return _;if(v&&(y=function(t,e,i,o){var a,s,u,h=[];for(a=0,s=e.length;a<s;a++)(u=n(t,e[a]*o,a<s-1?e[a+1]*o:t.length,o,!1))===u.next&&(u.steiner=!0),h.push(p(u));for(h.sort(l),a=0;a<h.length;a++)i=r(i=c(h[a],i),i.next);return i}(t,e,y,o)),t.length>80*o){a=u=t[0],s=h=t[1];for(var b=o;b<m;b+=o)(f=t[b])<a&&(a=f),(d=t[b+1])<s&&(s=d),f>u&&(u=f),d>h&&(h=d);g=0!==(g=Math.max(u-a,h-s))?1/g:0}return i(y,_,o,a,s,g),_}function n(t,e,n,r,i){var o,a;if(i===A(t,e,n,r)>0)for(o=e;o<n;o+=r)a=E(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=E(o,t[o],t[o+1],a);return a&&m(a,a.next)&&(S(a),a=a.next),a}function r(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(S(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function i(t,e,n,l,c,h,p){if(t){!p&&h&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=f(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(t,l,c,h);for(var d,g,v=t;t.prev!==t.next;)if(d=t.prev,g=t.next,h?a(t,l,c,h):o(t))e.push(d.i/n),e.push(t.i/n),e.push(g.i/n),S(t),t=g.next,v=g.next;else if((t=g)===v){p?1===p?i(t=s(r(t),e,n),e,n,l,c,h,2):2===p&&u(t,e,n,l,c,h):i(r(t),e,n,l,c,h,1);break}}}function o(t){var e=t.prev,n=t,r=t.next;if(v(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(d(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&v(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(t,e,n,r){var i=t.prev,o=t,a=t.next;if(v(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=f(s,u,e,n,r),p=f(l,c,e,n,r),g=t.prevZ,m=t.nextZ;g&&g.z>=h&&m&&m.z<=p;){if(g!==t.prev&&g!==t.next&&d(i.x,i.y,o.x,o.y,a.x,a.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;if(g=g.prevZ,m!==t.prev&&m!==t.next&&d(i.x,i.y,o.x,o.y,a.x,a.y,m.x,m.y)&&v(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;g&&g.z>=h;){if(g!==t.prev&&g!==t.next&&d(i.x,i.y,o.x,o.y,a.x,a.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;m&&m.z<=p;){if(m!==t.prev&&m!==t.next&&d(i.x,i.y,o.x,o.y,a.x,a.y,m.x,m.y)&&v(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function s(t,e,n){var i=t;do{var o=i.prev,a=i.next.next;!m(o,a)&&y(o,i,i.next,a)&&x(o,a)&&x(a,o)&&(e.push(o.i/n),e.push(i.i/n),e.push(a.i/n),S(i),S(i.next),i=t=a),i=i.next}while(i!==t);return r(i)}function u(t,e,n,o,a,s){var u=t;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&g(u,l)){var c=w(u,l);return u=r(u,u.next),c=r(c,c.next),i(u,e,n,o,a,s),void i(c,e,n,o,a,s)}l=l.next}u=u.next}while(u!==t)}function l(t,e){return t.x-e.x}function c(t,e){var n=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var u,l=n,c=n.x,f=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&d(o<f?i:a,o,c,f,o<f?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),x(r,t)&&(u<p||u===p&&(r.x>n.x||r.x===n.x&&h(n,r)))&&(n=r,p=u)),r=r.next}while(r!==l);return n}(t,e);if(!n)return e;var i=w(n,t),o=r(n,n.next);return r(i,i.next),e===n?o:e}function h(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function f(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function d(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function g(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&y(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(x(t,e)&&x(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||m(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function m(t,e){return t.x===e.x&&t.y===e.y}function y(t,e,n,r){var i=b(v(t,e,n)),o=b(v(t,e,r)),a=b(v(n,r,t)),s=b(v(n,r,e));return i!==o&&a!==s||!(0!==i||!_(t,n,e))||!(0!==o||!_(t,r,e))||!(0!==a||!_(n,t,r))||!(0!==s||!_(n,e,r))}function _(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function b(t){return t>0?1:t<0?-1:0}function x(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function w(t,e){var n=new C(t.i,t.x,t.y),r=new C(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function E(t,e,n,r){var i=new C(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function C(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=e,t.exports.default=e,e.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(A(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var l=e[s]*n,c=s<u-1?e[s+1]*n:t.length;a-=Math.abs(A(t,l,c,n))}var h=0;for(s=0;s<r.length;s+=3){var f=r[s]*n,p=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((t[f]-t[d])*(t[p+1]-t[f+1])-(t[f]-t[p])*(t[d+1]-t[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},e.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},7709:t=>{function e(t){var e=t.target||t.srcElement;e.__resizeRAF__&&cancelAnimationFrame(e.__resizeRAF__),e.__resizeRAF__=requestAnimationFrame((function(){var n=e.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(e){e.call(n,t)}))}))}var n=function(t,n){var r,i=this.document,o=i.attachEvent;if("undefined"!=typeof navigator&&(r=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!t.__resizeListeners__)if(t.__resizeListeners__=[],o)t.__resizeTrigger__=t,t.attachEvent("onresize",e);else{"static"===getComputedStyle(t).position&&(t.style.position="relative");var a=t.__resizeTrigger__=i.createElement("object");a.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),a.setAttribute("class","resize-sensor"),a.setAttribute("tabindex","-1"),a.setAttribute("title",""),a.__resizeElement__=t,a.onload=function(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",e)},a.type="text/html",r&&t.appendChild(a),a.data="about:blank",r||t.appendChild(a)}t.__resizeListeners__.push(n)};t.exports="undefined"==typeof window?n:n.bind(window),t.exports.unbind=function(t,n){var r=document.attachEvent,i=t.__resizeListeners__||[];if(n){var o=i.indexOf(n);-1!==o&&i.splice(o,1)}else i=t.__resizeListeners__=[];if(!i.length){if(r)t.detachEvent("onresize",e);else if(t.__resizeTrigger__){var a=t.__resizeTrigger__.contentDocument,s=a&&a.defaultView;s&&(s.removeEventListener("resize",e),delete s.__resizeTrigger__),t.__resizeTrigger__=!t.removeChild(t.__resizeTrigger__)}delete t.__resizeListeners__}}},6729:t=>{"use strict";var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||t,a),u=n?n+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},s.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},s.prototype.emit=function(t,e,r,i,o,a){var s=n?n+t:t;if(!this._events[s])return!1;var u,l,c=this._events[s],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,i),!0;case 5:return c.fn.call(c.context,e,r,i,o),!0;case 6:return c.fn.call(c.context,e,r,i,o,a),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,r);break;case 4:c[l].fn.call(c[l].context,e,r,i);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,r,i){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==e||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s},9685:(t,e,n)=>{"use strict";n.d(e,{Ib:()=>r,WT:()=>i,FD:()=>o});var r=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array,o=Math.random;Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)})},5975:(t,e,n)=>{"use strict";n.r(e),n.d(e,{create:()=>i,clone:()=>o,copy:()=>a,fromValues:()=>s,set:()=>u,identity:()=>l,transpose:()=>c,invert:()=>h,adjoint:()=>f,determinant:()=>p,multiply:()=>d,translate:()=>g,scale:()=>v,rotate:()=>m,rotateX:()=>y,rotateY:()=>_,rotateZ:()=>b,fromTranslation:()=>x,fromScaling:()=>w,fromRotation:()=>E,fromXRotation:()=>S,fromYRotation:()=>C,fromZRotation:()=>A,fromRotationTranslation:()=>T,fromQuat2:()=>k,getTranslation:()=>M,getScaling:()=>P,getRotation:()=>I,fromRotationTranslationScale:()=>O,fromRotationTranslationScaleOrigin:()=>R,fromQuat:()=>L,frustum:()=>D,perspectiveNO:()=>N,perspective:()=>B,perspectiveZO:()=>z,perspectiveFromFieldOfView:()=>F,orthoNO:()=>Z,ortho:()=>j,orthoZO:()=>U,lookAt:()=>G,targetTo:()=>V,str:()=>W,frob:()=>H,add:()=>X,subtract:()=>Y,multiplyScalar:()=>q,multiplyScalarAndAdd:()=>K,exactEquals:()=>Q,equals:()=>J,mul:()=>$,sub:()=>tt});var r=n(9685);function i(){var t=new r.WT(16);return r.WT!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function o(t){var e=new r.WT(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function s(t,e,n,i,o,a,s,u,l,c,h,f,p,d,g,v){var m=new r.WT(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=i,m[4]=o,m[5]=a,m[6]=s,m[7]=u,m[8]=l,m[9]=c,m[10]=h,m[11]=f,m[12]=p,m[13]=d,m[14]=g,m[15]=v,m}function u(t,e,n,r,i,o,a,s,u,l,c,h,f,p,d,g,v){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t[9]=c,t[10]=h,t[11]=f,t[12]=p,t[13]=d,t[14]=g,t[15]=v,t}function l(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function c(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function h(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],p=e[11],d=e[12],g=e[13],v=e[14],m=e[15],y=n*s-r*a,_=n*u-i*a,b=n*l-o*a,x=r*u-i*s,w=r*l-o*s,E=i*l-o*u,S=c*g-h*d,C=c*v-f*d,A=c*m-p*d,T=h*v-f*g,k=h*m-p*g,M=f*m-p*v,P=y*M-_*k+b*T+x*A-w*C+E*S;return P?(P=1/P,t[0]=(s*M-u*k+l*T)*P,t[1]=(i*k-r*M-o*T)*P,t[2]=(g*E-v*w+m*x)*P,t[3]=(f*w-h*E-p*x)*P,t[4]=(u*A-a*M-l*C)*P,t[5]=(n*M-i*A+o*C)*P,t[6]=(v*b-d*E-m*_)*P,t[7]=(c*E-f*b+p*_)*P,t[8]=(a*k-s*A+l*S)*P,t[9]=(r*A-n*k-o*S)*P,t[10]=(d*w-g*b+m*y)*P,t[11]=(h*b-c*w-p*y)*P,t[12]=(s*C-a*T-u*S)*P,t[13]=(n*T-r*C+i*S)*P,t[14]=(g*_-d*x-v*y)*P,t[15]=(c*x-h*_+f*y)*P,t):null}function f(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],p=e[11],d=e[12],g=e[13],v=e[14],m=e[15];return t[0]=s*(f*m-p*v)-h*(u*m-l*v)+g*(u*p-l*f),t[1]=-(r*(f*m-p*v)-h*(i*m-o*v)+g*(i*p-o*f)),t[2]=r*(u*m-l*v)-s*(i*m-o*v)+g*(i*l-o*u),t[3]=-(r*(u*p-l*f)-s*(i*p-o*f)+h*(i*l-o*u)),t[4]=-(a*(f*m-p*v)-c*(u*m-l*v)+d*(u*p-l*f)),t[5]=n*(f*m-p*v)-c*(i*m-o*v)+d*(i*p-o*f),t[6]=-(n*(u*m-l*v)-a*(i*m-o*v)+d*(i*l-o*u)),t[7]=n*(u*p-l*f)-a*(i*p-o*f)+c*(i*l-o*u),t[8]=a*(h*m-p*g)-c*(s*m-l*g)+d*(s*p-l*h),t[9]=-(n*(h*m-p*g)-c*(r*m-o*g)+d*(r*p-o*h)),t[10]=n*(s*m-l*g)-a*(r*m-o*g)+d*(r*l-o*s),t[11]=-(n*(s*p-l*h)-a*(r*p-o*h)+c*(r*l-o*s)),t[12]=-(a*(h*v-f*g)-c*(s*v-u*g)+d*(s*f-u*h)),t[13]=n*(h*v-f*g)-c*(r*v-i*g)+d*(r*f-i*h),t[14]=-(n*(s*v-u*g)-a*(r*v-i*g)+d*(r*u-i*s)),t[15]=n*(s*f-u*h)-a*(r*f-i*h)+c*(r*u-i*s),t}function p(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],f=t[11],p=t[12],d=t[13],g=t[14],v=t[15];return(e*a-n*o)*(h*v-f*g)-(e*s-r*o)*(c*v-f*d)+(e*u-i*o)*(c*g-h*d)+(n*s-r*a)*(l*v-f*p)-(n*u-i*a)*(l*g-h*p)+(r*u-i*s)*(l*d-c*p)}function d(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],p=e[10],d=e[11],g=e[12],v=e[13],m=e[14],y=e[15],_=n[0],b=n[1],x=n[2],w=n[3];return t[0]=_*r+b*s+x*h+w*g,t[1]=_*i+b*u+x*f+w*v,t[2]=_*o+b*l+x*p+w*m,t[3]=_*a+b*c+x*d+w*y,_=n[4],b=n[5],x=n[6],w=n[7],t[4]=_*r+b*s+x*h+w*g,t[5]=_*i+b*u+x*f+w*v,t[6]=_*o+b*l+x*p+w*m,t[7]=_*a+b*c+x*d+w*y,_=n[8],b=n[9],x=n[10],w=n[11],t[8]=_*r+b*s+x*h+w*g,t[9]=_*i+b*u+x*f+w*v,t[10]=_*o+b*l+x*p+w*m,t[11]=_*a+b*c+x*d+w*y,_=n[12],b=n[13],x=n[14],w=n[15],t[12]=_*r+b*s+x*h+w*g,t[13]=_*i+b*u+x*f+w*v,t[14]=_*o+b*l+x*p+w*m,t[15]=_*a+b*c+x*d+w*y,t}function g(t,e,n){var r,i,o,a,s,u,l,c,h,f,p,d,g=n[0],v=n[1],m=n[2];return e===t?(t[12]=e[0]*g+e[4]*v+e[8]*m+e[12],t[13]=e[1]*g+e[5]*v+e[9]*m+e[13],t[14]=e[2]*g+e[6]*v+e[10]*m+e[14],t[15]=e[3]*g+e[7]*v+e[11]*m+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],p=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=f,t[10]=p,t[11]=d,t[12]=r*g+s*v+h*m+e[12],t[13]=i*g+u*v+f*m+e[13],t[14]=o*g+l*v+p*m+e[14],t[15]=a*g+c*v+d*m+e[15]),t}function v(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function m(t,e,n,i){var o,a,s,u,l,c,h,f,p,d,g,v,m,y,_,b,x,w,E,S,C,A,T,k,M=i[0],P=i[1],I=i[2],O=Math.hypot(M,P,I);return O<r.Ib?null:(M*=O=1/O,P*=O,I*=O,o=Math.sin(n),s=1-(a=Math.cos(n)),u=e[0],l=e[1],c=e[2],h=e[3],f=e[4],p=e[5],d=e[6],g=e[7],v=e[8],m=e[9],y=e[10],_=e[11],b=M*M*s+a,x=P*M*s+I*o,w=I*M*s-P*o,E=M*P*s-I*o,S=P*P*s+a,C=I*P*s+M*o,A=M*I*s+P*o,T=P*I*s-M*o,k=I*I*s+a,t[0]=u*b+f*x+v*w,t[1]=l*b+p*x+m*w,t[2]=c*b+d*x+y*w,t[3]=h*b+g*x+_*w,t[4]=u*E+f*S+v*C,t[5]=l*E+p*S+m*C,t[6]=c*E+d*S+y*C,t[7]=h*E+g*S+_*C,t[8]=u*A+f*T+v*k,t[9]=l*A+p*T+m*k,t[10]=c*A+d*T+y*k,t[11]=h*A+g*T+_*k,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function y(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=a*i+c*r,t[6]=s*i+h*r,t[7]=u*i+f*r,t[8]=l*i-o*r,t[9]=c*i-a*r,t[10]=h*i-s*r,t[11]=f*i-u*r,t}function _(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-l*r,t[1]=a*i-c*r,t[2]=s*i-h*r,t[3]=u*i-f*r,t[8]=o*r+l*i,t[9]=a*r+c*i,t[10]=s*r+h*i,t[11]=u*r+f*i,t}function b(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=a*i+c*r,t[2]=s*i+h*r,t[3]=u*i+f*r,t[4]=l*i-o*r,t[5]=c*i-a*r,t[6]=h*i-s*r,t[7]=f*i-u*r,t}function x(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function w(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function E(t,e,n){var i,o,a,s=n[0],u=n[1],l=n[2],c=Math.hypot(s,u,l);return c<r.Ib?null:(s*=c=1/c,u*=c,l*=c,i=Math.sin(e),a=1-(o=Math.cos(e)),t[0]=s*s*a+o,t[1]=u*s*a+l*i,t[2]=l*s*a-u*i,t[3]=0,t[4]=s*u*a-l*i,t[5]=u*u*a+o,t[6]=l*u*a+s*i,t[7]=0,t[8]=s*l*a+u*i,t[9]=u*l*a-s*i,t[10]=l*l*a+o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function S(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function C(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function A(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,u=i+i,l=o+o,c=r*s,h=r*u,f=r*l,p=i*u,d=i*l,g=o*l,v=a*s,m=a*u,y=a*l;return t[0]=1-(p+g),t[1]=h+y,t[2]=f-m,t[3]=0,t[4]=h-y,t[5]=1-(c+g),t[6]=d+v,t[7]=0,t[8]=f+m,t[9]=d-v,t[10]=1-(c+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function k(t,e){var n=new r.WT(3),i=-e[0],o=-e[1],a=-e[2],s=e[3],u=e[4],l=e[5],c=e[6],h=e[7],f=i*i+o*o+a*a+s*s;return f>0?(n[0]=2*(u*s+h*i+l*a-c*o)/f,n[1]=2*(l*s+h*o+c*i-u*a)/f,n[2]=2*(c*s+h*a+u*o-l*i)/f):(n[0]=2*(u*s+h*i+l*a-c*o),n[1]=2*(l*s+h*o+c*i-u*a),n[2]=2*(c*s+h*a+u*o-l*i)),T(t,e,n),t}function M(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function P(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],l=e[9],c=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,l,c),t}function I(t,e){var n=new r.WT(3);P(n,e);var i=1/n[0],o=1/n[1],a=1/n[2],s=e[0]*i,u=e[1]*o,l=e[2]*a,c=e[4]*i,h=e[5]*o,f=e[6]*a,p=e[8]*i,d=e[9]*o,g=e[10]*a,v=s+h+g,m=0;return v>0?(m=2*Math.sqrt(v+1),t[3]=.25*m,t[0]=(f-d)/m,t[1]=(p-l)/m,t[2]=(u-c)/m):s>h&&s>g?(m=2*Math.sqrt(1+s-h-g),t[3]=(f-d)/m,t[0]=.25*m,t[1]=(u+c)/m,t[2]=(p+l)/m):h>g?(m=2*Math.sqrt(1+h-s-g),t[3]=(p-l)/m,t[0]=(u+c)/m,t[1]=.25*m,t[2]=(f+d)/m):(m=2*Math.sqrt(1+g-s-h),t[3]=(u-c)/m,t[0]=(p+l)/m,t[1]=(f+d)/m,t[2]=.25*m),t}function O(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,l=o+o,c=a+a,h=i*u,f=i*l,p=i*c,d=o*l,g=o*c,v=a*c,m=s*u,y=s*l,_=s*c,b=r[0],x=r[1],w=r[2];return t[0]=(1-(d+v))*b,t[1]=(f+_)*b,t[2]=(p-y)*b,t[3]=0,t[4]=(f-_)*x,t[5]=(1-(h+v))*x,t[6]=(g+m)*x,t[7]=0,t[8]=(p+y)*w,t[9]=(g-m)*w,t[10]=(1-(h+d))*w,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function R(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],l=o+o,c=a+a,h=s+s,f=o*l,p=o*c,d=o*h,g=a*c,v=a*h,m=s*h,y=u*l,_=u*c,b=u*h,x=r[0],w=r[1],E=r[2],S=i[0],C=i[1],A=i[2],T=(1-(g+m))*x,k=(p+b)*x,M=(d-_)*x,P=(p-b)*w,I=(1-(f+m))*w,O=(v+y)*w,R=(d+_)*E,L=(v-y)*E,D=(1-(f+g))*E;return t[0]=T,t[1]=k,t[2]=M,t[3]=0,t[4]=P,t[5]=I,t[6]=O,t[7]=0,t[8]=R,t[9]=L,t[10]=D,t[11]=0,t[12]=n[0]+S-(T*S+P*C+R*A),t[13]=n[1]+C-(k*S+I*C+L*A),t[14]=n[2]+A-(M*S+O*C+D*A),t[15]=1,t}function L(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,h=r*s,f=i*a,p=i*s,d=i*u,g=o*a,v=o*s,m=o*u;return t[0]=1-h-d,t[1]=c+m,t[2]=f-v,t[3]=0,t[4]=c-m,t[5]=1-l-d,t[6]=p+g,t[7]=0,t[8]=f+v,t[9]=p-g,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function D(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),l=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t}function N(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var B=N;function z(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function F(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Z(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*l,t[15]=1,t}var j=Z;function U(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=o*l,t[15]=1,t}function G(t,e,n,i){var o,a,s,u,c,h,f,p,d,g,v=e[0],m=e[1],y=e[2],_=i[0],b=i[1],x=i[2],w=n[0],E=n[1],S=n[2];return Math.abs(v-w)<r.Ib&&Math.abs(m-E)<r.Ib&&Math.abs(y-S)<r.Ib?l(t):(f=v-w,p=m-E,d=y-S,o=b*(d*=g=1/Math.hypot(f,p,d))-x*(p*=g),a=x*(f*=g)-_*d,s=_*p-b*f,(g=Math.hypot(o,a,s))?(o*=g=1/g,a*=g,s*=g):(o=0,a=0,s=0),u=p*s-d*a,c=d*o-f*s,h=f*a-p*o,(g=Math.hypot(u,c,h))?(u*=g=1/g,c*=g,h*=g):(u=0,c=0,h=0),t[0]=o,t[1]=u,t[2]=f,t[3]=0,t[4]=a,t[5]=c,t[6]=p,t[7]=0,t[8]=s,t[9]=h,t[10]=d,t[11]=0,t[12]=-(o*v+a*m+s*y),t[13]=-(u*v+c*m+h*y),t[14]=-(f*v+p*m+d*y),t[15]=1,t)}function V(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=r[0],u=r[1],l=r[2],c=i-n[0],h=o-n[1],f=a-n[2],p=c*c+h*h+f*f;p>0&&(c*=p=1/Math.sqrt(p),h*=p,f*=p);var d=u*f-l*h,g=l*c-s*f,v=s*h-u*c;return(p=d*d+g*g+v*v)>0&&(d*=p=1/Math.sqrt(p),g*=p,v*=p),t[0]=d,t[1]=g,t[2]=v,t[3]=0,t[4]=h*v-f*g,t[5]=f*d-c*v,t[6]=c*g-h*d,t[7]=0,t[8]=c,t[9]=h,t[10]=f,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function W(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function H(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function X(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function Y(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function q(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function K(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Q(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function J(t,e){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],p=t[10],d=t[11],g=t[12],v=t[13],m=t[14],y=t[15],_=e[0],b=e[1],x=e[2],w=e[3],E=e[4],S=e[5],C=e[6],A=e[7],T=e[8],k=e[9],M=e[10],P=e[11],I=e[12],O=e[13],R=e[14],L=e[15];return Math.abs(n-_)<=r.Ib*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-b)<=r.Ib*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(o-x)<=r.Ib*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-w)<=r.Ib*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-E)<=r.Ib*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(u-S)<=r.Ib*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(l-C)<=r.Ib*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(c-A)<=r.Ib*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(h-T)<=r.Ib*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(f-k)<=r.Ib*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(p-M)<=r.Ib*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(d-P)<=r.Ib*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(g-I)<=r.Ib*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(v-O)<=r.Ib*Math.max(1,Math.abs(v),Math.abs(O))&&Math.abs(m-R)<=r.Ib*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(y-L)<=r.Ib*Math.max(1,Math.abs(y),Math.abs(L))}var $=d,tt=Y},1437:(t,e,n)=>{"use strict";n.d(e,{Ue:()=>i,al:()=>o,JG:()=>a,t8:()=>s,IH:()=>u,$X:()=>l,VV:()=>c,Fp:()=>h,bA:()=>f,TE:()=>p,tk:()=>d,Fv:()=>g,AK:()=>v,t7:()=>m,I6:()=>y,lu:()=>_});var r=n(9685);function i(){var t=new r.WT(2);return r.WT!=Float32Array&&(t[0]=0,t[1]=0),t}function o(t,e){var n=new r.WT(2);return n[0]=t,n[1]=e,n}function a(t,e){return t[0]=e[0],t[1]=e[1],t}function s(t,e,n){return t[0]=e,t[1]=n,t}function u(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function l(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function c(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function h(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function f(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function p(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function d(t,e){return t[0]=-e[0],t[1]=-e[1],t}function g(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function v(t,e){return t[0]*e[0]+t[1]*e[1]}function m(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}function y(t,e){return t[0]===e[0]&&t[1]===e[1]}var _=l;i()},7160:(t,e,n)=>{"use strict";n.r(e),n.d(e,{create:()=>i,clone:()=>o,length:()=>a,fromValues:()=>s,copy:()=>u,set:()=>l,add:()=>c,subtract:()=>h,multiply:()=>f,divide:()=>p,ceil:()=>d,floor:()=>g,min:()=>v,max:()=>m,round:()=>y,scale:()=>_,scaleAndAdd:()=>b,distance:()=>x,squaredDistance:()=>w,squaredLength:()=>E,negate:()=>S,inverse:()=>C,normalize:()=>A,dot:()=>T,cross:()=>k,lerp:()=>M,hermite:()=>P,bezier:()=>I,random:()=>O,transformMat4:()=>R,transformMat3:()=>L,transformQuat:()=>D,rotateX:()=>N,rotateY:()=>B,rotateZ:()=>z,angle:()=>F,zero:()=>Z,str:()=>j,exactEquals:()=>U,equals:()=>G,sub:()=>W,mul:()=>H,div:()=>X,dist:()=>Y,sqrDist:()=>q,len:()=>K,sqrLen:()=>Q,forEach:()=>J});var r=n(9685);function i(){var t=new r.WT(3);return r.WT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function o(t){var e=new r.WT(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function a(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function s(t,e,n){var i=new r.WT(3);return i[0]=t,i[1]=e,i[2]=n,i}function u(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function l(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function c(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function h(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function f(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function p(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function d(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function g(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function v(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function m(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function y(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function _(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function b(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function x(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function w(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function E(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function S(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function C(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function A(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function T(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function k(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function M(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t}function P(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*l+i[0]*c,t[1]=e[1]*s+n[1]*u+r[1]*l+i[1]*c,t[2]=e[2]*s+n[2]*u+r[2]*l+i[2]*c,t}function I(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,h=3*u*a,f=u*o;return t[0]=e[0]*l+n[0]*c+r[0]*h+i[0]*f,t[1]=e[1]*l+n[1]*c+r[1]*h+i[1]*f,t[2]=e[2]*l+n[2]*c+r[2]*h+i[2]*f,t}function O(t,e){e=e||1;var n=2*r.FD()*Math.PI,i=2*r.FD()-1,o=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*o,t[1]=Math.sin(n)*o,t[2]=i*e,t}function R(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function L(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function D(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],l=e[2],c=i*l-o*u,h=o*s-r*l,f=r*u-i*s,p=i*f-o*h,d=o*c-r*f,g=r*h-i*c,v=2*a;return c*=v,h*=v,f*=v,p*=2,d*=2,g*=2,t[0]=s+c+p,t[1]=u+h+d,t[2]=l+f+g,t}function N(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function B(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function z(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function F(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),l=u&&T(t,e)/u;return Math.acos(Math.min(Math.max(l,-1),1))}function Z(t){return t[0]=0,t[1]=0,t[2]=0,t}function j(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function U(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function G(t,e){var n=t[0],i=t[1],o=t[2],a=e[0],s=e[1],u=e[2];return Math.abs(n-a)<=r.Ib*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=r.Ib*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-u)<=r.Ib*Math.max(1,Math.abs(o),Math.abs(u))}var V,W=h,H=f,X=p,Y=x,q=w,K=a,Q=E,J=(V=i(),function(t,e,n,r,i,o){var a,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)V[0]=t[a],V[1]=t[a+1],V[2]=t[a+2],i(V,V,o),t[a]=V[0],t[a+1]=V[1],t[a+2]=V[2];return t})},8333:(t,e,n)=>{"use strict";n.d(e,{Ue:()=>i,d9:()=>o,al:()=>a,JG:()=>s,t8:()=>u,IH:()=>l,bA:()=>c,kE:()=>h,we:()=>f,Fv:()=>p,AK:()=>d,t7:()=>g,fF:()=>v,I6:()=>m,fS:()=>y});var r=n(9685);function i(){var t=new r.WT(4);return r.WT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function o(t){var e=new r.WT(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function a(t,e,n,i){var o=new r.WT(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=i,o}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function u(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function l(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function c(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function h(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function f(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function p(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t}function d(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function g(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t}function v(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}function m(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function y(t,e){var n=t[0],i=t[1],o=t[2],a=t[3],s=e[0],u=e[1],l=e[2],c=e[3];return Math.abs(n-s)<=r.Ib*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-u)<=r.Ib*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-l)<=r.Ib*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-c)<=r.Ib*Math.max(1,Math.abs(a),Math.abs(c))}i()},9550:t=>{t.exports=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}},2189:t=>{t.exports=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}},6057:t=>{t.exports=function(t){var e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}},3492:t=>{t.exports=function(t,e){return t[0]=e[0],t[1]=e[1],t}},1589:t=>{t.exports=function(){var t=new Float32Array(2);return t[0]=0,t[1]=0,t}},7741:t=>{t.exports=function(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}},8006:(t,e,n)=>{t.exports=n(7953)},7953:t=>{t.exports=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}},9973:(t,e,n)=>{t.exports=n(6773)},6773:t=>{t.exports=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}},6601:t=>{t.exports=function(t,e){return t[0]*e[0]+t[1]*e[1]}},9936:t=>{t.exports=1e-6},1232:(t,e,n)=>{t.exports=function(t,e){var n=t[0],i=t[1],o=e[0],a=e[1];return Math.abs(n-o)<=r*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=r*Math.max(1,Math.abs(i),Math.abs(a))};var r=n(9936)},9546:t=>{t.exports=function(t,e){return t[0]===e[0]&&t[1]===e[1]}},7744:t=>{t.exports=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}},9002:(t,e,n)=>{t.exports=function(t,e,n,i,o,a){var s,u;for(e||(e=2),n||(n=0),u=i?Math.min(i*e+n,t.length):t.length,s=n;s<u;s+=e)r[0]=t[s],r[1]=t[s+1],o(r,r,a),t[s]=r[0],t[s+1]=r[1];return t};var r=n(1589)()},9878:t=>{t.exports=function(t,e){var n=new Float32Array(2);return n[0]=t,n[1]=e,n}},2644:(t,e,n)=>{t.exports={EPSILON:n(9936),create:n(1589),clone:n(6057),fromValues:n(9878),copy:n(3492),set:n(8854),equals:n(1232),exactEquals:n(9546),add:n(9550),subtract:n(3650),sub:n(5222),multiply:n(9920),mul:n(3113),divide:n(6773),div:n(9973),inverse:n(3793),min:n(6933),max:n(7899),rotate:n(8677),floor:n(7744),ceil:n(2189),round:n(7074),scale:n(7838),scaleAndAdd:n(1066),distance:n(7953),dist:n(8006),squaredDistance:n(7126),sqrDist:n(9569),length:n(7781),len:n(8123),squaredLength:n(6791),sqrLen:n(1791),negate:n(549),normalize:n(6820),dot:n(6601),cross:n(7741),lerp:n(6890),random:n(5773),transformMat2:n(904),transformMat2d:n(736),transformMat3:n(221),transformMat4:n(7674),forEach:n(9002),limit:n(2418)}},3793:t=>{t.exports=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}},8123:(t,e,n)=>{t.exports=n(7781)},7781:t=>{t.exports=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}},6890:t=>{t.exports=function(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}},2418:t=>{t.exports=function(t,e,n){var r=e[0]*e[0]+e[1]*e[1];if(r>n*n){var i=Math.sqrt(r);t[0]=e[0]/i*n,t[1]=e[1]/i*n}else t[0]=e[0],t[1]=e[1];return t}},7899:t=>{t.exports=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}},6933:t=>{t.exports=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}},3113:(t,e,n)=>{t.exports=n(9920)},9920:t=>{t.exports=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}},549:t=>{t.exports=function(t,e){return t[0]=-e[0],t[1]=-e[1],t}},6820:t=>{t.exports=function(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t}},5773:t=>{t.exports=function(t,e){e=e||1;var n=2*Math.random()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}},8677:t=>{t.exports=function(t,e,n){var r=Math.cos(n),i=Math.sin(n),o=e[0],a=e[1];return t[0]=o*r-a*i,t[1]=o*i+a*r,t}},7074:t=>{t.exports=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}},7838:t=>{t.exports=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}},1066:t=>{t.exports=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}},8854:t=>{t.exports=function(t,e,n){return t[0]=e,t[1]=n,t}},9569:(t,e,n)=>{t.exports=n(7126)},1791:(t,e,n)=>{t.exports=n(6791)},7126:t=>{t.exports=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}},6791:t=>{t.exports=function(t){var e=t[0],n=t[1];return e*e+n*n}},5222:(t,e,n)=>{t.exports=n(3650)},3650:t=>{t.exports=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}},904:t=>{t.exports=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}},736:t=>{t.exports=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}},221:t=>{t.exports=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}},7674:t=>{t.exports=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}},8186:t=>{var e=[],n=[];function r(t,r){if(r=r||{},void 0===t)throw new Error("insert-css: You need to provide a CSS string. Usage: insertCss(cssString[, options]).");var i,o=!0===r.prepend?"prepend":"append",a=void 0!==r.container?r.container:document.querySelector("head"),s=e.indexOf(a);return-1===s&&(s=e.push(a)-1,n[s]={}),void 0!==n[s]&&void 0!==n[s][o]?i=n[s][o]:(i=n[s][o]=function(){var t=document.createElement("style");return t.setAttribute("type","text/css"),t}(),"prepend"===o?a.insertBefore(i,a.childNodes[0]):a.appendChild(i)),65279===t.charCodeAt(0)&&(t=t.substr(1,t.length)),i.styleSheet?i.styleSheet.cssText+=t:i.textContent+=t,i}t.exports=r,t.exports.insertCss=r},7375:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function r(t,e,r,i){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return i&&!Reflect.hasMetadata(n,this,e)&&Reflect.defineMetadata(n,r(),this,e),Reflect.hasMetadata(n,this,e)?Reflect.getMetadata(n,this,e):r()},set:function(t){Reflect.defineMetadata(n,t,this,e)}})}e.makePropertyInjectDecorator=function(t,e){return function(n){return function(i,o){r(i,o,(function(){return t.get(n)}),e)}}},e.makePropertyInjectNamedDecorator=function(t,e){return function(n,i){return function(o,a){r(o,a,(function(){return t.getNamed(n,i)}),e)}}},e.makePropertyInjectTaggedDecorator=function(t,e){return function(n,i,o){return function(a,s){r(a,s,(function(){return t.getTagged(n,i,o)}),e)}}},e.makePropertyMultiInjectDecorator=function(t,e){return function(n){return function(i,o){r(i,o,(function(){return t.getAll(n)}),e)}}}},4879:(t,e,n)=>{"use strict";var r=n(7375);e.Z=function(t,e){return void 0===e&&(e=!0),{lazyInject:r.makePropertyInjectDecorator(t,e),lazyInjectNamed:r.makePropertyInjectNamedDecorator(t,e),lazyInjectTagged:r.makePropertyInjectTaggedDecorator(t,e),lazyMultiInject:r.makePropertyMultiInjectDecorator(t,e)}}},9934:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tagProperty=e.tagParameter=e.decorate=void 0;var r=n(6674),i=n(6867);function o(t,e,n,i,o){var a={},s="number"==typeof o,u=void 0!==o&&s?o.toString():n;if(s&&void 0!==n)throw new Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(t,e)&&(a=Reflect.getMetadata(t,e));var l=a[u];if(Array.isArray(l))for(var c=0,h=l;c<h.length;c++){var f=h[c];if(f.key===i.key)throw new Error(r.DUPLICATED_METADATA+" "+f.key.toString())}else l=[];l.push(i),a[u]=l,Reflect.defineMetadata(t,a,e)}function a(t,e){Reflect.decorate(t,e)}function s(t,e){return function(n,r){e(n,r,t)}}e.tagParameter=function(t,e,n,r){o(i.TAGGED,t,e,r,n)},e.tagProperty=function(t,e,n){o(i.TAGGED_PROP,t.constructor,e,n)},e.decorate=function(t,e,n){"number"==typeof n?a([s(n,t)],e):"string"==typeof n?Reflect.decorate([t],e,n):a([t],e)}},5744:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.inject=e.LazyServiceIdentifer=void 0;var r=n(6674),i=n(6867),o=n(7738),a=n(9934),s=function(){function t(t){this._cb=t}return t.prototype.unwrap=function(){return this._cb()},t}();e.LazyServiceIdentifer=s,e.inject=function(t){return function(e,n,s){if(void 0===t)throw new Error(r.UNDEFINED_INJECT_ANNOTATION(e.name));var u=new o.Metadata(i.INJECT_TAG,t);"number"==typeof s?a.tagParameter(e,n,s,u):a.tagProperty(e,n,u)}}},4315:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.injectable=void 0;var r=n(6674),i=n(6867);e.injectable=function(){return function(t){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,t))throw new Error(r.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,t)||[];return Reflect.defineMetadata(i.PARAM_TYPES,e,t),t}}},1693:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiInject=void 0;var r=n(6867),i=n(7738),o=n(9934);e.multiInject=function(t){return function(e,n,a){var s=new i.Metadata(r.MULTI_INJECT_TAG,t);"number"==typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}},8085:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.named=void 0;var r=n(6867),i=n(7738),o=n(9934);e.named=function(t){return function(e,n,a){var s=new i.Metadata(r.NAMED_TAG,t);"number"==typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}},6515:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.optional=void 0;var r=n(6867),i=n(7738),o=n(9934);e.optional=function(){return function(t,e,n){var a=new i.Metadata(r.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(t,e,n,a):o.tagProperty(t,e,a)}}},7014:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.postConstruct=void 0;var r=n(6674),i=n(6867),o=n(7738);e.postConstruct=function(){return function(t,e,n){var a=new o.Metadata(i.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,t.constructor))throw new Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,a,t.constructor)}}},2052:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tagged=void 0;var r=n(7738),i=n(9934);e.tagged=function(t,e){return function(n,o,a){var s=new r.Metadata(t,e);"number"==typeof a?i.tagParameter(n,o,a,s):i.tagProperty(n,o,s)}}},5638:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.targetName=void 0;var r=n(6867),i=n(7738),o=n(9934);e.targetName=function(t){return function(e,n,a){var s=new i.Metadata(r.NAME_TAG,t);o.tagParameter(e,n,a,s)}}},6757:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unmanaged=void 0;var r=n(6867),i=n(7738),o=n(9934);e.unmanaged=function(){return function(t,e,n){var a=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(t,e,n,a)}}},4290:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Binding=void 0;var r=n(8421),i=n(7791),o=function(){function t(t,e){this.id=i.id(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(t){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return t.prototype.clone=function(){var e=new t(this.serviceIdentifier,this.scope);return e.activated=e.scope===r.BindingScopeEnum.Singleton&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},t}();e.Binding=o},3184:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingCount=void 0,e.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},6674:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STACK_OVERFLOW=e.CIRCULAR_DEPENDENCY_IN_FACTORY=e.POST_CONSTRUCT_ERROR=e.MULTIPLE_POST_CONSTRUCT_METHODS=e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=e.ARGUMENTS_LENGTH_MISMATCH=e.INVALID_DECORATOR_OPERATION=e.INVALID_TO_SELF_VALUE=e.INVALID_FUNCTION_BINDING=e.INVALID_MIDDLEWARE_RETURN=e.NO_MORE_SNAPSHOTS_AVAILABLE=e.INVALID_BINDING_TYPE=e.NOT_IMPLEMENTED=e.CIRCULAR_DEPENDENCY=e.UNDEFINED_INJECT_ANNOTATION=e.MISSING_INJECT_ANNOTATION=e.MISSING_INJECTABLE_ANNOTATION=e.NOT_REGISTERED=e.CANNOT_UNBIND=e.AMBIGUOUS_MATCH=e.KEY_NOT_FOUND=e.NULL_ARGUMENT=e.DUPLICATED_METADATA=e.DUPLICATED_INJECTABLE_DECORATOR=void 0,e.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",e.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",e.NULL_ARGUMENT="NULL argument",e.KEY_NOT_FOUND="Key Not Found",e.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",e.CANNOT_UNBIND="Could not unbind serviceIdentifier:",e.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",e.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",e.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",e.UNDEFINED_INJECT_ANNOTATION=function(t){return"@inject called with undefined this could mean that the class "+t+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},e.CIRCULAR_DEPENDENCY="Circular dependency found:",e.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",e.INVALID_BINDING_TYPE="Invalid binding type:",e.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",e.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",e.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",e.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",e.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",e.ARGUMENTS_LENGTH_MISMATCH=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"The number of constructor arguments in the derived class "+t[0]+" must be >= than the number of constructor arguments of its base class."},e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",e.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class",e.POST_CONSTRUCT_ERROR=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"@postConstruct error in class "+t[0]+": "+t[1]},e.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"It looks like there is a circular dependency in one of the '"+t[0]+"' bindings. Please investigate bindings withservice identifier '"+t[1]+"'."},e.STACK_OVERFLOW="Maximum call stack size exceeded"},8421:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TargetTypeEnum=e.BindingTypeEnum=e.BindingScopeEnum=void 0,e.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"},e.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},e.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},6867:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NON_CUSTOM_TAG_KEYS=e.POST_CONSTRUCT=e.DESIGN_PARAM_TYPES=e.PARAM_TYPES=e.TAGGED_PROP=e.TAGGED=e.MULTI_INJECT_TAG=e.INJECT_TAG=e.OPTIONAL_TAG=e.UNMANAGED_TAG=e.NAME_TAG=e.NAMED_TAG=void 0,e.NAMED_TAG="named",e.NAME_TAG="name",e.UNMANAGED_TAG="unmanaged",e.OPTIONAL_TAG="optional",e.INJECT_TAG="inject",e.MULTI_INJECT_TAG="multi_inject",e.TAGGED="inversify:tagged",e.TAGGED_PROP="inversify:tagged_props",e.PARAM_TYPES="inversify:paramtypes",e.DESIGN_PARAM_TYPES="design:paramtypes",e.POST_CONSTRUCT="post_construct",e.NON_CUSTOM_TAG_KEYS=[e.INJECT_TAG,e.MULTI_INJECT_TAG,e.NAME_TAG,e.UNMANAGED_TAG,e.NAMED_TAG,e.OPTIONAL_TAG]},1389:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var a=n(4290),s=n(6674),u=n(8421),l=n(6867),c=n(1377),h=n(6311),f=n(1927),p=n(1860),d=n(7791),g=n(5800),v=n(5700),m=n(175),y=function(){function t(t){this._appliedMiddleware=[];var e=t||{};if("object"!=typeof e)throw new Error(""+s.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===e.defaultScope)e.defaultScope=u.BindingScopeEnum.Transient;else if(e.defaultScope!==u.BindingScopeEnum.Singleton&&e.defaultScope!==u.BindingScopeEnum.Transient&&e.defaultScope!==u.BindingScopeEnum.Request)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===e.autoBindInjectable)e.autoBindInjectable=!1;else if("boolean"!=typeof e.autoBindInjectable)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===e.skipBaseClassChecks)e.skipBaseClassChecks=!1;else if("boolean"!=typeof e.skipBaseClassChecks)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:e.autoBindInjectable,defaultScope:e.defaultScope,skipBaseClassChecks:e.skipBaseClassChecks},this.id=d.id(),this._bindingDictionary=new m.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new c.MetadataReader}return t.merge=function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=new t,s=o([e,n],r).map((function(t){return h.getBindingDictionary(t)})),u=h.getBindingDictionary(a);function l(t,e){t.traverse((function(t,n){n.forEach((function(t){e.add(t.serviceIdentifier,t.clone())}))}))}return s.forEach((function(t){l(t,u)})),a},t.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=t;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},t.prototype.loadAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r(this,void 0,void 0,(function(){var e,n,r,o,a;return i(this,(function(i){switch(i.label){case 0:e=this._getContainerModuleHelpersFactory(),n=0,r=t,i.label=1;case 1:return n<r.length?(o=r[n],a=e(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.prototype.unload=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(t){return function(e){return e.moduleId===t}};e.forEach((function(e){var n=r(e.id);t._bindingDictionary.removeByCondition(n)}))},t.prototype.bind=function(t){var e=this.options.defaultScope||u.BindingScopeEnum.Transient,n=new a.Binding(t,e);return this._bindingDictionary.add(t,n),new p.BindingToSyntax(n)},t.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},t.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch(e){throw new Error(s.CANNOT_UNBIND+" "+g.getServiceIdentifierAsString(t))}},t.prototype.unbindAll=function(){this._bindingDictionary=new m.Lookup},t.prototype.isBound=function(t){var e=this._bindingDictionary.hasKey(t);return!e&&this.parent&&(e=this.parent.isBound(t)),e},t.prototype.isBoundNamed=function(t,e){return this.isBoundTagged(t,l.NAMED_TAG,e)},t.prototype.isBoundTagged=function(t,e,n){var r=!1;if(this._bindingDictionary.hasKey(t)){var i=this._bindingDictionary.get(t),o=h.createMockRequest(this,t,e,n);r=i.some((function(t){return t.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(t,e,n)),r},t.prototype.snapshot=function(){this._snapshots.push(v.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},t.prototype.restore=function(){var t=this._snapshots.pop();if(void 0===t)throw new Error(s.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=t.bindings,this._middleware=t.middleware},t.prototype.createChild=function(e){var n=new t(e||this.options);return n.parent=this,n},t.prototype.applyMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._appliedMiddleware=this._appliedMiddleware.concat(t);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce((function(t,e){return e(t)}),n)},t.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},t.prototype.get=function(t){return this._get(!1,!1,u.TargetTypeEnum.Variable,t)},t.prototype.getTagged=function(t,e,n){return this._get(!1,!1,u.TargetTypeEnum.Variable,t,e,n)},t.prototype.getNamed=function(t,e){return this.getTagged(t,l.NAMED_TAG,e)},t.prototype.getAll=function(t){return this._get(!0,!0,u.TargetTypeEnum.Variable,t)},t.prototype.getAllTagged=function(t,e,n){return this._get(!1,!0,u.TargetTypeEnum.Variable,t,e,n)},t.prototype.getAllNamed=function(t,e){return this.getAllTagged(t,l.NAMED_TAG,e)},t.prototype.resolve=function(t){var e=this.createChild();return e.bind(t).toSelf(),this._appliedMiddleware.forEach((function(t){e.applyMiddleware(t)})),e.get(t)},t.prototype._getContainerModuleHelpersFactory=function(){var t=this,e=function(t,e){t._binding.moduleId=e},n=function(n){return function(r){var i=t.rebind.bind(t)(r);return e(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=t.bind.bind(t)(n);return e(r,i),r}),isboundFunction:function(e){return t.isBound.bind(t)(e)},rebindFunction:n(r),unbindFunction:function(e){t.unbind.bind(t)(e)}};var i}},t.prototype._get=function(t,e,n,r,i,o){var a=null,u={avoidConstraints:t,contextInterceptor:function(t){return t},isMultiInject:e,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(u)))throw new Error(s.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(u);return a},t.prototype._planAndResolve=function(){var t=this;return function(e){var n=h.plan(t._metadataReader,t,e.isMultiInject,e.targetType,e.serviceIdentifier,e.key,e.value,e.avoidConstraints);return n=e.contextInterceptor(n),f.resolve(n)}},t}();e.Container=y},3244:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncContainerModule=e.ContainerModule=void 0;var r=n(7791);e.ContainerModule=function(t){this.id=r.id(),this.registry=t};e.AsyncContainerModule=function(t){this.id=r.id(),this.registry=t}},5700:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ContainerSnapshot=void 0;var n=function(){function t(){}return t.of=function(e,n){var r=new t;return r.bindings=e,r.middleware=n,r},t}();e.ContainerSnapshot=n},175:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Lookup=void 0;var r=n(6674),i=function(){function t(){this._map=new Map}return t.prototype.getMap=function(){return this._map},t.prototype.add=function(t,e){if(null==t)throw new Error(r.NULL_ARGUMENT);if(null==e)throw new Error(r.NULL_ARGUMENT);var n=this._map.get(t);void 0!==n?(n.push(e),this._map.set(t,n)):this._map.set(t,[e])},t.prototype.get=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);var e=this._map.get(t);if(void 0!==e)return e;throw new Error(r.KEY_NOT_FOUND)},t.prototype.remove=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);if(!this._map.delete(t))throw new Error(r.KEY_NOT_FOUND)},t.prototype.removeByCondition=function(t){var e=this;this._map.forEach((function(n,r){var i=n.filter((function(e){return!t(e)}));i.length>0?e._map.set(r,i):e._map.delete(r)}))},t.prototype.hasKey=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);return this._map.has(t)},t.prototype.clone=function(){var e=new t;return this._map.forEach((function(t,n){t.forEach((function(t){return e.add(n,t.clone())}))})),e},t.prototype.traverse=function(t){this._map.forEach((function(e,n){t(n,e)}))},t}();e.Lookup=i},6700:(t,e,n)=>{"use strict";e.GW=e.zY=e.f3=e.t6=e.b2=e.W2=void 0,n(6867);var r=n(1389);Object.defineProperty(e,"W2",{enumerable:!0,get:function(){return r.Container}});n(8421),n(3244);var i=n(4315);Object.defineProperty(e,"b2",{enumerable:!0,get:function(){return i.injectable}});n(2052);var o=n(8085);Object.defineProperty(e,"t6",{enumerable:!0,get:function(){return o.named}});var a=n(5744);Object.defineProperty(e,"f3",{enumerable:!0,get:function(){return a.inject}});n(6515),n(6757),n(1693),n(5638);var s=n(7014);Object.defineProperty(e,"zY",{enumerable:!0,get:function(){return s.postConstruct}});n(1377),n(7791);var u=n(9934);Object.defineProperty(e,"GW",{enumerable:!0,get:function(){return u.decorate}});n(758),n(5800),n(600)},5228:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Context=void 0;var r=n(7791),i=function(){function t(t){this.id=r.id(),this.container=t}return t.prototype.addPlan=function(t){this.plan=t},t.prototype.setCurrentRequest=function(t){this.currentRequest=t},t}();e.Context=i},7738:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var r=n(6867),i=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},t}();e.Metadata=i},1377:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MetadataReader=void 0;var r=n(6867),i=function(){function t(){}return t.prototype.getConstructorMetadata=function(t){return{compilerGeneratedMetadata:Reflect.getMetadata(r.PARAM_TYPES,t),userGeneratedMetadata:Reflect.getMetadata(r.TAGGED,t)||{}}},t.prototype.getPropertiesMetadata=function(t){return Reflect.getMetadata(r.TAGGED_PROP,t)||[]},t}();e.MetadataReader=i},5314:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Plan=void 0;e.Plan=function(t,e){this.parentContext=t,this.rootRequest=e}},6311:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getBindingDictionary=e.createMockRequest=e.plan=void 0;var r=n(3184),i=n(6674),o=n(8421),a=n(6867),s=n(4623),u=n(5800),l=n(5228),c=n(7738),h=n(5314),f=n(2068),p=n(6748),d=n(8924);function g(t){return t._bindingDictionary}function v(t,e,n,o,a){var s,l=y(n.container,a.serviceIdentifier);return l.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof a.serviceIdentifier&&t.getConstructorMetadata(a.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(a.serviceIdentifier).toSelf(),l=y(n.container,a.serviceIdentifier)),s=e?l:l.filter((function(t){var e=new p.Request(t.serviceIdentifier,n,o,t,a);return t.constraint(e)})),function(t,e,n,o){switch(e.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return e;var a=u.getServiceIdentifierAsString(t),s=i.NOT_REGISTERED;throw s+=u.listMetadataForTarget(a,n),s+=u.listRegisteredBindingsForServiceIdentifier(o,a,y),new Error(s);case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return e;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return e;throw a=u.getServiceIdentifierAsString(t),s=i.AMBIGUOUS_MATCH+" "+a,s+=u.listRegisteredBindingsForServiceIdentifier(o,a,y),new Error(s)}}(a.serviceIdentifier,s,a,n.container),s}function m(t,e,n,r,a,s){var u,l;if(null===a){u=v(t,e,r,null,s),l=new p.Request(n,r,null,u,s);var c=new h.Plan(r,l);r.addPlan(c)}else u=v(t,e,r,a,s),l=a.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(e){var n=null;if(s.isArray())n=l.addChildRequest(e.serviceIdentifier,e,s);else{if(e.cache)return;n=l}if(e.type===o.BindingTypeEnum.Instance&&null!==e.implementationType){var a=f.getDependencies(t,e.implementationType);if(!r.container.options.skipBaseClassChecks){var u=f.getBaseClassDependencyCount(t,e.implementationType);if(a.length<u){var c=i.ARGUMENTS_LENGTH_MISMATCH(f.getFunctionName(e.implementationType));throw new Error(c)}}a.forEach((function(e){m(t,!1,e.serviceIdentifier,r,n,e)}))}}))}function y(t,e){var n=[],r=g(t);return r.hasKey(e)?n=r.get(e):null!==t.parent&&(n=y(t.parent,e)),n}e.getBindingDictionary=g,e.plan=function(t,e,n,r,i,o,h,f){void 0===f&&(f=!1);var p=new l.Context(e),g=function(t,e,n,r,i,o){var s=t?a.MULTI_INJECT_TAG:a.INJECT_TAG,u=new c.Metadata(s,n),l=new d.Target(e,"",n,u);if(void 0!==i){var h=new c.Metadata(i,o);l.metadata.push(h)}return l}(n,r,i,0,o,h);try{return m(t,f,i,p,null,g),p}catch(t){throw s.isStackOverflowExeption(t)&&p.plan&&u.circularDependencyToException(p.plan.rootRequest),t}},e.createMockRequest=function(t,e,n,r){var i=new d.Target(o.TargetTypeEnum.Variable,"",e,new c.Metadata(n,r)),a=new l.Context(t);return new p.Request(e,a,null,[],i)}},8460:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.QueryableString=void 0;var n=function(){function t(t){this.str=t}return t.prototype.startsWith=function(t){return 0===this.str.indexOf(t)},t.prototype.endsWith=function(t){var e,n=t.split("").reverse().join("");return e=this.str.split("").reverse().join(""),this.startsWith.call({str:e},n)},t.prototype.contains=function(t){return-1!==this.str.indexOf(t)},t.prototype.equals=function(t){return this.str===t},t.prototype.value=function(){return this.str},t}();e.QueryableString=n},2068:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.getFunctionName=e.getBaseClassDependencyCount=e.getDependencies=void 0;var i=n(5744),o=n(6674),a=n(8421),s=n(6867),u=n(5800);Object.defineProperty(e,"getFunctionName",{enumerable:!0,get:function(){return u.getFunctionName}});var l=n(8924);function c(t,e,n,i){var a=t.getConstructorMetadata(n),s=a.compilerGeneratedMetadata;if(void 0===s){var u=o.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(u)}var l=a.userGeneratedMetadata,c=Object.keys(l),p=0===n.length&&c.length>0,d=c.length>n.length,g=function(t,e,n,r,i){for(var o=[],a=0;a<i;a++){var s=h(a,t,e,n,r);null!==s&&o.push(s)}return o}(i,e,s,l,p||d?c.length:n.length),v=f(t,n);return r(r([],g),v)}function h(t,e,n,r,s){var u=s[t.toString()]||[],c=p(u),h=!0!==c.unmanaged,f=r[t];if((f=c.inject||c.multiInject||f)instanceof i.LazyServiceIdentifer&&(f=f.unwrap()),h){if(!e&&(f===Object||f===Function||void 0===f)){var d=o.MISSING_INJECT_ANNOTATION+" argument "+t+" in class "+n+".";throw new Error(d)}var g=new l.Target(a.TargetTypeEnum.ConstructorArgument,c.targetName,f);return g.metadata=u,g}return null}function f(t,e){for(var n=t.getPropertiesMetadata(e),i=[],o=0,s=Object.keys(n);o<s.length;o++){var u=s[o],c=n[u],h=p(n[u]),d=h.targetName||u,g=h.inject||h.multiInject,v=new l.Target(a.TargetTypeEnum.ClassProperty,d,g);v.metadata=c,i.push(v)}var m=Object.getPrototypeOf(e.prototype).constructor;if(m!==Object){var y=f(t,m);i=r(r([],i),y)}return i}function p(t){var e={};return t.forEach((function(t){e[t.key.toString()]=t.value})),{inject:e[s.INJECT_TAG],multiInject:e[s.MULTI_INJECT_TAG],targetName:e[s.NAME_TAG],unmanaged:e[s.UNMANAGED_TAG]}}e.getDependencies=function(t,e){return c(t,u.getFunctionName(e),e,!1)},e.getBaseClassDependencyCount=function t(e,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var i=c(e,u.getFunctionName(r),r,!0),o=i.map((function(t){return t.metadata.filter((function(t){return t.key===s.UNMANAGED_TAG}))})),a=[].concat.apply([],o).length,l=i.length-a;return l>0?l:t(e,r)}return 0}},6748:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Request=void 0;var r=n(7791),i=function(){function t(t,e,n,i,o){this.id=r.id(),this.serviceIdentifier=t,this.parentContext=e,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return t.prototype.addChildRequest=function(e,n,r){var i=new t(e,this.parentContext,this,n,r);return this.childRequests.push(i),i},t}();e.Request=i},8924:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Target=void 0;var r=n(6867),i=n(7791),o=n(7738),a=n(8460),s=function(){function t(t,e,n,s){this.id=i.id(),this.type=t,this.serviceIdentifier=n,this.name=new a.QueryableString(e||""),this.metadata=new Array;var u=null;"string"==typeof s?u=new o.Metadata(r.NAMED_TAG,s):s instanceof o.Metadata&&(u=s),null!==u&&this.metadata.push(u)}return t.prototype.hasTag=function(t){for(var e=0,n=this.metadata;e<n.length;e++)if(n[e].key===t)return!0;return!1},t.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},t.prototype.matchesArray=function(t){return this.matchesTag(r.MULTI_INJECT_TAG)(t)},t.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},t.prototype.isTagged=function(){return this.metadata.some((function(t){return r.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))}))},t.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},t.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(t){return t.key===r.NAMED_TAG}))[0]:null},t.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(t){return r.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))})):null},t.prototype.matchesNamedTag=function(t){return this.matchesTag(r.NAMED_TAG)(t)},t.prototype.matchesTag=function(t){var e=this;return function(n){for(var r=0,i=e.metadata;r<i.length;r++){var o=i[r];if(o.key===t&&o.value===n)return!0}return!1}},t}();e.Target=s},2279:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.resolveInstance=void 0;var i=n(6674),o=n(8421),a=n(6867);e.resolveInstance=function(t,e,n){var s,u,l=null;e.length>0?(u=e.filter((function(t){return null!==t.target&&t.target.type===o.TargetTypeEnum.ConstructorArgument})).map(n),l=function(t,e,n){var r=e.filter((function(t){return null!==t.target&&t.target.type===o.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(e,n){var r;r=e.target.name.value();var o=i[n];t[r]=o})),t}(l=new((s=t).bind.apply(s,r([void 0],u))),e,n)):l=new t;return function(t,e){if(Reflect.hasMetadata(a.POST_CONSTRUCT,t)){var n=Reflect.getMetadata(a.POST_CONSTRUCT,t);try{e[n.value]()}catch(e){throw new Error(i.POST_CONSTRUCT_ERROR(t.name,e.message))}}}(t,l),l}},1927:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.resolve=void 0;var r=n(6674),i=n(8421),o=n(4623),a=n(5800),s=n(2279),u=function(t,e,n){try{return n()}catch(n){throw o.isStackOverflowExeption(n)?new Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(t,e.toString())):n}},l=function(t){return function(e){e.parentContext.setCurrentRequest(e);var n=e.bindings,o=e.childRequests,c=e.target&&e.target.isArray(),h=!(e.parentRequest&&e.parentRequest.target&&e.target&&e.parentRequest.target.matchesArray(e.target.serviceIdentifier));if(c&&h)return o.map((function(e){return l(t)(e)}));var f=null;if(!e.target.isOptional()||0!==n.length){var p=n[0],d=p.scope===i.BindingScopeEnum.Singleton,g=p.scope===i.BindingScopeEnum.Request;if(d&&p.activated)return p.cache;if(g&&null!==t&&t.has(p.id))return t.get(p.id);if(p.type===i.BindingTypeEnum.ConstantValue)f=p.cache,p.activated=!0;else if(p.type===i.BindingTypeEnum.Function)f=p.cache,p.activated=!0;else if(p.type===i.BindingTypeEnum.Constructor)f=p.implementationType;else if(p.type===i.BindingTypeEnum.DynamicValue&&null!==p.dynamicValue)f=u("toDynamicValue",p.serviceIdentifier,(function(){return p.dynamicValue(e.parentContext)}));else if(p.type===i.BindingTypeEnum.Factory&&null!==p.factory)f=u("toFactory",p.serviceIdentifier,(function(){return p.factory(e.parentContext)}));else if(p.type===i.BindingTypeEnum.Provider&&null!==p.provider)f=u("toProvider",p.serviceIdentifier,(function(){return p.provider(e.parentContext)}));else{if(p.type!==i.BindingTypeEnum.Instance||null===p.implementationType){var v=a.getServiceIdentifierAsString(e.serviceIdentifier);throw new Error(r.INVALID_BINDING_TYPE+" "+v)}f=s.resolveInstance(p.implementationType,o,l(t))}return"function"==typeof p.onActivation&&(f=p.onActivation(e.parentContext,f)),d&&(p.cache=f,p.activated=!0),g&&null!==t&&!t.has(p.id)&&t.set(p.id,f),f}}};e.resolve=function(t){return l(t.plan.rootRequest.requestScope)(t.plan.rootRequest)}},3366:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInSyntax=void 0;var r=n(8421),i=n(1325),o=function(){function t(t){this._binding=t}return t.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},t}();e.BindingInSyntax=o},9812:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInWhenOnSyntax=void 0;var r=n(3366),i=n(1811),o=n(8370),a=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(t)}return t.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},t.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},t.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingInWhenOnSyntax=a},1811:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingOnSyntax=void 0;var r=n(8370),i=function(){function t(t){this._binding=t}return t.prototype.onActivation=function(t){return this._binding.onActivation=t,new r.BindingWhenSyntax(this._binding)},t}();e.BindingOnSyntax=i},1860:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingToSyntax=void 0;var r=n(6674),i=n(8421),o=n(9812),a=n(1325),s=function(){function t(t){this._binding=t}return t.prototype.to=function(t){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=t,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+r.INVALID_TO_SELF_VALUE);var t=this._binding.serviceIdentifier;return this.to(t)},t.prototype.toConstantValue=function(t){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toDynamicValue=function(t){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toConstructor=function(t){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFunction=function(t){if("function"!=typeof t)throw new Error(r.INVALID_FUNCTION_BINDING);var e=this.toConstantValue(t);return this._binding.type=i.BindingTypeEnum.Function,this._binding.scope=i.BindingScopeEnum.Singleton,e},t.prototype.toAutoFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(e){return function(){return e.container.get(t)}},this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toProvider=function(t){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toService=function(t){this.toDynamicValue((function(e){return e.container.get(t)}))},t}();e.BindingToSyntax=s},1325:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenOnSyntax=void 0;var r=n(1811),i=n(8370),o=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingWhenOnSyntax=o},8370:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenSyntax=void 0;var r=n(1811),i=n(758),o=function(){function t(t){this._binding=t}return t.prototype.when=function(t){return this._binding.constraint=t,new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetNamed=function(t){return this._binding.constraint=i.namedConstraint(t),new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){return null!==t.target&&!t.target.isNamed()&&!t.target.isTagged()},new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetTagged=function(t,e){return this._binding.constraint=i.taggedConstraint(t)(e),new r.BindingOnSyntax(this._binding)},t.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(e){return i.typeConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentNamed=function(t){return this._binding.constraint=function(e){return i.namedConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentTagged=function(t,e){return this._binding.constraint=function(n){return i.taggedConstraint(t)(e)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorTagged=function(t,e){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t}();e.BindingWhenSyntax=o},758:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.typeConstraint=e.namedConstraint=e.taggedConstraint=e.traverseAncerstors=void 0;var r=n(6867),i=n(7738),o=function(t,e){var n=t.parentRequest;return null!==n&&(!!e(n)||o(n,e))};e.traverseAncerstors=o;var a=function(t){return function(e){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(t)(e)};return n.metaData=new i.Metadata(t,e),n}};e.taggedConstraint=a;var s=a(r.NAMED_TAG);e.namedConstraint=s,e.typeConstraint=function(t){return function(e){var n=null;if(null!==e){if(n=e.bindings[0],"string"==typeof t)return n.serviceIdentifier===t;var r=e.bindings[0].implementationType;return t===r}return!1}}},600:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiBindToService=void 0,e.multiBindToService=function(t){return function(e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return t.bind(n).toService(e)}))}}}},4623:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isStackOverflowExeption=void 0;var r=n(6674);e.isStackOverflowExeption=function(t){return t instanceof RangeError||t.message===r.STACK_OVERFLOW}},7791:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.id=void 0;var n=0;e.id=function(){return n++}},5800:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.circularDependencyToException=e.listMetadataForTarget=e.listRegisteredBindingsForServiceIdentifier=e.getServiceIdentifierAsString=e.getFunctionName=void 0;var r=n(6674);function i(t){return"function"==typeof t?t.name:"symbol"==typeof t?t.toString():t}function o(t,e){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===e||o(t.parentRequest,e))}function a(t){if(t.name)return t.name;var e=t.toString(),n=e.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+e}e.getServiceIdentifierAsString=i,e.listRegisteredBindingsForServiceIdentifier=function(t,e,n){var r="",i=n(t,e);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(t){var e="Object";null!==t.implementationType&&(e=a(t.implementationType)),r=r+"\n "+e,t.constraint.metaData&&(r=r+" - "+t.constraint.metaData)}))),r},e.circularDependencyToException=function t(e){e.childRequests.forEach((function(e){if(o(e,e.serviceIdentifier)){var n=function(t){return function t(e,n){void 0===n&&(n=[]);var r=i(e.serviceIdentifier);return n.push(r),null!==e.parentRequest?t(e.parentRequest,n):n}(t).reverse().join(" --\x3e ")}(e);throw new Error(r.CIRCULAR_DEPENDENCY+" "+n)}t(e)}))},e.listMetadataForTarget=function(t,e){if(e.isTagged()||e.isNamed()){var n="",r=e.getNamedTag(),i=e.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(t){n+=t.toString()+"\n"}))," "+t+"\n "+t+" - "+n}return" "+t},e.getFunctionName=a},1745:t=>{"use strict";t.exports=n,t.exports.default=n;var e=1e20;function n(t,e,n,r,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer,u="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast;u?this.canvas=my.createOffscreenCanvas(a,a,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=u?Math.round(a/2*1):Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function r(t,e,n,r,o,a){for(var s=0;s<e;s++)i(t,s,e,n,r,o,a);for(var u=0;u<n;u++)i(t,u*e,1,e,r,o,a)}function i(t,n,r,i,o,a,s){var u,l,c,h;for(a[0]=0,s[0]=-e,s[1]=e,u=0;u<i;u++)o[u]=t[n+u*r];for(u=1,l=0,c=0;u<i;u++){do{h=a[l],c=(o[u]-o[h]+u*u-h*h)/(u-h)/2}while(c<=s[l]&&--l>-1);a[++l]=u,s[l]=c,s[l+1]=e}for(u=0,l=0;u<i;u++){for(;s[l+1]<u;)l++;h=a[l],t[n+u*r]=o[h]+(u-h)*(u-h)}}n.prototype._draw=function(t,n){var i,o,a,s,u,l,c,h,f,p=this.ctx.measureText(t),d=p.width,g=2*this.buffer;n&&this.useMetrics?(u=Math.floor(p.actualBoundingBoxAscent),h=this.buffer+Math.ceil(p.actualBoundingBoxAscent),l=this.buffer,c=this.buffer,i=(o=Math.min(this.size,Math.ceil(p.actualBoundingBoxRight-p.actualBoundingBoxLeft)))+g,a=(s=Math.min(this.size-l,Math.ceil(p.actualBoundingBoxAscent+p.actualBoundingBoxDescent)))+g,this.ctx.textBaseline="alphabetic"):(i=o=this.size,a=s=this.size,u=19*this.fontSize/24,l=c=0,h=this.middle,this.ctx.textBaseline="middle"),o&&s&&(this.ctx.clearRect(c,l,o,s),this.ctx.fillText(t,this.buffer,h),f=this.ctx.getImageData(c,l,o,s));var v=new Uint8ClampedArray(i*a);return function(t,n,r,i,o,a,s){a.fill(e,0,n*r),s.fill(0,0,n*r);for(var u=(n-i)/2,l=0;l<o;l++)for(var c=0;c<i;c++){var h=(l+u)*n+c+u,f=t.data[4*(l*i+c)+3]/255;if(1===f)a[h]=0,s[h]=e;else if(0===f)a[h]=e,s[h]=0;else{var p=Math.max(0,.5-f),d=Math.max(0,f-.5);a[h]=p*p,s[h]=d*d}}}(f,i,a,o,s,this.gridOuter,this.gridInner),r(this.gridOuter,i,a,this.f,this.v,this.z),r(this.gridInner,i,a,this.f,this.v,this.z),function(t,e,n,r,i,o,a){for(var s=0;s<e*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);t[s]=Math.round(255-255*(u/o+a))}}(v,i,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:v,metrics:{width:o,height:s,sdfWidth:i,sdfHeight:a,top:u,left:0,advance:d}}},n.prototype.draw=function(t){return this._draw(t,!1).data},n.prototype.drawWithMetrics=function(t){return this._draw(t,!0)}},7736:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Function:()=>Ee,Interpreter:()=>ve,default:()=>Se,evaluate:()=>we,vm:()=>r});var r={};n.r(r),n.d(r,{Script:()=>xe,compileFunction:()=>ye,createContext:()=>me,runInContext:()=>_e,runInNewContext:()=>be});var i={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},o="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",a={5:o,"5module":o+" export import",6:o+" const class extends export import super"},s=/^in(stanceof)?$/,u="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࣇऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-鿼ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞿꟂ-ꟊꟵ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",l="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿᫀᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",c=new RegExp("["+u+"]"),h=new RegExp("["+u+l+"]");u=l=null;var f=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],p=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function d(t,e){for(var n=65536,r=0;r<e.length;r+=2){if((n+=e[r])>t)return!1;if((n+=e[r+1])>=t)return!0}}function g(t,e){return t<65?36===t:t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&c.test(String.fromCharCode(t)):!1!==e&&d(t,f)))}function v(t,e){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&h.test(String.fromCharCode(t)):!1!==e&&(d(t,f)||d(t,p)))))}var m=function(t,e){void 0===e&&(e={}),this.label=t,this.keyword=e.keyword,this.beforeExpr=!!e.beforeExpr,this.startsExpr=!!e.startsExpr,this.isLoop=!!e.isLoop,this.isAssign=!!e.isAssign,this.prefix=!!e.prefix,this.postfix=!!e.postfix,this.binop=e.binop||null,this.updateContext=null};function y(t,e){return new m(t,{beforeExpr:!0,binop:e})}var _={beforeExpr:!0},b={startsExpr:!0},x={};function w(t,e){return void 0===e&&(e={}),e.keyword=t,x[t]=new m(t,e)}var E={num:new m("num",b),regexp:new m("regexp",b),string:new m("string",b),name:new m("name",b),eof:new m("eof"),bracketL:new m("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new m("]"),braceL:new m("{",{beforeExpr:!0,startsExpr:!0}),braceR:new m("}"),parenL:new m("(",{beforeExpr:!0,startsExpr:!0}),parenR:new m(")"),comma:new m(",",_),semi:new m(";",_),colon:new m(":",_),dot:new m("."),question:new m("?",_),questionDot:new m("?."),arrow:new m("=>",_),template:new m("template"),invalidTemplate:new m("invalidTemplate"),ellipsis:new m("...",_),backQuote:new m("`",b),dollarBraceL:new m("${",{beforeExpr:!0,startsExpr:!0}),eq:new m("=",{beforeExpr:!0,isAssign:!0}),assign:new m("_=",{beforeExpr:!0,isAssign:!0}),incDec:new m("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new m("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:y("||",1),logicalAND:y("&&",2),bitwiseOR:y("|",3),bitwiseXOR:y("^",4),bitwiseAND:y("&",5),equality:y("==/!=/===/!==",6),relational:y("</>/<=/>=",7),bitShift:y("<</>>/>>>",8),plusMin:new m("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:y("%",10),star:y("*",10),slash:y("/",10),starstar:new m("**",{beforeExpr:!0}),coalesce:y("??",1),_break:w("break"),_case:w("case",_),_catch:w("catch"),_continue:w("continue"),_debugger:w("debugger"),_default:w("default",_),_do:w("do",{isLoop:!0,beforeExpr:!0}),_else:w("else",_),_finally:w("finally"),_for:w("for",{isLoop:!0}),_function:w("function",b),_if:w("if"),_return:w("return",_),_switch:w("switch"),_throw:w("throw",_),_try:w("try"),_var:w("var"),_const:w("const"),_while:w("while",{isLoop:!0}),_with:w("with"),_new:w("new",{beforeExpr:!0,startsExpr:!0}),_this:w("this",b),_super:w("super",b),_class:w("class",b),_extends:w("extends",_),_export:w("export"),_import:w("import",b),_null:w("null",b),_true:w("true",b),_false:w("false",b),_in:w("in",{beforeExpr:!0,binop:7}),_instanceof:w("instanceof",{beforeExpr:!0,binop:7}),_typeof:w("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:w("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:w("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},S=/\r\n?|\n|\u2028|\u2029/,C=new RegExp(S.source,"g");function A(t,e){return 10===t||13===t||!e&&(8232===t||8233===t)}var T=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,k=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,M=Object.prototype,P=M.hasOwnProperty,I=M.toString;function O(t,e){return P.call(t,e)}var R=Array.isArray||function(t){return"[object Array]"===I.call(t)};function L(t){return new RegExp("^(?:"+t.replace(/ /g,"|")+")$")}var D=function(t,e){this.line=t,this.column=e};D.prototype.offset=function(t){return new D(this.line,this.column+t)};var N=function(t,e,n){this.start=e,this.end=n,null!==t.sourceFile&&(this.source=t.sourceFile)};function B(t,e){for(var n=1,r=0;;){C.lastIndex=r;var i=C.exec(t);if(!(i&&i.index<e))return new D(n,e-r);++n,r=i.index+i[0].length}}var z={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function F(t,e){return 2|(t?4:0)|(e?8:0)}var Z=function(t,e,n){this.options=t=function(t){var e={};for(var n in z)e[n]=t&&O(t,n)?t[n]:z[n];if(e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),null==e.allowReserved&&(e.allowReserved=e.ecmaVersion<5),R(e.onToken)){var r=e.onToken;e.onToken=function(t){return r.push(t)}}return R(e.onComment)&&(e.onComment=function(t,e){return function(n,r,i,o,a,s){var u={type:n?"Block":"Line",value:r,start:i,end:o};t.locations&&(u.loc=new N(this,a,s)),t.ranges&&(u.range=[i,o]),e.push(u)}}(e,e.onComment)),e}(t),this.sourceFile=t.sourceFile,this.keywords=L(a[t.ecmaVersion>=6?6:"module"===t.sourceType?"5module":5]);var r="";if(!0!==t.allowReserved){for(var o=t.ecmaVersion;!(r=i[o]);o--);"module"===t.sourceType&&(r+=" await")}this.reservedWords=L(r);var s=(r?r+" ":"")+i.strict;this.reservedWordsStrict=L(s),this.reservedWordsStrictBind=L(s+" "+i.strictBind),this.input=String(e),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(S).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=E.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===t.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},0===this.pos&&t.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(1),this.regexpState=null},j={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Z.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)},j.inFunction.get=function(){return(2&this.currentVarScope().flags)>0},j.inGenerator.get=function(){return(8&this.currentVarScope().flags)>0},j.inAsync.get=function(){return(4&this.currentVarScope().flags)>0},j.allowSuper.get=function(){return(64&this.currentThisScope().flags)>0},j.allowDirectSuper.get=function(){return(128&this.currentThisScope().flags)>0},j.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Z.prototype.inNonArrowFunction=function(){return(2&this.currentThisScope().flags)>0},Z.extend=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];for(var n=this,r=0;r<t.length;r++)n=t[r](n);return n},Z.parse=function(t,e){return new this(e,t).parse()},Z.parseExpressionAt=function(t,e,n){var r=new this(n,t,e);return r.nextToken(),r.parseExpression()},Z.tokenizer=function(t,e){return new this(e,t)},Object.defineProperties(Z.prototype,j);var U=Z.prototype,G=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;function V(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}U.strictDirective=function(t){for(;;){k.lastIndex=t,t+=k.exec(this.input)[0].length;var e=G.exec(this.input.slice(t));if(!e)return!1;if("use strict"===(e[1]||e[2])){k.lastIndex=t+e[0].length;var n=k.exec(this.input),r=n.index+n[0].length,i=this.input.charAt(r);return";"===i||"}"===i||S.test(n[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(i)||"!"===i&&"="===this.input.charAt(r+1))}t+=e[0].length,k.lastIndex=t,t+=k.exec(this.input)[0].length,";"===this.input[t]&&t++}},U.eat=function(t){return this.type===t&&(this.next(),!0)},U.isContextual=function(t){return this.type===E.name&&this.value===t&&!this.containsEsc},U.eatContextual=function(t){return!!this.isContextual(t)&&(this.next(),!0)},U.expectContextual=function(t){this.eatContextual(t)||this.unexpected()},U.canInsertSemicolon=function(){return this.type===E.eof||this.type===E.braceR||S.test(this.input.slice(this.lastTokEnd,this.start))},U.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},U.semicolon=function(){this.eat(E.semi)||this.insertSemicolon()||this.unexpected()},U.afterTrailingComma=function(t,e){if(this.type===t)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0},U.expect=function(t){this.eat(t)||this.unexpected()},U.unexpected=function(t){this.raise(null!=t?t:this.start,"Unexpected token")},U.checkPatternErrors=function(t,e){if(t){t.trailingComma>-1&&this.raiseRecoverable(t.trailingComma,"Comma is not permitted after the rest element");var n=e?t.parenthesizedAssign:t.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},U.checkExpressionErrors=function(t,e){if(!t)return!1;var n=t.shorthandAssign,r=t.doubleProto;if(!e)return n>=0||r>=0;n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),r>=0&&this.raiseRecoverable(r,"Redefinition of __proto__ property")},U.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},U.isSimpleAssignTarget=function(t){return"ParenthesizedExpression"===t.type?this.isSimpleAssignTarget(t.expression):"Identifier"===t.type||"MemberExpression"===t.type};var W=Z.prototype;W.parseTopLevel=function(t){var e={};for(t.body||(t.body=[]);this.type!==E.eof;){var n=this.parseStatement(null,!0,e);t.body.push(n)}if(this.inModule)for(var r=0,i=Object.keys(this.undefinedExports);r<i.length;r+=1){var o=i[r];this.raiseRecoverable(this.undefinedExports[o].start,"Export '"+o+"' is not defined")}return this.adaptDirectivePrologue(t.body),this.next(),t.sourceType=this.options.sourceType,this.finishNode(t,"Program")};var H={kind:"loop"},X={kind:"switch"};W.isLet=function(t){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;k.lastIndex=this.pos;var e=k.exec(this.input),n=this.pos+e[0].length,r=this.input.charCodeAt(n);if(91===r)return!0;if(t)return!1;if(123===r)return!0;if(g(r,!0)){for(var i=n+1;v(this.input.charCodeAt(i),!0);)++i;var o=this.input.slice(n,i);if(!s.test(o))return!0}return!1},W.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;k.lastIndex=this.pos;var t=k.exec(this.input),e=this.pos+t[0].length;return!(S.test(this.input.slice(this.pos,e))||"function"!==this.input.slice(e,e+8)||e+8!==this.input.length&&v(this.input.charAt(e+8)))},W.parseStatement=function(t,e,n){var r,i=this.type,o=this.startNode();switch(this.isLet(t)&&(i=E._var,r="let"),i){case E._break:case E._continue:return this.parseBreakContinueStatement(o,i.keyword);case E._debugger:return this.parseDebuggerStatement(o);case E._do:return this.parseDoStatement(o);case E._for:return this.parseForStatement(o);case E._function:return t&&(this.strict||"if"!==t&&"label"!==t)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(o,!1,!t);case E._class:return t&&this.unexpected(),this.parseClass(o,!0);case E._if:return this.parseIfStatement(o);case E._return:return this.parseReturnStatement(o);case E._switch:return this.parseSwitchStatement(o);case E._throw:return this.parseThrowStatement(o);case E._try:return this.parseTryStatement(o);case E._const:case E._var:return r=r||this.value,t&&"var"!==r&&this.unexpected(),this.parseVarStatement(o,r);case E._while:return this.parseWhileStatement(o);case E._with:return this.parseWithStatement(o);case E.braceL:return this.parseBlock(!0,o);case E.semi:return this.parseEmptyStatement(o);case E._export:case E._import:if(this.options.ecmaVersion>10&&i===E._import){k.lastIndex=this.pos;var a=k.exec(this.input),s=this.pos+a[0].length,u=this.input.charCodeAt(s);if(40===u||46===u)return this.parseExpressionStatement(o,this.parseExpression())}return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===E._import?this.parseImport(o):this.parseExport(o,n);default:if(this.isAsyncFunction())return t&&this.unexpected(),this.next(),this.parseFunctionStatement(o,!0,!t);var l=this.value,c=this.parseExpression();return i===E.name&&"Identifier"===c.type&&this.eat(E.colon)?this.parseLabeledStatement(o,l,c,t):this.parseExpressionStatement(o,c)}},W.parseBreakContinueStatement=function(t,e){var n="break"===e;this.next(),this.eat(E.semi)||this.insertSemicolon()?t.label=null:this.type!==E.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());for(var r=0;r<this.labels.length;++r){var i=this.labels[r];if(null==t.label||i.name===t.label.name){if(null!=i.kind&&(n||"loop"===i.kind))break;if(t.label&&n)break}}return r===this.labels.length&&this.raise(t.start,"Unsyntactic "+e),this.finishNode(t,n?"BreakStatement":"ContinueStatement")},W.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")},W.parseDoStatement=function(t){return this.next(),this.labels.push(H),t.body=this.parseStatement("do"),this.labels.pop(),this.expect(E._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(E.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")},W.parseForStatement=function(t){this.next();var e=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(H),this.enterScope(0),this.expect(E.parenL),this.type===E.semi)return e>-1&&this.unexpected(e),this.parseFor(t,null);var n=this.isLet();if(this.type===E._var||this.type===E._const||n){var r=this.startNode(),i=n?"let":this.value;return this.next(),this.parseVar(r,!0,i),this.finishNode(r,"VariableDeclaration"),(this.type===E._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===r.declarations.length?(this.options.ecmaVersion>=9&&(this.type===E._in?e>-1&&this.unexpected(e):t.await=e>-1),this.parseForIn(t,r)):(e>-1&&this.unexpected(e),this.parseFor(t,r))}var o=new V,a=this.parseExpression(!0,o);return this.type===E._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===E._in?e>-1&&this.unexpected(e):t.await=e>-1),this.toAssignable(a,!1,o),this.checkLVal(a),this.parseForIn(t,a)):(this.checkExpressionErrors(o,!0),e>-1&&this.unexpected(e),this.parseFor(t,a))},W.parseFunctionStatement=function(t,e,n){return this.next(),this.parseFunction(t,q|(n?0:K),!1,e)},W.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement("if"),t.alternate=this.eat(E._else)?this.parseStatement("if"):null,this.finishNode(t,"IfStatement")},W.parseReturnStatement=function(t){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(E.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")},W.parseSwitchStatement=function(t){var e;this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(E.braceL),this.labels.push(X),this.enterScope(0);for(var n=!1;this.type!==E.braceR;)if(this.type===E._case||this.type===E._default){var r=this.type===E._case;e&&this.finishNode(e,"SwitchCase"),t.cases.push(e=this.startNode()),e.consequent=[],this.next(),r?e.test=this.parseExpression():(n&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),n=!0,e.test=null),this.expect(E.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(t,"SwitchStatement")},W.parseThrowStatement=function(t){return this.next(),S.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};var Y=[];W.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===E._catch){var e=this.startNode();if(this.next(),this.eat(E.parenL)){e.param=this.parseBindingAtom();var n="Identifier"===e.param.type;this.enterScope(n?32:0),this.checkLVal(e.param,n?4:2),this.expect(E.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0);e.body=this.parseBlock(!1),this.exitScope(),t.handler=this.finishNode(e,"CatchClause")}return t.finalizer=this.eat(E._finally)?this.parseBlock():null,t.handler||t.finalizer||this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")},W.parseVarStatement=function(t,e){return this.next(),this.parseVar(t,!1,e),this.semicolon(),this.finishNode(t,"VariableDeclaration")},W.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(H),t.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(t,"WhileStatement")},W.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement("with"),this.finishNode(t,"WithStatement")},W.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")},W.parseLabeledStatement=function(t,e,n,r){for(var i=0,o=this.labels;i<o.length;i+=1)o[i].name===e&&this.raise(n.start,"Label '"+e+"' is already declared");for(var a=this.type.isLoop?"loop":this.type===E._switch?"switch":null,s=this.labels.length-1;s>=0;s--){var u=this.labels[s];if(u.statementStart!==t.start)break;u.statementStart=this.start,u.kind=a}return this.labels.push({name:e,kind:a,statementStart:this.start}),t.body=this.parseStatement(r?-1===r.indexOf("label")?r+"label":r:"label"),this.labels.pop(),t.label=n,this.finishNode(t,"LabeledStatement")},W.parseExpressionStatement=function(t,e){return t.expression=e,this.semicolon(),this.finishNode(t,"ExpressionStatement")},W.parseBlock=function(t,e,n){for(void 0===t&&(t=!0),void 0===e&&(e=this.startNode()),e.body=[],this.expect(E.braceL),t&&this.enterScope(0);this.type!==E.braceR;){var r=this.parseStatement(null);e.body.push(r)}return n&&(this.strict=!1),this.next(),t&&this.exitScope(),this.finishNode(e,"BlockStatement")},W.parseFor=function(t,e){return t.init=e,this.expect(E.semi),t.test=this.type===E.semi?null:this.parseExpression(),this.expect(E.semi),t.update=this.type===E.parenR?null:this.parseExpression(),this.expect(E.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,"ForStatement")},W.parseForIn=function(t,e){var n=this.type===E._in;return this.next(),"VariableDeclaration"===e.type&&null!=e.declarations[0].init&&(!n||this.options.ecmaVersion<8||this.strict||"var"!==e.kind||"Identifier"!==e.declarations[0].id.type)?this.raise(e.start,(n?"for-in":"for-of")+" loop variable declaration may not have an initializer"):"AssignmentPattern"===e.type&&this.raise(e.start,"Invalid left-hand side in for-loop"),t.left=e,t.right=n?this.parseExpression():this.parseMaybeAssign(),this.expect(E.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,n?"ForInStatement":"ForOfStatement")},W.parseVar=function(t,e,n){for(t.declarations=[],t.kind=n;;){var r=this.startNode();if(this.parseVarId(r,n),this.eat(E.eq)?r.init=this.parseMaybeAssign(e):"const"!==n||this.type===E._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===r.id.type||e&&(this.type===E._in||this.isContextual("of"))?r.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),t.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(E.comma))break}return t},W.parseVarId=function(t,e){t.id=this.parseBindingAtom(),this.checkLVal(t.id,"var"===e?1:2,!1)};var q=1,K=2;W.parseFunction=function(t,e,n,r){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!r)&&(this.type===E.star&&e&K&&this.unexpected(),t.generator=this.eat(E.star)),this.options.ecmaVersion>=8&&(t.async=!!r),e&q&&(t.id=4&e&&this.type!==E.name?null:this.parseIdent(),!t.id||e&K||this.checkLVal(t.id,this.strict||t.generator||t.async?this.treatFunctionsAsVar?1:2:3));var i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(F(t.async,t.generator)),e&q||(t.id=this.type===E.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,n,!1),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(t,e&q?"FunctionDeclaration":"FunctionExpression")},W.parseFunctionParams=function(t){this.expect(E.parenL),t.params=this.parseBindingList(E.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},W.parseClass=function(t,e){this.next();var n=this.strict;this.strict=!0,this.parseClassId(t,e),this.parseClassSuper(t);var r=this.startNode(),i=!1;for(r.body=[],this.expect(E.braceL);this.type!==E.braceR;){var o=this.parseClassElement(null!==t.superClass);o&&(r.body.push(o),"MethodDefinition"===o.type&&"constructor"===o.kind&&(i&&this.raise(o.start,"Duplicate constructor in the same class"),i=!0))}return this.strict=n,this.next(),t.body=this.finishNode(r,"ClassBody"),this.finishNode(t,e?"ClassDeclaration":"ClassExpression")},W.parseClassElement=function(t){var e=this;if(this.eat(E.semi))return null;var n=this.startNode(),r=function(t,r){void 0===r&&(r=!1);var i=e.start,o=e.startLoc;return!(!e.eatContextual(t)||(e.type===E.parenL||r&&e.canInsertSemicolon())&&(n.key&&e.unexpected(),n.computed=!1,n.key=e.startNodeAt(i,o),n.key.name=t,e.finishNode(n.key,"Identifier"),1))};n.kind="method",n.static=r("static");var i=this.eat(E.star),o=!1;i||(this.options.ecmaVersion>=8&&r("async",!0)?(o=!0,i=this.options.ecmaVersion>=9&&this.eat(E.star)):r("get")?n.kind="get":r("set")&&(n.kind="set")),n.key||this.parsePropertyName(n);var a=n.key,s=!1;return n.computed||n.static||!("Identifier"===a.type&&"constructor"===a.name||"Literal"===a.type&&"constructor"===a.value)?n.static&&"Identifier"===a.type&&"prototype"===a.name&&this.raise(a.start,"Classes may not have a static property named prototype"):("method"!==n.kind&&this.raise(a.start,"Constructor can't have get/set modifier"),i&&this.raise(a.start,"Constructor can't be a generator"),o&&this.raise(a.start,"Constructor can't be an async method"),n.kind="constructor",s=t),this.parseClassMethod(n,i,o,s),"get"===n.kind&&0!==n.value.params.length&&this.raiseRecoverable(n.value.start,"getter should have no params"),"set"===n.kind&&1!==n.value.params.length&&this.raiseRecoverable(n.value.start,"setter should have exactly one param"),"set"===n.kind&&"RestElement"===n.value.params[0].type&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params"),n},W.parseClassMethod=function(t,e,n,r){return t.value=this.parseMethod(e,n,r),this.finishNode(t,"MethodDefinition")},W.parseClassId=function(t,e){this.type===E.name?(t.id=this.parseIdent(),e&&this.checkLVal(t.id,2,!1)):(!0===e&&this.unexpected(),t.id=null)},W.parseClassSuper=function(t){t.superClass=this.eat(E._extends)?this.parseExprSubscripts():null},W.parseExport=function(t,e){if(this.next(),this.eat(E.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(t.exported=this.parseIdent(!0),this.checkExport(e,t.exported.name,this.lastTokStart)):t.exported=null),this.expectContextual("from"),this.type!==E.string&&this.unexpected(),t.source=this.parseExprAtom(),this.semicolon(),this.finishNode(t,"ExportAllDeclaration");if(this.eat(E._default)){var n;if(this.checkExport(e,"default",this.lastTokStart),this.type===E._function||(n=this.isAsyncFunction())){var r=this.startNode();this.next(),n&&this.next(),t.declaration=this.parseFunction(r,4|q,!1,n)}else if(this.type===E._class){var i=this.startNode();t.declaration=this.parseClass(i,"nullableID")}else t.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(t,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())t.declaration=this.parseStatement(null),"VariableDeclaration"===t.declaration.type?this.checkVariableExport(e,t.declaration.declarations):this.checkExport(e,t.declaration.id.name,t.declaration.id.start),t.specifiers=[],t.source=null;else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==E.string&&this.unexpected(),t.source=this.parseExprAtom();else{for(var o=0,a=t.specifiers;o<a.length;o+=1){var s=a[o];this.checkUnreserved(s.local),this.checkLocalExport(s.local)}t.source=null}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")},W.checkExport=function(t,e,n){t&&(O(t,e)&&this.raiseRecoverable(n,"Duplicate export '"+e+"'"),t[e]=!0)},W.checkPatternExport=function(t,e){var n=e.type;if("Identifier"===n)this.checkExport(t,e.name,e.start);else if("ObjectPattern"===n)for(var r=0,i=e.properties;r<i.length;r+=1){var o=i[r];this.checkPatternExport(t,o)}else if("ArrayPattern"===n)for(var a=0,s=e.elements;a<s.length;a+=1){var u=s[a];u&&this.checkPatternExport(t,u)}else"Property"===n?this.checkPatternExport(t,e.value):"AssignmentPattern"===n?this.checkPatternExport(t,e.left):"RestElement"===n?this.checkPatternExport(t,e.argument):"ParenthesizedExpression"===n&&this.checkPatternExport(t,e.expression)},W.checkVariableExport=function(t,e){if(t)for(var n=0,r=e;n<r.length;n+=1){var i=r[n];this.checkPatternExport(t,i.id)}},W.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},W.parseExportSpecifiers=function(t){var e=[],n=!0;for(this.expect(E.braceL);!this.eat(E.braceR);){if(n)n=!1;else if(this.expect(E.comma),this.afterTrailingComma(E.braceR))break;var r=this.startNode();r.local=this.parseIdent(!0),r.exported=this.eatContextual("as")?this.parseIdent(!0):r.local,this.checkExport(t,r.exported.name,r.exported.start),e.push(this.finishNode(r,"ExportSpecifier"))}return e},W.parseImport=function(t){return this.next(),this.type===E.string?(t.specifiers=Y,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===E.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(t,"ImportDeclaration")},W.parseImportSpecifiers=function(){var t=[],e=!0;if(this.type===E.name){var n=this.startNode();if(n.local=this.parseIdent(),this.checkLVal(n.local,2),t.push(this.finishNode(n,"ImportDefaultSpecifier")),!this.eat(E.comma))return t}if(this.type===E.star){var r=this.startNode();return this.next(),this.expectContextual("as"),r.local=this.parseIdent(),this.checkLVal(r.local,2),t.push(this.finishNode(r,"ImportNamespaceSpecifier")),t}for(this.expect(E.braceL);!this.eat(E.braceR);){if(e)e=!1;else if(this.expect(E.comma),this.afterTrailingComma(E.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,2),t.push(this.finishNode(i,"ImportSpecifier"))}return t},W.adaptDirectivePrologue=function(t){for(var e=0;e<t.length&&this.isDirectiveCandidate(t[e]);++e)t[e].directive=t[e].expression.raw.slice(1,-1)},W.isDirectiveCandidate=function(t){return"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"string"==typeof t.expression.value&&('"'===this.input[t.start]||"'"===this.input[t.start])};var Q=Z.prototype;Q.toAssignable=function(t,e,n){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"Identifier":this.inAsync&&"await"===t.name&&this.raise(t.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":t.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var r=0,i=t.properties;r<i.length;r+=1){var o=i[r];this.toAssignable(o,e),"RestElement"!==o.type||"ArrayPattern"!==o.argument.type&&"ObjectPattern"!==o.argument.type||this.raise(o.argument.start,"Unexpected token")}break;case"Property":"init"!==t.kind&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,e);break;case"ArrayExpression":t.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(t.elements,e);break;case"SpreadElement":t.type="RestElement",this.toAssignable(t.argument,e),"AssignmentPattern"===t.argument.type&&this.raise(t.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==t.operator&&this.raise(t.left.end,"Only '=' operator can be used for specifying default value."),t.type="AssignmentPattern",delete t.operator,this.toAssignable(t.left,e);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(t.expression,e,n);break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!e)break;default:this.raise(t.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return t},Q.toAssignableList=function(t,e){for(var n=t.length,r=0;r<n;r++){var i=t[r];i&&this.toAssignable(i,e)}if(n){var o=t[n-1];6===this.options.ecmaVersion&&e&&o&&"RestElement"===o.type&&"Identifier"!==o.argument.type&&this.unexpected(o.argument.start)}return t},Q.parseSpread=function(t){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,t),this.finishNode(e,"SpreadElement")},Q.parseRestBinding=function(){var t=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==E.name&&this.unexpected(),t.argument=this.parseBindingAtom(),this.finishNode(t,"RestElement")},Q.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case E.bracketL:var t=this.startNode();return this.next(),t.elements=this.parseBindingList(E.bracketR,!0,!0),this.finishNode(t,"ArrayPattern");case E.braceL:return this.parseObj(!0)}return this.parseIdent()},Q.parseBindingList=function(t,e,n){for(var r=[],i=!0;!this.eat(t);)if(i?i=!1:this.expect(E.comma),e&&this.type===E.comma)r.push(null);else{if(n&&this.afterTrailingComma(t))break;if(this.type===E.ellipsis){var o=this.parseRestBinding();this.parseBindingListItem(o),r.push(o),this.type===E.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(t);break}var a=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(a),r.push(a)}return r},Q.parseBindingListItem=function(t){return t},Q.parseMaybeDefault=function(t,e,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(E.eq))return n;var r=this.startNodeAt(t,e);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},Q.checkLVal=function(t,e,n){switch(void 0===e&&(e=0),t.type){case"Identifier":2===e&&"let"===t.name&&this.raiseRecoverable(t.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(t.name)&&this.raiseRecoverable(t.start,(e?"Binding ":"Assigning to ")+t.name+" in strict mode"),n&&(O(n,t.name)&&this.raiseRecoverable(t.start,"Argument name clash"),n[t.name]=!0),0!==e&&5!==e&&this.declareName(t.name,e,t.start);break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":e&&this.raiseRecoverable(t.start,"Binding member expression");break;case"ObjectPattern":for(var r=0,i=t.properties;r<i.length;r+=1){var o=i[r];this.checkLVal(o,e,n)}break;case"Property":this.checkLVal(t.value,e,n);break;case"ArrayPattern":for(var a=0,s=t.elements;a<s.length;a+=1){var u=s[a];u&&this.checkLVal(u,e,n)}break;case"AssignmentPattern":this.checkLVal(t.left,e,n);break;case"RestElement":this.checkLVal(t.argument,e,n);break;case"ParenthesizedExpression":this.checkLVal(t.expression,e,n);break;default:this.raise(t.start,(e?"Binding":"Assigning to")+" rvalue")}};var J=Z.prototype;J.checkPropClash=function(t,e,n){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===t.type||this.options.ecmaVersion>=6&&(t.computed||t.method||t.shorthand))){var r,i=t.key;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var o=t.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===o&&(e.proto&&(n?n.doubleProto<0&&(n.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),e.proto=!0);else{var a=e[r="$"+r];a?("init"===o?this.strict&&a.init||a.get||a.set:a.init||a[o])&&this.raiseRecoverable(i.start,"Redefinition of property"):a=e[r]={init:!1,get:!1,set:!1},a[o]=!0}}},J.parseExpression=function(t,e){var n=this.start,r=this.startLoc,i=this.parseMaybeAssign(t,e);if(this.type===E.comma){var o=this.startNodeAt(n,r);for(o.expressions=[i];this.eat(E.comma);)o.expressions.push(this.parseMaybeAssign(t,e));return this.finishNode(o,"SequenceExpression")}return i},J.parseMaybeAssign=function(t,e,n){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(t);this.exprAllowed=!1}var r=!1,i=-1,o=-1;e?(i=e.parenthesizedAssign,o=e.trailingComma,e.parenthesizedAssign=e.trailingComma=-1):(e=new V,r=!0);var a=this.start,s=this.startLoc;this.type!==E.parenL&&this.type!==E.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(t,e);if(n&&(u=n.call(this,u,a,s)),this.type.isAssign){var l=this.startNodeAt(a,s);return l.operator=this.value,l.left=this.type===E.eq?this.toAssignable(u,!1,e):u,r||(e.parenthesizedAssign=e.trailingComma=e.doubleProto=-1),e.shorthandAssign>=l.left.start&&(e.shorthandAssign=-1),this.checkLVal(u),this.next(),l.right=this.parseMaybeAssign(t),this.finishNode(l,"AssignmentExpression")}return r&&this.checkExpressionErrors(e,!0),i>-1&&(e.parenthesizedAssign=i),o>-1&&(e.trailingComma=o),u},J.parseMaybeConditional=function(t,e){var n=this.start,r=this.startLoc,i=this.parseExprOps(t,e);if(this.checkExpressionErrors(e))return i;if(this.eat(E.question)){var o=this.startNodeAt(n,r);return o.test=i,o.consequent=this.parseMaybeAssign(),this.expect(E.colon),o.alternate=this.parseMaybeAssign(t),this.finishNode(o,"ConditionalExpression")}return i},J.parseExprOps=function(t,e){var n=this.start,r=this.startLoc,i=this.parseMaybeUnary(e,!1);return this.checkExpressionErrors(e)||i.start===n&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,n,r,-1,t)},J.parseExprOp=function(t,e,n,r,i){var o=this.type.binop;if(null!=o&&(!i||this.type!==E._in)&&o>r){var a=this.type===E.logicalOR||this.type===E.logicalAND,s=this.type===E.coalesce;s&&(o=E.logicalAND.binop);var u=this.value;this.next();var l=this.start,c=this.startLoc,h=this.parseExprOp(this.parseMaybeUnary(null,!1),l,c,o,i),f=this.buildBinary(e,n,t,h,u,a||s);return(a&&this.type===E.coalesce||s&&(this.type===E.logicalOR||this.type===E.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(f,e,n,r,i)}return t},J.buildBinary=function(t,e,n,r,i,o){var a=this.startNodeAt(t,e);return a.left=n,a.operator=i,a.right=r,this.finishNode(a,o?"LogicalExpression":"BinaryExpression")},J.parseMaybeUnary=function(t,e){var n,r=this.start,i=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))n=this.parseAwait(),e=!0;else if(this.type.prefix){var o=this.startNode(),a=this.type===E.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(t,!0),a?this.checkLVal(o.argument):this.strict&&"delete"===o.operator&&"Identifier"===o.argument.type?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):e=!0,n=this.finishNode(o,a?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(t),this.checkExpressionErrors(t))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var s=this.startNodeAt(r,i);s.operator=this.value,s.prefix=!1,s.argument=n,this.checkLVal(n),this.next(),n=this.finishNode(s,"UpdateExpression")}}return!e&&this.eat(E.starstar)?this.buildBinary(r,i,n,this.parseMaybeUnary(null,!1),"**",!1):n},J.parseExprSubscripts=function(t){var e=this.start,n=this.startLoc,r=this.parseExprAtom(t);if("ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return r;var i=this.parseSubscripts(r,e,n);return t&&"MemberExpression"===i.type&&(t.parenthesizedAssign>=i.start&&(t.parenthesizedAssign=-1),t.parenthesizedBind>=i.start&&(t.parenthesizedBind=-1)),i},J.parseSubscripts=function(t,e,n,r){for(var i=this.options.ecmaVersion>=8&&"Identifier"===t.type&&"async"===t.name&&this.lastTokEnd===t.end&&!this.canInsertSemicolon()&&t.end-t.start==5&&this.potentialArrowAt===t.start,o=!1;;){var a=this.parseSubscript(t,e,n,r,i,o);if(a.optional&&(o=!0),a===t||"ArrowFunctionExpression"===a.type){if(o){var s=this.startNodeAt(e,n);s.expression=a,a=this.finishNode(s,"ChainExpression")}return a}t=a}},J.parseSubscript=function(t,e,n,r,i,o){var a=this.options.ecmaVersion>=11,s=a&&this.eat(E.questionDot);r&&s&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var u=this.eat(E.bracketL);if(u||s&&this.type!==E.parenL&&this.type!==E.backQuote||this.eat(E.dot)){var l=this.startNodeAt(e,n);l.object=t,l.property=u?this.parseExpression():this.parseIdent("never"!==this.options.allowReserved),l.computed=!!u,u&&this.expect(E.bracketR),a&&(l.optional=s),t=this.finishNode(l,"MemberExpression")}else if(!r&&this.eat(E.parenL)){var c=new V,h=this.yieldPos,f=this.awaitPos,p=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var d=this.parseExprList(E.parenR,this.options.ecmaVersion>=8,!1,c);if(i&&!s&&!this.canInsertSemicolon()&&this.eat(E.arrow))return this.checkPatternErrors(c,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=h,this.awaitPos=f,this.awaitIdentPos=p,this.parseArrowExpression(this.startNodeAt(e,n),d,!0);this.checkExpressionErrors(c,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=f||this.awaitPos,this.awaitIdentPos=p||this.awaitIdentPos;var g=this.startNodeAt(e,n);g.callee=t,g.arguments=d,a&&(g.optional=s),t=this.finishNode(g,"CallExpression")}else if(this.type===E.backQuote){(s||o)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var v=this.startNodeAt(e,n);v.tag=t,v.quasi=this.parseTemplate({isTagged:!0}),t=this.finishNode(v,"TaggedTemplateExpression")}return t},J.parseExprAtom=function(t){this.type===E.slash&&this.readRegexp();var e,n=this.potentialArrowAt===this.start;switch(this.type){case E._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),e=this.startNode(),this.next(),this.type!==E.parenL||this.allowDirectSuper||this.raise(e.start,"super() call outside constructor of a subclass"),this.type!==E.dot&&this.type!==E.bracketL&&this.type!==E.parenL&&this.unexpected(),this.finishNode(e,"Super");case E._this:return e=this.startNode(),this.next(),this.finishNode(e,"ThisExpression");case E.name:var r=this.start,i=this.startLoc,o=this.containsEsc,a=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(E._function))return this.parseFunction(this.startNodeAt(r,i),0,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(E.arrow))return this.parseArrowExpression(this.startNodeAt(r,i),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===E.name&&!o)return a=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(E.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,i),[a],!0)}return a;case E.regexp:var s=this.value;return(e=this.parseLiteral(s.value)).regex={pattern:s.pattern,flags:s.flags},e;case E.num:case E.string:return this.parseLiteral(this.value);case E._null:case E._true:case E._false:return(e=this.startNode()).value=this.type===E._null?null:this.type===E._true,e.raw=this.type.keyword,this.next(),this.finishNode(e,"Literal");case E.parenL:var u=this.start,l=this.parseParenAndDistinguishExpression(n);return t&&(t.parenthesizedAssign<0&&!this.isSimpleAssignTarget(l)&&(t.parenthesizedAssign=u),t.parenthesizedBind<0&&(t.parenthesizedBind=u)),l;case E.bracketL:return e=this.startNode(),this.next(),e.elements=this.parseExprList(E.bracketR,!0,!0,t),this.finishNode(e,"ArrayExpression");case E.braceL:return this.parseObj(!1,t);case E._function:return e=this.startNode(),this.next(),this.parseFunction(e,0);case E._class:return this.parseClass(this.startNode(),!1);case E._new:return this.parseNew();case E.backQuote:return this.parseTemplate();case E._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},J.parseExprImport=function(){var t=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var e=this.parseIdent(!0);switch(this.type){case E.parenL:return this.parseDynamicImport(t);case E.dot:return t.meta=e,this.parseImportMeta(t);default:this.unexpected()}},J.parseDynamicImport=function(t){if(this.next(),t.source=this.parseMaybeAssign(),!this.eat(E.parenR)){var e=this.start;this.eat(E.comma)&&this.eat(E.parenR)?this.raiseRecoverable(e,"Trailing comma is not allowed in import()"):this.unexpected(e)}return this.finishNode(t,"ImportExpression")},J.parseImportMeta=function(t){this.next();var e=this.containsEsc;return t.property=this.parseIdent(!0),"meta"!==t.property.name&&this.raiseRecoverable(t.property.start,"The only valid meta property for import is 'import.meta'"),e&&this.raiseRecoverable(t.start,"'import.meta' must not contain escaped characters"),"module"!==this.options.sourceType&&this.raiseRecoverable(t.start,"Cannot use 'import.meta' outside a module"),this.finishNode(t,"MetaProperty")},J.parseLiteral=function(t){var e=this.startNode();return e.value=t,e.raw=this.input.slice(this.start,this.end),110===e.raw.charCodeAt(e.raw.length-1)&&(e.bigint=e.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(e,"Literal")},J.parseParenExpression=function(){this.expect(E.parenL);var t=this.parseExpression();return this.expect(E.parenR),t},J.parseParenAndDistinguishExpression=function(t){var e,n=this.start,r=this.startLoc,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var o,a=this.start,s=this.startLoc,u=[],l=!0,c=!1,h=new V,f=this.yieldPos,p=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==E.parenR;){if(l?l=!1:this.expect(E.comma),i&&this.afterTrailingComma(E.parenR,!0)){c=!0;break}if(this.type===E.ellipsis){o=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===E.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}u.push(this.parseMaybeAssign(!1,h,this.parseParenItem))}var d=this.start,g=this.startLoc;if(this.expect(E.parenR),t&&!this.canInsertSemicolon()&&this.eat(E.arrow))return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=f,this.awaitPos=p,this.parseParenArrowList(n,r,u);u.length&&!c||this.unexpected(this.lastTokStart),o&&this.unexpected(o),this.checkExpressionErrors(h,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=p||this.awaitPos,u.length>1?((e=this.startNodeAt(a,s)).expressions=u,this.finishNodeAt(e,"SequenceExpression",d,g)):e=u[0]}else e=this.parseParenExpression();if(this.options.preserveParens){var v=this.startNodeAt(n,r);return v.expression=e,this.finishNode(v,"ParenthesizedExpression")}return e},J.parseParenItem=function(t){return t},J.parseParenArrowList=function(t,e,n){return this.parseArrowExpression(this.startNodeAt(t,e),n)};var $=[];J.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var t=this.startNode(),e=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(E.dot)){t.meta=e;var n=this.containsEsc;return t.property=this.parseIdent(!0),"target"!==t.property.name&&this.raiseRecoverable(t.property.start,"The only valid meta property for new is 'new.target'"),n&&this.raiseRecoverable(t.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(t.start,"'new.target' can only be used in functions"),this.finishNode(t,"MetaProperty")}var r=this.start,i=this.startLoc,o=this.type===E._import;return t.callee=this.parseSubscripts(this.parseExprAtom(),r,i,!0),o&&"ImportExpression"===t.callee.type&&this.raise(r,"Cannot use new with import()"),this.eat(E.parenL)?t.arguments=this.parseExprList(E.parenR,this.options.ecmaVersion>=8,!1):t.arguments=$,this.finishNode(t,"NewExpression")},J.parseTemplateElement=function(t){var e=t.isTagged,n=this.startNode();return this.type===E.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===E.backQuote,this.finishNode(n,"TemplateElement")},J.parseTemplate=function(t){void 0===t&&(t={});var e=t.isTagged;void 0===e&&(e=!1);var n=this.startNode();this.next(),n.expressions=[];var r=this.parseTemplateElement({isTagged:e});for(n.quasis=[r];!r.tail;)this.type===E.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(E.dollarBraceL),n.expressions.push(this.parseExpression()),this.expect(E.braceR),n.quasis.push(r=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(n,"TemplateLiteral")},J.isAsyncProp=function(t){return!t.computed&&"Identifier"===t.key.type&&"async"===t.key.name&&(this.type===E.name||this.type===E.num||this.type===E.string||this.type===E.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===E.star)&&!S.test(this.input.slice(this.lastTokEnd,this.start))},J.parseObj=function(t,e){var n=this.startNode(),r=!0,i={};for(n.properties=[],this.next();!this.eat(E.braceR);){if(r)r=!1;else if(this.expect(E.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(E.braceR))break;var o=this.parseProperty(t,e);t||this.checkPropClash(o,i,e),n.properties.push(o)}return this.finishNode(n,t?"ObjectPattern":"ObjectExpression")},J.parseProperty=function(t,e){var n,r,i,o,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(E.ellipsis))return t?(a.argument=this.parseIdent(!1),this.type===E.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(this.type===E.parenL&&e&&(e.parenthesizedAssign<0&&(e.parenthesizedAssign=this.start),e.parenthesizedBind<0&&(e.parenthesizedBind=this.start)),a.argument=this.parseMaybeAssign(!1,e),this.type===E.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(t||e)&&(i=this.start,o=this.startLoc),t||(n=this.eat(E.star)));var s=this.containsEsc;return this.parsePropertyName(a),!t&&!s&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(a)?(r=!0,n=this.options.ecmaVersion>=9&&this.eat(E.star),this.parsePropertyName(a,e)):r=!1,this.parsePropertyValue(a,t,n,r,i,o,e,s),this.finishNode(a,"Property")},J.parsePropertyValue=function(t,e,n,r,i,o,a,s){if((n||r)&&this.type===E.colon&&this.unexpected(),this.eat(E.colon))t.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),t.kind="init";else if(this.options.ecmaVersion>=6&&this.type===E.parenL)e&&this.unexpected(),t.kind="init",t.method=!0,t.value=this.parseMethod(n,r);else if(e||s||!(this.options.ecmaVersion>=5)||t.computed||"Identifier"!==t.key.type||"get"!==t.key.name&&"set"!==t.key.name||this.type===E.comma||this.type===E.braceR||this.type===E.eq)this.options.ecmaVersion>=6&&!t.computed&&"Identifier"===t.key.type?((n||r)&&this.unexpected(),this.checkUnreserved(t.key),"await"!==t.key.name||this.awaitIdentPos||(this.awaitIdentPos=i),t.kind="init",e?t.value=this.parseMaybeDefault(i,o,t.key):this.type===E.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),t.value=this.parseMaybeDefault(i,o,t.key)):t.value=t.key,t.shorthand=!0):this.unexpected();else{(n||r)&&this.unexpected(),t.kind=t.key.name,this.parsePropertyName(t),t.value=this.parseMethod(!1);var u="get"===t.kind?0:1;if(t.value.params.length!==u){var l=t.value.start;"get"===t.kind?this.raiseRecoverable(l,"getter should have no params"):this.raiseRecoverable(l,"setter should have exactly one param")}else"set"===t.kind&&"RestElement"===t.value.params[0].type&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params")}},J.parsePropertyName=function(t){if(this.options.ecmaVersion>=6){if(this.eat(E.bracketL))return t.computed=!0,t.key=this.parseMaybeAssign(),this.expect(E.bracketR),t.key;t.computed=!1}return t.key=this.type===E.num||this.type===E.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},J.initFunction=function(t){t.id=null,this.options.ecmaVersion>=6&&(t.generator=t.expression=!1),this.options.ecmaVersion>=8&&(t.async=!1)},J.parseMethod=function(t,e,n){var r=this.startNode(),i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=t),this.options.ecmaVersion>=8&&(r.async=!!e),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(64|F(e,r.generator)|(n?128:0)),this.expect(E.parenL),r.params=this.parseBindingList(E.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1,!0),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(r,"FunctionExpression")},J.parseArrowExpression=function(t,e,n){var r=this.yieldPos,i=this.awaitPos,o=this.awaitIdentPos;return this.enterScope(16|F(n,!1)),this.initFunction(t),this.options.ecmaVersion>=8&&(t.async=!!n),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,t.params=this.toAssignableList(e,!0),this.parseFunctionBody(t,!0,!1),this.yieldPos=r,this.awaitPos=i,this.awaitIdentPos=o,this.finishNode(t,"ArrowFunctionExpression")},J.parseFunctionBody=function(t,e,n){var r=e&&this.type!==E.braceL,i=this.strict,o=!1;if(r)t.body=this.parseMaybeAssign(),t.expression=!0,this.checkParams(t,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(t.params);i&&!a||(o=this.strictDirective(this.end))&&a&&this.raiseRecoverable(t.start,"Illegal 'use strict' directive in function with non-simple parameter list");var s=this.labels;this.labels=[],o&&(this.strict=!0),this.checkParams(t,!i&&!o&&!e&&!n&&this.isSimpleParamList(t.params)),this.strict&&t.id&&this.checkLVal(t.id,5),t.body=this.parseBlock(!1,void 0,o&&!i),t.expression=!1,this.adaptDirectivePrologue(t.body.body),this.labels=s}this.exitScope()},J.isSimpleParamList=function(t){for(var e=0,n=t;e<n.length;e+=1)if("Identifier"!==n[e].type)return!1;return!0},J.checkParams=function(t,e){for(var n={},r=0,i=t.params;r<i.length;r+=1){var o=i[r];this.checkLVal(o,1,e?null:n)}},J.parseExprList=function(t,e,n,r){for(var i=[],o=!0;!this.eat(t);){if(o)o=!1;else if(this.expect(E.comma),e&&this.afterTrailingComma(t))break;var a=void 0;n&&this.type===E.comma?a=null:this.type===E.ellipsis?(a=this.parseSpread(r),r&&this.type===E.comma&&r.trailingComma<0&&(r.trailingComma=this.start)):a=this.parseMaybeAssign(!1,r),i.push(a)}return i},J.checkUnreserved=function(t){var e=t.start,n=t.end,r=t.name;this.inGenerator&&"yield"===r&&this.raiseRecoverable(e,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(e,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(r)&&this.raise(e,"Unexpected keyword '"+r+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(e,n).indexOf("\\")||(this.strict?this.reservedWordsStrict:this.reservedWords).test(r)&&(this.inAsync||"await"!==r||this.raiseRecoverable(e,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+r+"' is reserved"))},J.parseIdent=function(t,e){var n=this.startNode();return this.type===E.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(!!t),this.finishNode(n,"Identifier"),t||(this.checkUnreserved(n),"await"!==n.name||this.awaitIdentPos||(this.awaitIdentPos=n.start)),n},J.parseYield=function(t){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===E.semi||this.canInsertSemicolon()||this.type!==E.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(E.star),e.argument=this.parseMaybeAssign(t)),this.finishNode(e,"YieldExpression")},J.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!1),this.finishNode(t,"AwaitExpression")};var tt=Z.prototype;tt.raise=function(t,e){var n=B(this.input,t);e+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(e);throw r.pos=t,r.loc=n,r.raisedAt=this.pos,r},tt.raiseRecoverable=tt.raise,tt.curPosition=function(){if(this.options.locations)return new D(this.curLine,this.pos-this.lineStart)};var et=Z.prototype,nt=function(t){this.flags=t,this.var=[],this.lexical=[],this.functions=[]};et.enterScope=function(t){this.scopeStack.push(new nt(t))},et.exitScope=function(){this.scopeStack.pop()},et.treatFunctionsAsVarInScope=function(t){return 2&t.flags||!this.inModule&&1&t.flags},et.declareName=function(t,e,n){var r=!1;if(2===e){var i=this.currentScope();r=i.lexical.indexOf(t)>-1||i.functions.indexOf(t)>-1||i.var.indexOf(t)>-1,i.lexical.push(t),this.inModule&&1&i.flags&&delete this.undefinedExports[t]}else if(4===e)this.currentScope().lexical.push(t);else if(3===e){var o=this.currentScope();r=this.treatFunctionsAsVar?o.lexical.indexOf(t)>-1:o.lexical.indexOf(t)>-1||o.var.indexOf(t)>-1,o.functions.push(t)}else for(var a=this.scopeStack.length-1;a>=0;--a){var s=this.scopeStack[a];if(s.lexical.indexOf(t)>-1&&!(32&s.flags&&s.lexical[0]===t)||!this.treatFunctionsAsVarInScope(s)&&s.functions.indexOf(t)>-1){r=!0;break}if(s.var.push(t),this.inModule&&1&s.flags&&delete this.undefinedExports[t],3&s.flags)break}r&&this.raiseRecoverable(n,"Identifier '"+t+"' has already been declared")},et.checkLocalExport=function(t){-1===this.scopeStack[0].lexical.indexOf(t.name)&&-1===this.scopeStack[0].var.indexOf(t.name)&&(this.undefinedExports[t.name]=t)},et.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},et.currentVarScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(3&e.flags)return e}},et.currentThisScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(3&e.flags&&!(16&e.flags))return e}};var rt=function(t,e,n){this.type="",this.start=e,this.end=0,t.options.locations&&(this.loc=new N(t,n)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[e,0])},it=Z.prototype;function ot(t,e,n,r){return t.type=e,t.end=n,this.options.locations&&(t.loc.end=r),this.options.ranges&&(t.range[1]=n),t}it.startNode=function(){return new rt(this,this.start,this.startLoc)},it.startNodeAt=function(t,e){return new rt(this,t,e)},it.finishNode=function(t,e){return ot.call(this,t,e,this.lastTokEnd,this.lastTokEndLoc)},it.finishNodeAt=function(t,e,n,r){return ot.call(this,t,e,n,r)};var at=function(t,e,n,r,i){this.token=t,this.isExpr=!!e,this.preserveSpace=!!n,this.override=r,this.generator=!!i},st={b_stat:new at("{",!1),b_expr:new at("{",!0),b_tmpl:new at("${",!1),p_stat:new at("(",!1),p_expr:new at("(",!0),q_tmpl:new at("`",!0,!0,(function(t){return t.tryReadTemplateToken()})),f_stat:new at("function",!1),f_expr:new at("function",!0),f_expr_gen:new at("function",!0,!1,null,!0),f_gen:new at("function",!1,!1,null,!0)},ut=Z.prototype;ut.initialContext=function(){return[st.b_stat]},ut.braceIsBlock=function(t){var e=this.curContext();return e===st.f_expr||e===st.f_stat||(t!==E.colon||e!==st.b_stat&&e!==st.b_expr?t===E._return||t===E.name&&this.exprAllowed?S.test(this.input.slice(this.lastTokEnd,this.start)):t===E._else||t===E.semi||t===E.eof||t===E.parenR||t===E.arrow||(t===E.braceL?e===st.b_stat:t!==E._var&&t!==E._const&&t!==E.name&&!this.exprAllowed):!e.isExpr)},ut.inGeneratorContext=function(){for(var t=this.context.length-1;t>=1;t--){var e=this.context[t];if("function"===e.token)return e.generator}return!1},ut.updateContext=function(t){var e,n=this.type;n.keyword&&t===E.dot?this.exprAllowed=!1:(e=n.updateContext)?e.call(this,t):this.exprAllowed=n.beforeExpr},E.parenR.updateContext=E.braceR.updateContext=function(){if(1!==this.context.length){var t=this.context.pop();t===st.b_stat&&"function"===this.curContext().token&&(t=this.context.pop()),this.exprAllowed=!t.isExpr}else this.exprAllowed=!0},E.braceL.updateContext=function(t){this.context.push(this.braceIsBlock(t)?st.b_stat:st.b_expr),this.exprAllowed=!0},E.dollarBraceL.updateContext=function(){this.context.push(st.b_tmpl),this.exprAllowed=!0},E.parenL.updateContext=function(t){var e=t===E._if||t===E._for||t===E._with||t===E._while;this.context.push(e?st.p_stat:st.p_expr),this.exprAllowed=!0},E.incDec.updateContext=function(){},E._function.updateContext=E._class.updateContext=function(t){!t.beforeExpr||t===E.semi||t===E._else||t===E._return&&S.test(this.input.slice(this.lastTokEnd,this.start))||(t===E.colon||t===E.braceL)&&this.curContext()===st.b_stat?this.context.push(st.f_stat):this.context.push(st.f_expr),this.exprAllowed=!1},E.backQuote.updateContext=function(){this.curContext()===st.q_tmpl?this.context.pop():this.context.push(st.q_tmpl),this.exprAllowed=!1},E.star.updateContext=function(t){if(t===E._function){var e=this.context.length-1;this.context[e]===st.f_expr?this.context[e]=st.f_expr_gen:this.context[e]=st.f_gen}this.exprAllowed=!0},E.name.updateContext=function(t){var e=!1;this.options.ecmaVersion>=6&&t!==E.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var lt="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ct={9:lt,10:"ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS Extended_Pictographic",11:"ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS Extended_Pictographic"},ht="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",ft="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",pt={9:ft,10:"Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",11:"Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho"},dt={};function gt(t){var e=dt[t]={binary:L(ct[t]+" "+ht),nonBinary:{General_Category:L(ht),Script:L(pt[t])}};e.nonBinary.Script_Extensions=e.nonBinary.Script,e.nonBinary.gc=e.nonBinary.General_Category,e.nonBinary.sc=e.nonBinary.Script,e.nonBinary.scx=e.nonBinary.Script_Extensions}gt(9),gt(10),gt(11);var vt=Z.prototype,mt=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":""),this.unicodeProperties=dt[t.options.ecmaVersion>=11?11:t.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function yt(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function _t(t){return 36===t||t>=40&&t<=43||46===t||63===t||t>=91&&t<=94||t>=123&&t<=125}function bt(t){return t>=65&&t<=90||t>=97&&t<=122}function xt(t){return bt(t)||95===t}function wt(t){return xt(t)||Et(t)}function Et(t){return t>=48&&t<=57}function St(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function Ct(t){return t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:t-48}function At(t){return t>=48&&t<=55}mt.prototype.reset=function(t,e,n){var r=-1!==n.indexOf("u");this.start=0|t,this.source=e+"",this.flags=n,this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchN=r&&this.parser.options.ecmaVersion>=9},mt.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)},mt.prototype.at=function(t,e){void 0===e&&(e=!1);var n=this.source,r=n.length;if(t>=r)return-1;var i=n.charCodeAt(t);if(!e&&!this.switchU||i<=55295||i>=57344||t+1>=r)return i;var o=n.charCodeAt(t+1);return o>=56320&&o<=57343?(i<<10)+o-56613888:i},mt.prototype.nextIndex=function(t,e){void 0===e&&(e=!1);var n=this.source,r=n.length;if(t>=r)return r;var i,o=n.charCodeAt(t);return!e&&!this.switchU||o<=55295||o>=57344||t+1>=r||(i=n.charCodeAt(t+1))<56320||i>57343?t+1:t+2},mt.prototype.current=function(t){return void 0===t&&(t=!1),this.at(this.pos,t)},mt.prototype.lookahead=function(t){return void 0===t&&(t=!1),this.at(this.nextIndex(this.pos,t),t)},mt.prototype.advance=function(t){void 0===t&&(t=!1),this.pos=this.nextIndex(this.pos,t)},mt.prototype.eat=function(t,e){return void 0===e&&(e=!1),this.current(e)===t&&(this.advance(e),!0)},vt.validateRegExpFlags=function(t){for(var e=t.validFlags,n=t.flags,r=0;r<n.length;r++){var i=n.charAt(r);-1===e.indexOf(i)&&this.raise(t.start,"Invalid regular expression flag"),n.indexOf(i,r+1)>-1&&this.raise(t.start,"Duplicate regular expression flag")}},vt.validateRegExpPattern=function(t){this.regexp_pattern(t),!t.switchN&&this.options.ecmaVersion>=9&&t.groupNames.length>0&&(t.switchN=!0,this.regexp_pattern(t))},vt.regexp_pattern=function(t){t.pos=0,t.lastIntValue=0,t.lastStringValue="",t.lastAssertionIsQuantifiable=!1,t.numCapturingParens=0,t.maxBackReference=0,t.groupNames.length=0,t.backReferenceNames.length=0,this.regexp_disjunction(t),t.pos!==t.source.length&&(t.eat(41)&&t.raise("Unmatched ')'"),(t.eat(93)||t.eat(125))&&t.raise("Lone quantifier brackets")),t.maxBackReference>t.numCapturingParens&&t.raise("Invalid escape");for(var e=0,n=t.backReferenceNames;e<n.length;e+=1){var r=n[e];-1===t.groupNames.indexOf(r)&&t.raise("Invalid named capture referenced")}},vt.regexp_disjunction=function(t){for(this.regexp_alternative(t);t.eat(124);)this.regexp_alternative(t);this.regexp_eatQuantifier(t,!0)&&t.raise("Nothing to repeat"),t.eat(123)&&t.raise("Lone quantifier brackets")},vt.regexp_alternative=function(t){for(;t.pos<t.source.length&&this.regexp_eatTerm(t););},vt.regexp_eatTerm=function(t){return this.regexp_eatAssertion(t)?(t.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(t)&&t.switchU&&t.raise("Invalid quantifier"),!0):!!(t.switchU?this.regexp_eatAtom(t):this.regexp_eatExtendedAtom(t))&&(this.regexp_eatQuantifier(t),!0)},vt.regexp_eatAssertion=function(t){var e=t.pos;if(t.lastAssertionIsQuantifiable=!1,t.eat(94)||t.eat(36))return!0;if(t.eat(92)){if(t.eat(66)||t.eat(98))return!0;t.pos=e}if(t.eat(40)&&t.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=t.eat(60)),t.eat(61)||t.eat(33))return this.regexp_disjunction(t),t.eat(41)||t.raise("Unterminated group"),t.lastAssertionIsQuantifiable=!n,!0}return t.pos=e,!1},vt.regexp_eatQuantifier=function(t,e){return void 0===e&&(e=!1),!!this.regexp_eatQuantifierPrefix(t,e)&&(t.eat(63),!0)},vt.regexp_eatQuantifierPrefix=function(t,e){return t.eat(42)||t.eat(43)||t.eat(63)||this.regexp_eatBracedQuantifier(t,e)},vt.regexp_eatBracedQuantifier=function(t,e){var n=t.pos;if(t.eat(123)){var r=0,i=-1;if(this.regexp_eatDecimalDigits(t)&&(r=t.lastIntValue,t.eat(44)&&this.regexp_eatDecimalDigits(t)&&(i=t.lastIntValue),t.eat(125)))return-1!==i&&i<r&&!e&&t.raise("numbers out of order in {} quantifier"),!0;t.switchU&&!e&&t.raise("Incomplete quantifier"),t.pos=n}return!1},vt.regexp_eatAtom=function(t){return this.regexp_eatPatternCharacters(t)||t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)},vt.regexp_eatReverseSolidusAtomEscape=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatAtomEscape(t))return!0;t.pos=e}return!1},vt.regexp_eatUncapturingGroup=function(t){var e=t.pos;if(t.eat(40)){if(t.eat(63)&&t.eat(58)){if(this.regexp_disjunction(t),t.eat(41))return!0;t.raise("Unterminated group")}t.pos=e}return!1},vt.regexp_eatCapturingGroup=function(t){if(t.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(t):63===t.current()&&t.raise("Invalid group"),this.regexp_disjunction(t),t.eat(41))return t.numCapturingParens+=1,!0;t.raise("Unterminated group")}return!1},vt.regexp_eatExtendedAtom=function(t){return t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)||this.regexp_eatInvalidBracedQuantifier(t)||this.regexp_eatExtendedPatternCharacter(t)},vt.regexp_eatInvalidBracedQuantifier=function(t){return this.regexp_eatBracedQuantifier(t,!0)&&t.raise("Nothing to repeat"),!1},vt.regexp_eatSyntaxCharacter=function(t){var e=t.current();return!!_t(e)&&(t.lastIntValue=e,t.advance(),!0)},vt.regexp_eatPatternCharacters=function(t){for(var e=t.pos,n=0;-1!==(n=t.current())&&!_t(n);)t.advance();return t.pos!==e},vt.regexp_eatExtendedPatternCharacter=function(t){var e=t.current();return!(-1===e||36===e||e>=40&&e<=43||46===e||63===e||91===e||94===e||124===e||(t.advance(),0))},vt.regexp_groupSpecifier=function(t){if(t.eat(63)){if(this.regexp_eatGroupName(t))return-1!==t.groupNames.indexOf(t.lastStringValue)&&t.raise("Duplicate capture group name"),void t.groupNames.push(t.lastStringValue);t.raise("Invalid group")}},vt.regexp_eatGroupName=function(t){if(t.lastStringValue="",t.eat(60)){if(this.regexp_eatRegExpIdentifierName(t)&&t.eat(62))return!0;t.raise("Invalid capture group name")}return!1},vt.regexp_eatRegExpIdentifierName=function(t){if(t.lastStringValue="",this.regexp_eatRegExpIdentifierStart(t)){for(t.lastStringValue+=yt(t.lastIntValue);this.regexp_eatRegExpIdentifierPart(t);)t.lastStringValue+=yt(t.lastIntValue);return!0}return!1},vt.regexp_eatRegExpIdentifierStart=function(t){var e=t.pos,n=this.options.ecmaVersion>=11,r=t.current(n);return t.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(t,n)&&(r=t.lastIntValue),function(t){return g(t,!0)||36===t||95===t}(r)?(t.lastIntValue=r,!0):(t.pos=e,!1)},vt.regexp_eatRegExpIdentifierPart=function(t){var e=t.pos,n=this.options.ecmaVersion>=11,r=t.current(n);return t.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(t,n)&&(r=t.lastIntValue),function(t){return v(t,!0)||36===t||95===t||8204===t||8205===t}(r)?(t.lastIntValue=r,!0):(t.pos=e,!1)},vt.regexp_eatAtomEscape=function(t){return!!(this.regexp_eatBackReference(t)||this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)||t.switchN&&this.regexp_eatKGroupName(t))||(t.switchU&&(99===t.current()&&t.raise("Invalid unicode escape"),t.raise("Invalid escape")),!1)},vt.regexp_eatBackReference=function(t){var e=t.pos;if(this.regexp_eatDecimalEscape(t)){var n=t.lastIntValue;if(t.switchU)return n>t.maxBackReference&&(t.maxBackReference=n),!0;if(n<=t.numCapturingParens)return!0;t.pos=e}return!1},vt.regexp_eatKGroupName=function(t){if(t.eat(107)){if(this.regexp_eatGroupName(t))return t.backReferenceNames.push(t.lastStringValue),!0;t.raise("Invalid named reference")}return!1},vt.regexp_eatCharacterEscape=function(t){return this.regexp_eatControlEscape(t)||this.regexp_eatCControlLetter(t)||this.regexp_eatZero(t)||this.regexp_eatHexEscapeSequence(t)||this.regexp_eatRegExpUnicodeEscapeSequence(t,!1)||!t.switchU&&this.regexp_eatLegacyOctalEscapeSequence(t)||this.regexp_eatIdentityEscape(t)},vt.regexp_eatCControlLetter=function(t){var e=t.pos;if(t.eat(99)){if(this.regexp_eatControlLetter(t))return!0;t.pos=e}return!1},vt.regexp_eatZero=function(t){return 48===t.current()&&!Et(t.lookahead())&&(t.lastIntValue=0,t.advance(),!0)},vt.regexp_eatControlEscape=function(t){var e=t.current();return 116===e?(t.lastIntValue=9,t.advance(),!0):110===e?(t.lastIntValue=10,t.advance(),!0):118===e?(t.lastIntValue=11,t.advance(),!0):102===e?(t.lastIntValue=12,t.advance(),!0):114===e&&(t.lastIntValue=13,t.advance(),!0)},vt.regexp_eatControlLetter=function(t){var e=t.current();return!!bt(e)&&(t.lastIntValue=e%32,t.advance(),!0)},vt.regexp_eatRegExpUnicodeEscapeSequence=function(t,e){void 0===e&&(e=!1);var n,r=t.pos,i=e||t.switchU;if(t.eat(117)){if(this.regexp_eatFixedHexDigits(t,4)){var o=t.lastIntValue;if(i&&o>=55296&&o<=56319){var a=t.pos;if(t.eat(92)&&t.eat(117)&&this.regexp_eatFixedHexDigits(t,4)){var s=t.lastIntValue;if(s>=56320&&s<=57343)return t.lastIntValue=1024*(o-55296)+(s-56320)+65536,!0}t.pos=a,t.lastIntValue=o}return!0}if(i&&t.eat(123)&&this.regexp_eatHexDigits(t)&&t.eat(125)&&(n=t.lastIntValue)>=0&&n<=1114111)return!0;i&&t.raise("Invalid unicode escape"),t.pos=r}return!1},vt.regexp_eatIdentityEscape=function(t){if(t.switchU)return!!this.regexp_eatSyntaxCharacter(t)||!!t.eat(47)&&(t.lastIntValue=47,!0);var e=t.current();return!(99===e||t.switchN&&107===e||(t.lastIntValue=e,t.advance(),0))},vt.regexp_eatDecimalEscape=function(t){t.lastIntValue=0;var e=t.current();if(e>=49&&e<=57){do{t.lastIntValue=10*t.lastIntValue+(e-48),t.advance()}while((e=t.current())>=48&&e<=57);return!0}return!1},vt.regexp_eatCharacterClassEscape=function(t){var e=t.current();if(function(t){return 100===t||68===t||115===t||83===t||119===t||87===t}(e))return t.lastIntValue=-1,t.advance(),!0;if(t.switchU&&this.options.ecmaVersion>=9&&(80===e||112===e)){if(t.lastIntValue=-1,t.advance(),t.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(t)&&t.eat(125))return!0;t.raise("Invalid property name")}return!1},vt.regexp_eatUnicodePropertyValueExpression=function(t){var e=t.pos;if(this.regexp_eatUnicodePropertyName(t)&&t.eat(61)){var n=t.lastStringValue;if(this.regexp_eatUnicodePropertyValue(t)){var r=t.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(t,n,r),!0}}if(t.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(t)){var i=t.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(t,i),!0}return!1},vt.regexp_validateUnicodePropertyNameAndValue=function(t,e,n){O(t.unicodeProperties.nonBinary,e)||t.raise("Invalid property name"),t.unicodeProperties.nonBinary[e].test(n)||t.raise("Invalid property value")},vt.regexp_validateUnicodePropertyNameOrValue=function(t,e){t.unicodeProperties.binary.test(e)||t.raise("Invalid property name")},vt.regexp_eatUnicodePropertyName=function(t){var e=0;for(t.lastStringValue="";xt(e=t.current());)t.lastStringValue+=yt(e),t.advance();return""!==t.lastStringValue},vt.regexp_eatUnicodePropertyValue=function(t){var e=0;for(t.lastStringValue="";wt(e=t.current());)t.lastStringValue+=yt(e),t.advance();return""!==t.lastStringValue},vt.regexp_eatLoneUnicodePropertyNameOrValue=function(t){return this.regexp_eatUnicodePropertyValue(t)},vt.regexp_eatCharacterClass=function(t){if(t.eat(91)){if(t.eat(94),this.regexp_classRanges(t),t.eat(93))return!0;t.raise("Unterminated character class")}return!1},vt.regexp_classRanges=function(t){for(;this.regexp_eatClassAtom(t);){var e=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassAtom(t)){var n=t.lastIntValue;!t.switchU||-1!==e&&-1!==n||t.raise("Invalid character class"),-1!==e&&-1!==n&&e>n&&t.raise("Range out of order in character class")}}},vt.regexp_eatClassAtom=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatClassEscape(t))return!0;if(t.switchU){var n=t.current();(99===n||At(n))&&t.raise("Invalid class escape"),t.raise("Invalid escape")}t.pos=e}var r=t.current();return 93!==r&&(t.lastIntValue=r,t.advance(),!0)},vt.regexp_eatClassEscape=function(t){var e=t.pos;if(t.eat(98))return t.lastIntValue=8,!0;if(t.switchU&&t.eat(45))return t.lastIntValue=45,!0;if(!t.switchU&&t.eat(99)){if(this.regexp_eatClassControlLetter(t))return!0;t.pos=e}return this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)},vt.regexp_eatClassControlLetter=function(t){var e=t.current();return!(!Et(e)&&95!==e||(t.lastIntValue=e%32,t.advance(),0))},vt.regexp_eatHexEscapeSequence=function(t){var e=t.pos;if(t.eat(120)){if(this.regexp_eatFixedHexDigits(t,2))return!0;t.switchU&&t.raise("Invalid escape"),t.pos=e}return!1},vt.regexp_eatDecimalDigits=function(t){var e=t.pos,n=0;for(t.lastIntValue=0;Et(n=t.current());)t.lastIntValue=10*t.lastIntValue+(n-48),t.advance();return t.pos!==e},vt.regexp_eatHexDigits=function(t){var e=t.pos,n=0;for(t.lastIntValue=0;St(n=t.current());)t.lastIntValue=16*t.lastIntValue+Ct(n),t.advance();return t.pos!==e},vt.regexp_eatLegacyOctalEscapeSequence=function(t){if(this.regexp_eatOctalDigit(t)){var e=t.lastIntValue;if(this.regexp_eatOctalDigit(t)){var n=t.lastIntValue;e<=3&&this.regexp_eatOctalDigit(t)?t.lastIntValue=64*e+8*n+t.lastIntValue:t.lastIntValue=8*e+n}else t.lastIntValue=e;return!0}return!1},vt.regexp_eatOctalDigit=function(t){var e=t.current();return At(e)?(t.lastIntValue=e-48,t.advance(),!0):(t.lastIntValue=0,!1)},vt.regexp_eatFixedHexDigits=function(t,e){var n=t.pos;t.lastIntValue=0;for(var r=0;r<e;++r){var i=t.current();if(!St(i))return t.pos=n,!1;t.lastIntValue=16*t.lastIntValue+Ct(i),t.advance()}return!0};var Tt=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new N(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},kt=Z.prototype;function Mt(t){return"function"!=typeof BigInt?null:BigInt(t.replace(/_/g,""))}function Pt(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}kt.next=function(t){!t&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Tt(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},kt.getToken=function(){return this.next(),new Tt(this)},"undefined"!=typeof Symbol&&(kt[Symbol.iterator]=function(){var t=this;return{next:function(){var e=t.getToken();return{done:e.type===E.eof,value:e}}}}),kt.curContext=function(){return this.context[this.context.length-1]},kt.nextToken=function(){var t=this.curContext();return t&&t.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(E.eof):t.override?t.override(this):void this.readToken(this.fullCharCodeAtPos())},kt.readToken=function(t){return g(t,this.options.ecmaVersion>=6)||92===t?this.readWord():this.getTokenFromCode(t)},kt.fullCharCodeAtPos=function(){var t=this.input.charCodeAt(this.pos);return t<=55295||t>=57344?t:(t<<10)+this.input.charCodeAt(this.pos+1)-56613888},kt.skipBlockComment=function(){var t,e=this.options.onComment&&this.curPosition(),n=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(-1===r&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations)for(C.lastIndex=n;(t=C.exec(this.input))&&t.index<this.pos;)++this.curLine,this.lineStart=t.index+t[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,r),n,this.pos,e,this.curPosition())},kt.skipLineComment=function(t){for(var e=this.pos,n=this.options.onComment&&this.curPosition(),r=this.input.charCodeAt(this.pos+=t);this.pos<this.input.length&&!A(r);)r=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+t,this.pos),e,this.pos,n,this.curPosition())},kt.skipSpace=function(){t:for(;this.pos<this.input.length;){var t=this.input.charCodeAt(this.pos);switch(t){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break t}break;default:if(!(t>8&&t<14||t>=5760&&T.test(String.fromCharCode(t))))break t;++this.pos}}},kt.finishToken=function(t,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=t,this.value=e,this.updateContext(n)},kt.readToken_dot=function(){var t=this.input.charCodeAt(this.pos+1);if(t>=48&&t<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===t&&46===e?(this.pos+=3,this.finishToken(E.ellipsis)):(++this.pos,this.finishToken(E.dot))},kt.readToken_slash=function(){var t=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===t?this.finishOp(E.assign,2):this.finishOp(E.slash,1)},kt.readToken_mult_modulo_exp=function(t){var e=this.input.charCodeAt(this.pos+1),n=1,r=42===t?E.star:E.modulo;return this.options.ecmaVersion>=7&&42===t&&42===e&&(++n,r=E.starstar,e=this.input.charCodeAt(this.pos+2)),61===e?this.finishOp(E.assign,n+1):this.finishOp(r,n)},kt.readToken_pipe_amp=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?this.options.ecmaVersion>=12&&61===this.input.charCodeAt(this.pos+2)?this.finishOp(E.assign,3):this.finishOp(124===t?E.logicalOR:E.logicalAND,2):61===e?this.finishOp(E.assign,2):this.finishOp(124===t?E.bitwiseOR:E.bitwiseAND,1)},kt.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(E.assign,2):this.finishOp(E.bitwiseXOR,1)},kt.readToken_plus_min=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?45!==e||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!S.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(E.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===e?this.finishOp(E.assign,2):this.finishOp(E.plusMin,1)},kt.readToken_lt_gt=function(t){var e=this.input.charCodeAt(this.pos+1),n=1;return e===t?(n=62===t&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(E.assign,n+1):this.finishOp(E.bitShift,n)):33!==e||60!==t||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===e&&(n=2),this.finishOp(E.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},kt.readToken_eq_excl=function(t){var e=this.input.charCodeAt(this.pos+1);return 61===e?this.finishOp(E.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===t&&62===e&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(E.arrow)):this.finishOp(61===t?E.eq:E.prefix,1)},kt.readToken_question=function(){var t=this.options.ecmaVersion;if(t>=11){var e=this.input.charCodeAt(this.pos+1);if(46===e){var n=this.input.charCodeAt(this.pos+2);if(n<48||n>57)return this.finishOp(E.questionDot,2)}if(63===e)return t>=12&&61===this.input.charCodeAt(this.pos+2)?this.finishOp(E.assign,3):this.finishOp(E.coalesce,2)}return this.finishOp(E.question,1)},kt.getTokenFromCode=function(t){switch(t){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(E.parenL);case 41:return++this.pos,this.finishToken(E.parenR);case 59:return++this.pos,this.finishToken(E.semi);case 44:return++this.pos,this.finishToken(E.comma);case 91:return++this.pos,this.finishToken(E.bracketL);case 93:return++this.pos,this.finishToken(E.bracketR);case 123:return++this.pos,this.finishToken(E.braceL);case 125:return++this.pos,this.finishToken(E.braceR);case 58:return++this.pos,this.finishToken(E.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(E.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(120===e||88===e)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===e||79===e)return this.readRadixNumber(8);if(98===e||66===e)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(t);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(t);case 124:case 38:return this.readToken_pipe_amp(t);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(t);case 60:case 62:return this.readToken_lt_gt(t);case 61:case 33:return this.readToken_eq_excl(t);case 63:return this.readToken_question();case 126:return this.finishOp(E.prefix,1)}this.raise(this.pos,"Unexpected character '"+Pt(t)+"'")},kt.finishOp=function(t,e){var n=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(t,n)},kt.readRegexp=function(){for(var t,e,n=this.pos;;){this.pos>=this.input.length&&this.raise(n,"Unterminated regular expression");var r=this.input.charAt(this.pos);if(S.test(r)&&this.raise(n,"Unterminated regular expression"),t)t=!1;else{if("["===r)e=!0;else if("]"===r&&e)e=!1;else if("/"===r&&!e)break;t="\\"===r}++this.pos}var i=this.input.slice(n,this.pos);++this.pos;var o=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(o);var s=this.regexpState||(this.regexpState=new mt(this));s.reset(n,i,a),this.validateRegExpFlags(s),this.validateRegExpPattern(s);var u=null;try{u=new RegExp(i,a)}catch(t){}return this.finishToken(E.regexp,{pattern:i,flags:a,value:u})},kt.readInt=function(t,e,n){for(var r=this.options.ecmaVersion>=12&&void 0===e,i=n&&48===this.input.charCodeAt(this.pos),o=this.pos,a=0,s=0,u=0,l=null==e?1/0:e;u<l;++u,++this.pos){var c=this.input.charCodeAt(this.pos),h=void 0;if(r&&95===c)i&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===s&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===u&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),s=c;else{if((h=c>=97?c-97+10:c>=65?c-65+10:c>=48&&c<=57?c-48:1/0)>=t)break;s=c,a=a*t+h}}return r&&95===s&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===o||null!=e&&this.pos-o!==e?null:a},kt.readRadixNumber=function(t){var e=this.pos;this.pos+=2;var n=this.readInt(t);return null==n&&this.raise(this.start+2,"Expected number in radix "+t),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(n=Mt(this.input.slice(e,this.pos)),++this.pos):g(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(E.num,n)},kt.readNumber=function(t){var e=this.pos;t||null!==this.readInt(10,void 0,!0)||this.raise(e,"Invalid number");var n=this.pos-e>=2&&48===this.input.charCodeAt(e);n&&this.strict&&this.raise(e,"Invalid number");var r=this.input.charCodeAt(this.pos);if(!n&&!t&&this.options.ecmaVersion>=11&&110===r){var i=Mt(this.input.slice(e,this.pos));return++this.pos,g(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(E.num,i)}n&&/[89]/.test(this.input.slice(e,this.pos))&&(n=!1),46!==r||n||(++this.pos,this.readInt(10),r=this.input.charCodeAt(this.pos)),69!==r&&101!==r||n||(43!==(r=this.input.charCodeAt(++this.pos))&&45!==r||++this.pos,null===this.readInt(10)&&this.raise(e,"Invalid number")),g(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var o,a=(o=this.input.slice(e,this.pos),n?parseInt(o,8):parseFloat(o.replace(/_/g,"")));return this.finishToken(E.num,a)},kt.readCodePoint=function(){var t;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var e=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(e,"Code point out of bounds")}else t=this.readHexChar(4);return t},kt.readString=function(t){for(var e="",n=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var r=this.input.charCodeAt(this.pos);if(r===t)break;92===r?(e+=this.input.slice(n,this.pos),e+=this.readEscapedChar(!1),n=this.pos):(A(r,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(n,this.pos++),this.finishToken(E.string,e)};var It={};function Ot(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function Rt(t){var e="function"==typeof Map?new Map:void 0;return Rt=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return Dt(t,arguments,Bt(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Nt(r,t)},Rt(t)}function Lt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Dt(t,e,n){return Dt=Lt()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Nt(i,n.prototype),i},Dt.apply(null,arguments)}function Nt(t,e){return Nt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Nt(t,e)}function Bt(t){return Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Bt(t)}kt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(t){if(t!==It)throw t;this.readInvalidTemplateToken()}this.inTemplateElement=!1},kt.invalidStringToken=function(t,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw It;this.raise(t,e)},kt.readTmplToken=function(){for(var t="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var n=this.input.charCodeAt(this.pos);if(96===n||36===n&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==E.template&&this.type!==E.invalidTemplate?(t+=this.input.slice(e,this.pos),this.finishToken(E.template,t)):36===n?(this.pos+=2,this.finishToken(E.dollarBraceL)):(++this.pos,this.finishToken(E.backQuote));if(92===n)t+=this.input.slice(e,this.pos),t+=this.readEscapedChar(!0),e=this.pos;else if(A(n)){switch(t+=this.input.slice(e,this.pos),++this.pos,n){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(n)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}},kt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(E.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},kt.readEscapedChar=function(t){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Pt(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(t){var n=this.pos-1;return this.invalidStringToken(n,"Invalid escape sequence in template string"),null}default:if(e>=48&&e<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(r,8);return i>255&&(r=r.slice(0,-1),i=parseInt(r,8)),this.pos+=r.length-1,e=this.input.charCodeAt(this.pos),"0"===r&&56!==e&&57!==e||!this.strict&&!t||this.invalidStringToken(this.pos-1-r.length,t?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return A(e)?"":String.fromCharCode(e)}},kt.readHexChar=function(t){var e=this.pos,n=this.readInt(16,t);return null===n&&this.invalidStringToken(e,"Bad character escape sequence"),n},kt.readWord1=function(){this.containsEsc=!1;for(var t="",e=!0,n=this.pos,r=this.options.ecmaVersion>=6;this.pos<this.input.length;){var i=this.fullCharCodeAtPos();if(v(i,r))this.pos+=i<=65535?1:2;else{if(92!==i)break;this.containsEsc=!0,t+=this.input.slice(n,this.pos);var o=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(e?g:v)(a,r)||this.invalidStringToken(o,"Invalid Unicode escape"),t+=Pt(a),n=this.pos}e=!1}return t+this.input.slice(n,this.pos)},kt.readWord=function(){var t=this.readWord1(),e=E.name;return this.keywords.test(t)&&(e=x[t]),this.finishToken(e,t)},Z.acorn={Parser:Z,version:"7.4.1",defaultOptions:z,Position:D,SourceLocation:N,getLineInfo:B,Node:rt,TokenType:m,tokTypes:E,keywordTypes:x,TokContext:at,tokContexts:st,isIdentifierChar:v,isIdentifierStart:g,Token:Tt,isNewLine:A,lineBreak:S,lineBreakG:C,nonASCIIwhitespace:T};var zt=function(t){function e(){return t.apply(this,arguments)||this}return Ot(e,t),e}(Rt(Error)),Ft=function(t){function e(){return t.apply(this,arguments)||this}return Ot(e,t),e}(Rt(SyntaxError)),Zt=function(t){function e(){return t.apply(this,arguments)||this}return Ot(e,t),e}(Rt(ReferenceError)),jt=function(t){function e(){return t.apply(this,arguments)||this}return Ot(e,t),e}(Rt(TypeError)),Ut=function(t){function e(){return t.apply(this,arguments)||this}return Ot(e,t),e}(zt),Gt=function(t){function e(){return t.apply(this,arguments)||this}return Ot(e,t),e}(Ft),Vt=function(t){function e(){return t.apply(this,arguments)||this}return Ot(e,t),e}(Zt),Wt={UnknownError:[3001,"%0",Ut],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Ut],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Vt],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Vt],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Vt],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Vt],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Vt],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Vt],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Vt],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Vt],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Vt],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Vt],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Zt],VariableUndefinedReferenceError:[2002,"%0 is not defined",Zt],IsNotConstructor:[2003,"%0 is not a constructor",jt]};function Ht(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Xt(t,e,n){return Xt=Ht()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Yt(i,n.prototype),i},Xt.apply(null,arguments)}function Yt(t,e){return Yt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Yt(t,e)}function qt(t,e){Object.defineProperty(t,"name",{value:e,writable:!1,enumerable:!1,configurable:!0})}var Kt=Object.prototype.hasOwnProperty,Qt=Symbol("Break"),Jt=Symbol("Continue"),$t=Symbol("DefaultCase"),te=Symbol("EmptyStatementReturn"),ee=Symbol("WithScopeName"),ne=Symbol("SuperScopeName"),re=Symbol("RootScopeName"),ie=Symbol("GlobalScopeName");function oe(t){return"function"==typeof t}var ae=function(){function t(t){this.interpreter=t}return t.prototype.generator=function(){var t=this.interpreter;return{getOptions:t.getOptions.bind(t),getCurrentScope:function(){return this.getCurrentScope()}.bind(t),getGlobalScope:function(){return this.getGlobalScope()}.bind(t),getCurrentContext:function(){return this.getCurrentContext()}.bind(t),getExecStartTime:t.getExecStartTime.bind(t)}},t}();function se(t,e,n){if(void 0===n&&(n=!0),!(t instanceof ae))throw new Error("Illegal call");if("string"!=typeof e)return e;if(e){var r=t.generator(),i={timeout:r.getOptions().timeout,_initEnv:function(){n||this.setCurrentContext(r.getCurrentContext()),this.execStartTime=r.getExecStartTime(),this.execEndTime=this.execStartTime}},o=n?r.getGlobalScope():r.getCurrentScope();return new ve(o,i).evaluate(e)}}function ue(t){if(!(t instanceof ae))throw new Error("Illegal call");for(var e=t.generator(),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=r.pop(),a=new ve(e.getGlobalScope(),e.getOptions()),s="\n\t\t    (function anonymous("+r.join(",")+"){\n\t\t        "+o+"\n\t\t    });\n\t\t    ";return a.evaluate(s)}Object.defineProperty(se,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(ue,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var le=function(t){this.value=t},ce=function(t){this.value=t},he=function(t){this.value=t},fe=function(t,e,n){void 0===e&&(e=null),this.name=n,this.parent=e,this.data=t,this.labelStack=[]};function pe(){}function de(t,e){return void 0===t&&(t=null),new fe(Object.create(null),t,e)}var ge={NaN:NaN,Infinity:1/0,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:se,Function:ue};"undefined"!=typeof JSON&&(ge.JSON=JSON),"undefined"!=typeof Promise&&(ge.Promise=Promise),"undefined"!=typeof Set&&(ge.Set=Set),"undefined"!=typeof Map&&(ge.Map=Map),"undefined"!=typeof Symbol&&(ge.Symbol=Symbol),"undefined"!=typeof Proxy&&(ge.Proxy=Proxy),"undefined"!=typeof WeakMap&&(ge.WeakMap=WeakMap),"undefined"!=typeof WeakSet&&(ge.WeakSet=WeakSet),"undefined"!=typeof Reflect&&(ge.Reflect=Reflect);var ve=function(){function t(e,n){void 0===e&&(e=t.global),void 0===n&&(n={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:n.ecmaVersion||t.ecmaVersion,timeout:n.timeout||0,rootContext:n.rootContext,globalContextInFunction:void 0===n.globalContextInFunction?t.globalContextInFunction:n.globalContextInFunction,_initEnv:n._initEnv},this.context=e||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var e=t.prototype;return e.initEnvironment=function(t){var e;if(t instanceof fe)e=t;else{var n=null,r=this.createSuperScope(t);this.options.rootContext&&(n=new fe(function(t){return Object.create(t)}(this.options.rootContext),r,re)),e=new fe(t,n||r,ie)}this.globalScope=e,this.currentScope=this.globalScope,this.globalContext=e.data,this.currentContext=e.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var i=this.options._initEnv;i&&i.call(this)},e.getExecStartTime=function(){return this.execStartTime},e.getExecutionTime=function(){return this.execEndTime-this.execStartTime},e.setExecTimeout=function(t){void 0===t&&(t=0),this.options.timeout=t},e.getOptions=function(){return this.options},e.getGlobalScope=function(){return this.globalScope},e.getCurrentScope=function(){return this.currentScope},e.getCurrentContext=function(){return this.currentContext},e.isInterruptThrow=function(t){return t instanceof Ut||t instanceof Vt||t instanceof Gt},e.createSuperScope=function(t){var e=Object.assign({},ge);return Object.keys(e).forEach((function(n){n in t&&delete e[n]})),new fe(e,null,ne)},e.setCurrentContext=function(t){this.currentContext=t},e.setCurrentScope=function(t){this.currentScope=t},e.evaluate=function(e){var n,r,i;if(void 0===e&&(e=""),e)return r=e,i={ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||t.ecmaVersion},n=Z.parse(r,i),this.evaluateNode(n,e)},e.appendCode=function(t){return this.evaluate(t)},e.evaluateNode=function(t,e){var n=this;void 0===e&&(e=""),this.value=void 0,this.source=e,this.sourceList.push(e),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var r=this.getCurrentScope(),i=this.getCurrentContext(),o=r.labelStack.concat([]),a=this.callStack.concat([]);try{var s=this.createClosure(t);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),s()}catch(t){throw t}finally{n.setCurrentScope(r),n.setCurrentContext(i),r.labelStack=o,n.callStack=a,this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},e.createErrorMessage=function(t,e,n){var r=t[1].replace("%0",String(e));return null!==n&&(r+=this.getNodePosition(n||this.lastExecNode)),r},e.createError=function(t,e){return new e(t)},e.createThrowError=function(t,e){return this.createError(t,e)},e.createInternalThrowError=function(t,e,n){return this.createError(this.createErrorMessage(t,e,n),t[2])},e.checkTimeout=function(){if(!this.isRunning)return!1;var t=this.options.timeout||0;return Date.now()-this.execStartTime>t},e.getNodePosition=function(t){return t&&t.loc?" ["+t.loc.start.line+":"+t.loc.start.column+"]":""},e.createClosure=function(t){var e,n=this;switch(t.type){case"BinaryExpression":e=this.binaryExpressionHandler(t);break;case"LogicalExpression":e=this.logicalExpressionHandler(t);break;case"UnaryExpression":e=this.unaryExpressionHandler(t);break;case"UpdateExpression":e=this.updateExpressionHandler(t);break;case"ObjectExpression":e=this.objectExpressionHandler(t);break;case"ArrayExpression":e=this.arrayExpressionHandler(t);break;case"CallExpression":e=this.callExpressionHandler(t);break;case"NewExpression":e=this.newExpressionHandler(t);break;case"MemberExpression":e=this.memberExpressionHandler(t);break;case"ThisExpression":e=this.thisExpressionHandler(t);break;case"SequenceExpression":e=this.sequenceExpressionHandler(t);break;case"Literal":e=this.literalHandler(t);break;case"Identifier":e=this.identifierHandler(t);break;case"AssignmentExpression":e=this.assignmentExpressionHandler(t);break;case"FunctionDeclaration":e=this.functionDeclarationHandler(t);break;case"VariableDeclaration":e=this.variableDeclarationHandler(t);break;case"BlockStatement":case"Program":e=this.programHandler(t);break;case"ExpressionStatement":e=this.expressionStatementHandler(t);break;case"EmptyStatement":e=this.emptyStatementHandler(t);break;case"ReturnStatement":e=this.returnStatementHandler(t);break;case"FunctionExpression":e=this.functionExpressionHandler(t);break;case"IfStatement":e=this.ifStatementHandler(t);break;case"ConditionalExpression":e=this.conditionalExpressionHandler(t);break;case"ForStatement":e=this.forStatementHandler(t);break;case"WhileStatement":e=this.whileStatementHandler(t);break;case"DoWhileStatement":e=this.doWhileStatementHandler(t);break;case"ForInStatement":e=this.forInStatementHandler(t);break;case"WithStatement":e=this.withStatementHandler(t);break;case"ThrowStatement":e=this.throwStatementHandler(t);break;case"TryStatement":e=this.tryStatementHandler(t);break;case"ContinueStatement":e=this.continueStatementHandler(t);break;case"BreakStatement":e=this.breakStatementHandler(t);break;case"SwitchStatement":e=this.switchStatementHandler(t);break;case"LabeledStatement":e=this.labeledStatementHandler(t);break;case"DebuggerStatement":e=this.debuggerStatementHandler(t);break;default:throw this.createInternalThrowError(Wt.NodeTypeSyntaxError,t.type,t)}return function(){var r=n.options.timeout;if(r&&r>0&&n.checkTimeout())throw n.createInternalThrowError(Wt.ExecutionTimeOutError,r,null);return n.lastExecNode=t,e.apply(void 0,arguments)}},e.binaryExpressionHandler=function(t){var e=this,n=this.createClosure(t.left),r=this.createClosure(t.right);return function(){var i=n(),o=r();switch(t.operator){case"==":return i==o;case"!=":return i!=o;case"===":return i===o;case"!==":return i!==o;case"<":return i<o;case"<=":return i<=o;case">":return i>o;case">=":return i>=o;case"<<":return i<<o;case">>":return i>>o;case">>>":return i>>>o;case"+":return i+o;case"-":return i-o;case"*":return i*o;case"**":return Math.pow(i,o);case"/":return i/o;case"%":return i%o;case"|":return i|o;case"^":return i^o;case"&":return i&o;case"in":return i in o;case"instanceof":return i instanceof o;default:throw e.createInternalThrowError(Wt.BinaryOperatorSyntaxError,t.operator,t)}}},e.logicalExpressionHandler=function(t){var e=this,n=this.createClosure(t.left),r=this.createClosure(t.right);return function(){switch(t.operator){case"||":return n()||r();case"&&":return n()&&r();default:throw e.createInternalThrowError(Wt.LogicalOperatorSyntaxError,t.operator,t)}}},e.unaryExpressionHandler=function(t){var e,n=this;if("delete"===t.operator){var r=this.createObjectGetter(t.argument),i=this.createNameGetter(t.argument);return function(){return delete r()[i()]}}if("typeof"===t.operator&&"Identifier"===t.argument.type){var o=this.createObjectGetter(t.argument),a=this.createNameGetter(t.argument);e=function(){return o()[a()]}}else e=this.createClosure(t.argument);return function(){var r=e();switch(t.operator){case"-":return-r;case"+":return+r;case"!":return!r;case"~":return~r;case"void":return;case"typeof":return typeof r;default:throw n.createInternalThrowError(Wt.UnaryOperatorSyntaxError,t.operator,t)}}},e.updateExpressionHandler=function(t){var e=this,n=this.createObjectGetter(t.argument),r=this.createNameGetter(t.argument);return function(){var i=n(),o=r();switch(e.assertVariable(i,o,t),t.operator){case"++":return t.prefix?++i[o]:i[o]++;case"--":return t.prefix?--i[o]:i[o]--;default:throw e.createInternalThrowError(Wt.UpdateOperatorSyntaxError,t.operator,t)}}},e.objectExpressionHandler=function(t){var e=this,n=[],r=Object.create(null);return t.properties.forEach((function(t){var i=t.kind,o=function(t){return"Identifier"===t.type?t.name:"Literal"===t.type?t.value:this.throwError(Wt.ObjectStructureSyntaxError,t.type,t)}(t.key);r[o]&&"init"!==i||(r[o]={}),r[o][i]=e.createClosure(t.value),n.push({key:o,property:t})})),function(){for(var t={},e=n.length,i=0;i<e;i++){var o=n[i],a=o.key,s=r[a],u=s.init?s.init():void 0,l=s.get?s.get():function(){},c=s.set?s.set():function(t){};if("set"in s||"get"in s){var h={configurable:!0,enumerable:!0,get:l,set:c};Object.defineProperty(t,a,h)}else{var f=o.property,p=f.kind;"Identifier"!==f.key.type||"FunctionExpression"!==f.value.type||"init"!==p||f.value.id||qt(u,f.key.name),t[a]=u}}return t}},e.arrayExpressionHandler=function(t){var e=this,n=t.elements.map((function(t){return t?e.createClosure(t):t}));return function(){for(var t=n.length,e=Array(t),r=0;r<t;r++){var i=n[r];i&&(e[r]=i())}return e}},e.safeObjectGet=function(t,e,n){return t[e]},e.createCallFunctionGetter=function(t){var e=this;if("MemberExpression"===t.type){var n=this.createClosure(t.object),r=this.createMemberKeyGetter(t),i=this.source;return function(){var o=n(),a=r(),s=e.safeObjectGet(o,a,t);if(!s||!oe(s)){var u=i.slice(t.start,t.end);throw e.createInternalThrowError(Wt.FunctionUndefinedReferenceError,u,t)}return s.__IS_EVAL_FUNC?function(t){return s(new ae(e),t,!0)}:s.__IS_FUNCTION_FUNC?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return s.apply(void 0,[new ae(e)].concat(n))}:s.bind(o)}}var o=this.createClosure(t);return function(){var n="";"Identifier"===t.type&&(n=t.name);var r=o();if(!r||!oe(r))throw e.createInternalThrowError(Wt.FunctionUndefinedReferenceError,n,t);if("Identifier"===t.type&&r.__IS_EVAL_FUNC&&"eval"===n)return function(t){var i=e.getScopeFromName(n,e.getCurrentScope()),o=i.name===ne||i.name===ie||i.name===re;return r(new ae(e),t,!o)};if(r.__IS_EVAL_FUNC)return function(t){return r(new ae(e),t,!0)};if(r.__IS_FUNCTION_FUNC)return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.apply(void 0,[new ae(e)].concat(n))};var i=e.options.globalContextInFunction;if("Identifier"===t.type){var a=e.getIdentifierScope(t);a.name===ee&&(i=a.data)}return r.bind(i)}},e.callExpressionHandler=function(t){var e=this,n=this.createCallFunctionGetter(t.callee),r=t.arguments.map((function(t){return e.createClosure(t)}));return function(){return n().apply(void 0,r.map((function(t){return t()})))}},e.functionExpressionHandler=function(t){var e=this,n=this,r=this.source,i=this.collectDeclVars,o=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var a=t.id?t.id.name:"",s=t.params.length,u=t.params.map((function(t){return e.createParamNameGetter(t)})),l=this.createClosure(t.body),c=this.collectDeclVars,h=this.collectDeclFuncs;return this.collectDeclVars=i,this.collectDeclFuncs=o,function(){var e=n.getCurrentScope(),i=function t(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n.callStack.push(""+a);var s=n.getCurrentScope(),f=de(e,"FunctionScope("+a+")");n.setCurrentScope(f),n.addDeclarationsToScope(c,h,f),a&&(f.data[a]=t),f.data.arguments=arguments,u.forEach((function(t,e){f.data[t()]=i[e]}));var p=n.getCurrentContext();n.setCurrentContext(this);var d=l();if(n.setCurrentContext(p),n.setCurrentScope(s),n.callStack.pop(),d instanceof le)return d.value};return qt(i,a),Object.defineProperty(i,"length",{value:s,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(i,"toString",{value:function(){return r.slice(t.start,t.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(i,"valueOf",{value:function(){return r.slice(t.start,t.end)},writable:!0,configurable:!0,enumerable:!1}),i}},e.newExpressionHandler=function(t){var e=this,n=this.source,r=this.createClosure(t.callee),i=t.arguments.map((function(t){return e.createClosure(t)}));return function(){var o=r();if(!oe(o)||o.__IS_EVAL_FUNC){var a=t.callee,s=n.slice(a.start,a.end);throw e.createInternalThrowError(Wt.IsNotConstructor,s,t)}return o.__IS_FUNCTION_FUNC?o.apply(void 0,[new ae(e)].concat(i.map((function(t){return t()})))):Xt(o,i.map((function(t){return t()})))}},e.memberExpressionHandler=function(t){var e=this.createClosure(t.object),n=this.createMemberKeyGetter(t);return function(){return e()[n()]}},e.thisExpressionHandler=function(t){var e=this;return function(){return e.getCurrentContext()}},e.sequenceExpressionHandler=function(t){var e=this,n=t.expressions.map((function(t){return e.createClosure(t)}));return function(){for(var t,e=n.length,r=0;r<e;r++)t=(0,n[r])();return t}},e.literalHandler=function(t){return function(){return t.regex?new RegExp(t.regex.pattern,t.regex.flags):t.value}},e.identifierHandler=function(t){var e=this;return function(){var n=e.getCurrentScope(),r=e.getScopeDataFromName(t.name,n);return e.assertVariable(r,t.name,t),r[t.name]}},e.getIdentifierScope=function(t){var e=this.getCurrentScope();return this.getScopeFromName(t.name,e)},e.assignmentExpressionHandler=function(t){var e=this;"Identifier"!==t.left.type||"FunctionExpression"!==t.right.type||t.right.id||(t.right.id={type:"Identifier",name:t.left.name});var n=this.createObjectGetter(t.left),r=this.createNameGetter(t.left),i=this.createClosure(t.right);return function(){var o=n(),a=r(),s=i();switch("="!==t.operator&&e.assertVariable(o,a,t),t.operator){case"=":return o[a]=s;case"+=":return o[a]+=s;case"-=":return o[a]-=s;case"*=":return o[a]*=s;case"**=":return o[a]=Math.pow(o[a],s);case"/=":return o[a]/=s;case"%=":return o[a]%=s;case"<<=":return o[a]<<=s;case">>=":return o[a]>>=s;case">>>=":return o[a]>>>=s;case"&=":return o[a]&=s;case"^=":return o[a]^=s;case"|=":return o[a]|=s;default:throw e.createInternalThrowError(Wt.AssignmentExpressionSyntaxError,t.type,t)}}},e.functionDeclarationHandler=function(t){if(t.id){var e=this.functionExpressionHandler(t);Object.defineProperty(e,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(t.id.name,e)}return function(){return te}},e.getVariableName=function(t){if("Identifier"===t.type)return t.name;throw this.createInternalThrowError(Wt.VariableTypeSyntaxError,t.type,t)},e.variableDeclarationHandler=function(t){for(var e,n=this,r=[],i=0;i<t.declarations.length;i++){var o=t.declarations[i];this.varDeclaration(this.getVariableName(o.id)),o.init&&r.push({type:"AssignmentExpression",operator:"=",left:o.id,right:o.init})}return r.length&&(e=this.createClosure({type:"BlockStatement",body:r})),function(){if(e){var t=n.isVarDeclMode;n.isVarDeclMode=!0,e(),n.isVarDeclMode=t}return te}},e.assertVariable=function(t,e,n){if(t===this.globalScope.data&&!(e in t))throw this.createInternalThrowError(Wt.VariableUndefinedReferenceError,e,n)},e.programHandler=function(t){var e=this,n=t.body.map((function(t){return e.createClosure(t)}));return function(){for(var t=te,r=0;r<n.length;r++){var i=n[r],o=e.setValue(i());if(o!==te&&((t=o)instanceof le||t instanceof ce||t instanceof he||t===Qt||t===Jt))break}return t}},e.expressionStatementHandler=function(t){return this.createClosure(t.expression)},e.emptyStatementHandler=function(t){return function(){return te}},e.returnStatementHandler=function(t){var e=t.argument?this.createClosure(t.argument):pe;return function(){return new le(e())}},e.ifStatementHandler=function(t){var e=this.createClosure(t.test),n=this.createClosure(t.consequent),r=t.alternate?this.createClosure(t.alternate):function(){return te};return function(){return e()?n():r()}},e.conditionalExpressionHandler=function(t){return this.ifStatementHandler(t)},e.forStatementHandler=function(t){var e=this,n=pe,r=t.test?this.createClosure(t.test):function(){return!0},i=pe,o=this.createClosure(t.body);return"ForStatement"===t.type&&(n=t.init?this.createClosure(t.init):n,i=t.update?this.createClosure(t.update):pe),function(a){var s,u=te,l="DoWhileStatement"===t.type;for(a&&"LabeledStatement"===a.type&&(s=a.label.name),n();l||r();i()){l=!1;var c=e.setValue(o());if(c!==te&&c!==Jt){if(c===Qt)break;if((u=c)instanceof he&&u.value===s)u=te;else if(u instanceof le||u instanceof ce||u instanceof he)break}}return u}},e.whileStatementHandler=function(t){return this.forStatementHandler(t)},e.doWhileStatementHandler=function(t){return this.forStatementHandler(t)},e.forInStatementHandler=function(t){var e=this,n=t.left,r=this.createClosure(t.right),i=this.createClosure(t.body);return"VariableDeclaration"===t.left.type&&(this.createClosure(t.left)(),n=t.left.declarations[0].id),function(t){var o,a,s=te;t&&"LabeledStatement"===t.type&&(o=t.label.name);var u=r();for(a in u){e.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:n,right:{type:"Literal",value:a}})();var l=e.setValue(i());if(l!==te&&l!==Jt){if(l===Qt)break;if((s=l)instanceof he&&s.value===o)s=te;else if(s instanceof le||s instanceof ce||s instanceof he)break}}return s}},e.withStatementHandler=function(t){var e=this,n=this.createClosure(t.object),r=this.createClosure(t.body);return function(){var t=n(),i=e.getCurrentScope(),o=new fe(t,i,ee);e.setCurrentScope(o);var a=e.setValue(r());return e.setCurrentScope(i),a}},e.throwStatementHandler=function(t){var e=this,n=this.createClosure(t.argument);return function(){throw e.setValue(void 0),n()}},e.tryStatementHandler=function(t){var e=this,n=this.createClosure(t.block),r=t.handler?this.catchClauseHandler(t.handler):null,i=t.finalizer?this.createClosure(t.finalizer):null;return function(){var t,o,a=e.getCurrentScope(),s=e.getCurrentContext(),u=a.labelStack.concat([]),l=e.callStack.concat([]),c=te,h=function(){e.setCurrentScope(a),e.setCurrentContext(s),a.labelStack=u,e.callStack=l};try{(c=e.setValue(n()))instanceof le&&(t=c)}catch(n){if(h(),e.isInterruptThrow(n))throw n;if(r)try{(c=e.setValue(r(n)))instanceof le&&(t=c)}catch(t){if(h(),e.isInterruptThrow(t))throw t;o=t}}if(i)try{(c=i())instanceof le&&(t=c)}catch(t){if(h(),e.isInterruptThrow(t))throw t;o=t}if(o)throw o;return t||c}},e.catchClauseHandler=function(t){var e=this,n=this.createParamNameGetter(t.param),r=this.createClosure(t.body);return function(t){var i,o=e.getCurrentScope().data,a=n(),s=Kt.call(o,a),u=o[a];return o[a]=t,i=r(),s?o[a]=u:delete o[a],i}},e.continueStatementHandler=function(t){return function(){return t.label?new he(t.label.name):Jt}},e.breakStatementHandler=function(t){return function(){return t.label?new ce(t.label.name):Qt}},e.switchStatementHandler=function(t){var e=this,n=this.createClosure(t.discriminant),r=t.cases.map((function(t){return e.switchCaseHandler(t)}));return function(){for(var t,i,o,a=n(),s=!1,u=0;u<r.length;u++){var l=r[u](),c=l.testClosure();if(c!==$t){if(s||c===a){if(s=!0,(i=e.setValue(l.bodyClosure()))===te)continue;if(i===Qt)break;if((t=i)instanceof le||t instanceof ce||t instanceof he||t===Jt)break}}else o=l}return!s&&o&&((i=e.setValue(o.bodyClosure()))===te||i===Qt||i===Jt||(t=i)),t}},e.switchCaseHandler=function(t){var e=t.test?this.createClosure(t.test):function(){return $t},n=this.createClosure({type:"BlockStatement",body:t.consequent});return function(){return{testClosure:e,bodyClosure:n}}},e.labeledStatementHandler=function(t){var e=this,n=t.label.name,r=this.createClosure(t.body);return function(){var i,o=e.getCurrentScope();return o.labelStack.push(n),(i=r(t))instanceof ce&&i.value===n&&(i=te),o.labelStack.pop(),i}},e.debuggerStatementHandler=function(t){return function(){return te}},e.createParamNameGetter=function(t){if("Identifier"===t.type)return function(){return t.name};throw this.createInternalThrowError(Wt.ParamTypeSyntaxError,t.type,t)},e.createObjectKeyGetter=function(t){var e;return e="Identifier"===t.type?function(){return t.name}:this.createClosure(t),function(){return e()}},e.createMemberKeyGetter=function(t){return t.computed?this.createClosure(t.property):this.createObjectKeyGetter(t.property)},e.createObjectGetter=function(t){var e=this;switch(t.type){case"Identifier":return function(){return e.getScopeDataFromName(t.name,e.getCurrentScope())};case"MemberExpression":return this.createClosure(t.object);default:throw this.createInternalThrowError(Wt.AssignmentTypeSyntaxError,t.type,t)}},e.createNameGetter=function(t){switch(t.type){case"Identifier":return function(){return t.name};case"MemberExpression":return this.createMemberKeyGetter(t);default:throw this.createInternalThrowError(Wt.AssignmentTypeSyntaxError,t.type,t)}},e.varDeclaration=function(t){this.collectDeclVars[t]=void 0},e.funcDeclaration=function(t,e){this.collectDeclFuncs[t]=e},e.addDeclarationsToScope=function(t,e,n){var r=n.data;for(var i in e){var o=e[i];r[i]=o?o():o}for(var a in t)a in r||(r[a]=void 0)},e.getScopeValue=function(t,e){return this.getScopeFromName(t,e).data[t]},e.getScopeDataFromName=function(t,e){return this.getScopeFromName(t,e).data},e.getScopeFromName=function(t,e){var n=e;do{if(t in n.data)return n}while(n=n.parent);return this.globalScope},e.setValue=function(t){var e=this.callStack.length;return this.isVarDeclMode||e||t===te||t===Qt||t===Jt||t instanceof ce||t instanceof he||(this.value=t instanceof le?t.value:t),t},e.getValue=function(){return this.value},t}();function me(t){return void 0===t&&(t=Object.create(null)),t}function ye(t,e,n){void 0===e&&(e=[]),void 0===n&&(n={});var r=n.parsingContext,i=void 0===n.timeout?0:n.timeout,o="\n    (function anonymous("+e.join(",")+"){\n         "+t+"\n    });\n    ";return new ve(r,{ecmaVersion:n.ecmaVersion,timeout:i,rootContext:n.rootContext,globalContextInFunction:n.globalContextInFunction}).evaluate(o)}function _e(t,e,n){return new ve(e,n).evaluate(t)}ve.version="0.0.3",ve.eval=se,ve.Function=ue,ve.ecmaVersion=5,ve.globalContextInFunction=void 0,ve.global=Object.create(null);var be=_e,xe=function(){function t(t){this._code=t}var e=t.prototype;return e.runInContext=function(t){return _e(this._code,t)},e.runInNewContext=function(t){return _e(this._code,t)},t}();const we=function(t,e,n){return _e(t,e,n)};function Ee(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e.pop();return ye(r||"",e)}const Se=we},396:(t,e,n)=>{var r;!function(i,o,a,s){"use strict";var u,l="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast,c="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),h=l||c,f=["","webkit","Moz","MS","ms","o"],p=h?"":o.createElement("div"),d=Math.round,g=Math.abs,v=Date.now;function m(t,e,n){return setTimeout(S(t,n),e)}function y(t,e,n){return!!Array.isArray(t)&&(_(t,n[e],n),!0)}function _(t,e,n){var r;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==s)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function b(t,e,n){var r="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=i.console&&(i.console.warn||i.console.log);return o&&o.call(i.console,r,n),t.apply(this,arguments)}}u="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==s&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e}:Object.assign;var x=b((function(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;)(!n||n&&t[r[i]]===s)&&(t[r[i]]=e[r[i]]),i++;return t}),"extend","Use `assign`."),w=b((function(t,e){return x(t,e,!0)}),"merge","Use `assign`.");function E(t,e,n){var r,i=e.prototype;(r=t.prototype=Object.create(i)).constructor=t,r._super=i,n&&u(r,n)}function S(t,e){return function(){return t.apply(e,arguments)}}function C(t,e){return"function"==typeof t?t.apply(e&&e[0]||s,e):t}function A(t,e){return t===s?e:t}function T(t,e,n){_(I(e),(function(e){t.addEventListener(e,n,!1)}))}function k(t,e,n){_(I(e),(function(e){t.removeEventListener(e,n,!1)}))}function M(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function P(t,e){return t.indexOf(e)>-1}function I(t){return t.trim().split(/\s+/g)}function O(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var r=0;r<t.length;){if(n&&t[r][n]==e||!n&&t[r]===e)return r;r++}return-1}function R(t){return Array.prototype.slice.call(t,0)}function L(t,e,n){for(var r=[],i=[],o=0;o<t.length;){var a=e?t[o][e]:t[o];O(i,a)<0&&r.push(t[o]),i[o]=a,o++}return n&&(r=e?r.sort((function(t,n){return t[e]>n[e]})):r.sort()),r}function D(t,e){for(var n,r,i=e[0].toUpperCase()+e.slice(1),o=0;o<f.length;){if((r=(n=f[o])?n+i:e)in t)return r;o++}return s}var N=1;function B(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||i}var z="ontouchstart"in i,F=D(i,"PointerEvent")!==s,Z=z&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),j="touch",U="mouse",G=["x","y"],V=["clientX","clientY"];function W(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){C(t.options.enable,[t])&&n.handler(e)},this.init()}function H(t,e,n){var r=n.pointers.length,i=n.changedPointers.length,o=1&e&&r-i==0,a=12&e&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,r=e.pointers,i=r.length;n.firstInput||(n.firstInput=X(e)),i>1&&!n.firstMultiple?n.firstMultiple=X(e):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,u=a?a.center:o.center,l=e.center=Y(r);e.timeStamp=v(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=J(u,l),e.distance=Q(u,l),function(t,e){var n=e.center,r=t.offsetDelta||{},i=t.prevDelta||{},o=t.prevInput||{};1!==e.eventType&&4!==o.eventType||(i=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=i.x+(n.x-r.x),e.deltaY=i.y+(n.y-r.y)}(n,e),e.offsetDirection=K(e.deltaX,e.deltaY);var c,h,f=q(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=f.x,e.overallVelocityY=f.y,e.overallVelocity=g(f.x)>g(f.y)?f.x:f.y,e.scale=a?(c=a.pointers,Q((h=r)[0],h[1],V)/Q(c[0],c[1],V)):1,e.rotation=a?function(t,e){return J(e[1],e[0],V)+J(t[1],t[0],V)}(a.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,r,i,o,a=t.lastInterval||e,u=e.timeStamp-a.timeStamp;if(8!=e.eventType&&(u>25||a.velocity===s)){var l=e.deltaX-a.deltaX,c=e.deltaY-a.deltaY,h=q(u,l,c);r=h.x,i=h.y,n=g(h.x)>g(h.y)?h.x:h.y,o=K(l,c),t.lastInterval=e}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;e.velocity=n,e.velocityX=r,e.velocityY=i,e.direction=o}(n,e);var p=t.element;M(e.srcEvent.target,p)&&(p=e.srcEvent.target),e.target=p}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function X(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:d(t.pointers[n].clientX),clientY:d(t.pointers[n].clientY)},n++;return{timeStamp:v(),pointers:e,center:Y(e),deltaX:t.deltaX,deltaY:t.deltaY}}function Y(t){var e=t.length;if(1===e)return{x:d(t[0].clientX),y:d(t[0].clientY)};for(var n=0,r=0,i=0;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:d(n/e),y:d(r/e)}}function q(t,e,n){return{x:e/t||0,y:n/t||0}}function K(t,e){return t===e?1:g(t)>=g(e)?t<0?2:4:e<0?8:16}function Q(t,e,n){n||(n=G);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return Math.sqrt(r*r+i*i)}function J(t,e,n){n||(n=G);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return 180*Math.atan2(i,r)/Math.PI}W.prototype={handler:function(){},init:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(B(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&k(this.element,this.evEl,this.domHandler),this.evTarget&&k(this.target,this.evTarget,this.domHandler),this.evWin&&k(B(this.element),this.evWin,this.domHandler)}};var $={mousedown:1,mousemove:2,mouseup:4},tt="mousedown",et="mousemove mouseup";function nt(){this.evEl=tt,this.evWin=et,this.pressed=!1,W.apply(this,arguments)}E(nt,W,{handler:function(t){var e=$[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:U,srcEvent:t}))}});var rt={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},it={2:j,3:"pen",4:U,5:"kinect"},ot="pointerdown",at="pointermove pointerup pointercancel";function st(){this.evEl=ot,this.evWin=at,W.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}h||!i.MSPointerEvent||i.PointerEvent||(ot="MSPointerDown",at="MSPointerMove MSPointerUp MSPointerCancel"),E(st,W,{handler:function(t){var e=this.store,n=!1,r=t.type.toLowerCase().replace("ms",""),i=rt[r],o=it[t.pointerType]||t.pointerType,a=o==j,s=O(e,t.pointerId,"pointerId");1&i&&(0===t.button||a)?s<0&&(e.push(t),s=e.length-1):12&i&&(n=!0),s<0||(e[s]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(s,1))}});var ut={touchstart:1,touchmove:2,touchend:4,touchcancel:8},lt="touchstart",ct="touchstart touchmove touchend touchcancel";function ht(){this.evTarget=lt,this.evWin=ct,this.started=!1,W.apply(this,arguments)}function ft(t,e){var n=R(t.touches),r=R(t.changedTouches);return 12&e&&(n=L(n.concat(r),"identifier",!0)),[n,r]}E(ht,W,{handler:function(t){var e=ut[t.type];if(1===e&&(this.started=!0),this.started){var n=ft.call(this,t,e);12&e&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:j,srcEvent:t})}}});var pt={touchstart:1,touchmove:2,touchend:4,touchcancel:8},dt="touchstart touchmove touchend touchcancel";function gt(){this.evTarget=dt,this.targetIds={},W.apply(this,arguments)}function vt(t,e){var n=R(t.touches),r=this.targetIds;if(3&e&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=R(t.changedTouches),s=[],u=this.target;if(o=n.filter((function(t){return M(t.target,u)})),1===e)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),12&e&&delete r[a[i].identifier],i++;return s.length?[L(o.concat(s),"identifier",!0),s]:void 0}function mt(){W.apply(this,arguments);var t=S(this.handler,this);this.touch=new gt(this.manager,t),this.mouse=new nt(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function yt(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,_t.call(this,e)):12&t&&_t.call(this,e)}function _t(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var t=r.indexOf(n);t>-1&&r.splice(t,1)}),2500)}}function bt(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(e-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}E(gt,W,{handler:function(t){var e=pt[t.type],n=vt.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:j,srcEvent:t})}}),E(mt,W,{handler:function(t,e,n){var r=n.pointerType==j,i=n.pointerType==U;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)yt.call(this,e,n);else if(i&&bt.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var xt=h?s:D(p.style,"touchAction"),wt=xt!==s,Et="compute",St="auto",Ct="manipulation",At="none",Tt="pan-x",kt="pan-y",Mt=function(){if(!wt)return!1;var t={};if(h)return t;var e=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){t[n]=!e||i.CSS.supports("touch-action",n)})),t}();function Pt(t,e){this.manager=t,this.set(e)}Pt.prototype={set:function(t){t==Et&&(t=this.compute()),wt&&this.manager.element.style&&Mt[t]&&(this.manager.element.style[xt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return _(this.manager.recognizers,(function(e){C(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(P(t,At))return At;var e=P(t,Tt),n=P(t,kt);return e&&n?At:e||n?e?Tt:kt:P(t,Ct)?Ct:St}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var r=this.actions,i=P(r,At)&&!Mt.none,o=P(r,kt)&&!Mt["pan-y"],a=P(r,Tt)&&!Mt["pan-x"];if(i){var s=1===t.pointers.length,u=t.distance<2,l=t.deltaTime<250;if(s&&u&&l)return}if(!a||!o)return i||o&&6&n||a&&24&n?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var It=32;function Ot(t){this.options=u({},this.defaults,t||{}),this.id=N++,this.manager=null,this.options.enable=A(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Rt(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function Lt(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function Dt(t,e){var n=e.manager;return n?n.get(t):t}function Nt(){Ot.apply(this,arguments)}function Bt(){Nt.apply(this,arguments),this.pX=null,this.pY=null}function zt(){Nt.apply(this,arguments)}function Ft(){Ot.apply(this,arguments),this._timer=null,this._input=null}function Zt(){Nt.apply(this,arguments)}function jt(){Nt.apply(this,arguments)}function Ut(){Ot.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Gt(t,e){return(e=e||{}).recognizers=A(e.recognizers,Gt.defaults.preset),new Vt(t,e)}function Vt(t,e){this.options=u({},Gt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new(this.options.inputClass||(F?st:Z?gt:z?mt:nt))(this,H),this.touchAction=new Pt(this,this.options.touchAction),Wt(this,!0),_(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Wt(t,e){var n,r=t.element;r.style&&(_(t.options.cssProps,(function(i,o){n=D(r.style,o),e?(t.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}Ot.prototype={defaults:{},set:function(t){return u(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(y(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Dt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return y(t,"dropRecognizeWith",this)||(t=Dt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(y(t,"requireFailure",this))return this;var e=this.requireFail;return-1===O(e,t=Dt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(y(t,"dropRequireFailure",this))return this;t=Dt(t,this);var e=O(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function r(n){e.manager.emit(n,t)}n<8&&r(e.options.event+Rt(n)),r(e.options.event),t.additionalEvent&&r(t.additionalEvent),n>=8&&r(e.options.event+Rt(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=It},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=u({},t);if(!C(this.options.enable,[this,e]))return this.reset(),void(this.state=It);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},E(Nt,Ot,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,r=6&e,i=this.attrTest(t);return r&&(8&n||!i)?16|e:r||i?4&n?8|e:2&e?4|e:2:It}}),E(Bt,Nt,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push(kt),24&t&&e.push(Tt),e},directionTest:function(t){var e=this.options,n=!0,r=t.distance,i=t.direction,o=t.deltaX,a=t.deltaY;return i&e.direction||(6&e.direction?(i=0===o?1:o<0?2:4,n=o!=this.pX,r=Math.abs(t.deltaX)):(i=0===a?1:a<0?8:16,n=a!=this.pY,r=Math.abs(t.deltaY))),t.direction=i,n&&r>e.threshold&&i&e.direction},attrTest:function(t){return Nt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Lt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),E(zt,Nt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[At]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),E(Ft,Ot,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[St]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,!r||!n||12&t.eventType&&!i)this.reset();else if(1&t.eventType)this.reset(),this._timer=m((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return It},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=v(),this.manager.emit(this.options.event,this._input)))}}),E(Zt,Nt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[At]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),E(jt,Nt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Bt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return 30&n?e=t.overallVelocity:6&n?e=t.overallVelocityX:24&n&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&g(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=Lt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),E(Ut,Ot,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ct]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=t.eventType)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||Q(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=m((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return It},failTimeout:function(){return this._timer=m((function(){this.state=It}),this.options.interval,this),It},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Gt.VERSION="2.0.7",Gt.defaults={domEvents:!1,touchAction:Et,enable:!0,inputTarget:null,inputClass:null,preset:[[Zt,{enable:!1}],[zt,{enable:!1},["rotate"]],[jt,{direction:6}],[Bt,{direction:6},["swipe"]],[Ut],[Ut,{event:"doubletap",taps:2},["tap"]],[Ft]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Vt.prototype={set:function(t){return u(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var r=this.recognizers,i=e.curRecognizer;(!i||i&&8&i.state)&&(i=e.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===e.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(t),!i&&14&n.state&&(i=e.curRecognizer=n),o++}},get:function(t){if(t instanceof Ot)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(y(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(y(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=O(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var n=this.handlers;return _(I(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==s){var n=this.handlers;return _(I(t),(function(t){e?n[t]&&n[t].splice(O(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){if(!h){var n=o.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](e),r++}},destroy:function(){this.element&&Wt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},h||(u(Gt,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:It,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Vt,Input:W,TouchAction:Pt,TouchInput:gt,MouseInput:nt,PointerEventInput:st,TouchMouseInput:mt,SingleTouchInput:ht,Recognizer:Ot,AttrRecognizer:Nt,Tap:Ut,Pan:Bt,Swipe:jt,Pinch:zt,Rotate:Zt,Press:Ft,on:T,off:k,each:_,merge:w,extend:x,assign:u,inherit:E,bindFn:S,prefixed:D}),("undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Hammer=Gt,(r=function(){return Gt}.call(e,n,e,t))===s||(t.exports=r))}("undefined"!=typeof window?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document)},8307:function(t,e,n){t.exports=function(t){"use strict";var e=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},n=function(t,e){for(var n=Object.keys(e),r=0;r<n.length;++r)t[n[r]]=e[n[r]];return t},r="\n";function i(t){var e=new Error("(regl) "+t);throw console.error(e),e}function o(t,e){t||i(e)}function a(t){return t?": "+t:""}function s(t,e){switch(e){case"number":return"number"==typeof t;case"object":return"object"==typeof t;case"string":return"string"==typeof t;case"boolean":return"boolean"==typeof t;case"function":return"function"==typeof t;case"undefined":return void 0===t;case"symbol":return"symbol"==typeof t}}function u(t,e,n){e.indexOf(t)<0&&i("invalid value"+a(n)+". must be one of: "+e)}var l=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function c(t,e){for(t+="";t.length<e;)t=" "+t;return t}function h(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function f(t,e){this.number=t,this.line=e,this.errors=[]}function p(t,e,n){this.file=t,this.line=e,this.message=n}function d(){var t=new Error,e=(t.stack||t).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(e);return r?r[1]:"unknown"}function g(){var t=new Error,e=(t.stack||t).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(e);return r?r[1]:"unknown"}function v(t,e){var n,r=t.split("\n"),i=1,o=0,a={unknown:new h,0:new h};a.unknown.name=a[0].name=e||d(),a.unknown.lines.push(new f(0,""));for(var s=0;s<r.length;++s){var u=r[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(l[2]);c&&(i=0|c[1],c[2]&&((o=0|c[2])in a||(a[o]=new h)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);p&&(a[o].name=p[1]?(n=p[2],"undefined"!=typeof atob?atob(n):"base64:"+n):p[2])}a[o].lines.push(new f(i++,u))}return Object.keys(a).forEach((function(t){var e=a[t];e.lines.forEach((function(t){e.index[t.number]=t}))})),a}function m(t){t._commandRef=d()}function y(t,e){var n=g();i(t+" in command "+(e||d())+("unknown"===n?"":" called from "+n))}function _(t,e,n,r){s(t,e)||y("invalid parameter type"+a(n)+". expected "+e+", got "+typeof t,r||d())}var b=33071,x={};function w(t,e){return 32820===t||32819===t||33635===t?2:34042===t?4:x[t]*e}function E(t){return!(t&t-1||!t)}x[5120]=x[5121]=1,x[5122]=x[5123]=x[36193]=x[33635]=x[32819]=x[32820]=2,x[5124]=x[5125]=x[5126]=x[34042]=4;var S=n(o,{optional:function(t){t()},raise:i,commandRaise:y,command:function(t,e,n){t||y(e,n||d())},parameter:function(t,e,n){t in e||i("unknown parameter ("+t+")"+a(n)+". possible values: "+Object.keys(e).join())},commandParameter:function(t,e,n,r){t in e||y("unknown parameter ("+t+")"+a(n)+". possible values: "+Object.keys(e).join(),r||d())},constructor:function(t){Object.keys(t).forEach((function(t){l.indexOf(t)<0&&i('invalid regl constructor argument "'+t+'". must be one of '+l)}))},type:function(t,e,n){s(t,e)||i("invalid parameter type"+a(n)+". expected "+e+", got "+typeof t)},commandType:_,isTypedArray:function(t,n){e(t)||i("invalid parameter type"+a(n)+". must be a typed array")},nni:function(t,e){t>=0&&(0|t)===t||i("invalid parameter type, ("+t+")"+a(e)+". must be a nonnegative integer")},oneOf:u,shaderError:function(t,e,n,i,a){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var s=t.getShaderInfoLog(e),u=i===t.FRAGMENT_SHADER?"fragment":"vertex";_(n,"string",u+" shader source must be a string",a);var l=v(n,a),h=function(t){var e=[];return t.split("\n").forEach((function(t){if(!(t.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);n?e.push(new p(0|n[1],0|n[2],n[3].trim())):t.length>0&&e.push(new p("unknown",0,t))}})),e}(s);(function(t,e){e.forEach((function(e){var n=t[e.file];if(n){var r=n.index[e.line];if(r)return r.errors.push(e),void(n.hasErrors=!0)}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(e)}))})(l,h),Object.keys(l).forEach((function(t){var e=l[t];if(e.hasErrors){var n=[""],i=[""];o("file number "+t+": "+e.name+"\n","color:red;text-decoration:underline;font-weight:bold"),e.lines.forEach((function(t){if(t.errors.length>0){o(c(t.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(t.line+r,"color:red; background-color:yellow; font-weight:bold");var e=0;t.errors.forEach((function(n){var i=n.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];i=a[2],"assign"===s&&(s="="),e=Math.max(t.line.indexOf(s,e),0)}else e=0;o(c("| ",6)),o(c("^^^",e+3)+r,"font-weight:bold"),o(c("| ",6)),o(i+r,"font-weight:bold")})),o(c("| ",6)+r)}else o(c(t.number,4)+"|  "),o(t.line+r,"color:red")})),"undefined"==typeof document||window.chrome?console.log(n.join("")):(i[0]=n.join("%c"),console.log.apply(console,i))}function o(t,e){n.push(t),i.push(e||"")}})),o.raise("Error compiling "+u+" shader, "+l[0].name)}},linkError:function(t,e,n,i,a){if(!t.getProgramParameter(e,t.LINK_STATUS)){var s=t.getProgramInfoLog(e),u=v(n,a),l='Error linking program with vertex shader, "'+v(i,a)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+l+"\n%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(l+r+s),o.raise(l)}},callSite:g,saveCommandRef:m,saveDrawInfo:function(t,e,n,r){function i(t){return t?r.id(t):0}function o(t,e){Object.keys(e).forEach((function(e){t[r.id(e)]=!0}))}m(t),t._fragId=i(t.static.frag),t._vertId=i(t.static.vert);var a=t._uniformSet={};o(a,e.static),o(a,e.dynamic);var s=t._attributeSet={};o(s,n.static),o(s,n.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic},framebufferFormat:function(t,e,n){t.texture?u(t.texture._texture.internalformat,e,"unsupported texture format for attachment"):u(t.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:d,texture2D:function(t,e,n){var r,i=e.width,a=e.height,s=e.channels;o(i>0&&i<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),t.wrapS===b&&t.wrapT===b||o(E(i)&&E(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===e.mipmask?1!==i&&1!==a&&o(9984!==t.minFilter&&9986!==t.minFilter&&9985!==t.minFilter&&9987!==t.minFilter,"min filter requires mipmap"):(o(E(i)&&E(a),"texture must be a square power of 2 to support mipmapping"),o(e.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),5126===e.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&o(9728===t.minFilter&&9728===t.magFilter,"filter not supported, must enable oes_texture_float_linear"),o(!t.genMipmaps,"mipmap generation not supported with float textures"));var u=e.images;for(r=0;r<16;++r)if(u[r]){var l=i>>r,c=a>>r;o(e.mipmask&1<<r,"missing mipmap data");var h=u[r];if(o(h.width===l&&h.height===c,"invalid shape for mip images"),o(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed);else if(h.data){var f=Math.ceil(w(h.type,s)*l/h.unpackAlignment)*h.unpackAlignment;o(h.data.byteLength===f*c,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else t.genMipmaps||o(0==(e.mipmask&1<<r),"extra mipmap data");e.compressed&&o(!t.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(t,e,n,r){var i=t.width,a=t.height,s=t.channels;o(i>0&&i<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),o(i===a,"cube map must be square"),o(e.wrapS===b&&e.wrapT===b,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];o(l.width===i&&l.height===a,"inconsistent cube map face shape"),e.genMipmaps&&(o(!l.compressed,"can not generate mipmap for compressed textures"),o(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,h=0;h<16;++h){var f=c[h];if(f){var p=i>>h,d=a>>h;o(l.mipmask&1<<h,"missing mipmap data"),o(f.width===p&&f.height===d,"invalid shape for mip images"),o(f.format===t.format&&f.internalformat===t.internalformat&&f.type===t.type,"incompatible type for mip image"),f.compressed||(f.data?o(f.data.byteLength===p*d*Math.max(w(f.type,s),f.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):f.element||f.copy)}}}}}),C=0;function A(t,e){this.id=C++,this.type=t,this.data=e}function T(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function k(t){if(0===t.length)return[];var e=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&e===n&&('"'===e||"'"===e))return['"'+T(t.substr(1,t.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(r)return k(t.substr(0,r.index)).concat(k(r[1])).concat(k(t.substr(r.index+r[0].length)));var i=t.split(".");if(1===i.length)return['"'+T(t)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(k(i[a]));return o}function M(t){return"["+k(t).join("][")+"]"}var P={DynamicVariable:A,define:function(t,e){return new A(t,M(e+""))},isDynamic:function(t){return"function"==typeof t&&!t._reglType||t instanceof A},unbox:function t(e,n){return"function"==typeof e?new A(0,e):"number"==typeof e||"boolean"==typeof e?new A(5,e):Array.isArray(e)?new A(6,e.map((function(e,r){return t(e,n+"["+r+"]")}))):e instanceof A?e:void S(!1,"invalid option type in uniform "+n)},accessor:M},I={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},O="undefined"!=typeof my&&my&&"function"==typeof my.showToast?function(){return+new Date}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function R(t){return"string"==typeof t?t.split():(S(Array.isArray(t),"invalid extension array"),t)}function L(t){return"string"==typeof t?(S("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(t)):t}function D(t){var e,r,i,o,a,s=t||{},u={},l=[],c=[],h="undefined"==typeof window?1:window.devicePixelRatio,f=!1,p=function(t){t&&S.raise(t)},d=function(){};if("string"==typeof s?(S("undefined"!=typeof document,"selector queries only supported in DOM environments"),e=document.querySelector(s),S(e,"invalid query string for element")):"object"==typeof s?"string"==typeof(a=s).nodeName&&"function"==typeof a.appendChild&&"function"==typeof a.getBoundingClientRect?e=s:function(t){return"function"==typeof t.drawArrays||"function"==typeof t.drawElements}(s)?i=(o=s).canvas:(S.constructor(s),"gl"in s?o=s.gl:"canvas"in s?i=L(s.canvas):"container"in s&&(r=L(s.container)),"attributes"in s&&(u=s.attributes,S.type(u,"object","invalid context attributes")),"extensions"in s&&(l=R(s.extensions)),"optionalExtensions"in s&&(c=R(s.optionalExtensions)),"onDone"in s&&(S.type(s.onDone,"function","invalid or missing onDone callback"),p=s.onDone),"profile"in s&&(f=!!s.profile),"pixelRatio"in s&&(h=+s.pixelRatio,S(h>0,"invalid pixel ratio"))):S.raise("invalid arguments to regl"),e&&("canvas"===e.nodeName.toLowerCase()?i=e:r=e),!o){if(!i){S("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var g=function(t,e,r){var i,o=document.createElement("canvas");function a(){var e=window.innerWidth,n=window.innerHeight;if(t!==document.body){var i=o.getBoundingClientRect();e=i.right-i.left,n=i.bottom-i.top}o.width=r*e,o.height=r*n}return n(o.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),t.appendChild(o),t===document.body&&(o.style.position="absolute",n(t.style,{margin:0,padding:0})),t!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(t):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),t.removeChild(o)}}}(r||document.body,0,h);if(!g)return null;i=g.canvas,d=g.onDestroy}void 0===u.premultipliedAlpha&&(u.premultipliedAlpha=!0),o=function(t,e){function n(n){try{return t.getContext(n,e)}catch(t){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,u)}return o?{gl:o,canvas:i,container:r,extensions:l,optionalExtensions:c,pixelRatio:h,profile:f,onDone:p,onDestroy:d}:(d(),p("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function N(t,e){var n={};function r(e){S.type(e,"string","extension name must be string");var r,i=e.toLowerCase();try{r=n[i]=function(e){return t.getExtension(e)?t.getExtension(e):t.getExtension(e.toLowerCase())?t.getExtension(e.toLowerCase()):null}(e)}catch(t){}return!!r}for(var i=0;i<e.extensions.length;++i){var o=e.extensions[i];if(!r(o))return e.onDestroy(),e.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(t){if(n[t]&&!r(t))throw new Error("(regl): error restoring extension "+t)}))}}}function B(t,e){for(var n=Array(t),r=0;r<t;++r)n[r]=e(r);return n}function z(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function F(){var t=B(8,(function(){return[]}));function e(e){var n=function(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}(e),r=t[z(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(e){t[z(e.byteLength)>>2].push(e)}return{alloc:e,free:n,allocType:function(t,n){var r=null;switch(t){case 5120:r=new Int8Array(e(n),0,n);break;case 5121:r=new Uint8Array(e(n),0,n);break;case 5122:r=new Int16Array(e(2*n),0,n);break;case 5123:r=new Uint16Array(e(2*n),0,n);break;case 5124:r=new Int32Array(e(4*n),0,n);break;case 5125:r=new Uint32Array(e(4*n),0,n);break;case 5126:r=new Float32Array(e(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(t){n(t.buffer)}}}var Z=F();Z.zero=F();var j=3553,U=6408,G=5126,V=36160;function W(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var H=function(t){return Object.keys(t).map((function(e){return t[e]}))},X={shape:function(t){for(var e=[],n=t;n.length;n=n[0])e.push(n.length);return e},flatten:function(t,e,n,r){var i=1;if(e.length)for(var o=0;o<e.length;++o)i*=e[o];else i=0;var a=r||Z.allocType(n,i);switch(e.length){case 0:break;case 1:!function(t,e,n){for(var r=0;r<e;++r)n[r]=t[r]}(t,e[0],a);break;case 2:!function(t,e,n,r){for(var i=0,o=0;o<e;++o)for(var a=t[o],s=0;s<n;++s)r[i++]=a[s]}(t,e[0],e[1],a);break;case 3:Y(t,e[0],e[1],e[2],a,0);break;default:q(t,e,0,a,0)}return a}};function Y(t,e,n,r,i,o){for(var a=o,s=0;s<e;++s)for(var u=t[s],l=0;l<n;++l)for(var c=u[l],h=0;h<r;++h)i[a++]=c[h]}function q(t,e,n,r,i){for(var o=1,a=n+1;a<e.length;++a)o*=e[a];var s=e[n];if(e.length-n==4){var u=e[n+1],l=e[n+2],c=e[n+3];for(a=0;a<s;++a)Y(t[a],u,l,c,r,i),i+=o}else for(a=0;a<s;++a)q(t[a],e,n+1,r,i),i+=o}var K={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Q={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},J={dynamic:35048,stream:35040,static:35044},$=X.flatten,tt=X.shape,et=5121,nt=5126,rt=[];function it(t){return 0|K[Object.prototype.toString.call(t)]}function ot(t,e){for(var n=0;n<e.length;++n)t[n]=e[n]}function at(t,e,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)t[s++]=e[i*u+o*l+a]}rt[5120]=1,rt[5122]=2,rt[5124]=4,rt[5121]=1,rt[5123]=2,rt[5125]=4,rt[5126]=4;var st={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ut=5121,lt=5123,ct=5125,ht=34963;var ft=new Float32Array(1),pt=new Uint32Array(ft.buffer);function dt(t){for(var e=Z.allocType(5123,t.length),n=0;n<t.length;++n)if(isNaN(t[n]))e[n]=65535;else if(t[n]===1/0)e[n]=31744;else if(t[n]===-1/0)e[n]=64512;else{ft[0]=t[n];var r=pt[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)e[n]=i;else if(o<-14){var s=-14-o;e[n]=i+(a+1024>>s)}else e[n]=o>15?i+31744:i+(o+15<<10)+a}return e}function gt(t){return Array.isArray(t)||e(t)}var vt=function(t){return!(t&t-1||!t)},mt=3553,yt=34067,_t=34069,bt=6408,xt=6406,wt=6407,Et=6409,St=6410,Ct=32855,At=6402,Tt=34041,kt=35904,Mt=35906,Pt=36193,It=33776,Ot=33777,Rt=33778,Lt=33779,Dt=5121,Nt=5123,Bt=5125,zt=5126,Ft=33071,Zt=9728,jt=9984,Ut=9987,Gt=4352,Vt=33984,Wt=[jt,9986,9985,Ut],Ht=[0,Et,St,wt,bt],Xt={};function Yt(t){return"[object "+t+"]"}Xt[6409]=Xt[6406]=Xt[6402]=1,Xt[34041]=Xt[6410]=2,Xt[6407]=Xt[35904]=3,Xt[6408]=Xt[35906]=4;var qt=Yt("HTMLCanvasElement"),Kt=Yt("OffscreenCanvas"),Qt=Yt("CanvasRenderingContext2D"),Jt=Yt("ImageBitmap"),$t=Yt("HTMLImageElement"),te=Yt("HTMLVideoElement"),ee=Object.keys(K).concat([qt,Kt,Qt,Jt,$t,te]),ne=[];ne[5121]=1,ne[5126]=4,ne[36193]=2,ne[5123]=2,ne[5125]=4;var re=[];function ie(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function oe(t){return!!Array.isArray(t)&&!(0===t.length||!gt(t[0]))}function ae(t){return Object.prototype.toString.call(t)}function se(t){return ae(t)===qt}function ue(t){return ae(t)===Kt}function le(t){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&t&&t.getContext)}function ce(t){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&t&&"src"in t&&"crossOrigin"in t)}function he(t){if(!t)return!1;if(le(t)||ce(t))return!0;var e=ae(t);return ee.indexOf(e)>=0||ie(t)||oe(t)||W(t)}function fe(t){return 0|K[Object.prototype.toString.call(t)]}function pe(t,e){return Z.allocType(t.type===Pt?zt:t.type,e)}function de(t,e){t.type===Pt?(t.data=dt(e),Z.freeType(e)):t.data=e}function ge(t,e,n,r,i,o){var a;if(a=void 0!==re[t]?re[t]:Xt[t]*ne[e],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function ve(t,r,i,o,a,s,u){var l={"don't care":Gt,"dont care":Gt,nice:4354,fast:4353},c={repeat:10497,clamp:Ft,mirror:33648},h={nearest:Zt,linear:9729},f=n({mipmap:Ut,"nearest mipmap nearest":jt,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":Ut},h),p={none:0,browser:37444},d={uint8:Dt,rgba4:32819,rgb565:33635,"rgb5 a1":32820},g={alpha:xt,luminance:Et,"luminance alpha":St,rgb:wt,rgba:bt,rgba4:32854,"rgb5 a1":Ct,rgb565:36194},v={};r.ext_srgb&&(g.srgb=kt,g.srgba=Mt),r.oes_texture_float&&(d.float32=d.float=zt),r.oes_texture_half_float&&(d.float16=d["half float"]=Pt),r.webgl_depth_texture&&(n(g,{depth:At,"depth stencil":Tt}),n(d,{uint16:Nt,uint32:Bt,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&n(v,{"rgb s3tc dxt1":It,"rgba s3tc dxt1":Ot,"rgba s3tc dxt3":Rt,"rgba s3tc dxt5":Lt}),r.webgl_compressed_texture_atc&&n(v,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&n(v,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(v["rgb etc1"]=36196);var m=Array.prototype.slice.call(t.getParameter(34467)||new Uint32Array(0));Object.keys(v).forEach((function(t){var e=v[t];m.indexOf(e)>=0&&(g[t]=e)}));var y=Object.keys(g);i.textureFormats=y;var _=[];Object.keys(g).forEach((function(t){var e=g[t];_[e]=t}));var b=[];Object.keys(d).forEach((function(t){var e=d[t];b[e]=t}));var x=[];Object.keys(h).forEach((function(t){x[h[t]]=t}));var w=[];Object.keys(f).forEach((function(t){var e=f[t];w[e]=t}));var E=[];Object.keys(c).forEach((function(t){E[c[t]]=t}));var C=y.reduce((function(t,e){var n=g[e];return n===Et||n===xt||n===Et||n===St||n===At||n===Tt||r.ext_srgb&&(n===kt||n===Mt)?t[n]=n:n===Ct||e.indexOf("rgba")>=0?t[n]=bt:t[n]=wt,t}),{});function A(){this.internalformat=bt,this.format=bt,this.type=Dt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function T(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function k(t,e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(S.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(S.type(e.flipY,"boolean","invalid texture flip"),t.flipY=e.flipY),"alignment"in e&&(S.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),t.unpackAlignment=e.alignment),"colorSpace"in e&&(S.parameter(e.colorSpace,p,"invalid colorSpace"),t.colorSpace=p[e.colorSpace]),"type"in e){var n=e.type;S(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),S(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),S(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),S.parameter(n,d,"invalid texture type"),t.type=d[n]}var o=t.width,a=t.height,s=t.channels,u=!1;"shape"in e?(S(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),o=e.shape[0],a=e.shape[1],3===e.shape.length&&(s=e.shape[2],S(s>0&&s<=4,"invalid number of channels"),u=!0),S(o>=0&&o<=i.maxTextureSize,"invalid width"),S(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in e&&(o=a=e.radius,S(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in e&&(o=e.width,S(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in e&&(a=e.height,S(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in e&&(s=e.channels,S(s>0&&s<=4,"invalid number of channels"),u=!0)),t.width=0|o,t.height=0|a,t.channels=0|s;var l=!1;if("format"in e){var c=e.format;S(r.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),S.parameter(c,g,"invalid texture format");var h=t.internalformat=g[c];t.format=C[h],c in d&&("type"in e||(t.type=d[c])),c in v&&(t.compressed=!0),l=!0}!u&&l?t.channels=Xt[t.format]:u&&!l?t.channels!==Ht[t.format]&&(t.format=t.internalformat=Ht[t.channels]):l&&u&&S(t.channels===Xt[t.format],"number of channels inconsistent with specified format")}}function M(e){t.pixelStorei(37440,e.flipY),t.pixelStorei(37441,e.premultiplyAlpha),t.pixelStorei(37443,e.colorSpace),t.pixelStorei(3317,e.unpackAlignment)}function P(){A.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function I(t,n){var r=null;if(he(n)?r=n:n&&(S.type(n,"object","invalid pixel data type"),k(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),he(n.data)&&(r=n.data)),S(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){S(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,S(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=o&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==Dt||(t.type=fe(r));else if(ie(r))t.channels=t.channels||4,function(t,e){var n=e.length;switch(t.type){case Dt:case Nt:case Bt:case zt:var r=Z.allocType(t.type,n);r.set(e),t.data=r;break;case Pt:t.data=dt(e);break;default:S.raise("unsupported texture type, must specify a typed array")}}(t,r),t.alignment=1,t.needsFree=!0;else if(W(r)){var u=r.data;Array.isArray(u)||t.type!==Dt||(t.type=fe(u));var l,c,h,f,p,d,g=r.shape,v=r.stride;3===g.length?(h=g[2],d=v[2]):(S(2===g.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,d=1),l=g[0],c=g[1],f=v[0],p=v[1],t.alignment=1,t.width=l,t.height=c,t.channels=h,t.format=t.internalformat=Ht[h],t.needsFree=!0,function(t,e,n,r,i,o){for(var a=t.width,s=t.height,u=t.channels,l=pe(t,a*s*u),c=0,h=0;h<s;++h)for(var f=0;f<a;++f)for(var p=0;p<u;++p)l[c++]=e[n*f+r*h+i*p+o];de(t,l)}(t,u,f,p,d,r.offset)}else if(le(r)||se(r)||ue(r)||ae(r)===Qt)le(r)||se(r)||ue(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(t){return ae(t)===Jt}(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(t){return ae(t)===$t}(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(ce(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(t){return ae(t)===te}(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(oe(r)){var m=t.width||r[0].length,y=t.height||r.length,_=t.channels;_=gt(r[0][0])?_||r[0][0].length:_||1;for(var b=X.shape(r),x=1,w=0;w<b.length;++w)x*=b[w];var E=pe(t,x);X.flatten(r,b,"",E),de(t,E),t.alignment=1,t.width=m,t.height=y,t.channels=_,t.format=t.internalformat=Ht[_],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===zt?S(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===Pt&&S(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function O(e,n,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,l=e.type,c=e.width,h=e.height;M(e),i?t.texImage2D(n,r,u,u,l,i):e.compressed?t.compressedTexImage2D(n,r,s,c,h,0,a):e.needsCopy?(o(),t.copyTexImage2D(n,r,u,e.xOffset,e.yOffset,c,h,0)):t.texImage2D(n,r,u,c,h,0,u,l,a||null)}function R(e,n,r,i,a){var s=e.element,u=e.data,l=e.internalformat,c=e.format,h=e.type,f=e.width,p=e.height;M(e),s?t.texSubImage2D(n,a,r,i,c,h,s):e.compressed?t.compressedTexSubImage2D(n,a,r,i,l,f,p,u):e.needsCopy?(o(),t.copyTexSubImage2D(n,a,r,i,e.xOffset,e.yOffset,f,p)):t.texSubImage2D(n,a,r,i,f,p,c,h,u)}var L=[];function D(){return L.pop()||new P}function N(t){t.needsFree&&Z.freeType(t.data),P.call(t),L.push(t)}function B(){A.call(this),this.genMipmaps=!1,this.mipmapHint=Gt,this.mipmask=0,this.images=Array(16)}function z(t,e,n){var r=t.images[0]=D();t.mipmask=1,r.width=t.width=e,r.height=t.height=n,r.channels=t.channels=4}function F(t,e){var n=null;if(he(e))T(n=t.images[0]=D(),t),I(n,e),t.mipmask=1;else if(k(t,e),Array.isArray(e.mipmap))for(var r=e.mipmap,i=0;i<r.length;++i)T(n=t.images[i]=D(),t),n.width>>=i,n.height>>=i,I(n,r[i]),t.mipmask|=1<<i;else T(n=t.images[0]=D(),t),I(n,e),t.mipmask=1;T(t,t.images[0]),!t.compressed||t.internalformat!==It&&t.internalformat!==Ot&&t.internalformat!==Rt&&t.internalformat!==Lt||S(t.width%4==0&&t.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function j(t,e){for(var n=t.images,r=0;r<n.length;++r){if(!n[r])return;O(n[r],e,r)}}var U=[];function G(){var t=U.pop()||new B;A.call(t),t.mipmask=0;for(var e=0;e<16;++e)t.images[e]=null;return t}function V(t){for(var e=t.images,n=0;n<e.length;++n)e[n]&&N(e[n]),e[n]=null;U.push(t)}function Y(){this.minFilter=Zt,this.magFilter=Zt,this.wrapS=Ft,this.wrapT=Ft,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Gt}function q(t,e){if("min"in e){var n=e.min;S.parameter(n,f),t.minFilter=f[n],Wt.indexOf(t.minFilter)>=0&&!("faces"in e)&&(t.genMipmaps=!0)}if("mag"in e){var r=e.mag;S.parameter(r,h),t.magFilter=h[r]}var o=t.wrapS,a=t.wrapT;if("wrap"in e){var s=e.wrap;"string"==typeof s?(S.parameter(s,c),o=a=c[s]):Array.isArray(s)&&(S.parameter(s[0],c),S.parameter(s[1],c),o=c[s[0]],a=c[s[1]])}else{if("wrapS"in e){var u=e.wrapS;S.parameter(u,c),o=c[u]}if("wrapT"in e){var p=e.wrapT;S.parameter(p,c),a=c[p]}}if(t.wrapS=o,t.wrapT=a,"anisotropic"in e){var d=e.anisotropic;S("number"==typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),t.anisotropic=e.anisotropic}if("mipmap"in e){var g=!1;switch(typeof e.mipmap){case"string":S.parameter(e.mipmap,l,"invalid mipmap hint"),t.mipmapHint=l[e.mipmap],t.genMipmaps=!0,g=!0;break;case"boolean":g=t.genMipmaps=e.mipmap;break;case"object":S(Array.isArray(e.mipmap),"invalid mipmap type"),t.genMipmaps=!1,g=!0;break;default:S.raise("invalid mipmap type")}g&&!("min"in e)&&(t.minFilter=jt)}}function K(e,n){t.texParameteri(n,10241,e.minFilter),t.texParameteri(n,10240,e.magFilter),t.texParameteri(n,10242,e.wrapS),t.texParameteri(n,10243,e.wrapT),r.ext_texture_filter_anisotropic&&t.texParameteri(n,34046,e.anisotropic),e.genMipmaps&&(t.hint(33170,e.mipmapHint),t.generateMipmap(n))}var Q=0,J={},$=i.maxTextureUnits,tt=Array($).map((function(){return null}));function et(e){A.call(this),this.mipmask=0,this.internalformat=bt,this.id=Q++,this.refCount=1,this.target=e,this.texture=t.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Y,u.profile&&(this.stats={size:0})}function nt(e){t.activeTexture(Vt),t.bindTexture(e.target,e.texture)}function rt(){var e=tt[0];e?t.bindTexture(e.target,e.texture):t.bindTexture(mt,null)}function it(e){var n=e.texture;S(n,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(t.activeTexture(Vt+r),t.bindTexture(i,null),tt[r]=null),t.deleteTexture(n),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete J[e.id],s.textureCount--}return n(et.prototype,{bind:function(){var e=this;e.bindCount+=1;var n=e.unit;if(n<0){for(var r=0;r<$;++r){var i=tt[r];if(i){if(i.bindCount>0)continue;i.unit=-1}tt[r]=e,n=r;break}n>=$&&S.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<n+1&&(s.maxTextureUnits=n+1),e.unit=n,t.activeTexture(Vt+n),t.bindTexture(e.target,e.texture)}return n},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&it(this)}}),u.profile&&(s.getTotalTextureSize=function(){var t=0;return Object.keys(J).forEach((function(e){t+=J[e].stats.size})),t}),{create2D:function(e,n){var r=new et(mt);function o(t,e){var n=r.texInfo;Y.call(n);var a=G();return"number"==typeof t?z(a,0|t,"number"==typeof e?0|e:0|t):t?(S.type(t,"object","invalid arguments to regl.texture"),q(n,t),F(a,t)):z(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,T(r,a),S.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,nt(r),j(a,mt),K(n,mt),rt(),V(a),u.profile&&(r.stats.size=ge(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=_[r.internalformat],o.type=b[r.type],o.mag=x[n.magFilter],o.min=w[n.minFilter],o.wrapS=E[n.wrapS],o.wrapT=E[n.wrapT],o}return J[r.id]=r,s.textureCount++,o(e,n),o.subimage=function(t,e,n,i){S(!!t,"must specify image data");var a=0|e,s=0|n,u=0|i,l=D();return T(l,r),l.width=0,l.height=0,I(l,t),l.width=l.width||(r.width>>u)-a,l.height=l.height||(r.height>>u)-s,S(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),S(a>=0&&s>=0&&a+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),S(r.mipmask&1<<u,"missing mipmap data"),S(l.data||l.element||l.needsCopy,"missing image data"),nt(r),R(l,mt,a,s,u),rt(),N(l),o},o.resize=function(e,n){var i=0|e,a=0|n||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,nt(r);for(var s=0;r.mipmask>>s;++s){var l=i>>s,c=a>>s;if(!l||!c)break;t.texImage2D(mt,s,r.format,l,c,0,r.format,r.type,null)}return rt(),u.profile&&(r.stats.size=ge(r.internalformat,r.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(e,n,r,o,a,l){var c=new et(yt);J[c.id]=c,s.cubeCount++;var h=new Array(6);function f(t,e,n,r,o,a){var s,l=c.texInfo;for(Y.call(l),s=0;s<6;++s)h[s]=G();if("number"!=typeof t&&t)if("object"==typeof t)if(e)F(h[0],t),F(h[1],e),F(h[2],n),F(h[3],r),F(h[4],o),F(h[5],a);else if(q(l,t),k(c,t),"faces"in t){var p=t.faces;for(S(Array.isArray(p)&&6===p.length,"cube faces must be a length 6 array"),s=0;s<6;++s)S("object"==typeof p[s]&&!!p[s],"invalid input for cube map face"),T(h[s],c),F(h[s],p[s])}else for(s=0;s<6;++s)F(h[s],t);else S.raise("invalid arguments to cube map");else{var d=0|t||1;for(s=0;s<6;++s)z(h[s],d,d)}for(T(c,h[0]),S.optional((function(){i.npotTextureCube||S(vt(c.width)&&vt(c.height),"your browser does not support non power or two texture dimensions")})),l.genMipmaps?c.mipmask=(h[0].width<<1)-1:c.mipmask=h[0].mipmask,S.textureCube(c,l,h,i),c.internalformat=h[0].internalformat,f.width=h[0].width,f.height=h[0].height,nt(c),s=0;s<6;++s)j(h[s],_t+s);for(K(l,yt),rt(),u.profile&&(c.stats.size=ge(c.internalformat,c.type,f.width,f.height,l.genMipmaps,!0)),f.format=_[c.internalformat],f.type=b[c.type],f.mag=x[l.magFilter],f.min=w[l.minFilter],f.wrapS=E[l.wrapS],f.wrapT=E[l.wrapT],s=0;s<6;++s)V(h[s]);return f}return f(e,n,r,o,a,l),f.subimage=function(t,e,n,r,i){S(!!e,"must specify image data"),S("number"==typeof t&&t===(0|t)&&t>=0&&t<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=D();return T(u,c),u.width=0,u.height=0,I(u,e),u.width=u.width||(c.width>>s)-o,u.height=u.height||(c.height>>s)-a,S(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),S(o>=0&&a>=0&&o+u.width<=c.width&&a+u.height<=c.height,"texture.subimage write out of bounds"),S(c.mipmask&1<<s,"missing mipmap data"),S(u.data||u.element||u.needsCopy,"missing image data"),nt(c),R(u,_t+t,o,a,s),rt(),N(u),f},f.resize=function(e){var n=0|e;if(n!==c.width){f.width=c.width=n,f.height=c.height=n,nt(c);for(var r=0;r<6;++r)for(var i=0;c.mipmask>>i;++i)t.texImage2D(_t+r,i,c.format,n>>i,n>>i,0,c.format,c.type,null);return rt(),u.profile&&(c.stats.size=ge(c.internalformat,c.type,f.width,f.height,!1,!0)),f}},f._reglType="textureCube",f._texture=c,u.profile&&(f.stats=c.stats),f.destroy=function(){c.decRef()},f},clear:function(){for(var e=0;e<$;++e)t.activeTexture(Vt+e),t.bindTexture(mt,null),tt[e]=null;H(J).forEach(it),s.cubeCount=0,s.textureCount=0},getTexture:function(t){return null},restore:function(){for(var e=0;e<$;++e){var n=tt[e];n&&(n.bindCount=0,n.unit=-1,tt[e]=null)}H(J).forEach((function(e){e.texture=t.createTexture(),t.bindTexture(e.target,e.texture);for(var n=0;n<32;++n)if(0!=(e.mipmask&1<<n))if(e.target===mt)t.texImage2D(mt,n,e.internalformat,e.width>>n,e.height>>n,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)t.texImage2D(_t+r,n,e.internalformat,e.width>>n,e.height>>n,0,e.internalformat,e.type,null);K(e.texInfo,e.target)}))},refresh:function(){for(var e=0;e<$;++e){var n=tt[e];n&&(n.bindCount=0,n.unit=-1,tt[e]=null),t.activeTexture(Vt+e),t.bindTexture(mt,null),t.bindTexture(yt,null)}}}}re[32854]=2,re[32855]=2,re[36194]=2,re[34041]=4,re[33776]=.5,re[33777]=.5,re[33778]=1,re[33779]=1,re[35986]=.5,re[35987]=1,re[34798]=1,re[35840]=.5,re[35841]=.25,re[35842]=.5,re[35843]=.25,re[36196]=.5;var me=36161,ye=32854,_e=[];function be(t,e,n){return _e[t]*e*n}_e[32854]=2,_e[32855]=2,_e[36194]=2,_e[33189]=2,_e[36168]=1,_e[34041]=4,_e[35907]=4,_e[34836]=16,_e[34842]=8,_e[34843]=6;var xe=36160,we=36161,Ee=3553,Se=34069,Ce=[6407,6408],Ae=[];Ae[6408]=4,Ae[6407]=3;var Te=[];Te[5121]=1,Te[5126]=4,Te[36193]=2;var ke=[32854,32855,36194,35907,34842,34843,34836],Me={};Me[36053]="complete",Me[36054]="incomplete attachment",Me[36057]="incomplete dimensions",Me[36055]="incomplete, missing attachment",Me[36061]="unsupported";var Pe=34963,Ie=["attributes","elements","offset","count","primitive","instances"];function Oe(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}var Re=5121,Le=5126;function De(t,n,r,i,o,a,s){function u(u){var l;null===n.next?(S(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=Re):(S(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,S.optional((function(){a.oes_texture_float?(S(l===Re||l===Le,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),l===Le&&S(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):S(l===Re,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var c=0,h=0,f=i.framebufferWidth,p=i.framebufferHeight,d=null;e(u)?d=u:u&&(S.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,h=0|u.y,S(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),S(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),f=0|(u.width||i.framebufferWidth-c),p=0|(u.height||i.framebufferHeight-h),d=u.data||null),d&&(l===Re?S(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):l===Le&&S(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),S(f>0&&f+c<=i.framebufferWidth,"invalid width for read pixels"),S(p>0&&p+h<=i.framebufferHeight,"invalid height for read pixels"),r();var g=f*p*4;return d||(l===Re?d=new Uint8Array(g):l===Le&&(d=d||new Float32Array(g))),S.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),S(d.byteLength>=g,"data buffer for regl.read() too small"),t.pixelStorei(3333,4),t.readPixels(c,h,f,p,6408,l,d),d}return function(t){return t&&"framebuffer"in t?function(t){var e;return n.setFBO({framebuffer:t.framebuffer},(function(){e=u(t)})),e}(t):u(t)}}function Ne(t){return Array.prototype.slice.call(t)}function Be(t){return Ne(t).join("")}var ze="xyzw".split(""),Fe="dither",Ze="blend.enable",je="blend.color",Ue="blend.equation",Ge="blend.func",Ve="depth.enable",We="depth.func",He="depth.range",Xe="depth.mask",Ye="colorMask",qe="cull.enable",Ke="cull.face",Qe="frontFace",Je="lineWidth",$e="polygonOffset.enable",tn="polygonOffset.offset",en="sample.alpha",nn="sample.enable",rn="sample.coverage",on="stencil.enable",an="stencil.mask",sn="stencil.func",un="stencil.opFront",ln="stencil.opBack",cn="scissor.enable",hn="scissor.box",fn="viewport",pn="profile",dn="framebuffer",gn="vert",vn="frag",mn="elements",yn="primitive",_n="count",bn="offset",xn="instances",wn="vao",En="Width",Sn="Height",Cn=dn+En,An=dn+Sn,Tn="drawingBufferWidth",kn="drawingBufferHeight",Mn=[Ge,Ue,sn,un,ln,rn,fn,hn,tn],Pn=34962,In=34963,On=5126,Rn=35664,Ln=35665,Dn=35666,Nn=5124,Bn=35667,zn=35668,Fn=35669,Zn=35670,jn=35671,Un=35672,Gn=35673,Vn=35674,Wn=35675,Hn=35676,Xn=35678,Yn=35680,qn=1028,Kn=1029,Qn=2305,Jn=7680,$n={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},tr=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],er={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},nr={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},rr={frag:35632,vert:35633},ir={cw:2304,ccw:Qn};function or(t){return Array.isArray(t)||e(t)||W(t)}function ar(t){return t.sort((function(t,e){return t===fn?-1:e===fn?1:t<e?-1:1}))}function sr(t,e,n,r){this.thisDep=t,this.contextDep=e,this.propDep=n,this.append=r}function ur(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function lr(t){return new sr(!1,!1,!1,t)}function cr(t,e){var n=t.type;if(0===n){var r=t.data.length;return new sr(!0,r>=1,r>=2,e)}if(4===n){var i=t.data;return new sr(i.thisDep,i.contextDep,i.propDep,e)}if(5===n)return new sr(!1,!1,!1,e);if(6===n){for(var o=!1,a=!1,s=!1,u=0;u<t.data.length;++u){var l=t.data[u];if(1===l.type)s=!0;else if(2===l.type)a=!0;else if(3===l.type)o=!0;else if(0===l.type){o=!0;var c=l.data;c>=1&&(a=!0),c>=2&&(s=!0)}else 4===l.type&&(o=o||l.data.thisDep,a=a||l.data.contextDep,s=s||l.data.propDep)}return new sr(o,a,s,e)}return new sr(3===n,2===n,1===n,e)}var hr=new sr(!1,!1,!1,(function(){}));function fr(e,r,i,o,a,s,u,l,c,h,f,p,d,g,v){var m=h.Record,y={add:32774,subtract:32778,"reverse subtract":32779};i.ext_blend_minmax&&(y.min=32775,y.max=32776);var _=i.angle_instanced_arrays,b=i.webgl_draw_buffers,x=i.oes_vertex_array_object,w={dirty:!0,profile:v.profile},E={},C=[],A={},T={};function k(t){return t.replace(".","_")}function M(t,e,n){var r=k(t);C.push(t),E[r]=w[r]=!!n,A[r]=e}function I(t,e,n){var r=k(t);C.push(t),Array.isArray(n)?(w[r]=n.slice(),E[r]=n.slice()):w[r]=E[r]=n,T[r]=e}M(Fe,3024),M(Ze,3042),I(je,"blendColor",[0,0,0,0]),I(Ue,"blendEquationSeparate",[32774,32774]),I(Ge,"blendFuncSeparate",[1,0,1,0]),M(Ve,2929,!0),I(We,"depthFunc",513),I(He,"depthRange",[0,1]),I(Xe,"depthMask",!0),I(Ye,Ye,[!0,!0,!0,!0]),M(qe,2884),I(Ke,"cullFace",Kn),I(Qe,Qe,Qn),I(Je,Je,1),M($e,32823),I(tn,"polygonOffset",[0,0]),M(en,32926),M(nn,32928),I(rn,"sampleCoverage",[1,!1]),M(on,2960),I(an,"stencilMask",-1),I(sn,"stencilFunc",[519,0,-1]),I(un,"stencilOpSeparate",[qn,Jn,Jn,Jn]),I(ln,"stencilOpSeparate",[Kn,Jn,Jn,Jn]),M(cn,3089),I(hn,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),I(fn,fn,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var O={gl:e,context:d,strings:r,next:E,current:w,draw:p,elements:s,buffer:a,shader:f,attributes:h.state,vao:h,uniforms:c,framebuffer:l,extensions:i,timer:g,isBufferArgs:or},R={primTypes:st,compareFuncs:er,blendFuncs:$n,blendEquations:y,stencilOps:nr,glTypes:Q,orientationType:ir};S.optional((function(){O.isArrayLike=gt})),b&&(R.backBuffer=[Kn],R.drawBuffer=B(o.maxDrawbuffers,(function(t){return 0===t?[0]:B(t,(function(t){return 36064+t}))})));var L=0;function D(){var e=function(){var e=0,r=[],i=[];function o(){var t=[],r=[];return n((function(){t.push.apply(t,Ne(arguments))}),{def:function(){var n="v"+e++;return r.push(n),arguments.length>0&&(t.push(n,"="),t.push.apply(t,Ne(arguments)),t.push(";")),n},toString:function(){return Be([r.length>0?"var "+r.join(",")+";":"",Be(t)])}})}function a(){var t=o(),e=o(),r=t.toString,i=e.toString;function a(n,r){e(n,r,"=",t.def(n,r),";")}return n((function(){t.apply(t,Ne(arguments))}),{def:t.def,entry:t,exit:e,save:a,set:function(e,n,r){a(e,n),t(e,n,"=",r,";")},toString:function(){return r()+i()}})}var s=o(),u={};return{global:s,link:function(t){for(var n=0;n<i.length;++n)if(i[n]===t)return r[n];var o="g"+e++;return r.push(o),i.push(t),o},block:o,proc:function(t,e){var r=[];function i(){var t="a"+r.length;return r.push(t),t}e=e||0;for(var o=0;o<e;++o)i();var s=a(),l=s.toString;return u[t]=n(s,{arg:i,toString:function(){return Be(["function(",r.join(),"){",l(),"}"])}})},scope:a,cond:function(){var t=Be(arguments),e=a(),r=a(),i=e.toString,o=r.toString;return n(e,{then:function(){return e.apply(e,Ne(arguments)),this},else:function(){return r.apply(r,Ne(arguments)),this},toString:function(){var e=o();return e&&(e="else{"+e+"}"),Be(["if(",t,"){",i(),"}",e])}})},compile:function(){var e=['"use strict";',s,"return {"];Object.keys(u).forEach((function(t){e.push('"',t,'":',u[t].toString(),",")})),e.push("}");var n=Be(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return("undefined"!=typeof my&&my&&"function"==typeof my.showToast?t.Function.apply(null,r.concat(n)):Function.apply(null,r.concat(n))).apply(null,i)}}}(),i=e.link,o=e.global;e.id=L++,e.batchId="0";var a=i(O),s=e.shared={props:"a0"};Object.keys(O).forEach((function(t){s[t]=o.def(a,".",t)})),S.optional((function(){e.CHECK=i(S),e.commandStr=S.guessCommand(),e.command=i(e.commandStr),e.assert=function(t,e,n){t("if(!(",e,"))",this.CHECK,".commandRaise(",i(n),",",this.command,");")},R.invalidBlendCombinations=tr}));var u=e.next={},l=e.current={};Object.keys(T).forEach((function(t){Array.isArray(w[t])&&(u[t]=o.def(s.next,".",t),l[t]=o.def(s.current,".",t))}));var c=e.constants={};Object.keys(R).forEach((function(t){c[t]=o.def(JSON.stringify(R[t]))})),e.invoke=function(t,n){switch(n.type){case 0:var r=["this",s.context,s.props,e.batchId];return t.def(i(n.data),".call(",r.slice(0,Math.max(n.data.length+1,4)),")");case 1:return t.def(s.props,n.data);case 2:return t.def(s.context,n.data);case 3:return t.def("this",n.data);case 4:return n.data.append(e,t),n.data.ref;case 5:return n.data.toString();case 6:return n.data.map((function(n){return e.invoke(t,n)}))}},e.attribCache={};var f={};return e.scopeAttrib=function(t){var e=r.id(t);if(e in f)return f[e];var n=h.scope[e];return n||(n=h.scope[e]=new m),f[e]=i(n)},e}function N(t,e,n,u,c){var p=t.static,d=t.dynamic;S.optional((function(){var t=[dn,gn,vn,mn,yn,bn,_n,xn,pn,wn].concat(C);function e(e){Object.keys(e).forEach((function(e){S.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',c.commandStr)}))}e(p),e(d)}));var g=function(t,e){var n=t.static;if("string"==typeof n[vn]&&"string"==typeof n[gn]){if(Object.keys(e.dynamic).length>0)return null;var r=e.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)S("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(t,e),v=function(t,e){var n=t.static,r=t.dynamic;if(dn in n){var i=n[dn];return i?(i=l.getFramebuffer(i),S.command(i,"invalid framebuffer object"),lr((function(t,e){var n=t.link(i),r=t.shared;e.set(r.framebuffer,".next",n);var o=r.context;return e.set(o,"."+Cn,n+".width"),e.set(o,"."+An,n+".height"),n}))):lr((function(t,e){var n=t.shared;e.set(n.framebuffer,".next","null");var r=n.context;return e.set(r,"."+Cn,r+"."+Tn),e.set(r,"."+An,r+"."+kn),"null"}))}if(dn in r){var o=r[dn];return cr(o,(function(t,e){var n=t.invoke(e,o),r=t.shared,i=r.framebuffer,a=e.def(i,".getFramebuffer(",n,")");S.optional((function(){t.assert(e,"!"+n+"||"+a,"invalid framebuffer object")})),e.set(i,".next",a);var s=r.context;return e.set(s,"."+Cn,a+"?"+a+".width:"+s+"."+Tn),e.set(s,"."+An,a+"?"+a+".height:"+s+"."+kn),a}))}return null}(t),b=function(t,e,n){var r=t.static,i=t.dynamic;function o(t){if(t in r){var o=r[t];S.commandType(o,"object","invalid "+t,n.commandStr);var a,s,u=!0,l=0|o.x,c=0|o.y;return"width"in o?(a=0|o.width,S.command(a>=0,"invalid "+t,n.commandStr)):u=!1,"height"in o?(s=0|o.height,S.command(s>=0,"invalid "+t,n.commandStr)):u=!1,new sr(!u&&e&&e.thisDep,!u&&e&&e.contextDep,!u&&e&&e.propDep,(function(t,e){var n=t.shared.context,r=a;"width"in o||(r=e.def(n,".",Cn,"-",l));var i=s;return"height"in o||(i=e.def(n,".",An,"-",c)),[l,c,r,i]}))}if(t in i){var h=i[t],f=cr(h,(function(e,n){var r=e.invoke(n,h);S.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)}));var i=e.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Cn,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",An,"-",a,")");return S.optional((function(){e.assert(n,s+">=0&&"+u+">=0","invalid "+t)})),[o,a,s,u]}));return e&&(f.thisDep=f.thisDep||e.thisDep,f.contextDep=f.contextDep||e.contextDep,f.propDep=f.propDep||e.propDep),f}return e?new sr(e.thisDep,e.contextDep,e.propDep,(function(t,e){var n=t.shared.context;return[0,0,e.def(n,".",Cn),e.def(n,".",An)]})):null}var a=o(fn);if(a){var s=a;a=new sr(a.thisDep,a.contextDep,a.propDep,(function(t,e){var n=s.append(t,e),r=t.shared.context;return e.set(r,".viewportWidth",n[2]),e.set(r,".viewportHeight",n[3]),n}))}return{viewport:a,scissor_box:o(hn)}}(t,v,c),x=function(t,e){var n=t.static,r=t.dynamic,i={},o=!1,a=function(){if(wn in n){var t=n[wn];return null!==t&&null===h.getVAO(t)&&(t=h.createVAO(t)),o=!0,i.vao=t,lr((function(e){var n=h.getVAO(t);return n?e.link(n):"null"}))}if(wn in r){o=!0;var e=r[wn];return cr(e,(function(t,n){var r=t.invoke(n,e);return n.def(t.shared.vao+".getVAO("+r+")")}))}return null}(),u=!1,l=function(){if(mn in n){var t=n[mn];if(i.elements=t,or(t)){var l=i.elements=s.create(t,!0);t=s.getElements(l),u=!0}else t&&(t=s.getElements(t),u=!0,S.command(t,"invalid elements",e.commandStr));var c=lr((function(e,n){if(t){var r=e.link(t);return e.ELEMENTS=r,r}return e.ELEMENTS=null,null}));return c.value=t,c}if(mn in r){u=!0;var h=r[mn];return cr(h,(function(t,e){var n=t.shared,r=n.isBufferArgs,i=n.elements,o=t.invoke(e,h),a=e.def("null"),s=e.def(r,"(",o,")"),u=t.cond(s).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");");return S.optional((function(){t.assert(u.else,"!"+o+"||"+a,"invalid elements")})),e.entry(u),e.exit(t.cond(s).then(i,".destroyStream(",a,");")),t.ELEMENTS=a,a}))}return o?new sr(a.thisDep,a.contextDep,a.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.elements+".getElements("+t.shared.vao+".currentVAO.elements):null")})):null}();function c(t,s){if(t in n){var l=0|n[t];return s?i.offset=l:i.instances=l,S.command(!s||l>=0,"invalid "+t,e.commandStr),lr((function(t,e){return s&&(t.OFFSET=l),l}))}if(t in r){var c=r[t];return cr(c,(function(e,n){var r=e.invoke(n,c);return s&&(e.OFFSET=r,S.optional((function(){e.assert(n,r+">=0","invalid "+t)}))),r}))}if(s){if(u)return lr((function(t,e){return t.OFFSET=0,0}));if(o)return new sr(a.thisDep,a.contextDep,a.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.offset:0")}))}else if(o)return new sr(a.thisDep,a.contextDep,a.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.instances:-1")}));return null}var f=c(bn,!0),p=function(){if(yn in n){var t=n[yn];return i.primitive=t,S.commandParameter(t,st,"invalid primitve",e.commandStr),lr((function(e,n){return st[t]}))}if(yn in r){var s=r[yn];return cr(s,(function(t,e){var n=t.constants.primTypes,r=t.invoke(e,s);return S.optional((function(){t.assert(e,r+" in "+n,"invalid primitive, must be one of "+Object.keys(st))})),e.def(n,"[",r,"]")}))}return u?ur(l)?l.value?lr((function(t,e){return e.def(t.ELEMENTS,".primType")})):lr((function(){return 4})):new sr(l.thisDep,l.contextDep,l.propDep,(function(t,e){var n=t.ELEMENTS;return e.def(n,"?",n,".primType:",4)})):o?new sr(a.thisDep,a.contextDep,a.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.primitive:4")})):null}(),d=function(){if(_n in n){var t=0|n[_n];return i.count=t,S.command("number"==typeof t&&t>=0,"invalid vertex count",e.commandStr),lr((function(){return t}))}if(_n in r){var s=r[_n];return cr(s,(function(t,e){var n=t.invoke(e,s);return S.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(u){if(ur(l)){if(l)return f?new sr(f.thisDep,f.contextDep,f.propDep,(function(t,e){var n=e.def(t.ELEMENTS,".vertCount-",t.OFFSET);return S.optional((function(){t.assert(e,n+">=0","invalid vertex offset/element buffer too small")})),n})):lr((function(t,e){return e.def(t.ELEMENTS,".vertCount")}));var c=lr((function(){return-1}));return S.optional((function(){c.MISSING=!0})),c}var h=new sr(l.thisDep||f.thisDep,l.contextDep||f.contextDep,l.propDep||f.propDep,(function(t,e){var n=t.ELEMENTS;return t.OFFSET?e.def(n,"?",n,".vertCount-",t.OFFSET,":-1"):e.def(n,"?",n,".vertCount:-1")}));return S.optional((function(){h.DYNAMIC=!0})),h}if(o){var p=new sr(a.thisDep,a.contextDep,a.propDep,(function(t,e){return e.def(t.shared.vao,".currentVAO?",t.shared.vao,".currentVAO.count:-1")}));return p}return null}(),g=c(xn,!1);return{elements:l,primitive:p,count:d,instances:g,offset:f,vao:a,vaoActive:o,elementsActive:u,static:i}}(t,c),w=function(t,e){var n=t.static,r=t.dynamic,i={};return C.forEach((function(t){var a=k(t);function s(e,o){if(t in n){var s=e(n[t]);i[a]=lr((function(){return s}))}else if(t in r){var u=r[t];i[a]=cr(u,(function(t,e){return o(t,e,t.invoke(e,u))}))}}switch(t){case qe:case Ze:case Fe:case on:case Ve:case cn:case $e:case en:case nn:case Xe:return s((function(n){return S.commandType(n,"boolean",t,e.commandStr),n}),(function(e,n,r){return S.optional((function(){e.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+t,e.commandStr)})),r}));case We:return s((function(n){return S.commandParameter(n,er,"invalid "+t,e.commandStr),er[n]}),(function(e,n,r){var i=e.constants.compareFuncs;return S.optional((function(){e.assert(n,r+" in "+i,"invalid "+t+", must be one of "+Object.keys(er))})),n.def(i,"[",r,"]")}));case He:return s((function(t){return S.command(gt(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&t[0]<=t[1],"depth range is 2d array",e.commandStr),t}),(function(t,e,n){return S.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[e.def("+",n,"[0]"),e.def("+",n,"[1]")]}));case Ge:return s((function(t){S.commandType(t,"object","blend.func",e.commandStr);var n="srcRGB"in t?t.srcRGB:t.src,r="srcAlpha"in t?t.srcAlpha:t.src,i="dstRGB"in t?t.dstRGB:t.dst,o="dstAlpha"in t?t.dstAlpha:t.dst;return S.commandParameter(n,$n,a+".srcRGB",e.commandStr),S.commandParameter(r,$n,a+".srcAlpha",e.commandStr),S.commandParameter(i,$n,a+".dstRGB",e.commandStr),S.commandParameter(o,$n,a+".dstAlpha",e.commandStr),S.command(-1===tr.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",e.commandStr),[$n[n],$n[i],$n[r],$n[o]]}),(function(e,n,r){var i=e.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return S.optional((function(){e.assert(n,s+" in "+i,"invalid "+t+"."+o+a+", must be one of "+Object.keys($n))})),s}S.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");S.optional((function(){var t=e.constants.invalidBlendCombinations;e.assert(n,t+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),l=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),l,n.def(i,"[",o("dst","Alpha"),"]")]}));case Ue:return s((function(n){return"string"==typeof n?(S.commandParameter(n,y,"invalid "+t,e.commandStr),[y[n],y[n]]):"object"==typeof n?(S.commandParameter(n.rgb,y,t+".rgb",e.commandStr),S.commandParameter(n.alpha,y,t+".alpha",e.commandStr),[y[n.rgb],y[n.alpha]]):void S.commandRaise("invalid blend.equation",e.commandStr)}),(function(e,n,r){var i=e.constants.blendEquations,o=n.def(),a=n.def(),s=e.cond("typeof ",r,'==="string"');return S.optional((function(){function n(t,n,r){e.assert(t,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(y))}n(s.then,t,r),e.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+t),n(s.else,t+".rgb",r+".rgb"),n(s.else,t+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case je:return s((function(t){return S.command(gt(t)&&4===t.length,"blend.color must be a 4d array",e.commandStr),B(4,(function(e){return+t[e]}))}),(function(t,e,n){return S.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),B(4,(function(t){return e.def("+",n,"[",t,"]")}))}));case an:return s((function(t){return S.commandType(t,"number",a,e.commandStr),0|t}),(function(t,e,n){return S.optional((function(){t.assert(e,"typeof "+n+'==="number"',"invalid stencil.mask")})),e.def(n,"|0")}));case sn:return s((function(n){S.commandType(n,"object",a,e.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return S.commandParameter(r,er,t+".cmp",e.commandStr),S.commandType(i,"number",t+".ref",e.commandStr),S.commandType(o,"number",t+".mask",e.commandStr),[er[r],i,o]}),(function(t,e,n){var r=t.constants.compareFuncs;return S.optional((function(){function i(){t.assert(e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[e.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Jn),e.def(n,".ref|0"),e.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case un:case ln:return s((function(n){S.commandType(n,"object",a,e.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return S.commandParameter(r,nr,t+".fail",e.commandStr),S.commandParameter(i,nr,t+".zfail",e.commandStr),S.commandParameter(o,nr,t+".zpass",e.commandStr),[t===ln?Kn:qn,nr[r],nr[i],nr[o]]}),(function(e,n,r){var i=e.constants.stencilOps;function o(o){return S.optional((function(){e.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+t+"."+o+", must be one of "+Object.keys(nr))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",Jn)}return S.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[t===ln?Kn:qn,o("fail"),o("zfail"),o("zpass")]}));case tn:return s((function(t){S.commandType(t,"object",a,e.commandStr);var n=0|t.factor,r=0|t.units;return S.commandType(n,"number",a+".factor",e.commandStr),S.commandType(r,"number",a+".units",e.commandStr),[n,r]}),(function(e,n,r){return S.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Ke:return s((function(t){var n=0;return"front"===t?n=qn:"back"===t&&(n=Kn),S.command(!!n,a,e.commandStr),n}),(function(t,e,n){return S.optional((function(){t.assert(e,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),e.def(n,'==="front"?',qn,":",Kn)}));case Je:return s((function(t){return S.command("number"==typeof t&&t>=o.lineWidthDims[0]&&t<=o.lineWidthDims[1],"invalid line width, must be a positive number between "+o.lineWidthDims[0]+" and "+o.lineWidthDims[1],e.commandStr),t}),(function(t,e,n){return S.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">="+o.lineWidthDims[0]+"&&"+n+"<="+o.lineWidthDims[1],"invalid line width")})),n}));case Qe:return s((function(t){return S.commandParameter(t,ir,a,e.commandStr),ir[t]}),(function(t,e,n){return S.optional((function(){t.assert(e,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),e.def(n+'==="cw"?2304:'+Qn)}));case Ye:return s((function(t){return S.command(gt(t)&&4===t.length,"color.mask must be length 4 array",e.commandStr),t.map((function(t){return!!t}))}),(function(t,e,n){return S.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),B(4,(function(t){return"!!"+n+"["+t+"]"}))}));case rn:return s((function(t){S.command("object"==typeof t&&t,a,e.commandStr);var n="value"in t?t.value:1,r=!!t.invert;return S.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",e.commandStr),[n,r]}),(function(t,e,n){return S.optional((function(){t.assert(e,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[e.def('"value" in ',n,"?+",n,".value:1"),e.def("!!",n,".invert")]}))}})),i}(t,c),E=function(t,e,n){var i=t.static,o=t.dynamic;function a(t){if(t in i){var e=r.id(i[t]);S.optional((function(){f.shader(rr[t],e,S.guessCommand())}));var n=lr((function(){return e}));return n.id=e,n}if(t in o){var a=o[t];return cr(a,(function(e,n){var r=e.invoke(n,a),i=n.def(e.shared.strings,".id(",r,")");return S.optional((function(){n(e.shared.shader,".shader(",rr[t],",",i,",",e.command,");")})),i}))}return null}var s,u=a(vn),l=a(gn),c=null;return ur(u)&&ur(l)?(c=f.program(l.id,u.id,null,n),s=lr((function(t,e){return t.link(c)}))):s=new sr(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(t,e){var n,r=t.shared.shader;n=u?u.append(t,e):e.def(r,".",vn);var i=r+".program("+(l?l.append(t,e):e.def(r,".",gn))+","+n;return S.optional((function(){i+=","+t.command})),e.def(i+")")})),{frag:u,vert:l,progVar:s,program:c}}(t,0,g);function A(t){var e=b[t];e&&(w[t]=e)}A(fn),A(k(hn));var T=Object.keys(w).length>0,M={framebuffer:v,draw:x,shader:E,state:w,dirty:T,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(M.profile=function(t){var e,n=t.static,r=t.dynamic;if(pn in n){var i=!!n[pn];(e=lr((function(t,e){return i}))).enable=i}else if(pn in r){var o=r[pn];e=cr(o,(function(t,e){return t.invoke(e,o)}))}return e}(t),M.uniforms=function(t,e){var n=t.static,r=t.dynamic,i={};return Object.keys(n).forEach((function(t){var r,o=n[t];if("number"==typeof o||"boolean"==typeof o)r=lr((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=lr((function(t){return t.link(o)})):"framebuffer"===a||"framebufferCube"===a?(S.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',e.commandStr),r=lr((function(t){return t.link(o.color[0])}))):S.commandRaise('invalid data for uniform "'+t+'"',e.commandStr)}else gt(o)?r=lr((function(e){return e.global.def("[",B(o.length,(function(n){return S.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+t,e.commandStr),o[n]})),"]")})):S.commandRaise('invalid or missing data for uniform "'+t+'"',e.commandStr);r.value=o,i[t]=r})),Object.keys(r).forEach((function(t){var e=r[t];i[t]=cr(e,(function(t,n){return t.invoke(n,e)}))})),i}(n,c),M.drawVAO=M.scopeVAO=x.vao,!M.drawVAO&&E.program&&!g&&i.angle_instanced_arrays&&x.static.elements){var P=!0,I=E.program.attributes.map((function(t){var n=e.static[t];return P=P&&!!n,n}));if(P&&I.length>0){var O=h.getVAO(h.createVAO({attributes:I,elements:x.static.elements}));M.drawVAO=new sr(null,null,null,(function(t,e){return t.link(O)})),M.useVAO=!0}}return g?M.useVAO=!0:M.attributes=function(t,e){var n=t.static,i=t.dynamic,o={};return Object.keys(n).forEach((function(t){var i=n[t],s=r.id(t),u=new m;if(or(i))u.state=1,u.buffer=a.getBuffer(a.create(i,Pn,!1,!0)),u.type=0;else{var l=a.getBuffer(i);if(l)u.state=1,u.buffer=l,u.type=0;else if(S.command("object"==typeof i&&i,"invalid data for attribute "+t,e.commandStr),"constant"in i){var c=i.constant;u.buffer="null",u.state=2,"number"==typeof c?u.x=c:(S.command(gt(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+t,e.commandStr),ze.forEach((function(t,e){e<c.length&&(u[t]=c[e])})))}else{l=or(i.buffer)?a.getBuffer(a.create(i.buffer,Pn,!1,!0)):a.getBuffer(i.buffer),S.command(!!l,'missing buffer for attribute "'+t+'"',e.commandStr);var h=0|i.offset;S.command(h>=0,'invalid offset for attribute "'+t+'"',e.commandStr);var f=0|i.stride;S.command(f>=0&&f<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',e.commandStr);var p=0|i.size;S.command(!("size"in i)||p>0&&p<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',e.commandStr);var d=!!i.normalized,g=0;"type"in i&&(S.commandParameter(i.type,Q,"invalid type for attribute "+t,e.commandStr),g=Q[i.type]);var v=0|i.divisor;S.optional((function(){"divisor"in i&&(S.command(0===v||_,'cannot specify divisor for attribute "'+t+'", instancing not supported',e.commandStr),S.command(v>=0,'invalid divisor for attribute "'+t+'"',e.commandStr));var n=e.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(e){S.command(r.indexOf(e)>=0,'unknown parameter "'+e+'" for attribute pointer "'+t+'" (valid parameters are '+r+")",n)}))})),u.buffer=l,u.state=1,u.size=p,u.normalized=d,u.type=g||l.dtype,u.offset=h,u.stride=f,u.divisor=v}}o[t]=lr((function(t,e){var n=t.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(t){r[t]=u[t]})),u.buffer&&(r.buffer=t.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(t){var e=i[t];o[t]=cr(e,(function(n,r){var i=n.invoke(r,e),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;S.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+t+'"')}));var l={isStream:r.def(!1)},c=new m;c.state=1,Object.keys(c).forEach((function(t){l[t]=r.def(""+c[t])}));var h=l.buffer,f=l.type;function p(t){r(l[t],"=",i,".",t,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",h,"=",u,".createStream(",Pn,",",i,");",f,"=",h,".dtype;","}else{",h,"=",u,".getBuffer(",i,");","if(",h,"){",f,"=",h,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",2,";","if(typeof "+i+'.constant === "number"){',l[ze[0]],"=",i,".constant;",ze.slice(1).map((function(t){return l[t]})).join("="),"=0;","}else{",ze.map((function(t,e){return l[t]+"="+i+".constant.length>"+e+"?"+i+".constant["+e+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",h,"=",u,".createStream(",Pn,",",i,".buffer);","}else{",h,"=",u,".getBuffer(",i,".buffer);","}",f,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",h,".dtype;",l.normalized,"=!!",i,".normalized;"),p("size"),p("offset"),p("stride"),p("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",h,");","}"),l}))})),o}(e,c),M.context=function(t){var e=t.static,n=t.dynamic,r={};return Object.keys(e).forEach((function(t){var n=e[t];r[t]=lr((function(t,e){return"number"==typeof n||"boolean"==typeof n?""+n:t.link(n)}))})),Object.keys(n).forEach((function(t){var e=n[t];r[t]=cr(e,(function(t,n){return t.invoke(n,e)}))})),r}(u),M}function z(t,e,n){var r=t.shared.context,i=t.scope();Object.keys(n).forEach((function(o){e.save(r,"."+o);var a=n[o].append(t,e);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),e(i)}function F(t,e,n,r){var i,o=t.shared,a=o.gl,s=o.framebuffer;b&&(i=e.def(o.extensions,".webgl_draw_buffers"));var u,l=t.constants,c=l.drawBuffer,h=l.backBuffer;u=n?n.append(t,e):e.def(s,".next"),r||e("if(",u,"!==",s,".cur){"),e("if(",u,"){",a,".bindFramebuffer(",36160,",",u,".framebuffer);"),b&&e(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),e("}else{",a,".bindFramebuffer(",36160,",null);"),b&&e(i,".drawBuffersWEBGL(",h,");"),e("}",s,".cur=",u,";"),r||e("}")}function Z(t,e,n){var r=t.shared,i=r.gl,o=t.current,a=t.next,s=r.current,u=r.next,l=t.cond(s,".dirty");C.forEach((function(e){var r,c,h=k(e);if(!(h in n.state))if(h in a){r=a[h],c=o[h];var f=B(w[h].length,(function(t){return l.def(r,"[",t,"]")}));l(t.cond(f.map((function(t,e){return t+"!=="+c+"["+e+"]"})).join("||")).then(i,".",T[h],"(",f,");",f.map((function(t,e){return c+"["+e+"]="+t})).join(";"),";"))}else{r=l.def(u,".",h);var p=t.cond(r,"!==",s,".",h);l(p),h in A?p(t.cond(r).then(i,".enable(",A[h],");").else(i,".disable(",A[h],");"),s,".",h,"=",r,";"):p(i,".",T[h],"(",r,");",s,".",h,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),e(l)}function j(t,e,n,r){var i=t.shared,o=t.current,a=i.current,s=i.gl;ar(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(t,e);if(A[i]){var c=A[i];ur(u)?e(s,l?".enable(":".disable(",c,");"):e(t.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),e(a,".",i,"=",l,";")}else if(gt(l)){var h=o[i];e(s,".",T[i],"(",l,");",l.map((function(t,e){return h+"["+e+"]="+t})).join(";"),";")}else e(s,".",T[i],"(",l,");",a,".",i,"=",l,";")}}))}function U(t,e){_&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function G(t,e,n,r,i){var o,a,s,u=t.shared,l=t.stats,c=u.current,h=u.timer,f=n.profile;function p(){return"undefined"!=typeof my&&my&&"function"==typeof my.showToast||"undefined"==typeof performance?"Date.now()":"performance.now()"}function d(t){t(o=e.def(),"=",p(),";"),"string"==typeof i?t(l,".count+=",i,";"):t(l,".count++;"),g&&(r?t(a=e.def(),"=",h,".getNumPendingQueries();"):t(h,".beginQuery(",l,");"))}function v(t){t(l,".cpuTime+=",p(),"-",o,";"),g&&(r?t(h,".pushScopeStats(",a,",",h,".getNumPendingQueries(),",l,");"):t(h,".endQuery();"))}function m(t){var n=e.def(c,".profile");e(c,".profile=",t,";"),e.exit(c,".profile=",n,";")}if(f){if(ur(f))return void(f.enable?(d(e),v(e.exit),m("true")):m("false"));m(s=f.append(t,e))}else s=e.def(c,".profile");var y=t.block();d(y),e("if(",s,"){",y,"}");var _=t.block();v(_),e.exit("if(",s,"){",_,"}")}function V(t,e,n,r,i){var o=t.shared;r.forEach((function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(t,e)}else{if(!i(hr))return;var l=t.scopeAttrib(s);S.optional((function(){t.assert(e,l+".state","missing attribute "+s)})),a={},Object.keys(new m).forEach((function(t){a[t]=e.def(l,".",t)}))}!function(n,r,i){var a=o.gl,s=e.def(n,".location"),u=e.def(o.attributes,"[",s,"]"),l=i.state,c=i.buffer,h=[i.x,i.y,i.z,i.w],f=["buffer","normalized","offset","stride"];function p(){e("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?e.def(i.size,"||",r):r,e("if(",u,".type!==",o,"||",u,".size!==",n,"||",f.map((function(t){return u+"."+t+"!=="+i[t]})).join("||"),"){",a,".bindBuffer(",Pn,",",c,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",f.map((function(t){return u+"."+t+"="+i[t]+";"})).join(""),"}"),_){var l=i.divisor;e("if(",u,".divisor!==",l,"){",t.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function d(){e("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",ze.map((function(t,e){return u+"."+t+"!=="+h[e]})).join("||"),"){",a,".vertexAttrib4f(",s,",",h,");",ze.map((function(t,e){return u+"."+t+"="+h[e]+";"})).join(""),"}")}1===l?p():2===l?d():(e("if(",l,"===",1,"){"),p(),e("}else{"),d(),e("}"))}(t.link(r),function(t){switch(t){case Rn:case Bn:case jn:return 2;case Ln:case zn:case Un:return 3;case Dn:case Fn:case Gn:return 4;default:return 1}}(r.info.type),a)}))}function W(t,e,n,i,o,a){for(var s,u=t.shared,l=u.gl,c=0;c<i.length;++c){var h,f=i[c],p=f.name,d=f.info.type,g=n.uniforms[p],v=t.link(f)+".location";if(g){if(!o(g))continue;if(ur(g)){var m=g.value;if(S.command(null!=m,'missing uniform "'+p+'"',t.commandStr),d===Xn||d===Yn){S.command("function"==typeof m&&(d===Xn&&("texture2d"===m._reglType||"framebuffer"===m._reglType)||d===Yn&&("textureCube"===m._reglType||"framebufferCube"===m._reglType)),"invalid texture for uniform "+p,t.commandStr);var y=t.link(m._texture||m.color[0]._texture);e(l,".uniform1i(",v,",",y+".bind());"),e.exit(y,".unbind();")}else if(d===Vn||d===Wn||d===Hn){S.optional((function(){S.command(gt(m),"invalid matrix for uniform "+p,t.commandStr),S.command(d===Vn&&4===m.length||d===Wn&&9===m.length||d===Hn&&16===m.length,"invalid length for matrix uniform "+p,t.commandStr)}));var _=t.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])"),b=2;d===Wn?b=3:d===Hn&&(b=4),e(l,".uniformMatrix",b,"fv(",v,",false,",_,");")}else{switch(d){case On:S.commandType(m,"number","uniform "+p,t.commandStr),s="1f";break;case Rn:S.command(gt(m)&&2===m.length,"uniform "+p,t.commandStr),s="2f";break;case Ln:S.command(gt(m)&&3===m.length,"uniform "+p,t.commandStr),s="3f";break;case Dn:S.command(gt(m)&&4===m.length,"uniform "+p,t.commandStr),s="4f";break;case Zn:S.commandType(m,"boolean","uniform "+p,t.commandStr),s="1i";break;case Nn:S.commandType(m,"number","uniform "+p,t.commandStr),s="1i";break;case jn:case Bn:S.command(gt(m)&&2===m.length,"uniform "+p,t.commandStr),s="2i";break;case Un:case zn:S.command(gt(m)&&3===m.length,"uniform "+p,t.commandStr),s="3i";break;case Gn:case Fn:S.command(gt(m)&&4===m.length,"uniform "+p,t.commandStr),s="4i"}e(l,".uniform",s,"(",v,",",gt(m)?Array.prototype.slice.call(m):m,");")}continue}h=g.append(t,e)}else{if(!o(hr))continue;h=e.def(u.uniforms,"[",r.id(p),"]")}d===Xn?(S(!Array.isArray(h),"must specify a scalar prop for textures"),e("if(",h,"&&",h,'._reglType==="framebuffer"){',h,"=",h,".color[0];","}")):d===Yn&&(S(!Array.isArray(h),"must specify a scalar prop for cube maps"),e("if(",h,"&&",h,'._reglType==="framebufferCube"){',h,"=",h,".color[0];","}")),S.optional((function(){function n(n,r){t.assert(e,n,'bad data or missing for uniform "'+p+'".  '+r)}function r(t){S(!Array.isArray(h),"must not specify an array type for uniform"),n("typeof "+h+'==="'+t+'"',"invalid type, expected "+t)}function i(e,r){Array.isArray(h)?S(h.length===e,"must have length "+e):n(u.isArrayLike+"("+h+")&&"+h+".length==="+e,"invalid vector, should have length "+e,t.commandStr)}function o(e){S(!Array.isArray(h),"must not specify a value type"),n("typeof "+h+'==="function"&&'+h+'._reglType==="texture'+(3553===e?"2d":"Cube")+'"',"invalid texture type",t.commandStr)}switch(d){case Nn:r("number");break;case Bn:i(2);break;case zn:i(3);break;case Fn:i(4);break;case On:r("number");break;case Rn:i(2);break;case Ln:i(3);break;case Dn:i(4);break;case Zn:r("boolean");break;case jn:i(2);break;case Un:i(3);break;case Gn:case Vn:i(4);break;case Wn:i(9);break;case Hn:i(16);break;case Xn:o(3553);break;case Yn:o(34067)}}));var x=1;switch(d){case Xn:case Yn:var w=e.def(h,"._texture");e(l,".uniform1i(",v,",",w,".bind());"),e.exit(w,".unbind();");continue;case Nn:case Zn:s="1i";break;case Bn:case jn:s="2i",x=2;break;case zn:case Un:s="3i",x=3;break;case Fn:case Gn:s="4i",x=4;break;case On:s="1f";break;case Rn:s="2f",x=2;break;case Ln:s="3f",x=3;break;case Dn:s="4f",x=4;break;case Vn:s="Matrix2fv";break;case Wn:s="Matrix3fv";break;case Hn:s="Matrix4fv"}if("M"===s.charAt(0)){e(l,".uniform",s,"(",v,",");var E=Math.pow(d-Vn+2,2),C=t.global.def("new Float32Array(",E,")");Array.isArray(h)?e("false,(",B(E,(function(t){return C+"["+t+"]="+h[t]})),",",C,")"):e("false,(Array.isArray(",h,")||",h," instanceof Float32Array)?",h,":(",B(E,(function(t){return C+"["+t+"]="+h+"["+t+"]"})),",",C,")"),e(");")}else if(x>1){for(var A=[],T=[],k=0;k<x;++k)Array.isArray(h)?T.push(h[k]):T.push(e.def(h+"["+k+"]")),a&&A.push(e.def());a&&e("if(!",t.batchId,"||",A.map((function(t,e){return t+"!=="+T[e]})).join("||"),"){",A.map((function(t,e){return t+"="+T[e]+";"})).join("")),e(l,".uniform",s,"(",v,",",T.join(","),");"),a&&e("}")}else{if(S(!Array.isArray(h),"uniform value must not be an array"),a){var M=e.def();e("if(!",t.batchId,"||",M,"!==",h,"){",M,"=",h,";")}e(l,".uniform",s,"(",v,",",h,");"),a&&e("}")}}}function H(t,e,n,r){var i=t.shared,o=i.gl,a=i.draw,s=r.draw;var u=function(){var u,l=s.elements,c=e;return l?((l.contextDep&&r.contextDynamic||l.propDep)&&(c=n),u=l.append(t,c),s.elementsActive&&c("if("+u+")"+o+".bindBuffer("+"34963,"+u+".buffer.buffer);")):(u=c.def(),c(u,"=",a,".",mn,";","if(",u,"){",o,".bindBuffer(",In,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",t.shared.elements+".getElements("+i.vao,".currentVAO.elements);",x?"":"if("+u+")"+o+".bindBuffer("+"34963,"+u+".buffer.buffer);","}")),u}();function l(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(t,n):o.append(t,e):e.def(a,".",i)}var c,h,f=l(yn),p=l(bn),d=function(){var i,o=s.count,u=e;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(t,u),S.optional((function(){o.MISSING&&t.assert(e,"false","missing vertex count"),o.DYNAMIC&&t.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",_n),S.optional((function(){t.assert(u,i+">=0","missing vertex count")}))),i}();if("number"==typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");_&&(c=l(xn),h=t.instancing);var g=u+".type",v=s.elements&&ur(s.elements)&&!s.vaoActive;function m(){function t(){n(h,".drawElementsInstancedANGLE(",[f,d,g,p+"<<(("+g+"-5121)>>1)",c],");")}function e(){n(h,".drawArraysInstancedANGLE(",[f,p,d,c],");")}u&&"null"!==u?v?t():(n("if(",u,"){"),t(),n("}else{"),e(),n("}")):e()}function y(){function t(){n(o+".drawElements("+[f,d,g,p+"<<(("+g+"-5121)>>1)"]+");")}function e(){n(o+".drawArrays("+[f,p,d]+");")}u&&"null"!==u?v?t():(n("if(",u,"){"),t(),n("}else{"),e(),n("}")):e()}_&&("number"!=typeof c||c>=0)?"string"==typeof c?(n("if(",c,">0){"),m(),n("}else if(",c,"<0){"),y(),n("}")):m():y()}function X(t,e,n,r,i){var o=D(),a=o.proc("body",i);return S.optional((function(){o.commandStr=e.commandStr,o.command=o.link(e.commandStr)})),_&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),t(o,a,n,r),o.compile().body}function Y(t,e,n,r){U(t,e),n.useVAO?n.drawVAO?e(t.shared.vao,".setVAO(",n.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),V(t,e,n,r.attributes,(function(){return!0}))),W(t,e,n,r.uniforms,(function(){return!0}),!1),H(t,e,e,n)}function q(t,e,n,r){function i(){return!0}t.batchId="a1",U(t,e),V(t,e,n,r.attributes,i),W(t,e,n,r.uniforms,i,!1),H(t,e,e,n)}function K(t,e,n,r){U(t,e);var i=n.contextDep,o=e.def(),a=e.def();t.shared.props=a,t.batchId=o;var s=t.scope(),u=t.scope();function l(t){return t.contextDep&&i||t.propDep}function c(t){return!l(t)}if(e(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",u,"}",s.exit),n.needsContext&&z(t,u,n.context),n.needsFramebuffer&&F(t,u,n.framebuffer),j(t,u,n.state,l),n.profile&&l(n.profile)&&G(t,u,n,!1,!0),r)n.useVAO?n.drawVAO?l(n.drawVAO)?u(t.shared.vao,".setVAO(",n.drawVAO.append(t,u),");"):s(t.shared.vao,".setVAO(",n.drawVAO.append(t,s),");"):s(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(s(t.shared.vao,".setVAO(null);"),V(t,s,n,r.attributes,c),V(t,u,n,r.attributes,l)),W(t,s,n,r.uniforms,c,!1),W(t,u,n,r.uniforms,l,!0),H(t,s,u,n);else{var h=t.global.def("{}"),f=n.shader.progVar.append(t,u),p=u.def(f,".id"),d=u.def(h,"[",p,"]");u(t.shared.gl,".useProgram(",f,".program);","if(!",d,"){",d,"=",h,"[",p,"]=",t.link((function(e){return X(q,t,n,e,2)})),"(",f,");}",d,".call(this,a0[",o,"],",o,");")}}function J(t,e,n){var r=e.static[n];if(r&&function(t){if("object"==typeof t&&!gt(t)){for(var e=Object.keys(t),n=0;n<e.length;++n)if(P.isDynamic(t[e[n]]))return!0;return!1}}(r)){var i=t.global,o=Object.keys(r),a=!1,s=!1,u=!1,l=t.global.def("{}");o.forEach((function(e){var n=r[e];if(P.isDynamic(n)){"function"==typeof n&&(n=r[e]=P.unbox(n));var o=cr(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(l,".",e,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(t.link(n))}i(";")}})),e.dynamic[n]=new P.DynamicVariable(4,{thisDep:a,contextDep:s,propDep:u,ref:l,append:function(t,e){o.forEach((function(n){var i=r[n];if(P.isDynamic(i)){var o=t.invoke(e,i);e(l,".",n,"=",o,";")}}))}}),delete e.static[n]}}return{next:E,current:w,procs:function(){var t=D(),e=t.proc("poll"),n=t.proc("refresh"),r=t.block();e(r),n(r);var a,s=t.shared,u=s.gl,l=s.next,c=s.current;r(c,".dirty=false;"),F(t,e),F(t,n,null,!0),_&&(a=t.link(_)),i.oes_vertex_array_object&&n(t.link(i.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var h=0;h<o.maxAttributes;++h){var f=n.def(s.attributes,"[",h,"]"),p=t.cond(f,".buffer");p.then(u,".enableVertexAttribArray(",h,");",u,".bindBuffer(",Pn,",",f,".buffer.buffer);",u,".vertexAttribPointer(",h,",",f,".size,",f,".type,",f,".normalized,",f,".stride,",f,".offset);").else(u,".disableVertexAttribArray(",h,");",u,".vertexAttrib4f(",h,",",f,".x,",f,".y,",f,".z,",f,".w);",f,".buffer=null;"),n(p),_&&n(a,".vertexAttribDivisorANGLE(",h,",",f,".divisor);")}return n(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(A).forEach((function(i){var o=A[i],a=r.def(l,".",i),s=t.block();s("if(",a,"){",u,".enable(",o,")}else{",u,".disable(",o,")}",c,".",i,"=",a,";"),n(s),e("if(",a,"!==",c,".",i,"){",s,"}")})),Object.keys(T).forEach((function(i){var o,a,s=T[i],h=w[i],f=t.block();if(f(u,".",s,"("),gt(h)){var p=h.length;o=t.global.def(l,".",i),a=t.global.def(c,".",i),f(B(p,(function(t){return o+"["+t+"]"})),");",B(p,(function(t){return a+"["+t+"]="+o+"["+t+"];"})).join("")),e("if(",B(p,(function(t){return o+"["+t+"]!=="+a+"["+t+"]"})).join("||"),"){",f,"}")}else o=r.def(l,".",i),a=r.def(c,".",i),f(o,");",c,".",i,"=",o,";"),e("if(",o,"!==",a,"){",f,"}");n(f)})),t.compile()}(),compile:function(t,e,i,o,a){var s=D();s.stats=s.link(a),Object.keys(e.static).forEach((function(t){J(s,e,t)})),Mn.forEach((function(e){J(s,t,e)}));var u=N(t,e,i,o,s);return function(t,e){var n=t.proc("draw",1);U(t,n),z(t,n,e.context),F(t,n,e.framebuffer),Z(t,n,e),j(t,n,e.state),G(t,n,e,!1,!0);var r=e.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",r,".program);"),e.shader.program)Y(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var i=t.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(t.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",t.link((function(n){return X(Y,t,e,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}(s,u),function(t,e){var n=t.proc("scope",3);t.batchId="a2";var i=t.shared,o=i.current;function a(r){var o=e.shader[r];o&&n.set(i.shader,"."+r,o.append(t,n))}z(t,n,e.context),e.framebuffer&&e.framebuffer.append(t,n),ar(Object.keys(e.state)).forEach((function(r){var o=e.state[r].append(t,n);gt(o)?o.forEach((function(e,i){n.set(t.next[r],"["+i+"]",e)})):n.set(i.next,"."+r,o)})),G(t,n,e,!0,!0),[mn,bn,_n,xn,yn].forEach((function(r){var o=e.draw[r];o&&n.set(i.draw,"."+r,""+o.append(t,n))})),Object.keys(e.uniforms).forEach((function(o){var a=e.uniforms[o].append(t,n);Array.isArray(a)&&(a="["+a.join()+"]"),n.set(i.uniforms,"["+r.id(o)+"]",a)})),Object.keys(e.attributes).forEach((function(r){var i=e.attributes[r].append(t,n),o=t.scopeAttrib(r);Object.keys(new m).forEach((function(t){n.set(o,"."+t,i[t])}))})),e.scopeVAO&&n.set(i.vao,".targetVAO",e.scopeVAO.append(t,n)),a(gn),a(vn),Object.keys(e.state).length>0&&(n(o,".dirty=true;"),n.exit(o,".dirty=true;")),n("a1(",t.shared.context,",a0,",t.batchId,");")}(s,u),function(t,e){var n=t.proc("batch",2);t.batchId="0",U(t,n);var r=!1,i=!0;Object.keys(e.context).forEach((function(t){r=r||e.context[t].propDep})),r||(z(t,n,e.context),i=!1);var o=e.framebuffer,a=!1;function s(t){return t.contextDep&&r||t.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||F(t,n,o)):F(t,n,null),e.state.viewport&&e.state.viewport.propDep&&(r=!0),Z(t,n,e),j(t,n,e.state,(function(t){return!s(t)})),e.profile&&s(e.profile)||G(t,n,e,!1,"a1"),e.contextDep=r,e.needsContext=i,e.needsFramebuffer=a;var u=e.shader.progVar;if(u.contextDep&&r||u.propDep)K(t,n,e,null);else{var l=u.append(t,n);if(n(t.shared.gl,".useProgram(",l,".program);"),e.shader.program)K(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var c=t.global.def("{}"),h=n.def(l,".id"),f=n.def(c,"[",h,"]");n(t.cond(f).then(f,".call(this,a0,a1);").else(f,"=",c,"[",h,"]=",t.link((function(n){return X(K,t,e,n,2)})),"(",l,");",f,".call(this,a0,a1);"))}}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}(s,u),n(s.compile(),{destroy:function(){u.shader.program.destroy()}})}}}var pr=function(t,e){if(!e.ext_disjoint_timer_query)return null;var n=[];function r(t){n.push(t)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(t){a.push(t)}var u=[];function l(t,e,n){var r=a.pop()||new o;r.startQueryIndex=t,r.endQueryIndex=e,r.sum=0,r.stats=n,u.push(r)}var c=[],h=[];return{beginQuery:function(t){var r=n.pop()||e.ext_disjoint_timer_query.createQueryEXT();e.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),l(i.length-1,i.length,t)},endQuery:function(){e.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:l,update:function(){var t,n,o=i.length;if(0!==o){h.length=Math.max(h.length,o+1),c.length=Math.max(c.length,o+1),c[0]=0,h[0]=0;var a=0;for(t=0,n=0;n<i.length;++n){var l=i[n];e.ext_disjoint_timer_query.getQueryObjectEXT(l,34919)?(a+=e.ext_disjoint_timer_query.getQueryObjectEXT(l,34918),r(l)):i[t++]=l,c[n+1]=a,h[n+1]=t}for(i.length=t,t=0,n=0;n<u.length;++n){var f=u[n],p=f.startQueryIndex,d=f.endQueryIndex;f.sum+=c[d]-c[p];var g=h[p],v=h[d];v===g?(f.stats.gpuTime+=f.sum/1e6,s(f)):(f.startQueryIndex=g,f.endQueryIndex=v,u[t++]=f)}u.length=t}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var t=0;t<n.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(n[t]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},dr="webglcontextlost",gr="webglcontextrestored";function vr(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}return function(t){var r=D(t);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),a=i.isContextLost(),s=N(i,r);if(!s)return null;var u,l,c=(u={"":0},l=[""],{id:function(t){var e=u[t];return e||(e=u[t]=l.length,l.push(t),e)},str:function(t){return l[t]}}),h={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},f=s.extensions,p=pr(0,f),d=O(),g=i.drawingBufferWidth,v=i.drawingBufferHeight,m={tick:0,time:0,viewportWidth:g,viewportHeight:v,framebufferWidth:g,framebufferHeight:v,drawingBufferWidth:g,drawingBufferHeight:v,pixelRatio:r.pixelRatio},y={elements:null,primitive:4,count:-1,offset:0,instances:-1},_=function(t,e){var n=1;e.ext_texture_filter_anisotropic&&(n=t.getParameter(34047));var r=1,i=1;e.webgl_draw_buffers&&(r=t.getParameter(34852),i=t.getParameter(36063));var o=!!e.oes_texture_float;if(o){var a=t.createTexture();t.bindTexture(j,a),t.texImage2D(j,0,U,1,1,0,U,G,null);var s=t.createFramebuffer();if(t.bindFramebuffer(V,s),t.framebufferTexture2D(V,36064,j,a,0),t.bindTexture(j,null),36053!==t.checkFramebufferStatus(V))o=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(16384);var u=Z.allocType(G,4);t.readPixels(0,0,1,1,U,G,u),t.getError()?o=!1:(t.deleteFramebuffer(s),t.deleteTexture(a),o=1===u[0]),Z.freeType(u)}}var l=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=t.createTexture(),h=Z.allocType(5121,36);t.activeTexture(33984),t.bindTexture(34067,c),t.texImage2D(34069,0,U,3,3,0,U,5121,h),Z.freeType(h),t.bindTexture(34067,null),t.deleteTexture(c),l=!t.getError()}return{colorBits:[t.getParameter(3410),t.getParameter(3411),t.getParameter(3412),t.getParameter(3413)],depthBits:t.getParameter(3414),stencilBits:t.getParameter(3415),subpixelBits:t.getParameter(3408),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:t.getParameter(33901),lineWidthDims:t.getParameter(33902),maxViewportDims:t.getParameter(3386),maxCombinedTextureUnits:t.getParameter(35661),maxCubeMapSize:t.getParameter(34076),maxRenderbufferSize:t.getParameter(34024),maxTextureUnits:t.getParameter(34930),maxTextureSize:t.getParameter(3379),maxAttributes:t.getParameter(34921),maxVertexUniforms:t.getParameter(36347),maxVertexTextureUnits:t.getParameter(35660),maxVaryingVectors:t.getParameter(36348),maxFragmentUniforms:t.getParameter(36349),glsl:t.getParameter(35724),renderer:t.getParameter(7937),vendor:t.getParameter(7936),version:t.getParameter(7938),readFloat:o,npotTextureCube:l}}(i,f),b=function(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=et,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){h(this)};var u=[];function l(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function c(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||nt,n.length>0)if(Array.isArray(n[0])){s=tt(n);for(var c=1,h=1;h<s.length;++h)c*=s[h];t.dimension=c,l(t,u=$(n,s,t.dtype),r),a?t.persistentData=u:Z.freeType(u)}else if("number"==typeof n[0]){t.dimension=o;var f=Z.allocType(t.dtype,n.length);ot(f,n),l(t,f,r),a?t.persistentData=f:Z.freeType(f)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||it(n[0])||nt,l(t,u=$(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=u:Z.freeType(u)):S.raise("invalid buffer data")}else if(e(n))t.dtype=i||it(n),t.dimension=o,l(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(W(n)){s=n.shape;var p=n.stride,d=n.offset,g=0,v=0,m=0,y=0;1===s.length?(g=s[0],v=1,m=p[0],y=0):2===s.length?(g=s[0],v=s[1],m=p[0],y=p[1]):S.raise("invalid shape"),t.dtype=i||it(n.data)||nt,t.dimension=v;var _=Z.allocType(t.dtype,g*v);at(_,n.data,g,v,m,y,d),l(t,_,r),a?t.persistentData=_:Z.freeType(_)}else n instanceof ArrayBuffer?(t.dtype=et,t.dimension=o,l(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):S.raise("invalid buffer data")}function h(e){n.bufferCount--,i(e);var r=e.buffer;S(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}return r.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(a).forEach((function(e){t+=a[e].stats.size})),t}),{create:function(i,o,u,l){n.bufferCount++;var f=new s(o);function p(n){var i=35044,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||W(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(S.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(S(null===o||Array.isArray(o)||e(o)||W(o),"invalid data for buffer"),o=n.data),"usage"in n&&(S.parameter(n.usage,J,"invalid buffer usage"),i=J[n.usage]),"type"in n&&(S.parameter(n.type,Q,"invalid buffer type"),s=Q[n.type]),"dimension"in n&&(S.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(S.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),f.bind(),o?c(f,o,i,s,u,l):(a&&t.bufferData(f.type,a,i),f.dtype=s||et,f.usage=i,f.dimension=u,f.byteLength=a),r.profile&&(f.stats.size=f.byteLength*rt[f.dtype]),p}function d(e,n){S(n+e.byteLength<=f.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+f.byteLength),t.bufferSubData(f.type,n,e)}return a[f.id]=f,u||p(i),p._reglType="buffer",p._buffer=f,p.subdata=function(t,n){var r,i=0|(n||0);if(f.bind(),e(t)||t instanceof ArrayBuffer)d(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=Z.allocType(f.dtype,t.length);ot(o,t),d(o,i),Z.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=tt(t);var a=$(t,r,f.dtype);d(a,i),Z.freeType(a)}else S.raise("invalid buffer data")}else if(W(t)){r=t.shape;var s=t.stride,u=0,l=0,c=0,h=0;1===r.length?(u=r[0],l=1,c=s[0],h=0):2===r.length?(u=r[0],l=r[1],c=s[0],h=s[1]):S.raise("invalid shape");var g=Array.isArray(t.data)?f.dtype:it(t.data),v=Z.allocType(g,u*l);at(v,t.data,u,l,c,h,t.offset),d(v,i),Z.freeType(v)}else S.raise("invalid data for buffer subdata");return p},r.profile&&(p.stats=f.stats),p.destroy=function(){h(f)},p},createStream:function(t,e){var n=u.pop();return n||(n=new s(t)),n.bind(),c(n,e,35040,0,1,!1),n},destroyStream:function(t){u.push(t)},clear:function(){H(a).forEach(h),u.forEach(h)},getBuffer:function(t){return t&&t._buffer instanceof s?t._buffer:null},restore:function(){H(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))},_initBuffer:c}}(i,h,r,(function(t){return w.destroyBuffer(t)})),x=function(t,n,r,i){var o={},a=0,s={uint8:ut,uint16:lt};function u(t){this.id=a++,o[this.id]=this,this.buffer=t,this.primType=4,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=ct),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(i,o,a,s,u,l,c){var h;if(i.buffer.bind(),o){var f=c;c||e(o)&&(!W(o)||e(o.data))||(f=n.oes_element_index_uint?ct:lt),r._initBuffer(i.buffer,o,a,f,3)}else t.bufferData(ht,l,a),i.buffer.dtype=h||ut,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=l;if(h=c,!c){switch(i.buffer.dtype){case ut:case 5120:h=ut;break;case lt:case 5122:h=lt;break;case ct:case 5124:h=ct;break;default:S.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,S(h!==ct||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=u;p<0&&(p=i.buffer.byteLength,h===lt?p>>=1:h===ct&&(p>>=2)),i.vertCount=p;var d=s;if(s<0){d=4;var g=i.buffer.dimension;1===g&&(d=0),2===g&&(d=1),3===g&&(d=4)}i.primType=d}function h(t){i.elementsCount--,S(null!==t.buffer,"must not double destroy elements"),delete o[t.id],t.buffer.destroy(),t.buffer=null}return{create:function(t,n){var o=r.create(null,ht,!0),a=new u(o._buffer);function l(t){if(t)if("number"==typeof t)o(t),a.primType=4,a.vertCount=0|t,a.type=ut;else{var n=null,r=35044,i=-1,u=-1,h=0,f=0;Array.isArray(t)||e(t)||W(t)?n=t:(S.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,S(Array.isArray(n)||e(n)||W(n),"invalid data for element buffer")),"usage"in t&&(S.parameter(t.usage,J,"invalid element buffer usage"),r=J[t.usage]),"primitive"in t&&(S.parameter(t.primitive,st,"invalid element buffer primitive"),i=st[t.primitive]),"count"in t&&(S("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(S.parameter(t.type,s,"invalid buffer type"),f=s[t.type]),"length"in t?h=0|t.length:(h=u,f===lt||5122===f?h*=2:f!==ct&&5124!==f||(h*=4))),c(a,n,r,i,u,h,f)}else o(),a.primType=4,a.vertCount=0,a.type=ut;return l}return i.elementsCount++,l(t),l._reglType="elements",l._elements=a,l.subdata=function(t,e){return o.subdata(t,e),l},l.destroy=function(){h(a)},l},createStream:function(t){var e=l.pop();return e||(e=new u(r.create(null,ht,!0,!1)._buffer)),c(e,t,35040,-1,-1,0,0),e},destroyStream:function(t){l.push(t)},getElements:function(t){return"function"==typeof t&&t._elements instanceof u?t._elements:null},clear:function(){H(o).forEach(h)}}}(i,f,b,h),w=function(t,n,r,i,o,a,s){for(var u=r.maxAttributes,l=new Array(u),c=0;c<u;++c)l[c]=new Oe;var h=0,f={},p={Record:Oe,scope:{},state:l,currentVAO:null,targetVAO:null,restore:d()?function(){d()&&H(f).forEach((function(t){t.refresh()}))}:function(){},createVAO:function(t){var r=new v;function s(t){var i;if(Array.isArray(t))i=t,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(S("object"==typeof t,"invalid arguments for create vao"),S("attributes"in t,"must specify attributes for vao"),t.elements){var l=t.elements;r.ownsElements?"function"==typeof l&&"elements"===l._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(l),r.ownsElements=!1):a.getElements(t.elements)?(r.elements=t.elements,r.ownsElements=!1):(r.elements=a.create(t.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=t.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in t&&(r.offset=0|t.offset),"count"in t&&(r.count=0|t.count),"instances"in t&&(r.instances=0|t.instances),"primitive"in t&&(S(t.primitive in st,"bad primitive type: "+t.primitive),r.primitive=st[t.primitive]),S.optional((()=>{for(var e=Object.keys(t),n=0;n<e.length;++n)S(Ie.indexOf(e[n])>=0,'invalid option for vao: "'+e[n]+'" valid options are '+Ie)})),S(Array.isArray(i),"attributes must be an array")}S(i.length<u,"too many attributes"),S(i.length>0,"must specify at least one attribute");var c={},h=r.attributes;h.length=i.length;for(var f=0;f<i.length;++f){var p,d=i[f],g=h[f]=new Oe,v=d.data||d;Array.isArray(v)||e(v)||W(v)?(r.buffers[f]&&(p=r.buffers[f],e(v)&&p._buffer.byteLength>=v.byteLength?p.subdata(v):(p.destroy(),r.buffers[f]=null)),r.buffers[f]||(p=r.buffers[f]=o.create(d,34962,!1,!0)),g.buffer=o.getBuffer(p),g.size=0|g.buffer.dimension,g.normalized=!1,g.type=g.buffer.dtype,g.offset=0,g.stride=0,g.divisor=0,g.state=1,c[f]=1):o.getBuffer(d)?(g.buffer=o.getBuffer(d),g.size=0|g.buffer.dimension,g.normalized=!1,g.type=g.buffer.dtype,g.offset=0,g.stride=0,g.divisor=0,g.state=1):o.getBuffer(d.buffer)?(g.buffer=o.getBuffer(d.buffer),g.size=0|(+d.size||g.buffer.dimension),g.normalized=!!d.normalized||!1,"type"in d?(S.parameter(d.type,Q,"invalid buffer type"),g.type=Q[d.type]):g.type=g.buffer.dtype,g.offset=0|(d.offset||0),g.stride=0|(d.stride||0),g.divisor=0|(d.divisor||0),g.state=1,S(g.size>=1&&g.size<=4,"size must be between 1 and 4"),S(g.offset>=0,"invalid offset"),S(g.stride>=0&&g.stride<=255,"stride must be between 0 and 255"),S(g.divisor>=0,"divisor must be positive"),S(!g.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in d?(S(f>0,"first attribute must not be a constant"),g.x=+d.x||0,g.y=+d.y||0,g.z=+d.z||0,g.w=+d.w||0,g.state=2):S(!1,"invalid attribute spec for location "+f)}for(var m=0;m<r.buffers.length;++m)!c[m]&&r.buffers[m]&&(r.buffers[m].destroy(),r.buffers[m]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var t=0;t<r.buffers.length;++t)r.buffers[t]&&r.buffers[t].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},s._vao=r,s._reglType="vao",s(t)},getVAO:function(t){return"function"==typeof t&&t._vao?t._vao:null},destroyBuffer:function(e){for(var n=0;n<l.length;++n){var r=l[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}},setVAO:d()?function(t){if(t!==p.currentVAO){var e=d();t?e.bindVertexArrayOES(t.vao):e.bindVertexArrayOES(null),p.currentVAO=t}}:function(e){if(e!==p.currentVAO){if(e)e.bindAttrs();else{for(var n=g(),r=0;r<l.length;++r){var i=l[r];i.buffer?(t.enableVertexAttribArray(r),i.buffer.bind(),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}s.elements?t.bindBuffer(Pe,s.elements.buffer.buffer):t.bindBuffer(Pe,null)}p.currentVAO=e}},clear:d()?function(){H(f).forEach((function(t){t.destroy()}))}:function(){}};function d(){return n.oes_vertex_array_object}function g(){return n.angle_instanced_arrays}function v(){this.id=++h,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var t=d();this.vao=t?t.createVertexArrayOES():null,f[this.id]=this,this.buffers=[]}return v.prototype.bindAttrs=function(){for(var e=g(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(34962,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&i.divisor&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<u;++o)t.disableVertexAttribArray(o);var s=a.getElements(this.elements);s?t.bindBuffer(Pe,s.buffer.buffer):t.bindBuffer(Pe,null)},v.prototype.refresh=function(){var t=d();t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),p.currentVAO=null,t.bindVertexArrayOES(null))},v.prototype.destroy=function(){if(this.vao){var t=d();this===p.currentVAO&&(p.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),f[this.id]&&(delete f[this.id],i.vaoCount-=1)},p}(i,f,_,h,b,x,y),E=function(t,e,r,i){var o={},a={};function s(t,e,n,r){this.name=t,this.id=e,this.location=n,this.info=r}function u(t,e){for(var n=0;n<t.length;++n)if(t[n].id===e.id)return void(t[n].location=e.location);t.push(e)}function l(n,r,i){var s=35632===n?o:a,u=s[r];if(!u){var l=e.str(r);u=t.createShader(n),t.shaderSource(u,l),t.compileShader(u),S.shaderError(t,u,l,n,i),s[r]=u}return u}var c={},h=[],f=0;function p(t,e){this.id=f++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(n,r,o){var a,c,h=l(35632,n.fragId),f=l(35633,n.vertId),p=n.program=t.createProgram();if(t.attachShader(p,h),t.attachShader(p,f),o)for(a=0;a<o.length;++a){var d=o[a];t.bindAttribLocation(p,d[0],d[1])}t.linkProgram(p),S.linkError(t,p,e.str(n.fragId),e.str(n.vertId),r);var g=t.getProgramParameter(p,35718);i.profile&&(n.stats.uniformsCount=g);var v=n.uniforms;for(a=0;a<g;++a)if(c=t.getActiveUniform(p,a))if(c.size>1)for(var m=0;m<c.size;++m){var y=c.name.replace("[0]","["+m+"]");u(v,new s(y,e.id(y),t.getUniformLocation(p,y),c))}else u(v,new s(c.name,e.id(c.name),t.getUniformLocation(p,c.name),c));var _=t.getProgramParameter(p,35721);i.profile&&(n.stats.attributesCount=_);var b=n.attributes;for(a=0;a<_;++a)(c=t.getActiveAttrib(p,a))&&u(b,new s(c.name,e.id(c.name),t.getAttribLocation(p,c.name),c))}return i.profile&&(r.getMaxUniformsCount=function(){var t=0;return h.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},r.getMaxAttributesCount=function(){var t=0;return h.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);H(o).forEach(e),o={},H(a).forEach(e),a={},h.forEach((function(e){t.deleteProgram(e.program)})),h.length=0,c={},r.shaderCount=0},program:function(e,i,s,u){S.command(e>=0,"missing vertex shader",s),S.command(i>=0,"missing fragment shader",s);var l=c[i];l||(l=c[i]={});var f=l[e];if(f&&(f.refCount++,!u))return f;var g=new p(i,e);return r.shaderCount++,d(g,s,u),f||(l[e]=g),h.push(g),n(g,{destroy:function(){if(g.refCount--,g.refCount<=0){t.deleteProgram(g.program);var e=h.indexOf(g);h.splice(e,1),r.shaderCount--}l[g.vertId].refCount<=0&&(t.deleteShader(a[g.vertId]),delete a[g.vertId],delete c[g.fragId][g.vertId]),Object.keys(c[g.fragId]).length||(t.deleteShader(o[g.fragId]),delete o[g.fragId],delete c[g.fragId])}})},restore:function(){o={},a={};for(var t=0;t<h.length;++t)d(h[t],null,h[t].attributes.map((function(t){return[t.location,t.name]})))},shader:l,frag:-1,vert:-1}}(i,c,h,r),C=ve(i,f,_,(function(){k.procs.poll()}),m,h,r),A=function(t,e,n,r,i){var o={rgba4:ye,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};e.ext_srgb&&(o.srgba=35907),e.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),e.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach((function(t){var e=o[t];a[e]=t}));var s=0,u={};function l(t){this.id=s++,this.refCount=1,this.renderbuffer=t,this.format=ye,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function c(e){var n=e.renderbuffer;S(n,"must not double destroy renderbuffer"),t.bindRenderbuffer(me,null),t.deleteRenderbuffer(n),e.renderbuffer=null,e.refCount=0,delete u[e.id],r.renderbufferCount--}return l.prototype.decRef=function(){--this.refCount<=0&&c(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(u).forEach((function(e){t+=u[e].stats.size})),t}),{create:function(e,s){var c=new l(t.createRenderbuffer());function h(e,r){var s=0,u=0,l=ye;if("object"==typeof e&&e){var f=e;if("shape"in f){var p=f.shape;S(Array.isArray(p)&&p.length>=2,"invalid renderbuffer shape"),s=0|p[0],u=0|p[1]}else"radius"in f&&(s=u=0|f.radius),"width"in f&&(s=0|f.width),"height"in f&&(u=0|f.height);"format"in f&&(S.parameter(f.format,o,"invalid renderbuffer format"),l=o[f.format])}else"number"==typeof e?(s=0|e,u="number"==typeof r?0|r:s):e?S.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(S(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||u!==c.height||l!==c.format)return h.width=c.width=s,h.height=c.height=u,c.format=l,t.bindRenderbuffer(me,c.renderbuffer),t.renderbufferStorage(me,l,s,u),S(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=be(c.format,c.width,c.height)),h.format=a[c.format],h}return u[c.id]=c,r.renderbufferCount++,h(e,s),h.resize=function(e,r){var o=0|e,a=0|r||o;return o===c.width&&a===c.height||(S(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),h.width=c.width=o,h.height=c.height=a,t.bindRenderbuffer(me,c.renderbuffer),t.renderbufferStorage(me,c.format,o,a),S(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=be(c.format,c.width,c.height))),h},h._reglType="renderbuffer",h._renderbuffer=c,i.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h},clear:function(){H(u).forEach(c)},restore:function(){H(u).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(me,e.renderbuffer),t.renderbufferStorage(me,e.format,e.width,e.height)})),t.bindRenderbuffer(me,null)}}}(i,f,_,h,r),T=function(t,e,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],l=["rgba4","rgb565","rgb5 a1"];e.ext_srgb&&l.push("srgba"),e.ext_color_buffer_half_float&&l.push("rgba16f","rgb16f"),e.webgl_color_buffer_float&&l.push("rgba32f");var c=["uint8"];function h(t,e,n){this.target=t,this.texture=e,this.renderbuffer=n;var r=0,i=0;e?(r=e.width,i=e.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function f(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function p(t,e,n){if(t)if(t.texture){var r=t.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);S(i===e&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=t.renderbuffer._renderbuffer;S(a.width===e&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function d(e,n){n&&(n.texture?t.framebufferTexture2D(xe,e,n.target,n.texture._texture.texture,0):t.framebufferRenderbuffer(xe,e,we,n.renderbuffer._renderbuffer.renderbuffer))}function g(t){var e=Ee,n=null,r=null,i=t;"object"==typeof t&&(i=t.data,"target"in t&&(e=0|t.target)),S.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,S(e===Ee)):"textureCube"===o?(n=i,S(e>=Se&&e<34075,"invalid cube map target")):"renderbuffer"===o?(r=i,e=we):S.raise("invalid regl object for attachment"),new h(e,n,r)}function v(t,e,n,r,a){if(n){var s=i.create2D({width:t,height:e,format:r,type:a});return s._texture.refCount=0,new h(Ee,s,null)}var u=o.create({width:t,height:e,format:r});return u._renderbuffer.refCount=0,new h(we,null,u)}function m(t){return t&&(t.texture||t.renderbuffer)}function y(t,e,n){t&&(t.texture?t.texture.resize(e,n):t.renderbuffer&&t.renderbuffer.resize(e,n),t.width=e,t.height=n)}e.oes_texture_half_float&&c.push("half float","float16"),e.oes_texture_float&&c.push("float","float32");var _=0,b={};function x(){this.id=_++,b[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function w(t){t.colorAttachments.forEach(f),f(t.depthAttachment),f(t.stencilAttachment),f(t.depthStencilAttachment)}function E(e){var n=e.framebuffer;S(n,"must not double destroy framebuffer"),t.deleteFramebuffer(n),e.framebuffer=null,a.framebufferCount--,delete b[e.id]}function C(e){var n;t.bindFramebuffer(xe,e.framebuffer);var i=e.colorAttachments;for(n=0;n<i.length;++n)d(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)t.framebufferTexture2D(xe,36064+n,Ee,null,0);t.framebufferTexture2D(xe,33306,Ee,null,0),t.framebufferTexture2D(xe,36096,Ee,null,0),t.framebufferTexture2D(xe,36128,Ee,null,0),d(36096,e.depthAttachment),d(36128,e.stencilAttachment),d(33306,e.depthStencilAttachment);var o=t.checkFramebufferStatus(xe);t.isContextLost()||36053===o||S.raise("framebuffer configuration not supported, status = "+Me[o]),t.bindFramebuffer(xe,s.next?s.next.framebuffer:null),s.cur=s.next,t.getError()}function A(t,i){var o=new x;function h(t,n){var i;S(s.next!==o,"can not update framebuffer which is currently in use");var a=0,f=0,d=!0,y=!0,_=null,b=!0,x="rgba",E="uint8",A=1,T=null,k=null,M=null,P=!1;if("number"==typeof t)a=0|t,f=0|n||a;else if(t){S.type(t,"object","invalid arguments for framebuffer");var I=t;if("shape"in I){var O=I.shape;S(Array.isArray(O)&&O.length>=2,"invalid shape for framebuffer"),a=O[0],f=O[1]}else"radius"in I&&(a=f=I.radius),"width"in I&&(a=I.width),"height"in I&&(f=I.height);("color"in I||"colors"in I)&&(_=I.color||I.colors,Array.isArray(_)&&S(1===_.length||e.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in I&&(A=0|I.colorCount,S(A>0,"invalid color buffer count")),"colorTexture"in I&&(b=!!I.colorTexture,x="rgba4"),"colorType"in I&&(E=I.colorType,b?(S(e.oes_texture_float||!("float"===E||"float32"===E),"you must enable OES_texture_float in order to use floating point framebuffer objects"),S(e.oes_texture_half_float||!("half float"===E||"float16"===E),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===E||"float16"===E?(S(e.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f"):"float"!==E&&"float32"!==E||(S(e.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f"),S.oneOf(E,c,"invalid color type")),"colorFormat"in I&&(x=I.colorFormat,u.indexOf(x)>=0?b=!0:l.indexOf(x)>=0?b=!1:S.optional((function(){b?S.oneOf(I.colorFormat,u,"invalid color format for texture"):S.oneOf(I.colorFormat,l,"invalid color format for renderbuffer")})))),("depthTexture"in I||"depthStencilTexture"in I)&&(P=!(!I.depthTexture&&!I.depthStencilTexture),S(!P||e.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in I&&("boolean"==typeof I.depth?d=I.depth:(T=I.depth,y=!1)),"stencil"in I&&("boolean"==typeof I.stencil?y=I.stencil:(k=I.stencil,d=!1)),"depthStencil"in I&&("boolean"==typeof I.depthStencil?d=y=I.depthStencil:(M=I.depthStencil,d=!1,y=!1))}else a=f=1;var R=null,L=null,D=null,N=null;if(Array.isArray(_))R=_.map(g);else if(_)R=[g(_)];else for(R=new Array(A),i=0;i<A;++i)R[i]=v(a,f,b,x,E);S(e.webgl_draw_buffers||R.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),S(R.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||R[0].width,f=f||R[0].height,T?L=g(T):d&&!y&&(L=v(a,f,P,"depth","uint32")),k?D=g(k):y&&!d&&(D=v(a,f,!1,"stencil","uint8")),M?N=g(M):!T&&!k&&y&&d&&(N=v(a,f,P,"depth stencil","depth stencil")),S(!!T+!!k+!!M<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var B=null;for(i=0;i<R.length;++i)if(p(R[i],a,f),S(!R[i]||R[i].texture&&Ce.indexOf(R[i].texture._texture.format)>=0||R[i].renderbuffer&&ke.indexOf(R[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),R[i]&&R[i].texture){var z=Ae[R[i].texture._texture.format]*Te[R[i].texture._texture.type];null===B?B=z:S(B===z,"all color attachments much have the same number of bits per pixel.")}return p(L,a,f),S(!L||L.texture&&6402===L.texture._texture.format||L.renderbuffer&&33189===L.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),p(D,a,f),S(!D||D.renderbuffer&&36168===D.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),p(N,a,f),S(!N||N.texture&&34041===N.texture._texture.format||N.renderbuffer&&34041===N.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),w(o),o.width=a,o.height=f,o.colorAttachments=R,o.depthAttachment=L,o.stencilAttachment=D,o.depthStencilAttachment=N,h.color=R.map(m),h.depth=m(L),h.stencil=m(D),h.depthStencil=m(N),h.width=o.width,h.height=o.height,C(o),h}return a.framebufferCount++,h(t,i),n(h,{resize:function(t,e){S(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|t,1),r=Math.max(0|e||n,1);if(n===o.width&&r===o.height)return h;for(var i=o.colorAttachments,a=0;a<i.length;++a)y(i[a],n,r);return y(o.depthAttachment,n,r),y(o.stencilAttachment,n,r),y(o.depthStencilAttachment,n,r),o.width=h.width=n,o.height=h.height=r,C(o),h},_reglType:"framebuffer",_framebuffer:o,destroy:function(){E(o),w(o)},use:function(t){s.setFBO({framebuffer:h},t)}})}return n(s,{getFramebuffer:function(t){if("function"==typeof t&&"framebuffer"===t._reglType){var e=t._framebuffer;if(e instanceof x)return e}return null},create:A,createCube:function(t){var o=Array(6);function a(t){var r;S(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var l,h={color:null},f=0,p=null,d="rgba",g="uint8",v=1;if("number"==typeof t)f=0|t;else if(t){S.type(t,"object","invalid arguments for framebuffer");var m=t;if("shape"in m){var y=m.shape;S(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),S(y[0]===y[1],"cube framebuffer must be square"),f=y[0]}else"radius"in m&&(f=0|m.radius),"width"in m?(f=0|m.width,"height"in m&&S(m.height===f,"must be square")):"height"in m&&(f=0|m.height);("color"in m||"colors"in m)&&(p=m.color||m.colors,Array.isArray(p)&&S(1===p.length||e.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in m&&(v=0|m.colorCount,S(v>0,"invalid color buffer count")),"colorType"in m&&(S.oneOf(m.colorType,c,"invalid color type"),g=m.colorType),"colorFormat"in m&&(d=m.colorFormat,S.oneOf(m.colorFormat,u,"invalid color format for texture"))),"depth"in m&&(h.depth=m.depth),"stencil"in m&&(h.stencil=m.stencil),"depthStencil"in m&&(h.depthStencil=m.depthStencil)}else f=1;if(p)if(Array.isArray(p))for(l=[],r=0;r<p.length;++r)l[r]=p[r];else l=[p];else{l=Array(v);var _={radius:f,format:d,type:g};for(r=0;r<v;++r)l[r]=i.createCube(_)}for(h.color=Array(l.length),r=0;r<l.length;++r){var b=l[r];S("function"==typeof b&&"textureCube"===b._reglType,"invalid cube map"),f=f||b.width,S(b.width===f&&b.height===f,"invalid cube map shape"),h.color[r]={target:Se,data:l[r]}}for(r=0;r<6;++r){for(var x=0;x<l.length;++x)h.color[x].target=Se+r;r>0&&(h.depth=o[0].depth,h.stencil=o[0].stencil,h.depthStencil=o[0].depthStencil),o[r]?o[r](h):o[r]=A(h)}return n(a,{width:f,height:f,color:l})}return a(t),n(a,{faces:o,resize:function(t){var e,n=0|t;if(S(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(e=0;e<i.length;++e)i[e].resize(n);for(e=0;e<6;++e)o[e].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(t){t.destroy()}))}})},clear:function(){H(b).forEach(E)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,H(b).forEach((function(e){e.framebuffer=t.createFramebuffer(),C(e)}))}})}(i,f,_,C,A,h),k=fr(i,c,f,_,b,x,0,T,{},w,E,y,m,p,r),M=De(i,T,k.procs.poll,m,o,f,_),R=k.next,L=i.canvas,B=[],z=[],F=[],X=[r.onDestroy],Y=null;function q(){if(0===B.length)return p&&p.update(),void(Y=null);Y=I.next(q),xt();for(var t=B.length-1;t>=0;--t){var e=B[t];e&&e(m,null,0)}i.flush(),p&&p.update()}function K(){!Y&&B.length>0&&(Y=I.next(q))}function ft(){Y&&(I.cancel(q),Y=null)}function pt(t){t.preventDefault(),a=!0,ft(),z.forEach((function(t){t()}))}function dt(t){i.getError(),a=!1,s.restore(),E.restore(),b.restore(),C.restore(),A.restore(),T.restore(),w.restore(),p&&p.restore(),k.procs.refresh(),K(),F.forEach((function(t){t()}))}var gt="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast;function vt(t){function e(t,e){var n={},r={};return Object.keys(t).forEach((function(i){var o=t[i];if(P.isDynamic(o))r[i]=P.unbox(o,i);else{if(e&&Array.isArray(o))for(var a=0;a<o.length;++a)if(P.isDynamic(o[a]))return void(r[i]=P.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}S(!!t,"invalid args to regl({...})"),S.type(t,"object","invalid args to regl({...})");var r=e(t.context||{},!0),i=e(t.uniforms||{},!0),o=e(t.attributes||{},!1),s=e(function(t){var e=n({},t);function r(t){if(t in e){var n=e[t];delete e[t],Object.keys(n).forEach((function(r){e[t+"."+r]=n[r]}))}}return delete e.uniforms,delete e.attributes,delete e.context,delete e.vao,"stencil"in e&&e.stencil.op&&(e.stencil.opBack=e.stencil.opFront=e.stencil.op,delete e.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in t&&(e.vao=t.vao),e}(t),!1),u={gpuTime:0,cpuTime:0,count:0},l=k.compile(s,o,i,r,u),c=l.draw,h=l.batch,f=l.scope,p=[];return n((function(t,e){var n;if(a&&S.raise("context lost"),"function"==typeof t)return f.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(n=0;n<t;++n)f.call(this,null,e,n);else{if(!Array.isArray(t))return f.call(this,t,e,0);for(n=0;n<t.length;++n)f.call(this,t[n],e,n)}else if("number"==typeof t){if(t>0)return h.call(this,function(t){for(;p.length<t;)p.push(null);return p}(0|t),0|t)}else{if(!Array.isArray(t))return c.call(this,t);if(t.length)return h.call(this,t,t.length)}}),{stats:u,destroy:function(){l.destroy()}})}!gt&&L&&(L.addEventListener(dr,pt,!1),L.addEventListener(gr,dt,!1));var mt=T.setFBO=vt({framebuffer:P.define.call(null,1,"framebuffer")});function yt(t,e){var n=0;k.procs.poll();var r=e.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in e&&(i.clearDepth(+e.depth),n|=256),"stencil"in e&&(i.clearStencil(0|e.stencil),n|=1024),S(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function _t(t){return S.type(t,"function","regl.frame() callback must be a function"),B.push(t),K(),{cancel:function(){var e=vr(B,t);S(e>=0,"cannot cancel a frame twice"),B[e]=function t(){var e=vr(B,t);B[e]=B[B.length-1],B.length-=1,B.length<=0&&ft()}}}}function bt(){var t=R.viewport,e=R.scissor_box;t[0]=t[1]=e[0]=e[1]=0,m.viewportWidth=m.framebufferWidth=m.drawingBufferWidth=t[2]=e[2]=i.drawingBufferWidth,m.viewportHeight=m.framebufferHeight=m.drawingBufferHeight=t[3]=e[3]=i.drawingBufferHeight}function xt(){m.tick+=1,m.time=Et(),bt(),k.procs.poll()}function wt(){C.refresh(),bt(),k.procs.refresh(),p&&p.update()}function Et(){return(O()-d)/1e3}wt();var St=n(vt,{clear:function(t){if(S("object"==typeof t&&t,"regl.clear() takes an object as input"),"framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var e=0;e<6;++e)mt(n({framebuffer:t.framebuffer.faces[e]},t),yt);else mt(t,yt);else yt(0,t)},prop:P.define.bind(null,1),context:P.define.bind(null,2),this:P.define.bind(null,3),draw:vt({}),buffer:function(t){return b.create(t,34962,!1,!1)},elements:function(t){return x.create(t,!1)},texture:C.create2D,cube:C.createCube,renderbuffer:A.create,framebuffer:T.create,framebufferCube:T.createCube,vao:w.createVAO,attributes:o,frame:_t,on:function(t,e){var n;switch(S.type(e,"function","listener callback must be a function"),t){case"frame":return _t(e);case"lost":n=z;break;case"restore":n=F;break;case"destroy":n=X;break;default:S.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(e),{cancel:function(){for(var t=0;t<n.length;++t)if(n[t]===e)return n[t]=n[n.length-1],void n.pop()}}},limits:_,hasExtension:function(t){return _.extensions.indexOf(t.toLowerCase())>=0},read:M,destroy:function(){B.length=0,ft(),!gt&&L&&(L.removeEventListener(dr,pt),L.removeEventListener(gr,dt)),E.clear(),T.clear(),A.clear(),w.clear(),C.clear(),x.clear(),b.clear(),p&&p.clear(),X.forEach((function(t){t()}))},_gl:i,_refresh:wt,poll:function(){xt(),p&&p.update()},now:Et,stats:h});return r.onDone(null,St),St}}(n(7736))},8552:(t,e,n)=>{var r=n(852)(n(5639),"DataView");t.exports=r},1989:(t,e,n)=>{var r=n(1789),i=n(401),o=n(7667),a=n(1327),s=n(1866);function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,t.exports=u},8407:(t,e,n)=>{var r=n(7040),i=n(4125),o=n(2117),a=n(7518),s=n(4705);function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,t.exports=u},7071:(t,e,n)=>{var r=n(852)(n(5639),"Map");t.exports=r},3369:(t,e,n)=>{var r=n(4785),i=n(1285),o=n(6e3),a=n(9916),s=n(5265);function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,t.exports=u},3818:(t,e,n)=>{var r=n(852)(n(5639),"Promise");t.exports=r},8525:(t,e,n)=>{var r=n(852)(n(5639),"Set");t.exports=r},8668:(t,e,n)=>{var r=n(3369),i=n(619),o=n(2385);function a(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new r;++e<n;)this.add(t[e])}a.prototype.add=a.prototype.push=i,a.prototype.has=o,t.exports=a},6384:(t,e,n)=>{var r=n(8407),i=n(7465),o=n(3779),a=n(7599),s=n(4758),u=n(4309);function l(t){var e=this.__data__=new r(t);this.size=e.size}l.prototype.clear=i,l.prototype.delete=o,l.prototype.get=a,l.prototype.has=s,l.prototype.set=u,t.exports=l},2705:(t,e,n)=>{var r=n(5639).Symbol;t.exports=r},1149:(t,e,n)=>{var r=n(5639).Uint8Array;t.exports=r},577:(t,e,n)=>{var r=n(852)(n(5639),"WeakMap");t.exports=r},6874:t=>{t.exports=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}},7412:t=>{t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}},4963:t=>{t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}},7443:(t,e,n)=>{var r=n(2118);t.exports=function(t,e){return!(null==t||!t.length)&&r(t,e,0)>-1}},1196:t=>{t.exports=function(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}},4636:(t,e,n)=>{var r=n(2545),i=n(5694),o=n(1469),a=n(4144),s=n(5776),u=n(6719),l=Object.prototype.hasOwnProperty;t.exports=function(t,e){var n=o(t),c=!n&&i(t),h=!n&&!c&&a(t),f=!n&&!c&&!h&&u(t),p=n||c||h||f,d=p?r(t.length,String):[],g=d.length;for(var v in t)!e&&!l.call(t,v)||p&&("length"==v||h&&("offset"==v||"parent"==v)||f&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||s(v,g))||d.push(v);return d}},9932:t=>{t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}},2488:t=>{t.exports=function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}},2663:t=>{t.exports=function(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}},2908:t=>{t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}},4286:t=>{t.exports=function(t){return t.split("")}},9029:t=>{var e=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;t.exports=function(t){return t.match(e)||[]}},6556:(t,e,n)=>{var r=n(9465),i=n(7813);t.exports=function(t,e,n){(void 0!==n&&!i(t[e],n)||void 0===n&&!(e in t))&&r(t,e,n)}},4865:(t,e,n)=>{var r=n(9465),i=n(7813),o=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var a=t[e];o.call(t,e)&&i(a,n)&&(void 0!==n||e in t)||r(t,e,n)}},8470:(t,e,n)=>{var r=n(7813);t.exports=function(t,e){for(var n=t.length;n--;)if(r(t[n][0],e))return n;return-1}},4037:(t,e,n)=>{var r=n(8363),i=n(3674);t.exports=function(t,e){return t&&r(e,i(e),t)}},3886:(t,e,n)=>{var r=n(8363),i=n(1704);t.exports=function(t,e){return t&&r(e,i(e),t)}},9465:(t,e,n)=>{var r=n(8777);t.exports=function(t,e,n){"__proto__"==e&&r?r(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},9750:t=>{t.exports=function(t,e,n){return t==t&&(void 0!==n&&(t=t<=n?t:n),void 0!==e&&(t=t>=e?t:e)),t}},5990:(t,e,n)=>{var r=n(6384),i=n(7412),o=n(4865),a=n(4037),s=n(3886),u=n(4626),l=n(278),c=n(8805),h=n(1911),f=n(8234),p=n(6904),d=n(4160),g=n(3824),v=n(9148),m=n(8517),y=n(1469),_=n(4144),b=n(6688),x=n(3218),w=n(2928),E=n(3674),S=n(1704),C="[object Arguments]",A="[object Function]",T="[object Object]",k={};k[C]=k["[object Array]"]=k["[object ArrayBuffer]"]=k["[object DataView]"]=k["[object Boolean]"]=k["[object Date]"]=k["[object Float32Array]"]=k["[object Float64Array]"]=k["[object Int8Array]"]=k["[object Int16Array]"]=k["[object Int32Array]"]=k["[object Map]"]=k["[object Number]"]=k[T]=k["[object RegExp]"]=k["[object Set]"]=k["[object String]"]=k["[object Symbol]"]=k["[object Uint8Array]"]=k["[object Uint8ClampedArray]"]=k["[object Uint16Array]"]=k["[object Uint32Array]"]=!0,k["[object Error]"]=k[A]=k["[object WeakMap]"]=!1,t.exports=function t(e,n,M,P,I,O){var R,L=1&n,D=2&n,N=4&n;if(M&&(R=I?M(e,P,I,O):M(e)),void 0!==R)return R;if(!x(e))return e;var B=y(e);if(B){if(R=g(e),!L)return l(e,R)}else{var z=d(e),F=z==A||"[object GeneratorFunction]"==z;if(_(e))return u(e,L);if(z==T||z==C||F&&!I){if(R=D||F?{}:m(e),!L)return D?h(e,s(R,e)):c(e,a(R,e))}else{if(!k[z])return I?e:{};R=v(e,z,L)}}O||(O=new r);var Z=O.get(e);if(Z)return Z;O.set(e,R),w(e)?e.forEach((function(r){R.add(t(r,n,M,r,e,O))})):b(e)&&e.forEach((function(r,i){R.set(i,t(r,n,M,i,e,O))}));var j=B?void 0:(N?D?p:f:D?S:E)(e);return i(j||e,(function(r,i){j&&(r=e[i=r]),o(R,i,t(r,n,M,i,e,O))})),R}},3118:(t,e,n)=>{var r=n(3218),i=Object.create,o=function(){function t(){}return function(e){if(!r(e))return{};if(i)return i(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();t.exports=o},1848:t=>{t.exports=function(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}},8483:(t,e,n)=>{var r=n(5063)();t.exports=r},8866:(t,e,n)=>{var r=n(2488),i=n(1469);t.exports=function(t,e,n){var o=e(t);return i(t)?o:r(o,n(t))}},4239:(t,e,n)=>{var r=n(2705),i=n(9607),o=n(2333),a=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":a&&a in Object(t)?i(t):o(t)}},2118:(t,e,n)=>{var r=n(1848),i=n(2722),o=n(2351);t.exports=function(t,e,n){return e==e?o(t,e,n):r(t,i,n)}},9454:(t,e,n)=>{var r=n(4239),i=n(7005);t.exports=function(t){return i(t)&&"[object Arguments]"==r(t)}},939:(t,e,n)=>{var r=n(1299),i=n(7005);t.exports=function t(e,n,o,a,s){return e===n||(null==e||null==n||!i(e)&&!i(n)?e!=e&&n!=n:r(e,n,o,a,t,s))}},1299:(t,e,n)=>{var r=n(6384),i=n(7114),o=n(8351),a=n(6096),s=n(4160),u=n(1469),l=n(4144),c=n(6719),h="[object Arguments]",f="[object Array]",p="[object Object]",d=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,g,v,m){var y=u(t),_=u(e),b=y?f:s(t),x=_?f:s(e),w=(b=b==h?p:b)==p,E=(x=x==h?p:x)==p,S=b==x;if(S&&l(t)){if(!l(e))return!1;y=!0,w=!1}if(S&&!w)return m||(m=new r),y||c(t)?i(t,e,n,g,v,m):o(t,e,b,n,g,v,m);if(!(1&n)){var C=w&&d.call(t,"__wrapped__"),A=E&&d.call(e,"__wrapped__");if(C||A){var T=C?t.value():t,k=A?e.value():e;return m||(m=new r),v(T,k,n,g,m)}}return!!S&&(m||(m=new r),a(t,e,n,g,v,m))}},5588:(t,e,n)=>{var r=n(4160),i=n(7005);t.exports=function(t){return i(t)&&"[object Map]"==r(t)}},2722:t=>{t.exports=function(t){return t!=t}},8458:(t,e,n)=>{var r=n(3560),i=n(5346),o=n(3218),a=n(346),s=/^\[object .+?Constructor\]$/,u=Function.prototype,l=Object.prototype,c=u.toString,h=l.hasOwnProperty,f=RegExp("^"+c.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!o(t)||i(t))&&(r(t)?f:s).test(a(t))}},9221:(t,e,n)=>{var r=n(4160),i=n(7005);t.exports=function(t){return i(t)&&"[object Set]"==r(t)}},8749:(t,e,n)=>{var r=n(4239),i=n(1780),o=n(7005),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,t.exports=function(t){return o(t)&&i(t.length)&&!!a[r(t)]}},280:(t,e,n)=>{var r=n(5726),i=n(6916),o=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return i(t);var e=[];for(var n in Object(t))o.call(t,n)&&"constructor"!=n&&e.push(n);return e}},313:(t,e,n)=>{var r=n(3218),i=n(5726),o=n(3498),a=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return o(t);var e=i(t),n=[];for(var s in t)("constructor"!=s||!e&&a.call(t,s))&&n.push(s);return n}},2980:(t,e,n)=>{var r=n(6384),i=n(6556),o=n(8483),a=n(9783),s=n(3218),u=n(1704),l=n(6390);t.exports=function t(e,n,c,h,f){e!==n&&o(n,(function(o,u){if(f||(f=new r),s(o))a(e,n,u,c,t,h,f);else{var p=h?h(l(e,u),o,u+"",e,n,f):void 0;void 0===p&&(p=o),i(e,u,p)}}),u)}},9783:(t,e,n)=>{var r=n(6556),i=n(4626),o=n(7133),a=n(278),s=n(8517),u=n(5694),l=n(1469),c=n(9246),h=n(4144),f=n(3560),p=n(3218),d=n(8630),g=n(6719),v=n(6390),m=n(9881);t.exports=function(t,e,n,y,_,b,x){var w=v(t,n),E=v(e,n),S=x.get(E);if(S)r(t,n,S);else{var C=b?b(w,E,n+"",t,e,x):void 0,A=void 0===C;if(A){var T=l(E),k=!T&&h(E),M=!T&&!k&&g(E);C=E,T||k||M?l(w)?C=w:c(w)?C=a(w):k?(A=!1,C=i(E,!0)):M?(A=!1,C=o(E,!0)):C=[]:d(E)||u(E)?(C=w,u(w)?C=m(w):p(w)&&!f(w)||(C=s(E))):A=!1}A&&(x.set(E,C),_(C,E,y,b,x),x.delete(E)),r(t,n,C)}}},8674:t=>{t.exports=function(t){return function(e){return null==t?void 0:t[e]}}},5976:(t,e,n)=>{var r=n(6557),i=n(5357),o=n(61);t.exports=function(t,e){return o(i(t,e,r),t+"")}},6560:(t,e,n)=>{var r=n(5703),i=n(8777),o=n(6557),a=i?function(t,e){return i(t,"toString",{configurable:!0,enumerable:!1,value:r(e),writable:!0})}:o;t.exports=a},4259:t=>{t.exports=function(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o}},2545:t=>{t.exports=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}},531:(t,e,n)=>{var r=n(2705),i=n(9932),o=n(1469),a=n(3448),s=r?r.prototype:void 0,u=s?s.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(o(e))return i(e,t)+"";if(a(e))return u?u.call(e):"";var n=e+"";return"0"==n&&1/e==-1/0?"-0":n}},7561:(t,e,n)=>{var r=n(7990),i=/^\s+/;t.exports=function(t){return t?t.slice(0,r(t)+1).replace(i,""):t}},1717:t=>{t.exports=function(t){return function(e){return t(e)}}},5652:(t,e,n)=>{var r=n(8668),i=n(7443),o=n(1196),a=n(4757),s=n(3593),u=n(1814);t.exports=function(t,e,n){var l=-1,c=i,h=t.length,f=!0,p=[],d=p;if(n)f=!1,c=o;else if(h>=200){var g=e?null:s(t);if(g)return u(g);f=!1,c=a,d=new r}else d=e?[]:p;t:for(;++l<h;){var v=t[l],m=e?e(v):v;if(v=n||0!==v?v:0,f&&m==m){for(var y=d.length;y--;)if(d[y]===m)continue t;e&&d.push(m),p.push(v)}else c(d,m,n)||(d!==p&&d.push(m),p.push(v))}return p}},4757:t=>{t.exports=function(t,e){return t.has(e)}},180:(t,e,n)=>{var r=n(4259);t.exports=function(t,e,n){var i=t.length;return n=void 0===n?i:n,!e&&n>=i?t:r(t,e,n)}},4318:(t,e,n)=>{var r=n(1149);t.exports=function(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}},4626:(t,e,n)=>{t=n.nmd(t);var r=n(5639),i=e&&!e.nodeType&&e,o=i&&t&&!t.nodeType&&t,a=o&&o.exports===i?r.Buffer:void 0,s=a?a.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=s?s(n):new t.constructor(n);return t.copy(r),r}},7157:(t,e,n)=>{var r=n(4318);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},3147:t=>{var e=/\w*$/;t.exports=function(t){var n=new t.constructor(t.source,e.exec(t));return n.lastIndex=t.lastIndex,n}},419:(t,e,n)=>{var r=n(2705),i=r?r.prototype:void 0,o=i?i.valueOf:void 0;t.exports=function(t){return o?Object(o.call(t)):{}}},7133:(t,e,n)=>{var r=n(4318);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},278:t=>{t.exports=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}},8363:(t,e,n)=>{var r=n(4865),i=n(9465);t.exports=function(t,e,n,o){var a=!n;n||(n={});for(var s=-1,u=e.length;++s<u;){var l=e[s],c=o?o(n[l],t[l],l,n,t):void 0;void 0===c&&(c=t[l]),a?i(n,l,c):r(n,l,c)}return n}},8805:(t,e,n)=>{var r=n(8363),i=n(9551);t.exports=function(t,e){return r(t,i(t),e)}},1911:(t,e,n)=>{var r=n(8363),i=n(1442);t.exports=function(t,e){return r(t,i(t),e)}},4429:(t,e,n)=>{var r=n(5639)["__core-js_shared__"];t.exports=r},1463:(t,e,n)=>{var r=n(5976),i=n(6612);t.exports=function(t){return r((function(e,n){var r=-1,o=n.length,a=o>1?n[o-1]:void 0,s=o>2?n[2]:void 0;for(a=t.length>3&&"function"==typeof a?(o--,a):void 0,s&&i(n[0],n[1],s)&&(a=o<3?void 0:a,o=1),e=Object(e);++r<o;){var u=n[r];u&&t(e,u,r,a)}return e}))}},5063:t=>{t.exports=function(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}}},8882:(t,e,n)=>{var r=n(180),i=n(2689),o=n(3140),a=n(9833);t.exports=function(t){return function(e){e=a(e);var n=i(e)?o(e):void 0,s=n?n[0]:e.charAt(0),u=n?r(n,1).join(""):e.slice(1);return s[t]()+u}}},5393:(t,e,n)=>{var r=n(2663),i=n(3816),o=n(8748),a=RegExp("['’]","g");t.exports=function(t){return function(e){return r(o(i(e).replace(a,"")),t,"")}}},3593:(t,e,n)=>{var r=n(8525),i=n(308),o=n(1814),a=r&&1/o(new r([,-0]))[1]==1/0?function(t){return new r(t)}:i;t.exports=a},9389:(t,e,n)=>{var r=n(8674)({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"});t.exports=r},8777:(t,e,n)=>{var r=n(852),i=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=i},7114:(t,e,n)=>{var r=n(8668),i=n(2908),o=n(4757);t.exports=function(t,e,n,a,s,u){var l=1&n,c=t.length,h=e.length;if(c!=h&&!(l&&h>c))return!1;var f=u.get(t),p=u.get(e);if(f&&p)return f==e&&p==t;var d=-1,g=!0,v=2&n?new r:void 0;for(u.set(t,e),u.set(e,t);++d<c;){var m=t[d],y=e[d];if(a)var _=l?a(y,m,d,e,t,u):a(m,y,d,t,e,u);if(void 0!==_){if(_)continue;g=!1;break}if(v){if(!i(e,(function(t,e){if(!o(v,e)&&(m===t||s(m,t,n,a,u)))return v.push(e)}))){g=!1;break}}else if(m!==y&&!s(m,y,n,a,u)){g=!1;break}}return u.delete(t),u.delete(e),g}},8351:(t,e,n)=>{var r=n(2705),i=n(1149),o=n(7813),a=n(7114),s=n(8776),u=n(1814),l=r?r.prototype:void 0,c=l?l.valueOf:void 0;t.exports=function(t,e,n,r,l,h,f){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!h(new i(t),new i(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var p=s;case"[object Set]":var d=1&r;if(p||(p=u),t.size!=e.size&&!d)return!1;var g=f.get(t);if(g)return g==e;r|=2,f.set(t,e);var v=a(p(t),p(e),r,l,h,f);return f.delete(t),v;case"[object Symbol]":if(c)return c.call(t)==c.call(e)}return!1}},6096:(t,e,n)=>{var r=n(8234),i=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,o,a,s){var u=1&n,l=r(t),c=l.length;if(c!=r(e).length&&!u)return!1;for(var h=c;h--;){var f=l[h];if(!(u?f in e:i.call(e,f)))return!1}var p=s.get(t),d=s.get(e);if(p&&d)return p==e&&d==t;var g=!0;s.set(t,e),s.set(e,t);for(var v=u;++h<c;){var m=t[f=l[h]],y=e[f];if(o)var _=u?o(y,m,f,e,t,s):o(m,y,f,t,e,s);if(!(void 0===_?m===y||a(m,y,n,o,s):_)){g=!1;break}v||(v="constructor"==f)}if(g&&!v){var b=t.constructor,x=e.constructor;b==x||!("constructor"in t)||!("constructor"in e)||"function"==typeof b&&b instanceof b&&"function"==typeof x&&x instanceof x||(g=!1)}return s.delete(t),s.delete(e),g}},1957:(t,e,n)=>{var r="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;t.exports=r},8234:(t,e,n)=>{var r=n(8866),i=n(9551),o=n(3674);t.exports=function(t){return r(t,o,i)}},6904:(t,e,n)=>{var r=n(8866),i=n(1442),o=n(1704);t.exports=function(t){return r(t,o,i)}},5050:(t,e,n)=>{var r=n(7019);t.exports=function(t,e){var n=t.__data__;return r(e)?n["string"==typeof e?"string":"hash"]:n.map}},852:(t,e,n)=>{var r=n(8458),i=n(7801);t.exports=function(t,e){var n=i(t,e);return r(n)?n:void 0}},5924:(t,e,n)=>{var r=n(5569)(Object.getPrototypeOf,Object);t.exports=r},9607:(t,e,n)=>{var r=n(2705),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;t.exports=function(t){var e=o.call(t,s),n=t[s];try{t[s]=void 0;var r=!0}catch(t){}var i=a.call(t);return r&&(e?t[s]=n:delete t[s]),i}},9551:(t,e,n)=>{var r=n(4963),i=n(479),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(t){return null==t?[]:(t=Object(t),r(a(t),(function(e){return o.call(t,e)})))}:i;t.exports=s},1442:(t,e,n)=>{var r=n(2488),i=n(5924),o=n(9551),a=n(479),s=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)r(e,o(t)),t=i(t);return e}:a;t.exports=s},4160:(t,e,n)=>{var r=n(8552),i=n(7071),o=n(3818),a=n(8525),s=n(577),u=n(4239),l=n(346),c="[object Map]",h="[object Promise]",f="[object Set]",p="[object WeakMap]",d="[object DataView]",g=l(r),v=l(i),m=l(o),y=l(a),_=l(s),b=u;(r&&b(new r(new ArrayBuffer(1)))!=d||i&&b(new i)!=c||o&&b(o.resolve())!=h||a&&b(new a)!=f||s&&b(new s)!=p)&&(b=function(t){var e=u(t),n="[object Object]"==e?t.constructor:void 0,r=n?l(n):"";if(r)switch(r){case g:return d;case v:return c;case m:return h;case y:return f;case _:return p}return e}),t.exports=b},7801:t=>{t.exports=function(t,e){return null==t?void 0:t[e]}},2689:t=>{var e=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");t.exports=function(t){return e.test(t)}},3157:t=>{var e=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;t.exports=function(t){return e.test(t)}},1789:(t,e,n)=>{var r=n(4536);t.exports=function(){this.__data__=r?r(null):{},this.size=0}},401:t=>{t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},7667:(t,e,n)=>{var r=n(4536),i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(r){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(e,t)?e[t]:void 0}},1327:(t,e,n)=>{var r=n(4536),i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return r?void 0!==e[t]:i.call(e,t)}},1866:(t,e,n)=>{var r=n(4536);t.exports=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=r&&void 0===e?"__lodash_hash_undefined__":e,this}},3824:t=>{var e=Object.prototype.hasOwnProperty;t.exports=function(t){var n=t.length,r=new t.constructor(n);return n&&"string"==typeof t[0]&&e.call(t,"index")&&(r.index=t.index,r.input=t.input),r}},9148:(t,e,n)=>{var r=n(4318),i=n(7157),o=n(3147),a=n(419),s=n(7133);t.exports=function(t,e,n){var u=t.constructor;switch(e){case"[object ArrayBuffer]":return r(t);case"[object Boolean]":case"[object Date]":return new u(+t);case"[object DataView]":return i(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(t,n);case"[object Map]":case"[object Set]":return new u;case"[object Number]":case"[object String]":return new u(t);case"[object RegExp]":return o(t);case"[object Symbol]":return a(t)}}},8517:(t,e,n)=>{var r=n(3118),i=n(5924),o=n(5726);t.exports=function(t){return"function"!=typeof t.constructor||o(t)?{}:r(i(t))}},5776:t=>{var e=/^(?:0|[1-9]\d*)$/;t.exports=function(t,n){var r=typeof t;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&e.test(t))&&t>-1&&t%1==0&&t<n}},6612:(t,e,n)=>{var r=n(7813),i=n(8612),o=n(5776),a=n(3218);t.exports=function(t,e,n){if(!a(n))return!1;var s=typeof e;return!!("number"==s?i(n)&&o(e,n.length):"string"==s&&e in n)&&r(n[e],t)}},7019:t=>{t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},5346:(t,e,n)=>{var r,i=n(4429),o=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";t.exports=function(t){return!!o&&o in t}},5726:t=>{var e=Object.prototype;t.exports=function(t){var n=t&&t.constructor;return t===("function"==typeof n&&n.prototype||e)}},7040:t=>{t.exports=function(){this.__data__=[],this.size=0}},4125:(t,e,n)=>{var r=n(8470),i=Array.prototype.splice;t.exports=function(t){var e=this.__data__,n=r(e,t);return!(n<0||(n==e.length-1?e.pop():i.call(e,n,1),--this.size,0))}},2117:(t,e,n)=>{var r=n(8470);t.exports=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]}},7518:(t,e,n)=>{var r=n(8470);t.exports=function(t){return r(this.__data__,t)>-1}},4705:(t,e,n)=>{var r=n(8470);t.exports=function(t,e){var n=this.__data__,i=r(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this}},4785:(t,e,n)=>{var r=n(1989),i=n(8407),o=n(7071);t.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},1285:(t,e,n)=>{var r=n(5050);t.exports=function(t){var e=r(this,t).delete(t);return this.size-=e?1:0,e}},6e3:(t,e,n)=>{var r=n(5050);t.exports=function(t){return r(this,t).get(t)}},9916:(t,e,n)=>{var r=n(5050);t.exports=function(t){return r(this,t).has(t)}},5265:(t,e,n)=>{var r=n(5050);t.exports=function(t,e){var n=r(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this}},8776:t=>{t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}},4536:(t,e,n)=>{var r=n(852)(Object,"create");t.exports=r},6916:(t,e,n)=>{var r=n(5569)(Object.keys,Object);t.exports=r},3498:t=>{t.exports=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}},1167:(t,e,n)=>{t=n.nmd(t);var r=n(1957),i=e&&!e.nodeType&&e,o=i&&t&&!t.nodeType&&t,a=o&&o.exports===i&&r.process,s=function(){try{return o&&o.require&&o.require("util").types||a&&a.binding&&a.binding("util")}catch(t){}}();t.exports=s},2333:t=>{var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},5569:t=>{t.exports=function(t,e){return function(n){return t(e(n))}}},5357:(t,e,n)=>{var r=n(6874),i=Math.max;t.exports=function(t,e,n){return e=i(void 0===e?t.length-1:e,0),function(){for(var o=arguments,a=-1,s=i(o.length-e,0),u=Array(s);++a<s;)u[a]=o[e+a];a=-1;for(var l=Array(e+1);++a<e;)l[a]=o[a];return l[e]=n(u),r(t,this,l)}}},5639:(t,e,n)=>{var r=n(1957),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();t.exports=o},6390:t=>{t.exports=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}},619:t=>{t.exports=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this}},2385:t=>{t.exports=function(t){return this.__data__.has(t)}},1814:t=>{t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}},61:(t,e,n)=>{var r=n(6560),i=n(1275)(r);t.exports=i},1275:t=>{var e=Date.now;t.exports=function(t){var n=0,r=0;return function(){var i=e(),o=16-(i-r);if(r=i,o>0){if(++n>=800)return arguments[0]}else n=0;return t.apply(void 0,arguments)}}},7465:(t,e,n)=>{var r=n(8407);t.exports=function(){this.__data__=new r,this.size=0}},3779:t=>{t.exports=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}},7599:t=>{t.exports=function(t){return this.__data__.get(t)}},4758:t=>{t.exports=function(t){return this.__data__.has(t)}},4309:(t,e,n)=>{var r=n(8407),i=n(7071),o=n(3369);t.exports=function(t,e){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!i||a.length<199)return a.push([t,e]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(t,e),this.size=n.size,this}},2351:t=>{t.exports=function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}},3140:(t,e,n)=>{var r=n(4286),i=n(2689),o=n(676);t.exports=function(t){return i(t)?o(t):r(t)}},346:t=>{var e=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return e.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},7990:t=>{var e=/\s/;t.exports=function(t){for(var n=t.length;n--&&e.test(t.charAt(n)););return n}},676:t=>{var e="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",n="\\ud83c[\\udffb-\\udfff]",r="[^\\ud800-\\udfff]",i="(?:\\ud83c[\\udde6-\\uddff]){2}",o="[\\ud800-\\udbff][\\udc00-\\udfff]",a="(?:"+e+"|"+n+")?",s="[\\ufe0e\\ufe0f]?",u=s+a+"(?:\\u200d(?:"+[r,i,o].join("|")+")"+s+a+")*",l="(?:"+[r+e+"?",e,i,o,"[\\ud800-\\udfff]"].join("|")+")",c=RegExp(n+"(?="+n+")|"+l+u,"g");t.exports=function(t){return t.match(c)||[]}},2757:t=>{var e="a-z\\xdf-\\xf6\\xf8-\\xff",n="A-Z\\xc0-\\xd6\\xd8-\\xde",r="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",i="["+r+"]",o="\\d+",a="["+e+"]",s="[^\\ud800-\\udfff"+r+o+"\\u2700-\\u27bf"+e+n+"]",u="(?:\\ud83c[\\udde6-\\uddff]){2}",l="[\\ud800-\\udbff][\\udc00-\\udfff]",c="["+n+"]",h="(?:"+a+"|"+s+")",f="(?:"+c+"|"+s+")",p="(?:['’](?:d|ll|m|re|s|t|ve))?",d="(?:['’](?:D|LL|M|RE|S|T|VE))?",g="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",v="[\\ufe0e\\ufe0f]?",m=v+g+"(?:\\u200d(?:"+["[^\\ud800-\\udfff]",u,l].join("|")+")"+v+g+")*",y="(?:"+["[\\u2700-\\u27bf]",u,l].join("|")+")"+m,_=RegExp([c+"?"+a+"+"+p+"(?="+[i,c,"$"].join("|")+")",f+"+"+d+"(?="+[i,c+h,"$"].join("|")+")",c+"?"+h+"+"+p,c+"+"+d,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",o,y].join("|"),"g");t.exports=function(t){return t.match(_)||[]}},8929:(t,e,n)=>{var r=n(8403),i=n(5393)((function(t,e,n){return e=e.toLowerCase(),t+(n?r(e):e)}));t.exports=i},8403:(t,e,n)=>{var r=n(9833),i=n(1700);t.exports=function(t){return i(r(t).toLowerCase())}},4691:(t,e,n)=>{var r=n(9750),i=n(4841);t.exports=function(t,e,n){return void 0===n&&(n=e,e=void 0),void 0!==n&&(n=(n=i(n))==n?n:0),void 0!==e&&(e=(e=i(e))==e?e:0),r(i(t),e,n)}},361:(t,e,n)=>{var r=n(5990);t.exports=function(t){return r(t,5)}},5703:t=>{t.exports=function(t){return function(){return t}}},3279:(t,e,n)=>{var r=n(3218),i=n(7771),o=n(4841),a=Math.max,s=Math.min;t.exports=function(t,e,n){var u,l,c,h,f,p,d=0,g=!1,v=!1,m=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function y(e){var n=u,r=l;return u=l=void 0,d=e,h=t.apply(r,n)}function _(t){return d=t,f=setTimeout(x,e),g?y(t):h}function b(t){var n=t-p;return void 0===p||n>=e||n<0||v&&t-d>=c}function x(){var t=i();if(b(t))return w(t);f=setTimeout(x,function(t){var n=e-(t-p);return v?s(n,c-(t-d)):n}(t))}function w(t){return f=void 0,m&&u?y(t):(u=l=void 0,h)}function E(){var t=i(),n=b(t);if(u=arguments,l=this,p=t,n){if(void 0===f)return _(p);if(v)return clearTimeout(f),f=setTimeout(x,e),y(p)}return void 0===f&&(f=setTimeout(x,e)),h}return e=o(e)||0,r(n)&&(g=!!n.leading,c=(v="maxWait"in n)?a(o(n.maxWait)||0,e):c,m="trailing"in n?!!n.trailing:m),E.cancel=function(){void 0!==f&&clearTimeout(f),d=0,u=p=l=f=void 0},E.flush=function(){return void 0===f?h:w(i())},E}},3816:(t,e,n)=>{var r=n(9389),i=n(9833),o=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,a=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");t.exports=function(t){return(t=i(t))&&t.replace(o,r).replace(a,"")}},7813:t=>{t.exports=function(t,e){return t===e||t!=t&&e!=e}},6557:t=>{t.exports=function(t){return t}},5694:(t,e,n)=>{var r=n(9454),i=n(7005),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(t){return i(t)&&a.call(t,"callee")&&!s.call(t,"callee")};t.exports=u},1469:t=>{var e=Array.isArray;t.exports=e},8612:(t,e,n)=>{var r=n(3560),i=n(1780);t.exports=function(t){return null!=t&&i(t.length)&&!r(t)}},9246:(t,e,n)=>{var r=n(8612),i=n(7005);t.exports=function(t){return i(t)&&r(t)}},4144:(t,e,n)=>{t=n.nmd(t);var r=n(5639),i=n(5062),o=e&&!e.nodeType&&e,a=o&&t&&!t.nodeType&&t,s=a&&a.exports===o?r.Buffer:void 0,u=(s?s.isBuffer:void 0)||i;t.exports=u},8446:(t,e,n)=>{var r=n(939);t.exports=function(t,e){return r(t,e)}},3560:(t,e,n)=>{var r=n(4239),i=n(3218);t.exports=function(t){if(!i(t))return!1;var e=r(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},1780:t=>{t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},6688:(t,e,n)=>{var r=n(5588),i=n(1717),o=n(1167),a=o&&o.isMap,s=a?i(a):r;t.exports=s},4293:t=>{t.exports=function(t){return null==t}},1763:(t,e,n)=>{var r=n(4239),i=n(7005);t.exports=function(t){return"number"==typeof t||i(t)&&"[object Number]"==r(t)}},3218:t=>{t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},7005:t=>{t.exports=function(t){return null!=t&&"object"==typeof t}},8630:(t,e,n)=>{var r=n(4239),i=n(5924),o=n(7005),a=Function.prototype,s=Object.prototype,u=a.toString,l=s.hasOwnProperty,c=u.call(Object);t.exports=function(t){if(!o(t)||"[object Object]"!=r(t))return!1;var e=i(t);if(null===e)return!0;var n=l.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)==c}},2928:(t,e,n)=>{var r=n(9221),i=n(1717),o=n(1167),a=o&&o.isSet,s=a?i(a):r;t.exports=s},7037:(t,e,n)=>{var r=n(4239),i=n(1469),o=n(7005);t.exports=function(t){return"string"==typeof t||!i(t)&&o(t)&&"[object String]"==r(t)}},3448:(t,e,n)=>{var r=n(4239),i=n(7005);t.exports=function(t){return"symbol"==typeof t||i(t)&&"[object Symbol]"==r(t)}},6719:(t,e,n)=>{var r=n(8749),i=n(1717),o=n(1167),a=o&&o.isTypedArray,s=a?i(a):r;t.exports=s},3674:(t,e,n)=>{var r=n(4636),i=n(280),o=n(8612);t.exports=function(t){return o(t)?r(t):i(t)}},1704:(t,e,n)=>{var r=n(4636),i=n(313),o=n(8612);t.exports=function(t){return o(t)?r(t,!0):i(t)}},6486:function(t,e,n){var r;t=n.nmd(t),function(){var i,o="Expected a function",a="__lodash_hash_undefined__",s="__lodash_placeholder__",u=32,l=128,c=1/0,h=9007199254740991,f=NaN,p=4294967295,d=[["ary",l],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",u],["partialRight",64],["rearg",256]],g="[object Arguments]",v="[object Array]",m="[object Boolean]",y="[object Date]",_="[object Error]",b="[object Function]",x="[object GeneratorFunction]",w="[object Map]",E="[object Number]",S="[object Object]",C="[object Promise]",A="[object RegExp]",T="[object Set]",k="[object String]",M="[object Symbol]",P="[object WeakMap]",I="[object ArrayBuffer]",O="[object DataView]",R="[object Float32Array]",L="[object Float64Array]",D="[object Int8Array]",N="[object Int16Array]",B="[object Int32Array]",z="[object Uint8Array]",F="[object Uint8ClampedArray]",Z="[object Uint16Array]",j="[object Uint32Array]",U=/\b__p \+= '';/g,G=/\b(__p \+=) '' \+/g,V=/(__e\(.*?\)|\b__t\)) \+\n'';/g,W=/&(?:amp|lt|gt|quot|#39);/g,H=/[&<>"']/g,X=RegExp(W.source),Y=RegExp(H.source),q=/<%-([\s\S]+?)%>/g,K=/<%([\s\S]+?)%>/g,Q=/<%=([\s\S]+?)%>/g,J=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$=/^\w*$/,tt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,et=/[\\^$.*+?()[\]{}|]/g,nt=RegExp(et.source),rt=/^\s+/,it=/\s/,ot=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,at=/\{\n\/\* \[wrapped with (.+)\] \*/,st=/,? & /,ut=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,lt=/[()=,{}\[\]\/\s]/,ct=/\\(\\)?/g,ht=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ft=/\w*$/,pt=/^[-+]0x[0-9a-f]+$/i,dt=/^0b[01]+$/i,gt=/^\[object .+?Constructor\]$/,vt=/^0o[0-7]+$/i,mt=/^(?:0|[1-9]\d*)$/,yt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,_t=/($^)/,bt=/['\n\r\u2028\u2029\\]/g,xt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",wt="a-z\\xdf-\\xf6\\xf8-\\xff",Et="A-Z\\xc0-\\xd6\\xd8-\\xde",St="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ct="["+St+"]",At="["+xt+"]",Tt="\\d+",kt="["+wt+"]",Mt="[^\\ud800-\\udfff"+St+Tt+"\\u2700-\\u27bf"+wt+Et+"]",Pt="\\ud83c[\\udffb-\\udfff]",It="[^\\ud800-\\udfff]",Ot="(?:\\ud83c[\\udde6-\\uddff]){2}",Rt="[\\ud800-\\udbff][\\udc00-\\udfff]",Lt="["+Et+"]",Dt="(?:"+kt+"|"+Mt+")",Nt="(?:"+Lt+"|"+Mt+")",Bt="(?:['’](?:d|ll|m|re|s|t|ve))?",zt="(?:['’](?:D|LL|M|RE|S|T|VE))?",Ft="(?:"+At+"|"+Pt+")?",Zt="[\\ufe0e\\ufe0f]?",jt=Zt+Ft+"(?:\\u200d(?:"+[It,Ot,Rt].join("|")+")"+Zt+Ft+")*",Ut="(?:"+["[\\u2700-\\u27bf]",Ot,Rt].join("|")+")"+jt,Gt="(?:"+[It+At+"?",At,Ot,Rt,"[\\ud800-\\udfff]"].join("|")+")",Vt=RegExp("['’]","g"),Wt=RegExp(At,"g"),Ht=RegExp(Pt+"(?="+Pt+")|"+Gt+jt,"g"),Xt=RegExp([Lt+"?"+kt+"+"+Bt+"(?="+[Ct,Lt,"$"].join("|")+")",Nt+"+"+zt+"(?="+[Ct,Lt+Dt,"$"].join("|")+")",Lt+"?"+Dt+"+"+Bt,Lt+"+"+zt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Tt,Ut].join("|"),"g"),Yt=RegExp("[\\u200d\\ud800-\\udfff"+xt+"\\ufe0e\\ufe0f]"),qt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Kt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Qt=-1,Jt={};Jt[R]=Jt[L]=Jt[D]=Jt[N]=Jt[B]=Jt[z]=Jt[F]=Jt[Z]=Jt[j]=!0,Jt[g]=Jt[v]=Jt[I]=Jt[m]=Jt[O]=Jt[y]=Jt[_]=Jt[b]=Jt[w]=Jt[E]=Jt[S]=Jt[A]=Jt[T]=Jt[k]=Jt[P]=!1;var $t={};$t[g]=$t[v]=$t[I]=$t[O]=$t[m]=$t[y]=$t[R]=$t[L]=$t[D]=$t[N]=$t[B]=$t[w]=$t[E]=$t[S]=$t[A]=$t[T]=$t[k]=$t[M]=$t[z]=$t[F]=$t[Z]=$t[j]=!0,$t[_]=$t[b]=$t[P]=!1;var te={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ee=parseFloat,ne=parseInt,re="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,ie="object"==typeof self&&self&&self.Object===Object&&self,oe=re||ie||Function("return this")(),ae=e&&!e.nodeType&&e,se=ae&&t&&!t.nodeType&&t,ue=se&&se.exports===ae,le=ue&&re.process,ce=function(){try{return se&&se.require&&se.require("util").types||le&&le.binding&&le.binding("util")}catch(t){}}(),he=ce&&ce.isArrayBuffer,fe=ce&&ce.isDate,pe=ce&&ce.isMap,de=ce&&ce.isRegExp,ge=ce&&ce.isSet,ve=ce&&ce.isTypedArray;function me(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function ye(t,e,n,r){for(var i=-1,o=null==t?0:t.length;++i<o;){var a=t[i];e(r,a,n(a),t)}return r}function _e(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function be(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function xe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function we(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}function Ee(t,e){return!(null==t||!t.length)&&Re(t,e,0)>-1}function Se(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function Ce(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function Ae(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function Te(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function ke(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function Me(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var Pe=Be("length");function Ie(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function Oe(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}function Re(t,e,n){return e==e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):Oe(t,De,n)}function Le(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return-1}function De(t){return t!=t}function Ne(t,e){var n=null==t?0:t.length;return n?Ze(t,e)/n:f}function Be(t){return function(e){return null==e?i:e[t]}}function ze(t){return function(e){return null==t?i:t[e]}}function Fe(t,e,n,r,i){return i(t,(function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)})),n}function Ze(t,e){for(var n,r=-1,o=t.length;++r<o;){var a=e(t[r]);a!==i&&(n=n===i?a:n+a)}return n}function je(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Ue(t){return t?t.slice(0,sn(t)+1).replace(rt,""):t}function Ge(t){return function(e){return t(e)}}function Ve(t,e){return Ce(e,(function(e){return t[e]}))}function We(t,e){return t.has(e)}function He(t,e){for(var n=-1,r=t.length;++n<r&&Re(e,t[n],0)>-1;);return n}function Xe(t,e){for(var n=t.length;n--&&Re(e,t[n],0)>-1;);return n}function Ye(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}var qe=ze({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),Ke=ze({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Qe(t){return"\\"+te[t]}function Je(t){return Yt.test(t)}function $e(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function tn(t,e){return function(n){return t(e(n))}}function en(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];a!==e&&a!==s||(t[n]=s,o[i++]=n)}return o}function nn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function rn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}function on(t){return Je(t)?function(t){for(var e=Ht.lastIndex=0;Ht.test(t);)++e;return e}(t):Pe(t)}function an(t){return Je(t)?function(t){return t.match(Ht)||[]}(t):function(t){return t.split("")}(t)}function sn(t){for(var e=t.length;e--&&it.test(t.charAt(e)););return e}var un=ze({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),ln=function t(e){var n,r=(e=null==e?oe:ln.defaults(oe.Object(),e,ln.pick(oe,Kt))).Array,it=e.Date,xt=e.Error,wt=e.Function,Et=e.Math,St=e.Object,Ct=e.RegExp,At=e.String,Tt=e.TypeError,kt=r.prototype,Mt=wt.prototype,Pt=St.prototype,It=e["__core-js_shared__"],Ot=Mt.toString,Rt=Pt.hasOwnProperty,Lt=0,Dt=(n=/[^.]+$/.exec(It&&It.keys&&It.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",Nt=Pt.toString,Bt=Ot.call(St),zt=oe._,Ft=Ct("^"+Ot.call(Rt).replace(et,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Zt=ue?e.Buffer:i,jt=e.Symbol,Ut=e.Uint8Array,Gt=Zt?Zt.allocUnsafe:i,Ht=tn(St.getPrototypeOf,St),Yt=St.create,te=Pt.propertyIsEnumerable,re=kt.splice,ie=jt?jt.isConcatSpreadable:i,ae=jt?jt.iterator:i,se=jt?jt.toStringTag:i,le=function(){try{var t=lo(St,"defineProperty");return t({},"",{}),t}catch(t){}}(),ce=e.clearTimeout!==oe.clearTimeout&&e.clearTimeout,Pe=it&&it.now!==oe.Date.now&&it.now,ze=e.setTimeout!==oe.setTimeout&&e.setTimeout,cn=Et.ceil,hn=Et.floor,fn=St.getOwnPropertySymbols,pn=Zt?Zt.isBuffer:i,dn=e.isFinite,gn=kt.join,vn=tn(St.keys,St),mn=Et.max,yn=Et.min,_n=it.now,bn=e.parseInt,xn=Et.random,wn=kt.reverse,En=lo(e,"DataView"),Sn=lo(e,"Map"),Cn=lo(e,"Promise"),An=lo(e,"Set"),Tn=lo(e,"WeakMap"),kn=lo(St,"create"),Mn=Tn&&new Tn,Pn={},In=Fo(En),On=Fo(Sn),Rn=Fo(Cn),Ln=Fo(An),Dn=Fo(Tn),Nn=jt?jt.prototype:i,Bn=Nn?Nn.valueOf:i,zn=Nn?Nn.toString:i;function Fn(t){if(ns(t)&&!Wa(t)&&!(t instanceof Gn)){if(t instanceof Un)return t;if(Rt.call(t,"__wrapped__"))return Zo(t)}return new Un(t)}var Zn=function(){function t(){}return function(e){if(!es(e))return{};if(Yt)return Yt(e);t.prototype=e;var n=new t;return t.prototype=i,n}}();function jn(){}function Un(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=i}function Gn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=p,this.__views__=[]}function Vn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Wn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Hn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Xn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Hn;++e<n;)this.add(t[e])}function Yn(t){var e=this.__data__=new Wn(t);this.size=e.size}function qn(t,e){var n=Wa(t),r=!n&&Va(t),i=!n&&!r&&qa(t),o=!n&&!r&&!i&&cs(t),a=n||r||i||o,s=a?je(t.length,At):[],u=s.length;for(var l in t)!e&&!Rt.call(t,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||mo(l,u))||s.push(l);return s}function Kn(t){var e=t.length;return e?t[Hr(0,e-1)]:i}function Qn(t,e){return Lo(Ti(t),ar(e,0,t.length))}function Jn(t){return Lo(Ti(t))}function $n(t,e,n){(n!==i&&!ja(t[e],n)||n===i&&!(e in t))&&ir(t,e,n)}function tr(t,e,n){var r=t[e];Rt.call(t,e)&&ja(r,n)&&(n!==i||e in t)||ir(t,e,n)}function er(t,e){for(var n=t.length;n--;)if(ja(t[n][0],e))return n;return-1}function nr(t,e,n,r){return hr(t,(function(t,i,o){e(r,t,n(t),o)})),r}function rr(t,e){return t&&ki(e,Os(e),t)}function ir(t,e,n){"__proto__"==e&&le?le(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function or(t,e){for(var n=-1,o=e.length,a=r(o),s=null==t;++n<o;)a[n]=s?i:Ts(t,e[n]);return a}function ar(t,e,n){return t==t&&(n!==i&&(t=t<=n?t:n),e!==i&&(t=t>=e?t:e)),t}function sr(t,e,n,r,o,a){var s,u=1&e,l=2&e,c=4&e;if(n&&(s=o?n(t,r,o,a):n(t)),s!==i)return s;if(!es(t))return t;var h=Wa(t);if(h){if(s=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&Rt.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!u)return Ti(t,s)}else{var f=fo(t),p=f==b||f==x;if(qa(t))return xi(t,u);if(f==S||f==g||p&&!o){if(s=l||p?{}:go(t),!u)return l?function(t,e){return ki(t,ho(t),e)}(t,function(t,e){return t&&ki(e,Rs(e),t)}(s,t)):function(t,e){return ki(t,co(t),e)}(t,rr(s,t))}else{if(!$t[f])return o?t:{};s=function(t,e,n){var r,i=t.constructor;switch(e){case I:return wi(t);case m:case y:return new i(+t);case O:return function(t,e){var n=e?wi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case R:case L:case D:case N:case B:case z:case F:case Z:case j:return Ei(t,n);case w:return new i;case E:case k:return new i(t);case A:return function(t){var e=new t.constructor(t.source,ft.exec(t));return e.lastIndex=t.lastIndex,e}(t);case T:return new i;case M:return r=t,Bn?St(Bn.call(r)):{}}}(t,f,u)}}a||(a=new Yn);var d=a.get(t);if(d)return d;a.set(t,s),ss(t)?t.forEach((function(r){s.add(sr(r,e,n,r,t,a))})):rs(t)&&t.forEach((function(r,i){s.set(i,sr(r,e,n,i,t,a))}));var v=h?i:(c?l?no:eo:l?Rs:Os)(t);return _e(v||t,(function(r,i){v&&(r=t[i=r]),tr(s,i,sr(r,e,n,i,t,a))})),s}function ur(t,e,n){var r=n.length;if(null==t)return!r;for(t=St(t);r--;){var o=n[r],a=e[o],s=t[o];if(s===i&&!(o in t)||!a(s))return!1}return!0}function lr(t,e,n){if("function"!=typeof t)throw new Tt(o);return Po((function(){t.apply(i,n)}),e)}function cr(t,e,n,r){var i=-1,o=Ee,a=!0,s=t.length,u=[],l=e.length;if(!s)return u;n&&(e=Ce(e,Ge(n))),r?(o=Se,a=!1):e.length>=200&&(o=We,a=!1,e=new Xn(e));t:for(;++i<s;){var c=t[i],h=null==n?c:n(c);if(c=r||0!==c?c:0,a&&h==h){for(var f=l;f--;)if(e[f]===h)continue t;u.push(c)}else o(e,h,r)||u.push(c)}return u}Fn.templateSettings={escape:q,evaluate:K,interpolate:Q,variable:"",imports:{_:Fn}},Fn.prototype=jn.prototype,Fn.prototype.constructor=Fn,Un.prototype=Zn(jn.prototype),Un.prototype.constructor=Un,Gn.prototype=Zn(jn.prototype),Gn.prototype.constructor=Gn,Vn.prototype.clear=function(){this.__data__=kn?kn(null):{},this.size=0},Vn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Vn.prototype.get=function(t){var e=this.__data__;if(kn){var n=e[t];return n===a?i:n}return Rt.call(e,t)?e[t]:i},Vn.prototype.has=function(t){var e=this.__data__;return kn?e[t]!==i:Rt.call(e,t)},Vn.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=kn&&e===i?a:e,this},Wn.prototype.clear=function(){this.__data__=[],this.size=0},Wn.prototype.delete=function(t){var e=this.__data__,n=er(e,t);return!(n<0||(n==e.length-1?e.pop():re.call(e,n,1),--this.size,0))},Wn.prototype.get=function(t){var e=this.__data__,n=er(e,t);return n<0?i:e[n][1]},Wn.prototype.has=function(t){return er(this.__data__,t)>-1},Wn.prototype.set=function(t,e){var n=this.__data__,r=er(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Hn.prototype.clear=function(){this.size=0,this.__data__={hash:new Vn,map:new(Sn||Wn),string:new Vn}},Hn.prototype.delete=function(t){var e=so(this,t).delete(t);return this.size-=e?1:0,e},Hn.prototype.get=function(t){return so(this,t).get(t)},Hn.prototype.has=function(t){return so(this,t).has(t)},Hn.prototype.set=function(t,e){var n=so(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Xn.prototype.add=Xn.prototype.push=function(t){return this.__data__.set(t,a),this},Xn.prototype.has=function(t){return this.__data__.has(t)},Yn.prototype.clear=function(){this.__data__=new Wn,this.size=0},Yn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Yn.prototype.get=function(t){return this.__data__.get(t)},Yn.prototype.has=function(t){return this.__data__.has(t)},Yn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Wn){var r=n.__data__;if(!Sn||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Hn(r)}return n.set(t,e),this.size=n.size,this};var hr=Ii(_r),fr=Ii(br,!0);function pr(t,e){var n=!0;return hr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function dr(t,e,n){for(var r=-1,o=t.length;++r<o;){var a=t[r],s=e(a);if(null!=s&&(u===i?s==s&&!ls(s):n(s,u)))var u=s,l=a}return l}function gr(t,e){var n=[];return hr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function vr(t,e,n,r,i){var o=-1,a=t.length;for(n||(n=vo),i||(i=[]);++o<a;){var s=t[o];e>0&&n(s)?e>1?vr(s,e-1,n,r,i):Ae(i,s):r||(i[i.length]=s)}return i}var mr=Oi(),yr=Oi(!0);function _r(t,e){return t&&mr(t,e,Os)}function br(t,e){return t&&yr(t,e,Os)}function xr(t,e){return we(e,(function(e){return Ja(t[e])}))}function wr(t,e){for(var n=0,r=(e=mi(e,t)).length;null!=t&&n<r;)t=t[zo(e[n++])];return n&&n==r?t:i}function Er(t,e,n){var r=e(t);return Wa(t)?r:Ae(r,n(t))}function Sr(t){return null==t?t===i?"[object Undefined]":"[object Null]":se&&se in St(t)?function(t){var e=Rt.call(t,se),n=t[se];try{t[se]=i;var r=!0}catch(t){}var o=Nt.call(t);return r&&(e?t[se]=n:delete t[se]),o}(t):function(t){return Nt.call(t)}(t)}function Cr(t,e){return t>e}function Ar(t,e){return null!=t&&Rt.call(t,e)}function Tr(t,e){return null!=t&&e in St(t)}function kr(t,e,n){for(var o=n?Se:Ee,a=t[0].length,s=t.length,u=s,l=r(s),c=1/0,h=[];u--;){var f=t[u];u&&e&&(f=Ce(f,Ge(e))),c=yn(f.length,c),l[u]=!n&&(e||a>=120&&f.length>=120)?new Xn(u&&f):i}f=t[0];var p=-1,d=l[0];t:for(;++p<a&&h.length<c;){var g=f[p],v=e?e(g):g;if(g=n||0!==g?g:0,!(d?We(d,v):o(h,v,n))){for(u=s;--u;){var m=l[u];if(!(m?We(m,v):o(t[u],v,n)))continue t}d&&d.push(v),h.push(g)}}return h}function Mr(t,e,n){var r=null==(t=Ao(t,e=mi(e,t)))?t:t[zo(Qo(e))];return null==r?i:me(r,t,n)}function Pr(t){return ns(t)&&Sr(t)==g}function Ir(t,e,n,r,o){return t===e||(null==t||null==e||!ns(t)&&!ns(e)?t!=t&&e!=e:function(t,e,n,r,o,a){var s=Wa(t),u=Wa(e),l=s?v:fo(t),c=u?v:fo(e),h=(l=l==g?S:l)==S,f=(c=c==g?S:c)==S,p=l==c;if(p&&qa(t)){if(!qa(e))return!1;s=!0,h=!1}if(p&&!h)return a||(a=new Yn),s||cs(t)?$i(t,e,n,r,o,a):function(t,e,n,r,i,o,a){switch(n){case O:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case I:return!(t.byteLength!=e.byteLength||!o(new Ut(t),new Ut(e)));case m:case y:case E:return ja(+t,+e);case _:return t.name==e.name&&t.message==e.message;case A:case k:return t==e+"";case w:var s=$e;case T:var u=1&r;if(s||(s=nn),t.size!=e.size&&!u)return!1;var l=a.get(t);if(l)return l==e;r|=2,a.set(t,e);var c=$i(s(t),s(e),r,i,o,a);return a.delete(t),c;case M:if(Bn)return Bn.call(t)==Bn.call(e)}return!1}(t,e,l,n,r,o,a);if(!(1&n)){var d=h&&Rt.call(t,"__wrapped__"),b=f&&Rt.call(e,"__wrapped__");if(d||b){var x=d?t.value():t,C=b?e.value():e;return a||(a=new Yn),o(x,C,n,r,a)}}return!!p&&(a||(a=new Yn),function(t,e,n,r,o,a){var s=1&n,u=eo(t),l=u.length;if(l!=eo(e).length&&!s)return!1;for(var c=l;c--;){var h=u[c];if(!(s?h in e:Rt.call(e,h)))return!1}var f=a.get(t),p=a.get(e);if(f&&p)return f==e&&p==t;var d=!0;a.set(t,e),a.set(e,t);for(var g=s;++c<l;){var v=t[h=u[c]],m=e[h];if(r)var y=s?r(m,v,h,e,t,a):r(v,m,h,t,e,a);if(!(y===i?v===m||o(v,m,n,r,a):y)){d=!1;break}g||(g="constructor"==h)}if(d&&!g){var _=t.constructor,b=e.constructor;_==b||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof b&&b instanceof b||(d=!1)}return a.delete(t),a.delete(e),d}(t,e,n,r,o,a))}(t,e,n,r,Ir,o))}function Or(t,e,n,r){var o=n.length,a=o,s=!r;if(null==t)return!a;for(t=St(t);o--;){var u=n[o];if(s&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++o<a;){var l=(u=n[o])[0],c=t[l],h=u[1];if(s&&u[2]){if(c===i&&!(l in t))return!1}else{var f=new Yn;if(r)var p=r(c,h,l,t,e,f);if(!(p===i?Ir(h,c,3,r,f):p))return!1}}return!0}function Rr(t){return!(!es(t)||(e=t,Dt&&Dt in e))&&(Ja(t)?Ft:gt).test(Fo(t));var e}function Lr(t){return"function"==typeof t?t:null==t?iu:"object"==typeof t?Wa(t)?Fr(t[0],t[1]):zr(t):pu(t)}function Dr(t){if(!wo(t))return vn(t);var e=[];for(var n in St(t))Rt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Nr(t,e){return t<e}function Br(t,e){var n=-1,i=Xa(t)?r(t.length):[];return hr(t,(function(t,r,o){i[++n]=e(t,r,o)})),i}function zr(t){var e=uo(t);return 1==e.length&&e[0][2]?So(e[0][0],e[0][1]):function(n){return n===t||Or(n,t,e)}}function Fr(t,e){return _o(t)&&Eo(e)?So(zo(t),e):function(n){var r=Ts(n,t);return r===i&&r===e?ks(n,t):Ir(e,r,3)}}function Zr(t,e,n,r,o){t!==e&&mr(e,(function(a,s){if(o||(o=new Yn),es(a))!function(t,e,n,r,o,a,s){var u=ko(t,n),l=ko(e,n),c=s.get(l);if(c)$n(t,n,c);else{var h=a?a(u,l,n+"",t,e,s):i,f=h===i;if(f){var p=Wa(l),d=!p&&qa(l),g=!p&&!d&&cs(l);h=l,p||d||g?Wa(u)?h=u:Ya(u)?h=Ti(u):d?(f=!1,h=xi(l,!0)):g?(f=!1,h=Ei(l,!0)):h=[]:os(l)||Va(l)?(h=u,Va(u)?h=ys(u):es(u)&&!Ja(u)||(h=go(l))):f=!1}f&&(s.set(l,h),o(h,l,r,a,s),s.delete(l)),$n(t,n,h)}}(t,e,s,n,Zr,r,o);else{var u=r?r(ko(t,s),a,s+"",t,e,o):i;u===i&&(u=a),$n(t,s,u)}}),Rs)}function jr(t,e){var n=t.length;if(n)return mo(e+=e<0?n:0,n)?t[e]:i}function Ur(t,e,n){e=e.length?Ce(e,(function(t){return Wa(t)?function(e){return wr(e,1===t.length?t[0]:t)}:t})):[iu];var r=-1;e=Ce(e,Ge(ao()));var i=Br(t,(function(t,n,i){var o=Ce(e,(function(e){return e(t)}));return{criteria:o,index:++r,value:t}}));return function(t,e){var r=t.length;for(t.sort((function(t,e){return function(t,e,n){for(var r=-1,i=t.criteria,o=e.criteria,a=i.length,s=n.length;++r<a;){var u=Si(i[r],o[r]);if(u)return r>=s?u:u*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}));r--;)t[r]=t[r].value;return t}(i)}function Gr(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var a=e[r],s=wr(t,a);n(s,a)&&Qr(o,mi(a,t),s)}return o}function Vr(t,e,n,r){var i=r?Le:Re,o=-1,a=e.length,s=t;for(t===e&&(e=Ti(e)),n&&(s=Ce(t,Ge(n)));++o<a;)for(var u=0,l=e[o],c=n?n(l):l;(u=i(s,c,u,r))>-1;)s!==t&&re.call(s,u,1),re.call(t,u,1);return t}function Wr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==o){var o=i;mo(i)?re.call(t,i,1):li(t,i)}}return t}function Hr(t,e){return t+hn(xn()*(e-t+1))}function Xr(t,e){var n="";if(!t||e<1||e>h)return n;do{e%2&&(n+=t),(e=hn(e/2))&&(t+=t)}while(e);return n}function Yr(t,e){return Io(Co(t,e,iu),t+"")}function qr(t){return Kn(js(t))}function Kr(t,e){var n=js(t);return Lo(n,ar(e,0,n.length))}function Qr(t,e,n,r){if(!es(t))return t;for(var o=-1,a=(e=mi(e,t)).length,s=a-1,u=t;null!=u&&++o<a;){var l=zo(e[o]),c=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return t;if(o!=s){var h=u[l];(c=r?r(h,l,u):i)===i&&(c=es(h)?h:mo(e[o+1])?[]:{})}tr(u,l,c),u=u[l]}return t}var Jr=Mn?function(t,e){return Mn.set(t,e),t}:iu,$r=le?function(t,e){return le(t,"toString",{configurable:!0,enumerable:!1,value:eu(e),writable:!0})}:iu;function ti(t){return Lo(js(t))}function ei(t,e,n){var i=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var a=r(o);++i<o;)a[i]=t[i+e];return a}function ni(t,e){var n;return hr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function ri(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=2147483647){for(;r<i;){var o=r+i>>>1,a=t[o];null!==a&&!ls(a)&&(n?a<=e:a<e)?r=o+1:i=o}return i}return ii(t,e,iu,n)}function ii(t,e,n,r){var o=0,a=null==t?0:t.length;if(0===a)return 0;for(var s=(e=n(e))!=e,u=null===e,l=ls(e),c=e===i;o<a;){var h=hn((o+a)/2),f=n(t[h]),p=f!==i,d=null===f,g=f==f,v=ls(f);if(s)var m=r||g;else m=c?g&&(r||p):u?g&&p&&(r||!d):l?g&&p&&!d&&(r||!v):!d&&!v&&(r?f<=e:f<e);m?o=h+1:a=h}return yn(a,4294967294)}function oi(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n],s=e?e(a):a;if(!n||!ja(s,u)){var u=s;o[i++]=0===a?0:a}}return o}function ai(t){return"number"==typeof t?t:ls(t)?f:+t}function si(t){if("string"==typeof t)return t;if(Wa(t))return Ce(t,si)+"";if(ls(t))return zn?zn.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function ui(t,e,n){var r=-1,i=Ee,o=t.length,a=!0,s=[],u=s;if(n)a=!1,i=Se;else if(o>=200){var l=e?null:Xi(t);if(l)return nn(l);a=!1,i=We,u=new Xn}else u=e?[]:s;t:for(;++r<o;){var c=t[r],h=e?e(c):c;if(c=n||0!==c?c:0,a&&h==h){for(var f=u.length;f--;)if(u[f]===h)continue t;e&&u.push(h),s.push(c)}else i(u,h,n)||(u!==s&&u.push(h),s.push(c))}return s}function li(t,e){return null==(t=Ao(t,e=mi(e,t)))||delete t[zo(Qo(e))]}function ci(t,e,n,r){return Qr(t,e,n(wr(t,e)),r)}function hi(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?ei(t,r?0:o,r?o+1:i):ei(t,r?o+1:0,r?i:o)}function fi(t,e){var n=t;return n instanceof Gn&&(n=n.value()),Te(e,(function(t,e){return e.func.apply(e.thisArg,Ae([t],e.args))}),n)}function pi(t,e,n){var i=t.length;if(i<2)return i?ui(t[0]):[];for(var o=-1,a=r(i);++o<i;)for(var s=t[o],u=-1;++u<i;)u!=o&&(a[o]=cr(a[o]||s,t[u],e,n));return ui(vr(a,1),e,n)}function di(t,e,n){for(var r=-1,o=t.length,a=e.length,s={};++r<o;){var u=r<a?e[r]:i;n(s,t[r],u)}return s}function gi(t){return Ya(t)?t:[]}function vi(t){return"function"==typeof t?t:iu}function mi(t,e){return Wa(t)?t:_o(t,e)?[t]:Bo(_s(t))}var yi=Yr;function _i(t,e,n){var r=t.length;return n=n===i?r:n,!e&&n>=r?t:ei(t,e,n)}var bi=ce||function(t){return oe.clearTimeout(t)};function xi(t,e){if(e)return t.slice();var n=t.length,r=Gt?Gt(n):new t.constructor(n);return t.copy(r),r}function wi(t){var e=new t.constructor(t.byteLength);return new Ut(e).set(new Ut(t)),e}function Ei(t,e){var n=e?wi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Si(t,e){if(t!==e){var n=t!==i,r=null===t,o=t==t,a=ls(t),s=e!==i,u=null===e,l=e==e,c=ls(e);if(!u&&!c&&!a&&t>e||a&&s&&l&&!u&&!c||r&&s&&l||!n&&l||!o)return 1;if(!r&&!a&&!c&&t<e||c&&n&&o&&!r&&!a||u&&n&&o||!s&&o||!l)return-1}return 0}function Ci(t,e,n,i){for(var o=-1,a=t.length,s=n.length,u=-1,l=e.length,c=mn(a-s,0),h=r(l+c),f=!i;++u<l;)h[u]=e[u];for(;++o<s;)(f||o<a)&&(h[n[o]]=t[o]);for(;c--;)h[u++]=t[o++];return h}function Ai(t,e,n,i){for(var o=-1,a=t.length,s=-1,u=n.length,l=-1,c=e.length,h=mn(a-u,0),f=r(h+c),p=!i;++o<h;)f[o]=t[o];for(var d=o;++l<c;)f[d+l]=e[l];for(;++s<u;)(p||o<a)&&(f[d+n[s]]=t[o++]);return f}function Ti(t,e){var n=-1,i=t.length;for(e||(e=r(i));++n<i;)e[n]=t[n];return e}function ki(t,e,n,r){var o=!n;n||(n={});for(var a=-1,s=e.length;++a<s;){var u=e[a],l=r?r(n[u],t[u],u,n,t):i;l===i&&(l=t[u]),o?ir(n,u,l):tr(n,u,l)}return n}function Mi(t,e){return function(n,r){var i=Wa(n)?ye:nr,o=e?e():{};return i(n,t,ao(r,2),o)}}function Pi(t){return Yr((function(e,n){var r=-1,o=n.length,a=o>1?n[o-1]:i,s=o>2?n[2]:i;for(a=t.length>3&&"function"==typeof a?(o--,a):i,s&&yo(n[0],n[1],s)&&(a=o<3?i:a,o=1),e=St(e);++r<o;){var u=n[r];u&&t(e,u,r,a)}return e}))}function Ii(t,e){return function(n,r){if(null==n)return n;if(!Xa(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=St(n);(e?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function Oi(t){return function(e,n,r){for(var i=-1,o=St(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}}function Ri(t){return function(e){var n=Je(e=_s(e))?an(e):i,r=n?n[0]:e.charAt(0),o=n?_i(n,1).join(""):e.slice(1);return r[t]()+o}}function Li(t){return function(e){return Te(Js(Vs(e).replace(Vt,"")),t,"")}}function Di(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Zn(t.prototype),r=t.apply(n,e);return es(r)?r:n}}function Ni(t){return function(e,n,r){var o=St(e);if(!Xa(e)){var a=ao(n,3);e=Os(e),n=function(t){return a(o[t],t,o)}}var s=t(e,n,r);return s>-1?o[a?e[s]:s]:i}}function Bi(t){return to((function(e){var n=e.length,r=n,a=Un.prototype.thru;for(t&&e.reverse();r--;){var s=e[r];if("function"!=typeof s)throw new Tt(o);if(a&&!u&&"wrapper"==io(s))var u=new Un([],!0)}for(r=u?r:n;++r<n;){var l=io(s=e[r]),c="wrapper"==l?ro(s):i;u=c&&bo(c[0])&&424==c[1]&&!c[4].length&&1==c[9]?u[io(c[0])].apply(u,c[3]):1==s.length&&bo(s)?u[l]():u.thru(s)}return function(){var t=arguments,r=t[0];if(u&&1==t.length&&Wa(r))return u.plant(r).value();for(var i=0,o=n?e[i].apply(this,t):r;++i<n;)o=e[i].call(this,o);return o}}))}function zi(t,e,n,o,a,s,u,c,h,f){var p=e&l,d=1&e,g=2&e,v=24&e,m=512&e,y=g?i:Di(t);return function i(){for(var l=arguments.length,_=r(l),b=l;b--;)_[b]=arguments[b];if(v)var x=oo(i),w=Ye(_,x);if(o&&(_=Ci(_,o,a,v)),s&&(_=Ai(_,s,u,v)),l-=w,v&&l<f){var E=en(_,x);return Wi(t,e,zi,i.placeholder,n,_,E,c,h,f-l)}var S=d?n:this,C=g?S[t]:t;return l=_.length,c?_=To(_,c):m&&l>1&&_.reverse(),p&&h<l&&(_.length=h),this&&this!==oe&&this instanceof i&&(C=y||Di(C)),C.apply(S,_)}}function Fi(t,e){return function(n,r){return function(t,e,n,r){return _r(t,(function(t,i,o){e(r,n(t),i,o)})),r}(n,t,e(r),{})}}function Zi(t,e){return function(n,r){var o;if(n===i&&r===i)return e;if(n!==i&&(o=n),r!==i){if(o===i)return r;"string"==typeof n||"string"==typeof r?(n=si(n),r=si(r)):(n=ai(n),r=ai(r)),o=t(n,r)}return o}}function ji(t){return to((function(e){return e=Ce(e,Ge(ao())),Yr((function(n){var r=this;return t(e,(function(t){return me(t,r,n)}))}))}))}function Ui(t,e){var n=(e=e===i?" ":si(e)).length;if(n<2)return n?Xr(e,t):e;var r=Xr(e,cn(t/on(e)));return Je(e)?_i(an(r),0,t).join(""):r.slice(0,t)}function Gi(t){return function(e,n,o){return o&&"number"!=typeof o&&yo(e,n,o)&&(n=o=i),e=ds(e),n===i?(n=e,e=0):n=ds(n),function(t,e,n,i){for(var o=-1,a=mn(cn((e-t)/(n||1)),0),s=r(a);a--;)s[i?a:++o]=t,t+=n;return s}(e,n,o=o===i?e<n?1:-1:ds(o),t)}}function Vi(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=ms(e),n=ms(n)),t(e,n)}}function Wi(t,e,n,r,o,a,s,l,c,h){var f=8&e;e|=f?u:64,4&(e&=~(f?64:u))||(e&=-4);var p=[t,e,o,f?a:i,f?s:i,f?i:a,f?i:s,l,c,h],d=n.apply(i,p);return bo(t)&&Mo(d,p),d.placeholder=r,Oo(d,t,e)}function Hi(t){var e=Et[t];return function(t,n){if(t=ms(t),(n=null==n?0:yn(gs(n),292))&&dn(t)){var r=(_s(t)+"e").split("e");return+((r=(_s(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Xi=An&&1/nn(new An([,-0]))[1]==c?function(t){return new An(t)}:lu;function Yi(t){return function(e){var n=fo(e);return n==w?$e(e):n==T?rn(e):function(t,e){return Ce(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function qi(t,e,n,a,c,h,f,p){var d=2&e;if(!d&&"function"!=typeof t)throw new Tt(o);var g=a?a.length:0;if(g||(e&=-97,a=c=i),f=f===i?f:mn(gs(f),0),p=p===i?p:gs(p),g-=c?c.length:0,64&e){var v=a,m=c;a=c=i}var y=d?i:ro(t),_=[t,e,n,a,c,v,m,h,f,p];if(y&&function(t,e){var n=t[1],r=e[1],i=n|r,o=i<131,a=r==l&&8==n||r==l&&256==n&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==n;if(!o&&!a)return t;1&r&&(t[2]=e[2],i|=1&n?0:4);var u=e[3];if(u){var c=t[3];t[3]=c?Ci(c,u,e[4]):u,t[4]=c?en(t[3],s):e[4]}(u=e[5])&&(c=t[5],t[5]=c?Ai(c,u,e[6]):u,t[6]=c?en(t[5],s):e[6]),(u=e[7])&&(t[7]=u),r&l&&(t[8]=null==t[8]?e[8]:yn(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i}(_,y),t=_[0],e=_[1],n=_[2],a=_[3],c=_[4],!(p=_[9]=_[9]===i?d?0:t.length:mn(_[9]-g,0))&&24&e&&(e&=-25),e&&1!=e)b=8==e||16==e?function(t,e,n){var o=Di(t);return function a(){for(var s=arguments.length,u=r(s),l=s,c=oo(a);l--;)u[l]=arguments[l];var h=s<3&&u[0]!==c&&u[s-1]!==c?[]:en(u,c);return(s-=h.length)<n?Wi(t,e,zi,a.placeholder,i,u,h,i,i,n-s):me(this&&this!==oe&&this instanceof a?o:t,this,u)}}(t,e,p):e!=u&&33!=e||c.length?zi.apply(i,_):function(t,e,n,i){var o=1&e,a=Di(t);return function e(){for(var s=-1,u=arguments.length,l=-1,c=i.length,h=r(c+u),f=this&&this!==oe&&this instanceof e?a:t;++l<c;)h[l]=i[l];for(;u--;)h[l++]=arguments[++s];return me(f,o?n:this,h)}}(t,e,n,a);else var b=function(t,e,n){var r=1&e,i=Di(t);return function e(){return(this&&this!==oe&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,n);return Oo((y?Jr:Mo)(b,_),t,e)}function Ki(t,e,n,r){return t===i||ja(t,Pt[n])&&!Rt.call(r,n)?e:t}function Qi(t,e,n,r,o,a){return es(t)&&es(e)&&(a.set(e,t),Zr(t,e,i,Qi,a),a.delete(e)),t}function Ji(t){return os(t)?i:t}function $i(t,e,n,r,o,a){var s=1&n,u=t.length,l=e.length;if(u!=l&&!(s&&l>u))return!1;var c=a.get(t),h=a.get(e);if(c&&h)return c==e&&h==t;var f=-1,p=!0,d=2&n?new Xn:i;for(a.set(t,e),a.set(e,t);++f<u;){var g=t[f],v=e[f];if(r)var m=s?r(v,g,f,e,t,a):r(g,v,f,t,e,a);if(m!==i){if(m)continue;p=!1;break}if(d){if(!Me(e,(function(t,e){if(!We(d,e)&&(g===t||o(g,t,n,r,a)))return d.push(e)}))){p=!1;break}}else if(g!==v&&!o(g,v,n,r,a)){p=!1;break}}return a.delete(t),a.delete(e),p}function to(t){return Io(Co(t,i,Ho),t+"")}function eo(t){return Er(t,Os,co)}function no(t){return Er(t,Rs,ho)}var ro=Mn?function(t){return Mn.get(t)}:lu;function io(t){for(var e=t.name+"",n=Pn[e],r=Rt.call(Pn,e)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e}function oo(t){return(Rt.call(Fn,"placeholder")?Fn:t).placeholder}function ao(){var t=Fn.iteratee||ou;return t=t===ou?Lr:t,arguments.length?t(arguments[0],arguments[1]):t}function so(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function uo(t){for(var e=Os(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Eo(i)]}return e}function lo(t,e){var n=function(t,e){return null==t?i:t[e]}(t,e);return Rr(n)?n:i}var co=fn?function(t){return null==t?[]:(t=St(t),we(fn(t),(function(e){return te.call(t,e)})))}:vu,ho=fn?function(t){for(var e=[];t;)Ae(e,co(t)),t=Ht(t);return e}:vu,fo=Sr;function po(t,e,n){for(var r=-1,i=(e=mi(e,t)).length,o=!1;++r<i;){var a=zo(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&ts(i)&&mo(a,i)&&(Wa(t)||Va(t))}function go(t){return"function"!=typeof t.constructor||wo(t)?{}:Zn(Ht(t))}function vo(t){return Wa(t)||Va(t)||!!(ie&&t&&t[ie])}function mo(t,e){var n=typeof t;return!!(e=null==e?h:e)&&("number"==n||"symbol"!=n&&mt.test(t))&&t>-1&&t%1==0&&t<e}function yo(t,e,n){if(!es(n))return!1;var r=typeof e;return!!("number"==r?Xa(n)&&mo(e,n.length):"string"==r&&e in n)&&ja(n[e],t)}function _o(t,e){if(Wa(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ls(t))||$.test(t)||!J.test(t)||null!=e&&t in St(e)}function bo(t){var e=io(t),n=Fn[e];if("function"!=typeof n||!(e in Gn.prototype))return!1;if(t===n)return!0;var r=ro(n);return!!r&&t===r[0]}(En&&fo(new En(new ArrayBuffer(1)))!=O||Sn&&fo(new Sn)!=w||Cn&&fo(Cn.resolve())!=C||An&&fo(new An)!=T||Tn&&fo(new Tn)!=P)&&(fo=function(t){var e=Sr(t),n=e==S?t.constructor:i,r=n?Fo(n):"";if(r)switch(r){case In:return O;case On:return w;case Rn:return C;case Ln:return T;case Dn:return P}return e});var xo=It?Ja:mu;function wo(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Pt)}function Eo(t){return t==t&&!es(t)}function So(t,e){return function(n){return null!=n&&n[t]===e&&(e!==i||t in St(n))}}function Co(t,e,n){return e=mn(e===i?t.length-1:e,0),function(){for(var i=arguments,o=-1,a=mn(i.length-e,0),s=r(a);++o<a;)s[o]=i[e+o];o=-1;for(var u=r(e+1);++o<e;)u[o]=i[o];return u[e]=n(s),me(t,this,u)}}function Ao(t,e){return e.length<2?t:wr(t,ei(e,0,-1))}function To(t,e){for(var n=t.length,r=yn(e.length,n),o=Ti(t);r--;){var a=e[r];t[r]=mo(a,n)?o[a]:i}return t}function ko(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Mo=Ro(Jr),Po=ze||function(t,e){return oe.setTimeout(t,e)},Io=Ro($r);function Oo(t,e,n){var r=e+"";return Io(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(ot,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return _e(d,(function(n){var r="_."+n[0];e&n[1]&&!Ee(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(at);return e?e[1].split(st):[]}(r),n)))}function Ro(t){var e=0,n=0;return function(){var r=_n(),o=16-(r-n);if(n=r,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(i,arguments)}}function Lo(t,e){var n=-1,r=t.length,o=r-1;for(e=e===i?r:e;++n<e;){var a=Hr(n,o),s=t[a];t[a]=t[n],t[n]=s}return t.length=e,t}var Do,No,Bo=(Do=Da((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(tt,(function(t,n,r,i){e.push(r?i.replace(ct,"$1"):n||t)})),e}),(function(t){return 500===No.size&&No.clear(),t})),No=Do.cache,Do);function zo(t){if("string"==typeof t||ls(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function Fo(t){if(null!=t){try{return Ot.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Zo(t){if(t instanceof Gn)return t.clone();var e=new Un(t.__wrapped__,t.__chain__);return e.__actions__=Ti(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var jo=Yr((function(t,e){return Ya(t)?cr(t,vr(e,1,Ya,!0)):[]})),Uo=Yr((function(t,e){var n=Qo(e);return Ya(n)&&(n=i),Ya(t)?cr(t,vr(e,1,Ya,!0),ao(n,2)):[]})),Go=Yr((function(t,e){var n=Qo(e);return Ya(n)&&(n=i),Ya(t)?cr(t,vr(e,1,Ya,!0),i,n):[]}));function Vo(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:gs(n);return i<0&&(i=mn(r+i,0)),Oe(t,ao(e,3),i)}function Wo(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var o=r-1;return n!==i&&(o=gs(n),o=n<0?mn(r+o,0):yn(o,r-1)),Oe(t,ao(e,3),o,!0)}function Ho(t){return null!=t&&t.length?vr(t,1):[]}function Xo(t){return t&&t.length?t[0]:i}var Yo=Yr((function(t){var e=Ce(t,gi);return e.length&&e[0]===t[0]?kr(e):[]})),qo=Yr((function(t){var e=Qo(t),n=Ce(t,gi);return e===Qo(n)?e=i:n.pop(),n.length&&n[0]===t[0]?kr(n,ao(e,2)):[]})),Ko=Yr((function(t){var e=Qo(t),n=Ce(t,gi);return(e="function"==typeof e?e:i)&&n.pop(),n.length&&n[0]===t[0]?kr(n,i,e):[]}));function Qo(t){var e=null==t?0:t.length;return e?t[e-1]:i}var Jo=Yr($o);function $o(t,e){return t&&t.length&&e&&e.length?Vr(t,e):t}var ta=to((function(t,e){var n=null==t?0:t.length,r=or(t,e);return Wr(t,Ce(e,(function(t){return mo(t,n)?+t:t})).sort(Si)),r}));function ea(t){return null==t?t:wn.call(t)}var na=Yr((function(t){return ui(vr(t,1,Ya,!0))})),ra=Yr((function(t){var e=Qo(t);return Ya(e)&&(e=i),ui(vr(t,1,Ya,!0),ao(e,2))})),ia=Yr((function(t){var e=Qo(t);return e="function"==typeof e?e:i,ui(vr(t,1,Ya,!0),i,e)}));function oa(t){if(!t||!t.length)return[];var e=0;return t=we(t,(function(t){if(Ya(t))return e=mn(t.length,e),!0})),je(e,(function(e){return Ce(t,Be(e))}))}function aa(t,e){if(!t||!t.length)return[];var n=oa(t);return null==e?n:Ce(n,(function(t){return me(e,i,t)}))}var sa=Yr((function(t,e){return Ya(t)?cr(t,e):[]})),ua=Yr((function(t){return pi(we(t,Ya))})),la=Yr((function(t){var e=Qo(t);return Ya(e)&&(e=i),pi(we(t,Ya),ao(e,2))})),ca=Yr((function(t){var e=Qo(t);return e="function"==typeof e?e:i,pi(we(t,Ya),i,e)})),ha=Yr(oa),fa=Yr((function(t){var e=t.length,n=e>1?t[e-1]:i;return n="function"==typeof n?(t.pop(),n):i,aa(t,n)}));function pa(t){var e=Fn(t);return e.__chain__=!0,e}function da(t,e){return e(t)}var ga=to((function(t){var e=t.length,n=e?t[0]:0,r=this.__wrapped__,o=function(e){return or(e,t)};return!(e>1||this.__actions__.length)&&r instanceof Gn&&mo(n)?((r=r.slice(n,+n+(e?1:0))).__actions__.push({func:da,args:[o],thisArg:i}),new Un(r,this.__chain__).thru((function(t){return e&&!t.length&&t.push(i),t}))):this.thru(o)})),va=Mi((function(t,e,n){Rt.call(t,n)?++t[n]:ir(t,n,1)})),ma=Ni(Vo),ya=Ni(Wo);function _a(t,e){return(Wa(t)?_e:hr)(t,ao(e,3))}function ba(t,e){return(Wa(t)?be:fr)(t,ao(e,3))}var xa=Mi((function(t,e,n){Rt.call(t,n)?t[n].push(e):ir(t,n,[e])})),wa=Yr((function(t,e,n){var i=-1,o="function"==typeof e,a=Xa(t)?r(t.length):[];return hr(t,(function(t){a[++i]=o?me(e,t,n):Mr(t,e,n)})),a})),Ea=Mi((function(t,e,n){ir(t,n,e)}));function Sa(t,e){return(Wa(t)?Ce:Br)(t,ao(e,3))}var Ca=Mi((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]})),Aa=Yr((function(t,e){if(null==t)return[];var n=e.length;return n>1&&yo(t,e[0],e[1])?e=[]:n>2&&yo(e[0],e[1],e[2])&&(e=[e[0]]),Ur(t,vr(e,1),[])})),Ta=Pe||function(){return oe.Date.now()};function ka(t,e,n){return e=n?i:e,e=t&&null==e?t.length:e,qi(t,l,i,i,i,i,e)}function Ma(t,e){var n;if("function"!=typeof e)throw new Tt(o);return t=gs(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=i),n}}var Pa=Yr((function(t,e,n){var r=1;if(n.length){var i=en(n,oo(Pa));r|=u}return qi(t,r,e,n,i)})),Ia=Yr((function(t,e,n){var r=3;if(n.length){var i=en(n,oo(Ia));r|=u}return qi(e,r,t,n,i)}));function Oa(t,e,n){var r,a,s,u,l,c,h=0,f=!1,p=!1,d=!0;if("function"!=typeof t)throw new Tt(o);function g(e){var n=r,o=a;return r=a=i,h=e,u=t.apply(o,n)}function v(t){return h=t,l=Po(y,e),f?g(t):u}function m(t){var n=t-c;return c===i||n>=e||n<0||p&&t-h>=s}function y(){var t=Ta();if(m(t))return _(t);l=Po(y,function(t){var n=e-(t-c);return p?yn(n,s-(t-h)):n}(t))}function _(t){return l=i,d&&r?g(t):(r=a=i,u)}function b(){var t=Ta(),n=m(t);if(r=arguments,a=this,c=t,n){if(l===i)return v(c);if(p)return bi(l),l=Po(y,e),g(c)}return l===i&&(l=Po(y,e)),u}return e=ms(e)||0,es(n)&&(f=!!n.leading,s=(p="maxWait"in n)?mn(ms(n.maxWait)||0,e):s,d="trailing"in n?!!n.trailing:d),b.cancel=function(){l!==i&&bi(l),h=0,r=c=a=l=i},b.flush=function(){return l===i?u:_(Ta())},b}var Ra=Yr((function(t,e){return lr(t,1,e)})),La=Yr((function(t,e,n){return lr(t,ms(e)||0,n)}));function Da(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Tt(o);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(Da.Cache||Hn),n}function Na(t){if("function"!=typeof t)throw new Tt(o);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}Da.Cache=Hn;var Ba=yi((function(t,e){var n=(e=1==e.length&&Wa(e[0])?Ce(e[0],Ge(ao())):Ce(vr(e,1),Ge(ao()))).length;return Yr((function(r){for(var i=-1,o=yn(r.length,n);++i<o;)r[i]=e[i].call(this,r[i]);return me(t,this,r)}))})),za=Yr((function(t,e){var n=en(e,oo(za));return qi(t,u,i,e,n)})),Fa=Yr((function(t,e){var n=en(e,oo(Fa));return qi(t,64,i,e,n)})),Za=to((function(t,e){return qi(t,256,i,i,i,e)}));function ja(t,e){return t===e||t!=t&&e!=e}var Ua=Vi(Cr),Ga=Vi((function(t,e){return t>=e})),Va=Pr(function(){return arguments}())?Pr:function(t){return ns(t)&&Rt.call(t,"callee")&&!te.call(t,"callee")},Wa=r.isArray,Ha=he?Ge(he):function(t){return ns(t)&&Sr(t)==I};function Xa(t){return null!=t&&ts(t.length)&&!Ja(t)}function Ya(t){return ns(t)&&Xa(t)}var qa=pn||mu,Ka=fe?Ge(fe):function(t){return ns(t)&&Sr(t)==y};function Qa(t){if(!ns(t))return!1;var e=Sr(t);return e==_||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!os(t)}function Ja(t){if(!es(t))return!1;var e=Sr(t);return e==b||e==x||"[object AsyncFunction]"==e||"[object Proxy]"==e}function $a(t){return"number"==typeof t&&t==gs(t)}function ts(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=h}function es(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ns(t){return null!=t&&"object"==typeof t}var rs=pe?Ge(pe):function(t){return ns(t)&&fo(t)==w};function is(t){return"number"==typeof t||ns(t)&&Sr(t)==E}function os(t){if(!ns(t)||Sr(t)!=S)return!1;var e=Ht(t);if(null===e)return!0;var n=Rt.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Ot.call(n)==Bt}var as=de?Ge(de):function(t){return ns(t)&&Sr(t)==A},ss=ge?Ge(ge):function(t){return ns(t)&&fo(t)==T};function us(t){return"string"==typeof t||!Wa(t)&&ns(t)&&Sr(t)==k}function ls(t){return"symbol"==typeof t||ns(t)&&Sr(t)==M}var cs=ve?Ge(ve):function(t){return ns(t)&&ts(t.length)&&!!Jt[Sr(t)]},hs=Vi(Nr),fs=Vi((function(t,e){return t<=e}));function ps(t){if(!t)return[];if(Xa(t))return us(t)?an(t):Ti(t);if(ae&&t[ae])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[ae]());var e=fo(t);return(e==w?$e:e==T?nn:js)(t)}function ds(t){return t?(t=ms(t))===c||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function gs(t){var e=ds(t),n=e%1;return e==e?n?e-n:e:0}function vs(t){return t?ar(gs(t),0,p):0}function ms(t){if("number"==typeof t)return t;if(ls(t))return f;if(es(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=es(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ue(t);var n=dt.test(t);return n||vt.test(t)?ne(t.slice(2),n?2:8):pt.test(t)?f:+t}function ys(t){return ki(t,Rs(t))}function _s(t){return null==t?"":si(t)}var bs=Pi((function(t,e){if(wo(e)||Xa(e))ki(e,Os(e),t);else for(var n in e)Rt.call(e,n)&&tr(t,n,e[n])})),xs=Pi((function(t,e){ki(e,Rs(e),t)})),ws=Pi((function(t,e,n,r){ki(e,Rs(e),t,r)})),Es=Pi((function(t,e,n,r){ki(e,Os(e),t,r)})),Ss=to(or),Cs=Yr((function(t,e){t=St(t);var n=-1,r=e.length,o=r>2?e[2]:i;for(o&&yo(e[0],e[1],o)&&(r=1);++n<r;)for(var a=e[n],s=Rs(a),u=-1,l=s.length;++u<l;){var c=s[u],h=t[c];(h===i||ja(h,Pt[c])&&!Rt.call(t,c))&&(t[c]=a[c])}return t})),As=Yr((function(t){return t.push(i,Qi),me(Ds,i,t)}));function Ts(t,e,n){var r=null==t?i:wr(t,e);return r===i?n:r}function ks(t,e){return null!=t&&po(t,e,Tr)}var Ms=Fi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Nt.call(e)),t[e]=n}),eu(iu)),Ps=Fi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Nt.call(e)),Rt.call(t,e)?t[e].push(n):t[e]=[n]}),ao),Is=Yr(Mr);function Os(t){return Xa(t)?qn(t):Dr(t)}function Rs(t){return Xa(t)?qn(t,!0):function(t){if(!es(t))return function(t){var e=[];if(null!=t)for(var n in St(t))e.push(n);return e}(t);var e=wo(t),n=[];for(var r in t)("constructor"!=r||!e&&Rt.call(t,r))&&n.push(r);return n}(t)}var Ls=Pi((function(t,e,n){Zr(t,e,n)})),Ds=Pi((function(t,e,n,r){Zr(t,e,n,r)})),Ns=to((function(t,e){var n={};if(null==t)return n;var r=!1;e=Ce(e,(function(e){return e=mi(e,t),r||(r=e.length>1),e})),ki(t,no(t),n),r&&(n=sr(n,7,Ji));for(var i=e.length;i--;)li(n,e[i]);return n})),Bs=to((function(t,e){return null==t?{}:function(t,e){return Gr(t,e,(function(e,n){return ks(t,n)}))}(t,e)}));function zs(t,e){if(null==t)return{};var n=Ce(no(t),(function(t){return[t]}));return e=ao(e),Gr(t,n,(function(t,n){return e(t,n[0])}))}var Fs=Yi(Os),Zs=Yi(Rs);function js(t){return null==t?[]:Ve(t,Os(t))}var Us=Li((function(t,e,n){return e=e.toLowerCase(),t+(n?Gs(e):e)}));function Gs(t){return Qs(_s(t).toLowerCase())}function Vs(t){return(t=_s(t))&&t.replace(yt,qe).replace(Wt,"")}var Ws=Li((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),Hs=Li((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),Xs=Ri("toLowerCase"),Ys=Li((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()})),qs=Li((function(t,e,n){return t+(n?" ":"")+Qs(e)})),Ks=Li((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Qs=Ri("toUpperCase");function Js(t,e,n){return t=_s(t),(e=n?i:e)===i?function(t){return qt.test(t)}(t)?function(t){return t.match(Xt)||[]}(t):function(t){return t.match(ut)||[]}(t):t.match(e)||[]}var $s=Yr((function(t,e){try{return me(t,i,e)}catch(t){return Qa(t)?t:new xt(t)}})),tu=to((function(t,e){return _e(e,(function(e){e=zo(e),ir(t,e,Pa(t[e],t))})),t}));function eu(t){return function(){return t}}var nu=Bi(),ru=Bi(!0);function iu(t){return t}function ou(t){return Lr("function"==typeof t?t:sr(t,1))}var au=Yr((function(t,e){return function(n){return Mr(n,t,e)}})),su=Yr((function(t,e){return function(n){return Mr(t,n,e)}}));function uu(t,e,n){var r=Os(e),i=xr(e,r);null!=n||es(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=xr(e,Os(e)));var o=!(es(n)&&"chain"in n&&!n.chain),a=Ja(t);return _e(i,(function(n){var r=e[n];t[n]=r,a&&(t.prototype[n]=function(){var e=this.__chain__;if(o||e){var n=t(this.__wrapped__),i=n.__actions__=Ti(this.__actions__);return i.push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,Ae([this.value()],arguments))})})),t}function lu(){}var cu=ji(Ce),hu=ji(xe),fu=ji(Me);function pu(t){return _o(t)?Be(zo(t)):function(t){return function(e){return wr(e,t)}}(t)}var du=Gi(),gu=Gi(!0);function vu(){return[]}function mu(){return!1}var yu,_u=Zi((function(t,e){return t+e}),0),bu=Hi("ceil"),xu=Zi((function(t,e){return t/e}),1),wu=Hi("floor"),Eu=Zi((function(t,e){return t*e}),1),Su=Hi("round"),Cu=Zi((function(t,e){return t-e}),0);return Fn.after=function(t,e){if("function"!=typeof e)throw new Tt(o);return t=gs(t),function(){if(--t<1)return e.apply(this,arguments)}},Fn.ary=ka,Fn.assign=bs,Fn.assignIn=xs,Fn.assignInWith=ws,Fn.assignWith=Es,Fn.at=Ss,Fn.before=Ma,Fn.bind=Pa,Fn.bindAll=tu,Fn.bindKey=Ia,Fn.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Wa(t)?t:[t]},Fn.chain=pa,Fn.chunk=function(t,e,n){e=(n?yo(t,e,n):e===i)?1:mn(gs(e),0);var o=null==t?0:t.length;if(!o||e<1)return[];for(var a=0,s=0,u=r(cn(o/e));a<o;)u[s++]=ei(t,a,a+=e);return u},Fn.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o)}return i},Fn.concat=function(){var t=arguments.length;if(!t)return[];for(var e=r(t-1),n=arguments[0],i=t;i--;)e[i-1]=arguments[i];return Ae(Wa(n)?Ti(n):[n],vr(e,1))},Fn.cond=function(t){var e=null==t?0:t.length,n=ao();return t=e?Ce(t,(function(t){if("function"!=typeof t[1])throw new Tt(o);return[n(t[0]),t[1]]})):[],Yr((function(n){for(var r=-1;++r<e;){var i=t[r];if(me(i[0],this,n))return me(i[1],this,n)}}))},Fn.conforms=function(t){return function(t){var e=Os(t);return function(n){return ur(n,t,e)}}(sr(t,1))},Fn.constant=eu,Fn.countBy=va,Fn.create=function(t,e){var n=Zn(t);return null==e?n:rr(n,e)},Fn.curry=function t(e,n,r){var o=qi(e,8,i,i,i,i,i,n=r?i:n);return o.placeholder=t.placeholder,o},Fn.curryRight=function t(e,n,r){var o=qi(e,16,i,i,i,i,i,n=r?i:n);return o.placeholder=t.placeholder,o},Fn.debounce=Oa,Fn.defaults=Cs,Fn.defaultsDeep=As,Fn.defer=Ra,Fn.delay=La,Fn.difference=jo,Fn.differenceBy=Uo,Fn.differenceWith=Go,Fn.drop=function(t,e,n){var r=null==t?0:t.length;return r?ei(t,(e=n||e===i?1:gs(e))<0?0:e,r):[]},Fn.dropRight=function(t,e,n){var r=null==t?0:t.length;return r?ei(t,0,(e=r-(e=n||e===i?1:gs(e)))<0?0:e):[]},Fn.dropRightWhile=function(t,e){return t&&t.length?hi(t,ao(e,3),!0,!0):[]},Fn.dropWhile=function(t,e){return t&&t.length?hi(t,ao(e,3),!0):[]},Fn.fill=function(t,e,n,r){var o=null==t?0:t.length;return o?(n&&"number"!=typeof n&&yo(t,e,n)&&(n=0,r=o),function(t,e,n,r){var o=t.length;for((n=gs(n))<0&&(n=-n>o?0:o+n),(r=r===i||r>o?o:gs(r))<0&&(r+=o),r=n>r?0:vs(r);n<r;)t[n++]=e;return t}(t,e,n,r)):[]},Fn.filter=function(t,e){return(Wa(t)?we:gr)(t,ao(e,3))},Fn.flatMap=function(t,e){return vr(Sa(t,e),1)},Fn.flatMapDeep=function(t,e){return vr(Sa(t,e),c)},Fn.flatMapDepth=function(t,e,n){return n=n===i?1:gs(n),vr(Sa(t,e),n)},Fn.flatten=Ho,Fn.flattenDeep=function(t){return null!=t&&t.length?vr(t,c):[]},Fn.flattenDepth=function(t,e){return null!=t&&t.length?vr(t,e=e===i?1:gs(e)):[]},Fn.flip=function(t){return qi(t,512)},Fn.flow=nu,Fn.flowRight=ru,Fn.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},Fn.functions=function(t){return null==t?[]:xr(t,Os(t))},Fn.functionsIn=function(t){return null==t?[]:xr(t,Rs(t))},Fn.groupBy=xa,Fn.initial=function(t){return null!=t&&t.length?ei(t,0,-1):[]},Fn.intersection=Yo,Fn.intersectionBy=qo,Fn.intersectionWith=Ko,Fn.invert=Ms,Fn.invertBy=Ps,Fn.invokeMap=wa,Fn.iteratee=ou,Fn.keyBy=Ea,Fn.keys=Os,Fn.keysIn=Rs,Fn.map=Sa,Fn.mapKeys=function(t,e){var n={};return e=ao(e,3),_r(t,(function(t,r,i){ir(n,e(t,r,i),t)})),n},Fn.mapValues=function(t,e){var n={};return e=ao(e,3),_r(t,(function(t,r,i){ir(n,r,e(t,r,i))})),n},Fn.matches=function(t){return zr(sr(t,1))},Fn.matchesProperty=function(t,e){return Fr(t,sr(e,1))},Fn.memoize=Da,Fn.merge=Ls,Fn.mergeWith=Ds,Fn.method=au,Fn.methodOf=su,Fn.mixin=uu,Fn.negate=Na,Fn.nthArg=function(t){return t=gs(t),Yr((function(e){return jr(e,t)}))},Fn.omit=Ns,Fn.omitBy=function(t,e){return zs(t,Na(ao(e)))},Fn.once=function(t){return Ma(2,t)},Fn.orderBy=function(t,e,n,r){return null==t?[]:(Wa(e)||(e=null==e?[]:[e]),Wa(n=r?i:n)||(n=null==n?[]:[n]),Ur(t,e,n))},Fn.over=cu,Fn.overArgs=Ba,Fn.overEvery=hu,Fn.overSome=fu,Fn.partial=za,Fn.partialRight=Fa,Fn.partition=Ca,Fn.pick=Bs,Fn.pickBy=zs,Fn.property=pu,Fn.propertyOf=function(t){return function(e){return null==t?i:wr(t,e)}},Fn.pull=Jo,Fn.pullAll=$o,Fn.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?Vr(t,e,ao(n,2)):t},Fn.pullAllWith=function(t,e,n){return t&&t.length&&e&&e.length?Vr(t,e,i,n):t},Fn.pullAt=ta,Fn.range=du,Fn.rangeRight=gu,Fn.rearg=Za,Fn.reject=function(t,e){return(Wa(t)?we:gr)(t,Na(ao(e,3)))},Fn.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;for(e=ao(e,3);++r<o;){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r))}return Wr(t,i),n},Fn.rest=function(t,e){if("function"!=typeof t)throw new Tt(o);return Yr(t,e=e===i?e:gs(e))},Fn.reverse=ea,Fn.sampleSize=function(t,e,n){return e=(n?yo(t,e,n):e===i)?1:gs(e),(Wa(t)?Qn:Kr)(t,e)},Fn.set=function(t,e,n){return null==t?t:Qr(t,e,n)},Fn.setWith=function(t,e,n,r){return r="function"==typeof r?r:i,null==t?t:Qr(t,e,n,r)},Fn.shuffle=function(t){return(Wa(t)?Jn:ti)(t)},Fn.slice=function(t,e,n){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&yo(t,e,n)?(e=0,n=r):(e=null==e?0:gs(e),n=n===i?r:gs(n)),ei(t,e,n)):[]},Fn.sortBy=Aa,Fn.sortedUniq=function(t){return t&&t.length?oi(t):[]},Fn.sortedUniqBy=function(t,e){return t&&t.length?oi(t,ao(e,2)):[]},Fn.split=function(t,e,n){return n&&"number"!=typeof n&&yo(t,e,n)&&(e=n=i),(n=n===i?p:n>>>0)?(t=_s(t))&&("string"==typeof e||null!=e&&!as(e))&&!(e=si(e))&&Je(t)?_i(an(t),0,n):t.split(e,n):[]},Fn.spread=function(t,e){if("function"!=typeof t)throw new Tt(o);return e=null==e?0:mn(gs(e),0),Yr((function(n){var r=n[e],i=_i(n,0,e);return r&&Ae(i,r),me(t,this,i)}))},Fn.tail=function(t){var e=null==t?0:t.length;return e?ei(t,1,e):[]},Fn.take=function(t,e,n){return t&&t.length?ei(t,0,(e=n||e===i?1:gs(e))<0?0:e):[]},Fn.takeRight=function(t,e,n){var r=null==t?0:t.length;return r?ei(t,(e=r-(e=n||e===i?1:gs(e)))<0?0:e,r):[]},Fn.takeRightWhile=function(t,e){return t&&t.length?hi(t,ao(e,3),!1,!0):[]},Fn.takeWhile=function(t,e){return t&&t.length?hi(t,ao(e,3)):[]},Fn.tap=function(t,e){return e(t),t},Fn.throttle=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new Tt(o);return es(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),Oa(t,e,{leading:r,maxWait:e,trailing:i})},Fn.thru=da,Fn.toArray=ps,Fn.toPairs=Fs,Fn.toPairsIn=Zs,Fn.toPath=function(t){return Wa(t)?Ce(t,zo):ls(t)?[t]:Ti(Bo(_s(t)))},Fn.toPlainObject=ys,Fn.transform=function(t,e,n){var r=Wa(t),i=r||qa(t)||cs(t);if(e=ao(e,4),null==n){var o=t&&t.constructor;n=i?r?new o:[]:es(t)&&Ja(o)?Zn(Ht(t)):{}}return(i?_e:_r)(t,(function(t,r,i){return e(n,t,r,i)})),n},Fn.unary=function(t){return ka(t,1)},Fn.union=na,Fn.unionBy=ra,Fn.unionWith=ia,Fn.uniq=function(t){return t&&t.length?ui(t):[]},Fn.uniqBy=function(t,e){return t&&t.length?ui(t,ao(e,2)):[]},Fn.uniqWith=function(t,e){return e="function"==typeof e?e:i,t&&t.length?ui(t,i,e):[]},Fn.unset=function(t,e){return null==t||li(t,e)},Fn.unzip=oa,Fn.unzipWith=aa,Fn.update=function(t,e,n){return null==t?t:ci(t,e,vi(n))},Fn.updateWith=function(t,e,n,r){return r="function"==typeof r?r:i,null==t?t:ci(t,e,vi(n),r)},Fn.values=js,Fn.valuesIn=function(t){return null==t?[]:Ve(t,Rs(t))},Fn.without=sa,Fn.words=Js,Fn.wrap=function(t,e){return za(vi(e),t)},Fn.xor=ua,Fn.xorBy=la,Fn.xorWith=ca,Fn.zip=ha,Fn.zipObject=function(t,e){return di(t||[],e||[],tr)},Fn.zipObjectDeep=function(t,e){return di(t||[],e||[],Qr)},Fn.zipWith=fa,Fn.entries=Fs,Fn.entriesIn=Zs,Fn.extend=xs,Fn.extendWith=ws,uu(Fn,Fn),Fn.add=_u,Fn.attempt=$s,Fn.camelCase=Us,Fn.capitalize=Gs,Fn.ceil=bu,Fn.clamp=function(t,e,n){return n===i&&(n=e,e=i),n!==i&&(n=(n=ms(n))==n?n:0),e!==i&&(e=(e=ms(e))==e?e:0),ar(ms(t),e,n)},Fn.clone=function(t){return sr(t,4)},Fn.cloneDeep=function(t){return sr(t,5)},Fn.cloneDeepWith=function(t,e){return sr(t,5,e="function"==typeof e?e:i)},Fn.cloneWith=function(t,e){return sr(t,4,e="function"==typeof e?e:i)},Fn.conformsTo=function(t,e){return null==e||ur(t,e,Os(e))},Fn.deburr=Vs,Fn.defaultTo=function(t,e){return null==t||t!=t?e:t},Fn.divide=xu,Fn.endsWith=function(t,e,n){t=_s(t),e=si(e);var r=t.length,o=n=n===i?r:ar(gs(n),0,r);return(n-=e.length)>=0&&t.slice(n,o)==e},Fn.eq=ja,Fn.escape=function(t){return(t=_s(t))&&Y.test(t)?t.replace(H,Ke):t},Fn.escapeRegExp=function(t){return(t=_s(t))&&nt.test(t)?t.replace(et,"\\$&"):t},Fn.every=function(t,e,n){var r=Wa(t)?xe:pr;return n&&yo(t,e,n)&&(e=i),r(t,ao(e,3))},Fn.find=ma,Fn.findIndex=Vo,Fn.findKey=function(t,e){return Ie(t,ao(e,3),_r)},Fn.findLast=ya,Fn.findLastIndex=Wo,Fn.findLastKey=function(t,e){return Ie(t,ao(e,3),br)},Fn.floor=wu,Fn.forEach=_a,Fn.forEachRight=ba,Fn.forIn=function(t,e){return null==t?t:mr(t,ao(e,3),Rs)},Fn.forInRight=function(t,e){return null==t?t:yr(t,ao(e,3),Rs)},Fn.forOwn=function(t,e){return t&&_r(t,ao(e,3))},Fn.forOwnRight=function(t,e){return t&&br(t,ao(e,3))},Fn.get=Ts,Fn.gt=Ua,Fn.gte=Ga,Fn.has=function(t,e){return null!=t&&po(t,e,Ar)},Fn.hasIn=ks,Fn.head=Xo,Fn.identity=iu,Fn.includes=function(t,e,n,r){t=Xa(t)?t:js(t),n=n&&!r?gs(n):0;var i=t.length;return n<0&&(n=mn(i+n,0)),us(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Re(t,e,n)>-1},Fn.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:gs(n);return i<0&&(i=mn(r+i,0)),Re(t,e,i)},Fn.inRange=function(t,e,n){return e=ds(e),n===i?(n=e,e=0):n=ds(n),function(t,e,n){return t>=yn(e,n)&&t<mn(e,n)}(t=ms(t),e,n)},Fn.invoke=Is,Fn.isArguments=Va,Fn.isArray=Wa,Fn.isArrayBuffer=Ha,Fn.isArrayLike=Xa,Fn.isArrayLikeObject=Ya,Fn.isBoolean=function(t){return!0===t||!1===t||ns(t)&&Sr(t)==m},Fn.isBuffer=qa,Fn.isDate=Ka,Fn.isElement=function(t){return ns(t)&&1===t.nodeType&&!os(t)},Fn.isEmpty=function(t){if(null==t)return!0;if(Xa(t)&&(Wa(t)||"string"==typeof t||"function"==typeof t.splice||qa(t)||cs(t)||Va(t)))return!t.length;var e=fo(t);if(e==w||e==T)return!t.size;if(wo(t))return!Dr(t).length;for(var n in t)if(Rt.call(t,n))return!1;return!0},Fn.isEqual=function(t,e){return Ir(t,e)},Fn.isEqualWith=function(t,e,n){var r=(n="function"==typeof n?n:i)?n(t,e):i;return r===i?Ir(t,e,i,n):!!r},Fn.isError=Qa,Fn.isFinite=function(t){return"number"==typeof t&&dn(t)},Fn.isFunction=Ja,Fn.isInteger=$a,Fn.isLength=ts,Fn.isMap=rs,Fn.isMatch=function(t,e){return t===e||Or(t,e,uo(e))},Fn.isMatchWith=function(t,e,n){return n="function"==typeof n?n:i,Or(t,e,uo(e),n)},Fn.isNaN=function(t){return is(t)&&t!=+t},Fn.isNative=function(t){if(xo(t))throw new xt("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Rr(t)},Fn.isNil=function(t){return null==t},Fn.isNull=function(t){return null===t},Fn.isNumber=is,Fn.isObject=es,Fn.isObjectLike=ns,Fn.isPlainObject=os,Fn.isRegExp=as,Fn.isSafeInteger=function(t){return $a(t)&&t>=-9007199254740991&&t<=h},Fn.isSet=ss,Fn.isString=us,Fn.isSymbol=ls,Fn.isTypedArray=cs,Fn.isUndefined=function(t){return t===i},Fn.isWeakMap=function(t){return ns(t)&&fo(t)==P},Fn.isWeakSet=function(t){return ns(t)&&"[object WeakSet]"==Sr(t)},Fn.join=function(t,e){return null==t?"":gn.call(t,e)},Fn.kebabCase=Ws,Fn.last=Qo,Fn.lastIndexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var o=r;return n!==i&&(o=(o=gs(n))<0?mn(r+o,0):yn(o,r-1)),e==e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,o):Oe(t,De,o,!0)},Fn.lowerCase=Hs,Fn.lowerFirst=Xs,Fn.lt=hs,Fn.lte=fs,Fn.max=function(t){return t&&t.length?dr(t,iu,Cr):i},Fn.maxBy=function(t,e){return t&&t.length?dr(t,ao(e,2),Cr):i},Fn.mean=function(t){return Ne(t,iu)},Fn.meanBy=function(t,e){return Ne(t,ao(e,2))},Fn.min=function(t){return t&&t.length?dr(t,iu,Nr):i},Fn.minBy=function(t,e){return t&&t.length?dr(t,ao(e,2),Nr):i},Fn.stubArray=vu,Fn.stubFalse=mu,Fn.stubObject=function(){return{}},Fn.stubString=function(){return""},Fn.stubTrue=function(){return!0},Fn.multiply=Eu,Fn.nth=function(t,e){return t&&t.length?jr(t,gs(e)):i},Fn.noConflict=function(){return oe._===this&&(oe._=zt),this},Fn.noop=lu,Fn.now=Ta,Fn.pad=function(t,e,n){t=_s(t);var r=(e=gs(e))?on(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Ui(hn(i),n)+t+Ui(cn(i),n)},Fn.padEnd=function(t,e,n){t=_s(t);var r=(e=gs(e))?on(t):0;return e&&r<e?t+Ui(e-r,n):t},Fn.padStart=function(t,e,n){t=_s(t);var r=(e=gs(e))?on(t):0;return e&&r<e?Ui(e-r,n)+t:t},Fn.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),bn(_s(t).replace(rt,""),e||0)},Fn.random=function(t,e,n){if(n&&"boolean"!=typeof n&&yo(t,e,n)&&(e=n=i),n===i&&("boolean"==typeof e?(n=e,e=i):"boolean"==typeof t&&(n=t,t=i)),t===i&&e===i?(t=0,e=1):(t=ds(t),e===i?(e=t,t=0):e=ds(e)),t>e){var r=t;t=e,e=r}if(n||t%1||e%1){var o=xn();return yn(t+o*(e-t+ee("1e-"+((o+"").length-1))),e)}return Hr(t,e)},Fn.reduce=function(t,e,n){var r=Wa(t)?Te:Fe,i=arguments.length<3;return r(t,ao(e,4),n,i,hr)},Fn.reduceRight=function(t,e,n){var r=Wa(t)?ke:Fe,i=arguments.length<3;return r(t,ao(e,4),n,i,fr)},Fn.repeat=function(t,e,n){return e=(n?yo(t,e,n):e===i)?1:gs(e),Xr(_s(t),e)},Fn.replace=function(){var t=arguments,e=_s(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Fn.result=function(t,e,n){var r=-1,o=(e=mi(e,t)).length;for(o||(o=1,t=i);++r<o;){var a=null==t?i:t[zo(e[r])];a===i&&(r=o,a=n),t=Ja(a)?a.call(t):a}return t},Fn.round=Su,Fn.runInContext=t,Fn.sample=function(t){return(Wa(t)?Kn:qr)(t)},Fn.size=function(t){if(null==t)return 0;if(Xa(t))return us(t)?on(t):t.length;var e=fo(t);return e==w||e==T?t.size:Dr(t).length},Fn.snakeCase=Ys,Fn.some=function(t,e,n){var r=Wa(t)?Me:ni;return n&&yo(t,e,n)&&(e=i),r(t,ao(e,3))},Fn.sortedIndex=function(t,e){return ri(t,e)},Fn.sortedIndexBy=function(t,e,n){return ii(t,e,ao(n,2))},Fn.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=ri(t,e);if(r<n&&ja(t[r],e))return r}return-1},Fn.sortedLastIndex=function(t,e){return ri(t,e,!0)},Fn.sortedLastIndexBy=function(t,e,n){return ii(t,e,ao(n,2),!0)},Fn.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var n=ri(t,e,!0)-1;if(ja(t[n],e))return n}return-1},Fn.startCase=qs,Fn.startsWith=function(t,e,n){return t=_s(t),n=null==n?0:ar(gs(n),0,t.length),e=si(e),t.slice(n,n+e.length)==e},Fn.subtract=Cu,Fn.sum=function(t){return t&&t.length?Ze(t,iu):0},Fn.sumBy=function(t,e){return t&&t.length?Ze(t,ao(e,2)):0},Fn.template=function(t,e,n){var r=Fn.templateSettings;n&&yo(t,e,n)&&(e=i),t=_s(t),e=ws({},e,r,Ki);var o,a,s=ws({},e.imports,r.imports,Ki),u=Os(s),l=Ve(s,u),c=0,h=e.interpolate||_t,f="__p += '",p=Ct((e.escape||_t).source+"|"+h.source+"|"+(h===Q?ht:_t).source+"|"+(e.evaluate||_t).source+"|$","g"),d="//# sourceURL="+(Rt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Qt+"]")+"\n";t.replace(p,(function(e,n,r,i,s,u){return r||(r=i),f+=t.slice(c,u).replace(bt,Qe),n&&(o=!0,f+="' +\n__e("+n+") +\n'"),s&&(a=!0,f+="';\n"+s+";\n__p += '"),r&&(f+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=u+e.length,e})),f+="';\n";var g=Rt.call(e,"variable")&&e.variable;if(g){if(lt.test(g))throw new xt("Invalid `variable` option passed into `_.template`")}else f="with (obj) {\n"+f+"\n}\n";f=(a?f.replace(U,""):f).replace(G,"$1").replace(V,"$1;"),f="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var v=$s((function(){return wt(u,d+"return "+f).apply(i,l)}));if(v.source=f,Qa(v))throw v;return v},Fn.times=function(t,e){if((t=gs(t))<1||t>h)return[];var n=p,r=yn(t,p);e=ao(e),t-=p;for(var i=je(r,e);++n<t;)e(n);return i},Fn.toFinite=ds,Fn.toInteger=gs,Fn.toLength=vs,Fn.toLower=function(t){return _s(t).toLowerCase()},Fn.toNumber=ms,Fn.toSafeInteger=function(t){return t?ar(gs(t),-9007199254740991,h):0===t?t:0},Fn.toString=_s,Fn.toUpper=function(t){return _s(t).toUpperCase()},Fn.trim=function(t,e,n){if((t=_s(t))&&(n||e===i))return Ue(t);if(!t||!(e=si(e)))return t;var r=an(t),o=an(e);return _i(r,He(r,o),Xe(r,o)+1).join("")},Fn.trimEnd=function(t,e,n){if((t=_s(t))&&(n||e===i))return t.slice(0,sn(t)+1);if(!t||!(e=si(e)))return t;var r=an(t);return _i(r,0,Xe(r,an(e))+1).join("")},Fn.trimStart=function(t,e,n){if((t=_s(t))&&(n||e===i))return t.replace(rt,"");if(!t||!(e=si(e)))return t;var r=an(t);return _i(r,He(r,an(e))).join("")},Fn.truncate=function(t,e){var n=30,r="...";if(es(e)){var o="separator"in e?e.separator:o;n="length"in e?gs(e.length):n,r="omission"in e?si(e.omission):r}var a=(t=_s(t)).length;if(Je(t)){var s=an(t);a=s.length}if(n>=a)return t;var u=n-on(r);if(u<1)return r;var l=s?_i(s,0,u).join(""):t.slice(0,u);if(o===i)return l+r;if(s&&(u+=l.length-u),as(o)){if(t.slice(u).search(o)){var c,h=l;for(o.global||(o=Ct(o.source,_s(ft.exec(o))+"g")),o.lastIndex=0;c=o.exec(h);)var f=c.index;l=l.slice(0,f===i?u:f)}}else if(t.indexOf(si(o),u)!=u){var p=l.lastIndexOf(o);p>-1&&(l=l.slice(0,p))}return l+r},Fn.unescape=function(t){return(t=_s(t))&&X.test(t)?t.replace(W,un):t},Fn.uniqueId=function(t){var e=++Lt;return _s(t)+e},Fn.upperCase=Ks,Fn.upperFirst=Qs,Fn.each=_a,Fn.eachRight=ba,Fn.first=Xo,uu(Fn,(yu={},_r(Fn,(function(t,e){Rt.call(Fn.prototype,e)||(yu[e]=t)})),yu),{chain:!1}),Fn.VERSION="4.17.21",_e(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Fn[t].placeholder=Fn})),_e(["drop","take"],(function(t,e){Gn.prototype[t]=function(n){n=n===i?1:mn(gs(n),0);var r=this.__filtered__&&!e?new Gn(this):this.clone();return r.__filtered__?r.__takeCount__=yn(n,r.__takeCount__):r.__views__.push({size:yn(n,p),type:t+(r.__dir__<0?"Right":"")}),r},Gn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),_e(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Gn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:ao(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),_e(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Gn.prototype[t]=function(){return this[n](1).value()[0]}})),_e(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Gn.prototype[t]=function(){return this.__filtered__?new Gn(this):this[n](1)}})),Gn.prototype.compact=function(){return this.filter(iu)},Gn.prototype.find=function(t){return this.filter(t).head()},Gn.prototype.findLast=function(t){return this.reverse().find(t)},Gn.prototype.invokeMap=Yr((function(t,e){return"function"==typeof t?new Gn(this):this.map((function(n){return Mr(n,t,e)}))})),Gn.prototype.reject=function(t){return this.filter(Na(ao(t)))},Gn.prototype.slice=function(t,e){t=gs(t);var n=this;return n.__filtered__&&(t>0||e<0)?new Gn(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==i&&(n=(e=gs(e))<0?n.dropRight(-e):n.take(e-t)),n)},Gn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Gn.prototype.toArray=function(){return this.take(p)},_r(Gn.prototype,(function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),r=/^(?:head|last)$/.test(e),o=Fn[r?"take"+("last"==e?"Right":""):e],a=r||/^find/.test(e);o&&(Fn.prototype[e]=function(){var e=this.__wrapped__,s=r?[1]:arguments,u=e instanceof Gn,l=s[0],c=u||Wa(e),h=function(t){var e=o.apply(Fn,Ae([t],s));return r&&f?e[0]:e};c&&n&&"function"==typeof l&&1!=l.length&&(u=c=!1);var f=this.__chain__,p=!!this.__actions__.length,d=a&&!f,g=u&&!p;if(!a&&c){e=g?e:new Gn(this);var v=t.apply(e,s);return v.__actions__.push({func:da,args:[h],thisArg:i}),new Un(v,f)}return d&&g?t.apply(this,s):(v=this.thru(h),d?r?v.value()[0]:v.value():v)})})),_e(["pop","push","shift","sort","splice","unshift"],(function(t){var e=kt[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Fn.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Wa(i)?i:[],t)}return this[n]((function(n){return e.apply(Wa(n)?n:[],t)}))}})),_r(Gn.prototype,(function(t,e){var n=Fn[e];if(n){var r=n.name+"";Rt.call(Pn,r)||(Pn[r]=[]),Pn[r].push({name:e,func:n})}})),Pn[zi(i,2).name]=[{name:"wrapper",func:i}],Gn.prototype.clone=function(){var t=new Gn(this.__wrapped__);return t.__actions__=Ti(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ti(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ti(this.__views__),t},Gn.prototype.reverse=function(){if(this.__filtered__){var t=new Gn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Gn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Wa(t),r=e<0,i=n?t.length:0,o=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=yn(e,t+a);break;case"takeRight":t=mn(t,e-a)}}return{start:t,end:e}}(0,i,this.__views__),a=o.start,s=o.end,u=s-a,l=r?s:a-1,c=this.__iteratees__,h=c.length,f=0,p=yn(u,this.__takeCount__);if(!n||!r&&i==u&&p==u)return fi(t,this.__actions__);var d=[];t:for(;u--&&f<p;){for(var g=-1,v=t[l+=e];++g<h;){var m=c[g],y=m.iteratee,_=m.type,b=y(v);if(2==_)v=b;else if(!b){if(1==_)continue t;break t}}d[f++]=v}return d},Fn.prototype.at=ga,Fn.prototype.chain=function(){return pa(this)},Fn.prototype.commit=function(){return new Un(this.value(),this.__chain__)},Fn.prototype.next=function(){this.__values__===i&&(this.__values__=ps(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?i:this.__values__[this.__index__++]}},Fn.prototype.plant=function(t){for(var e,n=this;n instanceof jn;){var r=Zo(n);r.__index__=0,r.__values__=i,e?o.__wrapped__=r:e=r;var o=r;n=n.__wrapped__}return o.__wrapped__=t,e},Fn.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Gn){var e=t;return this.__actions__.length&&(e=new Gn(this)),(e=e.reverse()).__actions__.push({func:da,args:[ea],thisArg:i}),new Un(e,this.__chain__)}return this.thru(ea)},Fn.prototype.toJSON=Fn.prototype.valueOf=Fn.prototype.value=function(){return fi(this.__wrapped__,this.__actions__)},Fn.prototype.first=Fn.prototype.head,ae&&(Fn.prototype[ae]=function(){return this}),Fn}();oe._=ln,(r=function(){return ln}.call(e,n,e,t))===i||(t.exports=r)}.call(this)},2492:(t,e,n)=>{var r=n(2980),i=n(1463)((function(t,e,n){r(t,e,n)}));t.exports=i},236:(t,e,n)=>{var r=n(2980),i=n(1463)((function(t,e,n,i){r(t,e,n,i)}));t.exports=i},308:t=>{t.exports=function(){}},7771:(t,e,n)=>{var r=n(5639);t.exports=function(){return r.Date.now()}},479:t=>{t.exports=function(){return[]}},5062:t=>{t.exports=function(){return!1}},3493:(t,e,n)=>{var r=n(3279),i=n(3218);t.exports=function(t,e,n){var o=!0,a=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return i(n)&&(o="leading"in n?!!n.leading:o,a="trailing"in n?!!n.trailing:a),r(t,e,{leading:o,maxWait:e,trailing:a})}},4841:(t,e,n)=>{var r=n(7561),i=n(3218),o=n(3448),a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,u=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(o(t))return NaN;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=r(t);var n=s.test(t);return n||u.test(t)?l(t.slice(2),n?2:8):a.test(t)?NaN:+t}},9881:(t,e,n)=>{var r=n(8363),i=n(1704);t.exports=function(t){return r(t,i(t))}},9833:(t,e,n)=>{var r=n(531);t.exports=function(t){return null==t?"":r(t)}},4908:(t,e,n)=>{var r=n(5652);t.exports=function(t){return t&&t.length?r(t):[]}},1700:(t,e,n)=>{var r=n(8882)("toUpperCase");t.exports=r},8748:(t,e,n)=>{var r=n(9029),i=n(3157),o=n(9833),a=n(2757);t.exports=function(t,e,n){return t=o(t),void 0===(e=n?void 0:e)?i(t)?a(t):r(t):t.match(e)||[]}},6158:function(t){t.exports=function(){"use strict";var t,e,n;function r(r,i){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",a={};t(a),n=i(a),"undefined"!=typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=i;else t=i}return r(0,(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n=r;function r(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}r.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},r.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},r.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},r.prototype.solveCurveX=function(t,e){var n,r,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},r.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var i=o;function o(t,e){this.x=t,this.y=e}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-r*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};var a="undefined"!=typeof self?self:{},s=Math.pow(2,53)-1;function u(t,e,r,i){var o=new n(t,e,r,i);return function(t){return o.solve(t)}}var l=u(.25,.1,.25,1);function c(t,e,n){return Math.min(n,Math.max(e,t))}function h(t,e,n){var r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function f(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=0,i=e;r<i.length;r+=1){var o=i[r];for(var a in o)t[a]=o[a]}return t}var p=1;function d(){return p++}function g(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function v(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function m(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}function y(t,e){return-1!==t.indexOf(e,t.length-e.length)}function _(t,e,n){var r={};for(var i in t)r[i]=e.call(n||this,t[i],i,t);return r}function b(t,e,n){var r={};for(var i in t)e.call(n||this,t[i],i,t)&&(r[i]=t[i]);return r}function x(t){return Array.isArray(t)?t.map(x):"object"==typeof t&&t?_(t,x):t}var w={};function E(t){w[t]||("undefined"!=typeof console&&console.warn(t),w[t]=!0)}function S(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function C(t){for(var e=0,n=0,r=t.length,i=r-1,o=void 0,a=void 0;n<r;i=n++)e+=((a=t[i]).x-(o=t[n]).x)*(o.y+a.y);return e}function A(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function T(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,n,r,i){var o=r||i;return e[n]=!o||o.toLowerCase(),""})),e["max-age"]){var n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}var k=null;function M(t){if(null==k){var e=t.navigator?t.navigator.userAgent:null;k=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return k}function P(t){try{var e=a[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var I,O,R,L,D=a.performance&&a.performance.now?a.performance.now.bind(a.performance):Date.now.bind(Date),N=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,B=a.cancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelAnimationFrame||a.msCancelAnimationFrame,z={now:D,frame:function(t){var e=N(t);return{cancel:function(){return B(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var n=a.document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return n.width=t.width,n.height=t.height,r.drawImage(t,0,0,t.width,t.height),r.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return I||(I=a.document.createElement("a")),I.href=t,I.href},hardwareConcurrency:a.navigator&&a.navigator.hardwareConcurrency||4,get devicePixelRatio(){return a.devicePixelRatio},get prefersReducedMotion(){return!!a.matchMedia&&(null==O&&(O=a.matchMedia("(prefers-reduced-motion: reduce)")),O.matches)}},F={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Z={supported:!1,testSupport:function(t){!j&&L&&(U?G(t):R=t)}},j=!1,U=!1;function G(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,L),t.isContextLost())return;Z.supported=!0}catch(t){}t.deleteTexture(e),j=!0}a.document&&((L=a.document.createElement("img")).onload=function(){R&&G(R),R=null,U=!0},L.onerror=function(){j=!0,R=null},L.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var V="01",W=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function H(t){return 0===t.indexOf("mapbox:")}W.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",V,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},W.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},W.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},W.prototype.normalizeStyleURL=function(t,e){if(!H(t))return t;var n=K(t);return n.path="/styles/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeGlyphsURL=function(t,e){if(!H(t))return t;var n=K(t);return n.path="/fonts/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeSourceURL=function(t,e){if(!H(t))return t;var n=K(t);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeSpriteURL=function(t,e,n,r){var i=K(t);return H(t)?(i.path="/styles/v1"+i.path+"/sprite"+e+n,this._makeAPIURL(i,this._customAccessToken||r)):(i.path+=""+e+n,Q(i))},W.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!H(t))return t;var n=K(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,(z.devicePixelRatio>=2||512===e?"@2x":"")+(Z.supported?".webp":"$1")),n.path=n.path.replace(/^.+\/v4\//,"/"),n.path="/v4"+n.path;var r=this._customAccessToken||function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e].match(/^access_token=(.*)$/);if(r)return r[1]}return null}(n.params)||F.ACCESS_TOKEN;return F.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&n.params.push("sku="+this._skuToken),this._makeAPIURL(n,r)},W.prototype.canonicalizeTileURL=function(t,e){var n=K(t);if(!n.path.match(/(^\/v4\/)/)||!n.path.match(/\.[\w]+$/))return t;var r="mapbox://tiles/";r+=n.path.replace("/v4/","");var i=n.params;return e&&(i=i.filter((function(t){return!t.match(/^access_token=/)}))),i.length&&(r+="?"+i.join("&")),r},W.prototype.canonicalizeTileset=function(t,e){for(var n=!!e&&H(e),r=[],i=0,o=t.tiles||[];i<o.length;i+=1){var a=o[i];Y(a)?r.push(this.canonicalizeTileURL(a,n)):r.push(a)}return r},W.prototype._makeAPIURL=function(t,e){var n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=K(F.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){var i=t.params.indexOf("secure");i>=0&&t.params.splice(i,1)}if("/"!==r.path&&(t.path=""+r.path+t.path),!F.REQUIRE_ACCESS_TOKEN)return Q(t);if(!(e=e||F.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+n);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+n);return t.params=t.params.filter((function(t){return-1===t.indexOf("access_token")})),t.params.push("access_token="+e),Q(t)};var X=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Y(t){return X.test(t)}var q=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function K(t){var e=t.match(q);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Q(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function J(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(a.atob(e[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return null}}var $=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};$.prototype.getStorageKey=function(t){var e,n=J(F.ACCESS_TOKEN);return e=n&&n.u?a.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))}))):F.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},$.prototype.fetchEventData=function(){var t=P("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{var r=a.localStorage.getItem(e);r&&(this.eventData=JSON.parse(r));var i=a.localStorage.getItem(n);i&&(this.anonId=i)}catch(t){E("Unable to read from LocalStorage")}},$.prototype.saveEventData=function(){var t=P("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{a.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&a.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){E("Unable to write to LocalStorage")}},$.prototype.processRequests=function(t){},$.prototype.postEvent=function(t,e,n,r){var i=this;if(F.EVENTS_URL){var o=K(F.EVENTS_URL);o.params.push("access_token="+(r||F.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:V,userId:this.anonId},s=e?f(a,e):a,u={url:Q(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=xt(u,(function(t){i.pendingRequest=null,n(t),i.saveEventData(),i.processRequests(r)}))}},$.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var tt,et,nt=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,n,r){this.skuToken=n,(F.EVENTS_URL&&r||F.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return H(t)||Y(t)})))&&this.queueRequest({id:e,timestamp:Date.now()},r)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var n=this.queue.shift(),r=n.id,i=n.timestamp;r&&this.success[r]||(this.anonId||this.fetchEventData(),v(this.anonId)||(this.anonId=g()),this.postEvent(i,{skuToken:this.skuToken},(function(t){t||r&&(e.success[r]=!0)}),t))}},e}($),rt=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t,e){F.EVENTS_URL&&F.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return H(t)||Y(t)}))&&this.queueRequest(Date.now(),e)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var n=J(F.ACCESS_TOKEN),r=n?n.u:F.ACCESS_TOKEN,i=r!==this.eventData.tokenU;v(this.anonId)||(this.anonId=g(),i=!0);var o=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),s=new Date(o),u=(o-this.eventData.lastSuccess)/864e5;i=i||u>=1||u<-1||a.getDate()!==s.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(o,{"enabled.telemetry":!1},(function(t){t||(e.eventData.lastSuccess=o,e.eventData.tokenU=r)}),t)}},e}($)),it=rt.postTurnstileEvent.bind(rt),ot=new nt,at=ot.postMapLoadEvent.bind(ot),st=500,ut=50;function lt(){a.caches&&!tt&&(tt=a.caches.open("mapbox-tiles"))}function ct(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var ht,ft=1/0;function pt(){return null==ht&&(ht=a.OffscreenCanvas&&new a.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof a.createImageBitmap),ht}var dt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(dt);var gt,vt,mt=function(t){function e(e,n,r){401===n&&Y(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=n,this.url=r,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),yt=A()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===a.location.protocol?a.parent:a).location.href},_t=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(yt())&&!/^\w+:/.test(n))){if(a.fetch&&a.Request&&a.AbortController&&a.Request.prototype.hasOwnProperty("signal"))return function(t,e){var n,r=new a.AbortController,i=new a.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:yt(),signal:r.signal}),o=!1,s=!1,u=(n=i.url).indexOf("sku=")>0&&Y(n);"json"===t.type&&i.headers.set("Accept","application/json");var l=function(n,r,o){if(!s){if(n&&"SecurityError"!==n.message&&E(n),r&&o)return c(r);var l=Date.now();a.fetch(i).then((function(n){if(n.ok){var r=u?n.clone():null;return c(n,r,l)}return e(new mt(n.statusText,n.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))}))}},c=function(n,r,u){("arrayBuffer"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text()).then((function(t){s||(r&&u&&function(t,e,n){if(lt(),tt){var r={status:e.status,statusText:e.statusText,headers:new a.Headers};e.headers.forEach((function(t,e){return r.headers.set(e,t)}));var i=T(e.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&r.headers.set("Expires",new Date(n+1e3*i["max-age"]).toUTCString()),new Date(r.headers.get("Expires")).getTime()-n<42e4||function(t,e){if(void 0===et)try{new Response(new ReadableStream),et=!0}catch(t){et=!1}et?e(t.body):t.blob().then(e)}(e,(function(e){var n=new a.Response(e,r);lt(),tt&&tt.then((function(e){return e.put(ct(t.url),n)})).catch((function(t){return E(t.message)}))})))}}(i,r,u),o=!0,e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((function(t){s||e(new Error(t.message))}))};return u?function(t,e){if(lt(),!tt)return e(null);var n=ct(t.url);tt.then((function(t){t.match(n).then((function(r){var i=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),n=T(t.headers.get("Cache-Control")||"");return e>Date.now()&&!n["no-cache"]}(r);t.delete(n),i&&t.put(n,r.clone()),e(null,r,i)})).catch(e)})).catch(e)}(i,l):l(null,null),{cancel:function(){s=!0,o||r.abort()}}}(t,e);if(A()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(t,e){var n=new a.XMLHttpRequest;for(var r in n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)n.setRequestHeader(r,t.headers[r]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var r=n.response;if("json"===t.type)try{r=JSON.parse(n.response)}catch(t){return e(t)}e(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else e(new mt(n.statusText,n.status,t.url))},n.send(t.body),{cancel:function(){return n.abort()}}}(t,e)},bt=function(t,e){return _t(f(t,{type:"arrayBuffer"}),e)},xt=function(t,e){return _t(f(t,{method:"POST"}),e)},wt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";gt=[],vt=0;var Et=function(t,e){if(Z.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),vt>=F.MAX_PARALLEL_IMAGE_REQUESTS){var n={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return gt.push(n),n}vt++;var r=!1,i=function(){if(!r)for(r=!0,vt--;gt.length&&vt<F.MAX_PARALLEL_IMAGE_REQUESTS;){var t=gt.shift();t.cancelled||(t.cancel=Et(t.requestParameters,t.callback).cancel)}},o=bt(t,(function(t,n,r,o){i(),t?e(t):n&&(pt()?function(t,e){var n=new a.Blob([new Uint8Array(t)],{type:"image/png"});a.createImageBitmap(n).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of "+t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))}(n,e):function(t,e,n,r){var i=new a.Image,o=a.URL;i.onload=function(){e(null,i),o.revokeObjectURL(i.src),i.onload=null,a.requestAnimationFrame((function(){i.src=wt}))},i.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var s=new a.Blob([new Uint8Array(t)],{type:"image/png"});i.cacheControl=n,i.expires=r,i.src=t.byteLength?o.createObjectURL(s):wt}(n,e,r,o))}));return{cancel:function(){o.cancel(),i()}}};function St(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Ct(t,e,n){if(n&&n[t]){var r=n[t].indexOf(e);-1!==r&&n[t].splice(r,1)}}var At=function(t,e){void 0===e&&(e={}),f(this,e),this.type=t},Tt=function(t){function e(e,n){void 0===n&&(n={}),t.call(this,"error",f({error:e},n))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(At),kt=function(){};kt.prototype.on=function(t,e){return this._listeners=this._listeners||{},St(t,e,this._listeners),this},kt.prototype.off=function(t,e){return Ct(t,e,this._listeners),Ct(t,e,this._oneTimeListeners),this},kt.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},St(t,e,this._oneTimeListeners),this},kt.prototype.fire=function(t,e){"string"==typeof t&&(t=new At(t,e||{}));var n=t.type;if(this.listens(n)){t.target=this;for(var r=0,i=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];r<i.length;r+=1)i[r].call(this,t);for(var o=0,a=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];o<a.length;o+=1){var s=a[o];Ct(n,s,this._oneTimeListeners),s.call(this,t)}var u=this._eventedParent;u&&(f(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}else t instanceof Tt&&console.error(t.error);return this},kt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},kt.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var Mt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Pt=function(t,e,n,r){this.message=(t?t+": ":"")+n,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)};function It(t){var e=t.value;return e?[new Pt(t.key,e,"constants have been deprecated as of v8")]:[]}function Ot(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=0,i=e;r<i.length;r+=1){var o=i[r];for(var a in o)t[a]=o[a]}return t}function Rt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Lt(t){if(Array.isArray(t))return t.map(Lt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var n in t)e[n]=Lt(t[n]);return e}return Rt(t)}var Dt=function(t){function e(e,n){t.call(this,n),this.message=n,this.key=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),Nt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var n=0,r=e;n<r.length;n+=1){var i=r[n];this.bindings[i[0]]=i[1]}};Nt.prototype.concat=function(t){return new Nt(this,t)},Nt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Nt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Bt={kind:"null"},zt={kind:"number"},Ft={kind:"string"},Zt={kind:"boolean"},jt={kind:"color"},Ut={kind:"object"},Gt={kind:"value"},Vt={kind:"collator"},Wt={kind:"formatted"},Ht={kind:"resolvedImage"};function Xt(t,e){return{kind:"array",itemType:t,N:e}}function Yt(t){if("array"===t.kind){var e=Yt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var qt=[Bt,zt,Ft,Zt,jt,Wt,Ut,Xt(Gt),Ht];function Kt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Kt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var n=0,r=qt;n<r.length;n+=1)if(!Kt(r[n],e))return null}return"Expected "+Yt(t)+" but found "+Yt(e)+" instead."}function Qt(t,e){return e.some((function(e){return e.kind===t.kind}))}function Jt(t,e){return e.some((function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t}))}var $t=e((function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return r("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function a(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in n)return n[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=s.indexOf("("),l=s.indexOf(")");if(-1!==u&&l+1===s.length){var c=s.substr(0,u),h=s.substr(u+1,l-(u+1)).split(","),f=1;switch(c){case"rgba":if(4!==h.length)return null;f=o(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),f];case"hsla":if(4!==h.length)return null;f=o(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,d=o(h[1]),g=o(h[2]),v=g<=.5?g*(d+1):g+d-g*d,m=2*g-v;return[r(255*a(m,v,p+1/3)),r(255*a(m,v,p)),r(255*a(m,v,p-1/3)),f];default:return null}}return null}}catch(t){}})).parseCSSColor,te=function(t,e,n,r){void 0===r&&(r=1),this.r=t,this.g=e,this.b=n,this.a=r};te.parse=function(t){if(t){if(t instanceof te)return t;if("string"==typeof t){var e=$t(t);if(e)return new te(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},te.prototype.toString=function(){var t=this.toArray(),e=t[1],n=t[2],r=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(n)+","+r+")"},te.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},te.black=new te(0,0,0,1),te.white=new te(1,1,1,1),te.transparent=new te(0,0,0,0),te.red=new te(1,0,0,1);var ee=function(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ee.prototype.compare=function(t,e){return this.collator.compare(t,e)},ee.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ne=function(t,e,n,r,i){this.text=t,this.image=e,this.scale=n,this.fontStack=r,this.textColor=i},re=function(t){this.sections=t};re.fromString=function(t){return new re([new ne(t,null,null,null,null)])},re.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},re.factory=function(t){return t instanceof re?t:re.fromString(t)},re.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},re.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var r=n[e];if(r.image)t.push(["image",r.image.name]);else{t.push(r.text);var i={};r.fontStack&&(i["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(i["font-scale"]=r.scale),r.textColor&&(i["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(i)}}return t};var ie=function(t){this.name=t.name,this.available=t.available};function oe(t,e,n,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid rgba value ["+[t,e,n,r].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof r?[t,e,n,r]:[t,e,n]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ae(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof te)return!0;if(t instanceof ee)return!0;if(t instanceof re)return!0;if(t instanceof ie)return!0;if(Array.isArray(t)){for(var e=0,n=t;e<n.length;e+=1)if(!ae(n[e]))return!1;return!0}if("object"==typeof t){for(var r in t)if(!ae(t[r]))return!1;return!0}return!1}function se(t){if(null===t)return Bt;if("string"==typeof t)return Ft;if("boolean"==typeof t)return Zt;if("number"==typeof t)return zt;if(t instanceof te)return jt;if(t instanceof ee)return Vt;if(t instanceof re)return Wt;if(t instanceof ie)return Ht;if(Array.isArray(t)){for(var e,n=t.length,r=0,i=t;r<i.length;r+=1){var o=se(i[r]);if(e){if(e===o)continue;e=Gt;break}e=o}return Xt(e||Gt,n)}return Ut}function ue(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof te||t instanceof re||t instanceof ie?t.toString():JSON.stringify(t)}ie.prototype.toString=function(){return this.name},ie.fromString=function(t){return t?new ie({name:t,available:!1}):null},ie.prototype.serialize=function(){return["image",this.name]};var le=function(t,e){this.type=t,this.value=e};le.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!ae(t[1]))return e.error("invalid value");var n=t[1],r=se(n),i=e.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new le(r,n)},le.prototype.evaluate=function(){return this.value},le.prototype.eachChild=function(){},le.prototype.outputDefined=function(){return!0},le.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof te?["rgba"].concat(this.value.toArray()):this.value instanceof re?this.value.serialize():this.value};var ce=function(t){this.name="ExpressionEvaluationError",this.message=t};ce.prototype.toJSON=function(){return this.message};var he={string:Ft,number:zt,boolean:Zt,object:Ut},fe=function(t,e){this.type=t,this.args=e};fe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n,r=1,i=t[0];if("array"===i){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in he)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=he[s],r++}else o=Gt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],r++}n=Xt(o,a)}else n=he[i];for(var u=[];r<t.length;r++){var l=e.parse(t[r],r,Gt);if(!l)return null;u.push(l)}return new fe(n,u)},fe.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var n=this.args[e].evaluate(t);if(!Kt(this.type,se(n)))return n;if(e===this.args.length-1)throw new ce("Expected value to be of type "+Yt(this.type)+", but found "+Yt(se(n))+" instead.")}return null},fe.prototype.eachChild=function(t){this.args.forEach(t)},fe.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},fe.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);var r=t.N;("number"==typeof r||this.args.length>1)&&e.push(r)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var pe=function(t){this.type=Wt,this.sections=t};pe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");for(var r=[],i=!1,o=1;o<=t.length-1;++o){var a=t[o];if(i&&"object"==typeof a&&!Array.isArray(a)){i=!1;var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,zt)))return null;var u=null;if(a["text-font"]&&!(u=e.parse(a["text-font"],1,Xt(Ft))))return null;var l=null;if(a["text-color"]&&!(l=e.parse(a["text-color"],1,jt)))return null;var c=r[r.length-1];c.scale=s,c.font=u,c.textColor=l}else{var h=e.parse(t[o],1,Gt);if(!h)return null;var f=h.type.kind;if("string"!==f&&"value"!==f&&"null"!==f&&"resolvedImage"!==f)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:h,scale:null,font:null,textColor:null})}}return new pe(r)},pe.prototype.evaluate=function(t){return new re(this.sections.map((function(e){var n=e.content.evaluate(t);return se(n)===Ht?new ne("",n,null,null,null):new ne(ue(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},pe.prototype.eachChild=function(t){for(var e=0,n=this.sections;e<n.length;e+=1){var r=n[e];t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}},pe.prototype.outputDefined=function(){return!1},pe.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var r=n[e];t.push(r.content.serialize());var i={};r.scale&&(i["font-scale"]=r.scale.serialize()),r.font&&(i["text-font"]=r.font.serialize()),r.textColor&&(i["text-color"]=r.textColor.serialize()),t.push(i)}return t};var de=function(t){this.type=Ht,this.input=t};de.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,Ft);return n?new de(n):e.error("No image name provided.")},de.prototype.evaluate=function(t){var e=this.input.evaluate(t),n=ie.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n},de.prototype.eachChild=function(t){t(this.input)},de.prototype.outputDefined=function(){return!1},de.prototype.serialize=function(){return["image",this.input.serialize()]};var ge={"to-boolean":Zt,"to-color":jt,"to-number":zt,"to-string":Ft},ve=function(t,e){this.type=t,this.args=e};ve.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");for(var r=ge[n],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,Gt);if(!a)return null;i.push(a)}return new ve(r,i)},ve.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,n,r=0,i=this.args;r<i.length;r+=1){if(n=null,(e=i[r].evaluate(t))instanceof te)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(n=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":oe(e[0],e[1],e[2],e[3])))return new te(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ce(n||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,u=this.args;s<u.length;s+=1){if(null===(a=u[s].evaluate(t)))return 0;var l=Number(a);if(!isNaN(l))return l}throw new ce("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?re.fromString(ue(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ie.fromString(ue(this.args[0].evaluate(t))):ue(this.args[0].evaluate(t))},ve.prototype.eachChild=function(t){this.args.forEach(t)},ve.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},ve.prototype.serialize=function(){if("formatted"===this.type.kind)return new pe([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new de(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var me=["Unknown","Point","LineString","Polygon"],ye=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ye.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ye.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?me[this.feature.type]:this.feature.type:null},ye.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ye.prototype.canonicalID=function(){return this.canonical},ye.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ye.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=te.parse(t)),e};var _e=function(t,e,n,r){this.name=t,this.type=e,this._evaluate=n,this.args=r};_e.prototype.evaluate=function(t){return this._evaluate(t,this.args)},_e.prototype.eachChild=function(t){this.args.forEach(t)},_e.prototype.outputDefined=function(){return!1},_e.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},_e.parse=function(t,e){var n,r=t[0],i=_e.definitions[r];if(!i)return e.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter((function(e){var n=e[0];return!Array.isArray(n)||n.length===t.length-1})),u=null,l=0,c=s;l<c.length;l+=1){var h=c[l],f=h[0],p=h[1];u=new je(e.registry,e.path,null,e.scope);for(var d=[],g=!1,v=1;v<t.length;v++){var m=t[v],y=Array.isArray(f)?f[v-1]:f.type,_=u.parse(m,1+d.length,y);if(!_){g=!0;break}d.push(_)}if(!g)if(Array.isArray(f)&&f.length!==d.length)u.error("Expected "+f.length+" arguments, but found "+d.length+" instead.");else{for(var b=0;b<d.length;b++){var x=Array.isArray(f)?f[b]:f.type,w=d[b];u.concat(b+1).checkSubtype(x,w.type)}if(0===u.errors.length)return new _e(r,o,p,d)}}if(1===s.length)(n=e.errors).push.apply(n,u.errors);else{for(var E=(s.length?s:a).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Yt).join(", ")+")":"("+Yt(e.type)+"...)"})).join(" | "),S=[],C=1;C<t.length;C++){var A=e.parse(t[C],1+S.length);if(!A)return null;S.push(Yt(A.type))}e.error("Expected arguments of type "+E+", but found ("+S.join(", ")+") instead.")}return null},_e.register=function(t,e){for(var n in _e.definitions=e,e)t[n]=_e};var be=function(t,e,n){this.type=Vt,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e};function xe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function we(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Ee(t,e){var n=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(n*i*8192),Math.round(r*i*8192)]}function Se(t,e,n){return e[1]>t[1]!=n[1]>t[1]&&t[0]<(n[0]-e[0])*(t[1]-e[1])/(n[1]-e[1])+e[0]}function Ce(t,e){for(var n,r,i,o,a,s,u,l=!1,c=0,h=e.length;c<h;c++)for(var f=e[c],p=0,d=f.length;p<d-1;p++){if((o=(n=t)[0]-(r=f[p])[0])*(u=n[1]-(i=f[p+1])[1])-(s=n[0]-i[0])*(a=n[1]-r[1])==0&&o*s<=0&&a*u<=0)return!1;Se(t,f[p],f[p+1])&&(l=!l)}return l}function Ae(t,e){for(var n=0;n<e.length;n++)if(Ce(t,e[n]))return!0;return!1}function Te(t,e,n,r){var i=r[0]-n[0],o=r[1]-n[1],a=(t[0]-n[0])*o-i*(t[1]-n[1]),s=(e[0]-n[0])*o-i*(e[1]-n[1]);return a>0&&s<0||a<0&&s>0}function ke(t,e,n){for(var r=0,i=n;r<i.length;r+=1)for(var o=i[r],a=0;a<o.length-1;++a)if(0!=(h=[(c=o[a+1])[0]-(l=o[a])[0],c[1]-l[1]])[0]*(f=[(u=e)[0]-(s=t)[0],u[1]-s[1]])[1]-h[1]*f[0]&&Te(s,u,l,c)&&Te(l,c,s,u))return!0;var s,u,l,c,h,f;return!1}function Me(t,e){for(var n=0;n<t.length;++n)if(!Ce(t[n],e))return!1;for(var r=0;r<t.length-1;++r)if(ke(t[r],t[r+1],e))return!1;return!0}function Pe(t,e){for(var n=0;n<e.length;n++)if(Me(t,e[n]))return!0;return!1}function Ie(t,e,n){for(var r=[],i=0;i<t.length;i++){for(var o=[],a=0;a<t[i].length;a++){var s=Ee(t[i][a],n);xe(e,s),o.push(s)}r.push(o)}return r}function Oe(t,e,n){for(var r=[],i=0;i<t.length;i++){var o=Ie(t[i],e,n);r.push(o)}return r}function Re(t,e,n,r){if(t[0]<n[0]||t[0]>n[2]){var i=.5*r,o=t[0]-n[0]>i?-r:n[0]-t[0]>i?r:0;0===o&&(o=t[0]-n[2]>i?-r:n[2]-t[0]>i?r:0),t[0]+=o}xe(e,t)}function Le(t,e,n,r){for(var i=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],a=[],s=0,u=t;s<u.length;s+=1)for(var l=0,c=u[s];l<c.length;l+=1){var h=c[l],f=[h.x+o[0],h.y+o[1]];Re(f,e,n,i),a.push(f)}return a}function De(t,e,n,r){for(var i,o=8192*Math.pow(2,r.z),a=[8192*r.x,8192*r.y],s=[],u=0,l=t;u<l.length;u+=1){for(var c=[],h=0,f=l[u];h<f.length;h+=1){var p=f[h],d=[p.x+a[0],p.y+a[1]];xe(e,d),c.push(d)}s.push(c)}if(e[2]-e[0]<=o/2){(i=e)[0]=i[1]=1/0,i[2]=i[3]=-1/0;for(var g=0,v=s;g<v.length;g+=1)for(var m=0,y=v[g];m<y.length;m+=1)Re(y[m],e,n,o)}return s}be.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");var r=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Zt);if(!r)return null;var i=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Zt);if(!i)return null;var o=null;return n.locale&&!(o=e.parse(n.locale,1,Ft))?null:new be(r,i,o)},be.prototype.evaluate=function(t){return new ee(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},be.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},be.prototype.outputDefined=function(){return!1},be.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Ne=function(t,e){this.type=Zt,this.geojson=t,this.geometries=e};function Be(t){if(t instanceof _e){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Ne)return!1;var e=!0;return t.eachChild((function(t){e&&!Be(t)&&(e=!1)})),e}function ze(t){if(t instanceof _e&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!ze(t)&&(e=!1)})),e}function Fe(t,e){if(t instanceof _e&&e.indexOf(t.name)>=0)return!1;var n=!0;return t.eachChild((function(t){n&&!Fe(t,e)&&(n=!1)})),n}Ne.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(ae(t[1])){var n=t[1];if("FeatureCollection"===n.type)for(var r=0;r<n.features.length;++r){var i=n.features[r].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Ne(n,n.features[r].geometry)}else if("Feature"===n.type){var o=n.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new Ne(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new Ne(n,n)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ne.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Ie(e.coordinates,r,i),a=Le(t.geometry(),n,r,i);if(!we(n,r))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!Ce(u[s],o))return!1}if("MultiPolygon"===e.type){var l=Oe(e.coordinates,r,i),c=Le(t.geometry(),n,r,i);if(!we(n,r))return!1;for(var h=0,f=c;h<f.length;h+=1)if(!Ae(f[h],l))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Ie(e.coordinates,r,i),a=De(t.geometry(),n,r,i);if(!we(n,r))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!Me(u[s],o))return!1}if("MultiPolygon"===e.type){var l=Oe(e.coordinates,r,i),c=De(t.geometry(),n,r,i);if(!we(n,r))return!1;for(var h=0,f=c;h<f.length;h+=1)if(!Pe(f[h],l))return!1}return!0}(t,this.geometries)}return!1},Ne.prototype.eachChild=function(){},Ne.prototype.outputDefined=function(){return!0},Ne.prototype.serialize=function(){return["within",this.geojson]};var Ze=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};Ze.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var n=t[1];return e.scope.has(n)?new Ze(n,e.scope.get(n)):e.error('Unknown variable "'+n+'". Make sure "'+n+'" has been bound in an enclosing "let" expression before using it.',1)},Ze.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ze.prototype.eachChild=function(){},Ze.prototype.outputDefined=function(){return!1},Ze.prototype.serialize=function(){return["var",this.name]};var je=function(t,e,n,r,i){void 0===e&&(e=[]),void 0===r&&(r=new Nt),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=r,this.errors=i,this.expectedType=n};function Ue(t,e){for(var n,r=t.length-1,i=0,o=r,a=0;i<=o;)if((n=t[a=Math.floor((i+o)/2)])<=e){if(a===r||e<t[a+1])return a;i=a+1}else{if(!(n>e))throw new ce("Input is not a number.");o=a-1}return 0}je.prototype.parse=function(t,e,n,r,i){return void 0===i&&(i={}),e?this.concat(e,n,r)._parse(t,i):this._parse(t,i)},je.prototype._parse=function(t,e){function n(t,e,n){return"assert"===n?new fe(e,[t]):"coerce"===n?new ve(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var r=t[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found "+typeof r+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[r];if(i){var o=i.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind&&"resolvedImage"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=n(o,a,e.typeAnnotation||"coerce");else o=n(o,a,e.typeAnnotation||"assert")}if(!(o instanceof le)&&"resolvedImage"!==o.type.kind&&function t(e){if(e instanceof Ze)return t(e.boundExpression);if(e instanceof _e&&"error"===e.name)return!1;if(e instanceof be)return!1;if(e instanceof Ne)return!1;var n=e instanceof ve||e instanceof fe,r=!0;return e.eachChild((function(e){r=n?r&&t(e):r&&e instanceof le})),!!r&&Be(e)&&Fe(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(o)){var u=new ye;try{o=new le(o.type,o.evaluate(u))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},je.prototype.concat=function(t,e,n){var r="number"==typeof t?this.path.concat(t):this.path,i=n?this.scope.concat(n):this.scope;return new je(this.registry,r,e||null,i,this.errors)},je.prototype.error=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var r=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new Dt(r,t))},je.prototype.checkSubtype=function(t,e){var n=Kt(t,e);return n&&this.error(n),n};var Ge=function(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var r=0,i=n;r<i.length;r+=1){var o=i[r],a=o[1];this.labels.push(o[0]),this.outputs.push(a)}};function Ve(t,e,n){return t*(1-n)+e*n}Ge.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var n=e.parse(t[1],1,zt);if(!n)return null;var r=[],i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var o=1;o<t.length;o+=2){var a=1===o?-1/0:t[o],s=t[o+1],u=o,l=o+1;if("number"!=typeof a)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(r.length&&r[r.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var c=e.parse(s,l,i);if(!c)return null;i=i||c.type,r.push([a,c])}return new Ge(i,n,r)},Ge.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);var i=e.length;return r>=e[i-1]?n[i-1].evaluate(t):n[Ue(e,r)].evaluate(t)},Ge.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},Ge.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},Ge.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var We=Object.freeze({__proto__:null,number:Ve,color:function(t,e,n){return new te(Ve(t.r,e.r,n),Ve(t.g,e.g,n),Ve(t.b,e.b,n),Ve(t.a,e.a,n))},array:function(t,e,n){return t.map((function(t,r){return Ve(t,e[r],n)}))}}),He=6/29*3*(6/29),Xe=Math.PI/180,Ye=180/Math.PI;function qe(t){return t>.008856451679035631?Math.pow(t,1/3):t/He+4/29}function Ke(t){return t>6/29?t*t*t:He*(t-4/29)}function Qe(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Je(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function $e(t){var e=Je(t.r),n=Je(t.g),r=Je(t.b),i=qe((.4124564*e+.3575761*n+.1804375*r)/.95047),o=qe((.2126729*e+.7151522*n+.072175*r)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-qe((.0193339*e+.119192*n+.9503041*r)/1.08883)),alpha:t.a}}function tn(t){var e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*Ke(e),n=.95047*Ke(n),r=1.08883*Ke(r),new te(Qe(3.2404542*n-1.5371385*e-.4985314*r),Qe(-.969266*n+1.8760108*e+.041556*r),Qe(.0556434*n-.2040259*e+1.0572252*r),t.alpha)}function en(t,e,n){var r=e-t;return t+n*(r>180||r<-180?r-360*Math.round(r/360):r)}var nn={forward:$e,reverse:tn,interpolate:function(t,e,n){return{l:Ve(t.l,e.l,n),a:Ve(t.a,e.a,n),b:Ve(t.b,e.b,n),alpha:Ve(t.alpha,e.alpha,n)}}},rn={forward:function(t){var e=$e(t),n=e.l,r=e.a,i=e.b,o=Math.atan2(i,r)*Ye;return{h:o<0?o+360:o,c:Math.sqrt(r*r+i*i),l:n,alpha:t.a}},reverse:function(t){var e=t.h*Xe,n=t.c;return tn({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:en(t.h,e.h,n),c:Ve(t.c,e.c,n),l:Ve(t.l,e.l,n),alpha:Ve(t.alpha,e.alpha,n)}}},on=Object.freeze({__proto__:null,lab:nn,hcl:rn}),an=function(t,e,n,r,i){this.type=t,this.operator=e,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(var o=0,a=i;o<a.length;o+=1){var s=a[o],u=s[1];this.labels.push(s[0]),this.outputs.push(u)}};function sn(t,e,n,r){var i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}an.interpolationFactor=function(t,e,r,i){var o=0;if("exponential"===t.name)o=sn(e,t.base,r,i);else if("linear"===t.name)o=sn(e,1,r,i);else if("cubic-bezier"===t.name){var a=t.controlPoints;o=new n(a[0],a[1],a[2],a[3]).solve(sn(e,1,r,i))}return o},an.parse=function(t,e){var n=t[0],r=t[1],i=t[2],o=t.slice(3);if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){var a=r[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:a}}else{if("cubic-bezier"!==r[0])return e.error("Unknown interpolation type "+String(r[0]),1,0);var s=r.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,zt)))return null;var u=[],l=null;"interpolate-hcl"===n||"interpolate-lab"===n?l=jt:e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var c=0;c<o.length;c+=2){var h=o[c],f=o[c+1],p=c+3,d=c+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(u.length&&u[u.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',p);var g=e.parse(f,d,l);if(!g)return null;l=l||g.type,u.push([h,g])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new an(l,n,r,i,u):e.error("Type "+Yt(l)+" is not interpolatable.")},an.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);var i=e.length;if(r>=e[i-1])return n[i-1].evaluate(t);var o=Ue(e,r),a=an.interpolationFactor(this.interpolation,r,e[o],e[o+1]),s=n[o].evaluate(t),u=n[o+1].evaluate(t);return"interpolate"===this.operator?We[this.type.kind.toLowerCase()](s,u,a):"interpolate-hcl"===this.operator?rn.reverse(rn.interpolate(rn.forward(s),rn.forward(u),a)):nn.reverse(nn.interpolate(nn.forward(s),nn.forward(u),a))},an.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},an.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},an.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e};var un=function(t,e){this.type=t,this.args=e};un.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var n=null,r=e.expectedType;r&&"value"!==r.kind&&(n=r);for(var i=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=e.parse(a[o],1+i.length,n,void 0,{typeAnnotation:"omit"});if(!s)return null;n=n||s.type,i.push(s)}var u=r&&i.some((function(t){return Kt(r,t.type)}));return new un(u?Gt:n,i)},un.prototype.evaluate=function(t){for(var e,n=null,r=0,i=0,o=this.args;i<o.length&&(r++,(n=o[i].evaluate(t))&&n instanceof ie&&!n.available&&(e||(e=n.name),n=null,r===this.args.length&&(n=e)),null===n);i+=1);return n},un.prototype.eachChild=function(t){this.args.forEach(t)},un.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},un.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var ln=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};ln.prototype.evaluate=function(t){return this.result.evaluate(t)},ln.prototype.eachChild=function(t){for(var e=0,n=this.bindings;e<n.length;e+=1)t(n[e][1]);t(this.result)},ln.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var n=[],r=1;r<t.length-1;r+=2){var i=t[r];if("string"!=typeof i)return e.error("Expected string, but found "+typeof i+" instead.",r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);var o=e.parse(t[r+1],r+1);if(!o)return null;n.push([i,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return a?new ln(n,a):null},ln.prototype.outputDefined=function(){return this.result.outputDefined()},ln.prototype.serialize=function(){for(var t=["let"],e=0,n=this.bindings;e<n.length;e+=1){var r=n[e];t.push(r[0],r[1].serialize())}return t.push(this.result.serialize()),t};var cn=function(t,e,n){this.type=t,this.index=e,this.input=n};cn.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,zt),r=e.parse(t[2],2,Xt(e.expectedType||Gt));return n&&r?new cn(r.type.itemType,n,r):null},cn.prototype.evaluate=function(t){var e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new ce("Array index out of bounds: "+e+" < 0.");if(e>=n.length)throw new ce("Array index out of bounds: "+e+" > "+(n.length-1)+".");if(e!==Math.floor(e))throw new ce("Array index must be an integer, but found "+e+" instead.");return n[e]},cn.prototype.eachChild=function(t){t(this.index),t(this.input)},cn.prototype.outputDefined=function(){return!1},cn.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var hn=function(t,e){this.type=Zt,this.needle=t,this.haystack=e};hn.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Gt),r=e.parse(t[2],2,Gt);return n&&r?Qt(n.type,[Zt,Ft,zt,Bt,Gt])?new hn(n,r):e.error("Expected first argument to be of type boolean, string, number or null, but found "+Yt(n.type)+" instead"):null},hn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!Jt(e,["boolean","string","number","null"]))throw new ce("Expected first argument to be of type boolean, string, number or null, but found "+Yt(se(e))+" instead.");if(!Jt(n,["string","array"]))throw new ce("Expected second argument to be of type array or string, but found "+Yt(se(n))+" instead.");return n.indexOf(e)>=0},hn.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},hn.prototype.outputDefined=function(){return!0},hn.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var fn=function(t,e,n){this.type=zt,this.needle=t,this.haystack=e,this.fromIndex=n};fn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Gt),r=e.parse(t[2],2,Gt);if(!n||!r)return null;if(!Qt(n.type,[Zt,Ft,zt,Bt,Gt]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+Yt(n.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,zt);return i?new fn(n,r,i):null}return new fn(n,r)},fn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!Jt(e,["boolean","string","number","null"]))throw new ce("Expected first argument to be of type boolean, string, number or null, but found "+Yt(se(e))+" instead.");if(!Jt(n,["string","array"]))throw new ce("Expected second argument to be of type array or string, but found "+Yt(se(n))+" instead.");if(this.fromIndex){var r=this.fromIndex.evaluate(t);return n.indexOf(e,r)}return n.indexOf(e)},fn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},fn.prototype.outputDefined=function(){return!1},fn.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var pn=function(t,e,n,r,i,o){this.inputType=t,this.type=e,this.input=n,this.cases=r,this.outputs=i,this.otherwise=o};pn.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var n,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var i={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],u=t[a+1];Array.isArray(s)||(s=[s]);var l=e.concat(a);if(0===s.length)return l.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var f=h[c];if("number"!=typeof f&&"string"!=typeof f)return l.error("Branch labels must be numbers or strings.");if("number"==typeof f&&Math.abs(f)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof f&&Math.floor(f)!==f)return l.error("Numeric branch labels must be integer values.");if(n){if(l.checkSubtype(n,se(f)))return null}else n=se(f);if(void 0!==i[String(f)])return l.error("Branch labels must be unique.");i[String(f)]=o.length}var p=e.parse(u,a,r);if(!p)return null;r=r||p.type,o.push(p)}var d=e.parse(t[1],1,Gt);if(!d)return null;var g=e.parse(t[t.length-1],t.length-1,r);return g?"value"!==d.type.kind&&e.concat(1).checkSubtype(n,d.type)?null:new pn(n,r,d,i,o,g):null},pn.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(se(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},pn.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},pn.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},pn.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],n=[],r={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i];void 0===(h=r[this.cases[a]])?(r[this.cases[a]]=n.length,n.push([this.cases[a],[a]])):n[h][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,l=n;u<l.length;u+=1){var c=l[u],h=c[0],f=c[1];e.push(1===f.length?s(f[0]):f.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var dn=function(t,e,n){this.type=t,this.branches=e,this.otherwise=n};dn.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var r=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,Zt);if(!o)return null;var a=e.parse(t[i+1],i+1,n);if(!a)return null;r.push([o,a]),n=n||a.type}var s=e.parse(t[t.length-1],t.length-1,n);return s?new dn(n,r,s):null},dn.prototype.evaluate=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var r=n[e],i=r[1];if(r[0].evaluate(t))return i.evaluate(t)}return this.otherwise.evaluate(t)},dn.prototype.eachChild=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var r=n[e],i=r[1];t(r[0]),t(i)}t(this.otherwise)},dn.prototype.outputDefined=function(){return this.branches.every((function(t){return t[1].outputDefined()}))&&this.otherwise.outputDefined()},dn.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var gn=function(t,e,n,r){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=r};function vn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function mn(t,e,n,r){return 0===r.compare(e,n)}function yn(t,e,n){var r="=="!==t&&"!="!==t;return function(){function i(t,e,n){this.type=Zt,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var n=t[0],o=e.parse(t[1],1,Gt);if(!o)return null;if(!vn(n,o.type))return e.concat(1).error('"'+n+"\" comparisons are not supported for type '"+Yt(o.type)+"'.");var a=e.parse(t[2],2,Gt);if(!a)return null;if(!vn(n,a.type))return e.concat(2).error('"'+n+"\" comparisons are not supported for type '"+Yt(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+Yt(o.type)+"' and '"+Yt(a.type)+"'.");r&&("value"===o.type.kind&&"value"!==a.type.kind?o=new fe(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new fe(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Vt)))return null}return new i(o,a,s)},i.prototype.evaluate=function(i){var o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){var s=se(o),u=se(a);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new ce('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!r&&this.hasUntypedArgument){var l=se(o),c=se(a);if("string"!==l.kind||"string"!==c.kind)return e(i,o,a)}return this.collator?n(i,o,a,this.collator.evaluate(i)):e(i,o,a)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},i.prototype.outputDefined=function(){return!0},i.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},i}()}gn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Gt),r=e.parse(t[2],2,zt);if(!n||!r)return null;if(!Qt(n.type,[Xt(Gt),Ft,Gt]))return e.error("Expected first argument to be of type array or string, but found "+Yt(n.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,zt);return i?new gn(n.type,n,r,i):null}return new gn(n.type,n,r)},gn.prototype.evaluate=function(t){var e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!Jt(e,["string","array"]))throw new ce("Expected first argument to be of type array or string, but found "+Yt(se(e))+" instead.");if(this.endIndex){var r=this.endIndex.evaluate(t);return e.slice(n,r)}return e.slice(n)},gn.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},gn.prototype.outputDefined=function(){return!1},gn.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var _n=yn("==",(function(t,e,n){return e===n}),mn),bn=yn("!=",(function(t,e,n){return e!==n}),(function(t,e,n,r){return!mn(0,e,n,r)})),xn=yn("<",(function(t,e,n){return e<n}),(function(t,e,n,r){return r.compare(e,n)<0})),wn=yn(">",(function(t,e,n){return e>n}),(function(t,e,n,r){return r.compare(e,n)>0})),En=yn("<=",(function(t,e,n){return e<=n}),(function(t,e,n,r){return r.compare(e,n)<=0})),Sn=yn(">=",(function(t,e,n){return e>=n}),(function(t,e,n,r){return r.compare(e,n)>=0})),Cn=function(t,e,n,r,i){this.type=Ft,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=r,this.maxFractionDigits=i};Cn.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,zt);if(!n)return null;var r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");var i=null;if(r.locale&&!(i=e.parse(r.locale,1,Ft)))return null;var o=null;if(r.currency&&!(o=e.parse(r.currency,1,Ft)))return null;var a=null;if(r["min-fraction-digits"]&&!(a=e.parse(r["min-fraction-digits"],1,zt)))return null;var s=null;return r["max-fraction-digits"]&&!(s=e.parse(r["max-fraction-digits"],1,zt))?null:new Cn(n,i,o,a,s)},Cn.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Cn.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Cn.prototype.outputDefined=function(){return!1},Cn.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var An=function(t){this.type=zt,this.input=t};An.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found "+Yt(n.type)+" instead."):new An(n):null},An.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ce("Expected value to be of type string or array, but found "+Yt(se(e))+" instead.")},An.prototype.eachChild=function(t){t(this.input)},An.prototype.outputDefined=function(){return!1},An.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Tn={"==":_n,"!=":bn,">":wn,"<":xn,">=":Sn,"<=":En,array:fe,at:cn,boolean:fe,case:dn,coalesce:un,collator:be,format:pe,image:de,in:hn,"index-of":fn,interpolate:an,"interpolate-hcl":an,"interpolate-lab":an,length:An,let:ln,literal:le,match:pn,number:fe,"number-format":Cn,object:fe,slice:gn,step:Ge,string:fe,"to-boolean":ve,"to-color":ve,"to-number":ve,"to-string":ve,var:Ze,within:Ne};function kn(t,e){var n=e[0],r=e[1],i=e[2],o=e[3];n=n.evaluate(t),r=r.evaluate(t),i=i.evaluate(t);var a=o?o.evaluate(t):1,s=oe(n,r,i,a);if(s)throw new ce(s);return new te(n/255*a,r/255*a,i/255*a,a)}function Mn(t,e){return t in e}function Pn(t,e){var n=e[t];return void 0===n?null:n}function In(t){return{type:t}}function On(t){return{result:"success",value:t}}function Rn(t){return{result:"error",value:t}}function Ln(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Dn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Nn(t){return!!t.expression&&t.expression.interpolated}function Bn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function zn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Fn(t){return t}function Zn(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function jn(t,e,n,r,i){return Zn(typeof n===i?r[n]:void 0,t.default,e.default)}function Un(t,e,n){if("number"!==Bn(n))return Zn(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];var i=Ue(t.stops.map((function(t){return t[0]})),n);return t.stops[i][1]}function Gn(t,e,n){var r=void 0!==t.base?t.base:1;if("number"!==Bn(n))return Zn(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];var o=Ue(t.stops.map((function(t){return t[0]})),n),a=function(t,e,n,r){var i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}(n,r,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],u=t.stops[o+1][1],l=We[e.type]||Fn;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=on[t.colorSpace];l=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=s.evaluate.apply(void 0,t),r=u.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==r)return l(n,r,a)}}:l(s,u,a)}function Vn(t,e,n){return"color"===e.type?n=te.parse(n):"formatted"===e.type?n=re.fromString(n.toString()):"resolvedImage"===e.type?n=ie.fromString(n.toString()):Bn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),Zn(n,t.default,e.default)}_e.register(Tn,{error:[{kind:"error"},[Ft],function(t,e){throw new ce(e[0].evaluate(t))}],typeof:[Ft,[Gt],function(t,e){return Yt(se(e[0].evaluate(t)))}],"to-rgba":[Xt(zt,4),[jt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[jt,[zt,zt,zt],kn],rgba:[jt,[zt,zt,zt,zt],kn],has:{type:Zt,overloads:[[[Ft],function(t,e){return Mn(e[0].evaluate(t),t.properties())}],[[Ft,Ut],function(t,e){var n=e[1];return Mn(e[0].evaluate(t),n.evaluate(t))}]]},get:{type:Gt,overloads:[[[Ft],function(t,e){return Pn(e[0].evaluate(t),t.properties())}],[[Ft,Ut],function(t,e){var n=e[1];return Pn(e[0].evaluate(t),n.evaluate(t))}]]},"feature-state":[Gt,[Ft],function(t,e){return Pn(e[0].evaluate(t),t.featureState||{})}],properties:[Ut,[],function(t){return t.properties()}],"geometry-type":[Ft,[],function(t){return t.geometryType()}],id:[Gt,[],function(t){return t.id()}],zoom:[zt,[],function(t){return t.globals.zoom}],"heatmap-density":[zt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[zt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Gt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[zt,In(zt),function(t,e){for(var n=0,r=0,i=e;r<i.length;r+=1)n+=i[r].evaluate(t);return n}],"*":[zt,In(zt),function(t,e){for(var n=1,r=0,i=e;r<i.length;r+=1)n*=i[r].evaluate(t);return n}],"-":{type:zt,overloads:[[[zt,zt],function(t,e){var n=e[1];return e[0].evaluate(t)-n.evaluate(t)}],[[zt],function(t,e){return-e[0].evaluate(t)}]]},"/":[zt,[zt,zt],function(t,e){var n=e[1];return e[0].evaluate(t)/n.evaluate(t)}],"%":[zt,[zt,zt],function(t,e){var n=e[1];return e[0].evaluate(t)%n.evaluate(t)}],ln2:[zt,[],function(){return Math.LN2}],pi:[zt,[],function(){return Math.PI}],e:[zt,[],function(){return Math.E}],"^":[zt,[zt,zt],function(t,e){var n=e[1];return Math.pow(e[0].evaluate(t),n.evaluate(t))}],sqrt:[zt,[zt],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[zt,[zt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[zt,[zt],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[zt,[zt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[zt,[zt],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[zt,[zt],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[zt,[zt],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[zt,[zt],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[zt,[zt],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[zt,[zt],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[zt,In(zt),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[zt,In(zt),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[zt,[zt],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[zt,[zt],function(t,e){var n=e[0].evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[zt,[zt],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[zt,[zt],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[Zt,[Ft,Gt],function(t,e){var n=e[0],r=e[1];return t.properties()[n.value]===r.value}],"filter-id-==":[Zt,[Gt],function(t,e){var n=e[0];return t.id()===n.value}],"filter-type-==":[Zt,[Ft],function(t,e){var n=e[0];return t.geometryType()===n.value}],"filter-<":[Zt,[Ft,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i<o}],"filter-id-<":[Zt,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r<i}],"filter->":[Zt,[Ft,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i>o}],"filter-id->":[Zt,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r>i}],"filter-<=":[Zt,[Ft,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[Zt,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r<=i}],"filter->=":[Zt,[Ft,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[Zt,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r>=i}],"filter-has":[Zt,[Gt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Zt,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[Zt,[Xt(Ft)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Zt,[Xt(Gt)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[Zt,[Ft,Xt(Gt)],function(t,e){var n=e[0];return e[1].value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[Zt,[Ft,Xt(Gt)],function(t,e){var n=e[0],r=e[1];return function(t,e,n,r){for(;n<=r;){var i=n+r>>1;if(e[i]===t)return!0;e[i]>t?r=i-1:n=i+1}return!1}(t.properties()[n.value],r.value,0,r.value.length-1)}],all:{type:Zt,overloads:[[[Zt,Zt],function(t,e){var n=e[1];return e[0].evaluate(t)&&n.evaluate(t)}],[In(Zt),function(t,e){for(var n=0,r=e;n<r.length;n+=1)if(!r[n].evaluate(t))return!1;return!0}]]},any:{type:Zt,overloads:[[[Zt,Zt],function(t,e){var n=e[1];return e[0].evaluate(t)||n.evaluate(t)}],[In(Zt),function(t,e){for(var n=0,r=e;n<r.length;n+=1)if(r[n].evaluate(t))return!0;return!1}]]},"!":[Zt,[Zt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[Zt,[Ft],function(t,e){var n=t.globals&&t.globals.isSupportedScript;return!n||n(e[0].evaluate(t))}],upcase:[Ft,[Ft],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Ft,[Ft],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Ft,In(Gt),function(t,e){return e.map((function(e){return ue(e.evaluate(t))})).join("")}],"resolved-locale":[Ft,[Vt],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Wn=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new ye,this._defaultValue=e?function(t){return"color"===t.type&&zn(t.default)?new te(0,0,0,0):"color"===t.type?te.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function Hn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Tn}function Xn(t,e){var n=new je(Tn,[],e?function(t){var e={color:jt,string:Ft,number:zt,enum:Ft,boolean:Zt,formatted:Wt,resolvedImage:Ht};return"array"===t.type?Xt(e[t.value]||Gt,t.length):e[t.type]}(e):void 0),r=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?On(new Wn(r,e)):Rn(n.errors)}Wn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)},Wn.prototype.evaluate=function(t,e,n,r,i,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null;try{var a=this.expression.evaluate(this._evaluator);if(null==a||"number"==typeof a&&a!=a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new ce("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(a)+" instead.");return a}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Yn=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!ze(e.expression)};Yn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)},Yn.prototype.evaluate=function(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)};var qn=function(t,e,n,r){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!ze(e.expression),this.interpolationType=r};function Kn(t,e){if("error"===(t=Xn(t,e)).result)return t;var n=t.value.expression,r=Be(n);if(!r&&!Ln(e))return Rn([new Dt("","data expressions not supported")]);var i=Fe(n,["zoom"]);if(!i&&!Dn(e))return Rn([new Dt("","zoom expressions not supported")]);var o=function t(e){var n=null;if(e instanceof ln)n=t(e.result);else if(e instanceof un)for(var r=0,i=e.args;r<i.length&&!(n=t(i[r]));r+=1);else(e instanceof Ge||e instanceof an)&&e.input instanceof _e&&"zoom"===e.input.name&&(n=e);return n instanceof Dt||e.eachChild((function(e){var r=t(e);r instanceof Dt?n=r:!n&&r?n=new Dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&r&&n!==r&&(n=new Dt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}(n);return o||i?o instanceof Dt?Rn([o]):o instanceof an&&!Nn(e)?Rn([new Dt("",'"interpolate" expressions cannot be used with this property')]):On(o?new qn(r?"camera":"composite",t.value,o.labels,o instanceof an?o.interpolation:void 0):new Yn(r?"constant":"source",t.value)):Rn([new Dt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}qn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)},qn.prototype.evaluate=function(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)},qn.prototype.interpolationFactor=function(t,e,n){return this.interpolationType?an.interpolationFactor(this.interpolationType,t,e,n):0};var Qn=function(t,e){this._parameters=t,this._specification=e,Ot(this,function t(e,n){var r,i,o,a="color"===n.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||!(s||void 0!==e.property),l=e.type||(Nn(n)?"exponential":"interval");if(a&&((e=Ot({},e)).stops&&(e.stops=e.stops.map((function(t){return[t[0],te.parse(t[1])]}))),e.default=te.parse(e.default?e.default:n.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!on[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===l)r=Gn;else if("interval"===l)r=Un;else if("categorical"===l){r=jn,i=Object.create(null);for(var c=0,h=e.stops;c<h.length;c+=1){var f=h[c];i[f[0]]=f[1]}o=typeof e.stops[0][0]}else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');r=Vn}if(s){for(var p={},d=[],g=0;g<e.stops.length;g++){var v=e.stops[g],m=v[0].zoom;void 0===p[m]&&(p[m]={zoom:m,type:e.type,property:e.property,default:e.default,stops:[]},d.push(m)),p[m].stops.push([v[0].value,v[1]])}for(var y=[],_=0,b=d;_<b.length;_+=1){var x=b[_];y.push([p[x].zoom,t(p[x],n)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:an.interpolationFactor.bind(void 0,w),zoomStops:y.map((function(t){return t[0]})),evaluate:function(t,r){var i=t.zoom;return Gn({stops:y,base:e.base},n,i).evaluate(i,r)}}}if(u){var E="exponential"===l?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:an.interpolationFactor.bind(void 0,E),zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){return r(e,n,t.zoom,i,o)}}}return{kind:"source",evaluate:function(t,a){var s=a&&a.properties?a.properties[e.property]:void 0;return void 0===s?Zn(e.default,n.default):r(e,n,s,i,o)}}}(this._parameters,this._specification))};function Jn(t){var e=t.key,n=t.value,r=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],u=Bn(n);if("object"!==u)return[new Pt(e,n,"object expected, "+u+" found")];for(var l in n){var c=l.split(".")[0],h=r[c]||r["*"],f=void 0;if(i[c])f=i[c];else if(r[c])f=Er;else if(i["*"])f=i["*"];else{if(!r["*"]){s.push(new Pt(e,n[l],'unknown property "'+l+'"'));continue}f=Er}s=s.concat(f({key:(e?e+".":e)+l,value:n[l],valueSpec:h,style:o,styleSpec:a,object:n,objectKey:l},n))}for(var p in r)i[p]||r[p].required&&void 0===r[p].default&&void 0===n[p]&&s.push(new Pt(e,n,'missing required property "'+p+'"'));return s}function $n(t){var e=t.value,n=t.valueSpec,r=t.style,i=t.styleSpec,o=t.key,a=t.arrayElementValidator||Er;if("array"!==Bn(e))return[new Pt(o,e,"array expected, "+Bn(e)+" found")];if(n.length&&e.length!==n.length)return[new Pt(o,e,"array length "+n.length+" expected, length "+e.length+" found")];if(n["min-length"]&&e.length<n["min-length"])return[new Pt(o,e,"array length at least "+n["min-length"]+" expected, length "+e.length+" found")];var s={type:n.value,values:n.values};i.$version<7&&(s.function=n.function),"object"===Bn(n.value)&&(s=n.value);for(var u=[],l=0;l<e.length;l++)u=u.concat(a({array:e,arrayIndex:l,value:e[l],valueSpec:s,style:r,styleSpec:i,key:o+"["+l+"]"}));return u}function tr(t){var e=t.key,n=t.value,r=t.valueSpec,i=Bn(n);return"number"===i&&n!=n&&(i="NaN"),"number"!==i?[new Pt(e,n,"number expected, "+i+" found")]:"minimum"in r&&n<r.minimum?[new Pt(e,n,n+" is less than the minimum value "+r.minimum)]:"maximum"in r&&n>r.maximum?[new Pt(e,n,n+" is greater than the maximum value "+r.maximum)]:[]}function er(t){var e,n,r,i=t.valueSpec,o=Rt(t.value.type),a={},s="categorical"!==o&&void 0===t.value.property,u=!s,l="array"===Bn(t.value.stops)&&"array"===Bn(t.value.stops[0])&&"object"===Bn(t.value.stops[0][0]),c=Jn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new Pt(t.key,t.value,'identity function may not have a "stops" property')];var e=[],n=t.value;return e=e.concat($n({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Bn(n)&&0===n.length&&e.push(new Pt(t.key,n,"array must have at least one stop")),e},default:function(t){return Er({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===o&&s&&c.push(new Pt(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||c.push(new Pt(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!Nn(t.valueSpec)&&c.push(new Pt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!Ln(t.valueSpec)?c.push(new Pt(t.key,t.value,"property functions not supported")):s&&!Dn(t.valueSpec)&&c.push(new Pt(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!l||void 0!==t.value.property||c.push(new Pt(t.key,t.value,'"property" property is required')),c;function h(t){var e=[],o=t.value,s=t.key;if("array"!==Bn(o))return[new Pt(s,o,"array expected, "+Bn(o)+" found")];if(2!==o.length)return[new Pt(s,o,"array length 2 expected, length "+o.length+" found")];if(l){if("object"!==Bn(o[0]))return[new Pt(s,o,"object expected, "+Bn(o[0])+" found")];if(void 0===o[0].zoom)return[new Pt(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new Pt(s,o,"object stop key must have value")];if(r&&r>Rt(o[0].zoom))return[new Pt(s,o[0].zoom,"stop zoom values must appear in ascending order")];Rt(o[0].zoom)!==r&&(r=Rt(o[0].zoom),n=void 0,a={}),e=e.concat(Jn({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:tr,value:f}}))}else e=e.concat(f({key:s+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return Hn(Lt(o[1]))?e.concat([new Pt(s+"[1]",o[1],"expressions are not allowed in function stops.")]):e.concat(Er({key:s+"[1]",value:o[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function f(t,r){var s=Bn(t.value),u=Rt(t.value),l=null!==t.value?t.value:r;if(e){if(s!==e)return[new Pt(t.key,l,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Pt(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var c="number expected, "+s+" found";return Ln(i)&&void 0===o&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pt(t.key,l,c)]}return"categorical"!==o||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==o&&"number"===s&&void 0!==n&&u<n?[new Pt(t.key,l,"stop domain values must appear in ascending order")]:(n=u,"categorical"===o&&u in a?[new Pt(t.key,l,"stop domain values must be unique")]:(a[u]=!0,[])):[new Pt(t.key,l,"integer expected, found "+u)]}}function nr(t){var e=("property"===t.expressionContext?Kn:Xn)(Lt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new Pt(""+t.key+e.key,t.value,e.message)}));var n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new Pt(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!ze(n))return[new Pt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!ze(n))return[new Pt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Fe(n,["zoom","feature-state"]))return[new Pt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Be(n))return[new Pt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function rr(t){var e=t.key,n=t.value,r=t.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf(Rt(n))&&i.push(new Pt(e,n,"expected one of ["+r.values.join(", ")+"], "+JSON.stringify(n)+" found")):-1===Object.keys(r.values).indexOf(Rt(n))&&i.push(new Pt(e,n,"expected one of ["+Object.keys(r.values).join(", ")+"], "+JSON.stringify(n)+" found")),i}function ir(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,n=t.slice(1);e<n.length;e+=1){var r=n[e];if(!ir(r)&&"boolean"!=typeof r)return!1}return!0;default:return!0}}Qn.deserialize=function(t){return new Qn(t._parameters,t._specification)},Qn.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var or={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ar(t){if(null==t)return{filter:function(){return!0},needGeometry:!1};ir(t)||(t=ur(t));var e=Xn(t,or);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return{filter:function(t,n,r){return e.value.evaluate(t,n,{},r)},needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(var n=1;n<e.length;n++)if(t(e[n]))return!0;return!1}(t)}}function sr(t,e){return t<e?-1:t>e?1:0}function ur(t){if(!t)return!0;var e,n=t[0];return t.length<=1?"any"!==n:"=="===n?lr(t[1],t[2],"=="):"!="===n?fr(lr(t[1],t[2],"==")):"<"===n||">"===n||"<="===n||">="===n?lr(t[1],t[2],n):"any"===n?(e=t.slice(1),["any"].concat(e.map(ur))):"all"===n?["all"].concat(t.slice(1).map(ur)):"none"===n?["all"].concat(t.slice(1).map(ur).map(fr)):"in"===n?cr(t[1],t.slice(2)):"!in"===n?fr(cr(t[1],t.slice(2))):"has"===n?hr(t[1]):"!has"===n?fr(hr(t[1])):"within"!==n||t}function lr(t,e,n){switch(t){case"$type":return["filter-type-"+n,e];case"$id":return["filter-id-"+n,e];default:return["filter-"+n,t,e]}}function cr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return typeof t!=typeof e[0]}))?["filter-in-large",t,["literal",e.sort(sr)]]:["filter-in-small",t,["literal",e]]}}function hr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function fr(t){return["!",t]}function pr(t){return ir(Lt(t.value))?nr(Ot({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var n=e.value,r=e.key;if("array"!==Bn(n))return[new Pt(r,n,"array expected, "+Bn(n)+" found")];var i,o=e.styleSpec,a=[];if(n.length<1)return[new Pt(r,n,"filter array must have at least 1 element")];switch(a=a.concat(rr({key:r+"[0]",value:n[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),Rt(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===Rt(n[1])&&a.push(new Pt(r,n,'"$type" cannot be use with operator "'+n[0]+'"'));case"==":case"!=":3!==n.length&&a.push(new Pt(r,n,'filter array for operator "'+n[0]+'" must have 3 elements'));case"in":case"!in":n.length>=2&&"string"!==(i=Bn(n[1]))&&a.push(new Pt(r+"[1]",n[1],"string expected, "+i+" found"));for(var s=2;s<n.length;s++)i=Bn(n[s]),"$type"===Rt(n[1])?a=a.concat(rr({key:r+"["+s+"]",value:n[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new Pt(r+"["+s+"]",n[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var u=1;u<n.length;u++)a=a.concat(t({key:r+"["+u+"]",value:n[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Bn(n[1]),2!==n.length?a.push(new Pt(r,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"string"!==i&&a.push(new Pt(r+"[1]",n[1],"string expected, "+i+" found"));break;case"within":i=Bn(n[1]),2!==n.length?a.push(new Pt(r,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"object"!==i&&a.push(new Pt(r+"[1]",n[1],"object expected, "+i+" found"))}return a}(t)}function dr(t,e){var n=t.key,r=t.style,i=t.styleSpec,o=t.value,a=t.objectKey,s=i[e+"_"+t.layerType];if(!s)return[];var u=a.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return Er({key:n,value:o,valueSpec:i.transition,style:r,styleSpec:i});var l,c=t.valueSpec||s[a];if(!c)return[new Pt(n,o,'unknown property "'+a+'"')];if("string"===Bn(o)&&Ln(c)&&!c.tokens&&(l=/^{([^}]+)}$/.exec(o)))return[new Pt(n,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&r&&!r.glyphs&&h.push(new Pt(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&zn(Lt(o))&&"identity"===Rt(o.type)&&h.push(new Pt(n,o,'"text-font" does not support identity functions'))),h.concat(Er({key:t.key,value:o,valueSpec:c,style:r,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:a}))}function gr(t){return dr(t,"paint")}function vr(t){return dr(t,"layout")}function mr(t){var e=[],n=t.value,r=t.key,i=t.style,o=t.styleSpec;n.type||n.ref||e.push(new Pt(r,n,'either "type" or "ref" is required'));var a,s=Rt(n.type),u=Rt(n.ref);if(n.id)for(var l=Rt(n.id),c=0;c<t.arrayIndex;c++){var h=i.layers[c];Rt(h.id)===l&&e.push(new Pt(r,n.id,'duplicate layer id "'+n.id+'", previously used at line '+h.id.__line__))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach((function(t){t in n&&e.push(new Pt(r,n[t],'"'+t+'" is prohibited for ref layers'))})),i.layers.forEach((function(t){Rt(t.id)===u&&(a=t)})),a?a.ref?e.push(new Pt(r,n.ref,"ref cannot reference another ref layer")):s=Rt(a.type):e.push(new Pt(r,n.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(n.source){var f=i.sources&&i.sources[n.source],p=f&&Rt(f.type);f?"vector"===p&&"raster"===s?e.push(new Pt(r,n.source,'layer "'+n.id+'" requires a raster source')):"raster"===p&&"raster"!==s?e.push(new Pt(r,n.source,'layer "'+n.id+'" requires a vector source')):"vector"!==p||n["source-layer"]?"raster-dem"===p&&"hillshade"!==s?e.push(new Pt(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===p&&f.lineMetrics||e.push(new Pt(r,n,'layer "'+n.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new Pt(r,n,'layer "'+n.id+'" must specify a "source-layer"')):e.push(new Pt(r,n.source,'source "'+n.source+'" not found'))}else e.push(new Pt(r,n,'missing required property "source"'));return e=e.concat(Jn({key:r,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Er({key:r+".type",value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"})},filter:pr,layout:function(t){return Jn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return vr(Ot({layerType:s},t))}}})},paint:function(t){return Jn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return gr(Ot({layerType:s},t))}}})}}}))}function yr(t){var e=t.value,n=t.key,r=Bn(e);return"string"!==r?[new Pt(n,e,"string expected, "+r+" found")]:[]}var _r={promoteId:function(t){var e=t.key,n=t.value;if("string"===Bn(n))return yr({key:e,value:n});var r=[];for(var i in n)r.push.apply(r,yr({key:e+"."+i,value:n[i]}));return r}};function br(t){var e=t.value,n=t.key,r=t.styleSpec,i=t.style;if(!e.type)return[new Pt(n,e,'"type" is required')];var o,a=Rt(e.type);switch(a){case"vector":case"raster":case"raster-dem":return Jn({key:n,value:e,valueSpec:r["source_"+a.replace("-","_")],style:t.style,styleSpec:r,objectElementValidators:_r});case"geojson":if(o=Jn({key:n,value:e,valueSpec:r.source_geojson,style:i,styleSpec:r,objectElementValidators:_r}),e.cluster)for(var s in e.clusterProperties){var u=e.clusterProperties[s],l=u[0],c="string"==typeof l?[l,["accumulated"],["get",s]]:l;o.push.apply(o,nr({key:n+"."+s+".map",value:u[1],expressionContext:"cluster-map"})),o.push.apply(o,nr({key:n+"."+s+".reduce",value:c,expressionContext:"cluster-reduce"}))}return o;case"video":return Jn({key:n,value:e,valueSpec:r.source_video,style:i,styleSpec:r});case"image":return Jn({key:n,value:e,valueSpec:r.source_image,style:i,styleSpec:r});case"canvas":return[new Pt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rr({key:n+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:r})}}function xr(t){var e=t.value,n=t.styleSpec,r=n.light,i=t.style,o=[],a=Bn(e);if(void 0===e)return o;if("object"!==a)return o.concat([new Pt("light",e,"object expected, "+a+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);o=o.concat(u&&r[u[1]]&&r[u[1]].transition?Er({key:s,value:e[s],valueSpec:n.transition,style:i,styleSpec:n}):r[s]?Er({key:s,value:e[s],valueSpec:r[s],style:i,styleSpec:n}):[new Pt(s,e[s],'unknown property "'+s+'"')])}return o}var wr={"*":function(){return[]},array:$n,boolean:function(t){var e=t.value,n=t.key,r=Bn(e);return"boolean"!==r?[new Pt(n,e,"boolean expected, "+r+" found")]:[]},number:tr,color:function(t){var e=t.key,n=t.value,r=Bn(n);return"string"!==r?[new Pt(e,n,"color expected, "+r+" found")]:null===$t(n)?[new Pt(e,n,'color expected, "'+n+'" found')]:[]},constants:It,enum:rr,filter:pr,function:er,layer:mr,object:Jn,source:br,light:xr,string:yr,formatted:function(t){return 0===yr(t).length?[]:nr(t)},resolvedImage:function(t){return 0===yr(t).length?[]:nr(t)}};function Er(t){var e=t.value,n=t.valueSpec,r=t.styleSpec;return n.expression&&zn(Rt(e))?er(t):n.expression&&Hn(Lt(e))?nr(t):n.type&&wr[n.type]?wr[n.type](t):Jn(Ot({},t,{valueSpec:n.type?r[n.type]:n}))}function Sr(t){var e=t.value,n=t.key,r=yr(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new Pt(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new Pt(n,e,'"glyphs" url must include a "{range}" token'))),r}function Cr(t,e){void 0===e&&(e=Mt);var n=[];return n=n.concat(Er({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Sr,"*":function(){return[]}}})),t.constants&&(n=n.concat(It({key:"constants",value:t.constants,style:t,styleSpec:e}))),Ar(n)}function Ar(t){return[].concat(t).sort((function(t,e){return t.line-e.line}))}function Tr(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return Ar(t.apply(this,e))}}Cr.source=Tr(br),Cr.light=Tr(xr),Cr.layer=Tr(mr),Cr.filter=Tr(pr),Cr.paintProperty=Tr(gr),Cr.layoutProperty=Tr(vr);var kr=Cr,Mr=kr.light,Pr=kr.paintProperty,Ir=kr.layoutProperty;function Or(t,e){var n=!1;if(e&&e.length)for(var r=0,i=e;r<i.length;r+=1)t.fire(new Tt(new Error(i[r].message))),n=!0;return n}var Rr=Lr;function Lr(t,e,n){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(n=i[2]);for(var o=0;o<this.d*this.d;o++){var a=i[3+o],s=i[3+o+1];r.push(a===s?null:i.subarray(a,s))}var u=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],u),this.bboxes=i.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var l=0;l<this.d*this.d;l++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var c=n/e*t;this.min=-c,this.max=t+c}Lr.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Lr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Lr.prototype._insertCell=function(t,e,n,r,i,o){this.cells[i].push(o)},Lr.prototype.query=function(t,e,n,r,i){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=n&&a<=r&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,n,r,this._queryCell,s,{},i),s},Lr.prototype._queryCell=function(t,e,n,r,i,o,a,s){var u=this.cells[i];if(null!==u)for(var l=this.keys,c=this.bboxes,h=0;h<u.length;h++){var f=u[h];if(void 0===a[f]){var p=4*f;(s?s(c[p+0],c[p+1],c[p+2],c[p+3]):t<=c[p+2]&&e<=c[p+3]&&n>=c[p+0]&&r>=c[p+1])?(a[f]=!0,o.push(l[f])):a[f]=!1}}},Lr.prototype._forEachCell=function(t,e,n,r,i,o,a,s){for(var u=this._convertToCellCoord(t),l=this._convertToCellCoord(e),c=this._convertToCellCoord(n),h=this._convertToCellCoord(r),f=u;f<=c;f++)for(var p=l;p<=h;p++){var d=this.d*p+f;if((!s||s(this._convertFromCellCoord(f),this._convertFromCellCoord(p),this._convertFromCellCoord(f+1),this._convertFromCellCoord(p+1)))&&i.call(this,t,e,n,r,d,o,a,s))return}},Lr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Lr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Lr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var i=new Int32Array(e+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];i[3+a]=o,i.set(s,o),o+=s.length}return i[3+t.length]=o,i.set(this.keys,o),i[3+t.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var Dr=a.ImageData,Nr=a.ImageBitmap,Br={};function zr(t,e,n){void 0===n&&(n={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Br[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}for(var Fr in zr("Object",Object),Rr.serialize=function(t,e){var n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},Rr.deserialize=function(t){return new Rr(t.buffer)},zr("Grid",Rr),zr("Color",te),zr("Error",Error),zr("ResolvedImage",ie),zr("StylePropertyFunction",Qn),zr("StyleExpression",Wn,{omit:["_evaluator"]}),zr("ZoomDependentExpression",qn),zr("ZoomConstantExpression",Yn),zr("CompoundExpression",_e,{omit:["_evaluate"]}),Tn)Tn[Fr]._classRegistryKey||zr("Expression_"+Fr,Tn[Fr]);function Zr(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function jr(t){return Nr&&t instanceof Nr}function Ur(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Zr(t)||jr(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var n=t;return e&&e.push(n.buffer),n}if(t instanceof Dr)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var r=[],i=0,o=t;i<o.length;i+=1)r.push(Ur(o[i],e));return r}if("object"==typeof t){var a=t.constructor,s=a._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var u=a.serialize?a.serialize(t,e):{};if(!a.serialize){for(var l in t)if(t.hasOwnProperty(l)&&!(Br[s].omit.indexOf(l)>=0)){var c=t[l];u[l]=Br[s].shallow.indexOf(l)>=0?c:Ur(c,e)}t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function Gr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Zr(t)||jr(t)||ArrayBuffer.isView(t)||t instanceof Dr)return t;if(Array.isArray(t))return t.map(Gr);if("object"==typeof t){var e=t.$name||"Object",n=Br[e].klass;if(!n)throw new Error("can't deserialize unregistered class "+e);if(n.deserialize)return n.deserialize(t);for(var r=Object.create(n.prototype),i=0,o=Object.keys(t);i<o.length;i+=1){var a=o[i];if("$name"!==a){var s=t[a];r[a]=Br[e].shallow.indexOf(a)>=0?s:Gr(s)}}return r}throw new Error("can't deserialize object of type "+typeof t)}var Vr=function(){this.first=!0};Vr.prototype.update=function(t,e){var n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))};var Wr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function Hr(t){for(var e=0,n=t;e<n.length;e+=1)if(Xr(n[e].charCodeAt(0)))return!0;return!1}function Xr(t){return!(746!==t&&747!==t&&(t<4352||!(Wr["Bopomofo Extended"](t)||Wr.Bopomofo(t)||Wr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Wr["CJK Compatibility Ideographs"](t)||Wr["CJK Compatibility"](t)||Wr["CJK Radicals Supplement"](t)||Wr["CJK Strokes"](t)||!(!Wr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Wr["CJK Unified Ideographs Extension A"](t)||Wr["CJK Unified Ideographs"](t)||Wr["Enclosed CJK Letters and Months"](t)||Wr["Hangul Compatibility Jamo"](t)||Wr["Hangul Jamo Extended-A"](t)||Wr["Hangul Jamo Extended-B"](t)||Wr["Hangul Jamo"](t)||Wr["Hangul Syllables"](t)||Wr.Hiragana(t)||Wr["Ideographic Description Characters"](t)||Wr.Kanbun(t)||Wr["Kangxi Radicals"](t)||Wr["Katakana Phonetic Extensions"](t)||Wr.Katakana(t)&&12540!==t||!(!Wr["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Wr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Wr["Unified Canadian Aboriginal Syllabics"](t)||Wr["Unified Canadian Aboriginal Syllabics Extended"](t)||Wr["Vertical Forms"](t)||Wr["Yijing Hexagram Symbols"](t)||Wr["Yi Syllables"](t)||Wr["Yi Radicals"](t))))}function Yr(t){return!(Xr(t)||function(t){return!!(Wr["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Wr["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Wr["Letterlike Symbols"](t)||Wr["Number Forms"](t)||Wr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Wr["Control Pictures"](t)&&9251!==t||Wr["Optical Character Recognition"](t)||Wr["Enclosed Alphanumerics"](t)||Wr["Geometric Shapes"](t)||Wr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Wr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Wr["CJK Symbols and Punctuation"](t)||Wr.Katakana(t)||Wr["Private Use Area"](t)||Wr["CJK Compatibility Forms"](t)||Wr["Small Form Variants"](t)||Wr["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function qr(t){return t>=1424&&t<=2303||Wr["Arabic Presentation Forms-A"](t)||Wr["Arabic Presentation Forms-B"](t)}function Kr(t,e){return!(!e&&qr(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Wr.Khmer(t))}function Qr(t){for(var e=0,n=t;e<n.length;e+=1)if(qr(n[e].charCodeAt(0)))return!0;return!1}var Jr=null,$r="unavailable",ti=null,ei=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&($r="error"),Jr&&Jr(t)};function ni(){ri.fire(new At("pluginStateChange",{pluginStatus:$r,pluginURL:ti}))}var ri=new kt,ii=function(){return $r},oi=function(){if("deferred"!==$r||!ti)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$r="loading",ni(),ti&&bt({url:ti},(function(t){t?ei(t):($r="loaded",ni())}))},ai={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===$r||null!=ai.applyArabicShaping},isLoading:function(){return"loading"===$r},setState:function(t){$r=t.pluginStatus,ti=t.pluginURL},isParsed:function(){return null!=ai.applyArabicShaping&&null!=ai.processBidirectionalText&&null!=ai.processStyledBidirectionalText},getPluginURL:function(){return ti}},si=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vr,this.transition={})};si.prototype.isSupportedScript=function(t){return function(t,e){for(var n=0,r=t;n<r.length;n+=1)if(!Kr(r[n].charCodeAt(0),e))return!1;return!0}(t,ai.isLoaded())},si.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},si.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}};var ui=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(zn(t))return new Qn(t,e);if(Hn(t)){var n=Kn(t,e);if("error"===n.result)throw new Error(n.value.map((function(t){return t.key+": "+t.message})).join(", "));return n.value}var r=t;return"string"==typeof t&&"color"===e.type&&(r=te.parse(t)),{kind:"constant",evaluate:function(){return r}}}(void 0===e?t.specification.default:e,t.specification)};ui.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},ui.prototype.possiblyEvaluate=function(t,e,n){return this.property.possiblyEvaluate(this,t,e,n)};var li=function(t){this.property=t,this.value=new ui(t,void 0)};li.prototype.transitioned=function(t,e){return new hi(this.property,this.value,e,f({},t.transition,this.transition),t.now)},li.prototype.untransitioned=function(){return new hi(this.property,this.value,null,{},0)};var ci=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};ci.prototype.getValue=function(t){return x(this._values[t].value.value)},ci.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new li(this._values[t].property)),this._values[t].value=new ui(this._values[t].property,null===e?void 0:x(e))},ci.prototype.getTransition=function(t){return x(this._values[t].transition)},ci.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new li(this._values[t].property)),this._values[t].transition=x(e)||void 0},ci.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e],i=this.getValue(r);void 0!==i&&(t[r]=i);var o=this.getTransition(r);void 0!==o&&(t[r+"-transition"]=o)}return t},ci.prototype.transitioned=function(t,e){for(var n=new fi(this._properties),r=0,i=Object.keys(this._values);r<i.length;r+=1){var o=i[r];n._values[o]=this._values[o].transitioned(t,e._values[o])}return n},ci.prototype.untransitioned=function(){for(var t=new fi(this._properties),e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e];t._values[r]=this._values[r].untransitioned()}return t};var hi=function(t,e,n,r,i){this.property=t,this.value=e,this.begin=i+r.delay||0,this.end=this.begin+r.duration||0,t.specification.transition&&(r.delay||r.duration)&&(this.prior=n)};hi.prototype.possiblyEvaluate=function(t,e,n){var r=t.now||0,i=this.value.possiblyEvaluate(t,e,n),o=this.prior;if(o){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return o.possiblyEvaluate(t,e,n);var a=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,n),i,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}(a))}return i};var fi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};fi.prototype.possiblyEvaluate=function(t,e,n){for(var r=new gi(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];r._values[a]=this._values[a].possiblyEvaluate(t,e,n)}return r},fi.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var pi=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};pi.prototype.getValue=function(t){return x(this._values[t].value)},pi.prototype.setValue=function(t,e){this._values[t]=new ui(this._values[t].property,null===e?void 0:x(e))},pi.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e],i=this.getValue(r);void 0!==i&&(t[r]=i)}return t},pi.prototype.possiblyEvaluate=function(t,e,n){for(var r=new gi(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];r._values[a]=this._values[a].possiblyEvaluate(t,e,n)}return r};var di=function(t,e,n){this.property=t,this.value=e,this.parameters=n};di.prototype.isConstant=function(){return"constant"===this.value.kind},di.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},di.prototype.evaluate=function(t,e,n,r){return this.property.evaluate(this.value,this.parameters,t,e,n,r)};var gi=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};gi.prototype.get=function(t){return this._values[t]};var vi=function(t){this.specification=t};vi.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},vi.prototype.interpolate=function(t,e,n){var r=We[this.specification.type];return r?r(t,e,n):t};var mi=function(t,e){this.specification=t,this.overrides=e};mi.prototype.possiblyEvaluate=function(t,e,n,r){return new di(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},n,r)}:t.expression,e)},mi.prototype.interpolate=function(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new di(this,{kind:"constant",value:void 0},t.parameters);var r=We[this.specification.type];return r?new di(this,{kind:"constant",value:r(t.value.value,e.value.value,n)},t.parameters):t},mi.prototype.evaluate=function(t,e,n,r,i,o){return"constant"===t.kind?t.value:t.evaluate(e,n,r,i,o)};var yi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e,n,r){if(void 0===t.value)return new di(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},n,r),o="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,a=this._calculate(o,o,o,e);return new di(this,{kind:"constant",value:a},e)}if("camera"===t.expression.kind){var s=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new di(this,{kind:"constant",value:s},e)}return new di(this,t.expression,e)},e.prototype.evaluate=function(t,e,n,r,i,o){if("source"===t.kind){var a=t.evaluate(e,n,r,i,o);return this._calculate(a,a,a,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,r),t.evaluate({zoom:Math.floor(e.zoom)},n,r),t.evaluate({zoom:Math.floor(e.zoom)+1},n,r),e):t.value},e.prototype._calculate=function(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},e.prototype.interpolate=function(t){return t},e}(mi),_i=function(t){this.specification=t};_i.prototype.possiblyEvaluate=function(t,e,n,r){if(void 0!==t.value){if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},n,r);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new si(Math.floor(e.zoom-1),e)),t.expression.evaluate(new si(Math.floor(e.zoom),e)),t.expression.evaluate(new si(Math.floor(e.zoom+1),e)),e)}},_i.prototype._calculate=function(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},_i.prototype.interpolate=function(t){return t};var bi=function(t){this.specification=t};bi.prototype.possiblyEvaluate=function(t,e,n,r){return!!t.expression.evaluate(e,null,{},n,r)},bi.prototype.interpolate=function(){return!1};var xi=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var n=t[e];n.specification.overridable&&this.overridableProperties.push(e);var r=this.defaultPropertyValues[e]=new ui(n,void 0),i=this.defaultTransitionablePropertyValues[e]=new li(n);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({})}};zr("DataDrivenProperty",mi),zr("DataConstantProperty",vi),zr("CrossFadedDataDrivenProperty",yi),zr("CrossFadedProperty",_i),zr("ColorRampProperty",bi);var wi=function(t){function e(e,n){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new pi(n.layout)),n.paint)){for(var r in this._transitionablePaint=new ci(n.paint),e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(var i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new gi(n.paint)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,n){void 0===n&&(n={}),null!=e&&this._validate(Ir,"layers."+this.id+".layout."+t,t,e,n)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)},e.prototype.getPaintProperty=function(t){return y(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,n){if(void 0===n&&(n={}),null!=e&&this._validate(Pr,"layers."+this.id+".paint."+t,t,e,n))return!1;if(y(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var r=this._transitionablePaint._values[t],i="cross-faded-data-driven"===r.property.specification["property-type"],o=r.value.isDataDriven(),a=r.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||o||i||this._handleOverridablePaintPropertyUpdate(t,a,s)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,n){return!1},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),b(t,(function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,n,r,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&Or(this,t.call(kr,{key:e,layerType:this.type,objectKey:n,value:r,styleSpec:Mt,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof di&&Ln(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(kt),Ei={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Si=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ci=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ai(t,e){void 0===e&&(e=1);var n=0,r=0;return{members:t.map((function(t){var i=Ei[t.type].BYTES_PER_ELEMENT,o=n=Ti(n,Math.max(e,i)),a=t.components||1;return r=Math.max(r,i),n+=i*a,{name:t.name,type:t.type,components:a,offset:o}})),size:Ti(n,Math.max(r,e)),alignment:e}}function Ti(t,e){return Math.ceil(t/e)*e}Ci.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Ci.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Ci.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ci.prototype.clear=function(){this.length=0},Ci.prototype.resize=function(t){this.reserve(t),this.length=t},Ci.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Ci.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var ki=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.int16[r+0]=e,this.int16[r+1]=n,t},e}(Ci);ki.prototype.bytesPerElement=4,zr("StructArrayLayout2i4",ki);var Mi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=4*t;return this.int16[o+0]=e,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,t},e}(Ci);Mi.prototype.bytesPerElement=8,zr("StructArrayLayout4i8",Mi);var Pi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Ci);Pi.prototype.bytesPerElement=12,zr("StructArrayLayout2i4i12",Pi);var Ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=4*t,u=8*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.uint8[u+4]=r,this.uint8[u+5]=i,this.uint8[u+6]=o,this.uint8[u+7]=a,t},e}(Ci);Ii.prototype.bytesPerElement=8,zr("StructArrayLayout2i4ub8",Ii);var Oi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.float32[r+0]=e,this.float32[r+1]=n,t},e}(Ci);Oi.prototype.bytesPerElement=8,zr("StructArrayLayout2f8",Oi);var Ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l){var c=this.length;return this.resize(c+1),this.emplace(c,t,e,n,r,i,o,a,s,u,l)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c){var h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=n,this.uint16[h+2]=r,this.uint16[h+3]=i,this.uint16[h+4]=o,this.uint16[h+5]=a,this.uint16[h+6]=s,this.uint16[h+7]=u,this.uint16[h+8]=l,this.uint16[h+9]=c,t},e}(Ci);Ri.prototype.bytesPerElement=20,zr("StructArrayLayout10ui20",Ri);var Li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,h){var f=this.length;return this.resize(f+1),this.emplace(f,t,e,n,r,i,o,a,s,u,l,c,h)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,h,f){var p=12*t;return this.int16[p+0]=e,this.int16[p+1]=n,this.int16[p+2]=r,this.int16[p+3]=i,this.uint16[p+4]=o,this.uint16[p+5]=a,this.uint16[p+6]=s,this.uint16[p+7]=u,this.int16[p+8]=l,this.int16[p+9]=c,this.int16[p+10]=h,this.int16[p+11]=f,t},e}(Ci);Li.prototype.bytesPerElement=24,zr("StructArrayLayout4i4ui4i24",Li);var Di=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.float32[i+0]=e,this.float32[i+1]=n,this.float32[i+2]=r,t},e}(Ci);Di.prototype.bytesPerElement=12,zr("StructArrayLayout3f12",Di);var Ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(Ci);Ni.prototype.bytesPerElement=4,zr("StructArrayLayout1ul4",Ni);var Bi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u){var l=this.length;return this.resize(l+1),this.emplace(l,t,e,n,r,i,o,a,s,u)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l){var c=10*t,h=5*t;return this.int16[c+0]=e,this.int16[c+1]=n,this.int16[c+2]=r,this.int16[c+3]=i,this.int16[c+4]=o,this.int16[c+5]=a,this.uint32[h+3]=s,this.uint16[c+8]=u,this.uint16[c+9]=l,t},e}(Ci);Bi.prototype.bytesPerElement=20,zr("StructArrayLayout6i1ul2ui20",Bi);var zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Ci);zi.prototype.bytesPerElement=12,zr("StructArrayLayout2i2i2i12",zi);var Fi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,r,i)},e.prototype.emplace=function(t,e,n,r,i,o){var a=4*t,s=8*t;return this.float32[a+0]=e,this.float32[a+1]=n,this.float32[a+2]=r,this.int16[s+6]=i,this.int16[s+7]=o,t},e}(Ci);Fi.prototype.bytesPerElement=16,zr("StructArrayLayout2f1f2i16",Fi);var Zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=n,this.float32[a+1]=r,this.float32[a+2]=i,t},e}(Ci);Zi.prototype.bytesPerElement=12,zr("StructArrayLayout2ub2f12",Zi);var ji=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,this.uint16[i+2]=r,t},e}(Ci);ji.prototype.bytesPerElement=6,zr("StructArrayLayout3ui6",ji);var Ui=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,h,f,p,d,g,v){var m=this.length;return this.resize(m+1),this.emplace(m,t,e,n,r,i,o,a,s,u,l,c,h,f,p,d,g,v)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,h,f,p,d,g,v,m){var y=24*t,_=12*t,b=48*t;return this.int16[y+0]=e,this.int16[y+1]=n,this.uint16[y+2]=r,this.uint16[y+3]=i,this.uint32[_+2]=o,this.uint32[_+3]=a,this.uint32[_+4]=s,this.uint16[y+10]=u,this.uint16[y+11]=l,this.uint16[y+12]=c,this.float32[_+7]=h,this.float32[_+8]=f,this.uint8[b+36]=p,this.uint8[b+37]=d,this.uint8[b+38]=g,this.uint32[_+10]=v,this.int16[y+22]=m,t},e}(Ci);Ui.prototype.bytesPerElement=48,zr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ui);var Gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,h,f,p,d,g,v,m,y,_,b,x,w,E,S,C,A,T){var k=this.length;return this.resize(k+1),this.emplace(k,t,e,n,r,i,o,a,s,u,l,c,h,f,p,d,g,v,m,y,_,b,x,w,E,S,C,A,T)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,h,f,p,d,g,v,m,y,_,b,x,w,E,S,C,A,T,k){var M=34*t,P=17*t;return this.int16[M+0]=e,this.int16[M+1]=n,this.int16[M+2]=r,this.int16[M+3]=i,this.int16[M+4]=o,this.int16[M+5]=a,this.int16[M+6]=s,this.int16[M+7]=u,this.uint16[M+8]=l,this.uint16[M+9]=c,this.uint16[M+10]=h,this.uint16[M+11]=f,this.uint16[M+12]=p,this.uint16[M+13]=d,this.uint16[M+14]=g,this.uint16[M+15]=v,this.uint16[M+16]=m,this.uint16[M+17]=y,this.uint16[M+18]=_,this.uint16[M+19]=b,this.uint16[M+20]=x,this.uint16[M+21]=w,this.uint16[M+22]=E,this.uint32[P+12]=S,this.float32[P+13]=C,this.float32[P+14]=A,this.float32[P+15]=T,this.float32[P+16]=k,t},e}(Ci);Gi.prototype.bytesPerElement=68,zr("StructArrayLayout8i15ui1ul4f68",Gi);var Vi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(Ci);Vi.prototype.bytesPerElement=4,zr("StructArrayLayout1f4",Vi);var Wi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.int16[i+0]=e,this.int16[i+1]=n,this.int16[i+2]=r,t},e}(Ci);Wi.prototype.bytesPerElement=6,zr("StructArrayLayout3i6",Wi);var Hi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=4*t;return this.uint32[2*t+0]=e,this.uint16[i+2]=n,this.uint16[i+3]=r,t},e}(Ci);Hi.prototype.bytesPerElement=8,zr("StructArrayLayout1ul2ui8",Hi);var Xi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,t},e}(Ci);Xi.prototype.bytesPerElement=4,zr("StructArrayLayout2ui4",Xi);var Yi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(Ci);Yi.prototype.bytesPerElement=2,zr("StructArrayLayout1ui2",Yi);var qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=4*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=r,this.float32[o+3]=i,t},e}(Ci);qi.prototype.bytesPerElement=16,zr("StructArrayLayout4f16",qi);var Ki=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return n.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},n.x1.get=function(){return this._structArray.int16[this._pos2+2]},n.y1.get=function(){return this._structArray.int16[this._pos2+3]},n.x2.get=function(){return this._structArray.int16[this._pos2+4]},n.y2.get=function(){return this._structArray.int16[this._pos2+5]},n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.anchorPoint.get=function(){return new i(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,n),e}(Si);Ki.prototype.size=20;var Qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Ki(this,t)},e}(Bi);zr("CollisionBoxArray",Qi);var Ji=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},n.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},n.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},n.segment.get=function(){return this._structArray.uint16[this._pos2+10]},n.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},n.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},n.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},n.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},n.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},n.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},n.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},n.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},n.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},n.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,n),e}(Si);Ji.prototype.size=48;var $i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Ji(this,t)},e}(Ui);zr("PlacedSymbolArray",$i);var to=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},n.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},n.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},n.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},n.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},n.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},n.key.get=function(){return this._structArray.uint16[this._pos2+8]},n.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},n.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},n.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},n.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},n.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},n.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},n.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},n.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},n.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},n.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},n.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},n.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},n.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+12]=t},n.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},n.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},n.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},n.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,n),e}(Si);to.prototype.size=68;var eo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new to(this,t)},e}(Gi);zr("SymbolInstanceArray",eo);var no=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e}(Vi);zr("GlyphOffsetArray",no);var ro=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e}(Wi);zr("SymbolLineVertexArray",ro);var io=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,n),e}(Si);io.prototype.size=8;var oo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new io(this,t)},e}(Hi);zr("FeatureIndexArray",oo);var ao=Ai([{name:"a_pos",components:2,type:"Int16"}],4).members,so=function(t){void 0===t&&(t=[]),this.segments=t};function uo(t,e){return 256*(t=c(Math.floor(t),0,255))+c(Math.floor(e),0,255)}so.prototype.prepareSegment=function(t,e,n,r){var i=this.segments[this.segments.length-1];return t>so.MAX_VERTEX_ARRAY_LENGTH&&E("Max vertices per segment is "+so.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>so.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r)&&(i={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==r&&(i.sortKey=r),this.segments.push(i)),i},so.prototype.get=function(){return this.segments},so.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var n=e[t];for(var r in n.vaos)n.vaos[r].destroy()}},so.simpleSegment=function(t,e,n,r){return new so([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])},so.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zr("SegmentVector",so);var lo=Ai([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),co=e((function(t){t.exports=function(t,e){var n,r,i,o,a,s,u,l;for(r=t.length-(n=3&t.length),i=e,a=3432918353,s=461845907,l=0;l<r;)u=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,i=27492+(65535&(o=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(u=0,n){case 3:u^=(255&t.charCodeAt(l+2))<<16;case 2:u^=(255&t.charCodeAt(l+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(l)))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),ho=e((function(t){t.exports=function(t,e){for(var n,r=t.length,i=e^r,o=0;r>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),fo=co,po=ho;fo.murmur3=co,fo.murmur2=po;var go=function(){this.ids=[],this.positions=[],this.indexed=!1};go.prototype.add=function(t,e,n,r){this.ids.push(mo(t)),this.positions.push(e,n,r)},go.prototype.getPositions=function(t){for(var e=mo(t),n=0,r=this.ids.length-1;n<r;){var i=n+r>>1;this.ids[i]>=e?r=i:n=i+1}for(var o=[];this.ids[n]===e;)o.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return o},go.serialize=function(t,e){var n=new Float64Array(t.ids),r=new Uint32Array(t.positions);return function t(e,n,r,i){for(;r<i;){for(var o=e[r+i>>1],a=r-1,s=i+1;;){do{a++}while(e[a]<o);do{s--}while(e[s]>o);if(a>=s)break;yo(e,a,s),yo(n,3*a,3*s),yo(n,3*a+1,3*s+1),yo(n,3*a+2,3*s+2)}s-r<i-s?(t(e,n,r,s),r=s+1):(t(e,n,s+1,i),i=s)}}(n,r,0,n.length-1),e&&e.push(n.buffer,r.buffer),{ids:n,positions:r}},go.deserialize=function(t){var e=new go;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var vo=Math.pow(2,53)-1;function mo(t){var e=+t;return!isNaN(e)&&e<=vo?e:fo(String(t))}function yo(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}zr("FeaturePositionMap",go);var _o=function(t,e){this.gl=t.gl,this.location=e},bo=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(_o),xo=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(_o),wo=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(_o),Eo=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(_o),So=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(_o),Co=function(t){function e(e,n){t.call(this,e,n),this.current=te.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(_o),Ao=new Float32Array(16),To=function(t){function e(e,n){t.call(this,e,n),this.current=Ao}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(_o);function ko(t){return[uo(255*t.r,255*t.g),uo(255*t.b,255*t.a)]}var Mo=function(t,e,n){this.value=t,this.uniformNames=e.map((function(t){return"u_"+t})),this.type=n};Mo.prototype.setUniform=function(t,e,n){t.set(n.constantOr(this.value))},Mo.prototype.getBinding=function(t,e,n){return"color"===this.type?new Co(t,e):new xo(t,e)};var Po=function(t,e){this.uniformNames=e.map((function(t){return"u_"+t})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Po.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},Po.prototype.setUniform=function(t,e,n,r){var i="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;i&&t.set(i)},Po.prototype.getBinding=function(t,e,n){return"u_pattern"===n.substr(0,9)?new So(t,e):new xo(t,e)};var Io=function(t,e,n,r){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?2:1,offset:0}})),this.paintVertexArray=new r};Io.prototype.populatePaintArray=function(t,e,n,r,i){var o=this.paintVertexArray.length,a=this.expression.evaluate(new si(0),e,{},r,[],i);this.paintVertexArray.resize(t),this._setPaintValue(o,t,a)},Io.prototype.updatePaintArray=function(t,e,n,r){var i=this.expression.evaluate({zoom:0},n,r);this._setPaintValue(t,e,i)},Io.prototype._setPaintValue=function(t,e,n){if("color"===this.type)for(var r=ko(n),i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1]);else{for(var o=t;o<e;o++)this.paintVertexArray.emplace(o,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}},Io.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Io.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Oo=function(t,e,n,r,i,o){this.expression=t,this.uniformNames=e.map((function(t){return"u_"+t+"_t"})),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?4:2,offset:0}})),this.paintVertexArray=new o};Oo.prototype.populatePaintArray=function(t,e,n,r,i){var o=this.expression.evaluate(new si(this.zoom),e,{},r,[],i),a=this.expression.evaluate(new si(this.zoom+1),e,{},r,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,o,a)},Oo.prototype.updatePaintArray=function(t,e,n,r){var i=this.expression.evaluate({zoom:this.zoom},n,r),o=this.expression.evaluate({zoom:this.zoom+1},n,r);this._setPaintValue(t,e,i,o)},Oo.prototype._setPaintValue=function(t,e,n,r){if("color"===this.type)for(var i=ko(n),o=ko(r),a=t;a<e;a++)this.paintVertexArray.emplace(a,i[0],i[1],o[0],o[1]);else{for(var s=t;s<e;s++)this.paintVertexArray.emplace(s,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}},Oo.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Oo.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Oo.prototype.setUniform=function(t,e){var n=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,r=c(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(r)},Oo.prototype.getBinding=function(t,e,n){return new xo(t,e)};var Ro=function(t,e,n,r,i,o){this.expression=t,this.type=e,this.useIntegerZoom=n,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i};Ro.prototype.populatePaintArray=function(t,e,n){var r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],n)},Ro.prototype.updatePaintArray=function(t,e,n,r,i){this._setPaintValues(t,e,n.patterns&&n.patterns[this.layerId],i)},Ro.prototype._setPaintValues=function(t,e,n,r){if(r&&n){var i=r[n.min],o=r[n.mid],a=r[n.max];if(i&&o&&a)for(var s=t;s<e;s++)this.zoomInPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],o.pixelRatio,i.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],o.pixelRatio,a.pixelRatio)}},Ro.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,lo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,lo.members,this.expression.isStateDependent))},Ro.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Lo=function(t,e,n){this.binders={},this._buffers=[];var r=[];for(var i in t.paint._values)if(n(i)){var o=t.paint.get(i);if(o instanceof di&&Ln(o.property.specification)){var a=No(i,t.type),s=o.value,u=o.property.specification.type,l=o.property.useIntegerZoom,c=o.property.specification["property-type"],h="cross-faded"===c||"cross-faded-data-driven"===c;if("constant"===s.kind)this.binders[i]=h?new Po(s.value,a):new Mo(s.value,a,u),r.push("/u_"+i);else if("source"===s.kind||h){var f=Bo(i,u,"source");this.binders[i]=h?new Ro(s,u,l,e,f,t.id):new Io(s,a,u,f),r.push("/a_"+i)}else{var p=Bo(i,u,"composite");this.binders[i]=new Oo(s,a,u,l,e,p),r.push("/z_"+i)}}}this.cacheKey=r.sort().join("")};Lo.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof Io||e instanceof Oo?e.maxValue:0},Lo.prototype.populatePaintArrays=function(t,e,n,r,i){for(var o in this.binders){var a=this.binders[o];(a instanceof Io||a instanceof Oo||a instanceof Ro)&&a.populatePaintArray(t,e,n,r,i)}},Lo.prototype.setConstantPatternPositions=function(t,e){for(var n in this.binders){var r=this.binders[n];r instanceof Po&&r.setConstantPatternPositions(t,e)}},Lo.prototype.updatePaintArrays=function(t,e,n,r,i){var o=!1;for(var a in t)for(var s=0,u=e.getPositions(a);s<u.length;s+=1){var l=u[s],c=n.feature(l.index);for(var h in this.binders){var f=this.binders[h];if((f instanceof Io||f instanceof Oo||f instanceof Ro)&&!0===f.expression.isStateDependent){var p=r.paint.get(h);f.expression=p.value,f.updatePaintArray(l.start,l.end,c,t[a],i),o=!0}}}return o},Lo.prototype.defines=function(){var t=[];for(var e in this.binders){var n=this.binders[e];(n instanceof Mo||n instanceof Po)&&t.push.apply(t,n.uniformNames.map((function(t){return"#define HAS_UNIFORM_"+t})))}return t},Lo.prototype.getBinderAttributes=function(){var t=[];for(var e in this.binders){var n=this.binders[e];if(n instanceof Io||n instanceof Oo)for(var r=0;r<n.paintVertexAttributes.length;r++)t.push(n.paintVertexAttributes[r].name);else if(n instanceof Ro)for(var i=0;i<lo.members.length;i++)t.push(lo.members[i].name)}return t},Lo.prototype.getBinderUniforms=function(){var t=[];for(var e in this.binders){var n=this.binders[e];if(n instanceof Mo||n instanceof Po||n instanceof Oo)for(var r=0,i=n.uniformNames;r<i.length;r+=1)t.push(i[r])}return t},Lo.prototype.getPaintVertexBuffers=function(){return this._buffers},Lo.prototype.getUniforms=function(t,e){var n=[];for(var r in this.binders){var i=this.binders[r];if(i instanceof Mo||i instanceof Po||i instanceof Oo)for(var o=0,a=i.uniformNames;o<a.length;o+=1){var s=a[o];if(e[s]){var u=i.getBinding(t,e[s],s);n.push({name:s,property:r,binding:u})}}}return n},Lo.prototype.setUniforms=function(t,e,n,r){for(var i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.name,u=a.property;this.binders[u].setUniform(a.binding,r,n.get(u),s)}},Lo.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var n=this.binders[e];if(t&&n instanceof Ro){var r=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;r&&this._buffers.push(r)}else(n instanceof Io||n instanceof Oo)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}},Lo.prototype.upload=function(t){for(var e in this.binders){var n=this.binders[e];(n instanceof Io||n instanceof Oo||n instanceof Ro)&&n.upload(t)}this.updatePaintBuffers()},Lo.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof Io||e instanceof Oo||e instanceof Ro)&&e.destroy()}};var Do=function(t,e,n){void 0===n&&(n=function(){return!0}),this.programConfigurations={};for(var r=0,i=t;r<i.length;r+=1){var o=i[r];this.programConfigurations[o.id]=new Lo(o,e,n)}this.needsUpload=!1,this._featureMap=new go,this._bufferOffset=0};function No(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function Bo(t,e,n){var r={color:{source:Oi,composite:qi},number:{source:Vi,composite:Oi}},i=function(t){return{"line-pattern":{source:Ri,composite:Ri},"fill-pattern":{source:Ri,composite:Ri},"fill-extrusion-pattern":{source:Ri,composite:Ri}}[t]}(t);return i&&i[n]||r[e][n]}Do.prototype.populatePaintArrays=function(t,e,n,r,i,o){for(var a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(t,e,r,i,o);void 0!==e.id&&this._featureMap.add(e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Do.prototype.updatePaintArrays=function(t,e,n,r){for(var i=0,o=n;i<o.length;i+=1){var a=o[i];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,e,a,r)||this.needsUpload}},Do.prototype.get=function(t){return this.programConfigurations[t]},Do.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},Do.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},zr("ConstantBinder",Mo),zr("CrossFadedConstantBinder",Po),zr("SourceExpressionBinder",Io),zr("CrossFadedCompositeBinder",Ro),zr("CompositeExpressionBinder",Oo),zr("ProgramConfiguration",Lo,{omit:["_buffers"]}),zr("ProgramConfigurationSet",Do);var zo=Math.pow(2,14)-1,Fo=-zo-1;function Zo(t){for(var e=8192/t.extent,n=t.loadGeometry(),r=0;r<n.length;r++)for(var i=n[r],o=0;o<i.length;o++){var a=i[o],s=Math.round(a.x*e),u=Math.round(a.y*e);a.x=c(s,Fo,zo),a.y=c(u,Fo,zo),(s<a.x||s>a.x+1||u<a.y||u>a.y+1)&&E("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return n}function jo(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Zo(t):[]}}function Uo(t,e,n,r,i){t.emplaceBack(2*e+(r+1)/2,2*n+(i+1)/2)}var Go=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ki,this.indexArray=new ji,this.segments=new so,this.programConfigurations=new Do(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Vo(t,e){for(var n=0;n<t.length;n++)if($o(e,t[n]))return!0;for(var r=0;r<e.length;r++)if($o(t,e[r]))return!0;return!!Yo(t,e)}function Wo(t,e,n){return!!$o(t,e)||!!Ko(e,t,n)}function Ho(t,e){if(1===t.length)return Jo(e,t[0]);for(var n=0;n<e.length;n++)for(var r=e[n],i=0;i<r.length;i++)if($o(t,r[i]))return!0;for(var o=0;o<t.length;o++)if(Jo(e,t[o]))return!0;for(var a=0;a<e.length;a++)if(Yo(t,e[a]))return!0;return!1}function Xo(t,e,n){if(t.length>1){if(Yo(t,e))return!0;for(var r=0;r<e.length;r++)if(Ko(e[r],t,n))return!0}for(var i=0;i<t.length;i++)if(Ko(t[i],e,n))return!0;return!1}function Yo(t,e){if(0===t.length||0===e.length)return!1;for(var n=0;n<t.length-1;n++)for(var r=t[n],i=t[n+1],o=0;o<e.length-1;o++)if(qo(r,i,e[o],e[o+1]))return!0;return!1}function qo(t,e,n,r){return S(t,n,r)!==S(e,n,r)&&S(t,e,n)!==S(t,e,r)}function Ko(t,e,n){var r=n*n;if(1===e.length)return t.distSqr(e[0])<r;for(var i=1;i<e.length;i++)if(Qo(t,e[i-1],e[i])<r)return!0;return!1}function Qo(t,e,n){var r=e.distSqr(n);if(0===r)return t.distSqr(e);var i=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/r;return t.distSqr(i<0?e:i>1?n:n.sub(e)._mult(i)._add(e))}function Jo(t,e){for(var n,r,i,o=!1,a=0;a<t.length;a++)for(var s=0,u=(n=t[a]).length-1;s<n.length;u=s++)(r=n[s]).y>e.y!=(i=n[u]).y>e.y&&e.x<(i.x-r.x)*(e.y-r.y)/(i.y-r.y)+r.x&&(o=!o);return o}function $o(t,e){for(var n=!1,r=0,i=t.length-1;r<t.length;i=r++){var o=t[r],a=t[i];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}function ta(t,e,n){var r=n[0],i=n[2];if(t.x<r.x&&e.x<r.x||t.x>i.x&&e.x>i.x||t.y<r.y&&e.y<r.y||t.y>i.y&&e.y>i.y)return!1;var o=S(t,e,n[0]);return o!==S(t,e,n[1])||o!==S(t,e,n[2])||o!==S(t,e,n[3])}function ea(t,e,n){var r=e.paint.get(t).value;return"constant"===r.kind?r.value:n.programConfigurations.get(e.id).getMaxValue(t)}function na(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ra(t,e,n,r,o){if(!e[0]&&!e[1])return t;var a=i.convert(e)._mult(o);"viewport"===n&&a._rotate(-r);for(var s=[],u=0;u<t.length;u++)s.push(t[u].sub(a));return s}Go.prototype.populate=function(t,e,n){var r=this.layers[0],i=[],o=null;"circle"===r.type&&(o=r.layout.get("circle-sort-key"));for(var a=0,s=t;a<s.length;a+=1){var u=s[a],l=u.feature,c=u.id,h=u.index,f=u.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,d=jo(l,p);if(this.layers[0]._featureFilter.filter(new si(this.zoom),d,n)){var g=o?o.evaluate(d,{},n):void 0,v={id:c,properties:l.properties,type:l.type,sourceLayerIndex:f,index:h,geometry:p?d.geometry:Zo(l),patterns:{},sortKey:g};i.push(v)}}o&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var m=0,y=i;m<y.length;m+=1){var _=y[m],b=_.geometry,x=_.index,w=_.sourceLayerIndex,E=t[x].feature;this.addFeature(_,b,x,n),e.featureIndex.insert(E,b,x,w,this.index)}},Go.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Go.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Go.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Go.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ao),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Go.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Go.prototype.addFeature=function(t,e,n,r){for(var i=0,o=e;i<o.length;i+=1)for(var a=0,s=o[i];a<s.length;a+=1){var u=s[a],l=u.x,c=u.y;if(!(l<0||l>=8192||c<0||c>=8192)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),f=h.vertexLength;Uo(this.layoutVertexArray,l,c,-1,-1),Uo(this.layoutVertexArray,l,c,1,-1),Uo(this.layoutVertexArray,l,c,1,1),Uo(this.layoutVertexArray,l,c,-1,1),this.indexArray.emplaceBack(f,f+1,f+2),this.indexArray.emplaceBack(f,f+3,f+2),h.vertexLength+=4,h.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},r)},zr("CircleBucket",Go,{omit:["layers"]});var ia=new xi({"circle-sort-key":new mi(Mt.layout_circle["circle-sort-key"])}),oa={paint:new xi({"circle-radius":new mi(Mt.paint_circle["circle-radius"]),"circle-color":new mi(Mt.paint_circle["circle-color"]),"circle-blur":new mi(Mt.paint_circle["circle-blur"]),"circle-opacity":new mi(Mt.paint_circle["circle-opacity"]),"circle-translate":new vi(Mt.paint_circle["circle-translate"]),"circle-translate-anchor":new vi(Mt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new vi(Mt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new vi(Mt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mi(Mt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mi(Mt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mi(Mt.paint_circle["circle-stroke-opacity"])}),layout:ia},aa="undefined"!=typeof Float32Array?Float32Array:Array;function sa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ua(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],p=e[10],d=e[11],g=e[12],v=e[13],m=e[14],y=e[15],_=n[0],b=n[1],x=n[2],w=n[3];return t[0]=_*r+b*s+x*h+w*g,t[1]=_*i+b*u+x*f+w*v,t[2]=_*o+b*l+x*p+w*m,t[3]=_*a+b*c+x*d+w*y,t[4]=(_=n[4])*r+(b=n[5])*s+(x=n[6])*h+(w=n[7])*g,t[5]=_*i+b*u+x*f+w*v,t[6]=_*o+b*l+x*p+w*m,t[7]=_*a+b*c+x*d+w*y,t[8]=(_=n[8])*r+(b=n[9])*s+(x=n[10])*h+(w=n[11])*g,t[9]=_*i+b*u+x*f+w*v,t[10]=_*o+b*l+x*p+w*m,t[11]=_*a+b*c+x*d+w*y,t[12]=(_=n[12])*r+(b=n[13])*s+(x=n[14])*h+(w=n[15])*g,t[13]=_*i+b*u+x*f+w*v,t[14]=_*o+b*l+x*p+w*m,t[15]=_*a+b*c+x*d+w*y,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,n=arguments.length;n--;)e+=t[n]*t[n];return Math.sqrt(e)});var la,ca=ua;function ha(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}la=new aa(3),aa!=Float32Array&&(la[0]=0,la[1]=0,la[2]=0),function(){var t=new aa(4);aa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var fa=(function(){var t=new aa(2);aa!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function e(e){t.call(this,e,oa)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Go(t)},e.prototype.queryRadius=function(t){var e=t;return ea("circle-radius",this,e)+ea("circle-stroke-width",this,e)+na(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,o,a,s){for(var u=ra(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),l=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),c="map"===this.paint.get("circle-pitch-alignment"),h=c?u:function(t,e){return t.map((function(t){return pa(t,e)}))}(u,s),f=c?l*a:l,p=0,d=r;p<d.length;p+=1)for(var g=0,v=d[p];g<v.length;g+=1){var m=v[g],y=c?m:pa(m,s),_=f,b=ha([],[m.x,m.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?_*=b[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(_*=o.cameraToCenterDistance/b[3]),Wo(h,y,_))return!0}return!1},e}(wi));function pa(t,e){var n=ha([],[t.x,t.y,0,1],e);return new i(n[0]/n[3],n[1]/n[3])}var da=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Go);function ga(t,e,n,r){var i=e.width,o=e.height;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==i*o*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*o*n);return t.width=i,t.height=o,t.data=r,t}function va(t,e,n){var r=e.width,i=e.height;if(r!==t.width||i!==t.height){var o=ga({},{width:r,height:i},n);ma(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,i)},n),t.width=r,t.height=i,t.data=o.data}}function ma(t,e,n,r,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,u=0;u<i.height;u++)for(var l=((n.y+u)*t.width+n.x)*o,c=((r.y+u)*e.width+r.x)*o,h=0;h<i.width*o;h++)s[c+h]=a[l+h];return e}zr("HeatmapBucket",da,{omit:["layers"]});var ya=function(t,e){ga(this,t,1,e)};ya.prototype.resize=function(t){va(this,t,1)},ya.prototype.clone=function(){return new ya({width:this.width,height:this.height},new Uint8Array(this.data))},ya.copy=function(t,e,n,r,i){ma(t,e,n,r,i,1)};var _a=function(t,e){ga(this,t,4,e)};_a.prototype.resize=function(t){va(this,t,4)},_a.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},_a.prototype.clone=function(){return new _a({width:this.width,height:this.height},new Uint8Array(this.data))},_a.copy=function(t,e,n,r,i){ma(t,e,n,r,i,4)},zr("AlphaImage",ya),zr("RGBAImage",_a);var ba={paint:new xi({"heatmap-radius":new mi(Mt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mi(Mt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new vi(Mt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bi(Mt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new vi(Mt.paint_heatmap["heatmap-opacity"])})};function xa(t){var e={},n=t.resolution||256,r=t.clips?t.clips.length:1,i=t.image||new _a({width:n,height:r}),o=function(n,r,o){e[t.evaluationKey]=o;var a=t.expression.evaluate(e);i.data[n+r+0]=Math.floor(255*a.r/a.a),i.data[n+r+1]=Math.floor(255*a.g/a.a),i.data[n+r+2]=Math.floor(255*a.b/a.a),i.data[n+r+3]=Math.floor(255*a.a)};if(t.clips)for(var a=0,s=0;a<r;++a,s+=4*n)for(var u=0,l=0;u<n;u++,l+=4){var c=u/(n-1),h=t.clips[a];o(s,l,h.start*(1-c)+h.end*c)}else for(var f=0,p=0;f<n;f++,p+=4)o(0,p,f/(n-1));return i}var wa=function(t){function e(e){t.call(this,e,ba),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new da(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=xa({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(wi),Ea={paint:new xi({"hillshade-illumination-direction":new vi(Mt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new vi(Mt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new vi(Mt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new vi(Mt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new vi(Mt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new vi(Mt.paint_hillshade["hillshade-accent-color"])})},Sa=function(t){function e(e){t.call(this,e,Ea)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(wi),Ca=Ai([{name:"a_pos",components:2,type:"Int16"}],4).members,Aa=ka,Ta=ka;function ka(t,e,n){n=n||2;var r,i,o,a,s,u,l,c=e&&e.length,h=c?e[0]*n:t.length,f=Ma(t,0,h,n,!0),p=[];if(!f||f.next===f.prev)return p;if(c&&(f=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Ma(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(Za(a));for(s.sort(Na),i=0;i<s.length;i++)Ba(s[i],n),n=Pa(n,n.next);return n}(t,e,f,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var d=n;d<h;d+=n)(s=t[d])<r&&(r=s),(u=t[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=0!==(l=Math.max(o-r,a-i))?1/l:0}return Ia(f,p,n,r,i,l),p}function Ma(t,e,n,r,i){var o,a;if(i===$a(t,e,n,r)>0)for(o=e;o<n;o+=r)a=Ka(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=Ka(o,t[o],t[o+1],a);return a&&Va(a,a.next)&&(Qa(a),a=a.next),a}function Pa(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!Va(r,r.next)&&0!==Ga(r.prev,r,r.next))r=r.next;else{if(Qa(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Ia(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=Fa(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(t,r,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?Ra(t,r,i,o):Oa(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),Qa(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?Ia(t=La(Pa(t),e,n),e,n,r,i,o,2):2===a&&Da(t,e,n,r,i,o):Ia(Pa(t),e,n,r,i,o,1);break}}}function Oa(t){var e=t.prev,n=t,r=t.next;if(Ga(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(ja(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Ga(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Ra(t,e,n,r){var i=t.prev,o=t,a=t.next;if(Ga(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,l=Fa(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,n,r),c=Fa(s,u,e,n,r),h=t.prevZ,f=t.nextZ;h&&h.z>=l&&f&&f.z<=c;){if(h!==t.prev&&h!==t.next&&ja(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ga(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,f!==t.prev&&f!==t.next&&ja(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Ga(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;h&&h.z>=l;){if(h!==t.prev&&h!==t.next&&ja(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ga(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;f&&f.z<=c;){if(f!==t.prev&&f!==t.next&&ja(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Ga(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function La(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!Va(i,o)&&Wa(i,r,r.next,o)&&Ya(i,o)&&Ya(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),Qa(r),Qa(r.next),r=t=o),r=r.next}while(r!==t);return Pa(r)}function Da(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Ua(a,s)){var u=qa(a,s);return a=Pa(a,a.next),u=Pa(u,u.next),Ia(a,e,n,r,i,o),void Ia(u,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function Na(t,e){return t.x-e.x}function Ba(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var u,l=n,c=n.x,h=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&ja(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),Ya(r,t)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&za(n,r)))&&(n=r,f=u)),r=r.next}while(r!==l);return n}(t,e)){var n=qa(e,t);Pa(e,e.next),Pa(n,n.next)}}function za(t,e){return Ga(t.prev,t,e.prev)<0&&Ga(e.next,t,t.next)<0}function Fa(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Za(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function ja(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Ua(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Wa(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Ya(t,e)&&Ya(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Ga(t.prev,t,e.prev)||Ga(t,e.prev,e))||Va(t,e)&&Ga(t.prev,t,t.next)>0&&Ga(e.prev,e,e.next)>0)}function Ga(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Va(t,e){return t.x===e.x&&t.y===e.y}function Wa(t,e,n,r){var i=Xa(Ga(t,e,n)),o=Xa(Ga(t,e,r)),a=Xa(Ga(n,r,t)),s=Xa(Ga(n,r,e));return i!==o&&a!==s||!(0!==i||!Ha(t,n,e))||!(0!==o||!Ha(t,r,e))||!(0!==a||!Ha(n,t,r))||!(0!==s||!Ha(n,e,r))}function Ha(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Xa(t){return t>0?1:t<0?-1:0}function Ya(t,e){return Ga(t.prev,t,t.next)<0?Ga(t,e,t.next)>=0&&Ga(t,t.prev,e)>=0:Ga(t,e,t.prev)<0||Ga(t,t.next,e)<0}function qa(t,e){var n=new Ja(t.i,t.x,t.y),r=new Ja(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ka(t,e,n,r){var i=new Ja(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Qa(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ja(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $a(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function ts(t,e,n,r,i){!function t(e,n,r,i,o){for(;i>r;){if(i-r>600){var a=i-r+1,s=n-r+1,u=Math.log(a),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1);t(e,n,Math.max(r,Math.floor(n-s*l/a+c)),Math.min(i,Math.floor(n+(a-s)*l/a+c)),o)}var h=e[n],f=r,p=i;for(es(e,r,n),o(e[i],h)>0&&es(e,r,i);f<p;){for(es(e,f,p),f++,p--;o(e[f],h)<0;)f++;for(;o(e[p],h)>0;)p--}0===o(e[r],h)?es(e,r,p):es(e,++p,i),p<=n&&(r=p+1),n<=p&&(i=p-1)}}(t,e,n||0,r||t.length-1,i||ns)}function es(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function ns(t,e){return t<e?-1:t>e?1:0}function rs(t,e){var n=t.length;if(n<=1)return[t];for(var r,i,o=[],a=0;a<n;a++){var s=C(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(r&&o.push(r),r=[t[a]]):r.push(t[a]))}if(r&&o.push(r),e>1)for(var u=0;u<o.length;u++)o[u].length<=e||(ts(o[u],e,1,o[u].length-1,is),o[u]=o[u].slice(0,e));return o}function is(t,e){return e.area-t.area}function os(t,e,n){for(var r=n.patternDependencies,i=!1,o=0,a=e;o<a.length;o+=1){var s=a[o].paint.get(t+"-pattern");s.isConstant()||(i=!0);var u=s.constantOr(null);u&&(i=!0,r[u.to]=!0,r[u.from]=!0)}return i}function as(t,e,n,r,i){for(var o=i.patternDependencies,a=0,s=e;a<s.length;a+=1){var u=s[a],l=u.paint.get(t+"-pattern").value;if("constant"!==l.kind){var c=l.evaluate({zoom:r-1},n,{},i.availableImages),h=l.evaluate({zoom:r},n,{},i.availableImages),f=l.evaluate({zoom:r+1},n,{},i.availableImages);h=h&&h.name?h.name:h,f=f&&f.name?f.name:f,o[c=c&&c.name?c.name:c]=!0,o[h]=!0,o[f]=!0,n.patterns[u.id]={min:c,mid:h,max:f}}}return n}ka.deviation=function(t,e,n,r){var i=e&&e.length,o=Math.abs($a(t,0,i?e[0]*n:t.length,n));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs($a(t,e[a]*n,a<s-1?e[a+1]*n:t.length,n));var u=0;for(a=0;a<r.length;a+=3){var l=r[a]*n,c=r[a+1]*n,h=r[a+2]*n;u+=Math.abs((t[l]-t[h])*(t[c+1]-t[l+1])-(t[l]-t[c])*(t[h+1]-t[l+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},ka.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&n.holes.push(r+=t[i-1].length)}return n},Aa.default=Ta;var ss=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ki,this.indexArray=new ji,this.indexArray2=new Xi,this.programConfigurations=new Do(t.layers,t.zoom),this.segments=new so,this.segments2=new so,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};ss.prototype.populate=function(t,e,n){this.hasPattern=os("fill",this.layers,e);for(var r=this.layers[0].layout.get("fill-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,l=s.id,c=s.index,h=s.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,p=jo(u,f);if(this.layers[0]._featureFilter.filter(new si(this.zoom),p,n)){var d=r?r.evaluate(p,{},n,e.availableImages):void 0,g={id:l,properties:u.properties,type:u.type,sourceLayerIndex:h,index:c,geometry:f?p.geometry:Zo(u),patterns:{},sortKey:d};i.push(g)}}r&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var v=0,m=i;v<m.length;v+=1){var y=m[v],_=y.geometry,b=y.index,x=y.sourceLayerIndex;if(this.hasPattern){var w=as("fill",this.layers,y,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(y,_,b,n,{});e.featureIndex.insert(t[b].feature,_,b,x,this.index)}},ss.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},ss.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},ss.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ss.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ca),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ss.prototype.addFeature=function(t,e,n,r,i){for(var o=0,a=rs(e,500);o<a.length;o+=1){for(var s=a[o],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray),f=h.vertexLength,p=[],d=[],g=0,v=s;g<v.length;g+=1){var m=v[g];if(0!==m.length){m!==s[0]&&d.push(p.length/2);var y=this.segments2.prepareSegment(m.length,this.layoutVertexArray,this.indexArray2),_=y.vertexLength;this.layoutVertexArray.emplaceBack(m[0].x,m[0].y),this.indexArray2.emplaceBack(_+m.length-1,_),p.push(m[0].x),p.push(m[0].y);for(var b=1;b<m.length;b++)this.layoutVertexArray.emplaceBack(m[b].x,m[b].y),this.indexArray2.emplaceBack(_+b-1,_+b),p.push(m[b].x),p.push(m[b].y);y.vertexLength+=m.length,y.primitiveLength+=m.length}}for(var x=Aa(p,d),w=0;w<x.length;w+=3)this.indexArray.emplaceBack(f+x[w],f+x[w+1],f+x[w+2]);h.vertexLength+=u,h.primitiveLength+=x.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},zr("FillBucket",ss,{omit:["layers","patternFeatures"]});var us=new xi({"fill-sort-key":new mi(Mt.layout_fill["fill-sort-key"])}),ls={paint:new xi({"fill-antialias":new vi(Mt.paint_fill["fill-antialias"]),"fill-opacity":new mi(Mt.paint_fill["fill-opacity"]),"fill-color":new mi(Mt.paint_fill["fill-color"]),"fill-outline-color":new mi(Mt.paint_fill["fill-outline-color"]),"fill-translate":new vi(Mt.paint_fill["fill-translate"]),"fill-translate-anchor":new vi(Mt.paint_fill["fill-translate-anchor"]),"fill-pattern":new yi(Mt.paint_fill["fill-pattern"])}),layout:us},cs=function(t){function e(e){t.call(this,e,ls)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n);var r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new ss(t)},e.prototype.queryRadius=function(){return na(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,o,a){return Ho(ra(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),r)},e.prototype.isTileClipped=function(){return!0},e}(wi),hs=Ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,fs=ps;function ps(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(ds,this,e)}function ds(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function gs(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)r+=((n=t[a]).x-(e=t[i]).x)*(e.y+n.y);return r}ps.types=["Unknown","Point","LineString","Polygon"],ps.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,r=1,o=0,a=0,s=0,u=[];t.pos<n;){if(o<=0){var l=t.readVarint();r=7&l,o=l>>3}if(o--,1===r||2===r)a+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&u.push(e),e=[]),e.push(new i(a,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&u.push(e),u},ps.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(r<=0){var c=t.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},ps.prototype.toGeoJSON=function(t,e,n){var r,i,o=this.extent*Math.pow(2,n),a=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=ps.types[this.type];function c(t){for(var e=0;e<t.length;e++){var n=t[e];t[e]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<u.length;r++)h[r]=u[r][0];c(u=h);break;case 2:for(r=0;r<u.length;r++)c(u[r]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=gs(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}(u),r=0;r<u.length;r++)for(i=0;i<u[r].length;i++)c(u[r][i])}1===u.length?u=u[0]:l="Multi"+l;var f={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f};var vs=ms;function ms(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ys,this,e),this.length=this._features.length}function ys(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(n))}function _s(t,e,n){if(3===t){var r=new vs(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}ms.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new fs(this._pbf,e,this.extent,this._keys,this._values)};var bs={VectorTile:function(t,e){this.layers=t.readFields(_s,{},e)},VectorTileFeature:fs,VectorTileLayer:vs},xs=bs.VectorTileFeature.types,ws=Math.pow(2,13);function Es(t,e,n,r,i,o,a,s){t.emplaceBack(e,n,2*Math.floor(r*ws)+a,i*ws*2,o*ws*2,Math.round(s))}var Ss=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Pi,this.indexArray=new ji,this.programConfigurations=new Do(t.layers,t.zoom),this.segments=new so,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Cs(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}Ss.prototype.populate=function(t,e,n){this.features=[],this.hasPattern=os("fill-extrusion",this.layers,e);for(var r=0,i=t;r<i.length;r+=1){var o=i[r],a=o.feature,s=o.id,u=o.index,l=o.sourceLayerIndex,c=this.layers[0]._featureFilter.needGeometry,h=jo(a,c);if(this.layers[0]._featureFilter.filter(new si(this.zoom),h,n)){var f={id:s,sourceLayerIndex:l,index:u,geometry:c?h.geometry:Zo(a),properties:a.properties,type:a.type,patterns:{}};this.hasPattern?this.features.push(as("fill-extrusion",this.layers,f,this.zoom,e)):this.addFeature(f,f.geometry,u,n,{}),e.featureIndex.insert(a,f.geometry,u,l,this.index,!0)}}},Ss.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.features;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},Ss.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Ss.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ss.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ss.prototype.addFeature=function(t,e,n,r,i){for(var o=0,a=rs(e,500);o<a.length;o+=1){for(var s=a[o],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),f=0,p=s;f<p.length;f+=1){var d=p[f];if(0!==d.length&&!((O=d).every((function(t){return t.x<0}))||O.every((function(t){return t.x>8192}))||O.every((function(t){return t.y<0}))||O.every((function(t){return t.y>8192}))))for(var g=0,v=0;v<d.length;v++){var m=d[v];if(v>=1){var y=d[v-1];if(!Cs(m,y)){h.vertexLength+4>so.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _=m.sub(y)._perp()._unit(),b=y.dist(m);g+b>32768&&(g=0),Es(this.layoutVertexArray,m.x,m.y,_.x,_.y,0,0,g),Es(this.layoutVertexArray,m.x,m.y,_.x,_.y,0,1,g),Es(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,0,g+=b),Es(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,1,g);var x=h.vertexLength;this.indexArray.emplaceBack(x,x+2,x+1),this.indexArray.emplaceBack(x+1,x+2,x+3),h.vertexLength+=4,h.primitiveLength+=2}}}}if(h.vertexLength+u>so.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray)),"Polygon"===xs[t.type]){for(var w=[],E=[],S=h.vertexLength,C=0,A=s;C<A.length;C+=1){var T=A[C];if(0!==T.length){T!==s[0]&&E.push(w.length/2);for(var k=0;k<T.length;k++){var M=T[k];Es(this.layoutVertexArray,M.x,M.y,0,0,1,1,0),w.push(M.x),w.push(M.y)}}}for(var P=Aa(w,E),I=0;I<P.length;I+=3)this.indexArray.emplaceBack(S+P[I],S+P[I+2],S+P[I+1]);h.primitiveLength+=P.length/3,h.vertexLength+=u}}var O;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},zr("FillExtrusionBucket",Ss,{omit:["layers","features"]});var As={paint:new xi({"fill-extrusion-opacity":new vi(Mt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mi(Mt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new vi(Mt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new vi(Mt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yi(Mt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new mi(Mt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mi(Mt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new vi(Mt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ts=function(t){function e(e){t.call(this,e,As)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Ss(t)},e.prototype.queryRadius=function(){return na(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,n,r,o,a,s,u){var l=ra(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(e,n),h=this.paint.get("fill-extrusion-base").evaluate(e,n),f=function(t,e,n,r){for(var o=[],a=0,s=t;a<s.length;a+=1){var u=s[a],l=[u.x,u.y,0,1];ha(l,l,e),o.push(new i(l[0]/l[3],l[1]/l[3]))}return o}(l,u),p=function(t,e,n,r){for(var o=[],a=[],s=r[8]*e,u=r[9]*e,l=r[10]*e,c=r[11]*e,h=r[8]*n,f=r[9]*n,p=r[10]*n,d=r[11]*n,g=0,v=t;g<v.length;g+=1){for(var m=[],y=[],_=0,b=v[g];_<b.length;_+=1){var x=b[_],w=x.x,E=x.y,S=r[0]*w+r[4]*E+r[12],C=r[1]*w+r[5]*E+r[13],A=r[2]*w+r[6]*E+r[14],T=r[3]*w+r[7]*E+r[15],k=A+l,M=T+c,P=S+h,I=C+f,O=A+p,R=T+d,L=new i((S+s)/M,(C+u)/M);L.z=k/M,m.push(L);var D=new i(P/R,I/R);D.z=O/R,y.push(D)}o.push(m),a.push(y)}return[o,a]}(r,h,c,u);return function(t,e,n){var r=1/0;Ho(n,e)&&(r=Ms(n,e[0]));for(var i=0;i<e.length;i++)for(var o=e[i],a=t[i],s=0;s<o.length-1;s++){var u=o[s],l=[u,o[s+1],a[s+1],a[s],u];Vo(n,l)&&(r=Math.min(r,Ms(n,l)))}return r!==1/0&&r}(p[0],p[1],f)},e}(wi);function ks(t,e){return t.x*e.x+t.y*e.y}function Ms(t,e){if(1===t.length){for(var n,r=0,i=e[r++];!n||i.equals(n);)if(!(n=e[r++]))return 1/0;for(;r<e.length;r++){var o=e[r],a=t[0],s=n.sub(i),u=o.sub(i),l=a.sub(i),c=ks(s,s),h=ks(s,u),f=ks(u,u),p=ks(l,s),d=ks(l,u),g=c*f-h*h,v=(f*p-h*d)/g,m=(c*d-h*p)/g,y=i.z*(1-v-m)+n.z*v+o.z*m;if(isFinite(y))return y}return 1/0}for(var _=1/0,b=0,x=e;b<x.length;b+=1)_=Math.min(_,x[b].z);return _}var Ps=Ai([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Is=Ai([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Os=bs.VectorTileFeature.types,Rs=Math.cos(Math.PI/180*37.5),Ls=Math.pow(2,14)/.5,Ds=function(t){var e=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(t){e.gradients[t.id]={}})),this.layoutVertexArray=new Ii,this.layoutVertexArray2=new Oi,this.indexArray=new ji,this.programConfigurations=new Do(t.layers,t.zoom),this.segments=new so,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};Ds.prototype.populate=function(t,e,n){this.hasPattern=os("line",this.layers,e);for(var r=this.layers[0].layout.get("line-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,l=s.id,c=s.index,h=s.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,p=jo(u,f);if(this.layers[0]._featureFilter.filter(new si(this.zoom),p,n)){var d=r?r.evaluate(p,{},n):void 0,g={id:l,properties:u.properties,type:u.type,sourceLayerIndex:h,index:c,geometry:f?p.geometry:Zo(u),patterns:{},sortKey:d};i.push(g)}}r&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var v=0,m=i;v<m.length;v+=1){var y=m[v],_=y.geometry,b=y.index,x=y.sourceLayerIndex;if(this.hasPattern){var w=as("line",this.layers,y,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(y,_,b,n,{});e.featureIndex.insert(t[b].feature,_,b,x,this.index)}},Ds.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Ds.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},Ds.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ds.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ds.prototype.upload=function(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Is)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ps),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ds.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ds.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Ds.prototype.addFeature=function(t,e,n,r,i){var o=this.layers[0].layout,a=o.get("line-join").evaluate(t,{}),s=o.get("line-cap"),u=o.get("line-miter-limit"),l=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var c=0,h=e;c<h.length;c+=1)this.addLine(h[c],t,a,s,u,l);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},Ds.prototype.addLine=function(t,e,n,r,i,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var a=0;a<t.length-1;a++)this.totalDistance+=t[a].dist(t[a+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===Os[e.type],u=t.length;u>=2&&t[u-1].equals(t[u-2]);)u--;for(var l=0;l<u-1&&t[l].equals(t[l+1]);)l++;if(!(u<(s?3:2))){"bevel"===n&&(i=1.05);var c,h=this.overscaling<=16?122880/(512*this.overscaling):0,f=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray),p=void 0,d=void 0,g=void 0,v=void 0;this.e1=this.e2=-1,s&&(v=t[l].sub(c=t[u-2])._unit()._perp());for(var m=l;m<u;m++)if(!(d=m===u-1?s?t[l+1]:void 0:t[m+1])||!t[m].equals(d)){v&&(g=v),c&&(p=c),c=t[m],v=d?d.sub(c)._unit()._perp():g;var y=(g=g||v).add(v);0===y.x&&0===y.y||y._unit();var _=g.x*v.x+g.y*v.y,b=y.x*v.x+y.y*v.y,x=0!==b?1/b:1/0,w=2*Math.sqrt(2-2*b),E=b<Rs&&p&&d,S=g.x*v.y-g.y*v.x>0;if(E&&m>l){var C=c.dist(p);if(C>2*h){var A=c.sub(c.sub(p)._mult(h/C)._round());this.updateDistance(p,A),this.addCurrentVertex(A,g,0,0,f),p=A}}var T=p&&d,k=T?n:s?"butt":r;if(T&&"round"===k&&(x<o?k="miter":x<=2&&(k="fakeround")),"miter"===k&&x>i&&(k="bevel"),"bevel"===k&&(x>2&&(k="flipbevel"),x<i&&(k="miter")),p&&this.updateDistance(p,c),"miter"===k)y._mult(x),this.addCurrentVertex(c,y,0,0,f);else if("flipbevel"===k){if(x>100)y=v.mult(-1);else{var M=x*g.add(v).mag()/g.sub(v).mag();y._perp()._mult(M*(S?-1:1))}this.addCurrentVertex(c,y,0,0,f),this.addCurrentVertex(c,y.mult(-1),0,0,f)}else if("bevel"===k||"fakeround"===k){var P=-Math.sqrt(x*x-1),I=S?P:0,O=S?0:P;if(p&&this.addCurrentVertex(c,g,I,O,f),"fakeround"===k)for(var R=Math.round(180*w/Math.PI/20),L=1;L<R;L++){var D=L/R;if(.5!==D){var N=D-.5;D+=D*N*(D-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*N*N+(.848013+_*(.215638*_-1.06021)))}var B=v.sub(g)._mult(D)._add(g)._unit()._mult(S?-1:1);this.addHalfVertex(c,B.x,B.y,!1,S,0,f)}d&&this.addCurrentVertex(c,v,-I,-O,f)}else if("butt"===k)this.addCurrentVertex(c,y,0,0,f);else if("square"===k){var z=p?1:-1;this.addCurrentVertex(c,y,z,z,f)}else"round"===k&&(p&&(this.addCurrentVertex(c,g,0,0,f),this.addCurrentVertex(c,g,1,1,f,!0)),d&&(this.addCurrentVertex(c,v,-1,-1,f,!0),this.addCurrentVertex(c,v,0,0,f)));if(E&&m<u-1){var F=c.dist(d);if(F>2*h){var Z=c.add(d.sub(c)._mult(h/F)._round());this.updateDistance(c,Z),this.addCurrentVertex(Z,v,0,0,f),c=Z}}}}},Ds.prototype.addCurrentVertex=function(t,e,n,r,i,o){void 0===o&&(o=!1);var a=e.y*r-e.x,s=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*n,e.y-e.x*n,o,!1,n,i),this.addHalfVertex(t,a,s,o,!0,-r,i),this.distance>Ls/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,n,r,i,o))},Ds.prototype.addHalfVertex=function(t,e,n,r,i,o,a){var s=.5*(this.lineClips?this.scaledDistance*(Ls-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(r?1:0),(t.y<<1)+(i?1:0),Math.round(63*e)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var u=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),a.primitiveLength++),i?this.e2=u:this.e1=u},Ds.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ds.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},zr("LineBucket",Ds,{omit:["layers","patternFeatures"]});var Ns=new xi({"line-cap":new vi(Mt.layout_line["line-cap"]),"line-join":new mi(Mt.layout_line["line-join"]),"line-miter-limit":new vi(Mt.layout_line["line-miter-limit"]),"line-round-limit":new vi(Mt.layout_line["line-round-limit"]),"line-sort-key":new mi(Mt.layout_line["line-sort-key"])}),Bs={paint:new xi({"line-opacity":new mi(Mt.paint_line["line-opacity"]),"line-color":new mi(Mt.paint_line["line-color"]),"line-translate":new vi(Mt.paint_line["line-translate"]),"line-translate-anchor":new vi(Mt.paint_line["line-translate-anchor"]),"line-width":new mi(Mt.paint_line["line-width"]),"line-gap-width":new mi(Mt.paint_line["line-gap-width"]),"line-offset":new mi(Mt.paint_line["line-offset"]),"line-blur":new mi(Mt.paint_line["line-blur"]),"line-dasharray":new _i(Mt.paint_line["line-dasharray"]),"line-pattern":new yi(Mt.paint_line["line-pattern"]),"line-gradient":new bi(Mt.paint_line["line-gradient"])}),layout:Ns},zs=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,n){return n=new si(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),t.prototype.possiblyEvaluate.call(this,e,n)},e.prototype.evaluate=function(e,n,r,i){return n=f({},n,{zoom:Math.floor(n.zoom)}),t.prototype.evaluate.call(this,e,n,r,i)},e}(mi))(Bs.paint.properties["line-width"].specification);zs.useIntegerZoom=!0;var Fs=function(t){function e(e){t.call(this,e,Bs),this.gradientVersion=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ge,this.gradientVersion=(this.gradientVersion+1)%s)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n),this.paint._values["line-floorwidth"]=zs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new Ds(t)},e.prototype.queryRadius=function(t){var e=t,n=Zs(ea("line-width",this,e),ea("line-gap-width",this,e)),r=ea("line-offset",this,e);return n/2+Math.abs(r)+na(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,o,a,s){var u=ra(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),l=s/2*Zs(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),c=this.paint.get("line-offset").evaluate(e,n);return c&&(r=function(t,e){for(var n=[],r=new i(0,0),o=0;o<t.length;o++){for(var a=t[o],s=[],u=0;u<a.length;u++){var l=a[u],c=a[u+1],h=0===u?r:l.sub(a[u-1])._unit()._perp(),f=u===a.length-1?r:c.sub(l)._unit()._perp(),p=h._add(f)._unit();p._mult(1/(p.x*f.x+p.y*f.y)),s.push(p._mult(e)._add(l))}n.push(s)}return n}(r,c*s)),function(t,e,n){for(var r=0;r<e.length;r++){var i=e[r];if(t.length>=3)for(var o=0;o<i.length;o++)if($o(t,i[o]))return!0;if(Xo(t,i,n))return!0}return!1}(u,r,l)},e.prototype.isTileClipped=function(){return!0},e}(wi);function Zs(t,e){return e>0?e+2*t:t}var js=Ai([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Us=Ai([{name:"a_projected_pos",components:3,type:"Float32"}],4),Gs=(Ai([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ai([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Vs=(Ai([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ai([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ws=Ai([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Hs(t,e,n){return t.sections.forEach((function(t){t.text=function(t,e,n){var r=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),ai.applyArabicShaping&&(t=ai.applyArabicShaping(t)),t}(t.text,e,n)})),t}Ai([{name:"triangle",components:3,type:"Uint16"}]),Ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ai([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ai([{type:"Float32",name:"offsetX"}]),Ai([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Xs={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},Ys=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?i-1:0,f=n?-1:1,p=t[e+h];for(h+=f,o=p&(1<<-c)-1,p>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+t[e+h],h+=f,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=l}return(p?-1:1)*a*Math.pow(2,o-r)},qs=function(t,e,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*u-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[n+p]=255&a,p+=d,a/=256,l-=8);t[n+p-d]|=128*g},Ks=Qs;function Qs(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Qs.Varint=0,Qs.Fixed64=1,Qs.Bytes=2,Qs.Fixed32=5;var Js="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function $s(t){return t.type===Qs.Bytes?t.readVarint()+t.pos:t.pos+1}function tu(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function eu(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function nu(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function ru(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function iu(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function ou(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function au(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function su(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function uu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function lu(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function cu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function hu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function fu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function pu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function du(t,e,n){1===t&&n.readMessage(gu,e)}function gu(t,e,n){if(3===t){var r=n.readMessage(vu,{}),i=r.width,o=r.height,a=r.left,s=r.top,u=r.advance;e.push({id:r.id,bitmap:new ya({width:i+6,height:o+6},r.bitmap),metrics:{width:i,height:o,left:a,top:s,advance:u}})}}function vu(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function mu(t){for(var e=0,n=0,r=0,i=t;r<i.length;r+=1){var o=i[r];e+=o.w*o.h,n=Math.max(n,o.w)}t.sort((function(t,e){return e.h-t.h}));for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],s=0,u=0,l=0,c=t;l<c.length;l+=1)for(var h=c[l],f=a.length-1;f>=0;f--){var p=a[f];if(!(h.w>p.w||h.h>p.h)){if(h.x=p.x,h.y=p.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===p.w&&h.h===p.h){var d=a.pop();f<a.length&&(a[f]=d)}else h.h===p.h?(p.x+=h.w,p.w-=h.w):h.w===p.w?(p.y+=h.h,p.h-=h.h):(a.push({x:p.x+h.w,y:p.y,w:p.w-h.w,h:h.h}),p.y+=h.h,p.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}Qs.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=hu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=pu(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=hu(this.buf,this.pos)+4294967296*hu(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=hu(this.buf,this.pos)+4294967296*pu(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Ys(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Ys(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(t,e,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return tu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return tu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return tu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return tu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return tu(t,r,e);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return tu(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Js?function(t,e,n){return Js.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){for(var r="",i=e;i<n;){var o,a,s,u=t[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(o=t[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(a=t[i+2],128==(192&(o=t[i+1]))&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(a=t[i+2],s=t[i+3],128==(192&(o=t[i+1]))&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Qs.Bytes)return t.push(this.readVarint(e));var n=$s(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Qs.Bytes)return t.push(this.readSVarint());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Qs.Bytes)return t.push(this.readBoolean());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Qs.Bytes)return t.push(this.readFloat());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Qs.Bytes)return t.push(this.readDouble());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Qs.Bytes)return t.push(this.readFixed32());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Qs.Bytes)return t.push(this.readSFixed32());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Qs.Bytes)return t.push(this.readFixed64());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Qs.Bytes)return t.push(this.readSFixed64());var e=$s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Qs.Varint)for(;this.buf[this.pos++]>127;);else if(e===Qs.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Qs.Fixed32)this.pos+=4;else{if(e!==Qs.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),fu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),fu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),fu(this.buf,-1&t,this.pos),fu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),fu(this.buf,-1&t,this.pos),fu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,n.buf[n.pos]=127&(t>>>=7)}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&eu(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),qs(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),qs(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&eu(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,Qs.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,nu,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,ru,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,au,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,iu,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,ou,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,su,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,uu,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,lu,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,cu,e)},writeBytesField:function(t,e){this.writeTag(t,Qs.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Qs.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Qs.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Qs.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Qs.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Qs.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Qs.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Qs.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Qs.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Qs.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var yu=function(t,e){var n=e.pixelRatio,r=e.version,i=e.stretchX,o=e.stretchY,a=e.content;this.paddedRect=t,this.pixelRatio=n,this.stretchX=i,this.stretchY=o,this.content=a,this.version=r},_u={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};_u.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},_u.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},_u.tlbr.get=function(){return this.tl.concat(this.br)},_u.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(yu.prototype,_u);var bu=function(t,e){var n={},r={};this.haveRenderCallbacks=[];var i=[];this.addImages(t,n,i),this.addImages(e,r,i);var o=mu(i),a=new _a({width:o.w||1,height:o.h||1});for(var s in t){var u=t[s],l=n[s].paddedRect;_a.copy(u.data,a,{x:0,y:0},{x:l.x+1,y:l.y+1},u.data)}for(var c in e){var h=e[c],f=r[c].paddedRect,p=f.x+1,d=f.y+1,g=h.data.width,v=h.data.height;_a.copy(h.data,a,{x:0,y:0},{x:p,y:d},h.data),_a.copy(h.data,a,{x:0,y:v-1},{x:p,y:d-1},{width:g,height:1}),_a.copy(h.data,a,{x:0,y:0},{x:p,y:d+v},{width:g,height:1}),_a.copy(h.data,a,{x:g-1,y:0},{x:p-1,y:d},{width:1,height:v}),_a.copy(h.data,a,{x:0,y:0},{x:p+g,y:d},{width:1,height:v})}this.image=a,this.iconPositions=n,this.patternPositions=r};bu.prototype.addImages=function(t,e,n){for(var r in t){var i=t[r],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(o),e[r]=new yu(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}},bu.prototype.patchUpdatedImages=function(t,e){for(var n in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)},bu.prototype.patchUpdatedImage=function(t,e,n){if(t&&e&&t.version!==e.version){t.version=e.version;var r=t.tl;n.update(e.data,void 0,{x:r[0],y:r[1]})}},zr("ImagePosition",yu),zr("ImageAtlas",bu);var xu={horizontal:1,vertical:2,horizontalOnly:3},wu=function(){this.scale=1,this.fontStack="",this.imageName=null};wu.forText=function(t,e){var n=new wu;return n.scale=t||1,n.fontStack=e,n},wu.forImage=function(t){var e=new wu;return e.imageName=t,e};var Eu=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Su(t,e,n,r,i,o,a,s,u,l,c,h,f,p,d,g){var v,m=Eu.fromFeature(t,i);h===xu.vertical&&m.verticalizePunctuation();var y=ai.processBidirectionalText,_=ai.processStyledBidirectionalText;if(y&&1===m.sections.length){v=[];for(var b=0,x=y(m.toString(),Iu(m,l,o,e,r,p,d));b<x.length;b+=1){var w=x[b],E=new Eu;E.text=w,E.sections=m.sections;for(var S=0;S<w.length;S++)E.sectionIndex.push(0);v.push(E)}}else if(_){v=[];for(var C=0,A=_(m.text,m.sectionIndex,Iu(m,l,o,e,r,p,d));C<A.length;C+=1){var T=A[C],k=new Eu;k.text=T[0],k.sectionIndex=T[1],k.sections=m.sections,v.push(k)}}else v=function(t,e){for(var n=[],r=t.text,i=0,o=0,a=e;o<a.length;o+=1){var s=a[o];n.push(t.substring(i,s)),i=s}return i<r.length&&n.push(t.substring(i,r.length)),n}(m,Iu(m,l,o,e,r,p,d));var M=[],P={positionedLines:M,text:m.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,n,r,i,o,a,s,u,l,c,h){for(var f=0,p=-17,d=0,g=0,v="right"===s?1:"left"===s?0:.5,m=0,y=0,_=i;y<_.length;y+=1){var b=_[y];b.trim();var x=b.getMaxScale(),w=24*(x-1),E={positionedGlyphs:[],lineOffset:0};t.positionedLines[m]=E;var S=E.positionedGlyphs,C=0;if(b.length()){for(var A=0;A<b.length();A++){var T=b.getSection(A),k=b.getSectionIndex(A),M=b.getCharCode(A),P=0,I=null,O=null,R=null,L=24,D=!(u===xu.horizontal||!c&&!Xr(M)||c&&(Cu[M]||(V=M,Wr.Arabic(V)||Wr["Arabic Supplement"](V)||Wr["Arabic Extended-A"](V)||Wr["Arabic Presentation Forms-A"](V)||Wr["Arabic Presentation Forms-B"](V))));if(T.imageName){var N=r[T.imageName];if(!N)continue;R=T.imageName,t.iconsInText=t.iconsInText||!0,O=N.paddedRect;var B=N.displaySize;T.scale=24*T.scale/h,P=w+(24-B[1]*T.scale),L=(I={width:B[0],height:B[1],left:1,top:-3,advance:D?B[1]:B[0]}).advance;var z=D?B[0]*T.scale-24*x:B[1]*T.scale-24*x;z>0&&z>C&&(C=z)}else{var F=n[T.fontStack],Z=F&&F[M];if(Z&&Z.rect)O=Z.rect,I=Z.metrics;else{var j=e[T.fontStack],U=j&&j[M];if(!U)continue;I=U.metrics}P=24*(x-T.scale)}D?(t.verticalizable=!0,S.push({glyph:M,imageName:R,x:f,y:p+P,vertical:D,scale:T.scale,fontStack:T.fontStack,sectionIndex:k,metrics:I,rect:O}),f+=L*T.scale+l):(S.push({glyph:M,imageName:R,x:f,y:p+P,vertical:D,scale:T.scale,fontStack:T.fontStack,sectionIndex:k,metrics:I,rect:O}),f+=I.advance*T.scale+l)}0!==S.length&&(d=Math.max(f-l,d),Ru(S,0,S.length-1,v,C)),f=0;var G=o*x+C;E.lineOffset=Math.max(C,w),p+=G,g=Math.max(G,g),++m}else p+=o,++m}var V,W=p- -17,H=Ou(a),X=H.horizontalAlign,Y=H.verticalAlign;(function(t,e,n,r,i,o,a,s,u){var l,c=(e-n)*i;l=o!==a?-s*r- -17:(-r*u+.5)*a;for(var h=0,f=t;h<f.length;h+=1)for(var p=0,d=f[h].positionedGlyphs;p<d.length;p+=1){var g=d[p];g.x+=c,g.y+=l}})(t.positionedLines,v,X,Y,d,g,o,W,i.length),t.top+=-Y*W,t.bottom=t.top+W,t.left+=-X*d,t.right=t.left+d}(P,e,n,r,v,a,s,u,h,l,f,g),!function(t){for(var e=0,n=t;e<n.length;e+=1)if(0!==n[e].positionedGlyphs.length)return!1;return!0}(M)&&P}Eu.fromFeature=function(t,e){for(var n=new Eu,r=0;r<t.sections.length;r++){var i=t.sections[r];i.image?n.addImageSection(i):n.addTextSection(i,e)}return n},Eu.prototype.length=function(){return this.text.length},Eu.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Eu.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Eu.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Eu.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",n=0;n<t.length;n++){var r=t.charCodeAt(n+1)||null,i=t.charCodeAt(n-1)||null;e+=r&&Yr(r)&&!Xs[t[n+1]]||i&&Yr(i)&&!Xs[t[n-1]]||!Xs[t[n]]?t[n]:Xs[t[n]]}return e}(this.text)},Eu.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Cu[this.text.charCodeAt(e)];e++)t++;for(var n=this.text.length,r=this.text.length-1;r>=0&&r>=t&&Cu[this.text.charCodeAt(r)];r--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)},Eu.prototype.substring=function(t,e){var n=new Eu;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n},Eu.prototype.toString=function(){return this.text},Eu.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,n){return Math.max(e,t.sections[n].scale)}),0)},Eu.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(wu.forText(t.scale,t.fontStack||e));for(var n=this.sections.length-1,r=0;r<t.text.length;++r)this.sectionIndex.push(n)},Eu.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(wu.forImage(e)),this.sectionIndex.push(this.sections.length-1)):E("Reached maximum number of images 6401")}else E("Can't add FormattedSection with an empty image.")},Eu.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Cu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Au={};function Tu(t,e,n,r,i,o){if(e.imageName){var a=r[e.imageName];return a?a.displaySize[0]*e.scale*24/o+i:0}var s=n[e.fontStack],u=s&&s[t];return u?u.metrics.advance*e.scale+i:0}function ku(t,e,n,r){var i=Math.pow(t-e,2);return r?t<e?i/2:2*i:i+Math.abs(n)*n}function Mu(t,e,n){var r=0;return 10===t&&(r-=1e4),n&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Pu(t,e,n,r,i,o){for(var a=null,s=ku(e,n,i,o),u=0,l=r;u<l.length;u+=1){var c=l[u],h=ku(e-c.x,n,i,o)+c.badness;h<=s&&(a=c,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function Iu(t,e,n,r,i,o,a){if("point"!==o)return[];if(!t)return[];for(var s,u=[],l=function(t,e,n,r,i,o){for(var a=0,s=0;s<t.length();s++){var u=t.getSection(s);a+=Tu(t.getCharCode(s),u,r,i,e,o)}return a/Math.max(1,Math.ceil(a/n))}(t,e,n,r,i,a),c=t.text.indexOf("​")>=0,h=0,f=0;f<t.length();f++){var p=t.getSection(f),d=t.getCharCode(f);if(Cu[d]||(h+=Tu(d,p,r,i,e,a)),f<t.length()-1){var g=!((s=d)<11904||!(Wr["Bopomofo Extended"](s)||Wr.Bopomofo(s)||Wr["CJK Compatibility Forms"](s)||Wr["CJK Compatibility Ideographs"](s)||Wr["CJK Compatibility"](s)||Wr["CJK Radicals Supplement"](s)||Wr["CJK Strokes"](s)||Wr["CJK Symbols and Punctuation"](s)||Wr["CJK Unified Ideographs Extension A"](s)||Wr["CJK Unified Ideographs"](s)||Wr["Enclosed CJK Letters and Months"](s)||Wr["Halfwidth and Fullwidth Forms"](s)||Wr.Hiragana(s)||Wr["Ideographic Description Characters"](s)||Wr["Kangxi Radicals"](s)||Wr["Katakana Phonetic Extensions"](s)||Wr.Katakana(s)||Wr["Vertical Forms"](s)||Wr["Yi Radicals"](s)||Wr["Yi Syllables"](s)));(Au[d]||g||p.imageName)&&u.push(Pu(f+1,h,l,u,Mu(d,t.getCharCode(f+1),g&&c),!1))}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Pu(t.length(),h,l,u,0,!0))}function Ou(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Ru(t,e,n,r,i){if(r||i)for(var o=t[n],a=(t[n].x+o.metrics.advance*o.scale)*r,s=e;s<=n;s++)t[s].x-=a,t[s].y+=i}function Lu(t,e,n,r,i,o){var a,s=t.image;if(s.content){var u=s.content,l=s.pixelRatio||1;a=[u[0]/l,u[1]/l,s.displaySize[0]-u[2]/l,s.displaySize[1]-u[3]/l]}var c,h,f,p,d=e.left*o,g=e.right*o;"width"===n||"both"===n?(p=i[0]+d-r[3],h=i[0]+g+r[1]):h=(p=i[0]+(d+g-s.displaySize[0])/2)+s.displaySize[0];var v=e.top*o,m=e.bottom*o;return"height"===n||"both"===n?(c=i[1]+v-r[0],f=i[1]+m+r[2]):f=(c=i[1]+(v+m-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:c,right:h,bottom:f,left:p,collisionPadding:a}}Au[10]=!0,Au[32]=!0,Au[38]=!0,Au[40]=!0,Au[41]=!0,Au[43]=!0,Au[45]=!0,Au[47]=!0,Au[173]=!0,Au[183]=!0,Au[8203]=!0,Au[8208]=!0,Au[8211]=!0,Au[8231]=!0;var Du=function(t){function e(e,n,r,i){t.call(this,e,n),this.angle=r,void 0!==i&&(this.segment=i)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(i);function Nu(t,e){var n=e.expression;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new si(t+1))};if("source"===n.kind)return{kind:"source"};for(var r=n.zoomStops,i=n.interpolationType,o=0;o<r.length&&r[o]<=t;)o++;for(var a=o=Math.max(0,o-1);a<r.length&&r[a]<t+1;)a++;a=Math.min(r.length-1,a);var s=r[o],u=r[a];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:u,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:u,minSize:n.evaluate(new si(s)),maxSize:n.evaluate(new si(u)),interpolationType:i}}function Bu(t,e,n){var r=e.uSize,i=n.lowerSize;return"source"===t.kind?i/128:"composite"===t.kind?Ve(i/128,n.upperSize/128,e.uSizeT):r}function zu(t,e){var n=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){var i=t.interpolationType,o=i?c(an.interpolationFactor(i,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?r=Ve(t.minSize,t.maxSize,o):n=o}return{uSizeT:n,uSize:r}}zr("Anchor",Du);var Fu=Object.freeze({__proto__:null,getSizeData:Nu,evaluateSizeForFeature:Bu,evaluateSizeForZoom:zu,SIZE_PACK_FACTOR:128});function Zu(t,e,n,r,i){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-n/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var u=[],l=0;s<n/2;){var c=t[a],h=t[a+1];if(!h)return!1;var f=t[a-1].angleTo(c)-c.angleTo(h);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:f}),l+=f;s-u[0].distance>r;)l-=u.shift().angleDelta;if(l>i)return!1;a++,s+=c.dist(h)}return!0}function ju(t){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Uu(t,e,n){return t?.6*e*n:0}function Gu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Vu(t,e,n,r,i,o){for(var a=Uu(n,i,o),s=Gu(n,r)*o,u=0,l=ju(t)/2,c=0;c<t.length-1;c++){var h=t[c],f=t[c+1],p=h.dist(f);if(u+p>l){var d=(l-u)/p,g=Ve(h.x,f.x,d),v=Ve(h.y,f.y,d),m=new Du(g,v,f.angleTo(h),c);return m._round(),!a||Zu(t,m,s,a,e)?m:void 0}u+=p}}function Wu(t,e,n,r,i,o,a,s,u){var l=Uu(r,o,a),c=Gu(r,i),h=c*a,f=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-h<e/4&&(e=h+e/4),function t(e,n,r,i,o,a,s,u,l){for(var c=a/2,h=ju(e),f=0,p=n-r,d=[],g=0;g<e.length-1;g++){for(var v=e[g],m=e[g+1],y=v.dist(m),_=m.angleTo(v);p+r<f+y;){var b=((p+=r)-f)/y,x=Ve(v.x,m.x,b),w=Ve(v.y,m.y,b);if(x>=0&&x<l&&w>=0&&w<l&&p-c>=0&&p+c<=h){var E=new Du(x,w,_,g);E._round(),i&&!Zu(e,E,a,i,o)||d.push(E)}}f+=y}return u||d.length||s||(d=t(e,f/2,r,i,o,a,s,!0,l)),d}(t,f?e/2*s%e:(c/2+2*o)*a*s%e,e,l,n,h,f,!1,u)}function Hu(t,e,n,r,o){for(var a=[],s=0;s<t.length;s++)for(var u=t[s],l=void 0,c=0;c<u.length-1;c++){var h=u[c],f=u[c+1];h.x<e&&f.x<e||(h.x<e?h=new i(e,h.y+(e-h.x)/(f.x-h.x)*(f.y-h.y))._round():f.x<e&&(f=new i(e,h.y+(e-h.x)/(f.x-h.x)*(f.y-h.y))._round()),h.y<n&&f.y<n||(h.y<n?h=new i(h.x+(n-h.y)/(f.y-h.y)*(f.x-h.x),n)._round():f.y<n&&(f=new i(h.x+(n-h.y)/(f.y-h.y)*(f.x-h.x),n)._round()),h.x>=r&&f.x>=r||(h.x>=r?h=new i(r,h.y+(r-h.x)/(f.x-h.x)*(f.y-h.y))._round():f.x>=r&&(f=new i(r,h.y+(r-h.x)/(f.x-h.x)*(f.y-h.y))._round()),h.y>=o&&f.y>=o||(h.y>=o?h=new i(h.x+(o-h.y)/(f.y-h.y)*(f.x-h.x),o)._round():f.y>=o&&(f=new i(h.x+(o-h.y)/(f.y-h.y)*(f.x-h.x),o)._round()),l&&h.equals(l[l.length-1])||a.push(l=[h]),l.push(f)))))}return a}function Xu(t,e,n,r){var o=[],a=t.image,s=a.pixelRatio,u=a.paddedRect.w-2,l=a.paddedRect.h-2,c=t.right-t.left,h=t.bottom-t.top,f=a.stretchX||[[0,u]],p=a.stretchY||[[0,l]],d=function(t,e){return t+e[1]-e[0]},g=f.reduce(d,0),v=p.reduce(d,0),m=u-g,y=l-v,_=0,b=g,x=0,w=v,E=0,S=m,C=0,A=y;if(a.content&&r){var T=a.content;_=Yu(f,0,T[0]),x=Yu(p,0,T[1]),b=Yu(f,T[0],T[2]),w=Yu(p,T[1],T[3]),E=T[0]-_,C=T[1]-x,S=T[2]-T[0]-b,A=T[3]-T[1]-w}var k=function(r,o,u,l){var f=Ku(r.stretch-_,b,c,t.left),p=Qu(r.fixed-E,S,r.stretch,g),d=Ku(o.stretch-x,w,h,t.top),m=Qu(o.fixed-C,A,o.stretch,v),y=Ku(u.stretch-_,b,c,t.left),T=Qu(u.fixed-E,S,u.stretch,g),k=Ku(l.stretch-x,w,h,t.top),M=Qu(l.fixed-C,A,l.stretch,v),P=new i(f,d),I=new i(y,d),O=new i(y,k),R=new i(f,k),L=new i(p/s,m/s),D=new i(T/s,M/s),N=e*Math.PI/180;if(N){var B=Math.sin(N),z=Math.cos(N),F=[z,-B,B,z];P._matMult(F),I._matMult(F),R._matMult(F),O._matMult(F)}var Z=r.stretch+r.fixed,j=o.stretch+o.fixed;return{tl:P,tr:I,bl:R,br:O,tex:{x:a.paddedRect.x+1+Z,y:a.paddedRect.y+1+j,w:u.stretch+u.fixed-Z,h:l.stretch+l.fixed-j},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:L,pixelOffsetBR:D,minFontScaleX:S/s/c,minFontScaleY:A/s/h,isSDF:n}};if(r&&(a.stretchX||a.stretchY))for(var M=qu(f,m,g),P=qu(p,y,v),I=0;I<M.length-1;I++)for(var O=M[I],R=M[I+1],L=0;L<P.length-1;L++)o.push(k(O,P[L],R,P[L+1]));else o.push(k({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:u+1},{fixed:0,stretch:l+1}));return o}function Yu(t,e,n){for(var r=0,i=0,o=t;i<o.length;i+=1){var a=o[i];r+=Math.max(e,Math.min(n,a[1]))-Math.max(e,Math.min(n,a[0]))}return r}function qu(t,e,n){for(var r=[{fixed:-1,stretch:0}],i=0,o=t;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1],l=r[r.length-1];r.push({fixed:s-l.stretch,stretch:l.stretch}),r.push({fixed:s-l.stretch,stretch:l.stretch+(u-s)})}return r.push({fixed:e+1,stretch:n}),r}function Ku(t,e,n,r){return t/e*n+r}function Qu(t,e,n,r){return t-e*n/r}var Ju=function(t,e,n,r,o,a,s,u,l,c){if(this.boxStartIndex=t.length,l){var h=a.top,f=a.bottom,p=a.collisionPadding;p&&(h-=p[1],f+=p[3]);var d=f-h;d>0&&(d=Math.max(10,d),this.circleDiameter=d)}else{var g=a.top*s-u,v=a.bottom*s+u,m=a.left*s-u,y=a.right*s+u,_=a.collisionPadding;if(_&&(m-=_[0]*s,g-=_[1]*s,y+=_[2]*s,v+=_[3]*s),c){var b=new i(m,g),x=new i(y,g),w=new i(m,v),E=new i(y,v),S=c*Math.PI/180;b._rotate(S),x._rotate(S),w._rotate(S),E._rotate(S),m=Math.min(b.x,x.x,w.x,E.x),y=Math.max(b.x,x.x,w.x,E.x),g=Math.min(b.y,x.y,w.y,E.y),v=Math.max(b.y,x.y,w.y,E.y)}t.emplaceBack(e.x,e.y,m,g,y,v,n,r,o)}this.boxEndIndex=t.length},$u=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=tl),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function tl(t,e){return t<e?-1:t>e?1:0}function el(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!1);for(var r=1/0,o=1/0,a=-1/0,s=-1/0,u=t[0],l=0;l<u.length;l++){var c=u[l];(!l||c.x<r)&&(r=c.x),(!l||c.y<o)&&(o=c.y),(!l||c.x>a)&&(a=c.x),(!l||c.y>s)&&(s=c.y)}var h=Math.min(a-r,s-o),f=h/2,p=new $u([],nl);if(0===h)return new i(r,o);for(var d=r;d<a;d+=h)for(var g=o;g<s;g+=h)p.push(new rl(d+f,g+f,f,t));for(var v=function(t){for(var e=0,n=0,r=0,i=t[0],o=0,a=i.length,s=a-1;o<a;s=o++){var u=i[o],l=i[s],c=u.x*l.y-l.x*u.y;n+=(u.x+l.x)*c,r+=(u.y+l.y)*c,e+=3*c}return new rl(n/e,r/e,0,t)}(t),m=p.length;p.length;){var y=p.pop();(y.d>v.d||!v.d)&&(v=y,n&&console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,m)),y.max-v.d<=e||(p.push(new rl(y.p.x-(f=y.h/2),y.p.y-f,f,t)),p.push(new rl(y.p.x+f,y.p.y-f,f,t)),p.push(new rl(y.p.x-f,y.p.y+f,f,t)),p.push(new rl(y.p.x+f,y.p.y+f,f,t)),m+=4)}return n&&(console.log("num probes: "+m),console.log("best distance: "+v.d)),v.p}function nl(t,e){return e.max-t.max}function rl(t,e,n,r){this.p=new i(t,e),this.h=n,this.d=function(t,e){for(var n=!1,r=1/0,i=0;i<e.length;i++)for(var o=e[i],a=0,s=o.length,u=s-1;a<s;u=a++){var l=o[a],c=o[u];l.y>t.y!=c.y>t.y&&t.x<(c.x-l.x)*(t.y-l.y)/(c.y-l.y)+l.x&&(n=!n),r=Math.min(r,Qo(t,l,c))}return(n?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}$u.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},$u.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},$u.prototype.peek=function(){return this.data[0]},$u.prototype._up=function(t){for(var e=this.data,n=this.compare,r=e[t];t>0;){var i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r},$u.prototype._down=function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t];t<r;){var o=1+(t<<1),a=e[o],s=o+1;if(s<this.length&&n(e[s],a)<0&&(o=s,a=e[s]),n(a,i)>=0)break;e[t]=a,t=o}e[t]=i};var il=Number.POSITIVE_INFINITY;function ol(t,e){return e[1]!==il?function(t,e,n){var r=0,i=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":i=n-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-n}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}return[r,i]}(t,e[0],e[1]):function(t,e){var n=0,r=0;e<0&&(e=0);var i=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-e;break;case"top":r=e-7}switch(t){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=e;break;case"right":n=-e}return[n,r]}(t,e[0])}function al(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sl(t,e,n,r,o,a,s,u,l,c,h,f,p,d,g){var v=function(t,e,n,r,o,a,s,u){for(var l=r.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,c=[],h=0,f=e.positionedLines;h<f.length;h+=1)for(var p=f[h],d=0,g=p.positionedGlyphs;d<g.length;d+=1){var v=g[d];if(v.rect){var m=v.rect||{},y=4,_=!0,b=1,x=0,w=(o||u)&&v.vertical,E=v.metrics.advance*v.scale/2;if(u&&e.verticalizable&&(x=p.lineOffset/2-(v.imageName?-(24-v.metrics.width*v.scale)/2:24*(v.scale-1))),v.imageName){var S=s[v.imageName];_=S.sdf,y=1/(b=S.pixelRatio)}var C=o?[v.x+E,v.y]:[0,0],A=o?[0,0]:[v.x+E+n[0],v.y+n[1]-x],T=[0,0];w&&(T=A,A=[0,0]);var k=(v.metrics.left-y)*v.scale-E+A[0],M=(-v.metrics.top-y)*v.scale+A[1],P=k+m.w*v.scale/b,I=M+m.h*v.scale/b,O=new i(k,M),R=new i(P,M),L=new i(k,I),D=new i(P,I);if(w){var N=new i(-E,E- -17),B=-Math.PI/2,z=12-E,F=new i(22-z,-(v.imageName?z:0)),Z=new(Function.prototype.bind.apply(i,[null].concat(T)));O._rotateAround(B,N)._add(F)._add(Z),R._rotateAround(B,N)._add(F)._add(Z),L._rotateAround(B,N)._add(F)._add(Z),D._rotateAround(B,N)._add(F)._add(Z)}if(l){var j=Math.sin(l),U=Math.cos(l),G=[U,-j,j,U];O._matMult(G),R._matMult(G),L._matMult(G),D._matMult(G)}var V=new i(0,0),W=new i(0,0);c.push({tl:O,tr:R,bl:L,br:D,tex:m,writingMode:e.writingMode,glyphOffset:C,sectionIndex:v.sectionIndex,isSDF:_,pixelOffsetTL:V,pixelOffsetBR:W,minFontScaleX:0,minFontScaleY:0})}}return c}(0,n,u,o,a,s,r,t.allowVerticalPlacement),m=t.textSizeData,y=null;"source"===m.kind?(y=[128*o.layout.get("text-size").evaluate(s,{})])[0]>32640&&E(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===m.kind&&((y=[128*d.compositeTextSizes[0].evaluate(s,{},g),128*d.compositeTextSizes[1].evaluate(s,{},g)])[0]>32640||y[1]>32640)&&E(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,v,y,u,a,s,c,e,l.lineStartIndex,l.lineLength,p,g);for(var _=0,b=h;_<b.length;_+=1)f[b[_]]=t.text.placedSymbolArray.length-1;return 4*v.length}function ul(t){for(var e in t)return t[e];return null}function ll(t,e,n,r){var i=t.compareText;if(e in i){for(var o=i[e],a=o.length-1;a>=0;a--)if(r.dist(o[a])<n)return!0}else i[e]=[];return i[e].push(r),!1}var cl=bs.VectorTileFeature.types,hl=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fl(t,e,n,r,i,o,a,s,u,l,c,h,f){var p=s?Math.min(32640,Math.round(s[0])):0,d=s?Math.min(32640,Math.round(s[1])):0;t.emplaceBack(e,n,Math.round(32*r),Math.round(32*i),o,a,(p<<1)+(u?1:0),d,16*l,16*c,256*h,256*f)}function pl(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function dl(t){for(var e=0,n=t.sections;e<n.length;e+=1)if(Qr(n[e].text))return!0;return!1}var gl=function(t){this.layoutVertexArray=new Li,this.indexArray=new ji,this.programConfigurations=t,this.segments=new so,this.dynamicLayoutVertexArray=new Di,this.opacityVertexArray=new Ni,this.placedSymbolArray=new $i};gl.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},gl.prototype.upload=function(t,e,n,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,js.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Us.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,hl,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(t))},gl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},zr("SymbolBuffers",gl);var vl=function(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new so,this.collisionVertexArray=new Zi};vl.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Gs.members,!0)},vl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},zr("CollisionBuffers",vl);var ml=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=sa([]),this.placementViewportMatrix=sa([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nu(this.zoom,e["text-size"]),this.iconSizeData=Nu(this.zoom,e["icon-size"]);var n=this.layers[0].layout,r=n.get("symbol-sort-key"),i=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map((function(t){return xu[t]}))),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID};ml.prototype.createArrays=function(){this.text=new gl(new Do(this.layers,this.zoom,(function(t){return/^text/.test(t)}))),this.icon=new gl(new Do(this.layers,this.zoom,(function(t){return/^icon/.test(t)}))),this.glyphOffsetArray=new no,this.lineVertexArray=new ro,this.symbolInstances=new eo},ml.prototype.calculateGlyphDependencies=function(t,e,n,r,i){for(var o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(n||r)&&i){var a=Xs[t.charAt(o)];a&&(e[a.charCodeAt(0)]=!0)}},ml.prototype.populate=function(t,e,n){var r=this.layers[0],i=r.layout,o=i.get("text-font"),a=i.get("text-field"),s=i.get("icon-image"),u=("constant"!==a.value.kind||a.value.value instanceof re&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),l="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,c=i.get("symbol-sort-key");if(this.features=[],u||l){for(var h=e.iconDependencies,f=e.glyphDependencies,p=e.availableImages,d=new si(this.zoom),g=0,v=t;g<v.length;g+=1){var m=v[g],y=m.feature,_=m.id,b=m.index,x=m.sourceLayerIndex,w=r._featureFilter.needGeometry,E=jo(y,w);if(r._featureFilter.filter(d,E,n)){w||(E.geometry=Zo(y));var S=void 0;if(u){var C=r.getValueAndResolveTokens("text-field",E,n,p),A=re.factory(C);dl(A)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ii()||this.hasRTLText&&ai.isParsed())&&(S=Hs(A,r,E))}var T=void 0;if(l){var k=r.getValueAndResolveTokens("icon-image",E,n,p);T=k instanceof ie?k:ie.fromString(k)}if(S||T){var M=this.sortFeaturesByKey?c.evaluate(E,{},n):void 0;if(this.features.push({id:_,text:S,icon:T,index:b,sourceLayerIndex:x,geometry:E.geometry,properties:y.properties,type:cl[y.type],sortKey:M}),T&&(h[T.name]=!0),S){var P=o.evaluate(E,{},n).join(","),I="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(xu.vertical)>=0;for(var O=0,R=S.sections;O<R.length;O+=1){var L=R[O];if(L.image)h[L.image.name]=!0;else{var D=Hr(S.toString()),N=L.fontStack||P,B=f[N]=f[N]||{};this.calculateGlyphDependencies(L.text,B,I,this.allowVerticalPlacement,D)}}}}}}"line"===i.get("symbol-placement")&&(this.features=function(t){var e={},n={},r=[],i=0;function o(e){r.push(t[e]),i++}function a(t,e,i){var o=n[t];return delete n[t],n[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(i[0]),o}function s(t,n,i){var o=e[n];return delete e[n],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function u(t,e,n){var r=n?e[0][e[0].length-1]:e[0][0];return t+":"+r.x+":"+r.y}for(var l=0;l<t.length;l++){var c=t[l],h=c.geometry,f=c.text?c.text.toString():null;if(f){var p=u(f,h),d=u(f,h,!0);if(p in n&&d in e&&n[p]!==e[d]){var g=s(p,d,h),v=a(p,d,r[g].geometry);delete e[p],delete n[d],n[u(f,r[v].geometry,!0)]=v,r[g].geometry=null}else p in n?a(p,d,h):d in e?s(p,d,h):(o(l),e[p]=i-1,n[d]=i-1)}else o(l)}return r.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}))}},ml.prototype.update=function(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))},ml.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},ml.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},ml.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},ml.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},ml.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},ml.prototype.addToLineVertexArray=function(t,e){var n=this.lineVertexArray.length;if(void 0!==t.segment){for(var r=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:r},a<e.length-1&&(r+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=o[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}},ml.prototype.addSymbols=function(t,e,n,r,i,o,a,s,u,l,c,h){for(var f=t.indexArray,p=t.layoutVertexArray,d=t.segments.prepareSegment(4*e.length,p,f,this.canOverlap?o.sortKey:void 0),g=this.glyphOffsetArray.length,v=d.vertexLength,m=this.allowVerticalPlacement&&a===xu.vertical?Math.PI/2:0,y=o.text&&o.text.sections,_=0;_<e.length;_++){var b=e[_],x=b.tl,w=b.tr,E=b.bl,S=b.br,C=b.tex,A=b.pixelOffsetTL,T=b.pixelOffsetBR,k=b.minFontScaleX,M=b.minFontScaleY,P=b.glyphOffset,I=b.isSDF,O=b.sectionIndex,R=d.vertexLength,L=P[1];fl(p,s.x,s.y,x.x,L+x.y,C.x,C.y,n,I,A.x,A.y,k,M),fl(p,s.x,s.y,w.x,L+w.y,C.x+C.w,C.y,n,I,T.x,A.y,k,M),fl(p,s.x,s.y,E.x,L+E.y,C.x,C.y+C.h,n,I,A.x,T.y,k,M),fl(p,s.x,s.y,S.x,L+S.y,C.x+C.w,C.y+C.h,n,I,T.x,T.y,k,M),pl(t.dynamicLayoutVertexArray,s,m),f.emplaceBack(R,R+1,R+2),f.emplaceBack(R+1,R+2,R+3),d.vertexLength+=4,d.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(P[0]),_!==e.length-1&&O===e[_+1].sectionIndex||t.programConfigurations.populatePaintArrays(p.length,o,o.index,{},h,y&&y[O])}t.placedSymbolArray.emplaceBack(s.x,s.y,g,this.glyphOffsetArray.length-g,v,u,l,s.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],a,0,!1,0,c)},ml.prototype._addCollisionDebugVertex=function(t,e,n,r,i,o){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,r,i,Math.round(o.x),Math.round(o.y))},ml.prototype.addCollisionDebugVertices=function(t,e,n,r,o,a,s){var u=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),l=u.vertexLength,c=o.layoutVertexArray,h=o.collisionVertexArray,f=s.anchorX,p=s.anchorY;this._addCollisionDebugVertex(c,h,a,f,p,new i(t,e)),this._addCollisionDebugVertex(c,h,a,f,p,new i(n,e)),this._addCollisionDebugVertex(c,h,a,f,p,new i(n,r)),this._addCollisionDebugVertex(c,h,a,f,p,new i(t,r)),u.vertexLength+=4;var d=o.indexArray;d.emplaceBack(l,l+1),d.emplaceBack(l+1,l+2),d.emplaceBack(l+2,l+3),d.emplaceBack(l+3,l),u.primitiveLength+=4},ml.prototype.addDebugCollisionBoxes=function(t,e,n,r){for(var i=t;i<e;i++){var o=this.collisionBoxArray.get(i);this.addCollisionDebugVertices(o.x1,o.y1,o.x2,o.y2,r?this.textCollisionBox:this.iconCollisionBox,o.anchorPoint,n)}},ml.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vl(zi,Vs.members,Xi),this.iconCollisionBox=new vl(zi,Vs.members,Xi);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},ml.prototype._deserializeCollisionBoxesForSymbol=function(t,e,n,r,i,o,a,s,u){for(var l={},c=e;c<n;c++){var h=t.get(c);l.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},l.textFeatureIndex=h.featureIndex;break}for(var f=r;f<i;f++){var p=t.get(f);l.verticalTextBox={x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2,anchorPointX:p.anchorPointX,anchorPointY:p.anchorPointY},l.verticalTextFeatureIndex=p.featureIndex;break}for(var d=o;d<a;d++){var g=t.get(d);l.iconBox={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,anchorPointX:g.anchorPointX,anchorPointY:g.anchorPointY},l.iconFeatureIndex=g.featureIndex;break}for(var v=s;v<u;v++){var m=t.get(v);l.verticalIconBox={x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,anchorPointX:m.anchorPointX,anchorPointY:m.anchorPointY},l.verticalIconFeatureIndex=m.featureIndex;break}return l},ml.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}},ml.prototype.hasTextData=function(){return this.text.segments.get().length>0},ml.prototype.hasIconData=function(){return this.icon.segments.get().length>0},ml.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},ml.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},ml.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},ml.prototype.addIndicesForPlacedSymbol=function(t,e){for(var n=t.placedSymbolArray.get(e),r=n.vertexStartIndex+4*n.numGlyphs,i=n.vertexStartIndex;i<r;i+=4)t.indexArray.emplaceBack(i,i+1,i+2),t.indexArray.emplaceBack(i+1,i+2,i+3)},ml.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),n=Math.cos(t),r=[],i=[],o=[],a=0;a<this.symbolInstances.length;++a){o.push(a);var s=this.symbolInstances.get(a);r.push(0|Math.round(e*s.anchorX+n*s.anchorY)),i.push(s.featureIndex)}return o.sort((function(t,e){return r[t]-r[e]||i[e]-i[t]})),o},ml.prototype.addToSortKeyRanges=function(t,e){var n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===e?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},ml.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var n=0,r=this.symbolInstanceIndexes;n<r.length;n+=1){var i=this.symbolInstances.get(r[n]);this.featureSortOrder.push(i.featureIndex),[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((function(t,n,r){t>=0&&r.indexOf(t)===n&&e.addIndicesForPlacedSymbol(e.text,t)})),i.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,i.verticalPlacedTextSymbolIndex),i.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.placedIconSymbolIndex),i.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},zr("SymbolBucket",ml,{omit:["layers","collisionBoxArray","features","compareText"]}),ml.MAX_GLYPHS=65535,ml.addDynamicAttributes=pl;var yl=new xi({"symbol-placement":new vi(Mt.layout_symbol["symbol-placement"]),"symbol-spacing":new vi(Mt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new vi(Mt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mi(Mt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new vi(Mt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new vi(Mt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new vi(Mt.layout_symbol["icon-ignore-placement"]),"icon-optional":new vi(Mt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new vi(Mt.layout_symbol["icon-rotation-alignment"]),"icon-size":new mi(Mt.layout_symbol["icon-size"]),"icon-text-fit":new vi(Mt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new vi(Mt.layout_symbol["icon-text-fit-padding"]),"icon-image":new mi(Mt.layout_symbol["icon-image"]),"icon-rotate":new mi(Mt.layout_symbol["icon-rotate"]),"icon-padding":new vi(Mt.layout_symbol["icon-padding"]),"icon-keep-upright":new vi(Mt.layout_symbol["icon-keep-upright"]),"icon-offset":new mi(Mt.layout_symbol["icon-offset"]),"icon-anchor":new mi(Mt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new vi(Mt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new vi(Mt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new vi(Mt.layout_symbol["text-rotation-alignment"]),"text-field":new mi(Mt.layout_symbol["text-field"]),"text-font":new mi(Mt.layout_symbol["text-font"]),"text-size":new mi(Mt.layout_symbol["text-size"]),"text-max-width":new mi(Mt.layout_symbol["text-max-width"]),"text-line-height":new vi(Mt.layout_symbol["text-line-height"]),"text-letter-spacing":new mi(Mt.layout_symbol["text-letter-spacing"]),"text-justify":new mi(Mt.layout_symbol["text-justify"]),"text-radial-offset":new mi(Mt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new vi(Mt.layout_symbol["text-variable-anchor"]),"text-anchor":new mi(Mt.layout_symbol["text-anchor"]),"text-max-angle":new vi(Mt.layout_symbol["text-max-angle"]),"text-writing-mode":new vi(Mt.layout_symbol["text-writing-mode"]),"text-rotate":new mi(Mt.layout_symbol["text-rotate"]),"text-padding":new vi(Mt.layout_symbol["text-padding"]),"text-keep-upright":new vi(Mt.layout_symbol["text-keep-upright"]),"text-transform":new mi(Mt.layout_symbol["text-transform"]),"text-offset":new mi(Mt.layout_symbol["text-offset"]),"text-allow-overlap":new vi(Mt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new vi(Mt.layout_symbol["text-ignore-placement"]),"text-optional":new vi(Mt.layout_symbol["text-optional"])}),_l={paint:new xi({"icon-opacity":new mi(Mt.paint_symbol["icon-opacity"]),"icon-color":new mi(Mt.paint_symbol["icon-color"]),"icon-halo-color":new mi(Mt.paint_symbol["icon-halo-color"]),"icon-halo-width":new mi(Mt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mi(Mt.paint_symbol["icon-halo-blur"]),"icon-translate":new vi(Mt.paint_symbol["icon-translate"]),"icon-translate-anchor":new vi(Mt.paint_symbol["icon-translate-anchor"]),"text-opacity":new mi(Mt.paint_symbol["text-opacity"]),"text-color":new mi(Mt.paint_symbol["text-color"],{runtimeType:jt,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new mi(Mt.paint_symbol["text-halo-color"]),"text-halo-width":new mi(Mt.paint_symbol["text-halo-width"]),"text-halo-blur":new mi(Mt.paint_symbol["text-halo-blur"]),"text-translate":new vi(Mt.paint_symbol["text-translate"]),"text-translate-anchor":new vi(Mt.paint_symbol["text-translate-anchor"])}),layout:yl},bl=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Bt,this.defaultValue=t};bl.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},bl.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},bl.prototype.outputDefined=function(){return!1},bl.prototype.serialize=function(){return null},zr("FormatSectionOverride",bl,{omit:["defaultValue"]});var xl=function(t){function e(e){t.call(this,e,_l)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,n){if(t.prototype.recalculate.call(this,e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var r=this.layout.get("text-writing-mode");if(r){for(var i=[],o=0,a=r;o<a.length;o+=1){var s=a[o];i.indexOf(s)<0&&i.push(s)}this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(t,e,n,r){var i=this.layout.get(t).evaluate(e,{},n,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||Hn(o.value)||!i?i:function(t,e){return e.replace(/{([^{}]+)}/g,(function(e,n){return n in t?String(t[n]):""}))}(e.properties,i)},e.prototype.createBucket=function(t){return new ml(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var t=0,n=_l.paint.overridableProperties;t<n.length;t+=1){var r=n[t];if(e.hasPaintOverride(this.layout,r)){var i,o=this.paint.get(r),a=new bl(o),s=new Wn(a,o.property.specification);i="constant"===o.value.kind||"source"===o.value.kind?new Yn("source",s):new qn("composite",s,o.value.zoomStops,o.value._interpolationType),this.paint._values[r]=new di(o.property,i,o.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,n,r){return!(!this.layout||n.isDataDriven()||r.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var n=t.get("text-field"),r=_l.paint.properties[e],i=!1,o=function(t){for(var e=0,n=t;e<n.length;e+=1)if(r.overrides&&r.overrides.hasOverride(n[e]))return void(i=!0)};if("constant"===n.value.kind&&n.value.value instanceof re)o(n.value.value.sections);else if("source"===n.value.kind){var a=function(t){i||(t instanceof le&&se(t.value)===Wt?o(t.value.sections):t instanceof pe?o(t.sections):t.eachChild(a))},s=n.value;s._styleExpression&&a(s._styleExpression.expression)}return i},e}(wi),wl={paint:new xi({"background-color":new vi(Mt.paint_background["background-color"]),"background-pattern":new _i(Mt.paint_background["background-pattern"]),"background-opacity":new vi(Mt.paint_background["background-opacity"])})},El=function(t){function e(e){t.call(this,e,wl)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(wi),Sl={paint:new xi({"raster-opacity":new vi(Mt.paint_raster["raster-opacity"]),"raster-hue-rotate":new vi(Mt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new vi(Mt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new vi(Mt.paint_raster["raster-brightness-max"]),"raster-saturation":new vi(Mt.paint_raster["raster-saturation"]),"raster-contrast":new vi(Mt.paint_raster["raster-contrast"]),"raster-resampling":new vi(Mt.paint_raster["raster-resampling"]),"raster-fade-duration":new vi(Mt.paint_raster["raster-fade-duration"])})},Cl=function(t){function e(e){t.call(this,e,Sl)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(wi),Al=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},e}(wi),Tl={circle:fa,heatmap:wa,hillshade:Sa,fill:cs,"fill-extrusion":Ts,line:Fs,symbol:xl,background:El,raster:Cl},kl=a.HTMLImageElement,Ml=a.HTMLCanvasElement,Pl=a.HTMLVideoElement,Il=a.ImageData,Ol=a.ImageBitmap,Rl=function(t,e,n,r){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,r)};Rl.prototype.update=function(t,e,n){var r=t.width,i=t.height,o=!(this.size&&this.size[0]===r&&this.size[1]===i||n),a=this.context,s=a.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[r,i],t instanceof kl||t instanceof Ml||t instanceof Pl||t instanceof Il||Ol&&t instanceof Ol?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,r,i,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=n||{x:0,y:0},l=u.x,c=u.y;t instanceof kl||t instanceof Ml||t instanceof Pl||t instanceof Il||Ol&&t instanceof Ol?s.texSubImage2D(s.TEXTURE_2D,0,l,c,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,l,c,r,i,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Rl.prototype.bind=function(t,e,n){var r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)},Rl.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Rl.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ll=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};Ll.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){t._triggered=!1,t._callback()}),0))},Ll.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Dl=function(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},m(["receive","process"],this),this.invoker=new Ll(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=A()?t:a};function Nl(t,e,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}Dl.prototype.send=function(t,e,n,r,i){var o=this;void 0===i&&(i=!1);var a=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[a]=n);var s=M(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:t,hasCallback:!!n,targetMapId:r,mustQueue:i,sourceMapId:this.mapId,data:Ur(e,s)},s),{cancel:function(){n&&delete o.callbacks[a],o.target.postMessage({id:a,type:"<cancel>",targetMapId:r,sourceMapId:o.mapId})}}},Dl.prototype.receive=function(t){var e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[n];var r=this.cancelCallbacks[n];delete this.cancelCallbacks[n],r&&r()}else A()||e.mustQueue?(this.tasks[n]=e,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,e)},Dl.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},Dl.prototype.processTask=function(t,e){var n=this;if("<response>"===e.type){var r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(Gr(e.error)):r(null,Gr(e.data)))}else{var i=!1,o=M(this.globalScope)?void 0:[],a=e.hasCallback?function(e,r){i=!0,delete n.cancelCallbacks[t],n.target.postMessage({id:t,type:"<response>",sourceMapId:n.mapId,error:e?Ur(e):null,data:Ur(r,o)},o)}:function(t){i=!0},s=null,u=Gr(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,u,a);else if(this.parent.getWorkerSource){var l=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,l[0],u.source)[l[1]](u,a)}else a(new Error("Could not find function "+e.type));!i&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}},Dl.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Bl=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Bl.prototype.setNorthEast=function(t){return this._ne=t instanceof zl?new zl(t.lng,t.lat):zl.convert(t),this},Bl.prototype.setSouthWest=function(t){return this._sw=t instanceof zl?new zl(t.lng,t.lat):zl.convert(t),this},Bl.prototype.extend=function(t){var e,n,r=this._sw,i=this._ne;if(t instanceof zl)e=t,n=t;else{if(!(t instanceof Bl))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Bl.convert(t)):this.extend(zl.convert(t)):this;if(n=t._ne,!(e=t._sw)||!n)return this}return r||i?(r.lng=Math.min(e.lng,r.lng),r.lat=Math.min(e.lat,r.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new zl(e.lng,e.lat),this._ne=new zl(n.lng,n.lat)),this},Bl.prototype.getCenter=function(){return new zl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Bl.prototype.getSouthWest=function(){return this._sw},Bl.prototype.getNorthEast=function(){return this._ne},Bl.prototype.getNorthWest=function(){return new zl(this.getWest(),this.getNorth())},Bl.prototype.getSouthEast=function(){return new zl(this.getEast(),this.getSouth())},Bl.prototype.getWest=function(){return this._sw.lng},Bl.prototype.getSouth=function(){return this._sw.lat},Bl.prototype.getEast=function(){return this._ne.lng},Bl.prototype.getNorth=function(){return this._ne.lat},Bl.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Bl.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Bl.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Bl.prototype.contains=function(t){var e=zl.convert(t),n=e.lng,r=e.lat,i=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i},Bl.convert=function(t){return!t||t instanceof Bl?t:new Bl(t)};var zl=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};zl.prototype.wrap=function(){return new zl(h(this.lng,-180,180),this.lat)},zl.prototype.toArray=function(){return[this.lng,this.lat]},zl.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},zl.prototype.distanceTo=function(t){var e=Math.PI/180,n=this.lat*e,r=t.lat*e,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(i,1))},zl.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new Bl(new zl(this.lng-n,this.lat-e),new zl(this.lng+n,this.lat+e))},zl.convert=function(t){if(t instanceof zl)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new zl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new zl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Fl=2*Math.PI*6371008.8;function Zl(t){return Fl*Math.cos(t*Math.PI/180)}function jl(t){return(180+t)/360}function Ul(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Gl(t,e){return t/Zl(e)}function Vl(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Wl=function(t,e,n){void 0===n&&(n=0),this.x=+t,this.y=+e,this.z=+n};Wl.fromLngLat=function(t,e){void 0===e&&(e=0);var n=zl.convert(t);return new Wl(jl(n.lng),Ul(n.lat),Gl(e,n.lat))},Wl.prototype.toLngLat=function(){return new zl(360*this.x-180,Vl(this.y))},Wl.prototype.toAltitude=function(){return this.z*Zl(Vl(this.y))},Wl.prototype.meterInMercatorCoordinateUnits=function(){return 1/Fl*(t=Vl(this.y),1/Math.cos(t*Math.PI/180));var t};var Hl=function(t,e,n){this.z=t,this.x=e,this.y=n,this.key=ql(0,t,t,e,n)};Hl.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Hl.prototype.url=function(t,e){var n,r,i,o,a,s=(r=this.y,i=this.z,o=Nl(256*(n=this.x),256*(r=Math.pow(2,i)-r-1),i),a=Nl(256*(n+1),256*(r+1),i),o[0]+","+o[1]+","+a[0]+","+a[1]),u=function(t,e,n){for(var r,i="",o=t;o>0;o--)i+=(e&(r=1<<o-1)?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},Hl.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new i(8192*(t.x*e-this.x),8192*(t.y*e-this.y))},Hl.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Xl=function(t,e){this.wrap=t,this.canonical=e,this.key=ql(t,e.z,e.z,e.x,e.y)},Yl=function(t,e,n,r,i){this.overscaledZ=t,this.wrap=e,this.canonical=new Hl(n,+r,+i),this.key=ql(e,t,n,r,i)};function ql(t,e,n,r,i){(t*=2)<0&&(t=-1*t-1);var o=1<<n;return(o*o*t+o*i+r).toString(36)+n.toString(36)+e.toString(36)}Yl.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Yl.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Yl(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Yl(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Yl.prototype.calculateScaledKey=function(t,e){var n=this.canonical.z-t;return t>this.canonical.z?ql(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):ql(this.wrap*+e,t,t,this.canonical.x>>n,this.canonical.y>>n)},Yl.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Yl.prototype.children=function(t){if(this.overscaledZ>=t)return[new Yl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new Yl(e,this.wrap,e,n,r),new Yl(e,this.wrap,e,n+1,r),new Yl(e,this.wrap,e,n,r+1),new Yl(e,this.wrap,e,n+1,r+1)]},Yl.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Yl.prototype.wrapped=function(){return new Yl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Yl.prototype.unwrapTo=function(t){return new Yl(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Yl.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Yl.prototype.toUnwrapped=function(){return new Xl(this.wrap,this.canonical)},Yl.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Yl.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Wl(t.x-this.wrap,t.y))},zr("CanonicalTileID",Hl),zr("OverscaledTileID",Yl,{omit:["posMatrix"]});var Kl=function(t,e,n){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return E('"'+n+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var r=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=n||"mapbox";for(var i=0;i<r;i++)this.data[this._idx(-1,i)]=this.data[this._idx(0,i)],this.data[this._idx(r,i)]=this.data[this._idx(r-1,i)],this.data[this._idx(i,-1)]=this.data[this._idx(i,0)],this.data[this._idx(i,r)]=this.data[this._idx(i,r-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(r,-1)]=this.data[this._idx(r-1,0)],this.data[this._idx(-1,r)]=this.data[this._idx(0,r-1)],this.data[this._idx(r,r)]=this.data[this._idx(r-1,r-1)]};Kl.prototype.get=function(t,e){var n=new Uint8Array(this.data.buffer),r=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(n[r],n[r+1],n[r+2])},Kl.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Kl.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Kl.prototype._unpackMapbox=function(t,e,n){return(256*t*256+256*e+n)/10-1e4},Kl.prototype._unpackTerrarium=function(t,e,n){return 256*t+e+n/256-32768},Kl.prototype.getPixels=function(){return new _a({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Kl.prototype.backfillBorder=function(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var r=e*this.dim,i=e*this.dim+this.dim,o=n*this.dim,a=n*this.dim+this.dim;switch(e){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:o=a-1;break;case 1:a=o+1}for(var s=-e*this.dim,u=-n*this.dim,l=o;l<a;l++)for(var c=r;c<i;c++)this.data[this._idx(c,l)]=t.data[this._idx(c+s,l+u)]},zr("DEMData",Kl);var Ql=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}};Ql.prototype.encode=function(t){return this._stringToNumber[t]},Ql.prototype.decode=function(t){return this._numberToString[t]};var Jl=function(t,e,n,r,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=r,this.properties=t.properties,this.id=i},$l={geometry:{configurable:!0}};$l.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},$l.geometry.set=function(t){this._geometry=t},Jl.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Jl.prototype,$l);var tc=function(){this.state={},this.stateChanges={},this.deletedStates={}};tc.prototype.updateState=function(t,e,n){var r=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},f(this.stateChanges[t][r],n),null===this.deletedStates[t])for(var i in this.deletedStates[t]={},this.state[t])i!==r&&(this.deletedStates[t][i]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][r])for(var o in this.deletedStates[t][r]={},this.state[t][r])n[o]||(this.deletedStates[t][r][o]=null);else for(var a in n)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][a]&&delete this.deletedStates[t][r][a]},tc.prototype.removeFeatureState=function(t,e,n){if(null!==this.deletedStates[t]){var r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][n]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(n in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][n]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}},tc.prototype.getState=function(t,e){var n=String(e),r=f({},(this.state[t]||{})[n],(this.stateChanges[t]||{})[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var i=this.deletedStates[t][e];if(null===i)return{};for(var o in i)delete r[o]}return r},tc.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},tc.prototype.coalesceChanges=function(t,e){var n={};for(var r in this.stateChanges){this.state[r]=this.state[r]||{};var i={};for(var o in this.stateChanges[r])this.state[r][o]||(this.state[r][o]={}),f(this.state[r][o],this.stateChanges[r][o]),i[o]=this.state[r][o];n[r]=i}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var u in this.state[a])s[u]={},this.state[a][u]={};else for(var l in this.deletedStates[a]){if(null===this.deletedStates[a][l])this.state[a][l]={};else for(var c=0,h=Object.keys(this.deletedStates[a][l]);c<h.length;c+=1)delete this.state[a][l][h[c]];s[l]=this.state[a][l]}n[a]=n[a]||{},f(n[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(var p in t)t[p].setFeatureState(n,e)};var ec=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Rr(8192,16,0),this.grid3D=new Rr(8192,16,0),this.featureIndexArray=new oo,this.promoteId=e};function nc(t,e,n,r,i){return _(t,(function(t,o){var a=e instanceof gi?e.get(o):null;return a&&a.evaluate?a.evaluate(n,r,i):a}))}function rc(t){for(var e=1/0,n=1/0,r=-1/0,i=-1/0,o=0,a=t;o<a.length;o+=1){var s=a[o];e=Math.min(e,s.x),n=Math.min(n,s.y),r=Math.max(r,s.x),i=Math.max(i,s.y)}return{minX:e,minY:n,maxX:r,maxY:i}}function ic(t,e){return e-t}ec.prototype.insert=function(t,e,n,r,i,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i);for(var s=o?this.grid3D:this.grid,u=0;u<e.length;u++){for(var l=e[u],c=[1/0,1/0,-1/0,-1/0],h=0;h<l.length;h++){var f=l[h];c[0]=Math.min(c[0],f.x),c[1]=Math.min(c[1],f.y),c[2]=Math.max(c[2],f.x),c[3]=Math.max(c[3],f.y)}c[0]<8192&&c[1]<8192&&c[2]>=0&&c[3]>=0&&s.insert(a,c[0],c[1],c[2],c[3])}},ec.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new bs.VectorTile(new Ks(this.rawTileData)).layers,this.sourceLayerCoder=new Ql(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ec.prototype.query=function(t,e,n,r){var o=this;this.loadVTLayers();for(var a=t.params||{},s=8192/t.tileSize/t.scale,u=ar(a.filter),l=t.queryGeometry,c=t.queryPadding*s,h=rc(l),f=this.grid.query(h.minX-c,h.minY-c,h.maxX+c,h.maxY+c),p=rc(t.cameraQueryGeometry),d=this.grid3D.query(p.minX-c,p.minY-c,p.maxX+c,p.maxY+c,(function(e,n,r,o){return function(t,e,n,r,o){for(var a=0,s=t;a<s.length;a+=1){var u=s[a];if(e<=u.x&&n<=u.y&&r>=u.x&&o>=u.y)return!0}var l=[new i(e,n),new i(e,o),new i(r,o),new i(r,n)];if(t.length>2)for(var c=0,h=l;c<h.length;c+=1)if($o(t,h[c]))return!0;for(var f=0;f<t.length-1;f++)if(ta(t[f],t[f+1],l))return!0;return!1}(t.cameraQueryGeometry,e-c,n-c,r+c,o+c)})),g=0,v=d;g<v.length;g+=1)f.push(v[g]);f.sort(ic);for(var m,y={},_=function(i){var c=f[i];if(c!==m){m=c;var h=o.featureIndexArray.get(c),p=null;o.loadMatchingFeature(y,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,u,a.layers,a.availableImages,e,n,r,(function(e,n,r){return p||(p=Zo(e)),n.queryIntersectsFeature(l,e,r,p,o.z,t.transform,s,t.pixelPosMatrix)}))}},b=0;b<f.length;b++)_(b);return y},ec.prototype.loadMatchingFeature=function(t,e,n,r,i,o,a,s,u,l,c){var h=this.bucketLayerIDs[e];if(!o||function(t,e){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(o,h)){var p=this.sourceLayerCoder.decode(n),d=this.vtLayers[p].feature(r);if(i.needGeometry){var g=jo(d,!0);if(!i.filter(new si(this.tileID.overscaledZ),g,this.tileID.canonical))return}else if(!i.filter(new si(this.tileID.overscaledZ),d))return;for(var v=this.getId(d,p),m=0;m<h.length;m++){var y=h[m];if(!(o&&o.indexOf(y)<0)){var _=s[y];if(_){var b={};void 0!==v&&l&&(b=l.getState(_.sourceLayer||"_geojsonTileLayer",v));var x=f({},u[y]);x.paint=nc(x.paint,_.paint,d,b,a),x.layout=nc(x.layout,_.layout,d,b,a);var w=!c||c(d,_,b);if(w){var E=new Jl(d,this.z,this.x,this.y,v);E.layer=x;var S=t[y];void 0===S&&(S=t[y]=[]),S.push({featureIndex:r,feature:E,intersectionZ:w})}}}}}},ec.prototype.lookupSymbolFeatures=function(t,e,n,r,i,o,a,s){var u={};this.loadVTLayers();for(var l=ar(i),c=0,h=t;c<h.length;c+=1)this.loadMatchingFeature(u,n,r,h[c],l,o,a,s,e);return u},ec.prototype.hasLayer=function(t){for(var e=0,n=this.bucketLayerIDs;e<n.length;e+=1)for(var r=0,i=n[e];r<i.length;r+=1)if(t===i[r])return!0;return!1},ec.prototype.getId=function(t,e){var n=t.id;return this.promoteId&&"boolean"==typeof(n=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]])&&(n=Number(n)),n},zr("FeatureIndex",ec,{omit:["rawTileData","sourceLayerCoder"]});var oc=function(t,e){this.tileID=t,this.uid=d(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};oc.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<z.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},oc.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},oc.prototype.loadVectorData=function(t,e,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var r in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var n={};if(!e)return n;for(var r=function(){var t=o[i],r=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==r.length){t.layers=r,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return r.filter((function(e){return e.id===t}))[0]})));for(var a=0,s=r;a<s.length;a+=1)n[s[a].id]=t}},i=0,o=t;i<o.length;i+=1)r();return n}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[r];if(i instanceof ml){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var o in this.buckets){var a=this.buckets[o];if(a instanceof ml&&a.hasRTLText){this.hasRTLText=!0,ai.isLoading()||ai.isLoaded()||"deferred"!==ii()||oi();break}}for(var s in this.queryPadding=0,this.buckets){var u=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(u))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Qi},oc.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},oc.prototype.getBucket=function(t){return this.buckets[t.id]},oc.prototype.upload=function(t){for(var e in this.buckets){var n=this.buckets[e];n.uploadPending()&&n.upload(t)}var r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Rl(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Rl(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)},oc.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},oc.prototype.queryRenderedFeatures=function(t,e,n,r,i,o,a,s,u,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:i,scale:o,tileSize:this.tileSize,pixelPosMatrix:l,transform:s,params:a,queryPadding:this.queryPadding*u},t,e,n):{}},oc.prototype.querySourceFeatures=function(t,e){var n=this.latestFeatureIndex;if(n&&n.rawTileData){var r=n.loadVTLayers(),i=e?e.sourceLayer:"",o=r._geojsonTileLayer||r[i];if(o)for(var a=ar(e&&e.filter),s=this.tileID.canonical,u=s.z,l=s.x,c=s.y,h={z:u,x:l,y:c},f=0;f<o.length;f++){var p=o.feature(f);if(a.needGeometry){var d=jo(p,!0);if(!a.filter(new si(this.tileID.overscaledZ),d,this.tileID.canonical))continue}else if(!a.filter(new si(this.tileID.overscaledZ),p))continue;var g=n.getId(p,i),v=new Jl(p,u,l,c,g);v.tile=h,t.push(v)}}},oc.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},oc.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},oc.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var n=T(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var r=Date.now(),i=!1;if(this.expirationTime>r)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{var o=this.expirationTime-e;o?this.expirationTime=r+Math.max(o,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},oc.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},oc.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var n=this.latestFeatureIndex.loadVTLayers();for(var r in this.buckets)if(e.style.hasLayer(r)){var i=this.buckets[r],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=n[o],s=t[o];if(a&&s&&0!==Object.keys(s).length){i.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{});var u=e&&e.style&&e.style.getLayer(r);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(i)))}}}},oc.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},oc.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<z.now()},oc.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},oc.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=z.now()+t},oc.prototype.setDependencies=function(t,e){for(var n={},r=0,i=e;r<i.length;r+=1)n[i[r]]=!0;this.dependencies[t]=n},oc.prototype.hasDependency=function(t,e){for(var n=0,r=t;n<r.length;n+=1){var i=this.dependencies[r[n]];if(i)for(var o=0,a=e;o<a.length;o+=1)if(i[a[o]])return!0}return!1};var ac=a.performance,sc=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},ac.mark(this._marks.start)};sc.prototype.finish=function(){ac.mark(this._marks.end);var t=ac.getEntriesByName(this._marks.measure);return 0===t.length&&(ac.measure(this._marks.measure,this._marks.start,this._marks.end),t=ac.getEntriesByName(this._marks.measure),ac.clearMarks(this._marks.start),ac.clearMarks(this._marks.end),ac.clearMeasures(this._marks.measure)),t},t.Actor=Dl,t.AlphaImage=ya,t.CanonicalTileID=Hl,t.CollisionBoxArray=Qi,t.Color=te,t.DEMData=Kl,t.DataConstantProperty=vi,t.DictionaryCoder=Ql,t.EXTENT=8192,t.ErrorEvent=Tt,t.EvaluationParameters=si,t.Event=At,t.Evented=kt,t.FeatureIndex=ec,t.FillBucket=ss,t.FillExtrusionBucket=Ss,t.ImageAtlas=bu,t.ImagePosition=yu,t.LineBucket=Ds,t.LngLat=zl,t.LngLatBounds=Bl,t.MercatorCoordinate=Wl,t.ONE_EM=24,t.OverscaledTileID=Yl,t.Point=i,t.Point$1=i,t.Properties=xi,t.Protobuf=Ks,t.RGBAImage=_a,t.RequestManager=W,t.RequestPerformance=sc,t.ResourceType=dt,t.SegmentVector=so,t.SourceFeatureState=tc,t.StructArrayLayout1ui2=Yi,t.StructArrayLayout2f1f2i16=Fi,t.StructArrayLayout2i4=ki,t.StructArrayLayout3ui6=ji,t.StructArrayLayout4i8=Mi,t.SymbolBucket=ml,t.Texture=Rl,t.Tile=oc,t.Transitionable=ci,t.Uniform1f=xo,t.Uniform1i=bo,t.Uniform2f=wo,t.Uniform3f=Eo,t.Uniform4f=So,t.UniformColor=Co,t.UniformMatrix4f=To,t.UnwrappedTileID=Xl,t.ValidationError=Pt,t.WritingMode=xu,t.ZoomHistory=Vr,t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},t.addDynamicAttributes=pl,t.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);var r=t.length,i=new Array(t.length),o=null;t.forEach((function(t,a){e(t,(function(t,e){t&&(o=t),i[a]=e,0==--r&&n(o,i)}))}))},t.bezier=u,t.bindAll=m,t.browser=z,t.cacheEntryPossiblyAdded=function(t){++ft>ut&&(t.getActor().send("enforceCacheSizeLimit",st),ft=0)},t.clamp=c,t.clearTileCache=function(t){var e=a.caches.delete("mapbox-tiles");t&&e.catch(t).then((function(){return t()}))},t.clipLine=Hu,t.clone=function(t){var e=new aa(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=x,t.clone$2=function(t){var e=new aa(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.collisionCircleLayout=Ws,t.config=F,t.create=function(){var t=new aa(16);return aa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new aa(9);return aa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new aa(4);return aa!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=Xn,t.createLayout=Ai,t.createStyleLayer=function(t){return"custom"===t.type?new Al(t):new Tl[t.type](t)},t.cross=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t},t.deepEqual=function t(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(!t(e[r],n[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(e).length!==Object.keys(n).length)return!1;for(var i in e)if(!t(e[i],n[i]))return!1;return!0}return e===n},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=l,t.emitValidationErrors=Or,t.endsWith=y,t.enforceCacheSizeLimit=function(t){lt(),tt&&tt.then((function(e){e.keys().then((function(n){for(var r=0;r<n.length-t;r++)e.delete(n[r])}))}))},t.evaluateSizeForFeature=Bu,t.evaluateSizeForZoom=zu,t.evaluateVariableOffset=ol,t.evented=ri,t.extend=f,t.featureFilter=ar,t.filterObject=b,t.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=Ou,t.getAnchorJustification=al,t.getArrayBuffer=bt,t.getImage=Et,t.getJSON=function(t,e){return _t(f(t,{type:"json"}),e)},t.getRTLTextPluginStatus=ii,t.getReferrer=yt,t.getVideo=function(t,e){var n,r,i=a.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(var o=0;o<t.length;o++){var s=a.document.createElement("source");n=t[o],r=void 0,(r=a.document.createElement("a")).href=n,(r.protocol!==a.document.location.protocol||r.host!==a.document.location.host)&&(i.crossOrigin="Anonymous"),s.src=t[o],i.appendChild(s)}return{cancel:function(){}}},t.identity=sa,t.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],p=e[11],d=e[12],g=e[13],v=e[14],m=e[15],y=n*s-r*a,_=n*u-i*a,b=n*l-o*a,x=r*u-i*s,w=r*l-o*s,E=i*l-o*u,S=c*g-h*d,C=c*v-f*d,A=c*m-p*d,T=h*v-f*g,k=h*m-p*g,M=f*m-p*v,P=y*M-_*k+b*T+x*A-w*C+E*S;return P?(t[0]=(s*M-u*k+l*T)*(P=1/P),t[1]=(i*k-r*M-o*T)*P,t[2]=(g*E-v*w+m*x)*P,t[3]=(f*w-h*E-p*x)*P,t[4]=(u*A-a*M-l*C)*P,t[5]=(n*M-i*A+o*C)*P,t[6]=(v*b-d*E-m*_)*P,t[7]=(c*E-f*b+p*_)*P,t[8]=(a*k-s*A+l*S)*P,t[9]=(r*A-n*k-o*S)*P,t[10]=(d*w-g*b+m*y)*P,t[11]=(h*b-c*w-p*y)*P,t[12]=(s*C-a*T-u*S)*P,t[13]=(n*T-r*C+i*S)*P,t[14]=(g*_-d*x-v*y)*P,t[15]=(c*x-h*_+f*y)*P,t):null},t.isChar=Wr,t.isMapboxURL=H,t.keysDifference=function(t,e){var n=[];for(var r in t)r in e||n.push(r);return n},t.makeRequest=_t,t.mapObject=_,t.mercatorXfromLng=jl,t.mercatorYfromLat=Ul,t.mercatorZfromAltitude=Gl,t.mul=ca,t.multiply=ua,t.mvt=bs,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},t.number=Ve,t.offscreenCanvasSupported=pt,t.ortho=function(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*l,t[15]=1,t},t.parseGlyphPBF=function(t){return new Ks(t).readFields(du,[])},t.pbf=Ks,t.performSymbolLayout=function(t,e,n,r,i,o,a){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,u=t.layers[0]._unevaluatedLayout._values,l={};if("composite"===t.textSizeData.kind){var c=t.textSizeData,h=c.maxZoom;l.compositeTextSizes=[u["text-size"].possiblyEvaluate(new si(c.minZoom),a),u["text-size"].possiblyEvaluate(new si(h),a)]}if("composite"===t.iconSizeData.kind){var f=t.iconSizeData,p=f.maxZoom;l.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new si(f.minZoom),a),u["icon-size"].possiblyEvaluate(new si(p),a)]}l.layoutTextSize=u["text-size"].possiblyEvaluate(new si(t.zoom+1),a),l.layoutIconSize=u["icon-size"].possiblyEvaluate(new si(t.zoom+1),a),l.textMaxSize=u["text-size"].possiblyEvaluate(new si(18));for(var d=24*s.get("text-line-height"),g="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),v=s.get("text-keep-upright"),m=s.get("text-size"),y=function(){var o=b[_],u=s.get("text-font").evaluate(o,{},a).join(","),c=m.evaluate(o,{},a),h=l.layoutTextSize.evaluate(o,{},a),f=l.layoutIconSize.evaluate(o,{},a),p={horizontal:{},vertical:void 0},y=o.text,x=[0,0];if(y){var w=y.toString(),S=24*s.get("text-letter-spacing").evaluate(o,{},a),C=function(t){for(var e=0,n=t;e<n.length;e+=1)if(r=n[e].charCodeAt(0),Wr.Arabic(r)||Wr["Arabic Supplement"](r)||Wr["Arabic Extended-A"](r)||Wr["Arabic Presentation Forms-A"](r)||Wr["Arabic Presentation Forms-B"](r))return!1;var r;return!0}(w)?S:0,A=s.get("text-anchor").evaluate(o,{},a),T=s.get("text-variable-anchor");if(!T){var k=s.get("text-radial-offset").evaluate(o,{},a);x=k?ol(A,[24*k,il]):s.get("text-offset").evaluate(o,{},a).map((function(t){return 24*t}))}var M=g?"center":s.get("text-justify").evaluate(o,{},a),P=s.get("symbol-placement"),I="point"===P?24*s.get("text-max-width").evaluate(o,{},a):0,O=function(){t.allowVerticalPlacement&&Hr(w)&&(p.vertical=Su(y,e,n,i,u,I,d,A,"left",C,x,xu.vertical,!0,P,h,c))};if(!g&&T){for(var R="auto"===M?T.map((function(t){return al(t)})):[M],L=!1,D=0;D<R.length;D++){var N=R[D];if(!p.horizontal[N])if(L)p.horizontal[N]=p.horizontal[0];else{var B=Su(y,e,n,i,u,I,d,"center",N,C,x,xu.horizontal,!1,P,h,c);B&&(p.horizontal[N]=B,L=1===B.positionedLines.length)}}O()}else{"auto"===M&&(M=al(A));var z=Su(y,e,n,i,u,I,d,A,M,C,x,xu.horizontal,!1,P,h,c);z&&(p.horizontal[M]=z),O(),Hr(w)&&g&&v&&(p.vertical=Su(y,e,n,i,u,I,d,A,M,C,x,xu.vertical,!1,P,h,c))}}var F=void 0,Z=!1;if(o.icon&&o.icon.name){var j=r[o.icon.name];j&&(F=function(t,e,n){var r=Ou(n),i=e[0]-t.displaySize[0]*r.horizontalAlign,o=e[1]-t.displaySize[1]*r.verticalAlign;return{image:t,top:o,bottom:o+t.displaySize[1],left:i,right:i+t.displaySize[0]}}(i[o.icon.name],s.get("icon-offset").evaluate(o,{},a),s.get("icon-anchor").evaluate(o,{},a)),Z=j.sdf,void 0===t.sdfIcons?t.sdfIcons=j.sdf:t.sdfIcons!==j.sdf&&E("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(j.pixelRatio!==t.pixelRatio||0!==s.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}var U=ul(p.horizontal)||p.vertical;t.iconsInText=!!U&&U.iconsInText,(U||F)&&function(t,e,n,r,i,o,a,s,u,l,c){var h=o.textMaxSize.evaluate(e,{});void 0===h&&(h=a);var f,p=t.layers[0].layout,d=p.get("icon-offset").evaluate(e,{},c),g=ul(n.horizontal),v=a/24,m=t.tilePixelRatio*v,y=t.tilePixelRatio*h/24,_=t.tilePixelRatio*s,b=t.tilePixelRatio*p.get("symbol-spacing"),x=p.get("text-padding")*t.tilePixelRatio,w=p.get("icon-padding")*t.tilePixelRatio,S=p.get("text-max-angle")/180*Math.PI,C="map"===p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),A="map"===p.get("icon-rotation-alignment")&&"point"!==p.get("symbol-placement"),T=p.get("symbol-placement"),k=b/2,M=p.get("icon-text-fit");r&&"none"!==M&&(t.allowVerticalPlacement&&n.vertical&&(f=Lu(r,n.vertical,M,p.get("icon-text-fit-padding"),d,v)),g&&(r=Lu(r,g,M,p.get("icon-text-fit-padding"),d,v)));var P=function(s,h){h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(t,e,n,r,i,o,a,s,u,l,c,h,f,p,d,g,v,m,y,_,b,x,w,S,C){var A,T,k,M,P,I=t.addToLineVertexArray(e,n),O=0,R=0,L=0,D=0,N=-1,B=-1,z={},F=fo(""),Z=0,j=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(Z=(A=s.layout.get("text-offset").evaluate(b,{},S).map((function(t){return 24*t})))[0],j=A[1]):(Z=24*s.layout.get("text-radial-offset").evaluate(b,{},S),j=il),t.allowVerticalPlacement&&r.vertical){var U=s.layout.get("text-rotate").evaluate(b,{},S)+90;M=new Ju(u,e,l,c,h,r.vertical,f,p,d,U),a&&(P=new Ju(u,e,l,c,h,a,v,m,d,U))}if(i){var G=s.layout.get("icon-rotate").evaluate(b,{}),V="none"!==s.layout.get("icon-text-fit"),W=Xu(i,G,w,V),H=a?Xu(a,G,w,V):void 0;k=new Ju(u,e,l,c,h,i,v,m,!1,G),O=4*W.length;var X=t.iconSizeData,Y=null;"source"===X.kind?(Y=[128*s.layout.get("icon-size").evaluate(b,{})])[0]>32640&&E(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===X.kind&&((Y=[128*x.compositeIconSizes[0].evaluate(b,{},S),128*x.compositeIconSizes[1].evaluate(b,{},S)])[0]>32640||Y[1]>32640)&&E(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),t.addSymbols(t.icon,W,Y,_,y,b,!1,e,I.lineStartIndex,I.lineLength,-1,S),N=t.icon.placedSymbolArray.length-1,H&&(R=4*H.length,t.addSymbols(t.icon,H,Y,_,y,b,xu.vertical,e,I.lineStartIndex,I.lineLength,-1,S),B=t.icon.placedSymbolArray.length-1)}for(var q in r.horizontal){var K=r.horizontal[q];if(!T){F=fo(K.text);var Q=s.layout.get("text-rotate").evaluate(b,{},S);T=new Ju(u,e,l,c,h,K,f,p,d,Q)}var J=1===K.positionedLines.length;if(L+=sl(t,e,K,o,s,d,b,g,I,r.vertical?xu.horizontal:xu.horizontalOnly,J?Object.keys(r.horizontal):[q],z,N,x,S),J)break}r.vertical&&(D+=sl(t,e,r.vertical,o,s,d,b,g,I,xu.vertical,["vertical"],z,B,x,S));var $=T?T.boxStartIndex:t.collisionBoxArray.length,tt=T?T.boxEndIndex:t.collisionBoxArray.length,et=M?M.boxStartIndex:t.collisionBoxArray.length,nt=M?M.boxEndIndex:t.collisionBoxArray.length,rt=k?k.boxStartIndex:t.collisionBoxArray.length,it=k?k.boxEndIndex:t.collisionBoxArray.length,ot=P?P.boxStartIndex:t.collisionBoxArray.length,at=P?P.boxEndIndex:t.collisionBoxArray.length,st=-1,ut=function(t,e){return t&&t.circleDiameter?Math.max(t.circleDiameter,e):e};st=ut(T,st),st=ut(M,st),st=ut(k,st);var lt=(st=ut(P,st))>-1?1:0;lt&&(st*=C/24),t.glyphOffsetArray.length>=ml.MAX_GLYPHS&&E("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,b.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,z.right>=0?z.right:-1,z.center>=0?z.center:-1,z.left>=0?z.left:-1,z.vertical||-1,N,B,F,$,tt,et,nt,rt,it,ot,at,l,L,D,O,R,lt,0,f,Z,j,st)}(t,h,s,n,r,i,f,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,m,x,C,u,_,w,A,d,e,o,l,c,a)};if("line"===T)for(var I=0,O=Hu(e.geometry,0,0,8192,8192);I<O.length;I+=1)for(var R=O[I],L=0,D=Wu(R,b,S,n.vertical||g,r,24,y,t.overscaling,8192);L<D.length;L+=1){var N=D[L];g&&ll(t,g.text,k,N)||P(R,N)}else if("line-center"===T)for(var B=0,z=e.geometry;B<z.length;B+=1){var F=z[B];if(F.length>1){var Z=Vu(F,S,n.vertical||g,r,24,y);Z&&P(F,Z)}}else if("Polygon"===e.type)for(var j=0,U=rs(e.geometry,0);j<U.length;j+=1){var G=U[j],V=el(G,16);P(G[0],new Du(V.x,V.y,0))}else if("LineString"===e.type)for(var W=0,H=e.geometry;W<H.length;W+=1){var X=H[W];P(X,new Du(X[0].x,X[0].y,0))}else if("Point"===e.type)for(var Y=0,q=e.geometry;Y<q.length;Y+=1)for(var K=0,Q=q[Y];K<Q.length;K+=1){var J=Q[K];P([J],new Du(J.x,J.y,0))}}(t,o,p,F,r,l,h,f,x,Z,a)},_=0,b=t.features;_<b.length;_+=1)y();o&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+r)*(o=1/(r-i)),t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t},t.pick=function(t,e){for(var n={},r=0;r<e.length;r++){var i=e[r];i in t&&(n[i]=t[i])}return n},t.plugin=ai,t.polygonIntersectsPolygon=Vo,t.postMapLoadEvent=at,t.postTurnstileEvent=it,t.potpack=mu,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=zr,t.registerForPluginStateChange=function(t){return t({pluginStatus:$r,pluginURL:ti}),ri.on("pluginStateChange",t),t},t.renderColorRamp=xa,t.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u,t},t.rotateX=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=a*i+c*r,t[6]=s*i+h*r,t[7]=u*i+f*r,t[8]=l*i-o*r,t[9]=c*i-a*r,t[10]=h*i-s*r,t[11]=f*i-u*r,t},t.rotateZ=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=a*i+c*r,t[2]=s*i+h*r,t[3]=u*i+f*r,t[4]=l*i-o*r,t[5]=c*i-a*r,t[6]=h*i-s*r,t[7]=f*i-u*r,t},t.scale=function(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},t.scale$2=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},t.setCacheLimits=function(t,e){st=t,ut=e},t.setRTLTextPlugin=function(t,e,n){if(void 0===n&&(n=!1),"deferred"===$r||"loading"===$r||"loaded"===$r)throw new Error("setRTLTextPlugin cannot be called multiple times.");ti=z.resolveURL(t),$r="deferred",Jr=e,ni(),n||oi()},t.sphericalToCartesian=function(t){var e=t[0],n=t[1],r=t[2];return n+=90,n*=Math.PI/180,r*=Math.PI/180,{x:e*Math.cos(n)*Math.sin(r),y:e*Math.sin(n)*Math.sin(r),z:e*Math.cos(r)}},t.sqrLen=function(t){var e=t[0],n=t[1];return e*e+n*n},t.styleSpec=Mt,t.sub=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},t.symbolSize=Fu,t.transformMat3=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},t.transformMat4=ha,t.translate=function(t,e,n){var r,i,o,a,s,u,l,c,h,f,p,d,g=n[0],v=n[1],m=n[2];return e===t?(t[12]=e[0]*g+e[4]*v+e[8]*m+e[12],t[13]=e[1]*g+e[5]*v+e[9]*m+e[13],t[14]=e[2]*g+e[6]*v+e[10]*m+e[14],t[15]=e[3]*g+e[7]*v+e[11]*m+e[15]):(i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],p=e[10],d=e[11],t[0]=r=e[0],t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=f,t[10]=p,t[11]=d,t[12]=r*g+s*v+h*m+e[12],t[13]=i*g+u*v+f*m+e[13],t[14]=o*g+l*v+p*m+e[14],t[15]=a*g+c*v+d*m+e[15]),t},t.triggerPluginCompletionEvent=ei,t.uniqueId=d,t.validateCustomStyleLayer=function(t){var e=[],n=t.id;return void 0===n&&e.push({message:"layers."+n+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+n+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+n+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=Mr,t.validateStyle=kr,t.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},t.vectorTile=bs,t.version="1.13.2",t.warnOnce=E,t.webpSupported=Z,t.window=a,t.wrap=h})),r(0,(function(t){function e(t){var n=typeof t;if("number"===n||"boolean"===n||"string"===n||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var r="[",i=0,o=t;i<o.length;i+=1)r+=e(o[i])+",";return r+"]"}for(var a=Object.keys(t).sort(),s="{",u=0;u<a.length;u++)s+=JSON.stringify(a[u])+":"+e(t[a[u]])+",";return s+"}"}function n(n){for(var r="",i=0,o=t.refProperties;i<o.length;i+=1)r+="/"+e(n[o[i]]);return r}var r=function(t){this.keyCache={},t&&this.replace(t)};r.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},r.prototype.update=function(e,r){for(var i=this,o=0,a=e;o<a.length;o+=1){var s=a[o];this._layerConfigs[s.id]=s;var u=this._layers[s.id]=t.createStyleLayer(s);u._featureFilter=t.featureFilter(u.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var l=0,c=r;l<c.length;l+=1){var h=c[l];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var f=0,p=function(t,e){for(var r={},i=0;i<t.length;i++){var o=e&&e[t[i].id]||n(t[i]);e&&(e[t[i].id]=o);var a=r[o];a||(a=r[o]=[]),a.push(t[i])}var s=[];for(var u in r)s.push(r[u]);return s}(t.values(this._layerConfigs),this.keyCache);f<p.length;f+=1){var d=p[f].map((function(t){return i._layers[t.id]})),g=d[0];if("none"!==g.visibility){var v=g.source||"",m=this.familiesBySource[v];m||(m=this.familiesBySource[v]={});var y=g.sourceLayer||"_geojsonTileLayer",_=m[y];_||(_=m[y]=[]),_.push(d)}}};var i=function(e){var n={},r=[];for(var i in e){var o=e[i],a=n[i]={};for(var s in o){var u=o[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var l={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};r.push(l),a[s]={rect:l,metrics:u.metrics}}}}var c=t.potpack(r),h=new t.AlphaImage({width:c.w||1,height:c.h||1});for(var f in e){var p=e[f];for(var d in p){var g=p[+d];if(g&&0!==g.bitmap.width&&0!==g.bitmap.height){var v=n[f][d].rect;t.AlphaImage.copy(g.bitmap,h,{x:0,y:0},{x:v.x+1,y:v.y+1},g.bitmap)}}}this.image=h,this.positions=n};t.register("GlyphAtlas",i);var o=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId};function a(e,n,r){for(var i=new t.EvaluationParameters(n),o=0,a=e;o<a.length;o+=1)a[o].recalculate(i,r)}function s(e,n){var r=t.getArrayBuffer(e.request,(function(e,r,i,o){e?n(e):r&&n(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(r)),rawData:r,cacheControl:i,expires:o})}));return function(){r.cancel(),n()}}o.prototype.parse=function(e,n,r,o,s){var u=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var l=new t.DictionaryCoder(Object.keys(e.layers).sort()),c=new t.FeatureIndex(this.tileID,this.promoteId);c.bucketLayerIDs=[];var h,f,p,d,g={},v={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:r},m=n.familiesBySource[this.source];for(var y in m){var _=e.layers[y];if(_){1===_.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+y+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var b=l.encode(y),x=[],w=0;w<_.length;w++){var E=_.feature(w),S=c.getId(E,y);x.push({feature:E,id:S,index:w,sourceLayerIndex:b})}for(var C=0,A=m[y];C<A.length;C+=1){var T=A[C],k=T[0];k.minzoom&&this.zoom<Math.floor(k.minzoom)||k.maxzoom&&this.zoom>=k.maxzoom||"none"!==k.visibility&&(a(T,this.zoom,r),(g[k.id]=k.createBucket({index:c.bucketLayerIDs.length,layers:T,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:b,sourceID:this.source})).populate(x,v,this.tileID.canonical),c.bucketLayerIDs.push(T.map((function(t){return t.id}))))}}}var M=t.mapObject(v.glyphDependencies,(function(t){return Object.keys(t).map(Number)}));Object.keys(M).length?o.send("getGlyphs",{uid:this.uid,stacks:M},(function(t,e){h||(h=t,f=e,O.call(u))})):f={};var P=Object.keys(v.iconDependencies);P.length?o.send("getImages",{icons:P,source:this.source,tileID:this.tileID,type:"icons"},(function(t,e){h||(h=t,p=e,O.call(u))})):p={};var I=Object.keys(v.patternDependencies);function O(){if(h)return s(h);if(f&&p&&d){var e=new i(f),n=new t.ImageAtlas(p,d);for(var o in g){var u=g[o];u instanceof t.SymbolBucket?(a(u.layers,this.zoom,r),t.performSymbolLayout(u,f,e.positions,p,n.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):u.hasPattern&&(u instanceof t.LineBucket||u instanceof t.FillBucket||u instanceof t.FillExtrusionBucket)&&(a(u.layers,this.zoom,r),u.addFeatures(v,this.tileID.canonical,n.patternPositions))}this.status="done",s(null,{buckets:t.values(g).filter((function(t){return!t.isEmpty()})),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:n,glyphMap:this.returnDependencies?f:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?e.positions:null})}}I.length?o.send("getImages",{icons:I,source:this.source,tileID:this.tileID,type:"patterns"},(function(t,e){h||(h=t,d=e,O.call(u))})):d={},O.call(this)};var u=function(t,e,n,r){this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=r||s,this.loading={},this.loaded={}};u.prototype.loadTile=function(e,n){var r=this,i=e.uid;this.loading||(this.loading={});var a=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.RequestPerformance(e.request),s=this.loading[i]=new o(e);s.abort=this.loadVectorData(e,(function(e,o){if(delete r.loading[i],e||!o)return s.status="done",r.loaded[i]=s,n(e);var u=o.rawData,l={};o.expires&&(l.expires=o.expires),o.cacheControl&&(l.cacheControl=o.cacheControl);var c={};if(a){var h=a.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=o.vectorTile,s.parse(o.vectorTile,r.layerIndex,r.availableImages,r.actor,(function(e,r){if(e||!r)return n(e);n(null,t.extend({rawTileData:u.slice(0)},r,l,c))})),r.loaded=r.loaded||{},r.loaded[i]=s}))},u.prototype.reloadTile=function(t,e){var n=this,r=this.loaded,i=t.uid,o=this;if(r&&r[i]){var a=r[i];a.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,r){var i=a.reloadCallback;i&&(delete a.reloadCallback,a.parse(a.vectorTile,o.layerIndex,n.availableImages,o.actor,i)),e(t,r)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},u.prototype.abortTile=function(t,e){var n=this.loading,r=t.uid;n&&n[r]&&n[r].abort&&(n[r].abort(),delete n[r]),e()},u.prototype.removeTile=function(t,e){var n=this.loaded,r=t.uid;n&&n[r]&&delete n[r],e()};var l=t.window.ImageBitmap,c=function(){this.loaded={}};function h(t,e){if(0!==t.length){f(t[0],e);for(var n=1;n<t.length;n++)f(t[n],!e)}}function f(t,e){for(var n=0,r=0,i=t.length,o=i-1;r<i;o=r++)n+=(t[r][0]-t[o][0])*(t[o][1]+t[r][1]);n>=0!=!!e&&t.reverse()}c.prototype.loadTile=function(e,n){var r=e.uid,i=e.encoding,o=e.rawImageData,a=l&&o instanceof l?this.getImageData(o):o,s=new t.DEMData(r,a,i);this.loaded=this.loaded||{},this.loaded[r]=s,n(null,s)},c.prototype.getImageData=function(e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);var n=this.offscreenCanvasContext.getImageData(-1,-1,e.width+2,e.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:n.width,height:n.height},n.data)},c.prototype.removeTile=function(t){var e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]};var p=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,d=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};d.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],n=0,r=this._feature.geometry;n<r.length;n+=1){var i=r[n];e.push([new t.Point$1(i[0],i[1])])}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var u=[],l=0,c=s[a];l<c.length;l+=1){var h=c[l];u.push(new t.Point$1(h[0],h[1]))}o.push(u)}return o},d.prototype.toGeoJSON=function(t,e,n){return p.call(this,t,e,n)};var g=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};g.prototype.feature=function(t){return new d(this._features[t])};var v=t.vectorTile.VectorTileFeature,m=y;function y(t,e){this.options=e||{},this.features=t,this.length=t.length}function _(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}y.prototype.feature=function(t){return new _(this.features[t],this.options.extent)},_.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var n=0;n<e.length;n++){for(var r=e[n],i=[],o=0;o<r.length;o++)i.push(new t.Point$1(r[o][0],r[o][1]));this.geometry.push(i)}return this.geometry},_.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,r=1/0,i=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var u=a[s];e=Math.min(e,u.x),n=Math.max(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.y)}return[e,r,n,i]},_.prototype.toGeoJSON=v.prototype.toGeoJSON;var b=w,x=m;function w(e){var n=new t.pbf;return function(t,e){for(var n in t.layers)e.writeMessage(3,E,t.layers[n])}(e,n),n.finish()}function E(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)r.feature=t.feature(n),e.writeMessage(2,S,r);var i=r.keys;for(n=0;n<i.length;n++)e.writeStringField(3,i[n]);var o=r.values;for(n=0;n<o.length;n++)e.writeMessage(4,M,o[n])}function S(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,C,t),e.writeVarintField(3,n.type),e.writeMessage(4,k,n)}function C(t,e){var n=t.feature,r=t.keys,i=t.values,o=t.keycache,a=t.valuecache;for(var s in n.properties){var u=o[s];void 0===u&&(r.push(s),o[s]=u=r.length-1),e.writeVarint(u);var l=n.properties[s],c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var h=c+":"+l,f=a[h];void 0===f&&(i.push(l),a[h]=f=i.length-1),e.writeVarint(f)}}function A(t,e){return(e<<3)+(7&t)}function T(t){return t<<1^t>>31}function k(t,e){for(var n=t.loadGeometry(),r=t.type,i=0,o=0,a=n.length,s=0;s<a;s++){var u=n[s],l=1;1===r&&(l=u.length),e.writeVarint(A(1,l));for(var c=3===r?u.length-1:u.length,h=0;h<c;h++){1===h&&1!==r&&e.writeVarint(A(2,c-1));var f=u[h].x-i,p=u[h].y-o;e.writeVarint(T(f)),e.writeVarint(T(p)),i+=f,o+=p}3===r&&e.writeVarint(A(7,1))}}function M(t,e){var n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function P(t,e,n,r){I(t,n,r),I(e,2*n,2*r),I(e,2*n+1,2*r+1)}function I(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function O(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}b.fromVectorTileJs=w,b.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var r in t)n[r]=new m(t[r].features,e),n[r].name=r,n[r].version=e.version,n[r].extent=e.extent;return w({layers:n})},b.GeoJSONWrapper=x;var R=function(t){return t[0]},L=function(t){return t[1]},D=function(t,e,n,r,i){void 0===e&&(e=R),void 0===n&&(n=L),void 0===r&&(r=64),void 0===i&&(i=Float64Array),this.nodeSize=r,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length),u=0;u<t.length;u++)a[u]=u,s[2*u]=e(t[u]),s[2*u+1]=n(t[u]);!function t(e,n,r,i,o,a){if(!(o-i<=r)){var s=i+o>>1;!function t(e,n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(e,n,r,Math.max(i,Math.floor(r-u*c/s+h)),Math.min(o,Math.floor(r+(s-u)*c/s+h)),a)}var f=n[2*r+a],p=i,d=o;for(P(e,n,i,r),n[2*o+a]>f&&P(e,n,i,o);p<d;){for(P(e,n,p,d),p++,d--;n[2*p+a]<f;)p++;for(;n[2*d+a]>f;)d--}n[2*i+a]===f?P(e,n,i,d):P(e,n,++d,o),d<=r&&(i=d+1),r<=d&&(o=d-1)}}(e,n,s,i,o,a%2),t(e,n,r,i,s-1,a+1),t(e,n,r,s+1,o,a+1)}}(a,s,r,0,a.length-1,0)};D.prototype.range=function(t,e,n,r){return function(t,e,n,r,i,o,a){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var h=l.pop(),f=l.pop(),p=l.pop();if(f-p<=a)for(var d=p;d<=f;d++)u=e[2*d+1],(s=e[2*d])>=n&&s<=i&&u>=r&&u<=o&&c.push(t[d]);else{var g=Math.floor((p+f)/2);u=e[2*g+1],(s=e[2*g])>=n&&s<=i&&u>=r&&u<=o&&c.push(t[g]);var v=(h+1)%2;(0===h?n<=s:r<=u)&&(l.push(p),l.push(g-1),l.push(v)),(0===h?i>=s:o>=u)&&(l.push(g+1),l.push(f),l.push(v))}}return c}(this.ids,this.coords,t,e,n,r,this.nodeSize)},D.prototype.within=function(t,e,n){return function(t,e,n,r,i,o){for(var a=[0,t.length-1,0],s=[],u=i*i;a.length;){var l=a.pop(),c=a.pop(),h=a.pop();if(c-h<=o)for(var f=h;f<=c;f++)O(e[2*f],e[2*f+1],n,r)<=u&&s.push(t[f]);else{var p=Math.floor((h+c)/2),d=e[2*p],g=e[2*p+1];O(d,g,n,r)<=u&&s.push(t[p]);var v=(l+1)%2;(0===l?n-i<=d:r-i<=g)&&(a.push(h),a.push(p-1),a.push(v)),(0===l?n+i>=d:r+i>=g)&&(a.push(p+1),a.push(c),a.push(v))}}return s}(this.ids,this.coords,t,e,n,this.nodeSize)};var N={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},B=function(t){this.options=V(Object.create(N),t),this.trees=new Array(this.options.maxZoom+1)};function z(t,e,n,r,i){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function F(t,e){var n=t.geometry.coordinates,r=n[1];return{x:U(n[0]),y:G(r),zoom:1/0,index:e,parentId:-1}}function Z(t){return{type:"Feature",id:t.id,properties:j(t),geometry:{type:"Point",coordinates:[(r=t.x,360*(r-.5)),(e=t.y,n=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var e,n,r}function j(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return V(V({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function U(t){return t/360+.5}function G(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function V(t,e){for(var n in e)t[n]=e[n];return t}function W(t){return t.x}function H(t){return t.y}function X(t,e,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((t-n)*a+(e-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=t-n)*a+(s=e-r)*s}function Y(t,e,n,r){var i={id:void 0===t?null:t,type:e,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)q(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<e.length;r++)q(t,e[r]);else if("MultiPolygon"===n)for(r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)q(t,e[r][i])}(i),i}function q(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function K(t,e,n,r){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)Q(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)Q(i[l],s);else if("LineString"===o)J(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)J(i[l],s=[],a,!1),t.push(Y(u,"LineString",s,e.properties));return}$(i,s,a,!1)}else if("Polygon"===o)$(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<e.geometry.geometries.length;l++)K(t,{id:u,geometry:e.geometry.geometries[l],properties:e.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];$(i[l],c,a,!0),s.push(c)}}t.push(Y(u,o,s,e.properties))}}function Q(t,e){e.push(tt(t[0])),e.push(et(t[1])),e.push(0)}function J(t,e,n,r){for(var i,o,a=0,s=0;s<t.length;s++){var u=tt(t[s][0]),l=et(t[s][1]);e.push(u),e.push(l),e.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=e.length-3;e[2]=1,function t(e,n,r,i){for(var o,a=i,s=r-n>>1,u=r-n,l=e[n],c=e[n+1],h=e[r],f=e[r+1],p=n+3;p<r;p+=3){var d=X(e[p],e[p+1],l,c,h,f);if(d>a)o=p,a=d;else if(d===a){var g=Math.abs(p-s);g<u&&(o=p,u=g)}}a>i&&(o-n>3&&t(e,n,o,i),e[o+2]=a,r-o>3&&t(e,o,r,i))}(e,0,c,n),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function $(t,e,n,r){for(var i=0;i<t.length;i++){var o=[];J(t[i],o,n,r),e.push(o)}}function tt(t){return t/360+.5}function et(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function nt(t,e,n,r,i,o,a,s){if(r/=e,o>=(n/=e)&&a<r)return t;if(a<n||o>=r)return null;for(var u=[],l=0;l<t.length;l++){var c=t[l],h=c.geometry,f=c.type,p=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(p>=n&&d<r)u.push(c);else if(!(d<n||p>=r)){var g=[];if("Point"===f||"MultiPoint"===f)rt(h,g,n,r,i);else if("LineString"===f)it(h,g,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===f)at(h,g,n,r,i,!1);else if("Polygon"===f)at(h,g,n,r,i,!0);else if("MultiPolygon"===f)for(var v=0;v<h.length;v++){var m=[];at(h[v],m,n,r,i,!0),m.length&&g.push(m)}if(g.length){if(s.lineMetrics&&"LineString"===f){for(v=0;v<g.length;v++)u.push(Y(c.id,f,g[v],c.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===g.length?(f="LineString",g=g[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===g.length?"Point":"MultiPoint"),u.push(Y(c.id,f,g,c.tags))}}}return u.length?u:null}function rt(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=n&&a<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function it(t,e,n,r,i,o,a){for(var s,u,l=ot(t),c=0===i?ut:lt,h=t.start,f=0;f<t.length-3;f+=3){var p=t[f],d=t[f+1],g=t[f+2],v=t[f+3],m=t[f+4],y=0===i?p:d,_=0===i?v:m,b=!1;a&&(s=Math.sqrt(Math.pow(p-v,2)+Math.pow(d-m,2))),y<n?_>n&&(u=c(l,p,d,v,m,n),a&&(l.start=h+s*u)):y>r?_<r&&(u=c(l,p,d,v,m,r),a&&(l.start=h+s*u)):st(l,p,d,g),_<n&&y>=n&&(u=c(l,p,d,v,m,n),b=!0),_>r&&y<=r&&(u=c(l,p,d,v,m,r),b=!0),!o&&b&&(a&&(l.end=h+s*u),e.push(l),l=ot(t)),a&&(h+=s)}var x=t.length-3;p=t[x],d=t[x+1],g=t[x+2],(y=0===i?p:d)>=n&&y<=r&&st(l,p,d,g),x=l.length-3,o&&x>=3&&(l[x]!==l[0]||l[x+1]!==l[1])&&st(l,l[0],l[1],l[2]),l.length&&e.push(l)}function ot(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function at(t,e,n,r,i,o){for(var a=0;a<t.length;a++)it(t[a],e,n,r,i,o,!1)}function st(t,e,n,r){t.push(e),t.push(n),t.push(r)}function ut(t,e,n,r,i,o){var a=(o-e)/(r-e);return t.push(o),t.push(n+(i-n)*a),t.push(1),a}function lt(t,e,n,r,i,o){var a=(o-n)/(i-n);return t.push(e+(r-e)*a),t.push(o),t.push(1),a}function ct(t,e){for(var n=[],r=0;r<t.length;r++){var i,o=t[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=ht(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(ht(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(ht(o.geometry[s][l],e));i.push(u)}n.push(Y(o.id,a,i,o.tags))}return n}function ht(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function ft(t,e){if(t.transformed)return t;var n,r,i,o=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(pt(l[r],l[r+1],e,o,a,s));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push(pt(l[r][i],l[r][i+1],e,o,a,s));u.geometry.push(h)}}return t.transformed=!0,t}function pt(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function dt(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,gt(a,t[s],o,i);var u=t[s].minX,l=t[s].minY,c=t[s].maxX,h=t[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function gt(t,e,n,r){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)vt(a,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)vt(a,i[s],t,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)vt(a,l[s],t,n,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var f={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(f.id=e.id),t.features.push(f)}}function vt(t,e,n,r,i,o){var a=r*r;if(r>0&&e.size<(i?a:r))n.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===r||e[u+2]>a)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;i&&function(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(r=0,i=t.length;r<i/2;r+=2){var a=t[r],s=t[r+1];t[r]=t[i-2-r],t[r+1]=t[i-1-r],t[i-2-r]=a,t[i-1-r]=s}}(s,o),t.push(s)}}function mt(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)K(n,t.features[r],e,r);else K(n,"Feature"===t.type?t:{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(t,e){var n=e.buffer/e.extent,r=t,i=nt(t,1,-1-n,n,0,-1,2,e),o=nt(t,1,1-n,2+n,0,-1,2,e);return(i||o)&&(r=nt(t,1,-n,1+n,0,-1,2,e)||[],i&&(r=ct(i,1).concat(r)),o&&(r=r.concat(ct(o,-1)))),r}(r,e)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function yt(t,e,n){return 32*((1<<t)*n+e)+t}function _t(t,e){var n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var r=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!r)return e(null,null);var i=new g(r.features),o=b(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:i,rawData:o.buffer})}B.prototype.load=function(t){var e=this.options,n=e.log,r=e.minZoom,i=e.maxZoom,o=e.nodeSize;n&&console.time("total time");var a="prepare "+t.length+" points";n&&console.time(a),this.points=t;for(var s=[],u=0;u<t.length;u++)t[u].geometry&&s.push(F(t[u],u));this.trees[i+1]=new D(s,W,H,o,Float32Array),n&&console.timeEnd(a);for(var l=i;l>=r;l--){var c=+Date.now();s=this._cluster(s,l),this.trees[l]=new D(s,W,H,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",l,s.length,+Date.now()-c)}return n&&console.timeEnd("total time"),this},B.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,h=u.range(U(n),G(o),U(i),G(r));c<h.length;c+=1){var f=u.points[h[c]];l.push(f.numPoints?Z(f):this.points[f.index])}return l},B.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[e];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=i.points[l[u]];c.parentId===t&&s.push(c.numPoints?Z(c):this.points[c.index])}if(0===s.length)throw new Error(r);return s},B.prototype.getLeaves=function(t,e,n){var r=[];return this._appendLeaves(r,t,e=e||10,n=n||0,0),r},B.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.radius/o.extent,s=(n-a)/i,u=(n+1+a)/i,l={features:[]};return this._addTileFeatures(r.range((e-a)/i,s,(e+1+a)/i,u),r.points,e,n,i,l),0===e&&this._addTileFeatures(r.range(1-a/i,s,1,u),r.points,i,n,i,l),e===i-1&&this._addTileFeatures(r.range(0,s,a/i,u),r.points,-1,n,i,l),l.features.length?l:null},B.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},B.prototype._appendLeaves=function(t,e,n,r,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,n,r,i):i<r?i++:t.push(s),t.length===n)break}return i},B.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],l=u.numPoints,c={type:1,geometry:[[Math.round(this.options.extent*(u.x*i-n)),Math.round(this.options.extent*(u.y*i-r))]],tags:l?j(u):this.points[u.index].properties},h=void 0;l?h=u.id:this.options.generateId?h=u.index:this.points[u.index].id&&(h=this.points[u.index].id),void 0!==h&&(c.id=h),o.features.push(c)}},B.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},B.prototype._cluster=function(t,e){for(var n=[],r=this.options,i=r.reduce,o=r.minPoints,a=r.radius/(r.extent*Math.pow(2,e)),s=0;s<t.length;s++){var u=t[s];if(!(u.zoom<=e)){u.zoom=e;for(var l=this.trees[e+1],c=l.within(u.x,u.y,a),h=u.numPoints||1,f=h,p=0,d=c;p<d.length;p+=1){var g=l.points[d[p]];g.zoom>e&&(f+=g.numPoints||1)}if(f>=o){for(var v=u.x*h,m=u.y*h,y=i&&h>1?this._map(u,!0):null,_=(s<<5)+(e+1)+this.points.length,b=0,x=c;b<x.length;b+=1){var w=l.points[x[b]];if(!(w.zoom<=e)){w.zoom=e;var E=w.numPoints||1;v+=w.x*E,m+=w.y*E,w.parentId=_,i&&(y||(y=this._map(u,!0)),i(y,this._map(w)))}}u.parentId=_,n.push(z(v/f,m/f,_,f,y))}else if(n.push(u),f>1)for(var S=0,C=c;S<C.length;S+=1){var A=l.points[C[S]];A.zoom<=e||(A.zoom=e,n.push(A))}}}return n},B.prototype._getOriginId=function(t){return t-this.points.length>>5},B.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},B.prototype._map=function(t,e){if(t.numPoints)return e?V({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?V({},r):r},mt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},mt.prototype.splitTile=function(t,e,n,r,i,o,a){for(var s=[t,e,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=yt(e,n,r),f=this.tiles[h];if(!f&&(l>1&&console.time("creation"),f=this.tiles[h]=dt(t,e,n,r,u),this.tileCoords.push({z:e,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=t,i){if(e===u.maxZoom||e===i)continue;var d=1<<i-e;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(e===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue;if(f.source=null,0!==t.length){l>1&&console.time("clipping");var g,v,m,y,_,b,x=.5*u.buffer/u.extent,w=.5-x,E=.5+x,S=1+x;g=v=m=y=null,_=nt(t,c,n-x,n+E,0,f.minX,f.maxX,u),b=nt(t,c,n+w,n+S,0,f.minX,f.maxX,u),t=null,_&&(g=nt(_,c,r-x,r+E,1,f.minY,f.maxY,u),v=nt(_,c,r+w,r+S,1,f.minY,f.maxY,u),_=null),b&&(m=nt(b,c,r-x,r+E,1,f.minY,f.maxY,u),y=nt(b,c,r+w,r+S,1,f.minY,f.maxY,u),b=null),l>1&&console.timeEnd("clipping"),s.push(g||[],e+1,2*n,2*r),s.push(v||[],e+1,2*n,2*r+1),s.push(m||[],e+1,2*n+1,2*r),s.push(y||[],e+1,2*n+1,2*r+1)}}},mt.prototype.getTile=function(t,e,n){var r=this.options,i=r.extent,o=r.debug;if(t<0||t>24)return null;var a=1<<t,s=yt(t,e=(e%a+a)%a,n);if(this.tiles[s])return ft(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var u,l=t,c=e,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[yt(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?ft(this.tiles[s],i):null):null};var bt=function(e){function n(t,n,r,i){e.call(this,t,n,r,_t),i&&(this.loadGeoJSON=i)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},n.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var n=this._pendingCallback,r=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var i=!!(r&&r.request&&r.request.collectResourceTiming)&&new t.RequestPerformance(r.request);this.loadGeoJSON(r,(function(o,a){if(o||!a)return n(o);if("object"!=typeof a)return n(new Error("Input data given to '"+r.source+"' is not a valid GeoJSON object."));!function t(e,n){var r,i=e&&e.type;if("FeatureCollection"===i)for(r=0;r<e.features.length;r++)t(e.features[r],n);else if("GeometryCollection"===i)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],n);else if("Feature"===i)t(e.geometry,n);else if("Polygon"===i)h(e.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<e.coordinates.length;r++)h(e.coordinates[r],n);return e}(a,!0);try{if(r.filter){var s=t.createExpression(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(t){return t.key+": "+t.message})).join(", "));var u=a.features.filter((function(t){return s.value.evaluate({zoom:0},t)}));a={type:"FeatureCollection",features:u}}e._geoJSONIndex=r.cluster?new B(function(e){var n=e.superclusterOptions,r=e.clusterProperties;if(!r||!n)return n;for(var i={},o={},a={accumulated:null,zoom:0},s={properties:null},u=Object.keys(r),l=0,c=u;l<c.length;l+=1){var h=c[l],f=r[h],p=f[0],d=t.createExpression(f[1]),g=t.createExpression("string"==typeof p?[p,["accumulated"],["get",h]]:p);i[h]=d.value,o[h]=g.value}return n.map=function(t){s.properties=t;for(var e={},n=0,r=u;n<r.length;n+=1){var o=r[n];e[o]=i[o].evaluate(a,s)}return e},n.reduce=function(t,e){s.properties=e;for(var n=0,r=u;n<r.length;n+=1){var i=r[n];a.accumulated=t[i],t[i]=o[i].evaluate(a,s)}},n}(r)).load(a.features):function(t,e){return new mt(t,e)}(a,r.geojsonVtOptions)}catch(o){return n(o)}e.loaded={};var l={};if(i){var c=i.finish();c&&(l.resourceTiming={},l.resourceTiming[r.source]=JSON.parse(JSON.stringify(c)))}n(null,l)}))}},n.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},n.prototype.reloadTile=function(t,n){var r=this.loaded;return r&&r[t.uid]?e.prototype.reloadTile.call(this,t,n):this.loadTile(t,n)},n.prototype.loadGeoJSON=function(e,n){if(e.request)t.getJSON(e.request,n);else{if("string"!=typeof e.data)return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return n(null,JSON.parse(e.data))}catch(t){return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},n.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},n.prototype.getClusterExpansionZoom=function(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}},n.prototype.getClusterChildren=function(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}},n.prototype.getClusterLeaves=function(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}},n}(u),xt=function(e){var n=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:u,geojson:bt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(n.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');n.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return xt.prototype.setReferrer=function(t,e){this.referrer=e},xt.prototype.setImages=function(t,e,n){for(var r in this.availableImages[t]=e,this.workerSources[t]){var i=this.workerSources[t][r];for(var o in i)i[o].availableImages=e}n()},xt.prototype.setLayers=function(t,e,n){this.getLayerIndex(t).replace(e),n()},xt.prototype.updateLayers=function(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()},xt.prototype.loadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).loadTile(e,n)},xt.prototype.loadDEMTile=function(t,e,n){this.getDEMWorkerSource(t,e.source).loadTile(e,n)},xt.prototype.reloadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).reloadTile(e,n)},xt.prototype.abortTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)},xt.prototype.removeTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)},xt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},xt.prototype.removeSource=function(t,e,n){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var r=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,n):n()}},xt.prototype.loadWorkerSource=function(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t.toString())}},xt.prototype.syncRTLPluginState=function(e,n,r){try{t.plugin.setState(n);var i=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=i){this.self.importScripts(i);var o=t.plugin.isParsed();r(o?void 0:new Error("RTL Text Plugin failed to import scripts from "+i),o)}}catch(t){r(t.toString())}},xt.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e||(e=[]),e},xt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new r),e},xt.prototype.getWorkerSource=function(t,e,n){var r=this;return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][n]||(this.workerSources[t][e][n]=new this.workerSourceTypes[e]({send:function(e,n,i){r.actor.send(e,n,i,t)}},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][n]},xt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new c),this.demWorkerSources[t][e]},xt.prototype.enforceCacheSizeLimit=function(e,n){t.enforceCacheSizeLimit(n)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new xt(self)),xt})),r(0,(function(t){var e=t.createCommonjsModule((function(t){function e(t){return!n(t)}function n(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(n);try{e=new Worker(r),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(r),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var n=e.getImageData(0,0,1,1);return n&&n.width===t.width}()?(void 0===r[n=t&&t.failIfMajorPerformanceCaveat]&&(r[n]=function(t){var n=function(t){var n=document.createElement("canvas"),r=Object.create(e.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=t,n.probablySupportsContext?n.probablySupportsContext("webgl",r)||n.probablySupportsContext("experimental-webgl",r):n.supportsContext?n.supportsContext("webgl",r)||n.supportsContext("experimental-webgl",r):n.getContext("webgl",r)||n.getContext("experimental-webgl",r)}(t);if(!n)return!1;var r=n.createShader(n.VERTEX_SHADER);return!(!r||n.isContextLost())&&(n.shaderSource(r,"void main() {}"),n.compileShader(r),!0===n.getShaderParameter(r,n.COMPILE_STATUS))}(n)),r[n]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e,window.mapboxgl.notSupportedReason=n);var r={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),n={create:function(e,n,r){var i=t.window.document.createElement(e);return void 0!==n&&(i.className=n),r&&r.appendChild(i),i},createNS:function(e,n){return t.window.document.createElementNS(e,n)}},r=t.window.document&&t.window.document.documentElement.style;function i(t){if(!r)return t[0];for(var e=0;e<t.length;e++)if(t[e]in r)return t[e];return t[0]}var o,a=i(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);n.disableDrag=function(){r&&a&&(o=r[a],r[a]="none")},n.enableDrag=function(){r&&a&&(r[a]=o)};var s=i(["transform","WebkitTransform"]);n.setTransform=function(t,e){t.style[s]=e};var u=!1;try{var l=Object.defineProperty({},"passive",{get:function(){u=!0}});t.window.addEventListener("test",l,l),t.window.removeEventListener("test",l,l)}catch(t){u=!1}n.addEventListener=function(t,e,n,r){void 0===r&&(r={}),t.addEventListener(e,n,"passive"in r&&u?r:r.capture)},n.removeEventListener=function(t,e,n,r){void 0===r&&(r={}),t.removeEventListener(e,n,"passive"in r&&u?r:r.capture)};var c=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",c,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}n.suppressClick=function(){t.window.addEventListener("click",c,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",c,!0)}),0)},n.mousePos=function(e,n){var r=e.getBoundingClientRect();return new t.Point(n.clientX-r.left-e.clientLeft,n.clientY-r.top-e.clientTop)},n.touchPos=function(e,n){for(var r=e.getBoundingClientRect(),i=[],o=0;o<n.length;o++)i.push(new t.Point(n[o].clientX-r.left-e.clientLeft,n[o].clientY-r.top-e.clientTop));return i},n.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},n.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var f=function(e){function n(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.isLoaded=function(){return this.loaded},n.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,n=this.requestors;e<n.length;e+=1){var r=n[e];this._notify(r.ids,r.callback)}this.requestors=[]}},n.prototype.getImage=function(t){return this.images[t]},n.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e)},n.prototype._validate=function(e,n){var r=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchX" value'))),r=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchY" value'))),r=!1),this._validateContent(n.content,n)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "content" value'))),r=!1),r},n.prototype._validateStretch=function(t,e){if(!t)return!0;for(var n=0,r=0,i=t;r<i.length;r+=1){var o=i[r];if(o[0]<n||o[1]<o[0]||e<o[1])return!1;n=o[1]}return!0},n.prototype._validateContent=function(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},n.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},n.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},n.prototype.listImages=function(){return Object.keys(this.images)},n.prototype.getImages=function(t,e){var n=!0;if(!this.isLoaded())for(var r=0,i=t;r<i.length;r+=1)this.images[i[r]]||(n=!1);this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})},n.prototype._notify=function(e,n){for(var r={},i=0,o=e;i<o.length;i+=1){var a=o[i];this.images[a]||this.fire(new t.Event("styleimagemissing",{id:a}));var s=this.images[a];s?r[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+a+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}n(null,r)},n.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},n.prototype.getPattern=function(e){var n=this.patterns[e],r=this.getImage(e);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{var i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},o=new t.ImagePosition(i,r);this.patterns[e]={bin:i,position:o}}return this._updatePatternAtlas(),this.patterns[e].position},n.prototype.bind=function(e){var n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)},n.prototype._updatePatternAtlas=function(){var e=[];for(var n in this.patterns)e.push(this.patterns[n].bin);var r=t.potpack(e),i=r.w,o=r.h,a=this.atlasImage;for(var s in a.resize({width:i||1,height:o||1}),this.patterns){var u=this.patterns[s].bin,l=u.x+1,c=u.y+1,h=this.images[s].data,f=h.width,p=h.height;t.RGBAImage.copy(h,a,{x:0,y:0},{x:l,y:c},{width:f,height:p}),t.RGBAImage.copy(h,a,{x:0,y:p-1},{x:l,y:c-1},{width:f,height:1}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:l,y:c+p},{width:f,height:1}),t.RGBAImage.copy(h,a,{x:f-1,y:0},{x:l-1,y:c},{width:1,height:p}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:l+f,y:c},{width:1,height:p})}this.dirty=!0},n.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},n.prototype.dispatchRenderCallbacks=function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e];if(!this.callbackDispatchedThisFrame[r]){this.callbackDispatchedThisFrame[r]=!0;var i=this.images[r];h(i)&&this.updateImage(r,i)}}},n}(t.Evented),p=v,d=v,g=1e20;function v(t,e,n,r,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function m(t,e,n,r,i,o,a){for(var s=0;s<e;s++){for(var u=0;u<n;u++)r[u]=t[u*e+s];for(y(r,i,o,a,n),u=0;u<n;u++)t[u*e+s]=i[u]}for(u=0;u<n;u++){for(s=0;s<e;s++)r[s]=t[u*e+s];for(y(r,i,o,a,e),s=0;s<e;s++)t[u*e+s]=Math.sqrt(i[s])}}function y(t,e,n,r,i){n[0]=0,r[0]=-g,r[1]=+g;for(var o=1,a=0;o<i;o++){for(var s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);s<=r[a];)a--,s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,r[a]=s,r[a+1]=+g}for(o=0,a=0;o<i;o++){for(;r[a+1]<o;)a++;e[o]=(o-n[a])*(o-n[a])+t[n[a]]}}v.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var i=e.data[4*r+3]/255;this.gridOuter[r]=1===i?0:0===i?g:Math.pow(Math.max(0,.5-i),2),this.gridInner[r]=1===i?g:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(m(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),m(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++)n[r]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[r]-this.gridInner[r])/this.radius+this.cutoff))));return n},p.default=d;var _=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};_.prototype.setURL=function(t){this.url=t},_.prototype.getGlyphs=function(e,n){var r=this,i=[];for(var o in e)for(var a=0,s=e[o];a<s.length;a+=1)i.push({stack:o,id:s[a]});t.asyncAll(i,(function(t,e){var n=t.stack,i=t.id,o=r.entries[n];o||(o=r.entries[n]={glyphs:{},requests:{},ranges:{}});var a=o.glyphs[i];if(void 0===a){if(a=r._tinySDF(o,n,i))return o.glyphs[i]=a,void e(null,{stack:n,id:i,glyph:a});var s=Math.floor(i/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else if(o.ranges[s])e(null,{stack:n,id:i,glyph:a});else{var u=o.requests[s];u||(u=o.requests[s]=[],_.loadGlyphRange(n,s,r.url,r.requestManager,(function(t,e){if(e){for(var n in e)r._doesCharSupportLocalGlyph(+n)||(o.glyphs[+n]=e[+n]);o.ranges[s]=!0}for(var i=0,a=u;i<a.length;i+=1)(0,a[i])(t,e);delete o.requests[s]}))),u.push((function(t,r){t?e(t):r&&e(null,{stack:n,id:i,glyph:r[i]||null})}))}}else e(null,{stack:n,id:i,glyph:a})}),(function(t,e){if(t)n(t);else if(e){for(var r={},i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.stack,u=a.id,l=a.glyph;(r[s]||(r[s]={}))[u]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}n(null,r)}}))},_.prototype._doesCharSupportLocalGlyph=function(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},_.prototype._tinySDF=function(e,n,r){var i=this.localIdeographFontFamily;if(i&&this._doesCharSupportLocalGlyph(r)){var o=e.tinySDF;if(!o){var a="400";/bold/i.test(n)?a="900":/medium/i.test(n)?a="500":/light/i.test(n)&&(a="200"),o=e.tinySDF=new _.TinySDF(24,3,8,.25,i,a)}return{id:r,bitmap:new t.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},_.loadGlyphRange=function(e,n,r,i,o){var a=256*n,s=a+255,u=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(u,(function(e,n){if(e)o(e);else if(n){for(var r={},i=0,a=t.parseGlyphPBF(n);i<a.length;i+=1){var s=a[i];r[s.id]=s}o(null,r)}}))},_.TinySDF=p;var b=function(){this.specification=t.styleSpec.light.position};b.prototype.possiblyEvaluate=function(e,n){return t.sphericalToCartesian(e.expression.evaluate(n))},b.prototype.interpolate=function(e,n,r){return{x:t.number(e.x,n.x,r),y:t.number(e.y,n.y,r),z:t.number(e.z,n.z,r)}};var x=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new b,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),w=function(e){function n(n){e.call(this),this._transitionable=new t.Transitionable(x),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getLight=function(){return this._transitionable.serialize()},n.prototype.setLight=function(e,n){if(void 0===n&&(n={}),!this._validate(t.validateLight,e,n))for(var r in e){var i=e[r];t.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-"-transition".length),i):this._transitionable.setValue(r,i)}},n.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},n.prototype.hasTransition=function(){return this._transitioning.hasTransition()},n.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},n.prototype._validate=function(e,n,r){return(!r||!1!==r.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},n}(t.Evented),E=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};E.prototype.getDash=function(t,e){var n=t.join(",")+String(e);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(t,e)),this.dashEntry[n]},E.prototype.getDashRanges=function(t,e,n){var r=[],i=t.length%2==1?-t[t.length-1]*n:0,o=t[0]*n,a=!0;r.push({left:i,right:o,isDash:a,zeroLength:0===t[0]});for(var s=t[0],u=1;u<t.length;u++){var l=t[u];r.push({left:i=s*n,right:o=(s+=l)*n,isDash:a=!a,zeroLength:0===l})}return r},E.prototype.addRoundDash=function(t,e,n){for(var r=e/2,i=-n;i<=n;i++)for(var o=this.width*(this.nextRow+n+i),a=0,s=t[a],u=0;u<this.width;u++){u/s.right>1&&(s=t[++a]);var l=Math.abs(u-s.left),c=Math.abs(u-s.right),h=Math.min(l,c),f=void 0,p=i/n*(r+1);if(s.isDash){var d=r-Math.abs(p);f=Math.sqrt(h*h+d*d)}else f=r-Math.sqrt(h*h+p*p);this.data[o+u]=Math.max(0,Math.min(255,f+128))}},E.prototype.addRegularDash=function(t){for(var e=t.length-1;e>=0;--e){var n=t[e],r=t[e+1];n.zeroLength?t.splice(e,1):r&&r.isDash===n.isDash&&(r.left=n.left,t.splice(e,1))}var i=t[0],o=t[t.length-1];i.isDash===o.isDash&&(i.left=o.left-this.width,o.right=i.right+this.width);for(var a=this.width*this.nextRow,s=0,u=t[s],l=0;l<this.width;l++){l/u.right>1&&(u=t[++s]);var c=Math.abs(l-u.left),h=Math.abs(l-u.right),f=Math.min(c,h);this.data[a+l]=Math.max(0,Math.min(255,(u.isDash?f:-f)+128))}},E.prototype.addDash=function(e,n){var r=n?7:0,i=2*r+1;if(this.nextRow+i>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var o=0,a=0;a<e.length;a++)o+=e[a];if(0!==o){var s=this.width/o,u=this.getDashRanges(e,this.width,s);n?this.addRoundDash(u,s,r):this.addRegularDash(u)}var l={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=i,this.dirty=!0,l},E.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))};var S=function e(n,r){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var i=this.workerPool.acquire(this.id),o=0;o<i.length;o++){var a=new e.Actor(i[o],r,this.id);a.name="Worker "+o,this.actors.push(a)}};function C(e,n,r){var i=function(i,o){if(i)return r(i);if(o){var a=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(a.vectorLayers=o.vector_layers,a.vectorLayerIds=a.vectorLayers.map((function(t){return t.id}))),a.tiles=n.canonicalizeTileset(a,e.url),r(null,a)}};return e.url?t.getJSON(n.transformRequest(n.normalizeSourceURL(e.url),t.ResourceType.Source),i):t.browser.frame((function(){return i(null,e)}))}S.prototype.broadcast=function(e,n,r){t.asyncAll(this.actors,(function(t,r){t.send(e,n,r)}),r=r||function(){})},S.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},S.prototype.remove=function(){this.actors.forEach((function(t){t.remove()})),this.actors=[],this.workerPool.release(this.id)},S.Actor=t.Actor;var A=function(e,n,r){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=r||24};A.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},A.prototype.contains=function(e){var n=Math.pow(2,e.z),r=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*n),i=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*n),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*n),a=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*n);return e.x>=r&&e.x<o&&e.y>=i&&e.y<a};var T=function(e){function n(n,r,i,o){if(e.call(this),this.id=n,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(r,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,(function(n,r){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new A(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(r.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setSourceProperty=function(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},n.prototype.setTiles=function(t){var e=this;return this.setSourceProperty((function(){e._options.tiles=t})),this},n.prototype.setUrl=function(t){var e=this;return this.setSourceProperty((function(){e.url=t,e._options.url=t})),this},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.loadTile=function(e,n){var r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(r,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function o(r,i){return delete e.request,e.aborted?n(null):r&&404!==r.status?n(r):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",i,o.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",i,o.bind(this)))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.hasTransition=function(){return!1},n}(t.Evented),k=function(e){function n(n,r,i,o){e.call(this),this.id=n,this.dispatcher=i,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},r),t.extend(this,t.pick(r,["url","scheme","tileSize"]))}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,(function(n,r){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new A(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles),t.postMapLoadEvent(r.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.loadTile=function(e,n){var r=this,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),(function(i,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(o){r.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=r.map.painter.context,s=a.gl;e.texture=r.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.Texture(a,o,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(r.dispatcher),n(null)}}))},n.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},n.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},n.prototype.hasTransition=function(){return!1},n}(t.Evented),M=function(e){function n(n,r,i,o){e.call(this,n,r,i,o),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},n.prototype.loadTile=function(e,n){var r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function i(t,r){t&&(e.state="errored",n(t)),r&&(e.dem=r,e.needsHillshadePrepare=!0,e.state="loaded",n(null))}e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),function(r,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(r)e.state="errored",n(r);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&t.offscreenCanvasSupported()?o:t.browser.getImageData(o,1),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:a,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,i.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},n.prototype._getNeighboringTiles=function(e){var n=e.canonical,r=Math.pow(2,n.z),i=(n.x-1+r)%r,o=0===n.x?e.wrap-1:e.wrap,a=(n.x+1+r)%r,s=n.x+1===r?e.wrap+1:e.wrap,u={};return u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y).key]={backfilled:!1},n.y>0&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y-1).key]={backfilled:!1}),n.y+1<r&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y+1).key]={backfilled:!1}),u},n.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},n}(k),P=function(e){function n(n,r,i,o){e.call(this),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(o),this._data=r.data,this._options=t.extend({},r),this._collectResourceTiming=r.collectResourceTiming,this._resourceTiming=[],void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;var a=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*a,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*a,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?Math.min(r.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:t.EXTENT,radius:(r.clusterRadius||50)*a,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(n){if(n)e.fire(new t.ErrorEvent(n));else{var r={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(r.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",r))}}))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setData=function(e){var n=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)n.fire(new t.ErrorEvent(e));else{var r={dataType:"source",sourceDataType:"content"};n._collectResourceTiming&&n._resourceTiming&&n._resourceTiming.length>0&&(r.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new t.Event("data",r))}})),this},n.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},n.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},n.prototype.getClusterLeaves=function(t,e,n,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:n},r),this},n.prototype._updateWorkerData=function(e){var n=this;this._loaded=!1;var r=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(r.request=this.map._requestManager.transformRequest(t.browser.resolveURL(i),t.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(i),this.actor.send(this.type+".loadData",r,(function(t,i){n._removed||i&&i.abandoned||(n._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[n.id]&&(n._resourceTiming=i.resourceTiming[n.id].slice(0)),n.actor.send(n.type+".coalesce",{source:r.source},null),e(t))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.loadTile=function(e,n){var r=this,i=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(i,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(t,o){return delete e.request,e.unloadVectorData(),e.aborted?n(null):t?n(t):(e.loadVectorData(o,r.map.painter,"reloadTile"===i),n(null))}))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},n.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},n.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},n.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},n.prototype.hasTransition=function(){return!1},n}(t.Evented),I=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),O=function(e){function n(t,n,r,i){e.call(this),this.id=t,this.dispatcher=r,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=n}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(e,n){var r=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(function(i,o){r._loaded=!0,i?r.fire(new t.ErrorEvent(i)):o&&(r.image=o,e&&(r.coordinates=e),n&&n(),r._finishLoading())}))},n.prototype.loaded=function(){return this._loaded},n.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null})),this):this},n.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setCoordinates=function(e){var n=this;this.coordinates=e;var r=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var n=1/0,r=1/0,i=-1/0,o=-1/0,a=0,s=e;a<s.length;a+=1){var u=s[a];n=Math.min(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.x),o=Math.max(o,u.y)}var l=Math.max(i-n,o-r),c=Math.max(0,Math.floor(-Math.log(l)/Math.LN2)),h=Math.pow(2,c);return new t.CanonicalTileID(c,Math.floor((n+i)/2*h),Math.floor((r+o)/2*h))}(r),this.minzoom=this.maxzoom=this.tileID.z;var i=r.map((function(t){return n.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},n.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,n=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},n.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return!1},n}(t.Evented),R=function(e){function n(t,n,r,i){e.call(this,t,n,r,i),this.roundZoom=!0,this.type="video",this.options=n}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1;var n=this.options;this.urls=[];for(var r=0,i=n.urls;r<i.length;r+=1)this.urls.push(this.map._requestManager.transformRequest(i[r],t.ResourceType.Source).url);t.getVideo(this.urls,(function(n,r){e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(e.video=r,e.video.loop=!0,e.video.addEventListener("playing",(function(){e.map.triggerRepaint()})),e.map&&e.video.play(),e._finishLoading())}))},n.prototype.pause=function(){this.video&&this.video.pause()},n.prototype.play=function(){this.video&&this.video.play()},n.prototype.seek=function(e){if(this.video){var n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+n.start(0)+" and "+n.end(0)+"-second mark."))):this.video.currentTime=e}},n.prototype.getVideo=function(){return this.video},n.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},n.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,n=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this.video&&!this.video.paused},n}(O),L=function(e){function n(n,r,i,o){e.call(this,n,r,i,o),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((function(t){return!Array.isArray(t)||2!==t.length||t.some((function(t){return"number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},n.prototype.getCanvas=function(){return this.canvas},n.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},n.prototype.onRemove=function(){this.pause()},n.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var n=this.map.painter.context,r=n.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(n,this.canvas,r.RGBA,{premultiply:!0}),this.tiles){var o=this.tiles[i];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this._playing},n.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var n=e[t];if(isNaN(n)||n<=0)return!0}return!1},n}(O),D={vector:T,raster:k,"raster-dem":M,geojson:P,video:R,image:O,canvas:L};function N(e,n){var r=t.identity([]);return t.translate(r,r,[1,1,0]),t.scale(r,r,[.5*e.width,.5*e.height,1]),t.multiply(r,r,e.calculatePosMatrix(n.toUnwrapped()))}function B(t,e,n,r,i,o){var a=function(t,e,n){if(t)for(var r=0,i=t;r<i.length;r+=1){var o=e[i[r]];if(o&&o.source===n&&"fill-extrusion"===o.type)return!0}else for(var a in e){var s=e[a];if(s.source===n&&"fill-extrusion"===s.type)return!0}return!1}(i&&i.layers,e,t.id),s=o.maxPitchScaleFactor(),u=t.tilesIn(r,s,a);u.sort(z);for(var l=[],c=0,h=u;c<h.length;c+=1){var f=h[c];l.push({wrappedTileID:f.tileID.wrapped().key,queryResults:f.tile.queryRenderedFeatures(e,n,t._state,f.queryGeometry,f.cameraQueryGeometry,f.scale,i,o,s,N(t.transform,f.tileID))})}var p=function(t){for(var e={},n={},r=0,i=t;r<i.length;r+=1){var o=i[r],a=o.queryResults,s=o.wrappedTileID,u=n[s]=n[s]||{};for(var l in a)for(var c=a[l],h=u[l]=u[l]||{},f=e[l]=e[l]||[],p=0,d=c;p<d.length;p+=1){var g=d[p];h[g.featureIndex]||(h[g.featureIndex]=!0,f.push(g))}}return e}(l);for(var d in p)p[d].forEach((function(e){var n=e.feature,r=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=r}));return p}function z(t,e){var n=t.tileID,r=e.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}var F=function(t,e){this.max=t,this.onRemove=e,this.reset()};F.prototype.reset=function(){for(var t in this.data)for(var e=0,n=this.data[t];e<n.length;e+=1){var r=n[e];r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value)}return this.data={},this.order=[],this},F.prototype.add=function(t,e,n){var r=this,i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var o={value:e,timeout:void 0};if(void 0!==n&&(o.timeout=setTimeout((function(){r.remove(t,o)}),n)),this.data[i].push(o),this.order.push(i),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},F.prototype.has=function(t){return t.wrapped().key in this.data},F.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},F.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},F.prototype.getByKey=function(t){var e=this.data[t];return e?e[0].value:null},F.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},F.prototype.remove=function(t,e){if(!this.has(t))return this;var n=t.wrapped().key,r=void 0===e?0:this.data[n].indexOf(e),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this},F.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this},F.prototype.filter=function(t){var e=[];for(var n in this.data)for(var r=0,i=this.data[n];r<i.length;r+=1){var o=i[r];t(o.value)||e.push(o)}for(var a=0,s=e;a<s.length;a+=1){var u=s[a];this.remove(u.value.tileID,u)}};var Z=function(t,e,n){this.context=t;var r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};Z.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Z.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},Z.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var j={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},U=function(t,e,n,r){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;var i=t.gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};U.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},U.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},U.prototype.enableAttributes=function(t,e){for(var n=0;n<this.attributes.length;n++){var r=e.attributes[this.attributes[n].name];void 0!==r&&t.enableVertexAttribArray(r)}},U.prototype.setVertexAttribPointers=function(t,e,n){for(var r=0;r<this.attributes.length;r++){var i=this.attributes[r],o=e.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[j[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}},U.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var G=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};G.prototype.get=function(){return this.current},G.prototype.set=function(t){},G.prototype.getDefault=function(){return this.default},G.prototype.setDefault=function(){this.set(this.default)};var V=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(G),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(G),H=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(G),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(G),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(G),q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(G),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(G),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(G),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(G),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(G),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(G),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(G),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(G),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(G),it=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(G),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(G),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(G),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(G),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(G),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(G),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(G),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(G),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(G),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(G),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(G),gt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(G),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(G),mt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(G),yt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(G),_t=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(G),bt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(G),xt=function(t){function e(e,n){t.call(this,e),this.context=e,this.parent=n}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(G),wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(xt),Et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(xt),St=function(t,e,n,r){this.context=t,this.width=e,this.height=n;var i=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new wt(t,i),r&&(this.depthAttachment=new Et(t,i))};St.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){var n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}t.deleteFramebuffer(this.framebuffer)};var Ct=function(t,e,n){this.func=t,this.mask=e,this.range=n};Ct.ReadOnly=!1,Ct.ReadWrite=!0,Ct.disabled=new Ct(519,Ct.ReadOnly,[0,1]);var At=function(t,e,n,r,i,o){this.test=t,this.ref=e,this.mask=n,this.fail=r,this.depthFail=i,this.pass=o};At.disabled=new At({func:519,mask:0},0,0,7680,7680,7680);var Tt=function(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n};Tt.disabled=new Tt(Tt.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Tt.unblended=new Tt(Tt.Replace,t.Color.transparent,[!0,!0,!0,!0]),Tt.alphaBlended=new Tt([1,771],t.Color.transparent,[!0,!0,!0,!0]);var kt=function(t,e,n){this.enable=t,this.mode=e,this.frontFace=n};kt.disabled=new kt(!1,1029,2305),kt.backCCW=new kt(!0,1029,2305);var Mt=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new V(this),this.clearDepth=new W(this),this.clearStencil=new H(this),this.colorMask=new X(this),this.depthMask=new Y(this),this.stencilMask=new q(this),this.stencilFunc=new K(this),this.stencilOp=new Q(this),this.stencilTest=new J(this),this.depthRange=new $(this),this.depthTest=new tt(this),this.depthFunc=new et(this),this.blend=new nt(this),this.blendFunc=new rt(this),this.blendColor=new it(this),this.blendEquation=new ot(this),this.cullFace=new at(this),this.cullFaceSide=new st(this),this.frontFace=new ut(this),this.program=new lt(this),this.activeTexture=new ct(this),this.viewport=new ht(this),this.bindFramebuffer=new ft(this),this.bindRenderbuffer=new pt(this),this.bindTexture=new dt(this),this.bindVertexBuffer=new gt(this),this.bindElementBuffer=new vt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new mt(this),this.pixelStoreUnpack=new yt(this),this.pixelStoreUnpackPremultiplyAlpha=new _t(this),this.pixelStoreUnpackFlipY=new bt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)};Mt.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Mt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Mt.prototype.createIndexBuffer=function(t,e){return new Z(this,t,e)},Mt.prototype.createVertexBuffer=function(t,e,n){return new U(this,t,e,n)},Mt.prototype.createRenderbuffer=function(t,e,n){var r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),i},Mt.prototype.createFramebuffer=function(t,e,n){return new St(this,t,e,n)},Mt.prototype.clear=function(t){var e=t.color,n=t.depth,r=this.gl,i=0;e&&(i|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(i|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),r.clear(i)},Mt.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},Mt.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},Mt.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},Mt.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Tt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},Mt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Pt=function(e){function n(n,r,i){var o=this;e.call(this),this.id=n,this.dispatcher=i,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),this.on("error",(function(){o._sourceErrored=!0})),this._source=function(e,n,r,i){var o=new D[n.type](e,n,r,i);if(o.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+o.id);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o}(n,r,i,this),this._tiles={},this._cache=new F(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},n.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},n.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},n.prototype.getSource=function(){return this._source},n.prototype.pause=function(){this._paused=!0},n.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},n.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},n.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},n.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},n.prototype.serialize=function(){return this._source.serialize()},n.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}},n.prototype.getIds=function(){return t.values(this._tiles).map((function(t){return t.tileID})).sort(It).map((function(t){return t.key}))},n.prototype.getRenderableIds=function(e){var n=this,r=[];for(var i in this._tiles)this._isIdRenderable(i,e)&&r.push(this._tiles[i]);return e?r.sort((function(e,r){var i=e.tileID,o=r.tileID,a=new t.Point(i.canonical.x,i.canonical.y)._rotate(n.transform.angle),s=new t.Point(o.canonical.x,o.canonical.y)._rotate(n.transform.angle);return i.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x})).map((function(t){return t.tileID.key})):r.map((function(t){return t.tileID})).sort(It).map((function(t){return t.key}))},n.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},n.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},n.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},n.prototype._reloadTile=function(t,e){var n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))},n.prototype._tileLoaded=function(e,n,r,i){if(i)return e.state="errored",void(404!==i.status?this._source.fire(new t.ErrorEvent(i,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},n.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),n=0;n<e.length;n++){var r=e[n];if(t.neighboringTiles&&t.neighboringTiles[r]){var i=this.getTileByID(r);o(t,i),o(i,t)}}function o(t,e){t.needsHillshadePrepare=!0;var n=e.tileID.canonical.x-t.tileID.canonical.x,r=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===n&&0===r||Math.abs(r)>1||(Math.abs(n)>1&&(1===Math.abs(n+i)?n+=i:1===Math.abs(n-i)&&(n-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},n.prototype.getTile=function(t){return this.getTileByID(t.key)},n.prototype.getTileByID=function(t){return this._tiles[t]},n.prototype._retainLoadedChildren=function(t,e,n,r){for(var i in this._tiles){var o=this._tiles[i];if(!(r[i]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>n)){for(var a=o.tileID;o&&o.tileID.overscaledZ>e+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var u=a;u.overscaledZ>e;)if(t[(u=u.scaledTo(u.overscaledZ-1)).key]){r[a.key]=a;break}}}},n.prototype.findLoadedParent=function(t,e){if(t.key in this._loadedParentTiles){var n=this._loadedParentTiles[t.key];return n&&n.tileID.overscaledZ>=e?n:null}for(var r=t.overscaledZ-1;r>=e;r--){var i=t.scaledTo(r),o=this._getLoadedTile(i);if(o)return o}},n.prototype._getLoadedTile=function(t){var e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)},n.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/this._source.tileSize)+1,n=Math.ceil(t.height/this._source.tileSize)+1,r=Math.floor(e*n*5),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(i)},n.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var n={};for(var r in this._tiles){var i=this._tiles[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),n[i.tileID.key]=i}for(var o in this._tiles=n,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var a in this._tiles)this._setTileReloadTimer(a,this._tiles[a])}},n.prototype.update=function(e){var r=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var i;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(i=i.filter((function(t){return r._source.hasTile(t)})))):i=[];var o=e.coveringZoomLevel(this._source),a=Math.max(o-n.maxOverzooming,this._source.minzoom),s=Math.max(o+n.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(i,o);if(Ot(this._source.type)){for(var l={},c={},h=0,f=Object.keys(u);h<f.length;h+=1){var p=f[h],d=u[p],g=this._tiles[p];if(g&&!(g.fadeEndTime&&g.fadeEndTime<=t.browser.now())){var v=this.findLoadedParent(d,a);v&&(this._addTile(v.tileID),l[v.tileID.key]=v.tileID),c[p]=d}}for(var m in this._retainLoadedChildren(c,o,s,u),l)u[m]||(this._coveredTiles[m]=!0,u[m]=l[m])}for(var y in u)this._tiles[y].clearFadeHold();for(var _=0,b=t.keysDifference(this._tiles,u);_<b.length;_+=1){var x=b[_],w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(x)}this._updateLoadedParentTileCache()}},n.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},n.prototype._updateRetainedTiles=function(t,e){for(var r={},i={},o=Math.max(e-n.maxOverzooming,this._source.minzoom),a=Math.max(e+n.maxUnderzooming,this._source.minzoom),s={},u=0,l=t;u<l.length;u+=1){var c=l[u],h=this._addTile(c);r[c.key]=c,h.hasData()||e<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,e,a,r);for(var f=0,p=t;f<p.length;f+=1){var d=p[f],g=this._tiles[d.key];if(!g.hasData()){if(e+1>this._source.maxzoom){var v=d.children(this._source.maxzoom)[0],m=this.getTile(v);if(m&&m.hasData()){r[v.key]=v;continue}}else{var y=d.children(this._source.maxzoom);if(r[y[0].key]&&r[y[1].key]&&r[y[2].key]&&r[y[3].key])continue}for(var _=g.wasRequested(),b=d.overscaledZ-1;b>=o;--b){var x=d.scaledTo(b);if(i[x.key])break;if(i[x.key]=!0,!(g=this.getTile(x))&&_&&(g=this._addTile(x)),g&&(r[x.key]=x,_=g.wasRequested(),g.hasData()))break}}}return r},n.prototype._updateLoadedParentTileCache=function(){for(var t in this._loadedParentTiles={},this._tiles){for(var e=[],n=void 0,r=this._tiles[t].tileID;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){n=this._loadedParentTiles[r.key];break}e.push(r.key);var i=r.scaledTo(r.overscaledZ-1);if(n=this._getLoadedTile(i))break;r=i}for(var o=0,a=e;o<a.length;o+=1)this._loadedParentTiles[a[o]]=n}},n.prototype._addTile=function(e){var n=this._tiles[e.key];if(n)return n;(n=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));var r=Boolean(n);return r||(n=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))),n?(n.uses++,this._tiles[e.key]=n,r||this._source.fire(new t.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null},n.prototype._setTileReloadTimer=function(t,e){var n=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var r=e.getExpiryTimeout();r&&(this._timers[t]=setTimeout((function(){n._reloadTile(t,"expired"),delete n._timers[t]}),r))},n.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},n.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},n.prototype.tilesIn=function(e,n,r){var i=this,o=[],a=this.transform;if(!a)return o;for(var s=r?a.getCameraQueryGeometry(e):e,u=e.map((function(t){return a.pointCoordinate(t)})),l=s.map((function(t){return a.pointCoordinate(t)})),c=this.getIds(),h=1/0,f=1/0,p=-1/0,d=-1/0,g=0,v=l;g<v.length;g+=1){var m=v[g];h=Math.min(h,m.x),f=Math.min(f,m.y),p=Math.max(p,m.x),d=Math.max(d,m.y)}for(var y=function(e){var r=i._tiles[c[e]];if(!r.holdingForFade()){var s=r.tileID,g=Math.pow(2,a.zoom-r.tileID.overscaledZ),v=n*r.queryPadding*t.EXTENT/r.tileSize/g,m=[s.getTilePoint(new t.MercatorCoordinate(h,f)),s.getTilePoint(new t.MercatorCoordinate(p,d))];if(m[0].x-v<t.EXTENT&&m[0].y-v<t.EXTENT&&m[1].x+v>=0&&m[1].y+v>=0){var y=u.map((function(t){return s.getTilePoint(t)})),_=l.map((function(t){return s.getTilePoint(t)}));o.push({tile:r,tileID:s,queryGeometry:y,cameraQueryGeometry:_,scale:g})}}},_=0;_<c.length;_++)y(_);return o},n.prototype.getVisibleCoordinates=function(t){for(var e=this,n=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),r=0,i=n;r<i.length;r+=1){var o=i[r];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return n},n.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Ot(this._source.type))for(var e in this._tiles){var n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=t.browser.now())return!0}return!1},n.prototype.setFeatureState=function(t,e,n){this._state.updateState(t=t||"_geojsonTileLayer",e,n)},n.prototype.removeFeatureState=function(t,e,n){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,n)},n.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},n.prototype.setDependencies=function(t,e,n){var r=this._tiles[t];r&&r.setDependencies(e,n)},n.prototype.reloadTilesForDependencies=function(t,e){for(var n in this._tiles)this._tiles[n].hasDependency(t,e)&&this._reloadTile(n,"reloading");this._cache.filter((function(n){return!n.hasDependency(t,e)}))},n}(t.Evented);function It(t,e){var n=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Ot(t){return"raster"===t||"image"===t||"video"===t}function Rt(){return new t.window.Worker(qi.workerUrl)}Pt.maxOverzooming=10,Pt.maxUnderzooming=3;var Lt="mapboxgl_preloaded_worker_pool",Dt=function(){this.active={}};Dt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Dt.workerCount;)this.workers.push(new Rt);return this.active[t]=!0,this.workers.slice()},Dt.prototype.release=function(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},Dt.prototype.isPreloaded=function(){return!!this.active[Lt]},Dt.prototype.numActive=function(){return Object.keys(this.active).length};var Nt,Bt=Math.floor(t.browser.hardwareConcurrency/2);function zt(){return Nt||(Nt=new Dt),Nt}function Ft(e,n){var r={};for(var i in e)"ref"!==i&&(r[i]=e[i]);return t.refProperties.forEach((function(t){t in n&&(r[t]=n[t])})),r}function Zt(t){t=t.slice();for(var e=Object.create(null),n=0;n<t.length;n++)e[t[n].id]=t[n];for(var r=0;r<t.length;r++)"ref"in t[r]&&(t[r]=Ft(t[r],e[t[r].ref]));return t}Dt.workerCount=Math.max(Math.min(Bt,6),1);var jt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ut(t,e,n){n.push({command:jt.addSource,args:[t,e[t]]})}function Gt(t,e,n){e.push({command:jt.removeSource,args:[t]}),n[t]=!0}function Vt(t,e,n,r){Gt(t,n,r),Ut(t,e,n)}function Wt(e,n,r){var i;for(i in e[r])if(e[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;for(i in n[r])if(n[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;return!0}function Ht(e,n,r,i,o,a){var s;for(s in n=n||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}));for(s in n)n.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}))}function Xt(t){return t.id}function Yt(t,e){return t[e.id]=e,t}var qt=function(t,e){this.reset(t,e)};qt.prototype.reset=function(t,e){this.points=t||[],this._distances=[0];for(var n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding},qt.prototype.lerp=function(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);for(var n=1,r=this._distances[n],i=e*this.paddedLength+this.padding;r<i&&n<this._distances.length;)r=this._distances[++n];var o=n-1,a=this._distances[o],s=r-a,u=s>0?(i-a)/s:0;return this.points[o].mult(1-u).add(this.points[n].mult(u))};var Kt=function(t,e,n){var r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};function Qt(e,n,r,i,o){var a=t.create();return n?(t.scale(a,a,[1/o,1/o,1]),r||t.rotateZ(a,a,i.angle)):t.multiply(a,i.labelPlaneMatrix,e),a}function Jt(e,n,r,i,o){if(n){var a=t.clone(e);return t.scale(a,a,[o,o,1]),r||t.rotateZ(a,a,-i.angle),a}return i.glCoordMatrix}function $t(e,n){var r=[e.x,e.y,0,1];ce(r,r,n);var i=r[3];return{point:new t.Point(r[0]/i,r[1]/i),signedDistanceFromCamera:i}}function te(t,e){return.5+t/e*.5}function ee(t,e){var n=t[0]/t[3],r=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&r>=-e[1]&&r<=e[1]}function ne(e,n,r,i,o,a,s,u){var l=i?e.textSizeData:e.iconSizeData,c=t.evaluateSizeForZoom(l,r.transform.zoom),h=[256/r.width*2+1,256/r.height*2+1],f=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;f.clear();for(var p=e.lineVertexArray,d=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,g=r.transform.width/r.transform.height,v=!1,m=0;m<d.length;m++){var y=d.get(m);if(y.hidden||y.writingMode===t.WritingMode.vertical&&!v)le(y.numGlyphs,f);else{v=!1;var _=[y.anchorX,y.anchorY,0,1];if(t.transformMat4(_,_,n),ee(_,h)){var b=te(r.transform.cameraToCenterDistance,_[3]),x=t.evaluateSizeForFeature(l,c,y),w=s?x/b:x*b,E=new t.Point(y.anchorX,y.anchorY),S=$t(E,o).point,C={},A=oe(y,w,!1,u,n,o,a,e.glyphOffsetArray,p,f,S,E,C,g);v=A.useVertical,(A.notEnoughRoom||v||A.needsFlipping&&oe(y,w,!0,u,n,o,a,e.glyphOffsetArray,p,f,S,E,C,g).notEnoughRoom)&&le(y.numGlyphs,f)}else le(y.numGlyphs,f)}}i?e.text.dynamicLayoutVertexBuffer.updateData(f):e.icon.dynamicLayoutVertexBuffer.updateData(f)}function re(t,e,n,r,i,o,a,s,u,l,c){var h=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,p=s.lineStartIndex+s.lineLength,d=e.getoffsetX(s.glyphStartIndex),g=e.getoffsetX(h-1),v=se(t*d,n,r,i,o,a,s.segment,f,p,u,l,c);if(!v)return null;var m=se(t*g,n,r,i,o,a,s.segment,f,p,u,l,c);return m?{first:v,last:m}:null}function ie(e,n,r,i){return e===t.WritingMode.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:(e===t.WritingMode.vertical?n.y<r.y:n.x>r.x)?{needsFlipping:!0}:null}function oe(e,n,r,i,o,a,s,u,l,c,h,f,p,d){var g,v=n/24,m=e.lineOffsetX*v,y=e.lineOffsetY*v;if(e.numGlyphs>1){var _=e.glyphStartIndex+e.numGlyphs,b=e.lineStartIndex,x=e.lineStartIndex+e.lineLength,w=re(v,u,m,y,r,h,f,e,l,a,p);if(!w)return{notEnoughRoom:!0};var E=$t(w.first.point,s).point,S=$t(w.last.point,s).point;if(i&&!r){var C=ie(e.writingMode,E,S,d);if(C)return C}g=[w.first];for(var A=e.glyphStartIndex+1;A<_-1;A++)g.push(se(v*u.getoffsetX(A),m,y,r,h,f,e.segment,b,x,l,a,p));g.push(w.last)}else{if(i&&!r){var T=$t(f,o).point,k=e.lineStartIndex+e.segment+1,M=new t.Point(l.getx(k),l.gety(k)),P=$t(M,o),I=P.signedDistanceFromCamera>0?P.point:ae(f,M,T,1,o),O=ie(e.writingMode,T,I,d);if(O)return O}var R=se(v*u.getoffsetX(e.glyphStartIndex),m,y,r,h,f,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,a,p);if(!R)return{notEnoughRoom:!0};g=[R]}for(var L=0,D=g;L<D.length;L+=1){var N=D[L];t.addDynamicAttributes(c,N.point,N.angle)}return{}}function ae(t,e,n,r,i){var o=$t(t.add(t.sub(e)._unit()),i).point,a=n.sub(o);return n.add(a._mult(r/a.mag()))}function se(e,n,r,i,o,a,s,u,l,c,h,f){var p=i?e-n:e+n,d=p>0?1:-1,g=0;i&&(d*=-1,g=Math.PI),d<0&&(g+=Math.PI);for(var v=d>0?u+s:u+s+1,m=o,y=o,_=0,b=0,x=Math.abs(p),w=[];_+b<=x;){if((v+=d)<u||v>=l)return null;if(y=m,w.push(m),void 0===(m=f[v])){var E=new t.Point(c.getx(v),c.gety(v)),S=$t(E,h);if(S.signedDistanceFromCamera>0)m=f[v]=S.point;else{var C=v-d;m=ae(0===_?a:new t.Point(c.getx(C),c.gety(C)),E,y,x-_+1,h)}}_+=b,b=y.dist(m)}var A=(x-_)/b,T=m.sub(y),k=T.mult(A)._add(y);k._add(T._unit()._perp()._mult(r*d));var M=g+Math.atan2(m.y-y.y,m.x-y.x);return w.push(k),{point:k,angle:M,path:w}}Kt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Kt.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Kt.prototype.insertCircle=function(t,e,n,r){this._forEachCell(e-r,n-r,e+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(r)},Kt.prototype._insertBoxCell=function(t,e,n,r,i,o){this.boxCells[i].push(o)},Kt.prototype._insertCircleCell=function(t,e,n,r,i,o){this.circleCells[i].push(o)},Kt.prototype._query=function(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var l=this.circles[3*u],c=this.circles[3*u+1],h=this.circles[3*u+2];a.push({key:this.circleKeys[u],x1:l-h,y1:c-h,x2:l+h,y2:c+h})}return o?a.filter(o):a}return this._forEachCell(t,e,n,r,this._queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?a.length>0:a},Kt.prototype._queryCircle=function(t,e,n,r,i){var o=t-n,a=t+n,s=e-n,u=e+n;if(a<0||o>this.width||u<0||s>this.height)return!r&&[];var l=[];return this._forEachCell(o,s,a,u,this._queryCellCircle,l,{hitTest:r,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}},i),r?l.length>0:l},Kt.prototype.query=function(t,e,n,r,i){return this._query(t,e,n,r,!1,i)},Kt.prototype.hitTest=function(t,e,n,r,i){return this._query(t,e,n,r,!0,i)},Kt.prototype.hitTestCircle=function(t,e,n,r){return this._queryCircle(t,e,n,!0,r)},Kt.prototype._queryCell=function(t,e,n,r,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l)for(var c=this.bboxes,h=0,f=l;h<f.length;h+=1){var p=f[h];if(!u.box[p]){u.box[p]=!0;var d=4*p;if(t<=c[d+2]&&e<=c[d+3]&&n>=c[d+0]&&r>=c[d+1]&&(!s||s(this.boxKeys[p]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[p],x1:c[d],y1:c[d+1],x2:c[d+2],y2:c[d+3]})}}}var g=this.circleCells[i];if(null!==g)for(var v=this.circles,m=0,y=g;m<y.length;m+=1){var _=y[m];if(!u.circle[_]){u.circle[_]=!0;var b=3*_;if(this._circleAndRectCollide(v[b],v[b+1],v[b+2],t,e,n,r)&&(!s||s(this.circleKeys[_]))){if(a.hitTest)return o.push(!0),!0;var x=v[b],w=v[b+1],E=v[b+2];o.push({key:this.circleKeys[_],x1:x-E,y1:w-E,x2:x+E,y2:w+E})}}}},Kt.prototype._queryCellCircle=function(t,e,n,r,i,o,a,s){var u=a.circle,l=a.seenUids,c=this.boxCells[i];if(null!==c)for(var h=this.bboxes,f=0,p=c;f<p.length;f+=1){var d=p[f];if(!l.box[d]){l.box[d]=!0;var g=4*d;if(this._circleAndRectCollide(u.x,u.y,u.radius,h[g+0],h[g+1],h[g+2],h[g+3])&&(!s||s(this.boxKeys[d])))return o.push(!0),!0}}var v=this.circleCells[i];if(null!==v)for(var m=this.circles,y=0,_=v;y<_.length;y+=1){var b=_[y];if(!l.circle[b]){l.circle[b]=!0;var x=3*b;if(this._circlesCollide(m[x],m[x+1],m[x+2],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[b])))return o.push(!0),!0}}},Kt.prototype._forEachCell=function(t,e,n,r,i,o,a,s){for(var u=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),c=this._convertToXCellCoord(n),h=this._convertToYCellCoord(r),f=u;f<=c;f++)for(var p=l;p<=h;p++)if(i.call(this,t,e,n,r,this.xCellCount*p+f,o,a,s))return},Kt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Kt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Kt.prototype._circlesCollide=function(t,e,n,r,i,o){var a=r-t,s=i-e,u=n+o;return u*u>a*a+s*s},Kt.prototype._circleAndRectCollide=function(t,e,n,r,i,o,a){var s=(o-r)/2,u=Math.abs(t-(r+s));if(u>s+n)return!1;var l=(a-i)/2,c=Math.abs(e-(i+l));if(c>l+n)return!1;if(u<=s||c<=l)return!0;var h=u-s,f=c-l;return h*h+f*f<=n*n};var ue=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function le(t,e){for(var n=0;n<t;n++){var r=e.length;e.resize(r+4),e.float32.set(ue,3*r)}}function ce(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t[3]=n[3]*r+n[7]*i+n[15],t}var he=function(t,e,n){void 0===e&&(e=new Kt(t.width+200,t.height+200,25)),void 0===n&&(n=new Kt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function fe(e,n,r){return n*(t.EXTENT/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}he.prototype.placeCollisionBox=function(t,e,n,r,i){var o=this.projectAndGetPerspectiveRatio(r,t.anchorPointX,t.anchorPointY),a=n*o.perspectiveRatio,s=t.x1*a+o.point.x,u=t.y1*a+o.point.y,l=t.x2*a+o.point.x,c=t.y2*a+o.point.y;return!this.isInsideGrid(s,u,l,c)||!e&&this.grid.hitTest(s,u,l,c,i)?{box:[],offscreen:!1}:{box:[s,u,l,c],offscreen:this.isOffscreen(s,u,l,c)}},he.prototype.placeCollisionCircles=function(e,n,r,i,o,a,s,u,l,c,h,f,p){var d=[],g=new t.Point(n.anchorX,n.anchorY),v=$t(g,a),m=te(this.transform.cameraToCenterDistance,v.signedDistanceFromCamera),y=(c?o/m:o*m)/t.ONE_EM,_=$t(g,s).point,b=re(y,i,n.lineOffsetX*y,n.lineOffsetY*y,!1,_,g,n,r,s,{}),x=!1,w=!1,E=!0;if(b){for(var S=.5*f*m+p,C=new t.Point(-100,-100),A=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),T=new qt,k=b.first,M=b.last,P=[],I=k.path.length-1;I>=1;I--)P.push(k.path[I]);for(var O=1;O<M.path.length;O++)P.push(M.path[O]);var R=2.5*S;if(u){var L=P.map((function(t){return $t(t,u)}));P=L.some((function(t){return t.signedDistanceFromCamera<=0}))?[]:L.map((function(t){return t.point}))}var D=[];if(P.length>0){for(var N=P[0].clone(),B=P[0].clone(),z=1;z<P.length;z++)N.x=Math.min(N.x,P[z].x),N.y=Math.min(N.y,P[z].y),B.x=Math.max(B.x,P[z].x),B.y=Math.max(B.y,P[z].y);D=N.x>=C.x&&B.x<=A.x&&N.y>=C.y&&B.y<=A.y?[P]:B.x<C.x||N.x>A.x||B.y<C.y||N.y>A.y?[]:t.clipLine([P],C.x,C.y,A.x,A.y)}for(var F=0,Z=D;F<Z.length;F+=1){var j;T.reset(Z[F],.25*S),j=T.length<=.5*S?1:Math.ceil(T.paddedLength/R)+1;for(var U=0;U<j;U++){var G=U/Math.max(j-1,1),V=T.lerp(G),W=V.x+100,H=V.y+100;d.push(W,H,S,0);var X=W-S,Y=H-S,q=W+S,K=H+S;if(E=E&&this.isOffscreen(X,Y,q,K),w=w||this.isInsideGrid(X,Y,q,K),!e&&this.grid.hitTestCircle(W,H,S,h)&&(x=!0,!l))return{circles:[],offscreen:!1,collisionDetected:x}}}}return{circles:!l&&x||!w?[]:d,offscreen:E,collisionDetected:x}},he.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var n=[],r=1/0,i=1/0,o=-1/0,a=-1/0,s=0,u=e;s<u.length;s+=1){var l=u[s],c=new t.Point(l.x+100,l.y+100);r=Math.min(r,c.x),i=Math.min(i,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y),n.push(c)}for(var h={},f={},p=0,d=this.grid.query(r,i,o,a).concat(this.ignoredGrid.query(r,i,o,a));p<d.length;p+=1){var g=d[p],v=g.key;if(void 0===h[v.bucketInstanceId]&&(h[v.bucketInstanceId]={}),!h[v.bucketInstanceId][v.featureIndex]){var m=[new t.Point(g.x1,g.y1),new t.Point(g.x2,g.y1),new t.Point(g.x2,g.y2),new t.Point(g.x1,g.y2)];t.polygonIntersectsPolygon(n,m)&&(h[v.bucketInstanceId][v.featureIndex]=!0,void 0===f[v.bucketInstanceId]&&(f[v.bucketInstanceId]=[]),f[v.bucketInstanceId].push(v.featureIndex))}}return f},he.prototype.insertCollisionBox=function(t,e,n,r,i){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:i},t[0],t[1],t[2],t[3])},he.prototype.insertCollisionCircles=function(t,e,n,r,i){for(var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:n,featureIndex:r,collisionGroupID:i},s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])},he.prototype.projectAndGetPerspectiveRatio=function(e,n,r){var i=[n,r,0,1];return ce(i,i,e),{point:new t.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5}},he.prototype.isOffscreen=function(t,e,n,r){return n<100||t>=this.screenRightBoundary||r<100||e>this.screenBottomBoundary},he.prototype.isInsideGrid=function(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary},he.prototype.getViewportMatrix=function(){var e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e};var pe=function(t,e,n,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&n?1:0,this.placed=n};pe.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var de=function(t,e,n,r,i){this.text=new pe(t?t.text:null,e,n,i),this.icon=new pe(t?t.icon:null,e,r,i)};de.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var ge=function(t,e,n){this.text=t,this.icon=e,this.skipFade=n},ve=function(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]},me=function(t,e,n,r,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i},ye=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function _e(e,n,r,i,o){var a=t.getAnchorAlignment(e),s=-(a.horizontalAlign-.5)*n,u=-(a.verticalAlign-.5)*r,l=t.evaluateVariableOffset(e,i);return new t.Point(s+l[0]*o,u+l[1]*o)}function be(e,n,r,i,o,a){var s=e.x1,u=e.x2,l=e.y1,c=e.y2,h=e.anchorPointX,f=e.anchorPointY,p=new t.Point(n,r);return i&&p._rotate(o?a:-a),{x1:s+p.x,y1:l+p.y,x2:u+p.x,y2:c+p.y,anchorPointX:h,anchorPointY:f}}ye.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var xe=function(t,e,n,r){this.transform=t.clone(),this.collisionIndex=new he(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new ye(n),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}};function we(t,e,n,r,i){t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0)}xe.prototype.getBucketParts=function(e,n,r,i){var o=r.getBucket(n),a=r.latestFeatureIndex;if(o&&a&&n.id===o.layerIds[0]){var s=r.collisionBoxArray,u=o.layers[0].layout,l=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),c=r.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),f="map"===u.get("text-pitch-alignment"),p="map"===u.get("text-rotation-alignment"),d=fe(r,1,this.transform.zoom),g=Qt(h,f,p,this.transform,d),v=null;if(f){var m=Jt(h,f,p,this.transform,d);v=t.multiply([],this.transform.labelPlaneMatrix,m)}this.retainedQueryData[o.bucketInstanceId]=new me(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,r.tileID);var y={bucket:o,layout:u,posMatrix:h,textLabelPlaneMatrix:g,labelToScreenMatrix:v,scale:l,textPixelRatio:c,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(i)for(var _=0,b=o.sortKeyRanges;_<b.length;_+=1){var x=b[_];e.push({sortKey:x.sortKey,symbolInstanceStart:x.symbolInstanceStart,symbolInstanceEnd:x.symbolInstanceEnd,parameters:y})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:y})}},xe.prototype.attemptAnchorPlacement=function(t,e,n,r,i,o,a,s,u,l,c,h,f,p,d){var g,v=[h.textOffset0,h.textOffset1],m=_e(t,n,r,v,i),y=this.collisionIndex.placeCollisionBox(be(e,m.x,m.y,o,a,this.transform.angle),c,s,u,l.predicate);if(!d||0!==this.collisionIndex.placeCollisionBox(be(d,m.x,m.y,o,a,this.transform.angle),c,s,u,l.predicate).box.length)return y.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(g=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:v,width:n,height:r,anchor:t,textBoxScale:i,prevAnchor:g},this.markUsedJustification(f,t,h,p),f.allowVerticalPlacement&&(this.markUsedOrientation(f,p,h),this.placedOrientations[h.crossTileID]=p),{shift:m,placedGlyphBoxes:y}):void 0},xe.prototype.placeLayerBucketPart=function(e,n,r){var i=this,o=e.parameters,a=o.bucket,s=o.layout,u=o.posMatrix,l=o.textLabelPlaneMatrix,c=o.labelToScreenMatrix,h=o.textPixelRatio,f=o.holdingForFade,p=o.collisionBoxArray,d=o.partiallyEvaluatedTextSize,g=o.collisionGroup,v=s.get("text-optional"),m=s.get("icon-optional"),y=s.get("text-allow-overlap"),_=s.get("icon-allow-overlap"),b="map"===s.get("text-rotation-alignment"),x="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),E="viewport-y"===s.get("symbol-z-order"),S=y&&(_||!a.hasIconData()||m),C=_&&(y||!a.hasTextData()||v);!a.collisionArrays&&p&&a.deserializeCollisionBoxes(p);var A=function(e,o){if(!n[e.crossTileID])if(f)i.placements[e.crossTileID]=new ge(!1,!1,!1);else{var p,E=!1,A=!1,T=!0,k=null,M={box:null,offscreen:null},P={box:null,offscreen:null},I=null,O=null,R=0,L=0,D=0;o.textFeatureIndex?R=o.textFeatureIndex:e.useRuntimeCollisionCircles&&(R=e.featureIndex),o.verticalTextFeatureIndex&&(L=o.verticalTextFeatureIndex);var N=o.textBox;if(N){var B=function(n){var r=t.WritingMode.horizontal;if(a.allowVerticalPlacement&&!n&&i.prevPlacement){var o=i.prevPlacement.placedOrientations[e.crossTileID];o&&(i.placedOrientations[e.crossTileID]=o,i.markUsedOrientation(a,r=o,e))}return r},z=function(n,r){if(a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&o.verticalTextBox)for(var i=0,s=a.writingModes;i<s.length&&(s[i]===t.WritingMode.vertical?(M=r(),P=M):M=n(),!(M&&M.box&&M.box.length));i+=1);else M=n()};if(s.get("text-variable-anchor")){var F=s.get("text-variable-anchor");if(i.prevPlacement&&i.prevPlacement.variableOffsets[e.crossTileID]){var Z=i.prevPlacement.variableOffsets[e.crossTileID];F.indexOf(Z.anchor)>0&&(F=F.filter((function(t){return t!==Z.anchor}))).unshift(Z.anchor)}var j=function(t,n,r){for(var o=t.x2-t.x1,s=t.y2-t.y1,l=e.textBoxScale,c=w&&!_?n:null,f={box:[],offscreen:!1},p=y?2*F.length:F.length,d=0;d<p;++d){var v=i.attemptAnchorPlacement(F[d%F.length],t,o,s,l,b,x,h,u,g,d>=F.length,e,a,r,c);if(v&&(f=v.placedGlyphBoxes)&&f.box&&f.box.length){E=!0,k=v.shift;break}}return f};z((function(){return j(N,o.iconBox,t.WritingMode.horizontal)}),(function(){var n=o.verticalTextBox;return a.allowVerticalPlacement&&!(M&&M.box&&M.box.length)&&e.numVerticalGlyphVertices>0&&n?j(n,o.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),M&&(E=M.box,T=M.offscreen);var U=B(M&&M.box);if(!E&&i.prevPlacement){var G=i.prevPlacement.variableOffsets[e.crossTileID];G&&(i.variableOffsets[e.crossTileID]=G,i.markUsedJustification(a,G.anchor,e,U))}}else{var V=function(t,n){var r=i.collisionIndex.placeCollisionBox(t,y,h,u,g.predicate);return r&&r.box&&r.box.length&&(i.markUsedOrientation(a,n,e),i.placedOrientations[e.crossTileID]=n),r};z((function(){return V(N,t.WritingMode.horizontal)}),(function(){var n=o.verticalTextBox;return a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?V(n,t.WritingMode.vertical):{box:null,offscreen:null}})),B(M&&M.box&&M.box.length)}}if(E=(p=M)&&p.box&&p.box.length>0,T=p&&p.offscreen,e.useRuntimeCollisionCircles){var W=a.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),H=t.evaluateSizeForFeature(a.textSizeData,d,W),X=s.get("text-padding");I=i.collisionIndex.placeCollisionCircles(y,W,a.lineVertexArray,a.glyphOffsetArray,H,u,l,c,r,x,g.predicate,e.collisionCircleDiameter,X),E=y||I.circles.length>0&&!I.collisionDetected,T=T&&I.offscreen}if(o.iconFeatureIndex&&(D=o.iconFeatureIndex),o.iconBox){var Y=function(t){var e=w&&k?be(t,k.x,k.y,b,x,i.transform.angle):t;return i.collisionIndex.placeCollisionBox(e,_,h,u,g.predicate)};A=P&&P.box&&P.box.length&&o.verticalIconBox?(O=Y(o.verticalIconBox)).box.length>0:(O=Y(o.iconBox)).box.length>0,T=T&&O.offscreen}var q=v||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,K=m||0===e.numIconVertices;if(q||K?K?q||(A=A&&E):E=A&&E:A=E=A&&E,E&&p&&p.box&&i.collisionIndex.insertCollisionBox(p.box,s.get("text-ignore-placement"),a.bucketInstanceId,P&&P.box&&L?L:R,g.ID),A&&O&&i.collisionIndex.insertCollisionBox(O.box,s.get("icon-ignore-placement"),a.bucketInstanceId,D,g.ID),I&&(E&&i.collisionIndex.insertCollisionCircles(I.circles,s.get("text-ignore-placement"),a.bucketInstanceId,R,g.ID),r)){var Q=a.bucketInstanceId,J=i.collisionCircleArrays[Q];void 0===J&&(J=i.collisionCircleArrays[Q]=new ve);for(var $=0;$<I.circles.length;$+=4)J.circles.push(I.circles[$+0]),J.circles.push(I.circles[$+1]),J.circles.push(I.circles[$+2]),J.circles.push(I.collisionDetected?1:0)}i.placements[e.crossTileID]=new ge(E||S,A||C,T||a.justReloaded),n[e.crossTileID]=!0}};if(E)for(var T=a.getSortedSymbolIndexes(this.transform.angle),k=T.length-1;k>=0;--k){var M=T[k];A(a.symbolInstances.get(M),a.collisionArrays[M])}else for(var P=e.symbolInstanceStart;P<e.symbolInstanceEnd;P++)A(a.symbolInstances.get(P),a.collisionArrays[P]);if(r&&a.bucketInstanceId in this.collisionCircleArrays){var I=this.collisionCircleArrays[a.bucketInstanceId];t.invert(I.invProjMatrix,u),I.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1},xe.prototype.markUsedJustification=function(e,n,r,i){var o;o=i===t.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(n)];for(var a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];a<s.length;a+=1){var u=s[a];u>=0&&(e.text.placedSymbolArray.get(u).crossTileID=o>=0&&u!==o?0:r.crossTileID)}},xe.prototype.markUsedOrientation=function(e,n,r){for(var i=n===t.WritingMode.horizontal||n===t.WritingMode.horizontalOnly?n:0,o=n===t.WritingMode.vertical?n:0,a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];a<s.length;a+=1)e.text.placedSymbolArray.get(s[a]).placedOrientation=i;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)},xe.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,n=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var r=e?e.symbolFadeChange(t):1,i=e?e.opacities:{},o=e?e.variableOffsets:{},a=e?e.placedOrientations:{};for(var s in this.placements){var u=this.placements[s],l=i[s];l?(this.opacities[s]=new de(l,r,u.text,u.icon),n=n||u.text!==l.text.placed||u.icon!==l.icon.placed):(this.opacities[s]=new de(null,r,u.text,u.icon,u.skipFade),n=n||u.text||u.icon)}for(var c in i){var h=i[c];if(!this.opacities[c]){var f=new de(h,r,!1,!1);f.isHidden()||(this.opacities[c]=f,n=n||h.text.placed||h.icon.placed)}}for(var p in o)this.variableOffsets[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.variableOffsets[p]=o[p]);for(var d in a)this.placedOrientations[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.placedOrientations[d]=a[d]);n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},xe.prototype.updateLayerOpacities=function(t,e){for(var n={},r=0,i=e;r<i.length;r+=1){var o=i[r],a=o.getBucket(t);a&&o.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,n,o.collisionBoxArray)}},xe.prototype.updateBucketOpacities=function(e,n,r){var i=this;e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();var o=e.layers[0].layout,a=new de(null,0,!1,!1,!0),s=o.get("text-allow-overlap"),u=o.get("icon-allow-overlap"),l=o.get("text-variable-anchor"),c="map"===o.get("text-rotation-alignment"),h="map"===o.get("text-pitch-alignment"),f="none"!==o.get("icon-text-fit"),p=new de(null,0,s&&(u||!e.hasIconData()||o.get("icon-optional")),u&&(s||!e.hasTextData()||o.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);for(var d=function(t,e,n){for(var r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(n)},g=function(r){var o=e.symbolInstances.get(r),s=o.numHorizontalGlyphVertices,u=o.numVerticalGlyphVertices,g=o.crossTileID,v=i.opacities[g];n[g]?v=a:v||(i.opacities[g]=v=p),n[g]=!0;var m=o.numIconVertices>0,y=i.placedOrientations[o.crossTileID],_=y===t.WritingMode.vertical,b=y===t.WritingMode.horizontal||y===t.WritingMode.horizontalOnly;if(s>0||u>0){var x=Pe(v.text);d(e.text,s,_?Ie:x),d(e.text,u,b?Ie:x);var w=v.text.isHidden();[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=w||_?1:0)})),o.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).hidden=w||b?1:0);var E=i.variableOffsets[o.crossTileID];E&&i.markUsedJustification(e,E.anchor,o,y);var S=i.placedOrientations[o.crossTileID];S&&(i.markUsedJustification(e,"left",o,S),i.markUsedOrientation(e,S,o))}if(m){var C=Pe(v.icon),A=!(f&&o.verticalPlacedIconSymbolIndex&&_);o.placedIconSymbolIndex>=0&&(d(e.icon,o.numIconVertices,A?C:Ie),e.icon.placedSymbolArray.get(o.placedIconSymbolIndex).hidden=v.icon.isHidden()),o.verticalPlacedIconSymbolIndex>=0&&(d(e.icon,o.numVerticalIconVertices,A?Ie:C),e.icon.placedSymbolArray.get(o.verticalPlacedIconSymbolIndex).hidden=v.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){var T=e.collisionArrays[r];if(T){var k=new t.Point(0,0);if(T.textBox||T.verticalTextBox){var M=!0;if(l){var P=i.variableOffsets[g];P?(k=_e(P.anchor,P.width,P.height,P.textOffset,P.textBoxScale),c&&k._rotate(h?i.transform.angle:-i.transform.angle)):M=!1}T.textBox&&we(e.textCollisionBox.collisionVertexArray,v.text.placed,!M||_,k.x,k.y),T.verticalTextBox&&we(e.textCollisionBox.collisionVertexArray,v.text.placed,!M||b,k.x,k.y)}var I=Boolean(!b&&T.verticalIconBox);T.iconBox&&we(e.iconCollisionBox.collisionVertexArray,v.icon.placed,I,f?k.x:0,f?k.y:0),T.verticalIconBox&&we(e.iconCollisionBox.collisionVertexArray,v.icon.placed,!I,f?k.x:0,f?k.y:0)}}},v=0;v<e.symbolInstances.length;v++)g(v);if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){var m=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=m.invProjMatrix,e.placementViewportMatrix=m.viewportMatrix,e.collisionCircleArray=m.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}},xe.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},xe.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},xe.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},xe.prototype.stillRecent=function(t,e){var n=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*n>t},xe.prototype.setStale=function(){this.stale=!0};var Ee=Math.pow(2,25),Se=Math.pow(2,24),Ce=Math.pow(2,17),Ae=Math.pow(2,16),Te=Math.pow(2,9),ke=Math.pow(2,8),Me=Math.pow(2,1);function Pe(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*Ee+e*Se+n*Ce+e*Ae+n*Te+e*ke+n*Me+e}var Ie=0,Oe=function(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Oe.prototype.continuePlacement=function(t,e,n,r,i){for(var o=this._bucketParts;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((function(t,e){return t.sortKey-e.sortKey})));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,i())return!0;return!1};var Re=function(t,e,n,r,i,o,a){this.placement=new xe(t,i,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1};Re.prototype.isDone=function(){return this._done},Re.prototype.continuePlacement=function(e,n,r){for(var i=this,o=t.browser.now(),a=function(){var e=t.browser.now()-o;return!i._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=n[e[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=u)&&(!s.maxzoom||s.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new Oe(s)),this._inProgressLayer.continuePlacement(r[s.source],this.placement,this._showCollisionBoxes,s,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Re.prototype.commit=function(t){return this.placement.commit(t),this.placement};var Le=512/t.EXTENT/2,De=function(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(var r=0;r<e.length;r++){var i=e.get(r),o=i.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,t)})}};De.prototype.getScaledCoordinates=function(e,n){var r=Le/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*t.EXTENT+e.anchorX)*r),y:Math.floor((n.canonical.y*t.EXTENT+e.anchorY)*r)}},De.prototype.findMatches=function(t,e,n){for(var r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),i=0;i<t.length;i++){var o=t.get(i);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,e),u=0,l=a;u<l.length;u+=1){var c=l[u];if(Math.abs(c.coord.x-s.x)<=r&&Math.abs(c.coord.y-s.y)<=r&&!n[c.crossTileID]){n[c.crossTileID]=!0,o.crossTileID=c.crossTileID;break}}}}};var Ne=function(){this.maxCrossTileID=0};Ne.prototype.generate=function(){return++this.maxCrossTileID};var Be=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Be.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var n in this.indexes){var r=this.indexes[n],i={};for(var o in r){var a=r[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),i[a.tileID.key]=a}this.indexes[n]=i}this.lng=t},Be.prototype.addBucket=function(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var r=0;r<e.symbolInstances.length;r++)e.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var i=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>t.overscaledZ)for(var s in a){var u=a[s];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,i)}else{var l=a[t.scaledTo(Number(o)).key];l&&l.findMatches(e.symbolInstances,t,i)}}for(var c=0;c<e.symbolInstances.length;c++){var h=e.symbolInstances.get(c);h.crossTileID||(h.crossTileID=n.generate(),i[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new De(t,e.symbolInstances,e.bucketInstanceId),!0},Be.prototype.removeBucketCrossTileIDs=function(t,e){for(var n in e.indexedSymbolInstances)for(var r=0,i=e.indexedSymbolInstances[n];r<i.length;r+=1)delete this.usedCrossTileIDs[t][i[r].crossTileID]},Be.prototype.removeStaleBuckets=function(t){var e=!1;for(var n in this.indexes){var r=this.indexes[n];for(var i in r)t[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],e=!0)}return e};var ze=function(){this.layerIndexes={},this.crossTileIDs=new Ne,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ze.prototype.addLayer=function(t,e,n){var r=this.layerIndexes[t.id];void 0===r&&(r=this.layerIndexes[t.id]=new Be);var i=!1,o={};r.handleWrapJump(n);for(var a=0,s=e;a<s.length;a+=1){var u=s[a],l=u.getBucket(t);l&&t.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(u.tileID,l,this.crossTileIDs)&&(i=!0),o[l.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(i=!0),i},ze.prototype.pruneUnusedLayers=function(t){var e={};for(var n in t.forEach((function(t){e[t]=!0})),this.layerIndexes)e[n]||delete this.layerIndexes[n]};var Fe=function(e,n){return t.emitValidationErrors(e,n&&n.filter((function(t){return"source.canvas"!==t.identifier})))},Ze=t.pick(jt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),je=t.pick(jt,["setCenter","setZoom","setBearing","setPitch"]),Ue=function(){var e={},n=t.styleSpec.$version;for(var r in t.styleSpec.$root){var i,o=t.styleSpec.$root[r];o.required&&null!=(i="version"===r?n:"array"===o.type?[]:{})&&(e[r]=i)}return e}(),Ge=function(e){function n(r,i){var o=this;void 0===i&&(i={}),e.call(this),this.map=r,this.dispatcher=new S(zt(),this),this.imageManager=new f,this.imageManager.setEventedParent(this),this.glyphManager=new _(r._requestManager,i.localIdeographFontFamily),this.lineAtlas=new E(256,512),this.crossTileSymbolIndex=new ze,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var a=this;this._rtlTextPluginCallback=n.registerForPluginStateChange((function(e){a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(function(e,n){if(t.triggerPluginCompletionEvent(e),n&&n.every((function(t){return t})))for(var r in a.sourceCaches)a.sourceCaches[r].reload()}))})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var n=e.getSource();if(n&&n.vectorLayerIds)for(var r in o._layers){var i=o._layers[r];i.source===n.id&&o._validateLayer(i)}}}}))}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.loadURL=function(e,n){var r=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var i="boolean"==typeof n.validate?n.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken);var o=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(o,(function(e,n){r._request=null,e?r.fire(new t.ErrorEvent(e)):n&&r._load(n,i)}))},n.prototype.loadJSON=function(e,n){var r=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){r._request=null,r._load(e,!1!==n.validate)}))},n.prototype.loadEmpty=function(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ue,!1)},n.prototype._load=function(e,n){if(!n||!Fe(this,t.validateStyle(e))){for(var r in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(r,e.sources[r],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var i=Zt(this.stylesheet.layers);this._order=i.map((function(t){return t.id})),this._layers={},this._serializedLayers={};for(var o=0,a=i;o<a.length;o+=1){var s=a[o];(s=t.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},n.prototype._loadSprite=function(e){var n=this;this._spriteRequest=function(e,n,r){var i,o,a,s=t.browser.devicePixelRatio>1?"@2x":"",u=t.getJSON(n.transformRequest(n.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){u=null,a||(a=t,i=e,c())})),l=t.getImage(n.transformRequest(n.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){l=null,a||(a=t,o=e,c())}));function c(){if(a)r(a);else if(i&&o){var e=t.browser.getImageData(o),n={};for(var s in i){var u=i[s],l=u.width,c=u.height,h=u.x,f=u.y,p=u.sdf,d=u.pixelRatio,g=u.stretchX,v=u.stretchY,m=u.content,y=new t.RGBAImage({width:l,height:c});t.RGBAImage.copy(e,y,{x:h,y:f},{x:0,y:0},{width:l,height:c}),n[s]={data:y,pixelRatio:d,sdf:p,stretchX:g,stretchY:v,content:m}}r(null,n)}}return{cancel:function(){u&&(u.cancel(),u=null),l&&(l.cancel(),l=null)}}}(e,this.map._requestManager,(function(e,r){if(n._spriteRequest=null,e)n.fire(new t.ErrorEvent(e));else if(r)for(var i in r)n.imageManager.addImage(i,r[i]);n.imageManager.setLoaded(!0),n._availableImages=n.imageManager.listImages(),n.dispatcher.broadcast("setImages",n._availableImages),n.fire(new t.Event("data",{dataType:"style"}))}))},n.prototype._validateLayer=function(e){var n=this.sourceCaches[e.source];if(n){var r=e.sourceLayer;if(r){var i=n.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+r+'" does not exist on source "'+i.id+'" as specified by style layer "'+e.id+'"')))}}},n.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},n.prototype._serializeLayers=function(t){for(var e=[],n=0,r=t;n<r.length;n+=1){var i=this._layers[r[n]];"custom"!==i.type&&e.push(i.serialize())}return e},n.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},n.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},n.prototype.update=function(e){if(this._loaded){var n=this._changed;if(this._changed){var r=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var o in(r.length||i.length)&&this._updateWorkerLayers(r,i),this._updatedSources){var a=this._updatedSources[o];"reload"===a?this._reloadSource(o):"clear"===a&&this._clearSource(o)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}var u={};for(var l in this.sourceCaches){var c=this.sourceCaches[l];u[l]=c.used,c.used=!1}for(var h=0,f=this._order;h<f.length;h+=1){var p=this._layers[f[h]];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(var d in u){var g=this.sourceCaches[d];u[d]!==g.used&&g.fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.z=e.zoom,n&&this.fire(new t.Event("data",{dataType:"style"}))}},n.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}},n.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},n.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},n.prototype.setState=function(e){var n=this;if(this._checkLoaded(),Fe(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=Zt(e.layers);var r=function(e,n){if(!e)return[{command:jt.setStyle,args:[n]}];var r=[];try{if(!t.deepEqual(e.version,n.version))return[{command:jt.setStyle,args:[n]}];t.deepEqual(e.center,n.center)||r.push({command:jt.setCenter,args:[n.center]}),t.deepEqual(e.zoom,n.zoom)||r.push({command:jt.setZoom,args:[n.zoom]}),t.deepEqual(e.bearing,n.bearing)||r.push({command:jt.setBearing,args:[n.bearing]}),t.deepEqual(e.pitch,n.pitch)||r.push({command:jt.setPitch,args:[n.pitch]}),t.deepEqual(e.sprite,n.sprite)||r.push({command:jt.setSprite,args:[n.sprite]}),t.deepEqual(e.glyphs,n.glyphs)||r.push({command:jt.setGlyphs,args:[n.glyphs]}),t.deepEqual(e.transition,n.transition)||r.push({command:jt.setTransition,args:[n.transition]}),t.deepEqual(e.light,n.light)||r.push({command:jt.setLight,args:[n.light]});var i={},o=[];!function(e,n,r,i){var o;for(o in n=n||{},e=e||{})e.hasOwnProperty(o)&&(n.hasOwnProperty(o)||Gt(o,r,i));for(o in n)n.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t.deepEqual(e[o],n[o])||("geojson"===e[o].type&&"geojson"===n[o].type&&Wt(e,n,o)?r.push({command:jt.setGeoJSONSourceData,args:[o,n[o].data]}):Vt(o,n,r,i)):Ut(o,n,r))}(e.sources,n.sources,o,i);var a=[];e.layers&&e.layers.forEach((function(t){i[t.source]?r.push({command:jt.removeLayer,args:[t.id]}):a.push(t)})),r=r.concat(o),function(e,n,r){n=n||[];var i,o,a,s,u,l,c,h=(e=e||[]).map(Xt),f=n.map(Xt),p=e.reduce(Yt,{}),d=n.reduce(Yt,{}),g=h.slice(),v=Object.create(null);for(i=0,o=0;i<h.length;i++)d.hasOwnProperty(a=h[i])?o++:(r.push({command:jt.removeLayer,args:[a]}),g.splice(g.indexOf(a,o),1));for(i=0,o=0;i<f.length;i++)g[g.length-1-i]!==(a=f[f.length-1-i])&&(p.hasOwnProperty(a)?(r.push({command:jt.removeLayer,args:[a]}),g.splice(g.lastIndexOf(a,g.length-o),1)):o++,r.push({command:jt.addLayer,args:[d[a],l=g[g.length-i]]}),g.splice(g.length-i,0,a),v[a]=!0);for(i=0;i<f.length;i++)if(s=p[a=f[i]],u=d[a],!v[a]&&!t.deepEqual(s,u))if(t.deepEqual(s.source,u.source)&&t.deepEqual(s["source-layer"],u["source-layer"])&&t.deepEqual(s.type,u.type)){for(c in Ht(s.layout,u.layout,r,a,null,jt.setLayoutProperty),Ht(s.paint,u.paint,r,a,null,jt.setPaintProperty),t.deepEqual(s.filter,u.filter)||r.push({command:jt.setFilter,args:[a,u.filter]}),t.deepEqual(s.minzoom,u.minzoom)&&t.deepEqual(s.maxzoom,u.maxzoom)||r.push({command:jt.setLayerZoomRange,args:[a,u.minzoom,u.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Ht(s[c],u[c],r,a,c.slice(6),jt.setPaintProperty):t.deepEqual(s[c],u[c])||r.push({command:jt.setLayerProperty,args:[a,c,u[c]]}));for(c in u)u.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Ht(s[c],u[c],r,a,c.slice(6),jt.setPaintProperty):t.deepEqual(s[c],u[c])||r.push({command:jt.setLayerProperty,args:[a,c,u[c]]}))}else r.push({command:jt.removeLayer,args:[a]}),l=g[g.lastIndexOf(a)+1],r.push({command:jt.addLayer,args:[u,l]})}(a,n.layers,r)}catch(t){console.warn("Unable to compute style diff:",t),r=[{command:jt.setStyle,args:[n]}]}return r}(this.serialize(),e).filter((function(t){return!(t.command in je)}));if(0===r.length)return!1;var i=r.filter((function(t){return!(t.command in Ze)}));if(i.length>0)throw new Error("Unimplemented: "+i.map((function(t){return t.command})).join(", ")+".");return r.forEach((function(t){"setTransition"!==t.command&&n[t.command].apply(n,t.args)})),this.stylesheet=e,!0},n.prototype.addImage=function(e,n){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,n),this._afterImageUpdated(e)},n.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},n.prototype.getImage=function(t){return this.imageManager.getImage(t)},n.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)},n.prototype._afterImageUpdated=function(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))},n.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},n.prototype.addSource=function(e,n,r){var i=this;if(void 0===r&&(r={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(n).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,n,null,r))){this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);var o=this.sourceCaches[e]=new Pt(e,n,this.dispatcher);o.style=this,o.setEventedParent(this,(function(){return{isSourceLoaded:i.loaded(),source:o.serialize(),sourceId:e}})),o.onAdd(this.map),this._changed=!0}},n.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var n in this._layers)if(this._layers[n].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+n+'" is using it.')));var r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.clearTiles(),r.onRemove&&r.onRemove(this.map),this._changed=!0},n.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},n.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},n.prototype.addLayer=function(e,n,r){void 0===r&&(r={}),this._checkLoaded();var i=e.id;if(this.getLayer(i))this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" already exists on this map')));else{var o;if("custom"===e.type){if(Fe(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=t.clone$1(e),e=t.extend(e,{source:i})),this._validate(t.validateStyle.layer,"layers."+i,e,{arrayIndex:-1},r))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[o.id]=o.serialize()}var a=n?this._order.indexOf(n):this._order.length;if(n&&-1===a)this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.')));else{if(this._order.splice(a,0,i),this._layerOrderChanged=!0,this._layers[i]=o,this._removedLayers[i]&&o.source&&"custom"!==o.type){var s=this._removedLayers[i];delete this._removedLayers[i],s.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}},n.prototype.moveLayer=function(e,n){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==n){var r=this._order.indexOf(e);this._order.splice(r,1);var i=n?this._order.indexOf(n):this._order.length;n&&-1===i?this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.'))):(this._order.splice(i,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},n.prototype.removeLayer=function(e){this._checkLoaded();var n=this._layers[e];if(n){n.setEventedParent(null);var r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},n.prototype.getLayer=function(t){return this._layers[t]},n.prototype.hasLayer=function(t){return t in this._layers},n.prototype.setLayerZoomRange=function(e,n,r){this._checkLoaded();var i=this.getLayer(e);i?i.minzoom===n&&i.maxzoom===r||(null!=n&&(i.minzoom=n),null!=r&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},n.prototype.setFilter=function(e,n,r){void 0===r&&(r={}),this._checkLoaded();var i=this.getLayer(e);if(i){if(!t.deepEqual(i.filter,n))return null==n?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(t.validateStyle.filter,"layers."+i.id+".filter",n,null,r)||(i.filter=t.clone$1(n),this._updateLayer(i)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},n.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},n.prototype.setLayoutProperty=function(e,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getLayoutProperty(n),r)||(o.setLayoutProperty(n,r,i),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getLayoutProperty=function(e,n){var r=this.getLayer(e);if(r)return r.getLayoutProperty(n);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},n.prototype.setPaintProperty=function(e,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getPaintProperty(n),r)||(o.setPaintProperty(n,r,i)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},n.prototype.setFeatureState=function(e,n){this._checkLoaded();var r=e.source,i=e.sourceLayer,o=this.sourceCaches[r];if(void 0!==o){var a=o.getSource().type;"geojson"===a&&i?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==a||i?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),o.setFeatureState(i,e.id,n)):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.removeFeatureState=function(e,n){this._checkLoaded();var r=e.source,i=this.sourceCaches[r];if(void 0!==i){var o=i.getSource().type,a="vector"===o?e.sourceLayer:void 0;"vector"!==o||a?n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):i.removeFeatureState(a,e.id,n):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.getFeatureState=function(e){this._checkLoaded();var n=e.source,r=e.sourceLayer,i=this.sourceCaches[n];if(void 0!==i){if("vector"!==i.getSource().type||r)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),i.getFeatureState(r,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},n.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},n.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},n.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},n.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,n=function(t){return"fill-extrusion"===e._layers[t].type},r={},i=[],o=this._order.length-1;o>=0;o--){var a=this._order[o];if(n(a)){r[a]=o;for(var s=0,u=t;s<u.length;s+=1){var l=u[s][a];if(l)for(var c=0,h=l;c<h.length;c+=1)i.push(h[c])}}}i.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var f=[],p=this._order.length-1;p>=0;p--){var d=this._order[p];if(n(d))for(var g=i.length-1;g>=0;g--){var v=i[g].feature;if(r[v.layer.id]<p)break;f.push(v),i.pop()}else for(var m=0,y=t;m<y.length;m+=1){var _=y[m][d];if(_)for(var b=0,x=_;b<x.length;b+=1)f.push(x[b].feature)}}return f},n.prototype.queryRenderedFeatures=function(e,n,r){n&&n.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);var i={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var o=0,a=n.layers;o<a.length;o+=1){var s=a[o],u=this._layers[s];if(!u)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];i[u.source]=!0}}var l=[];for(var c in n.availableImages=this._availableImages,this.sourceCaches)n.layers&&!i[c]||l.push(B(this.sourceCaches[c],this._layers,this._serializedLayers,e,n,r));return this.placement&&l.push(function(t,e,n,r,i,o,a){for(var s={},u=o.queryRenderedSymbols(r),l=[],c=0,h=Object.keys(u).map(Number);c<h.length;c+=1)l.push(a[h[c]]);l.sort(z);for(var f=function(){var n=d[p],r=n.featureIndex.lookupSymbolFeatures(u[n.bucketInstanceId],e,n.bucketIndex,n.sourceLayerIndex,i.filter,i.layers,i.availableImages,t);for(var o in r){var a=s[o]=s[o]||[],l=r[o];l.sort((function(t,e){var r=n.featureSortOrder;if(r){var i=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(var c=0,h=l;c<h.length;c+=1)a.push(h[c])}},p=0,d=l;p<d.length;p+=1)f();var g=function(e){s[e].forEach((function(r){var i=r.feature,o=n[t[e].source].getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o}))};for(var v in s)g(v);return s}(this._layers,this._serializedLayers,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)},n.prototype.querySourceFeatures=function(e,n){n&&n.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);var r=this.sourceCaches[e];return r?function(t,e){for(var n=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),r=[],i={},o=0;o<n.length;o++){var a=n[o],s=a.tileID.canonical.key;i[s]||(i[s]=!0,a.querySourceFeatures(r,e))}return r}(r,n):[]},n.prototype.addSourceType=function(t,e,r){return n.getSourceType(t)?r(new Error('A source type called "'+t+'" already exists.')):(n.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},r):r(null,null))},n.prototype.getLight=function(){return this.light.getLight()},n.prototype.setLight=function(e,n){void 0===n&&(n={}),this._checkLoaded();var r=this.light.getLight(),i=!1;for(var o in e)if(!t.deepEqual(e[o],r[o])){i=!0;break}if(i){var a={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(a)}},n.prototype._validate=function(e,n,r,i,o){return void 0===o&&(o={}),(!o||!1!==o.validate)&&Fe(this,e.call(t.validateStyle,t.extend({key:n,style:this.serialize(),value:r,styleSpec:t.styleSpec},i)))},n.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[e].setEventedParent(null);for(var n in this.sourceCaches)this.sourceCaches[n].clearTiles(),this.sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},n.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},n.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},n.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},n.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},n.prototype._updatePlacement=function(e,n,r,i,o){void 0===o&&(o=!1);for(var a=!1,s=!1,u={},l=0,c=this._order;l<c.length;l+=1){var h=this._layers[c[l]];if("symbol"===h.type){if(!u[h.source]){var f=this.sourceCaches[h.source];u[h.source]=f.getRenderableIds(!0).map((function(t){return f.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}))}var p=this.crossTileSymbolIndex.addLayer(h,u[h.source],e.center.lng);a=a||p}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((o=o||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Re(e,this._order,o,n,r,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,u),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(var d=0,g=this._order;d<g.length;d+=1){var v=this._layers[g[d]];"symbol"===v.type&&this.placement.updateLayerOpacities(v,u[v.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},n.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},n.prototype.getImages=function(t,e,n){this.imageManager.getImages(e.icons,n),this._updateTilesForChangedImages();var r=this.sourceCaches[e.source];r&&r.setDependencies(e.tileID.key,e.type,e.icons)},n.prototype.getGlyphs=function(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)},n.prototype.getResource=function(e,n,r){return t.makeRequest(n,r)},n}(t.Evented);Ge.getSourceType=function(t){return D[t]},Ge.setSourceType=function(t,e){D[t]=e},Ge.registerForPluginStateChange=t.registerForPluginStateChange;var Ve=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),We=yn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),He=yn("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Xe=yn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ye=yn("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),qe=yn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ke=yn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),Qe=yn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Je=yn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),$e=yn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),tn=yn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),en=yn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),nn=yn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),rn=yn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),on=yn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),an=yn("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),sn=yn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),un=yn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ln=yn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),cn=yn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),hn=yn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),fn=yn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),pn=yn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),dn=yn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),gn=yn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),vn=yn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),mn=yn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function yn(t,e){var n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=e.match(/attribute ([\w]+) ([\w]+)/g),i=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=o?o.concat(i):i,s={};return{fragmentSource:t=t.replace(n,(function(t,e,n,r,i){return s[i]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nvarying "+n+" "+r+" "+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n"})),vertexSource:e=e.replace(n,(function(t,e,n,r,i){var o="float"===r?"vec2":"vec4",a=i.match(/color/)?"color":o;return s[i]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+n+" "+o+" a_"+i+";\nvarying "+n+" "+r+" "+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = a_"+i+";\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+n+" "+o+" a_"+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = a_"+i+";\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n"})),staticAttributes:r,staticUniforms:a}}var _n=Object.freeze({__proto__:null,prelude:We,background:He,backgroundPattern:Xe,circle:Ye,clippingMask:qe,heatmap:Ke,heatmapTexture:Qe,collisionBox:Je,collisionCircle:$e,debug:tn,fill:en,fillOutline:nn,fillOutlinePattern:rn,fillPattern:on,fillExtrusion:an,fillExtrusionPattern:sn,hillshadePrepare:un,hillshade:ln,line:cn,lineGradient:hn,linePattern:fn,lineSDF:pn,raster:dn,symbolIcon:gn,symbolSDF:vn,symbolTextAndIcon:mn}),bn=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function xn(t){for(var e=[],n=0;n<t.length;n++)if(null!==t[n]){var r=t[n].split(" ");e.push(r.pop())}return e}bn.prototype.bind=function(t,e,n,r,i,o,a,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==r.length,l=0;!u&&l<r.length;l++)this.boundPaintVertexBuffers[l]!==r[l]&&(u=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===n&&!u&&this.boundIndexBuffer===i&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===a&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind()):this.freshBind(e,n,r,i,o,a,s)},bn.prototype.freshBind=function(t,e,n,r,i,o,a){var s,u=t.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=l.currentNumAttributes||0;for(var h=u;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var f=0,p=n;f<p.length;f+=1)p[f].enableAttributes(c,t);o&&o.enableAttributes(c,t),a&&a.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,i);for(var d=0,g=n;d<g.length;d+=1){var v=g[d];v.bind(),v.setVertexAttribPointers(c,t,i)}o&&(o.bind(),o.setVertexAttribPointers(c,t,i)),r&&r.bind(),a&&(a.bind(),a.setVertexAttribPointers(c,t,i)),l.currentNumAttributes=u},bn.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var wn=function(t,e,n,r,i,o){var a=t.gl;this.program=a.createProgram();for(var s=xn(n.staticAttributes),u=r?r.getBinderAttributes():[],l=s.concat(u),c=n.staticUniforms?xn(n.staticUniforms):[],h=r?r.getBinderUniforms():[],f=[],p=0,d=c.concat(h);p<d.length;p+=1){var g=d[p];f.indexOf(g)<0&&f.push(g)}var v=r?r.defines():[];o&&v.push("#define OVERDRAW_INSPECTOR;");var m=v.concat(We.fragmentSource,n.fragmentSource).join("\n"),y=v.concat(We.vertexSource,n.vertexSource).join("\n"),_=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(_,m),a.compileShader(_),a.attachShader(this.program,_);var b=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(b,y),a.compileShader(b),a.attachShader(this.program,b),this.attributes={};var x={};this.numAttributes=l.length;for(var w=0;w<this.numAttributes;w++)l[w]&&(a.bindAttribLocation(this.program,w,l[w]),this.attributes[l[w]]=w);a.linkProgram(this.program),a.deleteShader(b),a.deleteShader(_);for(var E=0;E<f.length;E++){var S=f[E];if(S&&!x[S]){var C=a.getUniformLocation(this.program,S);C&&(x[S]=C)}}this.fixedUniforms=i(t,x),this.binderUniforms=r?r.getUniforms(t,x):[]}}};function En(t,e,n){var r=1/fe(n,1,e.transform.tileZoom),i=Math.pow(2,n.tileID.overscaledZ),o=n.tileSize*Math.pow(2,e.transform.tileZoom)/i,a=o*(n.tileID.canonical.x+n.tileID.wrap*i),s=o*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[a>>16,s>>16],u_pixel_coord_lower:[65535&a,65535&s]}}wn.prototype.draw=function(t,e,n,r,i,o,a,s,u,l,c,h,f,p,d,g){var v,m=t.gl;if(!this.failedToCreate){for(var y in t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(r),t.setColorMode(i),t.setCullFace(o),this.fixedUniforms)this.fixedUniforms[y].set(a[y]);p&&p.setUniforms(t,this.binderUniforms,h,{zoom:f});for(var _=(v={},v[m.LINES]=2,v[m.TRIANGLES]=3,v[m.LINE_STRIP]=1,v)[e],b=0,x=c.get();b<x.length;b+=1){var w=x[b],E=w.vaos||(w.vaos={});(E[s]||(E[s]=new bn)).bind(t,this,u,p?p.getPaintVertexBuffers():[],l,w.vertexOffset,d,g),m.drawElements(e,w.primitiveLength*_,m.UNSIGNED_SHORT,w.primitiveOffset*_*2)}}};var Sn=function(e,n,r,i){var o=n.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],u=t.create$1();"viewport"===o.properties.get("anchor")&&t.fromRotation(u,-n.transform.angle),t.transformMat3(s,s,u);var l=o.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+r,u_opacity:i}},Cn=function(e,n,r,i,o,a,s){return t.extend(Sn(e,n,r,i),En(a,n,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8})},An=function(t){return{u_matrix:t}},Tn=function(e,n,r,i){return t.extend(An(e),En(r,n,i))},kn=function(t,e){return{u_matrix:t,u_world:e}},Mn=function(e,n,r,i,o){return t.extend(Tn(e,n,r,i),{u_world:o})},Pn=function(e,n,r,i){var o,a,s=e.transform;if("map"===i.paint.get("circle-pitch-alignment")){var u=fe(r,1,s.zoom);o=!0,a=[u,u]}else o=!1,a=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(n.posMatrix,r,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:a}},In=function(t,e,n){var r=fe(n,1,e.zoom),i=Math.pow(2,e.zoom-n.tileID.overscaledZ),o=n.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:r,u_extrude_scale:[e.pixelsToGLUnits[0]/(r*i),e.pixelsToGLUnits[1]/(r*i)],u_overscale_factor:o}},On=function(t,e,n){return{u_matrix:t,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}},Rn=function(t,e,n){return void 0===n&&(n=1),{u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}},Ln=function(t){return{u_matrix:t}},Dn=function(t,e,n,r){return{u_matrix:t,u_extrude_scale:fe(e,1,n),u_intensity:r}},Nn=function(e,n,r){var i=e.transform;return{u_matrix:jn(e,n,r),u_ratio:1/fe(n,1,i.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},Bn=function(e,n,r,i){return t.extend(Nn(e,n,r),{u_image:0,u_image_height:i})},zn=function(e,n,r,i){var o=e.transform,a=Zn(n,o);return{u_matrix:jn(e,n,r),u_texsize:n.imageAtlasTexture.size,u_ratio:1/fe(n,1,o.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[a,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Fn=function(e,n,r,i,o){var a=e.lineAtlas,s=Zn(n,e.transform),u="round"===r.layout.get("line-cap"),l=a.getDash(i.from,u),c=a.getDash(i.to,u),h=l.width*o.fromScale,f=c.width*o.toScale;return t.extend(Nn(e,n,r),{u_patternscale_a:[s/h,-l.height/2],u_patternscale_b:[s/f,-c.height/2],u_sdfgamma:a.width/(256*Math.min(h,f)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:l.y,u_tex_y_b:c.y,u_mix:o.t})};function Zn(t,e){return 1/fe(t,1,e.tileZoom)}function jn(t,e,n){return t.translatePosMatrix(e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}var Un=function(t,e,n,r,i){return{u_matrix:t,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=i.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Gn(i.paint.get("raster-hue-rotate"))};var o,a};function Gn(t){t*=Math.PI/180;var e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}var Vn,Wn=function(t,e,n,r,i,o,a,s,u,l){var c=i.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:c.width/c.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+r,u_texsize:l,u_texture:0}},Hn=function(e,n,r,i,o,a,s,u,l,c,h){var f=o.transform;return t.extend(Wn(e,n,r,i,o,a,s,u,l,c),{u_gamma_scale:i?Math.cos(f._pitch)*f.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},Xn=function(e,n,r,i,o,a,s,u,l,c){return t.extend(Hn(e,n,r,i,o,a,s,u,!0,l,!0),{u_texsize_icon:c,u_texture_icon:1})},Yn=function(t,e,n){return{u_matrix:t,u_opacity:e,u_color:n}},qn=function(e,n,r,i,o,a){return t.extend(function(t,e,n,r){var i=n.imageManager.getPattern(t.from.toString()),o=n.imageManager.getPattern(t.to.toString()),a=n.imageManager.getPixelSize(),s=a.width,u=a.height,l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,n.transform.tileZoom)/l,h=c*(r.tileID.canonical.x+r.tileID.wrap*l),f=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,u],u_mix:e.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/fe(r,1,n.transform.tileZoom),u_pixel_coord_upper:[h>>16,f>>16],u_pixel_coord_lower:[65535&h,65535&f]}}(i,a,r,o),{u_matrix:e,u_opacity:n})},Kn={fillExtrusion:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fillExtrusionPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,n.u_height_factor),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fill:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},fillPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},fillOutline:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world)}},fillOutlinePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},circle:function(e,n){return{u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,n.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},collisionBox:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,n.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,n.u_overscale_factor)}},collisionCircle:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,n.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,n.u_viewport_size)}},debug:function(e,n){return{u_color:new t.UniformColor(e,n.u_color),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_overlay:new t.Uniform1i(e,n.u_overlay),u_overlay_scale:new t.Uniform1f(e,n.u_overlay_scale)}},clippingMask:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmap:function(e,n){return{u_extrude_scale:new t.Uniform1f(e,n.u_extrude_scale),u_intensity:new t.Uniform1f(e,n.u_intensity),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmapTexture:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_opacity:new t.Uniform1f(e,n.u_opacity)}},hillshade:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_latrange:new t.Uniform2f(e,n.u_latrange),u_light:new t.Uniform2f(e,n.u_light),u_shadow:new t.UniformColor(e,n.u_shadow),u_highlight:new t.UniformColor(e,n.u_highlight),u_accent:new t.UniformColor(e,n.u_accent)}},hillshadePrepare:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_dimension:new t.Uniform2f(e,n.u_dimension),u_zoom:new t.Uniform1f(e,n.u_zoom),u_unpack:new t.Uniform4f(e,n.u_unpack)}},line:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels)}},lineGradient:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_image:new t.Uniform1i(e,n.u_image),u_image_height:new t.Uniform1f(e,n.u_image_height)}},linePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_image:new t.Uniform1i(e,n.u_image),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},lineSDF:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,n.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,n.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,n.u_sdfgamma),u_image:new t.Uniform1i(e,n.u_image),u_tex_y_a:new t.Uniform1f(e,n.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,n.u_tex_y_b),u_mix:new t.Uniform1f(e,n.u_mix)}},raster:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_tl_parent:new t.Uniform2f(e,n.u_tl_parent),u_scale_parent:new t.Uniform1f(e,n.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,n.u_buffer_scale),u_fade_t:new t.Uniform1f(e,n.u_fade_t),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image0:new t.Uniform1i(e,n.u_image0),u_image1:new t.Uniform1i(e,n.u_image1),u_brightness_low:new t.Uniform1f(e,n.u_brightness_low),u_brightness_high:new t.Uniform1f(e,n.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,n.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,n.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,n.u_spin_weights)}},symbolIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture)}},symbolSDF:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}},symbolTextAndIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texsize_icon:new t.Uniform2f(e,n.u_texsize_icon),u_texture:new t.Uniform1i(e,n.u_texture),u_texture_icon:new t.Uniform1i(e,n.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}},background:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_color:new t.UniformColor(e,n.u_color)}},backgroundPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image:new t.Uniform1i(e,n.u_image),u_pattern_tl_a:new t.Uniform2f(e,n.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,n.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,n.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,n.u_pattern_br_b),u_texsize:new t.Uniform2f(e,n.u_texsize),u_mix:new t.Uniform1f(e,n.u_mix),u_pattern_size_a:new t.Uniform2f(e,n.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,n.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,n.u_scale_a),u_scale_b:new t.Uniform1f(e,n.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,n.u_tile_units_to_pixels)}}};function Qn(e,n,r,i,o,a,s){for(var u=e.context,l=u.gl,c=e.useProgram("collisionBox"),h=[],f=0,p=0,d=0;d<i.length;d++){var g=i[d],v=n.getTile(g),m=v.getBucket(r);if(m){var y=g.posMatrix;0===o[0]&&0===o[1]||(y=e.translatePosMatrix(g.posMatrix,v,o,a));var _=s?m.textCollisionBox:m.iconCollisionBox,b=m.collisionCircleArray;if(b.length>0){var x=t.create(),w=y;t.mul(x,m.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(x,x,m.placementViewportMatrix),h.push({circleArray:b,circleOffset:p,transform:w,invTransform:x}),p=f+=b.length/4}_&&c.draw(u,l.LINES,Ct.disabled,At.disabled,e.colorModeForRenderPass(),kt.disabled,In(y,e.transform,v),r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,e.transform.zoom,null,null,_.collisionVertexBuffer)}}if(s&&h.length){var E=e.useProgram("collisionCircle"),S=new t.StructArrayLayout2f1f2i16;S.resize(4*f),S._trim();for(var C=0,A=0,T=h;A<T.length;A+=1)for(var k=T[A],M=0;M<k.circleArray.length/4;M++){var P=4*M,I=k.circleArray[P+0],O=k.circleArray[P+1],R=k.circleArray[P+2],L=k.circleArray[P+3];S.emplace(C++,I,O,R,L,0),S.emplace(C++,I,O,R,L,1),S.emplace(C++,I,O,R,L,2),S.emplace(C++,I,O,R,L,3)}(!Vn||Vn.length<2*f)&&(Vn=function(e){var n=2*e,r=new t.StructArrayLayout3ui6;r.resize(n),r._trim();for(var i=0;i<n;i++){var o=6*i;r.uint16[o+0]=4*i+0,r.uint16[o+1]=4*i+1,r.uint16[o+2]=4*i+2,r.uint16[o+3]=4*i+2,r.uint16[o+4]=4*i+3,r.uint16[o+5]=4*i+0}return r}(f));for(var D=u.createIndexBuffer(Vn,!0),N=u.createVertexBuffer(S,t.collisionCircleLayout.members,!0),B=0,z=h;B<z.length;B+=1){var F=z[B],Z=On(F.transform,F.invTransform,e.transform);E.draw(u,l.TRIANGLES,Ct.disabled,At.disabled,e.colorModeForRenderPass(),kt.disabled,Z,r.id,N,D,t.SegmentVector.simpleSegment(0,2*F.circleOffset,F.circleArray.length,F.circleArray.length/2),null,e.transform.zoom,null,null,null)}N.destroy(),D.destroy()}}var Jn=t.identity(new Float32Array(16));function $n(e,n,r,i,o,a){var s=t.getAnchorAlignment(e),u=-(s.horizontalAlign-.5)*n,l=-(s.verticalAlign-.5)*r,c=t.evaluateVariableOffset(e,i);return new t.Point((u/o+c[0])*a,(l/o+c[1])*a)}function tr(e,n,r,i,o,a,s,u,l,c,h){var f=e.text.placedSymbolArray,p=e.text.dynamicLayoutVertexArray,d=e.icon.dynamicLayoutVertexArray,g={};p.clear();for(var v=0;v<f.length;v++){var m=f.get(v),y=m.hidden||!m.crossTileID||e.allowVerticalPlacement&&!m.placedOrientation?null:i[m.crossTileID];if(y){var _=new t.Point(m.anchorX,m.anchorY),b=$t(_,r?u:s),x=te(a.cameraToCenterDistance,b.signedDistanceFromCamera),w=o.evaluateSizeForFeature(e.textSizeData,c,m)*x/t.ONE_EM;r&&(w*=e.tilePixelRatio/l);for(var E=$n(y.anchor,y.width,y.height,y.textOffset,y.textBoxScale,w),S=r?$t(_.add(E),s).point:b.point.add(n?E.rotate(-a.angle):E),C=e.allowVerticalPlacement&&m.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,A=0;A<m.numGlyphs;A++)t.addDynamicAttributes(p,S,C);h&&m.associatedIconIndex>=0&&(g[m.associatedIconIndex]={shiftedAnchor:S,angle:C})}else le(m.numGlyphs,p)}if(h){d.clear();for(var T=e.icon.placedSymbolArray,k=0;k<T.length;k++){var M=T.get(k);if(M.hidden)le(M.numGlyphs,d);else{var P=g[k];if(P)for(var I=0;I<M.numGlyphs;I++)t.addDynamicAttributes(d,P.shiftedAnchor,P.angle);else le(M.numGlyphs,d)}}e.icon.dynamicLayoutVertexBuffer.updateData(d)}e.text.dynamicLayoutVertexBuffer.updateData(p)}function er(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function nr(e,n,r,i,o,a,s,u,l,c,h,f){for(var p=e.context,d=p.gl,g=e.transform,v="map"===u,m="map"===l,y=v&&"point"!==r.layout.get("symbol-placement"),_=v&&!m&&!y,b=void 0!==r.layout.get("symbol-sort-key").constantOr(1),x=!1,w=e.depthModeForSublayer(0,Ct.ReadOnly),E=r.layout.get("text-variable-anchor"),S=[],C=0,A=i;C<A.length;C+=1){var T=A[C],k=n.getTile(T),M=k.getBucket(r);if(M){var P=o?M.text:M.icon;if(P&&P.segments.get().length){var I=P.programConfigurations.get(r.id),O=o||M.sdfIcons,R=o?M.textSizeData:M.iconSizeData,L=m||0!==g.pitch,D=e.useProgram(er(O,o,M),I),N=t.evaluateSizeForZoom(R,g.zoom),B=void 0,z=[0,0],F=void 0,Z=void 0,j=null,U=void 0;if(o)F=k.glyphAtlasTexture,Z=d.LINEAR,B=k.glyphAtlasTexture.size,M.iconsInText&&(z=k.imageAtlasTexture.size,j=k.imageAtlasTexture,U=L||e.options.rotating||e.options.zooming||"composite"===R.kind||"camera"===R.kind?d.LINEAR:d.NEAREST);else{var G=1!==r.layout.get("icon-size").constantOr(0)||M.iconsNeedLinear;F=k.imageAtlasTexture,Z=O||e.options.rotating||e.options.zooming||G||L?d.LINEAR:d.NEAREST,B=k.imageAtlasTexture.size}var V=fe(k,1,e.transform.zoom),W=Qt(T.posMatrix,m,v,e.transform,V),H=Jt(T.posMatrix,m,v,e.transform,V),X=E&&M.hasTextData(),Y="none"!==r.layout.get("icon-text-fit")&&X&&M.hasIconData();y&&ne(M,T.posMatrix,e,o,W,H,m,c);var q=e.translatePosMatrix(T.posMatrix,k,a,s),K=y||o&&E||Y?Jn:W,Q=e.translatePosMatrix(H,k,a,s,!0),J=O&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),$={program:D,buffers:P,uniformValues:O?M.iconsInText?Xn(R.kind,N,_,m,e,q,K,Q,B,z):Hn(R.kind,N,_,m,e,q,K,Q,o,B,!0):Wn(R.kind,N,_,m,e,q,K,Q,o,B),atlasTexture:F,atlasTextureIcon:j,atlasInterpolation:Z,atlasInterpolationIcon:U,isSDF:O,hasHalo:J};if(b&&M.canOverlap){x=!0;for(var tt=0,et=P.segments.get();tt<et.length;tt+=1){var nt=et[tt];S.push({segments:new t.SegmentVector([nt]),sortKey:nt.sortKey,state:$})}}else S.push({segments:P.segments,sortKey:0,state:$})}}}x&&S.sort((function(t,e){return t.sortKey-e.sortKey}));for(var rt=0,it=S;rt<it.length;rt+=1){var ot=it[rt],at=ot.state;if(p.activeTexture.set(d.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,d.CLAMP_TO_EDGE),at.atlasTextureIcon&&(p.activeTexture.set(d.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,d.CLAMP_TO_EDGE)),at.isSDF){var st=at.uniformValues;at.hasHalo&&(st.u_is_halo=1,rr(at.buffers,ot.segments,r,e,at.program,w,h,f,st)),st.u_is_halo=0}rr(at.buffers,ot.segments,r,e,at.program,w,h,f,at.uniformValues)}}function rr(t,e,n,r,i,o,a,s,u){var l=r.context;i.draw(l,l.gl.TRIANGLES,o,a,s,kt.disabled,u,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,r.transform.zoom,t.programConfigurations.get(n.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function ir(t,e,n,r,i,o,a){var s,u,l,c,h,f=t.context.gl,p=n.paint.get("fill-pattern"),d=p&&p.constantOr(1),g=n.getCrossfadeParameters();a?(u=d&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=f.LINES):(u=d?"fillPattern":"fill",s=f.TRIANGLES);for(var v=0,m=r;v<m.length;v+=1){var y=m[v],_=e.getTile(y);if(!d||_.patternsLoaded()){var b=_.getBucket(n);if(b){var x=b.programConfigurations.get(n.id),w=t.useProgram(u,x);d&&(t.context.activeTexture.set(f.TEXTURE0),_.imageAtlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),x.updatePaintBuffers(g));var E=p.constantOr(null);if(E&&_.imageAtlas){var S=_.imageAtlas,C=S.patternPositions[E.to.toString()],A=S.patternPositions[E.from.toString()];C&&A&&x.setConstantPatternPositions(C,A)}var T=t.translatePosMatrix(y.posMatrix,_,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(a){c=b.indexBuffer2,h=b.segments2;var k=[f.drawingBufferWidth,f.drawingBufferHeight];l="fillOutlinePattern"===u&&d?Mn(T,t,g,_,k):kn(T,k)}else c=b.indexBuffer,h=b.segments,l=d?Tn(T,t,g,_):An(T);w.draw(t.context,s,i,t.stencilModeForClipping(y),o,kt.disabled,l,n.id,b.layoutVertexBuffer,c,h,n.paint,t.transform.zoom,x)}}}}function or(t,e,n,r,i,o,a){for(var s=t.context,u=s.gl,l=n.paint.get("fill-extrusion-pattern"),c=l.constantOr(1),h=n.getCrossfadeParameters(),f=n.paint.get("fill-extrusion-opacity"),p=0,d=r;p<d.length;p+=1){var g=d[p],v=e.getTile(g),m=v.getBucket(n);if(m){var y=m.programConfigurations.get(n.id),_=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",y);c&&(t.context.activeTexture.set(u.TEXTURE0),v.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),y.updatePaintBuffers(h));var b=l.constantOr(null);if(b&&v.imageAtlas){var x=v.imageAtlas,w=x.patternPositions[b.to.toString()],E=x.patternPositions[b.from.toString()];w&&E&&y.setConstantPatternPositions(w,E)}var S=t.translatePosMatrix(g.posMatrix,v,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),C=n.paint.get("fill-extrusion-vertical-gradient"),A=c?Cn(S,t,C,f,g,h,v):Sn(S,t,C,f);_.draw(s,s.gl.TRIANGLES,i,o,a,kt.backCCW,A,n.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,n.paint,t.transform.zoom,y)}}}function ar(e,n,r,i,o,a){var s=e.context,u=s.gl,l=n.fbo;if(l){var c=e.useProgram("hillshade");s.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,l.colorAttachment.get());var h=function(e,n,r){var i=r.paint.get("hillshade-shadow-color"),o=r.paint.get("hillshade-highlight-color"),a=r.paint.get("hillshade-accent-color"),s=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var u,l,c,h=!e.options.moving;return{u_matrix:e.transform.calculatePosMatrix(n.tileID.toUnwrapped(),h),u_image:0,u_latrange:(u=n.tileID,l=Math.pow(2,u.canonical.z),c=u.canonical.y,[new t.MercatorCoordinate(0,c/l).toLngLat().lat,new t.MercatorCoordinate(0,(c+1)/l).toLngLat().lat]),u_light:[r.paint.get("hillshade-exaggeration"),s],u_shadow:i,u_highlight:o,u_accent:a}}(e,n,r);c.draw(s,u.TRIANGLES,i,o,a,kt.disabled,h,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}}function sr(e,n,r,i,o,a){var s=e.context,u=s.gl,l=n.dem;if(l&&l.data){var c=l.dim,h=l.stride,f=l.getPixels();if(s.activeTexture.set(u.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(h),n.demTexture){var p=n.demTexture;p.update(f,{premultiply:!1}),p.bind(u.NEAREST,u.CLAMP_TO_EDGE)}else n.demTexture=new t.Texture(s,f,u.RGBA,{premultiply:!1}),n.demTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE);s.activeTexture.set(u.TEXTURE0);var d=n.fbo;if(!d){var g=new t.Texture(s,{width:c,height:c,data:null},u.RGBA);g.bind(u.LINEAR,u.CLAMP_TO_EDGE),(d=n.fbo=s.createFramebuffer(c,c,!0)).colorAttachment.set(g.texture)}s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,c,c]),e.useProgram("hillshadePrepare").draw(s,u.TRIANGLES,i,o,a,kt.disabled,function(e,n){var r=n.stride,i=t.create();return t.ortho(i,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(i,i,[0,-t.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:n.getUnpackVector()}}(n.tileID,l),r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function ur(e,n,r,i,o){var a=i.paint.get("raster-fade-duration");if(a>0){var s=t.browser.now(),u=(s-e.timeAdded)/a,l=n?(s-n.timeAdded)/a:-1,c=r.getSource(),h=o.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),f=!n||Math.abs(n.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),p=f&&e.refreshedUponExpiration?1:t.clamp(f?u:1-l,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}var lr=new t.Color(1,0,0,1),cr=new t.Color(0,1,0,1),hr=new t.Color(0,0,1,1),fr=new t.Color(1,0,1,1),pr=new t.Color(0,1,1,1);function dr(t,e,n,r){vr(t,0,e+n/2,t.transform.width,n,r)}function gr(t,e,n,r){vr(t,e-n/2,0,n,t.transform.height,r)}function vr(e,n,r,i,o,a){var s=e.context,u=s.gl;u.enable(u.SCISSOR_TEST),u.scissor(n*t.browser.devicePixelRatio,r*t.browser.devicePixelRatio,i*t.browser.devicePixelRatio,o*t.browser.devicePixelRatio),s.clear({color:a}),u.disable(u.SCISSOR_TEST)}function mr(e,n,r){var i=e.context,o=i.gl,a=r.posMatrix,s=e.useProgram("debug"),u=Ct.disabled,l=At.disabled,c=e.colorModeForRenderPass();i.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.draw(i,o.LINE_STRIP,u,l,c,kt.disabled,Rn(a,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);var h=n.getTileByID(r.key).latestRawTileData,f=Math.floor((h&&h.byteLength||0)/1024),p=n.getTile(r).tileSize,d=512/Math.min(p,512)*(r.overscaledZ/e.transform.zoom)*.5,g=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(g+=" => "+r.overscaledZ),function(t,e){t.initDebugOverlayCanvas();var n=t.debugOverlayCanvas,r=t.context.gl,i=t.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,n.width,n.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(e,5,5),i.strokeText(e,5,5),t.debugOverlayTexture.update(n),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,g+" "+f+"kb"),s.draw(i,o.TRIANGLES,u,l,Tt.alphaBlended,kt.disabled,Rn(a,t.Color.transparent,d),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}var yr={symbol:function(e,n,r,i,o){if("translucent"===e.renderPass){var a=At.disabled,s=e.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(e,n,r,i,o,a,s){for(var u=n.transform,l="map"===o,c="map"===a,h=0,f=e;h<f.length;h+=1){var p=f[h],d=i.getTile(p),g=d.getBucket(r);if(g&&g.text&&g.text.segments.get().length){var v=t.evaluateSizeForZoom(g.textSizeData,u.zoom),m=fe(d,1,n.transform.zoom),y=Qt(p.posMatrix,c,l,n.transform,m),_="none"!==r.layout.get("icon-text-fit")&&g.hasIconData();if(v){var b=Math.pow(2,u.zoom-d.tileID.overscaledZ);tr(g,l,c,s,t.symbolSize,u,y,p.posMatrix,b,v,_)}}}}(i,e,r,n,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&nr(e,n,r,i,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),a,s),0!==r.paint.get("text-opacity").constantOr(1)&&nr(e,n,r,i,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),a,s),n.map.showCollisionBoxes&&(Qn(e,n,r,i,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Qn(e,n,r,i,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))}},circle:function(e,n,r,i){if("translucent"===e.renderPass){var o=r.paint.get("circle-opacity"),a=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),u=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0!==o.constantOr(1)||0!==a.constantOr(1)&&0!==s.constantOr(1)){for(var l=e.context,c=l.gl,h=e.depthModeForSublayer(0,Ct.ReadOnly),f=At.disabled,p=e.colorModeForRenderPass(),d=[],g=0;g<i.length;g++){var v=i[g],m=n.getTile(v),y=m.getBucket(r);if(y){var _=y.programConfigurations.get(r.id),b={programConfiguration:_,program:e.useProgram("circle",_),layoutVertexBuffer:y.layoutVertexBuffer,indexBuffer:y.indexBuffer,uniformValues:Pn(e,v,m,r)};if(u)for(var x=0,w=y.segments.get();x<w.length;x+=1){var E=w[x];d.push({segments:new t.SegmentVector([E]),sortKey:E.sortKey,state:b})}else d.push({segments:y.segments,sortKey:0,state:b})}}u&&d.sort((function(t,e){return t.sortKey-e.sortKey}));for(var S=0,C=d;S<C.length;S+=1){var A=C[S],T=A.state;T.program.draw(l,c.TRIANGLES,h,f,p,kt.disabled,T.uniformValues,r.id,T.layoutVertexBuffer,T.indexBuffer,A.segments,r.paint,e.transform.zoom,T.programConfiguration)}}}},heatmap:function(e,n,r,i){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var o=e.context,a=o.gl,s=At.disabled,u=new Tt([a.ONE,a.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,n){var r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var i=n.heatmapFbo;if(i)r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{var o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),i=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,n,r){var i=t.gl;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e.width/4,e.height/4,0,i.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:i.UNSIGNED_BYTE,null),r.colorAttachment.set(n)}(t,e,o,i)}}(o,e,r),o.clear({color:t.Color.transparent});for(var l=0;l<i.length;l++){var c=i[l];if(!n.hasRenderableParent(c)){var h=n.getTile(c),f=h.getBucket(r);if(f){var p=f.programConfigurations.get(r.id);e.useProgram("heatmap",p).draw(o,a.TRIANGLES,Ct.disabled,s,u,kt.disabled,Dn(c.posMatrix,h,e.transform.zoom,r.paint.get("heatmap-intensity")),r.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,r.paint,e.transform.zoom,p)}}}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){var r=e.context,i=r.gl,o=n.heatmapFbo;if(o){r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1);var a=n.colorRampTexture;a||(a=n.colorRampTexture=new t.Texture(r,n.colorRamp,i.RGBA)),a.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,i.TRIANGLES,Ct.disabled,At.disabled,e.colorModeForRenderPass(),kt.disabled,function(e,n,r,i){var o=t.create();t.ortho(o,0,e.width,e.height,0,0,1);var a=e.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")}}(e,n),n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}}(e,r))},line:function(e,n,r,i){if("translucent"===e.renderPass){var o=r.paint.get("line-opacity"),a=r.paint.get("line-width");if(0!==o.constantOr(1)&&0!==a.constantOr(1))for(var s=e.depthModeForSublayer(0,Ct.ReadOnly),u=e.colorModeForRenderPass(),l=r.paint.get("line-dasharray"),c=r.paint.get("line-pattern"),h=c.constantOr(1),f=r.paint.get("line-gradient"),p=r.getCrossfadeParameters(),d=h?"linePattern":l?"lineSDF":f?"lineGradient":"line",g=e.context,v=g.gl,m=!0,y=0,_=i;y<_.length;y+=1){var b=_[y],x=n.getTile(b);if(!h||x.patternsLoaded()){var w=x.getBucket(r);if(w){var E=w.programConfigurations.get(r.id),S=e.context.program.get(),C=e.useProgram(d,E),A=m||C.program!==S,T=c.constantOr(null);if(T&&x.imageAtlas){var k=x.imageAtlas,M=k.patternPositions[T.to.toString()],P=k.patternPositions[T.from.toString()];M&&P&&E.setConstantPatternPositions(M,P)}var I=h?zn(e,x,r,p):l?Fn(e,x,r,l,p):f?Bn(e,x,r,w.lineClipsArray.length):Nn(e,x,r);if(h)g.activeTexture.set(v.TEXTURE0),x.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),E.updatePaintBuffers(p);else if(l&&(A||e.lineAtlas.dirty))g.activeTexture.set(v.TEXTURE0),e.lineAtlas.bind(g);else if(f){var O=w.gradients[r.id],R=O.texture;if(r.gradientVersion!==O.version){var L=256;if(r.stepInterpolant){var D=n.getSource().maxzoom,N=b.canonical.z===D?Math.ceil(1<<e.transform.maxZoom-b.canonical.z):1;L=t.clamp(t.nextPowerOfTwo(w.maxLineLength/t.EXTENT*1024*N),256,g.maxTextureSize)}O.gradient=t.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:L,image:O.gradient||void 0,clips:w.lineClipsArray}),O.texture?O.texture.update(O.gradient):O.texture=new t.Texture(g,O.gradient,v.RGBA),O.version=r.gradientVersion,R=O.texture}g.activeTexture.set(v.TEXTURE0),R.bind(r.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE)}C.draw(g,v.TRIANGLES,s,e.stencilModeForClipping(b),u,kt.disabled,I,r.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,r.paint,e.transform.zoom,E,w.layoutVertexBuffer2),m=!1}}}}},fill:function(e,n,r,i){var o=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=e.colorModeForRenderPass(),u=r.paint.get("fill-pattern"),l=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===l){var c=e.depthModeForSublayer(1,"opaque"===e.renderPass?Ct.ReadWrite:Ct.ReadOnly);ir(e,n,r,i,c,s,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){var h=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Ct.ReadOnly);ir(e,n,r,i,h,s,!0)}}},"fill-extrusion":function(t,e,n,r){var i=n.paint.get("fill-extrusion-opacity");if(0!==i&&"translucent"===t.renderPass){var o=new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D);if(1!==i||n.paint.get("fill-extrusion-pattern").constantOr(1))or(t,e,n,r,o,At.disabled,Tt.disabled),or(t,e,n,r,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var a=t.colorModeForRenderPass();or(t,e,n,r,o,At.disabled,a)}}},hillshade:function(t,e,n,r){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var i=t.context,o=t.depthModeForSublayer(0,Ct.ReadOnly),a=t.colorModeForRenderPass(),s="translucent"===t.renderPass?t.stencilConfigForOverlap(r):[{},r],u=s[0],l=0,c=s[1];l<c.length;l+=1){var h=c[l],f=e.getTile(h);f.needsHillshadePrepare&&"offscreen"===t.renderPass?sr(t,f,n,o,At.disabled,a):"translucent"===t.renderPass&&ar(t,f,n,o,u[h.overscaledZ],a)}i.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,n,r){if("translucent"===t.renderPass&&0!==n.paint.get("raster-opacity")&&r.length)for(var i=t.context,o=i.gl,a=e.getSource(),s=t.useProgram("raster"),u=t.colorModeForRenderPass(),l=a instanceof O?[{},r]:t.stencilConfigForOverlap(r),c=l[0],h=l[1],f=h[h.length-1].overscaledZ,p=!t.options.moving,d=0,g=h;d<g.length;d+=1){var v=g[d],m=t.depthModeForSublayer(v.overscaledZ-f,1===n.paint.get("raster-opacity")?Ct.ReadWrite:Ct.ReadOnly,o.LESS),y=e.getTile(v),_=t.transform.calculatePosMatrix(v.toUnwrapped(),p);y.registerFadeDuration(n.paint.get("raster-fade-duration"));var b=e.findLoadedParent(v,0),x=ur(y,b,e,n,t.transform),w=void 0,E=void 0,S="nearest"===n.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;i.activeTexture.set(o.TEXTURE0),y.texture.bind(S,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(o.TEXTURE1),b?(b.texture.bind(S,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,b.tileID.overscaledZ-y.tileID.overscaledZ),E=[y.tileID.canonical.x*w%1,y.tileID.canonical.y*w%1]):y.texture.bind(S,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var C=Un(_,E||[0,0],w||1,x,n);a instanceof O?s.draw(i,o.TRIANGLES,m,At.disabled,u,kt.disabled,C,n.id,a.boundsBuffer,t.quadTriangleIndexBuffer,a.boundsSegments):s.draw(i,o.TRIANGLES,m,c[v.overscaledZ],u,kt.disabled,C,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,n){var r=n.paint.get("background-color"),i=n.paint.get("background-opacity");if(0!==i){var o=t.context,a=o.gl,s=t.transform,u=s.tileSize,l=n.paint.get("background-pattern");if(!t.isPatternMissing(l)){var c=!l&&1===r.a&&1===i&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===c){var h=At.disabled,f=t.depthModeForSublayer(0,"opaque"===c?Ct.ReadWrite:Ct.ReadOnly),p=t.colorModeForRenderPass(),d=t.useProgram(l?"backgroundPattern":"background"),g=s.coveringTiles({tileSize:u});l&&(o.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));for(var v=n.getCrossfadeParameters(),m=0,y=g;m<y.length;m+=1){var _=y[m],b=t.transform.calculatePosMatrix(_.toUnwrapped()),x=l?qn(b,i,t,l,{tileID:_,tileSize:u},v):Yn(b,i,r);d.draw(o,a.TRIANGLES,f,h,p,kt.disabled,x,n.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,n){for(var r=0;r<n.length;r++)mr(t,e,n[r])},custom:function(t,e,n){var r=t.context,i=n.implementation;if("offscreen"===t.renderPass){var o=i.prerender;o&&(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),o.call(i,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(At.disabled);var a="3d"===i.renderingMode?new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Ct.ReadOnly);r.setDepthMode(a),i.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}},_r=function(t,e){this.context=new Mt(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=Pt.maxUnderzooming+Pt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ze,this.gpuTimers={}};_r.prototype.resize=function(e,n){if(this.width=e*t.browser.devicePixelRatio,this.height=n*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var r=0,i=this.style._order;r<i.length;r+=1)this.style._layers[i[r]].resize()},_r.prototype.setup=function(){var e=this.context,n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(n,Ve.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(r,Ve.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var i=new t.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(t.EXTENT,0,t.EXTENT,0),i.emplaceBack(0,t.EXTENT,0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(i,I.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,Ve.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);var u=this.context.gl;this.stencilClearMode=new At({func:u.ALWAYS,mask:0},0,255,u.ZERO,u.ZERO,u.ZERO)},_r.prototype.clearStencil=function(){var e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var r=t.create();t.ortho(r,0,this.width,this.height,0,0,1),t.scale(r,r,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,Ct.disabled,this.stencilClearMode,Tt.disabled,kt.disabled,Ln(r),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},_r.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var n=this.context,r=n.gl;this.nextStencilID+e.length>256&&this.clearStencil(),n.setColorMode(Tt.disabled),n.setDepthMode(Ct.disabled);var i=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=e;o<a.length;o+=1){var s=a[o],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;i.draw(n,r.TRIANGLES,Ct.disabled,new At({func:r.ALWAYS,mask:0},u,255,r.KEEP,r.KEEP,r.REPLACE),Tt.disabled,kt.disabled,Ln(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},_r.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new At({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},_r.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new At({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},_r.prototype.stencilConfigForOverlap=function(t){var e,n=this.context.gl,r=t.sort((function(t,e){return e.overscaledZ-t.overscaledZ})),i=r[r.length-1].overscaledZ,o=r[0].overscaledZ-i+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();for(var a={},s=0;s<o;s++)a[s+i]=new At({func:n.GEQUAL,mask:255},s+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[a,r]}return[(e={},e[i]=At.disabled,e),r]},_r.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Tt([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Tt.unblended:Tt.alphaBlended},_r.prototype.depthModeForSublayer=function(t,e,n){if(!this.opaquePassEnabledForLayer())return Ct.disabled;var r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ct(n||this.context.gl.LEQUAL,e,[r,r])},_r.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},_r.prototype.render=function(e,n){var r=this;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var i=this.style._order,o=this.style.sourceCaches;for(var a in o){var s=o[a];s.used&&s.prepare(this.context)}var u,l,c={},h={},f={};for(var p in o){var d=o[p];c[p]=d.getVisibleCoordinates(),h[p]=c[p].slice().reverse(),f[p]=d.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var g=0;g<i.length;g++)if(this.style._layers[i[g]].is3D()){this.opaquePassCutoff=g;break}this.renderPass="offscreen";for(var v=0,m=i;v<m.length;v+=1){var y=this.style._layers[m[v]];if(y.hasOffscreenPass()&&!y.isHidden(this.transform.zoom)){var _=h[y.source];("custom"===y.type||_.length)&&this.renderLayer(this,o[y.source],y,_)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){var b=this.style._layers[i[this.currentLayer]],x=o[b.source],w=c[b.source];this._renderTileClippingMasks(b,w),this.renderLayer(this,x,b,w)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var E=this.style._layers[i[this.currentLayer]],S=o[E.source],C=("symbol"===E.type?f:h)[E.source];this._renderTileClippingMasks(E,c[E.source]),this.renderLayer(this,S,E,C)}this.options.showTileBoundaries&&(t.values(this.style._layers).forEach((function(t){t.source&&!t.isHidden(r.transform.zoom)&&(t.source!==(l&&l.id)&&(l=r.style.sourceCaches[t.source]),(!u||u.getSource().maxzoom<l.getSource().maxzoom)&&(u=l))})),u&&yr.debug(this,u,u.getVisibleCoordinates())),this.options.showPadding&&function(t){var e=t.transform.padding;dr(t,t.transform.height-(e.top||0),3,lr),dr(t,e.bottom||0,3,cr),gr(t,e.left||0,3,hr),gr(t,t.transform.width-(e.right||0),3,fr);var n=t.transform.centerPoint;!function(t,e,n,r){vr(t,e-1,n-10,2,20,r),vr(t,e-10,n-1,20,2,r)}(t,n.x,t.transform.height-n.y,pr)}(this),this.context.setDefault()},_r.prototype.renderLayer=function(t,e,n,r){n.isHidden(this.transform.zoom)||("background"===n.type||"custom"===n.type||r.length)&&(this.id=n.id,this.gpuTimingStart(n),yr[n.type](t,e,n,r,this.style.placement.variableOffsets),this.gpuTimingEnd())},_r.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),n.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,n.query)}},_r.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}},_r.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},_r.prototype.queryGpuTimers=function(t){var e={};for(var n in t){var r=t[n],i=this.context.extTimerQuery,o=i.getQueryObjectEXT(r.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(r.query),e[n]=o}return e},_r.prototype.translatePosMatrix=function(e,n,r,i,o){if(!r[0]&&!r[1])return e;var a=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(a){var s=Math.sin(a),u=Math.cos(a);r=[r[0]*u-r[1]*s,r[0]*s+r[1]*u]}var l=[o?r[0]:fe(n,r[0],this.transform.zoom),o?r[1]:fe(n,r[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,l),c},_r.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},_r.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},_r.prototype.isPatternMissing=function(t){if(!t)return!1;if(!t.from||!t.to)return!0;var e=this.imageManager.getPattern(t.from.toString()),n=this.imageManager.getPattern(t.to.toString());return!e||!n},_r.prototype.useProgram=function(t,e){this.cache=this.cache||{};var n=""+t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=new wn(this.context,t,_n[t],e,Kn[t],this._showOverdrawInspector)),this.cache[n]},_r.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},_r.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)},_r.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},_r.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var br=function(t,e){this.points=t,this.planes=e};br.fromInvProjectionMatrix=function(e,n,r){var i=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(n){return t.transformMat4([],n,e)})).map((function(e){return t.scale$1([],e,1/e[3]/n*i)})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var n=t.sub([],o[e[0]],o[e[1]]),r=t.sub([],o[e[2]],o[e[1]]),i=t.normalize([],t.cross([],n,r)),a=-t.dot(i,o[e[1]]);return i.concat(a)}));return new br(o,a)};var xr=function(e,n){this.min=e,this.max=n,this.center=t.scale$2([],t.add([],this.min,this.max),.5)};xr.prototype.quadrant=function(e){for(var n=[e%2==0,e<2],r=t.clone$2(this.min),i=t.clone$2(this.max),o=0;o<n.length;o++)r[o]=n[o]?this.min[o]:this.center[o],i[o]=n[o]?this.center[o]:this.max[o];return i[2]=this.max[2],new xr(r,i)},xr.prototype.distanceX=function(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]},xr.prototype.distanceY=function(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]},xr.prototype.intersects=function(e){for(var n=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],r=!0,i=0;i<e.planes.length;i++){for(var o=e.planes[i],a=0,s=0;s<n.length;s++)a+=t.dot$1(o,n[s])>=0;if(0===a)return 0;a!==n.length&&(r=!1)}if(r)return 2;for(var u=0;u<3;u++){for(var l=Number.MAX_VALUE,c=-Number.MAX_VALUE,h=0;h<e.points.length;h++){var f=e.points[h][u]-this.min[u];l=Math.min(l,f),c=Math.max(c,f)}if(c<0||l>this.max[u]-this.min[u])return 0}return 1};var wr=function(t,e,n,r){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=n,this.right=r};wr.prototype.interpolate=function(e,n,r){return null!=n.top&&null!=e.top&&(this.top=t.number(e.top,n.top,r)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,n.bottom,r)),null!=n.left&&null!=e.left&&(this.left=t.number(e.left,n.left,r)),null!=n.right&&null!=e.right&&(this.right=t.number(e.right,n.right,r)),this},wr.prototype.getCenter=function(e,n){var r=t.clamp((this.left+e-this.right)/2,0,e),i=t.clamp((this.top+n-this.bottom)/2,0,n);return new t.Point(r,i)},wr.prototype.equals=function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right},wr.prototype.clone=function(){return new wr(this.top,this.bottom,this.left,this.right)},wr.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Er=function(e,n,r,i,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new wr,this._posMatrixCache={},this._alignedPosMatrixCache={}},Sr={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Er.prototype.clone=function(){var t=new Er(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t},Sr.minZoom.get=function(){return this._minZoom},Sr.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},Sr.maxZoom.get=function(){return this._maxZoom},Sr.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},Sr.minPitch.get=function(){return this._minPitch},Sr.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))},Sr.maxPitch.get=function(){return this._maxPitch},Sr.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))},Sr.renderWorldCopies.get=function(){return this._renderWorldCopies},Sr.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},Sr.worldSize.get=function(){return this.tileSize*this.scale},Sr.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Sr.size.get=function(){return new t.Point(this.width,this.height)},Sr.bearing.get=function(){return-this.angle/Math.PI*180},Sr.bearing.set=function(e){var n=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Sr.pitch.get=function(){return this._pitch/Math.PI*180},Sr.pitch.set=function(e){var n=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())},Sr.fov.get=function(){return this._fov/Math.PI*180},Sr.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},Sr.zoom.get=function(){return this._zoom},Sr.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},Sr.center.get=function(){return this._center},Sr.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Sr.padding.get=function(){return this._edgeInsets.toJSON()},Sr.padding.set=function(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())},Sr.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Er.prototype.isPaddingEqual=function(t){return this._edgeInsets.equals(t)},Er.prototype.interpolatePadding=function(t,e,n){this._unmodified=!1,this._edgeInsets.interpolate(t,e,n),this._constrain(),this._calcMatrices()},Er.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},Er.prototype.getVisibleUnwrappedCoordinates=function(e){var n=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var r=this.pointCoordinate(new t.Point(0,0)),i=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),a=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(r.x,i.x,o.x,a.x)),u=Math.floor(Math.max(r.x,i.x,o.x,a.x)),l=s-1;l<=u+1;l++)0!==l&&n.push(new t.UnwrappedTileID(l,e));return n},Er.prototype.coveringTiles=function(e){var n=this.coveringZoomLevel(e),r=n;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);var i=t.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,n),a=[o*i.x,o*i.y,0],s=br.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),u=e.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(u=n);var l=function(t){return{aabb:new xr([t*o,0,0],[(t+1)*o,o,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}},c=[],h=[],f=n,p=e.reparseOverscaled?r:n;if(this._renderWorldCopies)for(var d=1;d<=3;d++)c.push(l(-d)),c.push(l(d));for(c.push(l(0));c.length>0;){var g=c.pop(),v=g.x,m=g.y,y=g.fullyVisible;if(!y){var _=g.aabb.intersects(s);if(0===_)continue;y=2===_}var b=g.aabb.distanceX(a),x=g.aabb.distanceY(a),w=Math.max(Math.abs(b),Math.abs(x));if(g.zoom===f||w>3+(1<<f-g.zoom)-2&&g.zoom>=u)h.push({tileID:new t.OverscaledTileID(g.zoom===f?p:g.zoom,g.wrap,g.zoom,v,m),distanceSq:t.sqrLen([a[0]-.5-v,a[1]-.5-m])});else for(var E=0;E<4;E++){var S=(v<<1)+E%2,C=(m<<1)+(E>>1);c.push({aabb:g.aabb.quadrant(E),zoom:g.zoom+1,x:S,y:C,wrap:g.wrap,fullyVisible:y})}}return h.sort((function(t,e){return t.distanceSq-e.distanceSq})).map((function(t){return t.tileID}))},Er.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},Sr.unmodified.get=function(){return this._unmodified},Er.prototype.zoomScale=function(t){return Math.pow(2,t)},Er.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Er.prototype.project=function(e){var n=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(n)*this.worldSize)},Er.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},Sr.point.get=function(){return this.project(this.center)},Er.prototype.setLocationAtPoint=function(e,n){var r=this.pointCoordinate(n),i=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),a=new t.MercatorCoordinate(o.x-(r.x-i.x),o.y-(r.y-i.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())},Er.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Er.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Er.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},Er.prototype.coordinateLocation=function(t){return t.toLngLat()},Er.prototype.pointCoordinate=function(e){var n=[e.x,e.y,0,1],r=[e.x,e.y,1,1];t.transformMat4(n,n,this.pixelMatrixInverse),t.transformMat4(r,r,this.pixelMatrixInverse);var i=n[3],o=r[3],a=n[1]/i,s=r[1]/o,u=n[2]/i,l=r[2]/o,c=u===l?0:(0-u)/(l-u);return new t.MercatorCoordinate(t.number(n[0]/i,r[0]/o,c)/this.worldSize,t.number(a,s,c)/this.worldSize)},Er.prototype.coordinatePoint=function(e){var n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix),new t.Point(n[0]/n[3],n[1]/n[3])},Er.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},Er.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Er.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Er.prototype.calculatePosMatrix=function(e,n){void 0===n&&(n=!1);var r=e.key,i=n?this._alignedPosMatrixCache:this._posMatrixCache;if(i[r])return i[r];var o=e.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*e.wrap,u=t.identity(new Float64Array(16));return t.translate(u,u,[s*a,o.y*a,0]),t.scale(u,u,[a/t.EXTENT,a/t.EXTENT,1]),t.multiply(u,n?this.alignedProjMatrix:this.projMatrix,u),i[r]=new Float32Array(u),i[r]},Er.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Er.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,n,r,i,o=-90,a=90,s=-180,u=180,l=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;o=t.mercatorYfromLat(h[1])*this.worldSize,e=(a=t.mercatorYfromLat(h[0])*this.worldSize)-o<l.y?l.y/(a-o):0}if(this.lngRange){var f=this.lngRange;s=t.mercatorXfromLng(f[0])*this.worldSize,n=(u=t.mercatorXfromLng(f[1])*this.worldSize)-s<l.x?l.x/(u-s):0}var p=this.point,d=Math.max(n||0,e||0);if(d)return this.center=this.unproject(new t.Point(n?(u+s)/2:p.x,e?(a+o)/2:p.y)),this.zoom+=this.scaleZoom(d),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var g=p.y,v=l.y/2;g-v<o&&(i=o+v),g+v>a&&(i=a-v)}if(this.lngRange){var m=p.x,y=l.x/2;m-y<s&&(r=s+y),m+y>u&&(r=u-y)}void 0===r&&void 0===i||(this.center=this.unproject(new t.Point(void 0!==r?r:p.x,void 0!==i?i:p.y))),this._unmodified=c,this._constraining=!1}},Er.prototype._calcMatrices=function(){if(this.height){var e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+e.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(t.clamp(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);t.perspective(c,this._fov,this.width/this.height,l,u),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,t.scale(c,c,[1,-1,1]),t.translate(c,c,[0,0,-this.cameraToCenterDistance]),t.rotateX(c,c,this._pitch),t.rotateZ(c,c,this.angle),t.translate(c,c,[-a,-s,0]),this.mercatorMatrix=t.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),t.scale(c,c,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=t.invert([],this.projMatrix);var h=this.width%2/2,f=this.height%2/2,p=Math.cos(this.angle),d=Math.sin(this.angle),g=a-Math.round(a)+p*h+d*f,v=s-Math.round(s)+p*f+d*h,m=new Float64Array(c);if(t.translate(m,m,[g>.5?g-1:g,v>.5?v-1:v,0]),this.alignedProjMatrix=m,c=t.create(),t.scale(c,c,[this.width/2,-this.height/2,1]),t.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=t.create(),t.scale(c,c,[1,-1,1]),t.translate(c,c,[-1,-1,0]),t.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Er.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance},Er.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},Er.prototype.getCameraQueryGeometry=function(e){var n=this.getCameraPoint();if(1===e.length)return[e[0],n];for(var r=n.x,i=n.y,o=n.x,a=n.y,s=0,u=e;s<u.length;s+=1){var l=u[s];r=Math.min(r,l.x),i=Math.min(i,l.y),o=Math.max(o,l.x),a=Math.max(a,l.y)}return[new t.Point(r,i),new t.Point(o,i),new t.Point(o,a),new t.Point(r,a),new t.Point(r,i)]},Object.defineProperties(Er.prototype,Sr);var Cr=function(e){var n,r,i,o;this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(n=this._updateHashUnthrottled.bind(this),r=!1,i=null,o=function(){i=null,r&&(n(),i=setTimeout(o,300),r=!1)},function(){return r=!0,i||o(),i})};Cr.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Cr.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Cr.prototype.getHashString=function(e){var n=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,i=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,i),a=Math.round(n.lng*o)/o,s=Math.round(n.lat*o)/o,u=this._map.getBearing(),l=this._map.getPitch(),c="";if(c+=e?"/"+a+"/"+s+"/"+r:r+"/"+s+"/"+a,(u||l)&&(c+="/"+Math.round(10*u)/10),l&&(c+="/"+Math.round(l)),this._hashName){var h=this._hashName,f=!1,p=t.window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===h?(f=!0,e+"="+c):t})).filter((function(t){return t}));return f||p.push(h+"="+c),"#"+p.join("&")}return"#"+c},Cr.prototype._getCurrentHash=function(){var e,n=this,r=t.window.location.hash.replace("#","");return this._hashName?(r.split("&").map((function(t){return t.split("=")})).forEach((function(t){t[0]===n._hashName&&(e=t)})),(e&&e[1]||"").split("/")):r.split("/")},Cr.prototype._onHashChange=function(){var t=this._getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(t)}))){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},Cr.prototype._updateHashUnthrottled=function(){var e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());try{t.window.history.replaceState(t.window.history.state,null,e)}catch(t){}};var Ar={linearity:.3,easing:t.bezier(0,0,.3,1)},Tr=t.extend({deceleration:2500,maxSpeed:1400},Ar),kr=t.extend({deceleration:20,maxSpeed:1400},Ar),Mr=t.extend({deceleration:1e3,maxSpeed:360},Ar),Pr=t.extend({deceleration:1e3,maxSpeed:90},Ar),Ir=function(t){this._map=t,this.clear()};function Or(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Rr(e,n,r){var i=r.maxSpeed,o=r.linearity,a=r.deceleration,s=t.clamp(e*o/(n/1e3),-i,i),u=Math.abs(s)/(a*o);return{easing:r.easing,duration:1e3*u,amount:s*(u/2)}}Ir.prototype.clear=function(){this._inertiaBuffer=[]},Ir.prototype.record=function(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.browser.now(),settings:e})},Ir.prototype._drainInertiaBuffer=function(){for(var e=this._inertiaBuffer,n=t.browser.now();e.length>0&&n-e[0].time>160;)e.shift()},Ir.prototype._onMoveEnd=function(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var n={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0},r=0,i=this._inertiaBuffer;r<i.length;r+=1){var o=i[r].settings;n.zoom+=o.zoomDelta||0,n.bearing+=o.bearingDelta||0,n.pitch+=o.pitchDelta||0,o.panDelta&&n.pan._add(o.panDelta),o.around&&(n.around=o.around),o.pinchAround&&(n.pinchAround=o.pinchAround)}var a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){var u=Rr(n.pan.mag(),a,t.extend({},Tr,e||{}));s.offset=n.pan.mult(u.amount/n.pan.mag()),s.center=this._map.transform.center,Or(s,u)}if(n.zoom){var l=Rr(n.zoom,a,kr);s.zoom=this._map.transform.zoom+l.amount,Or(s,l)}if(n.bearing){var c=Rr(n.bearing,a,Mr);s.bearing=this._map.transform.bearing+t.clamp(c.amount,-179,179),Or(s,c)}if(n.pitch){var h=Rr(n.pitch,a,Pr);s.pitch=this._map.transform.pitch+h.amount,Or(s,h)}if(s.zoom||s.bearing){var f=void 0===n.pinchAround?n.around:n.pinchAround;s.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),t.extend(s,{noMoveStart:!0})}};var Lr=function(e){function r(r,i,o,a){void 0===a&&(a={});var s=n.mousePos(i.getCanvasContainer(),o),u=i.unproject(s);e.call(this,r,t.extend({point:s,lngLat:u,originalEvent:o},a)),this._defaultPrevented=!1,this.target=i}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(t.Event),Dr=function(e){function r(r,i,o){var a="touchend"===r?o.changedTouches:o.touches,s=n.touchPos(i.getCanvasContainer(),a),u=s.map((function(t){return i.unproject(t)})),l=s.reduce((function(t,e,n,r){return t.add(e.div(r.length))}),new t.Point(0,0)),c=i.unproject(l);e.call(this,r,{points:s,point:l,lngLats:u,lngLat:c,originalEvent:o}),this._defaultPrevented=!1}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(t.Event),Nr=function(t){function e(e,n,r){t.call(this,e,{originalEvent:r}),this._defaultPrevented=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,n),e}(t.Event),Br=function(t,e){this._map=t,this._clickTolerance=e.clickTolerance};Br.prototype.reset=function(){delete this._mousedownPos},Br.prototype.wheel=function(t){return this._firePreventable(new Nr(t.type,this._map,t))},Br.prototype.mousedown=function(t,e){return this._mousedownPos=e,this._firePreventable(new Lr(t.type,this._map,t))},Br.prototype.mouseup=function(t){this._map.fire(new Lr(t.type,this._map,t))},Br.prototype.click=function(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Lr(t.type,this._map,t))},Br.prototype.dblclick=function(t){return this._firePreventable(new Lr(t.type,this._map,t))},Br.prototype.mouseover=function(t){this._map.fire(new Lr(t.type,this._map,t))},Br.prototype.mouseout=function(t){this._map.fire(new Lr(t.type,this._map,t))},Br.prototype.touchstart=function(t){return this._firePreventable(new Dr(t.type,this._map,t))},Br.prototype.touchmove=function(t){this._map.fire(new Dr(t.type,this._map,t))},Br.prototype.touchend=function(t){this._map.fire(new Dr(t.type,this._map,t))},Br.prototype.touchcancel=function(t){this._map.fire(new Dr(t.type,this._map,t))},Br.prototype._firePreventable=function(t){if(this._map.fire(t),t.defaultPrevented)return{}},Br.prototype.isEnabled=function(){return!0},Br.prototype.isActive=function(){return!1},Br.prototype.enable=function(){},Br.prototype.disable=function(){};var zr=function(t){this._map=t};zr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},zr.prototype.mousemove=function(t){this._map.fire(new Lr(t.type,this._map,t))},zr.prototype.mousedown=function(){this._delayContextMenu=!0},zr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Lr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},zr.prototype.contextmenu=function(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Lr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()},zr.prototype.isEnabled=function(){return!0},zr.prototype.isActive=function(){return!1},zr.prototype.enable=function(){},zr.prototype.disable=function(){};var Fr=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1};function Zr(t,e){for(var n={},r=0;r<t.length;r++)n[t[r].identifier]=e[r];return n}Fr.prototype.isEnabled=function(){return!!this._enabled},Fr.prototype.isActive=function(){return!!this._active},Fr.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Fr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Fr.prototype.mousedown=function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(n.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)},Fr.prototype.mousemoveWindow=function(t,e){if(this._active){var r=e;if(!(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)){var i=this._startPos;this._lastPos=r,this._box||(this._box=n.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var o=Math.min(i.x,r.x),a=Math.max(i.x,r.x),s=Math.min(i.y,r.y),u=Math.max(i.y,r.y);n.setTransform(this._box,"translate("+o+"px,"+s+"px)"),this._box.style.width=a-o+"px",this._box.style.height=u-s+"px"}}},Fr.prototype.mouseupWindow=function(e,r){var i=this;if(this._active&&0===e.button){var o=this._startPos,a=r;if(this.reset(),n.suppressClick(),o.x!==a.x||o.y!==a.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:function(t){return t.fitScreenCoordinates(o,a,i._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",e)}},Fr.prototype.keydown=function(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))},Fr.prototype.blur=function(){this.reset()},Fr.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(n.remove(this._box),this._box=null),n.enableDrag(),delete this._startPos,delete this._lastPos},Fr.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,{originalEvent:n}))};var jr=function(t){this.reset(),this.numTouches=t.numTouches};jr.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},jr.prototype.touchstart=function(e,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){for(var n=new t.Point(0,0),r=0,i=e;r<i.length;r+=1)n._add(i[r]);return n.div(e.length)}(n),this.touches=Zr(r,n)))},jr.prototype.touchmove=function(t,e,n){if(!this.aborted&&this.centroid){var r=Zr(n,e);for(var i in this.touches){var o=r[i];(!o||o.dist(this.touches[i])>30)&&(this.aborted=!0)}}},jr.prototype.touchend=function(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}};var Ur=function(t){this.singleTap=new jr(t),this.numTaps=t.numTaps,this.reset()};Ur.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ur.prototype.touchstart=function(t,e,n){this.singleTap.touchstart(t,e,n)},Ur.prototype.touchmove=function(t,e,n){this.singleTap.touchmove(t,e,n)},Ur.prototype.touchend=function(t,e,n){var r=this.singleTap.touchend(t,e,n);if(r){var i=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}};var Gr=function(){this._zoomIn=new Ur({numTouches:1,numTaps:2}),this._zoomOut=new Ur({numTouches:2,numTaps:1}),this.reset()};Gr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Gr.prototype.touchstart=function(t,e,n){this._zoomIn.touchstart(t,e,n),this._zoomOut.touchstart(t,e,n)},Gr.prototype.touchmove=function(t,e,n){this._zoomIn.touchmove(t,e,n),this._zoomOut.touchmove(t,e,n)},Gr.prototype.touchend=function(t,e,n){var r=this,i=this._zoomIn.touchend(t,e,n),o=this._zoomOut.touchend(t,e,n);return i?(this._active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}}):o?(this._active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0},Gr.prototype.touchcancel=function(){this.reset()},Gr.prototype.enable=function(){this._enabled=!0},Gr.prototype.disable=function(){this._enabled=!1,this.reset()},Gr.prototype.isEnabled=function(){return this._enabled},Gr.prototype.isActive=function(){return this._active};var Vr={0:1,2:2},Wr=function(t){this.reset(),this._clickTolerance=t.clickTolerance||1};Wr.prototype.blur=function(){this.reset()},Wr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Wr.prototype._correctButton=function(t,e){return!1},Wr.prototype._move=function(t,e){return{}},Wr.prototype.mousedown=function(t,e){if(!this._lastPoint){var r=n.mouseButton(t);this._correctButton(t,r)&&(this._lastPoint=e,this._eventButton=r)}},Wr.prototype.mousemoveWindow=function(t,e){var n=this._lastPoint;if(n)if(t.preventDefault(),function(t,e){var n=Vr[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(n,e)},Wr.prototype.mouseupWindow=function(t){this._lastPoint&&n.mouseButton(t)===this._eventButton&&(this._moved&&n.suppressClick(),this.reset())},Wr.prototype.enable=function(){this._enabled=!0},Wr.prototype.disable=function(){this._enabled=!1,this.reset()},Wr.prototype.isEnabled=function(){return this._enabled},Wr.prototype.isActive=function(){return this._active};var Hr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.mousedown=function(e,n){t.prototype.mousedown.call(this,e,n),this._lastPoint&&(this._active=!0)},e.prototype._correctButton=function(t,e){return 0===e&&!t.ctrlKey},e.prototype._move=function(t,e){return{around:e,panDelta:e.sub(t)}},e}(Wr),Xr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var n=.8*(e.x-t.x);if(n)return this._active=!0,{bearingDelta:n}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Wr),Yr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var n=-.5*(e.y-t.y);if(n)return this._active=!0,{pitchDelta:n}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Wr),qr=function(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()};qr.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)},qr.prototype.touchstart=function(t,e,n){return this._calculateTransform(t,e,n)},qr.prototype.touchmove=function(t,e,n){if(this._active&&!(n.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,n)},qr.prototype.touchend=function(t,e,n){this._calculateTransform(t,e,n),this._active&&n.length<this._minTouches&&this.reset()},qr.prototype.touchcancel=function(){this.reset()},qr.prototype._calculateTransform=function(e,n,r){r.length>0&&(this._active=!0);var i=Zr(r,n),o=new t.Point(0,0),a=new t.Point(0,0),s=0;for(var u in i){var l=i[u],c=this._touches[u];c&&(o._add(l),a._add(l.sub(c)),s++,i[u]=l)}if(this._touches=i,!(s<this._minTouches)&&a.mag()){var h=a.div(s);if(this._sum._add(h),!(this._sum.mag()<this._clickTolerance))return{around:o.div(s),panDelta:h}}},qr.prototype.enable=function(){this._enabled=!0},qr.prototype.disable=function(){this._enabled=!1,this.reset()},qr.prototype.isEnabled=function(){return this._enabled},qr.prototype.isActive=function(){return this._active};var Kr=function(){this.reset()};function Qr(t,e,n){for(var r=0;r<t.length;r++)if(t[r].identifier===n)return e[r]}function Jr(t,e){return Math.log(t/e)/Math.LN2}Kr.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Kr.prototype._start=function(t){},Kr.prototype._move=function(t,e,n){return{}},Kr.prototype.touchstart=function(t,e,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([e[0],e[1]]))},Kr.prototype.touchmove=function(t,e,n){if(this._firstTwoTouches){t.preventDefault();var r=this._firstTwoTouches,i=r[1],o=Qr(n,e,r[0]),a=Qr(n,e,i);if(o&&a){var s=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],s,t)}}},Kr.prototype.touchend=function(t,e,r){if(this._firstTwoTouches){var i=this._firstTwoTouches,o=i[1],a=Qr(r,e,i[0]),s=Qr(r,e,o);a&&s||(this._active&&n.suppressClick(),this.reset())}},Kr.prototype.touchcancel=function(){this.reset()},Kr.prototype.enable=function(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var $r=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._distance,delete this._startDistance},e.prototype._start=function(t){this._startDistance=this._distance=t[0].dist(t[1])},e.prototype._move=function(t,e){var n=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Jr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jr(this._distance,n),pinchAround:e}},e}(Kr);function ti(t,e){return 180*t.angleWith(e)/Math.PI}var ei=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},e.prototype._start=function(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])},e.prototype._move=function(t,e){var n=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ti(this._vector,n),pinchAround:e}},e.prototype._isBelowThreshold=function(t){this._minDiameter=Math.min(this._minDiameter,t.mag());var e=25/(Math.PI*this._minDiameter)*360,n=ti(t,this._startVector);return Math.abs(n)<e},e}(Kr);function ni(t){return Math.abs(t.y)>Math.abs(t.x)}var ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},e.prototype._start=function(t){this._lastPoints=t,ni(t[0].sub(t[1]))&&(this._valid=!1)},e.prototype._move=function(t,e,n){var r=t[0].sub(this._lastPoints[0]),i=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(r.y+i.y)/2*-.5}},e.prototype.gestureBeginsVertically=function(t,e,n){if(void 0!==this._valid)return this._valid;var r=t.mag()>=2,i=e.mag()>=2;if(r||i){if(!r||!i)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;var o=t.y>0==e.y>0;return ni(t)&&ni(e)&&o}},e}(Kr),ii={panStep:100,bearingStep:15,pitchStep:10},oi=function(){var t=ii;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1};function ai(t){return t*(2-t)}oi.prototype.blur=function(){this.reset()},oi.prototype.reset=function(){this._active=!1},oi.prototype.keydown=function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:ai,zoom:n?Math.round(u)+n*(t.shiftKey?2:1):u,bearing:s.getBearing()+r*e._bearingStep,pitch:s.getPitch()+i*e._pitchStep,offset:[-o*e._panStep,-a*e._panStep],center:s.getCenter()},{originalEvent:t})}}}},oi.prototype.enable=function(){this._enabled=!0},oi.prototype.disable=function(){this._enabled=!1,this.reset()},oi.prototype.isEnabled=function(){return this._enabled},oi.prototype.isActive=function(){return this._active},oi.prototype.disableRotation=function(){this._rotationDisabled=!0},oi.prototype.enableRotation=function(){this._rotationDisabled=!1};var si=function(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onTimeout"],this)};si.prototype.setZoomRate=function(t){this._defaultZoomRate=t},si.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},si.prototype.isEnabled=function(){return!!this._enabled},si.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},si.prototype.isZooming=function(){return!!this._zooming},si.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},si.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},si.prototype.wheel=function(e){if(this.isEnabled()){var n=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,r=t.browser.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}},si.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},si.prototype._start=function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var r=n.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(r)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},si.prototype.renderFrame=function(){var e=this;if(this._frameId&&(this._frameId=null,this.isActive())){var n=this._map.transform;if(0!==this._delta){var r="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,i=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&0!==i&&(i=1/i);var o="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(o*i))),"wheel"===this._type&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var a,s="number"==typeof this._targetZoom?this._targetZoom:n.zoom,u=this._startZoom,l=this._easing,c=!1;if("wheel"===this._type&&u&&l){var h=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),f=l(h);a=t.number(u,s,f),h<1?this._frameId||(this._frameId=!0):c=!0}else a=s,c=!0;return this._active=!0,c&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._handler._triggerRenderFrame(),delete e._targetZoom,delete e._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:a-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},si.prototype._smoothOutEasing=function(e){var n=t.ease;if(this._prevEase){var r=this._prevEase,i=(t.browser.now()-r.start)/r.duration,o=r.easing(i+.01)-r.easing(i),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);n=t.bezier(a,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:n},n},si.prototype.blur=function(){this.reset()},si.prototype.reset=function(){this._active=!1};var ui=function(t,e){this._clickZoom=t,this._tapZoom=e};ui.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ui.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ui.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ui.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var li=function(){this.reset()};li.prototype.reset=function(){this._active=!1},li.prototype.blur=function(){this.reset()},li.prototype.dblclick=function(t,e){return t.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}},li.prototype.enable=function(){this._enabled=!0},li.prototype.disable=function(){this._enabled=!1,this.reset()},li.prototype.isEnabled=function(){return this._enabled},li.prototype.isActive=function(){return this._active};var ci=function(){this._tap=new Ur({numTouches:1,numTaps:1}),this.reset()};ci.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ci.prototype.touchstart=function(t,e,n){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=e[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(t,e,n))},ci.prototype.touchmove=function(t,e,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;var r=e[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(t,e,n)},ci.prototype.touchend=function(t,e,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(t,e,n)&&(this._tapTime=t.timeStamp)},ci.prototype.touchcancel=function(){this.reset()},ci.prototype.enable=function(){this._enabled=!0},ci.prototype.disable=function(){this._enabled=!1,this.reset()},ci.prototype.isEnabled=function(){return this._enabled},ci.prototype.isActive=function(){return this._active};var hi=function(t,e,n){this._el=t,this._mousePan=e,this._touchPan=n};hi.prototype.enable=function(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},hi.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},hi.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},hi.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var fi=function(t,e,n){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=n};fi.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},fi.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},fi.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},fi.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var pi=function(t,e,n,r){this._el=t,this._touchZoom=e,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0};pi.prototype.enable=function(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},pi.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},pi.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},pi.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},pi.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},pi.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var di=function(t){return t.zoom||t.drag||t.pitch||t.rotate},gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(t.Event);function vi(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var mi=function(e,r){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ir(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r),t.bindAll(["handleEvent","handleWindowEvent"],this);var i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[t.window,"blur",void 0]];for(var o=0,a=this._listeners;o<a.length;o+=1){var s=a[o],u=s[0];n.addEventListener(u,s[1],u===t.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};mi.prototype.destroy=function(){for(var e=0,r=this._listeners;e<r.length;e+=1){var i=r[e],o=i[0];n.removeEventListener(o,i[1],o===t.window.document?this.handleWindowEvent:this.handleEvent,i[2])}},mi.prototype._addDefaultHandlers=function(t){var e=this._map,n=e.getCanvasContainer();this._add("mapEvent",new Br(e,t));var r=e.boxZoom=new Fr(e,t);this._add("boxZoom",r);var i=new Gr,o=new li;e.doubleClickZoom=new ui(o,i),this._add("tapZoom",i),this._add("clickZoom",o);var a=new ci;this._add("tapDragZoom",a);var s=e.touchPitch=new ri;this._add("touchPitch",s);var u=new Xr(t),l=new Yr(t);e.dragRotate=new fi(t,u,l),this._add("mouseRotate",u,["mousePitch"]),this._add("mousePitch",l,["mouseRotate"]);var c=new Hr(t),h=new qr(t);e.dragPan=new hi(n,c,h),this._add("mousePan",c),this._add("touchPan",h,["touchZoom","touchRotate"]);var f=new ei,p=new $r;e.touchZoomRotate=new pi(n,p,f,a),this._add("touchRotate",f,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]);var d=e.scrollZoom=new si(e,this);this._add("scrollZoom",d,["mousePan"]);var g=e.keyboard=new oi;this._add("keyboard",g),this._add("blockableMapEvent",new zr(e));for(var v=0,m=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];v<m.length;v+=1){var y=m[v];t.interactive&&t[y]&&e[y].enable(t[y])}},mi.prototype._add=function(t,e,n){this._handlers.push({handlerName:t,handler:e,allowed:n}),this._handlersById[t]=e},mi.prototype.stop=function(t){if(!this._updatingCamera){for(var e=0,n=this._handlers;e<n.length;e+=1)n[e].handler.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}},mi.prototype.isActive=function(){for(var t=0,e=this._handlers;t<e.length;t+=1)if(e[t].handler.isActive())return!0;return!1},mi.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},mi.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},mi.prototype.isMoving=function(){return Boolean(di(this._eventsInProgress))||this.isZooming()},mi.prototype._blockedByActive=function(t,e,n){for(var r in t)if(r!==n&&(!e||e.indexOf(r)<0))return!0;return!1},mi.prototype.handleWindowEvent=function(t){this.handleEvent(t,t.type+"Window")},mi.prototype._getMapTouches=function(t){for(var e=[],n=0,r=t;n<r.length;n+=1){var i=r[n];this._el.contains(i.target)&&e.push(i)}return e},mi.prototype.handleEvent=function(t,e){this._updatingCamera=!0;for(var r="renderFrame"===t.type?void 0:t,i={needsRenderFrame:!1},o={},a={},s=t.touches?this._getMapTouches(t.touches):void 0,u=s?n.touchPos(this._el,s):n.mousePos(this._el,t),l=0,c=this._handlers;l<c.length;l+=1){var h=c[l],f=h.handlerName,p=h.handler,d=h.allowed;if(p.isEnabled()){var g=void 0;this._blockedByActive(a,d,f)?p.reset():p[e||t.type]&&(g=p[e||t.type](t,u,s),this.mergeHandlerResult(i,o,g,f,r),g&&g.needsRenderFrame&&this._triggerRenderFrame()),(g||p.isActive())&&(a[f]=p)}}var v={};for(var m in this._previousActiveHandlers)a[m]||(v[m]=r);this._previousActiveHandlers=a,(Object.keys(v).length||vi(i))&&(this._changes.push([i,o,v]),this._triggerRenderFrame()),(Object.keys(a).length||vi(i))&&this._map._stop(!0),this._updatingCamera=!1;var y=i.cameraAnimation;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))},mi.prototype.mergeHandlerResult=function(e,n,r,i,o){if(r){t.extend(e,r);var a={handlerName:i,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(n.zoom=a),void 0!==r.panDelta&&(n.drag=a),void 0!==r.pitchDelta&&(n.pitch=a),void 0!==r.bearingDelta&&(n.rotate=a)}},mi.prototype._applyChanges=function(){for(var e={},n={},r={},i=0,o=this._changes;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1],l=a[2];s.panDelta&&(e.panDelta=(e.panDelta||new t.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(e.around=s.around),void 0!==s.pinchAround&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),t.extend(n,u),t.extend(r,l)}this._updateMapTransform(e,n,r),this._changes=[]},mi.prototype._updateMapTransform=function(t,e,n){var r=this._map,i=r.transform;if(!vi(t))return this._fireEvents(e,n,!0);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,u=t.pitchDelta,l=t.around,c=t.pinchAround;void 0!==c&&(l=c),r._stop(!0),l=l||r.transform.centerPoint;var h=i.pointLocation(o?l.sub(o):l);s&&(i.bearing+=s),u&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,l),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,n,!0)},mi.prototype._fireEvents=function(e,n,r){var i=this,o=di(this._eventsInProgress),a=di(e),s={};for(var u in e)this._eventsInProgress[u]||(s[u+"start"]=e[u].originalEvent),this._eventsInProgress[u]=e[u];for(var l in!o&&a&&this._fireEvent("movestart",a.originalEvent),s)this._fireEvent(l,s[l]);for(var c in a&&this._fireEvent("move",a.originalEvent),e)this._fireEvent(c,e[c].originalEvent);var h,f={};for(var p in this._eventsInProgress){var d=this._eventsInProgress[p],g=d.handlerName,v=d.originalEvent;this._handlersById[g].isActive()||(delete this._eventsInProgress[p],f[p+"end"]=h=n[g]||v)}for(var m in f)this._fireEvent(m,f[m]);var y=di(this._eventsInProgress);if(r&&(o||a)&&!y){this._updatingCamera=!0;var _=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),b=function(t){return 0!==t&&-i._bearingSnap<t&&t<i._bearingSnap};_?(b(_.bearing||this._map.getBearing())&&(_.bearing=0),this._map.easeTo(_,{originalEvent:h})):(this._map.fire(new t.Event("moveend",{originalEvent:h})),b(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},mi.prototype._fireEvent=function(e,n){this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))},mi.prototype._requestFrame=function(){var t=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(e){delete t._frameId,t.handleEvent(new gi("renderFrame",{timeStamp:e})),t._applyChanges()}))},mi.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var yi=function(e){function n(n,r){e.call(this),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=r.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},n.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},n.prototype.panBy=function(e,n,r){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},n),r)},n.prototype.panTo=function(e,n,r){return this.easeTo(t.extend({center:e},n),r)},n.prototype.getZoom=function(){return this.transform.zoom},n.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},n.prototype.zoomTo=function(e,n,r){return this.easeTo(t.extend({zoom:e},n),r)},n.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},n.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},n.prototype.getBearing=function(){return this.transform.bearing},n.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},n.prototype.getPadding=function(){return this.transform.padding},n.prototype.setPadding=function(t,e){return this.jumpTo({padding:t},e),this},n.prototype.rotateTo=function(e,n,r){return this.easeTo(t.extend({bearing:e},n),r)},n.prototype.resetNorth=function(e,n){return this.rotateTo(0,t.extend({duration:1e3},e),n),this},n.prototype.resetNorthPitch=function(e,n){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),n),this},n.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},n.prototype.getPitch=function(){return this.transform.pitch},n.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},n.prototype.cameraForBounds=function(e,n){e=t.LngLatBounds.convert(e);var r=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),r,n)},n.prototype._cameraForBoxAndBearing=function(e,n,r,i){var o={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=t.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var a=i.padding;i.padding={top:a,bottom:a,right:a,left:a}}i.padding=t.extend(o,i.padding);var s=this.transform,u=s.padding,l=s.project(t.LngLat.convert(e)),c=s.project(t.LngLat.convert(n)),h=l.rotate(-r*Math.PI/180),f=c.rotate(-r*Math.PI/180),p=new t.Point(Math.max(h.x,f.x),Math.max(h.y,f.y)),d=new t.Point(Math.min(h.x,f.x),Math.min(h.y,f.y)),g=p.sub(d),v=(s.width-(u.left+u.right+i.padding.left+i.padding.right))/g.x,m=(s.height-(u.top+u.bottom+i.padding.top+i.padding.bottom))/g.y;if(!(m<0||v<0)){var y=Math.min(s.scaleZoom(s.scale*Math.min(v,m)),i.maxZoom),_="number"==typeof i.offset.x?new t.Point(i.offset.x,i.offset.y):t.Point.convert(i.offset),b=new t.Point((i.padding.left-i.padding.right)/2,(i.padding.top-i.padding.bottom)/2).rotate(r*Math.PI/180),x=_.add(b).mult(s.scale/s.zoomScale(y));return{center:s.unproject(l.add(c).div(2).sub(x)),zoom:y,bearing:r}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},n.prototype.fitBounds=function(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)},n.prototype.fitScreenCoordinates=function(e,n,r,i,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(n)),r,i),i,o)},n.prototype._fitInternal=function(e,n,r){return e?(delete(n=t.extend(e,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this},n.prototype.jumpTo=function(e,n){this.stop();var r=this.transform,i=!1,o=!1,a=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(i=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=t.LngLat.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(o=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(a=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),i&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),o&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),a&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n))},n.prototype.easeTo=function(e,n){var r=this;this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l="zoom"in e?+e.zoom:o,c="bearing"in e?this._normalizeBearing(e.bearing,a):a,h="pitch"in e?+e.pitch:s,f="padding"in e?e.padding:i.padding,p=t.Point.convert(e.offset),d=i.centerPoint.add(p),g=i.pointLocation(d),v=t.LngLat.convert(e.center||g);this._normalizeCenter(v);var m,y,_=i.project(g),b=i.project(v).sub(_),x=i.zoomScale(l-o);e.around&&(m=t.LngLat.convert(e.around),y=i.locationPoint(m));var w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==o,this._rotating=this._rotating||a!==c,this._pitching=this._pitching||h!==s,this._padding=!i.isPaddingEqual(f),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,w),this._ease((function(e){if(r._zooming&&(i.zoom=t.number(o,l,e)),r._rotating&&(i.bearing=t.number(a,c,e)),r._pitching&&(i.pitch=t.number(s,h,e)),r._padding&&(i.interpolatePadding(u,f,e),d=i.centerPoint.add(p)),m)i.setLocationAtPoint(m,y);else{var g=i.zoomScale(i.zoom-o),v=l>o?Math.min(2,x):Math.max(.5,x),w=Math.pow(v,1-e),E=i.unproject(_.add(b.mult(e*w)).mult(g));i.setLocationAtPoint(i.renderWorldCopies?E.wrap():E,d)}r._fireMoveEvents(n)}),(function(t){r._afterEase(n,t)}),e),this},n.prototype._prepareEase=function(e,n,r){void 0===r&&(r={}),this._moving=!0,n||r.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.Event("pitchstart",e))},n.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},n.prototype._afterEase=function(e,n){if(!this._easeId||!n||this._easeId!==n){delete this._easeId;var r=this._zooming,i=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new t.Event("zoomend",e)),i&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}},n.prototype.flyTo=function(e,n){var r=this;if(!e.essential&&t.browser.prefersReducedMotion){var i=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,n)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var o=this.transform,a=this.getZoom(),s=this.getBearing(),u=this.getPitch(),l=this.getPadding(),c="zoom"in e?t.clamp(+e.zoom,o.minZoom,o.maxZoom):a,h="bearing"in e?this._normalizeBearing(e.bearing,s):s,f="pitch"in e?+e.pitch:u,p="padding"in e?e.padding:o.padding,d=o.zoomScale(c-a),g=t.Point.convert(e.offset),v=o.centerPoint.add(g),m=o.pointLocation(v),y=t.LngLat.convert(e.center||m);this._normalizeCenter(y);var _=o.project(m),b=o.project(y).sub(_),x=e.curve,w=Math.max(o.width,o.height),E=w/d,S=b.mag();if("minZoom"in e){var C=t.clamp(Math.min(e.minZoom,a,c),o.minZoom,o.maxZoom),A=w/o.zoomScale(C-a);x=Math.sqrt(A/S*2)}var T=x*x;function k(t){var e=(E*E-w*w+(t?-1:1)*T*T*S*S)/(2*(t?E:w)*T*S);return Math.log(Math.sqrt(e*e+1)-e)}function M(t){return(Math.exp(t)-Math.exp(-t))/2}function P(t){return(Math.exp(t)+Math.exp(-t))/2}var I=k(0),O=function(t){return P(I)/P(I+x*t)},R=function(t){return w*((P(I)*(M(e=I+x*t)/P(e))-M(I))/T)/S;var e},L=(k(1)-I)/x;if(Math.abs(S)<1e-6||!isFinite(L)){if(Math.abs(w-E)<1e-6)return this.easeTo(e,n);var D=E<w?-1:1;L=Math.abs(Math.log(E/w))/x,R=function(){return 0},O=function(t){return Math.exp(D*x*t)}}return e.duration="duration"in e?+e.duration:1e3*L/("screenSpeed"in e?+e.screenSpeed/x:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=f!==u,this._padding=!o.isPaddingEqual(p),this._prepareEase(n,!1),this._ease((function(e){var i=e*L,d=1/O(i);o.zoom=1===e?c:a+o.scaleZoom(d),r._rotating&&(o.bearing=t.number(s,h,e)),r._pitching&&(o.pitch=t.number(u,f,e)),r._padding&&(o.interpolatePadding(l,p,e),v=o.centerPoint.add(g));var m=1===e?y:o.unproject(_.add(b.mult(R(i))).mult(d));o.setLocationAtPoint(o.renderWorldCopies?m.wrap():m,v),r._fireMoveEvents(n)}),(function(){return r._afterEase(n)}),e),this},n.prototype.isEasing=function(){return!!this._easeFrameId},n.prototype.stop=function(){return this._stop()},n.prototype._stop=function(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var n=this._onEaseEnd;delete this._onEaseEnd,n.call(this,e)}if(!t){var r=this.handlers;r&&r.stop(!1)}return this},n.prototype._ease=function(e,n,r){!1===r.animate||0===r.duration?(e(1),n()):(this._easeStart=t.browser.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},n.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},n.prototype._normalizeBearing=function(e,n){e=t.wrap(e,-180,180);var r=Math.abs(e-n);return Math.abs(e-360-n)<r&&(e-=360),Math.abs(e+360-n)<r&&(e+=360),e},n.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}},n}(t.Evented),_i=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};_i.prototype.getDefaultPosition=function(){return"bottom-right"},_i.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=n.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=n.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},_i.prototype.onRemove=function(){n.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},_i.prototype._setElementTitle=function(t,e){var n=this._map._getUIString("AttributionControl."+e);t.title=n,t.setAttribute("aria-label",n)},_i.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},_i.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var r=n.reduce((function(t,e,r){return e.value&&(t+=e.key+"="+e.value+(r<n.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+r+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}},_i.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},_i.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return"string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var n=this._map.style.sourceCaches;for(var r in n){var i=n[r];if(i.used){var o=i.getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}}t.sort((function(t,e){return t.length-e.length}));var a=(t=t.filter((function(e,n){for(var r=n+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0}))).join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},_i.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var bi=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};bi.prototype.onAdd=function(t){this._map=t,this._container=n.create("div","mapboxgl-ctrl");var e=n.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},bi.prototype.onRemove=function(){n.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},bi.prototype.getDefaultPosition=function(){return"bottom-left"},bi.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},bi.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},bi.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var xi=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};xi.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},xi.prototype.remove=function(t){for(var e=this._currentlyRunning,n=0,r=e?this._queue.concat(e):this._queue;n<r.length;n+=1){var i=r[n];if(i.id===t)return void(i.cancelled=!0)}},xi.prototype.run=function(t){void 0===t&&(t=0);var e=this._currentlyRunning=this._queue;this._queue=[];for(var n=0,r=e;n<r.length;n+=1){var i=r[n];if(!i.cancelled&&(i.callback(t),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},xi.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var wi={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ei=t.window.HTMLImageElement,Si=t.window.HTMLElement,Ci=t.window.ImageBitmap,Ai={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Ti=function(r){function i(e){var n=this;if(null!=(e=t.extend({},Ai,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var i=new Er(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(r.call(this,i,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new xi,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},wi,e.locale),this._clickTolerance=e.clickTolerance,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Si))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return n._update(!1)})),this.on("moveend",(function(){return n._update(!1)})),this.on("zoom",(function(){return n._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new mi(this,e),this._hash=e.hash&&new Cr("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new _i({customAttribution:e.customAttribution})),this.addControl(new bi,e.logoPosition),this.on("style.load",(function(){n.transform.unmodified&&n.jumpTo(n.style.stylesheet)})),this.on("data",(function(e){n._update("style"===e.dataType),n.fire(new t.Event(e.dataType+"data",e))})),this.on("dataloading",(function(e){n.fire(new t.Event(e.dataType+"dataloading",e))}))}r&&(i.__proto__=r),(i.prototype=Object.create(r&&r.prototype)).constructor=i;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return i.prototype._getMapId=function(){return this._mapId},i.prototype.addControl=function(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var r=e.onAdd(this);this._controls.push(e);var i=this._controlPositions[n];return-1!==n.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this},i.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this},i.prototype.hasControl=function(t){return this._controls.indexOf(t)>-1},i.prototype.resize=function(e){var n=this._containerDimensions(),r=n[0],i=n[1];if(r===this.transform.width&&i===this.transform.height)return this;this._resizeCanvas(r,i),this.transform.resize(r,i),this.painter.resize(r,i);var o=!this._moving;return o&&this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)),this.fire(new t.Event("resize",e)),o&&this.fire(new t.Event("moveend",e)),this},i.prototype.getBounds=function(){return this.transform.getBounds()},i.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},i.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},i.prototype.setMinZoom=function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},i.prototype.getMinZoom=function(){return this.transform.minZoom},i.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},i.prototype.getMaxZoom=function(){return this.transform.maxZoom},i.prototype.setMinPitch=function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},i.prototype.getMinPitch=function(){return this.transform.minPitch},i.prototype.setMaxPitch=function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to 60");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},i.prototype.getMaxPitch=function(){return this.transform.maxPitch},i.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},i.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},i.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},i.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},i.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},i.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},i.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},i.prototype._createDelegatedListener=function(t,e,n){var r,i=this;if("mouseenter"===t||"mouseover"===t){var o=!1;return{layer:e,listener:n,delegates:{mousemove:function(r){var a=i.getLayer(e)?i.queryRenderedFeatures(r.point,{layers:[e]}):[];a.length?o||(o=!0,n.call(i,new Lr(t,i,r.originalEvent,{features:a}))):o=!1},mouseout:function(){o=!1}}}}if("mouseleave"===t||"mouseout"===t){var a=!1;return{layer:e,listener:n,delegates:{mousemove:function(r){(i.getLayer(e)?i.queryRenderedFeatures(r.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,n.call(i,new Lr(t,i,r.originalEvent)))},mouseout:function(e){a&&(a=!1,n.call(i,new Lr(t,i,e.originalEvent)))}}}}return{layer:e,listener:n,delegates:(r={},r[t]=function(t){var r=i.getLayer(e)?i.queryRenderedFeatures(t.point,{layers:[e]}):[];r.length&&(t.features=r,n.call(i,t),delete t.features)},r)}},i.prototype.on=function(t,e,n){if(void 0===n)return r.prototype.on.call(this,t,e);var i=this._createDelegatedListener(t,e,n);for(var o in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i),i.delegates)this.on(o,i.delegates[o]);return this},i.prototype.once=function(t,e,n){if(void 0===n)return r.prototype.once.call(this,t,e);var i=this._createDelegatedListener(t,e,n);for(var o in i.delegates)this.once(o,i.delegates[o]);return this},i.prototype.off=function(t,e,n){var i=this;return void 0===n?r.prototype.off.call(this,t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&function(r){for(var o=r[t],a=0;a<o.length;a++){var s=o[a];if(s.layer===e&&s.listener===n){for(var u in s.delegates)i.off(u,s.delegates[u]);return o.splice(a,1),i}}}(this._delegatedListeners),this)},i.prototype.queryRenderedFeatures=function(e,n){if(!this.style)return[];var r;if(void 0!==n||void 0===e||e instanceof t.Point||Array.isArray(e)||(n=e,e=void 0),n=n||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])r=[t.Point.convert(e)];else{var i=t.Point.convert(e[0]),o=t.Point.convert(e[1]);r=[i,new t.Point(o.x,i.y),o,new t.Point(i.x,o.y),i]}return this.style.queryRenderedFeatures(r,n,this.transform)},i.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},i.prototype.setStyle=function(e,n){return!1!==(n=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))},i.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},i.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Ge(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},i.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ge(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},i.prototype._diffStyle=function(e,n){var r=this;if("string"==typeof e){var i=this._requestManager.normalizeStyleURL(e),o=this._requestManager.transformRequest(i,t.ResourceType.Style);t.getJSON(o,(function(e,i){e?r.fire(new t.ErrorEvent(e)):i&&r._updateDiff(i,n)}))}else"object"==typeof e&&this._updateDiff(e,n)},i.prototype._updateDiff=function(e,n){try{this.style.setState(e)&&this._update(!0)}catch(r){t.warnOnce("Unable to perform style diff: "+(r.message||r.error||r)+".  Rebuilding the style from scratch."),this._updateStyle(e,n)}},i.prototype.getStyle=function(){if(this.style)return this.style.serialize()},i.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},i.prototype.addSource=function(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)},i.prototype.isSourceLoaded=function(e){var n=this.style&&this.style.sourceCaches[e];if(void 0!==n)return n.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},i.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var n=t[e]._tiles;for(var r in n){var i=n[r];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0},i.prototype.addSourceType=function(t,e,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)},i.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},i.prototype.getSource=function(t){return this.style.getSource(t)},i.prototype.addImage=function(e,n,r){void 0===r&&(r={});var i=r.pixelRatio;void 0===i&&(i=1);var o=r.sdf;void 0===o&&(o=!1);var a=r.stretchX,s=r.stretchY,u=r.content;if(this._lazyInitEmptyStyle(),n instanceof Ei||Ci&&n instanceof Ci){var l=t.browser.getImageData(n);this.style.addImage(e,{data:new t.RGBAImage({width:l.width,height:l.height},l.data),pixelRatio:i,stretchX:a,stretchY:s,content:u,sdf:o,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=n;this.style.addImage(e,{data:new t.RGBAImage({width:n.width,height:n.height},new Uint8Array(n.data)),pixelRatio:i,stretchX:a,stretchY:s,content:u,sdf:o,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}},i.prototype.updateImage=function(e,n){var r=this.style.getImage(e);if(!r)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var i=n instanceof Ei||Ci&&n instanceof Ci?t.browser.getImageData(n):n,o=i.width,a=i.height,s=i.data;return void 0===o||void 0===a?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==r.data.width||a!==r.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(s,!(n instanceof Ei||Ci&&n instanceof Ci)),void this.style.updateImage(e,r))},i.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},i.prototype.removeImage=function(t){this.style.removeImage(t)},i.prototype.loadImage=function(e,n){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),n)},i.prototype.listImages=function(){return this.style.listImages()},i.prototype.addLayer=function(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)},i.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},i.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},i.prototype.getLayer=function(t){return this.style.getLayer(t)},i.prototype.setLayerZoomRange=function(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)},i.prototype.setFilter=function(t,e,n){return void 0===n&&(n={}),this.style.setFilter(t,e,n),this._update(!0)},i.prototype.getFilter=function(t){return this.style.getFilter(t)},i.prototype.setPaintProperty=function(t,e,n,r){return void 0===r&&(r={}),this.style.setPaintProperty(t,e,n,r),this._update(!0)},i.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},i.prototype.setLayoutProperty=function(t,e,n,r){return void 0===r&&(r={}),this.style.setLayoutProperty(t,e,n,r),this._update(!0)},i.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},i.prototype.setLight=function(t,e){return void 0===e&&(e={}),this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)},i.prototype.getLight=function(){return this.style.getLight()},i.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},i.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},i.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},i.prototype.getContainer=function(){return this._container},i.prototype.getCanvasContainer=function(){return this._canvasContainer},i.prototype.getCanvas=function(){return this._canvas},i.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},i.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},i.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=n.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=n.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=n.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);var i=this._controlContainer=n.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){o[t]=n.create("div","mapboxgl-ctrl-"+t,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},i.prototype._resizeCanvas=function(e,n){var r=t.browser.devicePixelRatio||1;this._canvas.width=r*e,this._canvas.height=r*n,this._canvas.style.width=e+"px",this._canvas.style.height=n+"px"},i.prototype._setupPainter=function(){var n=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);r?(this.painter=new _r(r,this.transform),t.webpSupported.testSupport(r)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},i.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},i.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},i.prototype._onMapScroll=function(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},i.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},i.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},i.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},i.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},i.prototype._render=function(e){var n,r=this,i=0,o=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(n=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,n),i=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),!this._removed){var a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,u=t.browser.now();this.style.zoomHistory.update(s,u);var l=new t.EvaluationParameters(s,{now:u,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),c=l.crossFadingFactor();1===c&&c===this._crossFadingFactor||(a=!0,this._crossFadingFactor=c),this.style.update(l)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var h=t.browser.now()-i;o.endQueryEXT(o.TIME_ELAPSED_EXT,n),setTimeout((function(){var e=o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(n),r.fire(new t.Event("gpu-timing-frame",{cpuTime:h,gpuTime:e}))}),50)}if(this.listens("gpu-timing-layer")){var f=this.painter.collectGpuTimers();setTimeout((function(){var e=r.painter.queryGpuTimers(f);r.fire(new t.Event("gpu-timing-layer",{layerTimes:e}))}),50)}var p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0),this}},i.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,n=this._controls;e<n.length;e+=1)n[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),ki(this._canvasContainer),ki(this._controlContainer),ki(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new t.Event("remove"))},i.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(t){e._frame=null,e._render(t)})))},i.prototype._onWindowOnline=function(){this._update()},i.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(t){this._showPadding!==t&&(this._showPadding=t,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(t){this._vertices=t,this._update()},i.prototype._setCacheLimits=function(e,n){t.setCacheLimits(e,n)},o.version.get=function(){return t.version},Object.defineProperties(i.prototype,o),i}(yi);function ki(t){t.parentNode&&t.parentNode.removeChild(t)}var Mi={showCompass:!0,showZoom:!0,visualizePitch:!1},Pi=function(e){var r=this;this.options=t.extend({},Mi,e),this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(t){return r._map.zoomIn({},{originalEvent:t})})),n.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(t){return r._map.zoomOut({},{originalEvent:t})})),n.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(t){r.options.visualizePitch?r._map.resetNorthPitch({},{originalEvent:t}):r._map.resetNorth({},{originalEvent:t})})),this._compassIcon=n.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Pi.prototype._updateZoomButtons=function(){var t=this._map.getZoom(),e=t===this._map.getMaxZoom(),n=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},Pi.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t},Pi.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ii(this._map,this._compass,this.options.visualizePitch)),this._container},Pi.prototype.onRemove=function(){n.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Pi.prototype._createButton=function(t,e){var r=n.create("button",t,this._container);return r.type="button",r.addEventListener("click",e),r},Pi.prototype._setButtonTitle=function(t,e){var n=this._map._getUIString("NavigationControl."+e);t.title=n,t.setAttribute("aria-label",n)};var Ii=function(e,r,i){void 0===i&&(i=!1),this._clickTolerance=10,this.element=r,this.mouseRotate=new Xr({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new Yr({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener(r,"mousedown",this.mousedown),n.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),n.addEventListener(r,"touchmove",this.touchmove),n.addEventListener(r,"touchend",this.touchend),n.addEventListener(r,"touchcancel",this.reset)};function Oi(e,n,r){if(e=new t.LngLat(e.lng,e.lat),n){var i=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),a=r.locationPoint(e).distSqr(n);r.locationPoint(i).distSqr(n)<a?e=i:r.locationPoint(o).distSqr(n)<a&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){var s=r.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=r.width&&s.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}Ii.prototype.down=function(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),n.disableDrag()},Ii.prototype.move=function(t,e){var n=this.map,r=this.mouseRotate.mousemoveWindow(t,e);if(r&&r.bearingDelta&&n.setBearing(n.getBearing()+r.bearingDelta),this.mousePitch){var i=this.mousePitch.mousemoveWindow(t,e);i&&i.pitchDelta&&n.setPitch(n.getPitch()+i.pitchDelta)}},Ii.prototype.off=function(){var t=this.element;n.removeEventListener(t,"mousedown",this.mousedown),n.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),n.removeEventListener(t,"touchmove",this.touchmove),n.removeEventListener(t,"touchend",this.touchend),n.removeEventListener(t,"touchcancel",this.reset),this.offTemp()},Ii.prototype.offTemp=function(){n.enableDrag(),n.removeEventListener(t.window,"mousemove",this.mousemove),n.removeEventListener(t.window,"mouseup",this.mouseup)},Ii.prototype.mousedown=function(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:function(){return e.preventDefault()}}),n.mousePos(this.element,e)),n.addEventListener(t.window,"mousemove",this.mousemove),n.addEventListener(t.window,"mouseup",this.mouseup)},Ii.prototype.mousemove=function(t){this.move(t,n.mousePos(this.element,t))},Ii.prototype.mouseup=function(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()},Ii.prototype.touchstart=function(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=n.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return t.preventDefault()}},this._startPos))},Ii.prototype.touchmove=function(t){1!==t.targetTouches.length?this.reset():(this._lastPos=n.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:function(){return t.preventDefault()}},this._lastPos))},Ii.prototype.touchend=function(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ii.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ri={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Li(t,e,n){var r=t.classList;for(var i in Ri)r.remove("mapboxgl-"+n+"-anchor-"+i);r.add("mapboxgl-"+n+"-anchor-"+e)}var Di,Ni=function(e){function r(r,i){if(e.call(this),(r instanceof t.window.HTMLElement||i)&&(r=t.extend({element:r},i)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=t.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create("div"),this._element.setAttribute("aria-label","Map marker");var o=n.createNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","41px"),o.setAttributeNS(null,"width","27px"),o.setAttributeNS(null,"viewBox","0 0 27 41");var a=n.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");var s=n.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var u=n.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");for(var l=0,c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];l<c.length;l+=1){var h=c[l],f=n.createNS("http://www.w3.org/2000/svg","ellipse");f.setAttributeNS(null,"opacity","0.04"),f.setAttributeNS(null,"cx","10.5"),f.setAttributeNS(null,"cy","5.80029008"),f.setAttributeNS(null,"rx",h.rx),f.setAttributeNS(null,"ry",h.ry),u.appendChild(f)}var p=n.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"fill",this._color);var d=n.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),p.appendChild(d);var g=n.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"fill","#000000");var v=n.createNS("http://www.w3.org/2000/svg","path");v.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),g.appendChild(v);var m=n.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(6.0, 7.0)"),m.setAttributeNS(null,"fill","#FFFFFF");var y=n.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(8.0, 8.0)");var _=n.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#000000"),_.setAttributeNS(null,"opacity","0.25"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962");var b=n.createNS("http://www.w3.org/2000/svg","circle");b.setAttributeNS(null,"fill","#FFFFFF"),b.setAttributeNS(null,"cx","5.5"),b.setAttributeNS(null,"cy","5.5"),b.setAttributeNS(null,"r","5.4999962"),y.appendChild(_),y.appendChild(b),s.appendChild(u),s.appendChild(p),s.appendChild(g),s.appendChild(m),s.appendChild(y),o.appendChild(s),o.setAttributeNS(null,"height",41*this._scale+"px"),o.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(o),this._offset=t.Point.convert(r&&r.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault()})),this._element.addEventListener("mousedown",(function(t){t.preventDefault()})),Li(this._element,this._anchor,"marker"),this._popup=null}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},r.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},r.prototype.getElement=function(){return this._element},r.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},r.prototype._onKeyPress=function(t){var e=t.code,n=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==n&&13!==n||this.togglePopup()},r.prototype._onMapClick=function(t){var e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},r.prototype.getPopup=function(){return this._popup},r.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},r.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Oi(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),n.setTransform(this._element,Ri[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+r+" "+e)}},r.prototype.getOffset=function(){return this._offset},r.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},r.prototype._onMove=function(e){if(!this._isDragging){var n=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))},r.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},r.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},r.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},r.prototype.isDraggable=function(){return this._draggable},r.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},r.prototype.getRotation=function(){return this._rotation},r.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},r.prototype.getRotationAlignment=function(){return this._rotationAlignment},r.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},r.prototype.getPitchAlignment=function(){return this._pitchAlignment},r}(t.Evented),Bi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},zi=0,Fi=!1,Zi=function(e){function r(n){e.call(this),this.options=t.extend({},Bi,n),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.onAdd=function(e){var r;return this._map=e,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==Di?r(Di):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){r(Di="denied"!==t.state)})):r(Di=!!t.window.navigator.geolocation),this._container},r.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),n.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,zi=0,Fi=!1},r.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),n=t.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())},r.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},r.prototype._onSuccess=function(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}},r.prototype._updateCamera=function(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,i=this._map.getBearing(),o=t.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(r),o,{geolocateSource:!0})},r.prototype._updateMarker=function(e){if(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},r.prototype._updateCircleRadius=function(){var t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),n=this._map.unproject([1,t]),r=e.distanceTo(n),i=Math.ceil(2*this._accuracy/r);this._circleElement.style.width=i+"px",this._circleElement.style.height=i+"px"},r.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},r.prototype._onError=function(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Fi)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}},r.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},r.prototype._setupUI=function(e){var r=this;if(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=n.create("button","mapboxgl-ctrl-geolocate",this._container),n.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{var o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ni(this._dotElement),this._circleElement=n.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ni({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){e.geolocateSource||"ACTIVE_LOCK"!==r._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(r._watchState="BACKGROUND",r._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),r._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),r.fire(new t.Event("trackuserlocationend")))}))},r.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zi--,Fi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++zi>1?(e={maximumAge:6e5,timeout:0},Fi=!0):(e=this.options.positionOptions,Fi=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},r.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},r}(t.Evented),ji={maxWidth:100,unit:"metric"},Ui=function(e){this.options=t.extend({},ji,e),t.bindAll(["_onMove","setUnit"],this)};function Gi(t,e,n){var r=n&&n.maxWidth||100,i=t._container.clientHeight/2,o=t.unproject([0,i]),a=t.unproject([r,i]),s=o.distanceTo(a);if(n&&"imperial"===n.unit){var u=3.2808*s;u>5280?Vi(e,r,u/5280,t._getUIString("ScaleControl.Miles")):Vi(e,r,u,t._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?Vi(e,r,s/1852,t._getUIString("ScaleControl.NauticalMiles")):s>=1e3?Vi(e,r,s/1e3,t._getUIString("ScaleControl.Kilometers")):Vi(e,r,s,t._getUIString("ScaleControl.Meters"))}function Vi(t,e,n,r){var i,o,a,s=(i=n,(o=Math.pow(10,(""+Math.floor(i)).length-1))*(a=(a=i/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(a)));t.style.width=e*(s/n)+"px",t.innerHTML=s+"&nbsp;"+r}Ui.prototype.getDefaultPosition=function(){return"bottom-left"},Ui.prototype._onMove=function(){Gi(this._map,this._container,this.options)},Ui.prototype.onAdd=function(t){return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Ui.prototype.onRemove=function(){n.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Ui.prototype.setUnit=function(t){this.options.unit=t,Gi(this._map,this._container,this.options)};var Wi=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange")};Wi.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Wi.prototype.onRemove=function(){n.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Wi.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},Wi.prototype._setupUI=function(){var e=this._fullscreenButton=n.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);n.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Wi.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Wi.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Wi.prototype._isFullscreen=function(){return this._fullscreen},Wi.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Wi.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Hi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Xi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Yi=function(e){function r(n){e.call(this),this.options=t.extend(Object.create(Hi),n),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.addTo=function(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},r.prototype.isOpen=function(){return!!this._map},r.prototype.remove=function(){return this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},r.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},r.prototype.getElement=function(){return this._container},r.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},r.prototype.setHTML=function(e){var n,r=t.window.document.createDocumentFragment(),i=t.window.document.createElement("body");for(i.innerHTML=e;n=i.firstChild;)r.appendChild(n);return this.setDOMContent(r)},r.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},r.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},r.prototype.setDOMContent=function(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=n.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this},r.prototype.addClassName=function(t){this._container&&this._container.classList.add(t)},r.prototype.removeClassName=function(t){this._container&&this._container.classList.remove(t)},r.prototype.setOffset=function(t){return this.options.offset=t,this._update(),this},r.prototype.toggleClassName=function(t){if(this._container)return this._container.classList.toggle(t)},r.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=n.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},r.prototype._onMouseUp=function(t){this._update(t.point)},r.prototype._onMouseMove=function(t){this._update(t.point)},r.prototype._onDrag=function(t){this._update(t.point)},r.prototype._update=function(e){var r=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=n.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=n.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return r._container.classList.add(t)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Oi(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var i=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),o=this.options.anchor,a=function e(n){if(n){if("number"==typeof n){var r=Math.round(Math.sqrt(.5*Math.pow(n,2)));return{center:new t.Point(0,0),top:new t.Point(0,n),"top-left":new t.Point(r,r),"top-right":new t.Point(-r,r),bottom:new t.Point(0,-n),"bottom-left":new t.Point(r,-r),"bottom-right":new t.Point(-r,-r),left:new t.Point(n,0),right:new t.Point(-n,0)}}if(n instanceof t.Point||Array.isArray(n)){var i=t.Point.convert(n);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.Point.convert(n.center||[0,0]),top:t.Point.convert(n.top||[0,0]),"top-left":t.Point.convert(n["top-left"]||[0,0]),"top-right":t.Point.convert(n["top-right"]||[0,0]),bottom:t.Point.convert(n.bottom||[0,0]),"bottom-left":t.Point.convert(n["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(n["bottom-right"]||[0,0]),left:t.Point.convert(n.left||[0,0]),right:t.Point.convert(n.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!o){var s,u=this._container.offsetWidth,l=this._container.offsetHeight;s=i.y+a.bottom.y<l?["top"]:i.y>this._map.transform.height-l?["bottom"]:[],i.x<u/2?s.push("left"):i.x>this._map.transform.width-u/2&&s.push("right"),o=0===s.length?"bottom":s.join("-")}var c=i.add(a[o]).round();n.setTransform(this._container,Ri[o]+" translate("+c.x+"px,"+c.y+"px)"),Li(this._container,o,"popup")}},r.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var t=this._container.querySelector(Xi);t&&t.focus()}},r.prototype._onClose=function(){this.remove()},r}(t.Evented),qi={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:Ti,NavigationControl:Pi,GeolocateControl:Zi,AttributionControl:_i,ScaleControl:Ui,FullscreenControl:Wi,Popup:Yi,Marker:Ni,Style:Ge,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,prewarm:function(){zt().acquire(Lt)},clearPrewarmedResources:function(){var t=Nt;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Lt),Nt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Dt.workerCount},set workerCount(t){Dt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(e){t.clearTileCache(e)},workerUrl:""};return qi})),n}()},7418:t=>{"use strict";var e=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function i(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,o){for(var a,s,u=i(t),l=1;l<arguments.length;l++){for(var c in a=Object(arguments[l]))n.call(a,c)&&(u[c]=a[c]);if(e){s=e(a);for(var h=0;h<s.length;h++)r.call(a,s[h])&&(u[s[h]]=a[s[h]])}}return u}},582:(t,e,n)=>{var r=n(9550),i=n(8854),o=n(6820),a=n(3650),s=n(6601),u=[0,0];t.exports.x7=function(t,e,n,a,l){return r(t,n,a),o(t,t),i(e,-t[1],t[0]),i(u,-n[1],n[0]),l/s(e,u)},t.exports.mJ=function(t,e){return i(t,-e[1],e[0]),t},t.exports.o7=function(t,e,n){return a(t,e,n),o(t,t),t}},4448:(t,e,n)=>{"use strict";var r=n(7294),i=n(7418),o=n(3840);function a(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(a(227));var s=new Set,u={};function l(t,e){c(t,e),c(t+"Capture",e)}function c(t,e){for(u[t]=e,t=0;t<e.length;t++)s.add(e[t])}var h=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p=Object.prototype.hasOwnProperty,d={},g={};function v(t,e,n,r,i,o,a){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=a}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(t){m[t]=new v(t,0,!1,t,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(t){var e=t[0];m[e]=new v(e,1,!1,t[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(t){m[t]=new v(t,2,!1,t.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(t){m[t]=new v(t,2,!1,t,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(t){m[t]=new v(t,3,!1,t.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(t){m[t]=new v(t,3,!0,t,null,!1,!1)})),["capture","download"].forEach((function(t){m[t]=new v(t,4,!1,t,null,!1,!1)})),["cols","rows","size","span"].forEach((function(t){m[t]=new v(t,6,!1,t,null,!1,!1)})),["rowSpan","start"].forEach((function(t){m[t]=new v(t,5,!1,t.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function _(t){return t[1].toUpperCase()}function b(t,e,n,r){var i=m.hasOwnProperty(e)?m[e]:null;(null!==i?0===i.type:!r&&2<e.length&&("o"===e[0]||"O"===e[0])&&("n"===e[1]||"N"===e[1]))||(function(t,e,n,r){if(null==e||function(t,e,n,r){if(null!==n&&0===n.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(t=t.toLowerCase().slice(0,5))&&"aria-"!==t);default:return!1}}(t,e,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,n,i,r)&&(n=null),r||null===i?function(t){return!!p.call(g,t)||!p.call(d,t)&&(f.test(t)?g[t]=!0:(d[t]=!0,!1))}(e)&&(null===n?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=null===n?3!==i.type&&"":n:(e=i.attributeName,r=i.attributeNamespace,null===n?t.removeAttribute(e):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(t){var e=t.replace(y,_);m[e]=new v(e,1,!1,t,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(t){var e=t.replace(y,_);m[e]=new v(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(t){var e=t.replace(y,_);m[e]=new v(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(t){m[t]=new v(t,1,!1,t.toLowerCase(),null,!1,!1)})),m.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(t){m[t]=new v(t,1,!1,t.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=60103,E=60106,S=60107,C=60108,A=60114,T=60109,k=60110,M=60112,P=60113,I=60120,O=60115,R=60116,L=60121,D=60128,N=60129,B=60130,z=60131;if("function"==typeof Symbol&&Symbol.for){var F=Symbol.for;w=F("react.element"),E=F("react.portal"),S=F("react.fragment"),C=F("react.strict_mode"),A=F("react.profiler"),T=F("react.provider"),k=F("react.context"),M=F("react.forward_ref"),P=F("react.suspense"),I=F("react.suspense_list"),O=F("react.memo"),R=F("react.lazy"),L=F("react.block"),F("react.scope"),D=F("react.opaque.id"),N=F("react.debug_trace_mode"),B=F("react.offscreen"),z=F("react.legacy_hidden")}var Z,j="function"==typeof Symbol&&Symbol.iterator;function U(t){return null===t||"object"!=typeof t?null:"function"==typeof(t=j&&t[j]||t["@@iterator"])?t:null}function G(t){if(void 0===Z)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Z=e&&e[1]||""}return"\n"+Z+t}var V=!1;function W(t,e){if(!t||V)return"";V=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(t){var r=t}Reflect.construct(t,[],e)}else{try{e.call()}catch(t){r=t}t.call(e.prototype)}else{try{throw Error()}catch(t){r=t}t()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var i=t.stack.split("\n"),o=r.stack.split("\n"),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||i[a]!==o[s])return"\n"+i[a].replace(" at new "," at ")}while(1<=a&&0<=s);break}}}finally{V=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?G(t):""}function H(t){switch(t.tag){case 5:return G(t.type);case 16:return G("Lazy");case 13:return G("Suspense");case 19:return G("SuspenseList");case 0:case 2:case 15:return W(t.type,!1);case 11:return W(t.type.render,!1);case 22:return W(t.type._render,!1);case 1:return W(t.type,!0);default:return""}}function X(t){if(null==t)return null;if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t;switch(t){case S:return"Fragment";case E:return"Portal";case A:return"Profiler";case C:return"StrictMode";case P:return"Suspense";case I:return"SuspenseList"}if("object"==typeof t)switch(t.$$typeof){case k:return(t.displayName||"Context")+".Consumer";case T:return(t._context.displayName||"Context")+".Provider";case M:var e=t.render;return e=e.displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case O:return X(t.type);case L:return X(t._render);case R:e=t._payload,t=t._init;try{return X(t(e))}catch(t){}}return null}function Y(t){switch(typeof t){case"boolean":case"number":case"object":case"string":case"undefined":return t;default:return""}}function q(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function K(t){t._valueTracker||(t._valueTracker=function(t){var e=q(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(t){r=""+t,o.call(this,t)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(t){r=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function Q(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=q(t)?t.checked?"true":"false":t.value),(t=r)!==n&&(e.setValue(t),!0)}function J(t){if(void 0===(t=t||("undefined"!=typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function $(t,e){var n=e.checked;return i({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:t._wrapperState.initialChecked})}function tt(t,e){var n=null==e.defaultValue?"":e.defaultValue,r=null!=e.checked?e.checked:e.defaultChecked;n=Y(null!=e.value?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function et(t,e){null!=(e=e.checked)&&b(t,"checked",e,!1)}function nt(t,e){et(t,e);var n=Y(e.value),r=e.type;if(null!=n)"number"===r?(0===n&&""===t.value||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if("submit"===r||"reset"===r)return void t.removeAttribute("value");e.hasOwnProperty("value")?it(t,e.type,n):e.hasOwnProperty("defaultValue")&&it(t,e.type,Y(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(t.defaultChecked=!!e.defaultChecked)}function rt(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!("submit"!==r&&"reset"!==r||void 0!==e.value&&null!==e.value))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}""!==(n=t.name)&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,""!==n&&(t.name=n)}function it(t,e,n){"number"===e&&J(t.ownerDocument)===t||(null==n?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}function ot(t,e){return t=i({children:void 0},e),(e=function(t){var e="";return r.Children.forEach(t,(function(t){null!=t&&(e+=t)})),e}(e.children))&&(t.children=e),t}function at(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Y(n),e=null,i=0;i<t.length;i++){if(t[i].value===n)return t[i].selected=!0,void(r&&(t[i].defaultSelected=!0));null!==e||t[i].disabled||(e=t[i])}null!==e&&(e.selected=!0)}}function st(t,e){if(null!=e.dangerouslySetInnerHTML)throw Error(a(91));return i({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ut(t,e){var n=e.value;if(null==n){if(n=e.children,e=e.defaultValue,null!=n){if(null!=e)throw Error(a(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(a(93));n=n[0]}e=n}null==e&&(e=""),n=e}t._wrapperState={initialValue:Y(n)}}function lt(t,e){var n=Y(e.value),r=Y(e.defaultValue);null!=n&&((n=""+n)!==t.value&&(t.value=n),null==e.defaultValue&&t.defaultValue!==n&&(t.defaultValue=n)),null!=r&&(t.defaultValue=""+r)}function ct(t){var e=t.textContent;e===t._wrapperState.initialValue&&""!==e&&null!==e&&(t.value=e)}var ht="http://www.w3.org/1999/xhtml";function ft(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pt(t,e){return null==t||"http://www.w3.org/1999/xhtml"===t?ft(e):"http://www.w3.org/2000/svg"===t&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":t}var dt,gt,vt=(gt=function(t,e){if("http://www.w3.org/2000/svg"!==t.namespaceURI||"innerHTML"in t)t.innerHTML=e;else{for((dt=dt||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=dt.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,e,n,r){MSApp.execUnsafeLocalFunction((function(){return gt(t,e)}))}:gt);function mt(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&3===n.nodeType)return void(n.nodeValue=e)}t.textContent=e}var yt={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_t=["Webkit","ms","Moz","O"];function bt(t,e,n){return null==e||"boolean"==typeof e||""===e?"":n||"number"!=typeof e||0===e||yt.hasOwnProperty(t)&&yt[t]?(""+e).trim():e+"px"}function xt(t,e){for(var n in t=t.style,e)if(e.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=bt(n,e[n],r);"float"===n&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}Object.keys(yt).forEach((function(t){_t.forEach((function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),yt[e]=yt[t]}))}));var wt=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Et(t,e){if(e){if(wt[t]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(a(137,t));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(a(60));if("object"!=typeof e.dangerouslySetInnerHTML||!("__html"in e.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=e.style&&"object"!=typeof e.style)throw Error(a(62))}}function St(t,e){if(-1===t.indexOf("-"))return"string"==typeof e.is;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Ct(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var At=null,Tt=null,kt=null;function Mt(t){if(t=ni(t)){if("function"!=typeof At)throw Error(a(280));var e=t.stateNode;e&&(e=ii(e),At(t.stateNode,t.type,e))}}function Pt(t){Tt?kt?kt.push(t):kt=[t]:Tt=t}function It(){if(Tt){var t=Tt,e=kt;if(kt=Tt=null,Mt(t),e)for(t=0;t<e.length;t++)Mt(e[t])}}function Ot(t,e){return t(e)}function Rt(t,e,n,r,i){return t(e,n,r,i)}function Lt(){}var Dt=Ot,Nt=!1,Bt=!1;function zt(){null===Tt&&null===kt||(Lt(),It())}function Ft(t,e){var n=t.stateNode;if(null===n)return null;var r=ii(n);if(null===r)return null;n=r[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!r;break t;default:t=!1}if(t)return null;if(n&&"function"!=typeof n)throw Error(a(231,e,typeof n));return n}var Zt=!1;if(h)try{var jt={};Object.defineProperty(jt,"passive",{get:function(){Zt=!0}}),window.addEventListener("test",jt,jt),window.removeEventListener("test",jt,jt)}catch(gt){Zt=!1}function Ut(t,e,n,r,i,o,a,s,u){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(t){this.onError(t)}}var Gt=!1,Vt=null,Wt=!1,Ht=null,Xt={onError:function(t){Gt=!0,Vt=t}};function Yt(t,e,n,r,i,o,a,s,u){Gt=!1,Vt=null,Ut.apply(Xt,arguments)}function qt(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!=(1026&(e=t).flags)&&(n=e.return),t=e.return}while(t)}return 3===e.tag?n:null}function Kt(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&null!==(t=t.alternate)&&(e=t.memoizedState),null!==e)return e.dehydrated}return null}function Qt(t){if(qt(t)!==t)throw Error(a(188))}function Jt(t){if(t=function(t){var e=t.alternate;if(!e){if(null===(e=qt(t)))throw Error(a(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return Qt(i),t;if(o===r)return Qt(i),e;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,u=i.child;u;){if(u===n){s=!0,n=i,r=o;break}if(u===r){s=!0,r=i,n=o;break}u=u.sibling}if(!s){for(u=o.child;u;){if(u===n){s=!0,n=o,r=i;break}if(u===r){s=!0,r=o,n=i;break}u=u.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?t:e}(t),!t)return null;for(var e=t;;){if(5===e.tag||6===e.tag)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===t)break;for(;!e.sibling;){if(!e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function $t(t,e){for(var n=t.alternate;null!==e;){if(e===t||e===n)return!0;e=e.return}return!1}var te,ee,ne,re,ie=!1,oe=[],ae=null,se=null,ue=null,le=new Map,ce=new Map,he=[],fe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function pe(t,e,n,r,i){return{blockedOn:t,domEventName:e,eventSystemFlags:16|n,nativeEvent:i,targetContainers:[r]}}function de(t,e){switch(t){case"focusin":case"focusout":ae=null;break;case"dragenter":case"dragleave":se=null;break;case"mouseover":case"mouseout":ue=null;break;case"pointerover":case"pointerout":le.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ce.delete(e.pointerId)}}function ge(t,e,n,r,i,o){return null===t||t.nativeEvent!==o?(t=pe(e,n,r,i,o),null!==e&&null!==(e=ni(e))&&ee(e),t):(t.eventSystemFlags|=r,e=t.targetContainers,null!==i&&-1===e.indexOf(i)&&e.push(i),t)}function ve(t){var e=ei(t.target);if(null!==e){var n=qt(e);if(null!==n)if(13===(e=n.tag)){if(null!==(e=Kt(n)))return t.blockedOn=e,void re(t.lanePriority,(function(){o.unstable_runWithPriority(t.priority,(function(){ne(n)}))}))}else if(3===e&&n.stateNode.hydrate)return void(t.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}t.blockedOn=null}function me(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var n=Je(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==n)return null!==(e=ni(n))&&ee(e),t.blockedOn=n,!1;e.shift()}return!0}function ye(t,e,n){me(t)&&n.delete(e)}function _e(){for(ie=!1;0<oe.length;){var t=oe[0];if(null!==t.blockedOn){null!==(t=ni(t.blockedOn))&&te(t);break}for(var e=t.targetContainers;0<e.length;){var n=Je(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==n){t.blockedOn=n;break}e.shift()}null===t.blockedOn&&oe.shift()}null!==ae&&me(ae)&&(ae=null),null!==se&&me(se)&&(se=null),null!==ue&&me(ue)&&(ue=null),le.forEach(ye),ce.forEach(ye)}function be(t,e){t.blockedOn===e&&(t.blockedOn=null,ie||(ie=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,_e)))}function xe(t){function e(e){return be(e,t)}if(0<oe.length){be(oe[0],t);for(var n=1;n<oe.length;n++){var r=oe[n];r.blockedOn===t&&(r.blockedOn=null)}}for(null!==ae&&be(ae,t),null!==se&&be(se,t),null!==ue&&be(ue,t),le.forEach(e),ce.forEach(e),n=0;n<he.length;n++)(r=he[n]).blockedOn===t&&(r.blockedOn=null);for(;0<he.length&&null===(n=he[0]).blockedOn;)ve(n),null===n.blockedOn&&he.shift()}function we(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ee={animationend:we("Animation","AnimationEnd"),animationiteration:we("Animation","AnimationIteration"),animationstart:we("Animation","AnimationStart"),transitionend:we("Transition","TransitionEnd")},Se={},Ce={};function Ae(t){if(Se[t])return Se[t];if(!Ee[t])return t;var e,n=Ee[t];for(e in n)if(n.hasOwnProperty(e)&&e in Ce)return Se[t]=n[e];return t}h&&(Ce=document.createElement("div").style,"AnimationEvent"in window||(delete Ee.animationend.animation,delete Ee.animationiteration.animation,delete Ee.animationstart.animation),"TransitionEvent"in window||delete Ee.transitionend.transition);var Te=Ae("animationend"),ke=Ae("animationiteration"),Me=Ae("animationstart"),Pe=Ae("transitionend"),Ie=new Map,Oe=new Map,Re=["abort","abort",Te,"animationEnd",ke,"animationIteration",Me,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Pe,"transitionEnd","waiting","waiting"];function Le(t,e){for(var n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];i="on"+(i[0].toUpperCase()+i.slice(1)),Oe.set(r,e),Ie.set(r,i),l(i,[r])}}(0,o.unstable_now)();var De=8;function Ne(t){if(0!=(1&t))return De=15,1;if(0!=(2&t))return De=14,2;if(0!=(4&t))return De=13,4;var e=24&t;return 0!==e?(De=12,e):0!=(32&t)?(De=11,32):0!=(e=192&t)?(De=10,e):0!=(256&t)?(De=9,256):0!=(e=3584&t)?(De=8,e):0!=(4096&t)?(De=7,4096):0!=(e=4186112&t)?(De=6,e):0!=(e=62914560&t)?(De=5,e):67108864&t?(De=4,67108864):0!=(134217728&t)?(De=3,134217728):0!=(e=805306368&t)?(De=2,e):0!=(1073741824&t)?(De=1,1073741824):(De=8,t)}function Be(t,e){var n=t.pendingLanes;if(0===n)return De=0;var r=0,i=0,o=t.expiredLanes,a=t.suspendedLanes,s=t.pingedLanes;if(0!==o)r=o,i=De=15;else if(0!=(o=134217727&n)){var u=o&~a;0!==u?(r=Ne(u),i=De):0!=(s&=o)&&(r=Ne(s),i=De)}else 0!=(o=n&~a)?(r=Ne(o),i=De):0!==s&&(r=Ne(s),i=De);if(0===r)return 0;if(r=n&((0>(r=31-Ge(r))?0:1<<r)<<1)-1,0!==e&&e!==r&&0==(e&a)){if(Ne(e),i<=De)return e;De=i}if(0!==(e=t.entangledLanes))for(t=t.entanglements,e&=r;0<e;)i=1<<(n=31-Ge(e)),r|=t[n],e&=~i;return r}function ze(t){return 0!=(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function Fe(t,e){switch(t){case 15:return 1;case 14:return 2;case 12:return 0===(t=Ze(24&~e))?Fe(10,e):t;case 10:return 0===(t=Ze(192&~e))?Fe(8,e):t;case 8:return 0===(t=Ze(3584&~e))&&0===(t=Ze(4186112&~e))&&(t=512),t;case 2:return 0===(e=Ze(805306368&~e))&&(e=268435456),e}throw Error(a(358,t))}function Ze(t){return t&-t}function je(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ue(t,e,n){t.pendingLanes|=e;var r=e-1;t.suspendedLanes&=r,t.pingedLanes&=r,(t=t.eventTimes)[e=31-Ge(e)]=n}var Ge=Math.clz32?Math.clz32:function(t){return 0===t?32:31-(Ve(t)/We|0)|0},Ve=Math.log,We=Math.LN2,He=o.unstable_UserBlockingPriority,Xe=o.unstable_runWithPriority,Ye=!0;function qe(t,e,n,r){Nt||Lt();var i=Qe,o=Nt;Nt=!0;try{Rt(i,t,e,n,r)}finally{(Nt=o)||zt()}}function Ke(t,e,n,r){Xe(He,Qe.bind(null,t,e,n,r))}function Qe(t,e,n,r){var i;if(Ye)if((i=0==(4&e))&&0<oe.length&&-1<fe.indexOf(t))t=pe(null,t,e,n,r),oe.push(t);else{var o=Je(t,e,n,r);if(null===o)i&&de(t,r);else{if(i){if(-1<fe.indexOf(t))return t=pe(o,t,e,n,r),void oe.push(t);if(function(t,e,n,r,i){switch(e){case"focusin":return ae=ge(ae,t,e,n,r,i),!0;case"dragenter":return se=ge(se,t,e,n,r,i),!0;case"mouseover":return ue=ge(ue,t,e,n,r,i),!0;case"pointerover":var o=i.pointerId;return le.set(o,ge(le.get(o)||null,t,e,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,ce.set(o,ge(ce.get(o)||null,t,e,n,r,i)),!0}return!1}(o,t,e,n,r))return;de(t,r)}Lr(t,e,r,null,n)}}}function Je(t,e,n,r){var i=Ct(r);if(null!==(i=ei(i))){var o=qt(i);if(null===o)i=null;else{var a=o.tag;if(13===a){if(null!==(i=Kt(o)))return i;i=null}else if(3===a){if(o.stateNode.hydrate)return 3===o.tag?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return Lr(t,e,r,i,n),null}var $e=null,tn=null,en=null;function nn(){if(en)return en;var t,e,n=tn,r=n.length,i="value"in $e?$e.value:$e.textContent,o=i.length;for(t=0;t<r&&n[t]===i[t];t++);var a=r-t;for(e=1;e<=a&&n[r-e]===i[o-e];e++);return en=i.slice(t,1<e?1-e:void 0)}function rn(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function on(){return!0}function an(){return!1}function sn(t){function e(e,n,r,i,o){for(var a in this._reactName=e,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,t)t.hasOwnProperty(a)&&(e=t[a],this[a]=e?e(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?on:an,this.isPropagationStopped=an,this}return i(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!=typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=on)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!=typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=on)},persist:function(){},isPersistent:on}),e}var un,ln,cn,hn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fn=sn(hn),pn=i({},hn,{view:0,detail:0}),dn=sn(pn),gn=i({},pn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tn,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==cn&&(cn&&"mousemove"===t.type?(un=t.screenX-cn.screenX,ln=t.screenY-cn.screenY):ln=un=0,cn=t),un)},movementY:function(t){return"movementY"in t?t.movementY:ln}}),vn=sn(gn),mn=sn(i({},gn,{dataTransfer:0})),yn=sn(i({},pn,{relatedTarget:0})),_n=sn(i({},hn,{animationName:0,elapsedTime:0,pseudoElement:0})),bn=i({},hn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),xn=sn(bn),wn=sn(i({},hn,{data:0})),En={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function An(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=Cn[t])&&!!e[t]}function Tn(){return An}var kn=i({},pn,{key:function(t){if(t.key){var e=En[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=rn(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?Sn[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,charCode:function(t){return"keypress"===t.type?rn(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?rn(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}}),Mn=sn(kn),Pn=sn(i({},gn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=sn(i({},pn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tn})),On=sn(i({},hn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=i({},gn,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Ln=sn(Rn),Dn=[9,13,27,32],Nn=h&&"CompositionEvent"in window,Bn=null;h&&"documentMode"in document&&(Bn=document.documentMode);var zn=h&&"TextEvent"in window&&!Bn,Fn=h&&(!Nn||Bn&&8<Bn&&11>=Bn),Zn=String.fromCharCode(32),jn=!1;function Un(t,e){switch(t){case"keyup":return-1!==Dn.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gn(t){return"object"==typeof(t=t.detail)&&"data"in t?t.data:null}var Vn=!1,Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!Wn[t.type]:"textarea"===e}function Xn(t,e,n,r){Pt(r),0<(e=Nr(e,"onChange")).length&&(n=new fn("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Yn=null,qn=null;function Kn(t){kr(t,0)}function Qn(t){if(Q(ri(t)))return t}function Jn(t,e){if("change"===t)return e}var $n=!1;if(h){var tr;if(h){var er="oninput"in document;if(!er){var nr=document.createElement("div");nr.setAttribute("oninput","return;"),er="function"==typeof nr.oninput}tr=er}else tr=!1;$n=tr&&(!document.documentMode||9<document.documentMode)}function rr(){Yn&&(Yn.detachEvent("onpropertychange",ir),qn=Yn=null)}function ir(t){if("value"===t.propertyName&&Qn(qn)){var e=[];if(Xn(e,qn,t,Ct(t)),t=Kn,Nt)t(e);else{Nt=!0;try{Ot(t,e)}finally{Nt=!1,zt()}}}}function or(t,e,n){"focusin"===t?(rr(),qn=n,(Yn=e).attachEvent("onpropertychange",ir)):"focusout"===t&&rr()}function ar(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return Qn(qn)}function sr(t,e){if("click"===t)return Qn(e)}function ur(t,e){if("input"===t||"change"===t)return Qn(e)}var lr="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},cr=Object.prototype.hasOwnProperty;function hr(t,e){if(lr(t,e))return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!cr.call(e,n[r])||!lr(t[n[r]],e[n[r]]))return!1;return!0}function fr(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function pr(t,e){var n,r=fr(t);for(t=0;r;){if(3===r.nodeType){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}t:{for(;r;){if(r.nextSibling){r=r.nextSibling;break t}r=r.parentNode}r=void 0}r=fr(r)}}function dr(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?dr(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function gr(){for(var t=window,e=J();e instanceof t.HTMLIFrameElement;){try{var n="string"==typeof e.contentWindow.location.href}catch(t){n=!1}if(!n)break;e=J((t=e.contentWindow).document)}return e}function vr(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}var mr=h&&"documentMode"in document&&11>=document.documentMode,yr=null,_r=null,br=null,xr=!1;function wr(t,e,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;xr||null==yr||yr!==J(r)||(r="selectionStart"in(r=yr)&&vr(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},br&&hr(br,r)||(br=r,0<(r=Nr(_r,"onSelect")).length&&(e=new fn("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=yr)))}Le("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Le("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Le(Re,2);for(var Er="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Sr=0;Sr<Er.length;Sr++)Oe.set(Er[Sr],0);c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Cr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ar=new Set("cancel close invalid load scroll toggle".split(" ").concat(Cr));function Tr(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,function(t,e,n,r,i,o,s,u,l){if(Yt.apply(this,arguments),Gt){if(!Gt)throw Error(a(198));var c=Vt;Gt=!1,Vt=null,Wt||(Wt=!0,Ht=c)}}(r,e,void 0,t),t.currentTarget=null}function kr(t,e){e=0!=(4&e);for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;t:{var o=void 0;if(e)for(var a=r.length-1;0<=a;a--){var s=r[a],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==o&&i.isPropagationStopped())break t;Tr(i,s,l),o=u}else for(a=0;a<r.length;a++){if(u=(s=r[a]).instance,l=s.currentTarget,s=s.listener,u!==o&&i.isPropagationStopped())break t;Tr(i,s,l),o=u}}}if(Wt)throw t=Ht,Wt=!1,Ht=null,t}function Mr(t,e){var n=oi(e),r=t+"__bubble";n.has(r)||(Rr(e,t,2,!1),n.add(r))}var Pr="_reactListening"+Math.random().toString(36).slice(2);function Ir(t){t[Pr]||(t[Pr]=!0,s.forEach((function(e){Ar.has(e)||Or(e,!1,t,null),Or(e,!0,t,null)})))}function Or(t,e,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=n;if("selectionchange"===t&&9!==n.nodeType&&(o=n.ownerDocument),null!==r&&!e&&Ar.has(t)){if("scroll"!==t)return;i|=2,o=r}var a=oi(o),s=t+"__"+(e?"capture":"bubble");a.has(s)||(e&&(i|=4),Rr(o,t,i,e),a.add(s))}function Rr(t,e,n,r){var i=Oe.get(e);switch(void 0===i?2:i){case 0:i=qe;break;case 1:i=Ke;break;default:i=Qe}n=i.bind(null,e,n,t),i=void 0,!Zt||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(i=!0),r?void 0!==i?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):void 0!==i?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Lr(t,e,n,r,i){var o=r;if(0==(1&e)&&0==(2&e)&&null!==r)t:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===a)for(a=r.return;null!==a;){var u=a.tag;if((3===u||4===u)&&((u=a.stateNode.containerInfo)===i||8===u.nodeType&&u.parentNode===i))return;a=a.return}for(;null!==s;){if(null===(a=ei(s)))return;if(5===(u=a.tag)||6===u){r=o=a;continue t}s=s.parentNode}}r=r.return}!function(t,e,n){if(Bt)return t();Bt=!0;try{Dt(t,e,n)}finally{Bt=!1,zt()}}((function(){var r=o,i=Ct(n),a=[];t:{var s=Ie.get(t);if(void 0!==s){var u=fn,l=t;switch(t){case"keypress":if(0===rn(n))break t;case"keydown":case"keyup":u=Mn;break;case"focusin":l="focus",u=yn;break;case"focusout":l="blur",u=yn;break;case"beforeblur":case"afterblur":u=yn;break;case"click":if(2===n.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=vn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=In;break;case Te:case ke:case Me:u=_n;break;case Pe:u=On;break;case"scroll":u=dn;break;case"wheel":u=Ln;break;case"copy":case"cut":case"paste":u=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=Pn}var c=0!=(4&e),h=!c&&"scroll"===t,f=c?null!==s?s+"Capture":null:s;c=[];for(var p,d=r;null!==d;){var g=(p=d).stateNode;if(5===p.tag&&null!==g&&(p=g,null!==f&&null!=(g=Ft(d,f))&&c.push(Dr(d,g,p))),h)break;d=d.return}0<c.length&&(s=new u(s,l,null,n,i),a.push({event:s,listeners:c}))}}if(0==(7&e)){if(u="mouseout"===t||"pointerout"===t,(!(s="mouseover"===t||"pointerover"===t)||0!=(16&e)||!(l=n.relatedTarget||n.fromElement)||!ei(l)&&!l[$r])&&(u||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(l=(l=n.relatedTarget||n.toElement)?ei(l):null)&&(l!==(h=qt(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(u=null,l=r),u!==l)){if(c=vn,g="onMouseLeave",f="onMouseEnter",d="mouse","pointerout"!==t&&"pointerover"!==t||(c=Pn,g="onPointerLeave",f="onPointerEnter",d="pointer"),h=null==u?s:ri(u),p=null==l?s:ri(l),(s=new c(g,d+"leave",u,n,i)).target=h,s.relatedTarget=p,g=null,ei(i)===r&&((c=new c(f,d+"enter",l,n,i)).target=p,c.relatedTarget=h,g=c),h=g,u&&l)t:{for(f=l,d=0,p=c=u;p;p=Br(p))d++;for(p=0,g=f;g;g=Br(g))p++;for(;0<d-p;)c=Br(c),d--;for(;0<p-d;)f=Br(f),p--;for(;d--;){if(c===f||null!==f&&c===f.alternate)break t;c=Br(c),f=Br(f)}c=null}else c=null;null!==u&&zr(a,s,u,c,!1),null!==l&&null!==h&&zr(a,h,l,c,!0)}if("select"===(u=(s=r?ri(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var v=Jn;else if(Hn(s))if($n)v=ur;else{v=ar;var m=or}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(v=sr);switch(v&&(v=v(t,r))?Xn(a,v,n,i):(m&&m(t,s,r),"focusout"===t&&(m=s._wrapperState)&&m.controlled&&"number"===s.type&&it(s,"number",s.value)),m=r?ri(r):window,t){case"focusin":(Hn(m)||"true"===m.contentEditable)&&(yr=m,_r=r,br=null);break;case"focusout":br=_r=yr=null;break;case"mousedown":xr=!0;break;case"contextmenu":case"mouseup":case"dragend":xr=!1,wr(a,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":wr(a,n,i)}var y;if(Nn)t:{switch(t){case"compositionstart":var _="onCompositionStart";break t;case"compositionend":_="onCompositionEnd";break t;case"compositionupdate":_="onCompositionUpdate";break t}_=void 0}else Vn?Un(t,n)&&(_="onCompositionEnd"):"keydown"===t&&229===n.keyCode&&(_="onCompositionStart");_&&(Fn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Vn&&(y=nn()):(tn="value"in($e=i)?$e.value:$e.textContent,Vn=!0)),0<(m=Nr(r,_)).length&&(_=new wn(_,t,null,n,i),a.push({event:_,listeners:m}),(y||null!==(y=Gn(n)))&&(_.data=y))),(y=zn?function(t,e){switch(t){case"compositionend":return Gn(e);case"keypress":return 32!==e.which?null:(jn=!0,Zn);case"textInput":return(t=e.data)===Zn&&jn?null:t;default:return null}}(t,n):function(t,e){if(Vn)return"compositionend"===t||!Nn&&Un(t,e)?(t=nn(),en=tn=$e=null,Vn=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Fn&&"ko"!==e.locale?null:e.data}}(t,n))&&0<(r=Nr(r,"onBeforeInput")).length&&(i=new wn("onBeforeInput","beforeinput",null,n,i),a.push({event:i,listeners:r}),i.data=y)}kr(a,e)}))}function Dr(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Nr(t,e){for(var n=e+"Capture",r=[];null!==t;){var i=t,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=Ft(t,n))&&r.unshift(Dr(t,o,i)),null!=(o=Ft(t,e))&&r.push(Dr(t,o,i))),t=t.return}return r}function Br(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag);return t||null}function zr(t,e,n,r,i){for(var o=e._reactName,a=[];null!==n&&n!==r;){var s=n,u=s.alternate,l=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==l&&(s=l,i?null!=(u=Ft(n,o))&&a.unshift(Dr(n,u,s)):i||null!=(u=Ft(n,o))&&a.push(Dr(n,u,s))),n=n.return}0!==a.length&&t.push({event:e,listeners:a})}function Fr(){}var Zr=null,jr=null;function Ur(t,e){switch(t){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function Gr(t,e){return"textarea"===t||"option"===t||"noscript"===t||"string"==typeof e.children||"number"==typeof e.children||"object"==typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var Vr="function"==typeof setTimeout?setTimeout:void 0,Wr="function"==typeof clearTimeout?clearTimeout:void 0;function Hr(t){(1===t.nodeType||9===t.nodeType&&null!=(t=t.body))&&(t.textContent="")}function Xr(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break}return t}function Yr(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var n=t.data;if("$"===n||"$!"===n||"$?"===n){if(0===e)return t;e--}else"/$"===n&&e++}t=t.previousSibling}return null}var qr=0,Kr=Math.random().toString(36).slice(2),Qr="__reactFiber$"+Kr,Jr="__reactProps$"+Kr,$r="__reactContainer$"+Kr,ti="__reactEvents$"+Kr;function ei(t){var e=t[Qr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[$r]||n[Qr]){if(n=e.alternate,null!==e.child||null!==n&&null!==n.child)for(t=Yr(t);null!==t;){if(n=t[Qr])return n;t=Yr(t)}return e}n=(t=n).parentNode}return null}function ni(t){return!(t=t[Qr]||t[$r])||5!==t.tag&&6!==t.tag&&13!==t.tag&&3!==t.tag?null:t}function ri(t){if(5===t.tag||6===t.tag)return t.stateNode;throw Error(a(33))}function ii(t){return t[Jr]||null}function oi(t){var e=t[ti];return void 0===e&&(e=t[ti]=new Set),e}var ai=[],si=-1;function ui(t){return{current:t}}function li(t){0>si||(t.current=ai[si],ai[si]=null,si--)}function ci(t,e){si++,ai[si]=t.current,t.current=e}var hi={},fi=ui(hi),pi=ui(!1),di=hi;function gi(t,e){var n=t.type.contextTypes;if(!n)return hi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=e[i];return r&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function vi(t){return null!=t.childContextTypes}function mi(){li(pi),li(fi)}function yi(t,e,n){if(fi.current!==hi)throw Error(a(168));ci(fi,e),ci(pi,n)}function _i(t,e,n){var r=t.stateNode;if(t=e.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in t))throw Error(a(108,X(e)||"Unknown",o));return i({},n,r)}function bi(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||hi,di=fi.current,ci(fi,t),ci(pi,pi.current),!0}function xi(t,e,n){var r=t.stateNode;if(!r)throw Error(a(169));n?(t=_i(t,e,di),r.__reactInternalMemoizedMergedChildContext=t,li(pi),li(fi),ci(fi,t)):li(pi),ci(pi,n)}var wi=null,Ei=null,Si=o.unstable_runWithPriority,Ci=o.unstable_scheduleCallback,Ai=o.unstable_cancelCallback,Ti=o.unstable_shouldYield,ki=o.unstable_requestPaint,Mi=o.unstable_now,Pi=o.unstable_getCurrentPriorityLevel,Ii=o.unstable_ImmediatePriority,Oi=o.unstable_UserBlockingPriority,Ri=o.unstable_NormalPriority,Li=o.unstable_LowPriority,Di=o.unstable_IdlePriority,Ni={},Bi=void 0!==ki?ki:function(){},zi=null,Fi=null,Zi=!1,ji=Mi(),Ui=1e4>ji?Mi:function(){return Mi()-ji};function Gi(){switch(Pi()){case Ii:return 99;case Oi:return 98;case Ri:return 97;case Li:return 96;case Di:return 95;default:throw Error(a(332))}}function Vi(t){switch(t){case 99:return Ii;case 98:return Oi;case 97:return Ri;case 96:return Li;case 95:return Di;default:throw Error(a(332))}}function Wi(t,e){return t=Vi(t),Si(t,e)}function Hi(t,e,n){return t=Vi(t),Ci(t,e,n)}function Xi(){if(null!==Fi){var t=Fi;Fi=null,Ai(t)}Yi()}function Yi(){if(!Zi&&null!==zi){Zi=!0;var t=0;try{var e=zi;Wi(99,(function(){for(;t<e.length;t++){var n=e[t];do{n=n(!0)}while(null!==n)}})),zi=null}catch(e){throw null!==zi&&(zi=zi.slice(t+1)),Ci(Ii,Xi),e}finally{Zi=!1}}}var qi=x.ReactCurrentBatchConfig;function Ki(t,e){if(t&&t.defaultProps){for(var n in e=i({},e),t=t.defaultProps)void 0===e[n]&&(e[n]=t[n]);return e}return e}var Qi=ui(null),Ji=null,$i=null,to=null;function eo(){to=$i=Ji=null}function no(t){var e=Qi.current;li(Qi),t.type._context._currentValue=e}function ro(t,e){for(;null!==t;){var n=t.alternate;if((t.childLanes&e)===e){if(null===n||(n.childLanes&e)===e)break;n.childLanes|=e}else t.childLanes|=e,null!==n&&(n.childLanes|=e);t=t.return}}function io(t,e){Ji=t,to=$i=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!=(t.lanes&e)&&(Na=!0),t.firstContext=null)}function oo(t,e){if(to!==t&&!1!==e&&0!==e)if("number"==typeof e&&1073741823!==e||(to=t,e=1073741823),e={context:t,observedBits:e,next:null},null===$i){if(null===Ji)throw Error(a(308));$i=e,Ji.dependencies={lanes:0,firstContext:e,responders:null}}else $i=$i.next=e;return t._currentValue}var ao=!1;function so(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function uo(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function lo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function co(t,e){if(null!==(t=t.updateQueue)){var n=(t=t.shared).pending;null===n?e.next=e:(e.next=n.next,n.next=e),t.pending=e}}function ho(t,e){var n=t.updateQueue,r=t.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?i=o=e:o=o.next=e}else i=o=e;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(t.updateQueue=n)}null===(t=n.lastBaseUpdate)?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function fo(t,e,n,r){var o=t.updateQueue;ao=!1;var a=o.firstBaseUpdate,s=o.lastBaseUpdate,u=o.shared.pending;if(null!==u){o.shared.pending=null;var l=u,c=l.next;l.next=null,null===s?a=c:s.next=c,s=l;var h=t.alternate;if(null!==h){var f=(h=h.updateQueue).lastBaseUpdate;f!==s&&(null===f?h.firstBaseUpdate=c:f.next=c,h.lastBaseUpdate=l)}}if(null!==a){for(f=o.baseState,s=0,h=c=l=null;;){u=a.lane;var p=a.eventTime;if((r&u)===u){null!==h&&(h=h.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});t:{var d=t,g=a;switch(u=e,p=n,g.tag){case 1:if("function"==typeof(d=g.payload)){f=d.call(p,f,u);break t}f=d;break t;case 3:d.flags=-4097&d.flags|64;case 0:if(null==(u="function"==typeof(d=g.payload)?d.call(p,f,u):d))break t;f=i({},f,u);break t;case 2:ao=!0}}null!==a.callback&&(t.flags|=32,null===(u=o.effects)?o.effects=[a]:u.push(a))}else p={eventTime:p,lane:u,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===h?(c=h=p,l=f):h=h.next=p,s|=u;if(null===(a=a.next)){if(null===(u=o.shared.pending))break;a=u.next,u.next=null,o.lastBaseUpdate=u,o.shared.pending=null}}null===h&&(l=f),o.baseState=l,o.firstBaseUpdate=c,o.lastBaseUpdate=h,zs|=s,t.lanes=s,t.memoizedState=f}}function po(t,e,n){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!=typeof i)throw Error(a(191,i));i.call(r)}}}var go=(new r.Component).refs;function vo(t,e,n,r){n=null==(n=n(r,e=t.memoizedState))?e:i({},e,n),t.memoizedState=n,0===t.lanes&&(t.updateQueue.baseState=n)}var mo={isMounted:function(t){return!!(t=t._reactInternals)&&qt(t)===t},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=lu(),i=cu(t),o=lo(r,i);o.payload=e,null!=n&&(o.callback=n),co(t,o),hu(t,i,r)},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=lu(),i=cu(t),o=lo(r,i);o.tag=1,o.payload=e,null!=n&&(o.callback=n),co(t,o),hu(t,i,r)},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=lu(),r=cu(t),i=lo(n,r);i.tag=2,null!=e&&(i.callback=e),co(t,i),hu(t,r,n)}};function yo(t,e,n,r,i,o,a){return"function"==typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(r,o,a):!(e.prototype&&e.prototype.isPureReactComponent&&hr(n,r)&&hr(i,o))}function _o(t,e,n){var r=!1,i=hi,o=e.contextType;return"object"==typeof o&&null!==o?o=oo(o):(i=vi(e)?di:fi.current,o=(r=null!=(r=e.contextTypes))?gi(t,i):hi),e=new e(n,o),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=mo,t.stateNode=e,e._reactInternals=t,r&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=o),e}function bo(t,e,n,r){t=e.state,"function"==typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(n,r),"function"==typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&mo.enqueueReplaceState(e,e.state,null)}function xo(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs=go,so(t);var o=e.contextType;"object"==typeof o&&null!==o?i.context=oo(o):(o=vi(e)?di:fi.current,i.context=gi(t,o)),fo(t,n,i,r),i.state=t.memoizedState,"function"==typeof(o=e.getDerivedStateFromProps)&&(vo(t,e,o,n),i.state=t.memoizedState),"function"==typeof e.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(e=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),e!==i.state&&mo.enqueueReplaceState(i,i.state,null),fo(t,n,i,r),i.state=t.memoizedState),"function"==typeof i.componentDidMount&&(t.flags|=4)}var wo=Array.isArray;function Eo(t,e,n){if(null!==(t=n.ref)&&"function"!=typeof t&&"object"!=typeof t){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,t));var i=""+t;return null!==e&&null!==e.ref&&"function"==typeof e.ref&&e.ref._stringRef===i?e.ref:(e=function(t){var e=r.refs;e===go&&(e=r.refs={}),null===t?delete e[i]:e[i]=t},e._stringRef=i,e)}if("string"!=typeof t)throw Error(a(284));if(!n._owner)throw Error(a(290,t))}return t}function So(t,e){if("textarea"!==t.type)throw Error(a(31,"[object Object]"===Object.prototype.toString.call(e)?"object with keys {"+Object.keys(e).join(", ")+"}":e))}function Co(t){function e(e,n){if(t){var r=e.lastEffect;null!==r?(r.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,r){if(!t)return null;for(;null!==r;)e(n,r),r=r.sibling;return null}function r(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(t,e){return(t=Gu(t,e)).index=0,t.sibling=null,t}function o(e,n,r){return e.index=r,t?null!==(r=e.alternate)?(r=r.index)<n?(e.flags=2,n):r:(e.flags=2,n):n}function s(e){return t&&null===e.alternate&&(e.flags=2),e}function u(t,e,n,r){return null===e||6!==e.tag?((e=Xu(n,t.mode,r)).return=t,e):((e=i(e,n)).return=t,e)}function l(t,e,n,r){return null!==e&&e.elementType===n.type?((r=i(e,n.props)).ref=Eo(t,e,n),r.return=t,r):((r=Vu(n.type,n.key,n.props,null,t.mode,r)).ref=Eo(t,e,n),r.return=t,r)}function c(t,e,n,r){return null===e||4!==e.tag||e.stateNode.containerInfo!==n.containerInfo||e.stateNode.implementation!==n.implementation?((e=Yu(n,t.mode,r)).return=t,e):((e=i(e,n.children||[])).return=t,e)}function h(t,e,n,r,o){return null===e||7!==e.tag?((e=Wu(n,t.mode,r,o)).return=t,e):((e=i(e,n)).return=t,e)}function f(t,e,n){if("string"==typeof e||"number"==typeof e)return(e=Xu(""+e,t.mode,n)).return=t,e;if("object"==typeof e&&null!==e){switch(e.$$typeof){case w:return(n=Vu(e.type,e.key,e.props,null,t.mode,n)).ref=Eo(t,null,e),n.return=t,n;case E:return(e=Yu(e,t.mode,n)).return=t,e}if(wo(e)||U(e))return(e=Wu(e,t.mode,n,null)).return=t,e;So(t,e)}return null}function p(t,e,n,r){var i=null!==e?e.key:null;if("string"==typeof n||"number"==typeof n)return null!==i?null:u(t,e,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===i?n.type===S?h(t,e,n.props.children,r,i):l(t,e,n,r):null;case E:return n.key===i?c(t,e,n,r):null}if(wo(n)||U(n))return null!==i?null:h(t,e,n,r,null);So(t,n)}return null}function d(t,e,n,r,i){if("string"==typeof r||"number"==typeof r)return u(e,t=t.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case w:return t=t.get(null===r.key?n:r.key)||null,r.type===S?h(e,t,r.props.children,i,r.key):l(e,t,r,i);case E:return c(e,t=t.get(null===r.key?n:r.key)||null,r,i)}if(wo(r)||U(r))return h(e,t=t.get(n)||null,r,i,null);So(e,r)}return null}function g(i,a,s,u){for(var l=null,c=null,h=a,g=a=0,v=null;null!==h&&g<s.length;g++){h.index>g?(v=h,h=null):v=h.sibling;var m=p(i,h,s[g],u);if(null===m){null===h&&(h=v);break}t&&h&&null===m.alternate&&e(i,h),a=o(m,a,g),null===c?l=m:c.sibling=m,c=m,h=v}if(g===s.length)return n(i,h),l;if(null===h){for(;g<s.length;g++)null!==(h=f(i,s[g],u))&&(a=o(h,a,g),null===c?l=h:c.sibling=h,c=h);return l}for(h=r(i,h);g<s.length;g++)null!==(v=d(h,i,g,s[g],u))&&(t&&null!==v.alternate&&h.delete(null===v.key?g:v.key),a=o(v,a,g),null===c?l=v:c.sibling=v,c=v);return t&&h.forEach((function(t){return e(i,t)})),l}function v(i,s,u,l){var c=U(u);if("function"!=typeof c)throw Error(a(150));if(null==(u=c.call(u)))throw Error(a(151));for(var h=c=null,g=s,v=s=0,m=null,y=u.next();null!==g&&!y.done;v++,y=u.next()){g.index>v?(m=g,g=null):m=g.sibling;var _=p(i,g,y.value,l);if(null===_){null===g&&(g=m);break}t&&g&&null===_.alternate&&e(i,g),s=o(_,s,v),null===h?c=_:h.sibling=_,h=_,g=m}if(y.done)return n(i,g),c;if(null===g){for(;!y.done;v++,y=u.next())null!==(y=f(i,y.value,l))&&(s=o(y,s,v),null===h?c=y:h.sibling=y,h=y);return c}for(g=r(i,g);!y.done;v++,y=u.next())null!==(y=d(g,i,v,y.value,l))&&(t&&null!==y.alternate&&g.delete(null===y.key?v:y.key),s=o(y,s,v),null===h?c=y:h.sibling=y,h=y);return t&&g.forEach((function(t){return e(i,t)})),c}return function(t,r,o,u){var l="object"==typeof o&&null!==o&&o.type===S&&null===o.key;l&&(o=o.props.children);var c="object"==typeof o&&null!==o;if(c)switch(o.$$typeof){case w:t:{for(c=o.key,l=r;null!==l;){if(l.key===c){if(7===l.tag){if(o.type===S){n(t,l.sibling),(r=i(l,o.props.children)).return=t,t=r;break t}}else if(l.elementType===o.type){n(t,l.sibling),(r=i(l,o.props)).ref=Eo(t,l,o),r.return=t,t=r;break t}n(t,l);break}e(t,l),l=l.sibling}o.type===S?((r=Wu(o.props.children,t.mode,u,o.key)).return=t,t=r):((u=Vu(o.type,o.key,o.props,null,t.mode,u)).ref=Eo(t,r,o),u.return=t,t=u)}return s(t);case E:t:{for(l=o.key;null!==r;){if(r.key===l){if(4===r.tag&&r.stateNode.containerInfo===o.containerInfo&&r.stateNode.implementation===o.implementation){n(t,r.sibling),(r=i(r,o.children||[])).return=t,t=r;break t}n(t,r);break}e(t,r),r=r.sibling}(r=Yu(o,t.mode,u)).return=t,t=r}return s(t)}if("string"==typeof o||"number"==typeof o)return o=""+o,null!==r&&6===r.tag?(n(t,r.sibling),(r=i(r,o)).return=t,t=r):(n(t,r),(r=Xu(o,t.mode,u)).return=t,t=r),s(t);if(wo(o))return g(t,r,o,u);if(U(o))return v(t,r,o,u);if(c&&So(t,o),void 0===o&&!l)switch(t.tag){case 1:case 22:case 0:case 11:case 15:throw Error(a(152,X(t.type)||"Component"))}return n(t,r)}}var Ao=Co(!0),To=Co(!1),ko={},Mo=ui(ko),Po=ui(ko),Io=ui(ko);function Oo(t){if(t===ko)throw Error(a(174));return t}function Ro(t,e){switch(ci(Io,e),ci(Po,t),ci(Mo,ko),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:pt(null,"");break;default:e=pt(e=(t=8===t?e.parentNode:e).namespaceURI||null,t=t.tagName)}li(Mo),ci(Mo,e)}function Lo(){li(Mo),li(Po),li(Io)}function Do(t){Oo(Io.current);var e=Oo(Mo.current),n=pt(e,t.type);e!==n&&(ci(Po,t),ci(Mo,n))}function No(t){Po.current===t&&(li(Mo),li(Po))}var Bo=ui(0);function zo(t){for(var e=t;null!==e;){if(13===e.tag){var n=e.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!=(64&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Fo=null,Zo=null,jo=!1;function Uo(t,e){var n=ju(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=e,n.return=t,n.flags=8,null!==t.lastEffect?(t.lastEffect.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n}function Go(t,e){switch(t.tag){case 5:var n=t.type;return null!==(e=1!==e.nodeType||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(t.stateNode=e,!0);case 6:return null!==(e=""===t.pendingProps||3!==e.nodeType?null:e)&&(t.stateNode=e,!0);default:return!1}}function Vo(t){if(jo){var e=Zo;if(e){var n=e;if(!Go(t,e)){if(!(e=Xr(n.nextSibling))||!Go(t,e))return t.flags=-1025&t.flags|2,jo=!1,void(Fo=t);Uo(Fo,n)}Fo=t,Zo=Xr(e.firstChild)}else t.flags=-1025&t.flags|2,jo=!1,Fo=t}}function Wo(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;Fo=t}function Ho(t){if(t!==Fo)return!1;if(!jo)return Wo(t),jo=!0,!1;var e=t.type;if(5!==t.tag||"head"!==e&&"body"!==e&&!Gr(e,t.memoizedProps))for(e=Zo;e;)Uo(t,e),e=Xr(e.nextSibling);if(Wo(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(a(317));t:{for(t=t.nextSibling,e=0;t;){if(8===t.nodeType){var n=t.data;if("/$"===n){if(0===e){Zo=Xr(t.nextSibling);break t}e--}else"$"!==n&&"$!"!==n&&"$?"!==n||e++}t=t.nextSibling}Zo=null}}else Zo=Fo?Xr(t.stateNode.nextSibling):null;return!0}function Xo(){Zo=Fo=null,jo=!1}var Yo=[];function qo(){for(var t=0;t<Yo.length;t++)Yo[t]._workInProgressVersionPrimary=null;Yo.length=0}var Ko=x.ReactCurrentDispatcher,Qo=x.ReactCurrentBatchConfig,Jo=0,$o=null,ta=null,ea=null,na=!1,ra=!1;function ia(){throw Error(a(321))}function oa(t,e){if(null===e)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!lr(t[n],e[n]))return!1;return!0}function aa(t,e,n,r,i,o){if(Jo=o,$o=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ko.current=null===t||null===t.memoizedState?Oa:Ra,t=n(r,i),ra){o=0;do{if(ra=!1,!(25>o))throw Error(a(301));o+=1,ea=ta=null,e.updateQueue=null,Ko.current=La,t=n(r,i)}while(ra)}if(Ko.current=Ia,e=null!==ta&&null!==ta.next,Jo=0,ea=ta=$o=null,na=!1,e)throw Error(a(300));return t}function sa(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ea?$o.memoizedState=ea=t:ea=ea.next=t,ea}function ua(){if(null===ta){var t=$o.alternate;t=null!==t?t.memoizedState:null}else t=ta.next;var e=null===ea?$o.memoizedState:ea.next;if(null!==e)ea=e,ta=t;else{if(null===t)throw Error(a(310));t={memoizedState:(ta=t).memoizedState,baseState:ta.baseState,baseQueue:ta.baseQueue,queue:ta.queue,next:null},null===ea?$o.memoizedState=ea=t:ea=ea.next=t}return ea}function la(t,e){return"function"==typeof e?e(t):e}function ca(t){var e=ua(),n=e.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=t;var r=ta,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var u=s=o=null,l=i;do{var c=l.lane;if((Jo&c)===c)null!==u&&(u=u.next={lane:0,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),r=l.eagerReducer===t?l.eagerState:t(r,l.action);else{var h={lane:c,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};null===u?(s=u=h,o=r):u=u.next=h,$o.lanes|=c,zs|=c}l=l.next}while(null!==l&&l!==i);null===u?o=r:u.next=s,lr(r,e.memoizedState)||(Na=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=u,n.lastRenderedState=r}return[e.memoizedState,n.dispatch]}function ha(t){var e=ua(),n=e.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,o=e.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{o=t(o,s.action),s=s.next}while(s!==i);lr(o,e.memoizedState)||(Na=!0),e.memoizedState=o,null===e.baseQueue&&(e.baseState=o),n.lastRenderedState=o}return[o,r]}function fa(t,e,n){var r=e._getVersion;r=r(e._source);var i=e._workInProgressVersionPrimary;if(null!==i?t=i===r:(t=t.mutableReadLanes,(t=(Jo&t)===t)&&(e._workInProgressVersionPrimary=r,Yo.push(e))),t)return n(e._source);throw Yo.push(e),Error(a(350))}function pa(t,e,n,r){var i=Ps;if(null===i)throw Error(a(349));var o=e._getVersion,s=o(e._source),u=Ko.current,l=u.useState((function(){return fa(i,e,n)})),c=l[1],h=l[0];l=ea;var f=t.memoizedState,p=f.refs,d=p.getSnapshot,g=f.source;f=f.subscribe;var v=$o;return t.memoizedState={refs:p,source:e,subscribe:r},u.useEffect((function(){p.getSnapshot=n,p.setSnapshot=c;var t=o(e._source);if(!lr(s,t)){t=n(e._source),lr(h,t)||(c(t),t=cu(v),i.mutableReadLanes|=t&i.pendingLanes),t=i.mutableReadLanes,i.entangledLanes|=t;for(var r=i.entanglements,a=t;0<a;){var u=31-Ge(a),l=1<<u;r[u]|=t,a&=~l}}}),[n,e,r]),u.useEffect((function(){return r(e._source,(function(){var t=p.getSnapshot,n=p.setSnapshot;try{n(t(e._source));var r=cu(v);i.mutableReadLanes|=r&i.pendingLanes}catch(t){n((function(){throw t}))}}))}),[e,r]),lr(d,n)&&lr(g,e)&&lr(f,r)||((t={pending:null,dispatch:null,lastRenderedReducer:la,lastRenderedState:h}).dispatch=c=Pa.bind(null,$o,t),l.queue=t,l.baseQueue=null,h=fa(i,e,n),l.memoizedState=l.baseState=h),h}function da(t,e,n){return pa(ua(),t,e,n)}function ga(t){var e=sa();return"function"==typeof t&&(t=t()),e.memoizedState=e.baseState=t,t=(t=e.queue={pending:null,dispatch:null,lastRenderedReducer:la,lastRenderedState:t}).dispatch=Pa.bind(null,$o,t),[e.memoizedState,t]}function va(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},null===(e=$o.updateQueue)?(e={lastEffect:null},$o.updateQueue=e,e.lastEffect=t.next=t):null===(n=e.lastEffect)?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t),t}function ma(t){return t={current:t},sa().memoizedState=t}function ya(){return ua().memoizedState}function _a(t,e,n,r){var i=sa();$o.flags|=t,i.memoizedState=va(1|e,n,void 0,void 0===r?null:r)}function ba(t,e,n,r){var i=ua();r=void 0===r?null:r;var o=void 0;if(null!==ta){var a=ta.memoizedState;if(o=a.destroy,null!==r&&oa(r,a.deps))return void va(e,n,o,r)}$o.flags|=t,i.memoizedState=va(1|e,n,o,r)}function xa(t,e){return _a(516,4,t,e)}function wa(t,e){return ba(516,4,t,e)}function Ea(t,e){return ba(4,2,t,e)}function Sa(t,e){return"function"==typeof e?(t=t(),e(t),function(){e(null)}):null!=e?(t=t(),e.current=t,function(){e.current=null}):void 0}function Ca(t,e,n){return n=null!=n?n.concat([t]):null,ba(4,2,Sa.bind(null,e,t),n)}function Aa(){}function Ta(t,e){var n=ua();e=void 0===e?null:e;var r=n.memoizedState;return null!==r&&null!==e&&oa(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function ka(t,e){var n=ua();e=void 0===e?null:e;var r=n.memoizedState;return null!==r&&null!==e&&oa(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Ma(t,e){var n=Gi();Wi(98>n?98:n,(function(){t(!0)})),Wi(97<n?97:n,(function(){var n=Qo.transition;Qo.transition=1;try{t(!1),e()}finally{Qo.transition=n}}))}function Pa(t,e,n){var r=lu(),i=cu(t),o={lane:i,action:n,eagerReducer:null,eagerState:null,next:null},a=e.pending;if(null===a?o.next=o:(o.next=a.next,a.next=o),e.pending=o,a=t.alternate,t===$o||null!==a&&a===$o)ra=na=!0;else{if(0===t.lanes&&(null===a||0===a.lanes)&&null!==(a=e.lastRenderedReducer))try{var s=e.lastRenderedState,u=a(s,n);if(o.eagerReducer=a,o.eagerState=u,lr(u,s))return}catch(t){}hu(t,i,r)}}var Ia={readContext:oo,useCallback:ia,useContext:ia,useEffect:ia,useImperativeHandle:ia,useLayoutEffect:ia,useMemo:ia,useReducer:ia,useRef:ia,useState:ia,useDebugValue:ia,useDeferredValue:ia,useTransition:ia,useMutableSource:ia,useOpaqueIdentifier:ia,unstable_isNewReconciler:!1},Oa={readContext:oo,useCallback:function(t,e){return sa().memoizedState=[t,void 0===e?null:e],t},useContext:oo,useEffect:xa,useImperativeHandle:function(t,e,n){return n=null!=n?n.concat([t]):null,_a(4,2,Sa.bind(null,e,t),n)},useLayoutEffect:function(t,e){return _a(4,2,t,e)},useMemo:function(t,e){var n=sa();return e=void 0===e?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=sa();return e=void 0!==n?n(e):e,r.memoizedState=r.baseState=e,t=(t=r.queue={pending:null,dispatch:null,lastRenderedReducer:t,lastRenderedState:e}).dispatch=Pa.bind(null,$o,t),[r.memoizedState,t]},useRef:ma,useState:ga,useDebugValue:Aa,useDeferredValue:function(t){var e=ga(t),n=e[0],r=e[1];return xa((function(){var e=Qo.transition;Qo.transition=1;try{r(t)}finally{Qo.transition=e}}),[t]),n},useTransition:function(){var t=ga(!1),e=t[0];return ma(t=Ma.bind(null,t[1])),[t,e]},useMutableSource:function(t,e,n){var r=sa();return r.memoizedState={refs:{getSnapshot:e,setSnapshot:null},source:t,subscribe:n},pa(r,t,e,n)},useOpaqueIdentifier:function(){if(jo){var t=!1,e=function(t){return{$$typeof:D,toString:t,valueOf:t}}((function(){throw t||(t=!0,n("r:"+(qr++).toString(36))),Error(a(355))})),n=ga(e)[1];return 0==(2&$o.mode)&&($o.flags|=516,va(5,(function(){n("r:"+(qr++).toString(36))}),void 0,null)),e}return ga(e="r:"+(qr++).toString(36)),e},unstable_isNewReconciler:!1},Ra={readContext:oo,useCallback:Ta,useContext:oo,useEffect:wa,useImperativeHandle:Ca,useLayoutEffect:Ea,useMemo:ka,useReducer:ca,useRef:ya,useState:function(){return ca(la)},useDebugValue:Aa,useDeferredValue:function(t){var e=ca(la),n=e[0],r=e[1];return wa((function(){var e=Qo.transition;Qo.transition=1;try{r(t)}finally{Qo.transition=e}}),[t]),n},useTransition:function(){var t=ca(la)[0];return[ya().current,t]},useMutableSource:da,useOpaqueIdentifier:function(){return ca(la)[0]},unstable_isNewReconciler:!1},La={readContext:oo,useCallback:Ta,useContext:oo,useEffect:wa,useImperativeHandle:Ca,useLayoutEffect:Ea,useMemo:ka,useReducer:ha,useRef:ya,useState:function(){return ha(la)},useDebugValue:Aa,useDeferredValue:function(t){var e=ha(la),n=e[0],r=e[1];return wa((function(){var e=Qo.transition;Qo.transition=1;try{r(t)}finally{Qo.transition=e}}),[t]),n},useTransition:function(){var t=ha(la)[0];return[ya().current,t]},useMutableSource:da,useOpaqueIdentifier:function(){return ha(la)[0]},unstable_isNewReconciler:!1},Da=x.ReactCurrentOwner,Na=!1;function Ba(t,e,n,r){e.child=null===t?To(e,null,n,r):Ao(e,t.child,n,r)}function za(t,e,n,r,i){n=n.render;var o=e.ref;return io(e,i),r=aa(t,e,n,r,o,i),null===t||Na?(e.flags|=1,Ba(t,e,r,i),e.child):(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~i,ns(t,e,i))}function Fa(t,e,n,r,i,o){if(null===t){var a=n.type;return"function"!=typeof a||Uu(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((t=Vu(n.type,null,r,e,e.mode,o)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=a,Za(t,e,a,r,i,o))}return a=t.child,0==(i&o)&&(i=a.memoizedProps,(n=null!==(n=n.compare)?n:hr)(i,r)&&t.ref===e.ref)?ns(t,e,o):(e.flags|=1,(t=Gu(a,r)).ref=e.ref,t.return=e,e.child=t)}function Za(t,e,n,r,i,o){if(null!==t&&hr(t.memoizedProps,r)&&t.ref===e.ref){if(Na=!1,0==(o&i))return e.lanes=t.lanes,ns(t,e,o);0!=(16384&t.flags)&&(Na=!0)}return Ga(t,e,n,r,o)}function ja(t,e,n){var r=e.pendingProps,i=r.children,o=null!==t?t.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(0==(4&e.mode))e.memoizedState={baseLanes:0},_u(0,n);else{if(0==(1073741824&n))return t=null!==o?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t},_u(0,t),null;e.memoizedState={baseLanes:0},_u(0,null!==o?o.baseLanes:n)}else null!==o?(r=o.baseLanes|n,e.memoizedState=null):r=n,_u(0,r);return Ba(t,e,i,n),e.child}function Ua(t,e){var n=e.ref;(null===t&&null!==n||null!==t&&t.ref!==n)&&(e.flags|=128)}function Ga(t,e,n,r,i){var o=vi(n)?di:fi.current;return o=gi(e,o),io(e,i),n=aa(t,e,n,r,o,i),null===t||Na?(e.flags|=1,Ba(t,e,n,i),e.child):(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~i,ns(t,e,i))}function Va(t,e,n,r,i){if(vi(n)){var o=!0;bi(e)}else o=!1;if(io(e,i),null===e.stateNode)null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),_o(e,n,r),xo(e,n,r,i),r=!0;else if(null===t){var a=e.stateNode,s=e.memoizedProps;a.props=s;var u=a.context,l=n.contextType;l="object"==typeof l&&null!==l?oo(l):gi(e,l=vi(n)?di:fi.current);var c=n.getDerivedStateFromProps,h="function"==typeof c||"function"==typeof a.getSnapshotBeforeUpdate;h||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==r||u!==l)&&bo(e,a,r,l),ao=!1;var f=e.memoizedState;a.state=f,fo(e,r,a,i),u=e.memoizedState,s!==r||f!==u||pi.current||ao?("function"==typeof c&&(vo(e,n,c,r),u=e.memoizedState),(s=ao||yo(e,n,s,r,f,u,l))?(h||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(e.flags|=4)):("function"==typeof a.componentDidMount&&(e.flags|=4),e.memoizedProps=r,e.memoizedState=u),a.props=r,a.state=u,a.context=l,r=s):("function"==typeof a.componentDidMount&&(e.flags|=4),r=!1)}else{a=e.stateNode,uo(t,e),s=e.memoizedProps,l=e.type===e.elementType?s:Ki(e.type,s),a.props=l,h=e.pendingProps,f=a.context,u="object"==typeof(u=n.contextType)&&null!==u?oo(u):gi(e,u=vi(n)?di:fi.current);var p=n.getDerivedStateFromProps;(c="function"==typeof p||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==h||f!==u)&&bo(e,a,r,u),ao=!1,f=e.memoizedState,a.state=f,fo(e,r,a,i);var d=e.memoizedState;s!==h||f!==d||pi.current||ao?("function"==typeof p&&(vo(e,n,p,r),d=e.memoizedState),(l=ao||yo(e,n,l,r,f,d,u))?(c||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,d,u),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,d,u)),"function"==typeof a.componentDidUpdate&&(e.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(e.flags|=256)):("function"!=typeof a.componentDidUpdate||s===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===t.memoizedProps&&f===t.memoizedState||(e.flags|=256),e.memoizedProps=r,e.memoizedState=d),a.props=r,a.state=d,a.context=u,r=l):("function"!=typeof a.componentDidUpdate||s===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===t.memoizedProps&&f===t.memoizedState||(e.flags|=256),r=!1)}return Wa(t,e,n,r,o,i)}function Wa(t,e,n,r,i,o){Ua(t,e);var a=0!=(64&e.flags);if(!r&&!a)return i&&xi(e,n,!1),ns(t,e,o);r=e.stateNode,Da.current=e;var s=a&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return e.flags|=1,null!==t&&a?(e.child=Ao(e,t.child,null,o),e.child=Ao(e,null,s,o)):Ba(t,e,s,o),e.memoizedState=r.state,i&&xi(e,n,!0),e.child}function Ha(t){var e=t.stateNode;e.pendingContext?yi(0,e.pendingContext,e.pendingContext!==e.context):e.context&&yi(0,e.context,!1),Ro(t,e.containerInfo)}var Xa,Ya,qa,Ka={dehydrated:null,retryLane:0};function Qa(t,e,n){var r,i=e.pendingProps,o=Bo.current,a=!1;return(r=0!=(64&e.flags))||(r=(null===t||null!==t.memoizedState)&&0!=(2&o)),r?(a=!0,e.flags&=-65):null!==t&&null===t.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(o|=1),ci(Bo,1&o),null===t?(void 0!==i.fallback&&Vo(e),t=i.children,o=i.fallback,a?(t=Ja(e,t,o,n),e.child.memoizedState={baseLanes:n},e.memoizedState=Ka,t):"number"==typeof i.unstable_expectedLoadTime?(t=Ja(e,t,o,n),e.child.memoizedState={baseLanes:n},e.memoizedState=Ka,e.lanes=33554432,t):((n=Hu({mode:"visible",children:t},e.mode,n,null)).return=e,e.child=n)):(t.memoizedState,a?(i=function(t,e,n,r,i){var o=e.mode,a=t.child;t=a.sibling;var s={mode:"hidden",children:n};return 0==(2&o)&&e.child!==a?((n=e.child).childLanes=0,n.pendingProps=s,null!==(a=n.lastEffect)?(e.firstEffect=n.firstEffect,e.lastEffect=a,a.nextEffect=null):e.firstEffect=e.lastEffect=null):n=Gu(a,s),null!==t?r=Gu(t,r):(r=Wu(r,o,i,null)).flags|=2,r.return=e,n.return=e,n.sibling=r,e.child=n,r}(t,e,i.children,i.fallback,n),a=e.child,o=t.child.memoizedState,a.memoizedState=null===o?{baseLanes:n}:{baseLanes:o.baseLanes|n},a.childLanes=t.childLanes&~n,e.memoizedState=Ka,i):(n=function(t,e,n,r){var i=t.child;return t=i.sibling,n=Gu(i,{mode:"visible",children:n}),0==(2&e.mode)&&(n.lanes=r),n.return=e,n.sibling=null,null!==t&&(t.nextEffect=null,t.flags=8,e.firstEffect=e.lastEffect=t),e.child=n}(t,e,i.children,n),e.memoizedState=null,n))}function Ja(t,e,n,r){var i=t.mode,o=t.child;return e={mode:"hidden",children:e},0==(2&i)&&null!==o?(o.childLanes=0,o.pendingProps=e):o=Hu(e,i,0,null),n=Wu(n,i,r,null),o.return=t,n.return=t,o.sibling=n,t.child=o,n}function $a(t,e){t.lanes|=e;var n=t.alternate;null!==n&&(n.lanes|=e),ro(t.return,e)}function ts(t,e,n,r,i,o){var a=t.memoizedState;null===a?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,lastEffect:o}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i,a.lastEffect=o)}function es(t,e,n){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(Ba(t,e,r.children,n),0!=(2&(r=Bo.current)))r=1&r|2,e.flags|=64;else{if(null!==t&&0!=(64&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&$a(t,n);else if(19===t.tag)$a(t,n);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ci(Bo,r),0==(2&e.mode))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;null!==n;)null!==(t=n.alternate)&&null===zo(t)&&(i=n),n=n.sibling;null===(n=i)?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),ts(e,!1,i,n,o,e.lastEffect);break;case"backwards":for(n=null,i=e.child,e.child=null;null!==i;){if(null!==(t=i.alternate)&&null===zo(t)){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}ts(e,!0,n,null,o,e.lastEffect);break;case"together":ts(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function ns(t,e,n){if(null!==t&&(e.dependencies=t.dependencies),zs|=e.lanes,0!=(n&e.childLanes)){if(null!==t&&e.child!==t.child)throw Error(a(153));if(null!==e.child){for(n=Gu(t=e.child,t.pendingProps),e.child=n,n.return=e;null!==t.sibling;)t=t.sibling,(n=n.sibling=Gu(t,t.pendingProps)).return=e;n.sibling=null}return e.child}return null}function rs(t,e){if(!jo)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;null!==e;)null!==e.alternate&&(n=e),e=e.sibling;null===n?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?e||null===t.tail?t.tail=null:t.tail.sibling=null:r.sibling=null}}function is(t,e,n){var r=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return vi(e.type)&&mi(),null;case 3:return Lo(),li(pi),li(fi),qo(),(r=e.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==t&&null!==t.child||(Ho(e)?e.flags|=4:r.hydrate||(e.flags|=256)),null;case 5:No(e);var o=Oo(Io.current);if(n=e.type,null!==t&&null!=e.stateNode)Ya(t,e,n,r),t.ref!==e.ref&&(e.flags|=128);else{if(!r){if(null===e.stateNode)throw Error(a(166));return null}if(t=Oo(Mo.current),Ho(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[Qr]=e,r[Jr]=s,n){case"dialog":Mr("cancel",r),Mr("close",r);break;case"iframe":case"object":case"embed":Mr("load",r);break;case"video":case"audio":for(t=0;t<Cr.length;t++)Mr(Cr[t],r);break;case"source":Mr("error",r);break;case"img":case"image":case"link":Mr("error",r),Mr("load",r);break;case"details":Mr("toggle",r);break;case"input":tt(r,s),Mr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Mr("invalid",r);break;case"textarea":ut(r,s),Mr("invalid",r)}for(var l in Et(n,s),t=null,s)s.hasOwnProperty(l)&&(o=s[l],"children"===l?"string"==typeof o?r.textContent!==o&&(t=["children",o]):"number"==typeof o&&r.textContent!==""+o&&(t=["children",""+o]):u.hasOwnProperty(l)&&null!=o&&"onScroll"===l&&Mr("scroll",r));switch(n){case"input":K(r),rt(r,s,!0);break;case"textarea":K(r),ct(r);break;case"select":case"option":break;default:"function"==typeof s.onClick&&(r.onclick=Fr)}r=t,e.updateQueue=r,null!==r&&(e.flags|=4)}else{switch(l=9===o.nodeType?o:o.ownerDocument,t===ht&&(t=ft(n)),t===ht?"script"===n?((t=l.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):"string"==typeof r.is?t=l.createElement(n,{is:r.is}):(t=l.createElement(n),"select"===n&&(l=t,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):t=l.createElementNS(t,n),t[Qr]=e,t[Jr]=r,Xa(t,e),e.stateNode=t,l=St(n,r),n){case"dialog":Mr("cancel",t),Mr("close",t),o=r;break;case"iframe":case"object":case"embed":Mr("load",t),o=r;break;case"video":case"audio":for(o=0;o<Cr.length;o++)Mr(Cr[o],t);o=r;break;case"source":Mr("error",t),o=r;break;case"img":case"image":case"link":Mr("error",t),Mr("load",t),o=r;break;case"details":Mr("toggle",t),o=r;break;case"input":tt(t,r),o=$(t,r),Mr("invalid",t);break;case"option":o=ot(t,r);break;case"select":t._wrapperState={wasMultiple:!!r.multiple},o=i({},r,{value:void 0}),Mr("invalid",t);break;case"textarea":ut(t,r),o=st(t,r),Mr("invalid",t);break;default:o=r}Et(n,o);var c=o;for(s in c)if(c.hasOwnProperty(s)){var h=c[s];"style"===s?xt(t,h):"dangerouslySetInnerHTML"===s?null!=(h=h?h.__html:void 0)&&vt(t,h):"children"===s?"string"==typeof h?("textarea"!==n||""!==h)&&mt(t,h):"number"==typeof h&&mt(t,""+h):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(u.hasOwnProperty(s)?null!=h&&"onScroll"===s&&Mr("scroll",t):null!=h&&b(t,s,h,l))}switch(n){case"input":K(t),rt(t,r,!1);break;case"textarea":K(t),ct(t);break;case"option":null!=r.value&&t.setAttribute("value",""+Y(r.value));break;case"select":t.multiple=!!r.multiple,null!=(s=r.value)?at(t,!!r.multiple,s,!1):null!=r.defaultValue&&at(t,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof o.onClick&&(t.onclick=Fr)}Ur(n,r)&&(e.flags|=4)}null!==e.ref&&(e.flags|=128)}return null;case 6:if(t&&null!=e.stateNode)qa(0,e,t.memoizedProps,r);else{if("string"!=typeof r&&null===e.stateNode)throw Error(a(166));n=Oo(Io.current),Oo(Mo.current),Ho(e)?(r=e.stateNode,n=e.memoizedProps,r[Qr]=e,r.nodeValue!==n&&(e.flags|=4)):((r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Qr]=e,e.stateNode=r)}return null;case 13:return li(Bo),r=e.memoizedState,0!=(64&e.flags)?(e.lanes=n,e):(r=null!==r,n=!1,null===t?void 0!==e.memoizedProps.fallback&&Ho(e):n=null!==t.memoizedState,r&&!n&&0!=(2&e.mode)&&(null===t&&!0!==e.memoizedProps.unstable_avoidThisFallback||0!=(1&Bo.current)?0===Ds&&(Ds=3):(0!==Ds&&3!==Ds||(Ds=4),null===Ps||0==(134217727&zs)&&0==(134217727&Fs)||gu(Ps,Os))),(r||n)&&(e.flags|=4),null);case 4:return Lo(),null===t&&Ir(e.stateNode.containerInfo),null;case 10:return no(e),null;case 19:if(li(Bo),null===(r=e.memoizedState))return null;if(s=0!=(64&e.flags),null===(l=r.rendering))if(s)rs(r,!1);else{if(0!==Ds||null!==t&&0!=(64&t.flags))for(t=e.child;null!==t;){if(null!==(l=zo(t))){for(e.flags|=64,rs(r,!1),null!==(s=l.updateQueue)&&(e.updateQueue=s,e.flags|=4),null===r.lastEffect&&(e.firstEffect=null),e.lastEffect=r.lastEffect,r=n,n=e.child;null!==n;)t=r,(s=n).flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,null===(l=s.alternate)?(s.childLanes=0,s.lanes=t,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,t=l.dependencies,s.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ci(Bo,1&Bo.current|2),e.child}t=t.sibling}null!==r.tail&&Ui()>Gs&&(e.flags|=64,s=!0,rs(r,!1),e.lanes=33554432)}else{if(!s)if(null!==(t=zo(l))){if(e.flags|=64,s=!0,null!==(n=t.updateQueue)&&(e.updateQueue=n,e.flags|=4),rs(r,!0),null===r.tail&&"hidden"===r.tailMode&&!l.alternate&&!jo)return null!==(e=e.lastEffect=r.lastEffect)&&(e.nextEffect=null),null}else 2*Ui()-r.renderingStartTime>Gs&&1073741824!==n&&(e.flags|=64,s=!0,rs(r,!1),e.lanes=33554432);r.isBackwards?(l.sibling=e.child,e.child=l):(null!==(n=r.last)?n.sibling=l:e.child=l,r.last=l)}return null!==r.tail?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=e.lastEffect,r.renderingStartTime=Ui(),n.sibling=null,e=Bo.current,ci(Bo,s?1&e|2:1&e),n):null;case 23:case 24:return bu(),null!==t&&null!==t.memoizedState!=(null!==e.memoizedState)&&"unstable-defer-without-hiding"!==r.mode&&(e.flags|=4),null}throw Error(a(156,e.tag))}function os(t){switch(t.tag){case 1:vi(t.type)&&mi();var e=t.flags;return 4096&e?(t.flags=-4097&e|64,t):null;case 3:if(Lo(),li(pi),li(fi),qo(),0!=(64&(e=t.flags)))throw Error(a(285));return t.flags=-4097&e|64,t;case 5:return No(t),null;case 13:return li(Bo),4096&(e=t.flags)?(t.flags=-4097&e|64,t):null;case 19:return li(Bo),null;case 4:return Lo(),null;case 10:return no(t),null;case 23:case 24:return bu(),null;default:return null}}function as(t,e){try{var n="",r=e;do{n+=H(r),r=r.return}while(r);var i=n}catch(t){i="\nError generating stack: "+t.message+"\n"+t.stack}return{value:t,source:e,stack:i}}function ss(t,e){try{console.error(e.value)}catch(t){setTimeout((function(){throw t}))}}Xa=function(t,e){for(var n=e.child;null!==n;){if(5===n.tag||6===n.tag)t.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ya=function(t,e,n,r){var o=t.memoizedProps;if(o!==r){t=e.stateNode,Oo(Mo.current);var a,s=null;switch(n){case"input":o=$(t,o),r=$(t,r),s=[];break;case"option":o=ot(t,o),r=ot(t,r),s=[];break;case"select":o=i({},o,{value:void 0}),r=i({},r,{value:void 0}),s=[];break;case"textarea":o=st(t,o),r=st(t,r),s=[];break;default:"function"!=typeof o.onClick&&"function"==typeof r.onClick&&(t.onclick=Fr)}for(h in Et(n,r),n=null,o)if(!r.hasOwnProperty(h)&&o.hasOwnProperty(h)&&null!=o[h])if("style"===h){var l=o[h];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(u.hasOwnProperty(h)?s||(s=[]):(s=s||[]).push(h,null));for(h in r){var c=r[h];if(l=null!=o?o[h]:void 0,r.hasOwnProperty(h)&&c!==l&&(null!=c||null!=l))if("style"===h)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(s||(s=[]),s.push(h,n)),n=c;else"dangerouslySetInnerHTML"===h?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(h,c)):"children"===h?"string"!=typeof c&&"number"!=typeof c||(s=s||[]).push(h,""+c):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(u.hasOwnProperty(h)?(null!=c&&"onScroll"===h&&Mr("scroll",t),s||l===c||(s=[])):"object"==typeof c&&null!==c&&c.$$typeof===D?c.toString():(s=s||[]).push(h,c))}n&&(s=s||[]).push("style",n);var h=s;(e.updateQueue=h)&&(e.flags|=4)}},qa=function(t,e,n,r){n!==r&&(e.flags|=4)};var us="function"==typeof WeakMap?WeakMap:Map;function ls(t,e,n){(n=lo(-1,n)).tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Xs||(Xs=!0,Ys=r),ss(0,e)},n}function cs(t,e,n){(n=lo(-1,n)).tag=3;var r=t.type.getDerivedStateFromError;if("function"==typeof r){var i=e.value;n.payload=function(){return ss(0,e),r(i)}}var o=t.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(n.callback=function(){"function"!=typeof r&&(null===qs?qs=new Set([this]):qs.add(this),ss(0,e));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),n}var hs="function"==typeof WeakSet?WeakSet:Set;function fs(t){var e=t.ref;if(null!==e)if("function"==typeof e)try{e(null)}catch(e){Bu(t,e)}else e.current=null}function ps(t,e){switch(e.tag){case 0:case 11:case 15:case 22:case 5:case 6:case 4:case 17:return;case 1:if(256&e.flags&&null!==t){var n=t.memoizedProps,r=t.memoizedState;e=(t=e.stateNode).getSnapshotBeforeUpdate(e.elementType===e.type?n:Ki(e.type,n),r),t.__reactInternalSnapshotBeforeUpdate=e}return;case 3:return void(256&e.flags&&Hr(e.stateNode.containerInfo))}throw Error(a(163))}function ds(t,e,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(e=null!==(e=n.updateQueue)?e.lastEffect:null)){t=e=e.next;do{if(3==(3&t.tag)){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}if(null!==(e=null!==(e=n.updateQueue)?e.lastEffect:null)){t=e=e.next;do{var i=t;r=i.next,0!=(4&(i=i.tag))&&0!=(1&i)&&(Lu(n,t),Ru(n,t)),t=r}while(t!==e)}return;case 1:return t=n.stateNode,4&n.flags&&(null===e?t.componentDidMount():(r=n.elementType===n.type?e.memoizedProps:Ki(n.type,e.memoizedProps),t.componentDidUpdate(r,e.memoizedState,t.__reactInternalSnapshotBeforeUpdate))),void(null!==(e=n.updateQueue)&&po(n,e,t));case 3:if(null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 5:case 1:t=n.child.stateNode}po(n,e,t)}return;case 5:return t=n.stateNode,void(null===e&&4&n.flags&&Ur(n.type,n.memoizedProps)&&t.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:case 23:case 24:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&xe(n)))))}throw Error(a(163))}function gs(t,e){for(var n=t;;){if(5===n.tag){var r=n.stateNode;if(e)"function"==typeof(r=r.style).setProperty?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=null!=i&&i.hasOwnProperty("display")?i.display:null,r.style.display=bt("display",i)}}else if(6===n.tag)n.stateNode.nodeValue=e?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===t)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function vs(t,e){if(Ei&&"function"==typeof Ei.onCommitFiberUnmount)try{Ei.onCommitFiberUnmount(wi,e)}catch(t){}switch(e.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(t=e.updateQueue)&&null!==(t=t.lastEffect)){var n=t=t.next;do{var r=n,i=r.destroy;if(r=r.tag,void 0!==i)if(0!=(4&r))Lu(e,n);else{r=e;try{i()}catch(t){Bu(r,t)}}n=n.next}while(n!==t)}break;case 1:if(fs(e),"function"==typeof(t=e.stateNode).componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){Bu(e,t)}break;case 5:fs(e);break;case 4:ws(t,e)}}function ms(t){t.alternate=null,t.child=null,t.dependencies=null,t.firstEffect=null,t.lastEffect=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.return=null,t.updateQueue=null}function ys(t){return 5===t.tag||3===t.tag||4===t.tag}function _s(t){t:{for(var e=t.return;null!==e;){if(ys(e))break t;e=e.return}throw Error(a(160))}var n=e;switch(e=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:e=e.containerInfo,r=!0;break;default:throw Error(a(161))}16&n.flags&&(mt(e,""),n.flags&=-17);t:e:for(n=t;;){for(;null===n.sibling;){if(null===n.return||ys(n.return)){n=null;break t}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue e;if(null===n.child||4===n.tag)continue e;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break t}}r?bs(t,n,e):xs(t,n,e)}function bs(t,e,n){var r=t.tag,i=5===r||6===r;if(i)t=i?t.stateNode:t.stateNode.instance,e?8===n.nodeType?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(8===n.nodeType?(e=n.parentNode).insertBefore(t,n):(e=n).appendChild(t),null!=(n=n._reactRootContainer)||null!==e.onclick||(e.onclick=Fr));else if(4!==r&&null!==(t=t.child))for(bs(t,e,n),t=t.sibling;null!==t;)bs(t,e,n),t=t.sibling}function xs(t,e,n){var r=t.tag,i=5===r||6===r;if(i)t=i?t.stateNode:t.stateNode.instance,e?n.insertBefore(t,e):n.appendChild(t);else if(4!==r&&null!==(t=t.child))for(xs(t,e,n),t=t.sibling;null!==t;)xs(t,e,n),t=t.sibling}function ws(t,e){for(var n,r,i=e,o=!1;;){if(!o){o=i.return;t:for(;;){if(null===o)throw Error(a(160));switch(n=o.stateNode,o.tag){case 5:r=!1;break t;case 3:case 4:n=n.containerInfo,r=!0;break t}o=o.return}o=!0}if(5===i.tag||6===i.tag){t:for(var s=t,u=i,l=u;;)if(vs(s,l),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===u)break t;for(;null===l.sibling;){if(null===l.return||l.return===u)break t;l=l.return}l.sibling.return=l.return,l=l.sibling}r?(s=n,u=i.stateNode,8===s.nodeType?s.parentNode.removeChild(u):s.removeChild(u)):n.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){n=i.stateNode.containerInfo,r=!0,i.child.return=i,i=i.child;continue}}else if(vs(t,i),null!==i.child){i.child.return=i,i=i.child;continue}if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;4===(i=i.return).tag&&(o=!1)}i.sibling.return=i.return,i=i.sibling}}function Es(t,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:var n=e.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{3==(3&r.tag)&&(t=r.destroy,r.destroy=void 0,void 0!==t&&t()),r=r.next}while(r!==n)}return;case 1:case 12:case 17:return;case 5:if(null!=(n=e.stateNode)){r=e.memoizedProps;var i=null!==t?t.memoizedProps:r;t=e.type;var o=e.updateQueue;if(e.updateQueue=null,null!==o){for(n[Jr]=r,"input"===t&&"radio"===r.type&&null!=r.name&&et(n,r),St(t,i),e=St(t,r),i=0;i<o.length;i+=2){var s=o[i],u=o[i+1];"style"===s?xt(n,u):"dangerouslySetInnerHTML"===s?vt(n,u):"children"===s?mt(n,u):b(n,s,u,e)}switch(t){case"input":nt(n,r);break;case"textarea":lt(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(o=r.value)?at(n,!!r.multiple,o,!1):t!==!!r.multiple&&(null!=r.defaultValue?at(n,!!r.multiple,r.defaultValue,!0):at(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===e.stateNode)throw Error(a(162));return void(e.stateNode.nodeValue=e.memoizedProps);case 3:return void((n=e.stateNode).hydrate&&(n.hydrate=!1,xe(n.containerInfo)));case 13:return null!==e.memoizedState&&(Us=Ui(),gs(e.child,!0)),void Ss(e);case 19:return void Ss(e);case 23:case 24:return void gs(e,null!==e.memoizedState)}throw Error(a(163))}function Ss(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var n=t.stateNode;null===n&&(n=t.stateNode=new hs),e.forEach((function(e){var r=Fu.bind(null,t,e);n.has(e)||(n.add(e),e.then(r,r))}))}}function Cs(t,e){return null!==t&&(null===(t=t.memoizedState)||null!==t.dehydrated)&&null!==(e=e.memoizedState)&&null===e.dehydrated}var As=Math.ceil,Ts=x.ReactCurrentDispatcher,ks=x.ReactCurrentOwner,Ms=0,Ps=null,Is=null,Os=0,Rs=0,Ls=ui(0),Ds=0,Ns=null,Bs=0,zs=0,Fs=0,Zs=0,js=null,Us=0,Gs=1/0;function Vs(){Gs=Ui()+500}var Ws,Hs=null,Xs=!1,Ys=null,qs=null,Ks=!1,Qs=null,Js=90,$s=[],tu=[],eu=null,nu=0,ru=null,iu=-1,ou=0,au=0,su=null,uu=!1;function lu(){return 0!=(48&Ms)?Ui():-1!==iu?iu:iu=Ui()}function cu(t){if(0==(2&(t=t.mode)))return 1;if(0==(4&t))return 99===Gi()?1:2;if(0===ou&&(ou=Bs),0!==qi.transition){0!==au&&(au=null!==js?js.pendingLanes:0),t=ou;var e=4186112&~au;return 0==(e&=-e)&&0==(e=(t=4186112&~t)&-t)&&(e=8192),e}return t=Gi(),t=Fe(0!=(4&Ms)&&98===t?12:t=function(t){switch(t){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(t),ou)}function hu(t,e,n){if(50<nu)throw nu=0,ru=null,Error(a(185));if(null===(t=fu(t,e)))return null;Ue(t,e,n),t===Ps&&(Fs|=e,4===Ds&&gu(t,Os));var r=Gi();1===e?0!=(8&Ms)&&0==(48&Ms)?vu(t):(pu(t,n),0===Ms&&(Vs(),Xi())):(0==(4&Ms)||98!==r&&99!==r||(null===eu?eu=new Set([t]):eu.add(t)),pu(t,n)),js=t}function fu(t,e){t.lanes|=e;var n=t.alternate;for(null!==n&&(n.lanes|=e),n=t,t=t.return;null!==t;)t.childLanes|=e,null!==(n=t.alternate)&&(n.childLanes|=e),n=t,t=t.return;return 3===n.tag?n.stateNode:null}function pu(t,e){for(var n=t.callbackNode,r=t.suspendedLanes,i=t.pingedLanes,o=t.expirationTimes,s=t.pendingLanes;0<s;){var u=31-Ge(s),l=1<<u,c=o[u];if(-1===c){if(0==(l&r)||0!=(l&i)){c=e,Ne(l);var h=De;o[u]=10<=h?c+250:6<=h?c+5e3:-1}}else c<=e&&(t.expiredLanes|=l);s&=~l}if(r=Be(t,t===Ps?Os:0),e=De,0===r)null!==n&&(n!==Ni&&Ai(n),t.callbackNode=null,t.callbackPriority=0);else{if(null!==n){if(t.callbackPriority===e)return;n!==Ni&&Ai(n)}15===e?(n=vu.bind(null,t),null===zi?(zi=[n],Fi=Ci(Ii,Yi)):zi.push(n),n=Ni):14===e?n=Hi(99,vu.bind(null,t)):(n=function(t){switch(t){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(a(358,t))}}(e),n=Hi(n,du.bind(null,t))),t.callbackPriority=e,t.callbackNode=n}}function du(t){if(iu=-1,au=ou=0,0!=(48&Ms))throw Error(a(327));var e=t.callbackNode;if(Ou()&&t.callbackNode!==e)return null;var n=Be(t,t===Ps?Os:0);if(0===n)return null;var r=n,i=Ms;Ms|=16;var o=Eu();for(Ps===t&&Os===r||(Vs(),xu(t,r));;)try{Au();break}catch(e){wu(t,e)}if(eo(),Ts.current=o,Ms=i,null!==Is?r=0:(Ps=null,Os=0,r=Ds),0!=(Bs&Fs))xu(t,0);else if(0!==r){if(2===r&&(Ms|=64,t.hydrate&&(t.hydrate=!1,Hr(t.containerInfo)),0!==(n=ze(t))&&(r=Su(t,n))),1===r)throw e=Ns,xu(t,0),gu(t,n),pu(t,Ui()),e;switch(t.finishedWork=t.current.alternate,t.finishedLanes=n,r){case 0:case 1:throw Error(a(345));case 2:case 5:Mu(t);break;case 3:if(gu(t,n),(62914560&n)===n&&10<(r=Us+500-Ui())){if(0!==Be(t,0))break;if(((i=t.suspendedLanes)&n)!==n){lu(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Vr(Mu.bind(null,t),r);break}Mu(t);break;case 4:if(gu(t,n),(4186112&n)===n)break;for(r=t.eventTimes,i=-1;0<n;){var s=31-Ge(n);o=1<<s,(s=r[s])>i&&(i=s),n&=~o}if(n=i,10<(n=(120>(n=Ui()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*As(n/1960))-n)){t.timeoutHandle=Vr(Mu.bind(null,t),n);break}Mu(t);break;default:throw Error(a(329))}}return pu(t,Ui()),t.callbackNode===e?du.bind(null,t):null}function gu(t,e){for(e&=~Zs,e&=~Fs,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ge(e),r=1<<n;t[n]=-1,e&=~r}}function vu(t){if(0!=(48&Ms))throw Error(a(327));if(Ou(),t===Ps&&0!=(t.expiredLanes&Os)){var e=Os,n=Su(t,e);0!=(Bs&Fs)&&(n=Su(t,e=Be(t,e)))}else n=Su(t,e=Be(t,0));if(0!==t.tag&&2===n&&(Ms|=64,t.hydrate&&(t.hydrate=!1,Hr(t.containerInfo)),0!==(e=ze(t))&&(n=Su(t,e))),1===n)throw n=Ns,xu(t,0),gu(t,e),pu(t,Ui()),n;return t.finishedWork=t.current.alternate,t.finishedLanes=e,Mu(t),pu(t,Ui()),null}function mu(t,e){var n=Ms;Ms|=1;try{return t(e)}finally{0===(Ms=n)&&(Vs(),Xi())}}function yu(t,e){var n=Ms;Ms&=-2,Ms|=8;try{return t(e)}finally{0===(Ms=n)&&(Vs(),Xi())}}function _u(t,e){ci(Ls,Rs),Rs|=e,Bs|=e}function bu(){Rs=Ls.current,li(Ls)}function xu(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(-1!==n&&(t.timeoutHandle=-1,Wr(n)),null!==Is)for(n=Is.return;null!==n;){var r=n;switch(r.tag){case 1:null!=(r=r.type.childContextTypes)&&mi();break;case 3:Lo(),li(pi),li(fi),qo();break;case 5:No(r);break;case 4:Lo();break;case 13:case 19:li(Bo);break;case 10:no(r);break;case 23:case 24:bu()}n=n.return}Ps=t,Is=Gu(t.current,null),Os=Rs=Bs=e,Ds=0,Ns=null,Zs=Fs=zs=0}function wu(t,e){for(;;){var n=Is;try{if(eo(),Ko.current=Ia,na){for(var r=$o.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}na=!1}if(Jo=0,ea=ta=$o=null,ra=!1,ks.current=null,null===n||null===n.return){Ds=1,Ns=e,Is=null;break}t:{var o=t,a=n.return,s=n,u=e;if(e=Os,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==u&&"object"==typeof u&&"function"==typeof u.then){var l=u;if(0==(2&s.mode)){var c=s.alternate;c?(s.updateQueue=c.updateQueue,s.memoizedState=c.memoizedState,s.lanes=c.lanes):(s.updateQueue=null,s.memoizedState=null)}var h=0!=(1&Bo.current),f=a;do{var p;if(p=13===f.tag){var d=f.memoizedState;if(null!==d)p=null!==d.dehydrated;else{var g=f.memoizedProps;p=void 0!==g.fallback&&(!0!==g.unstable_avoidThisFallback||!h)}}if(p){var v=f.updateQueue;if(null===v){var m=new Set;m.add(l),f.updateQueue=m}else v.add(l);if(0==(2&f.mode)){if(f.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var y=lo(-1,1);y.tag=2,co(s,y)}s.lanes|=1;break t}u=void 0,s=e;var _=o.pingCache;if(null===_?(_=o.pingCache=new us,u=new Set,_.set(l,u)):void 0===(u=_.get(l))&&(u=new Set,_.set(l,u)),!u.has(s)){u.add(s);var b=zu.bind(null,o,l,s);l.then(b,b)}f.flags|=4096,f.lanes=e;break t}f=f.return}while(null!==f);u=Error((X(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Ds&&(Ds=2),u=as(u,s),f=a;do{switch(f.tag){case 3:o=u,f.flags|=4096,e&=-e,f.lanes|=e,ho(f,ls(0,o,e));break t;case 1:o=u;var x=f.type,w=f.stateNode;if(0==(64&f.flags)&&("function"==typeof x.getDerivedStateFromError||null!==w&&"function"==typeof w.componentDidCatch&&(null===qs||!qs.has(w)))){f.flags|=4096,e&=-e,f.lanes|=e,ho(f,cs(f,o,e));break t}}f=f.return}while(null!==f)}ku(n)}catch(t){e=t,Is===n&&null!==n&&(Is=n=n.return);continue}break}}function Eu(){var t=Ts.current;return Ts.current=Ia,null===t?Ia:t}function Su(t,e){var n=Ms;Ms|=16;var r=Eu();for(Ps===t&&Os===e||xu(t,e);;)try{Cu();break}catch(e){wu(t,e)}if(eo(),Ms=n,Ts.current=r,null!==Is)throw Error(a(261));return Ps=null,Os=0,Ds}function Cu(){for(;null!==Is;)Tu(Is)}function Au(){for(;null!==Is&&!Ti();)Tu(Is)}function Tu(t){var e=Ws(t.alternate,t,Rs);t.memoizedProps=t.pendingProps,null===e?ku(t):Is=e,ks.current=null}function ku(t){var e=t;do{var n=e.alternate;if(t=e.return,0==(2048&e.flags)){if(null!==(n=is(n,e,Rs)))return void(Is=n);if(24!==(n=e).tag&&23!==n.tag||null===n.memoizedState||0!=(1073741824&Rs)||0==(4&n.mode)){for(var r=0,i=n.child;null!==i;)r|=i.lanes|i.childLanes,i=i.sibling;n.childLanes=r}null!==t&&0==(2048&t.flags)&&(null===t.firstEffect&&(t.firstEffect=e.firstEffect),null!==e.lastEffect&&(null!==t.lastEffect&&(t.lastEffect.nextEffect=e.firstEffect),t.lastEffect=e.lastEffect),1<e.flags&&(null!==t.lastEffect?t.lastEffect.nextEffect=e:t.firstEffect=e,t.lastEffect=e))}else{if(null!==(n=os(e)))return n.flags&=2047,void(Is=n);null!==t&&(t.firstEffect=t.lastEffect=null,t.flags|=2048)}if(null!==(e=e.sibling))return void(Is=e);Is=e=t}while(null!==e);0===Ds&&(Ds=5)}function Mu(t){var e=Gi();return Wi(99,Pu.bind(null,t,e)),null}function Pu(t,e){do{Ou()}while(null!==Qs);if(0!=(48&Ms))throw Error(a(327));var n=t.finishedWork;if(null===n)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(a(177));t.callbackNode=null;var r=n.lanes|n.childLanes,i=r,o=t.pendingLanes&~i;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=i,t.mutableReadLanes&=i,t.entangledLanes&=i,i=t.entanglements;for(var s=t.eventTimes,u=t.expirationTimes;0<o;){var l=31-Ge(o),c=1<<l;i[l]=0,s[l]=-1,u[l]=-1,o&=~c}if(null!==eu&&0==(24&r)&&eu.has(t)&&eu.delete(t),t===Ps&&(Is=Ps=null,Os=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){if(i=Ms,Ms|=32,ks.current=null,Zr=Ye,vr(s=gr())){if("selectionStart"in s)u={start:s.selectionStart,end:s.selectionEnd};else t:if(u=(u=s.ownerDocument)&&u.defaultView||window,(c=u.getSelection&&u.getSelection())&&0!==c.rangeCount){u=c.anchorNode,o=c.anchorOffset,l=c.focusNode,c=c.focusOffset;try{u.nodeType,l.nodeType}catch(t){u=null;break t}var h=0,f=-1,p=-1,d=0,g=0,v=s,m=null;e:for(;;){for(var y;v!==u||0!==o&&3!==v.nodeType||(f=h+o),v!==l||0!==c&&3!==v.nodeType||(p=h+c),3===v.nodeType&&(h+=v.nodeValue.length),null!==(y=v.firstChild);)m=v,v=y;for(;;){if(v===s)break e;if(m===u&&++d===o&&(f=h),m===l&&++g===c&&(p=h),null!==(y=v.nextSibling))break;m=(v=m).parentNode}v=y}u=-1===f||-1===p?null:{start:f,end:p}}else u=null;u=u||{start:0,end:0}}else u=null;jr={focusedElem:s,selectionRange:u},Ye=!1,su=null,uu=!1,Hs=r;do{try{Iu()}catch(t){if(null===Hs)throw Error(a(330));Bu(Hs,t),Hs=Hs.nextEffect}}while(null!==Hs);su=null,Hs=r;do{try{for(s=t;null!==Hs;){var _=Hs.flags;if(16&_&&mt(Hs.stateNode,""),128&_){var b=Hs.alternate;if(null!==b){var x=b.ref;null!==x&&("function"==typeof x?x(null):x.current=null)}}switch(1038&_){case 2:_s(Hs),Hs.flags&=-3;break;case 6:_s(Hs),Hs.flags&=-3,Es(Hs.alternate,Hs);break;case 1024:Hs.flags&=-1025;break;case 1028:Hs.flags&=-1025,Es(Hs.alternate,Hs);break;case 4:Es(Hs.alternate,Hs);break;case 8:ws(s,u=Hs);var w=u.alternate;ms(u),null!==w&&ms(w)}Hs=Hs.nextEffect}}catch(t){if(null===Hs)throw Error(a(330));Bu(Hs,t),Hs=Hs.nextEffect}}while(null!==Hs);if(x=jr,b=gr(),_=x.focusedElem,s=x.selectionRange,b!==_&&_&&_.ownerDocument&&dr(_.ownerDocument.documentElement,_)){null!==s&&vr(_)&&(b=s.start,void 0===(x=s.end)&&(x=b),"selectionStart"in _?(_.selectionStart=b,_.selectionEnd=Math.min(x,_.value.length)):(x=(b=_.ownerDocument||document)&&b.defaultView||window).getSelection&&(x=x.getSelection(),u=_.textContent.length,w=Math.min(s.start,u),s=void 0===s.end?w:Math.min(s.end,u),!x.extend&&w>s&&(u=s,s=w,w=u),u=pr(_,w),o=pr(_,s),u&&o&&(1!==x.rangeCount||x.anchorNode!==u.node||x.anchorOffset!==u.offset||x.focusNode!==o.node||x.focusOffset!==o.offset)&&((b=b.createRange()).setStart(u.node,u.offset),x.removeAllRanges(),w>s?(x.addRange(b),x.extend(o.node,o.offset)):(b.setEnd(o.node,o.offset),x.addRange(b))))),b=[];for(x=_;x=x.parentNode;)1===x.nodeType&&b.push({element:x,left:x.scrollLeft,top:x.scrollTop});for("function"==typeof _.focus&&_.focus(),_=0;_<b.length;_++)(x=b[_]).element.scrollLeft=x.left,x.element.scrollTop=x.top}Ye=!!Zr,jr=Zr=null,t.current=n,Hs=r;do{try{for(_=t;null!==Hs;){var E=Hs.flags;if(36&E&&ds(_,Hs.alternate,Hs),128&E){b=void 0;var S=Hs.ref;if(null!==S){var C=Hs.stateNode;Hs.tag,b=C,"function"==typeof S?S(b):S.current=b}}Hs=Hs.nextEffect}}catch(t){if(null===Hs)throw Error(a(330));Bu(Hs,t),Hs=Hs.nextEffect}}while(null!==Hs);Hs=null,Bi(),Ms=i}else t.current=n;if(Ks)Ks=!1,Qs=t,Js=e;else for(Hs=r;null!==Hs;)e=Hs.nextEffect,Hs.nextEffect=null,8&Hs.flags&&((E=Hs).sibling=null,E.stateNode=null),Hs=e;if(0===(r=t.pendingLanes)&&(qs=null),1===r?t===ru?nu++:(nu=0,ru=t):nu=0,n=n.stateNode,Ei&&"function"==typeof Ei.onCommitFiberRoot)try{Ei.onCommitFiberRoot(wi,n,void 0,64==(64&n.current.flags))}catch(t){}if(pu(t,Ui()),Xs)throw Xs=!1,t=Ys,Ys=null,t;return 0!=(8&Ms)||Xi(),null}function Iu(){for(;null!==Hs;){var t=Hs.alternate;uu||null===su||(0!=(8&Hs.flags)?$t(Hs,su)&&(uu=!0):13===Hs.tag&&Cs(t,Hs)&&$t(Hs,su)&&(uu=!0));var e=Hs.flags;0!=(256&e)&&ps(t,Hs),0==(512&e)||Ks||(Ks=!0,Hi(97,(function(){return Ou(),null}))),Hs=Hs.nextEffect}}function Ou(){if(90!==Js){var t=97<Js?97:Js;return Js=90,Wi(t,Du)}return!1}function Ru(t,e){$s.push(e,t),Ks||(Ks=!0,Hi(97,(function(){return Ou(),null})))}function Lu(t,e){tu.push(e,t),Ks||(Ks=!0,Hi(97,(function(){return Ou(),null})))}function Du(){if(null===Qs)return!1;var t=Qs;if(Qs=null,0!=(48&Ms))throw Error(a(331));var e=Ms;Ms|=32;var n=tu;tu=[];for(var r=0;r<n.length;r+=2){var i=n[r],o=n[r+1],s=i.destroy;if(i.destroy=void 0,"function"==typeof s)try{s()}catch(t){if(null===o)throw Error(a(330));Bu(o,t)}}for(n=$s,$s=[],r=0;r<n.length;r+=2){i=n[r],o=n[r+1];try{var u=i.create;i.destroy=u()}catch(t){if(null===o)throw Error(a(330));Bu(o,t)}}for(u=t.current.firstEffect;null!==u;)t=u.nextEffect,u.nextEffect=null,8&u.flags&&(u.sibling=null,u.stateNode=null),u=t;return Ms=e,Xi(),!0}function Nu(t,e,n){co(t,e=ls(0,e=as(n,e),1)),e=lu(),null!==(t=fu(t,1))&&(Ue(t,1,e),pu(t,e))}function Bu(t,e){if(3===t.tag)Nu(t,t,e);else for(var n=t.return;null!==n;){if(3===n.tag){Nu(n,t,e);break}if(1===n.tag){var r=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===qs||!qs.has(r))){var i=cs(n,t=as(e,t),1);if(co(n,i),i=lu(),null!==(n=fu(n,1)))Ue(n,1,i),pu(n,i);else if("function"==typeof r.componentDidCatch&&(null===qs||!qs.has(r)))try{r.componentDidCatch(e,t)}catch(t){}break}}n=n.return}}function zu(t,e,n){var r=t.pingCache;null!==r&&r.delete(e),e=lu(),t.pingedLanes|=t.suspendedLanes&n,Ps===t&&(Os&n)===n&&(4===Ds||3===Ds&&(62914560&Os)===Os&&500>Ui()-Us?xu(t,0):Zs|=n),pu(t,e)}function Fu(t,e){var n=t.stateNode;null!==n&&n.delete(e),0==(e=0)&&(0==(2&(e=t.mode))?e=1:0==(4&e)?e=99===Gi()?1:2:(0===ou&&(ou=Bs),0===(e=Ze(62914560&~ou))&&(e=4194304))),n=lu(),null!==(t=fu(t,e))&&(Ue(t,e,n),pu(t,n))}function Zu(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function ju(t,e,n,r){return new Zu(t,e,n,r)}function Uu(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Gu(t,e){var n=t.alternate;return null===n?((n=ju(t.tag,e,t.key,t.mode)).elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Vu(t,e,n,r,i,o){var s=2;if(r=t,"function"==typeof t)Uu(t)&&(s=1);else if("string"==typeof t)s=5;else t:switch(t){case S:return Wu(n.children,i,o,e);case N:s=8,i|=16;break;case C:s=8,i|=1;break;case A:return(t=ju(12,n,e,8|i)).elementType=A,t.type=A,t.lanes=o,t;case P:return(t=ju(13,n,e,i)).type=P,t.elementType=P,t.lanes=o,t;case I:return(t=ju(19,n,e,i)).elementType=I,t.lanes=o,t;case B:return Hu(n,i,o,e);case z:return(t=ju(24,n,e,i)).elementType=z,t.lanes=o,t;default:if("object"==typeof t&&null!==t)switch(t.$$typeof){case T:s=10;break t;case k:s=9;break t;case M:s=11;break t;case O:s=14;break t;case R:s=16,r=null;break t;case L:s=22;break t}throw Error(a(130,null==t?t:typeof t,""))}return(e=ju(s,n,e,i)).elementType=t,e.type=r,e.lanes=o,e}function Wu(t,e,n,r){return(t=ju(7,t,r,e)).lanes=n,t}function Hu(t,e,n,r){return(t=ju(23,t,r,e)).elementType=B,t.lanes=n,t}function Xu(t,e,n){return(t=ju(6,t,null,e)).lanes=n,t}function Yu(t,e,n){return(e=ju(4,null!==t.children?t.children:[],t.key,e)).lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function qu(t,e,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=je(0),this.expirationTimes=je(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=je(0),this.mutableSourceEagerHydrationData=null}function Ku(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:E,key:null==r?null:""+r,children:t,containerInfo:e,implementation:n}}function Qu(t,e,n,r){var i=e.current,o=lu(),s=cu(i);t:if(n){e:{if(qt(n=n._reactInternals)!==n||1!==n.tag)throw Error(a(170));var u=n;do{switch(u.tag){case 3:u=u.stateNode.context;break e;case 1:if(vi(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break e}}u=u.return}while(null!==u);throw Error(a(171))}if(1===n.tag){var l=n.type;if(vi(l)){n=_i(n,l,u);break t}}n=u}else n=hi;return null===e.context?e.context=n:e.pendingContext=n,(e=lo(o,s)).payload={element:t},null!==(r=void 0===r?null:r)&&(e.callback=r),co(i,e),hu(i,s,o),s}function Ju(t){return(t=t.current).child?(t.child.tag,t.child.stateNode):null}function $u(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var n=t.retryLane;t.retryLane=0!==n&&n<e?n:e}}function tl(t,e){$u(t,e),(t=t.alternate)&&$u(t,e)}function el(t,e,n){var r=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new qu(t,e,null!=n&&!0===n.hydrate),e=ju(3,null,null,2===e?7:1===e?3:0),n.current=e,e.stateNode=n,so(e),t[$r]=n.current,Ir(8===t.nodeType?t.parentNode:t),r)for(t=0;t<r.length;t++){var i=(e=r[t])._getVersion;i=i(e._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[e,i]:n.mutableSourceEagerHydrationData.push(e,i)}this._internalRoot=n}function nl(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType&&(8!==t.nodeType||" react-mount-point-unstable "!==t.nodeValue))}function rl(t,e,n,r,i){var o=n._reactRootContainer;if(o){var a=o._internalRoot;if("function"==typeof i){var s=i;i=function(){var t=Ju(a);s.call(t)}}Qu(e,a,t,i)}else{if(o=n._reactRootContainer=function(t,e){if(e||(e=!(!(e=t?9===t.nodeType?t.documentElement:t.firstChild:null)||1!==e.nodeType||!e.hasAttribute("data-reactroot"))),!e)for(var n;n=t.lastChild;)t.removeChild(n);return new el(t,0,e?{hydrate:!0}:void 0)}(n,r),a=o._internalRoot,"function"==typeof i){var u=i;i=function(){var t=Ju(a);u.call(t)}}yu((function(){Qu(e,a,t,i)}))}return Ju(a)}function il(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!nl(e))throw Error(a(200));return Ku(t,e,null,n)}Ws=function(t,e,n){var r=e.lanes;if(null!==t)if(t.memoizedProps!==e.pendingProps||pi.current)Na=!0;else{if(0==(n&r)){switch(Na=!1,e.tag){case 3:Ha(e),Xo();break;case 5:Do(e);break;case 1:vi(e.type)&&bi(e);break;case 4:Ro(e,e.stateNode.containerInfo);break;case 10:r=e.memoizedProps.value;var i=e.type._context;ci(Qi,i._currentValue),i._currentValue=r;break;case 13:if(null!==e.memoizedState)return 0!=(n&e.child.childLanes)?Qa(t,e,n):(ci(Bo,1&Bo.current),null!==(e=ns(t,e,n))?e.sibling:null);ci(Bo,1&Bo.current);break;case 19:if(r=0!=(n&e.childLanes),0!=(64&t.flags)){if(r)return es(t,e,n);e.flags|=64}if(null!==(i=e.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),ci(Bo,Bo.current),r)break;return null;case 23:case 24:return e.lanes=0,ja(t,e,n)}return ns(t,e,n)}Na=0!=(16384&t.flags)}else Na=!1;switch(e.lanes=0,e.tag){case 2:if(r=e.type,null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,i=gi(e,fi.current),io(e,n),i=aa(null,e,r,t,i,n),e.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,vi(r)){var o=!0;bi(e)}else o=!1;e.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,so(e);var s=r.getDerivedStateFromProps;"function"==typeof s&&vo(e,r,s,t),i.updater=mo,e.stateNode=i,i._reactInternals=e,xo(e,r,t,n),e=Wa(null,e,r,!0,o,n)}else e.tag=0,Ba(null,e,i,n),e=e.child;return e;case 16:i=e.elementType;t:{switch(null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,i=(o=i._init)(i._payload),e.type=i,o=e.tag=function(t){if("function"==typeof t)return Uu(t)?1:0;if(null!=t){if((t=t.$$typeof)===M)return 11;if(t===O)return 14}return 2}(i),t=Ki(i,t),o){case 0:e=Ga(null,e,i,t,n);break t;case 1:e=Va(null,e,i,t,n);break t;case 11:e=za(null,e,i,t,n);break t;case 14:e=Fa(null,e,i,Ki(i.type,t),r,n);break t}throw Error(a(306,i,""))}return e;case 0:return r=e.type,i=e.pendingProps,Ga(t,e,r,i=e.elementType===r?i:Ki(r,i),n);case 1:return r=e.type,i=e.pendingProps,Va(t,e,r,i=e.elementType===r?i:Ki(r,i),n);case 3:if(Ha(e),r=e.updateQueue,null===t||null===r)throw Error(a(282));if(r=e.pendingProps,i=null!==(i=e.memoizedState)?i.element:null,uo(t,e),fo(e,r,null,n),(r=e.memoizedState.element)===i)Xo(),e=ns(t,e,n);else{if((o=(i=e.stateNode).hydrate)&&(Zo=Xr(e.stateNode.containerInfo.firstChild),Fo=e,o=jo=!0),o){if(null!=(t=i.mutableSourceEagerHydrationData))for(i=0;i<t.length;i+=2)(o=t[i])._workInProgressVersionPrimary=t[i+1],Yo.push(o);for(n=To(e,null,r,n),e.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Ba(t,e,r,n),Xo();e=e.child}return e;case 5:return Do(e),null===t&&Vo(e),r=e.type,i=e.pendingProps,o=null!==t?t.memoizedProps:null,s=i.children,Gr(r,i)?s=null:null!==o&&Gr(r,o)&&(e.flags|=16),Ua(t,e),Ba(t,e,s,n),e.child;case 6:return null===t&&Vo(e),null;case 13:return Qa(t,e,n);case 4:return Ro(e,e.stateNode.containerInfo),r=e.pendingProps,null===t?e.child=Ao(e,null,r,n):Ba(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,za(t,e,r,i=e.elementType===r?i:Ki(r,i),n);case 7:return Ba(t,e,e.pendingProps,n),e.child;case 8:case 12:return Ba(t,e,e.pendingProps.children,n),e.child;case 10:t:{r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value;var u=e.type._context;if(ci(Qi,u._currentValue),u._currentValue=o,null!==s)if(u=s.value,0==(o=lr(u,o)?0:0|("function"==typeof r._calculateChangedBits?r._calculateChangedBits(u,o):1073741823))){if(s.children===i.children&&!pi.current){e=ns(t,e,n);break t}}else for(null!==(u=e.child)&&(u.return=e);null!==u;){var l=u.dependencies;if(null!==l){s=u.child;for(var c=l.firstContext;null!==c;){if(c.context===r&&0!=(c.observedBits&o)){1===u.tag&&((c=lo(-1,n&-n)).tag=2,co(u,c)),u.lanes|=n,null!==(c=u.alternate)&&(c.lanes|=n),ro(u.return,n),l.lanes|=n;break}c=c.next}}else s=10===u.tag&&u.type===e.type?null:u.child;if(null!==s)s.return=u;else for(s=u;null!==s;){if(s===e){s=null;break}if(null!==(u=s.sibling)){u.return=s.return,s=u;break}s=s.return}u=s}Ba(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=(o=e.pendingProps).children,io(e,n),r=r(i=oo(i,o.unstable_observedBits)),e.flags|=1,Ba(t,e,r,n),e.child;case 14:return o=Ki(i=e.type,e.pendingProps),Fa(t,e,i,o=Ki(i.type,o),r,n);case 15:return Za(t,e,e.type,e.pendingProps,r,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ki(r,i),null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,vi(r)?(t=!0,bi(e)):t=!1,io(e,n),_o(e,r,i),xo(e,r,i,n),Wa(null,e,r,!0,t,n);case 19:return es(t,e,n);case 23:case 24:return ja(t,e,n)}throw Error(a(156,e.tag))},el.prototype.render=function(t){Qu(t,this._internalRoot,null,null)},el.prototype.unmount=function(){var t=this._internalRoot,e=t.containerInfo;Qu(null,t,null,(function(){e[$r]=null}))},te=function(t){13===t.tag&&(hu(t,4,lu()),tl(t,4))},ee=function(t){13===t.tag&&(hu(t,67108864,lu()),tl(t,67108864))},ne=function(t){if(13===t.tag){var e=lu(),n=cu(t);hu(t,n,e),tl(t,n)}},re=function(t,e){return e()},At=function(t,e,n){switch(e){case"input":if(nt(t,n),e=n.name,"radio"===n.type&&null!=e){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=ii(r);if(!i)throw Error(a(90));Q(r),nt(r,i)}}}break;case"textarea":lt(t,n);break;case"select":null!=(e=n.value)&&at(t,!!n.multiple,e,!1)}},Ot=mu,Rt=function(t,e,n,r,i){var o=Ms;Ms|=4;try{return Wi(98,t.bind(null,e,n,r,i))}finally{0===(Ms=o)&&(Vs(),Xi())}},Lt=function(){0==(49&Ms)&&(function(){if(null!==eu){var t=eu;eu=null,t.forEach((function(t){t.expiredLanes|=24&t.pendingLanes,pu(t,Ui())}))}Xi()}(),Ou())},Dt=function(t,e){var n=Ms;Ms|=2;try{return t(e)}finally{0===(Ms=n)&&(Vs(),Xi())}};var ol={Events:[ni,ri,ii,Pt,It,Ou,{current:!1}]},al={findFiberByHostInstance:ei,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},sl={bundleType:al.bundleType,version:al.version,rendererPackageName:al.rendererPackageName,rendererConfig:al.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return null===(t=Jt(t))?null:t.stateNode},findFiberByHostInstance:al.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ul=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ul.isDisabled&&ul.supportsFiber)try{wi=ul.inject(sl),Ei=ul}catch(gt){}}e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ol,e.createPortal=il,e.findDOMNode=function(t){if(null==t)return null;if(1===t.nodeType)return t;var e=t._reactInternals;if(void 0===e){if("function"==typeof t.render)throw Error(a(188));throw Error(a(268,Object.keys(t)))}return null===(t=Jt(e))?null:t.stateNode},e.flushSync=function(t,e){var n=Ms;if(0!=(48&n))return t(e);Ms|=1;try{if(t)return Wi(99,t.bind(null,e))}finally{Ms=n,Xi()}},e.hydrate=function(t,e,n){if(!nl(e))throw Error(a(200));return rl(null,t,e,!0,n)},e.render=function(t,e,n){if(!nl(e))throw Error(a(200));return rl(null,t,e,!1,n)},e.unmountComponentAtNode=function(t){if(!nl(t))throw Error(a(40));return!!t._reactRootContainer&&(yu((function(){rl(null,null,t,!1,(function(){t._reactRootContainer=null,t[$r]=null}))})),!0)},e.unstable_batchedUpdates=mu,e.unstable_createPortal=function(t,e){return il(t,e,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},e.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!nl(n))throw Error(a(200));if(null==t||void 0===t._reactInternals)throw Error(a(38));return rl(t,e,n,!1,r)},e.version="17.0.2"},3935:(t,e,n)=>{"use strict";!function t(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(t){console.error(t)}}(),t.exports=n(4448)},2408:(t,e,n)=>{"use strict";var r=n(7418),i=60103,o=60106;e.Fragment=60107,e.StrictMode=60108,e.Profiler=60114;var a=60109,s=60110,u=60112;e.Suspense=60113;var l=60115,c=60116;if("function"==typeof Symbol&&Symbol.for){var h=Symbol.for;i=h("react.element"),o=h("react.portal"),e.Fragment=h("react.fragment"),e.StrictMode=h("react.strict_mode"),e.Profiler=h("react.profiler"),a=h("react.provider"),s=h("react.context"),u=h("react.forward_ref"),e.Suspense=h("react.suspense"),l=h("react.memo"),c=h("react.lazy")}var f="function"==typeof Symbol&&Symbol.iterator;function p(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var d={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g={};function v(t,e,n){this.props=t,this.context=e,this.refs=g,this.updater=n||d}function m(){}function y(t,e,n){this.props=t,this.context=e,this.refs=g,this.updater=n||d}v.prototype.isReactComponent={},v.prototype.setState=function(t,e){if("object"!=typeof t&&"function"!=typeof t&&null!=t)throw Error(p(85));this.updater.enqueueSetState(this,t,e,"setState")},v.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},m.prototype=v.prototype;var _=y.prototype=new m;_.constructor=y,r(_,v.prototype),_.isPureReactComponent=!0;var b={current:null},x=Object.prototype.hasOwnProperty,w={key:!0,ref:!0,__self:!0,__source:!0};function E(t,e,n){var r,o={},a=null,s=null;if(null!=e)for(r in void 0!==e.ref&&(s=e.ref),void 0!==e.key&&(a=""+e.key),e)x.call(e,r)&&!w.hasOwnProperty(r)&&(o[r]=e[r]);var u=arguments.length-2;if(1===u)o.children=n;else if(1<u){for(var l=Array(u),c=0;c<u;c++)l[c]=arguments[c+2];o.children=l}if(t&&t.defaultProps)for(r in u=t.defaultProps)void 0===o[r]&&(o[r]=u[r]);return{$$typeof:i,type:t,key:a,ref:s,props:o,_owner:b.current}}function S(t){return"object"==typeof t&&null!==t&&t.$$typeof===i}var C=/\/+/g;function A(t,e){return"object"==typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,(function(t){return e[t]}))}(""+t.key):e.toString(36)}function T(t,e,n,r,a){var s=typeof t;"undefined"!==s&&"boolean"!==s||(t=null);var u=!1;if(null===t)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(t.$$typeof){case i:case o:u=!0}}if(u)return a=a(u=t),t=""===r?"."+A(u,0):r,Array.isArray(a)?(n="",null!=t&&(n=t.replace(C,"$&/")+"/"),T(a,e,n,"",(function(t){return t}))):null!=a&&(S(a)&&(a=function(t,e){return{$$typeof:i,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(a,n+(!a.key||u&&u.key===a.key?"":(""+a.key).replace(C,"$&/")+"/")+t)),e.push(a)),1;if(u=0,r=""===r?".":r+":",Array.isArray(t))for(var l=0;l<t.length;l++){var c=r+A(s=t[l],l);u+=T(s,e,n,c,a)}else if(c=function(t){return null===t||"object"!=typeof t?null:"function"==typeof(t=f&&t[f]||t["@@iterator"])?t:null}(t),"function"==typeof c)for(t=c.call(t),l=0;!(s=t.next()).done;)u+=T(s=s.value,e,n,c=r+A(s,l++),a);else if("object"===s)throw e=""+t,Error(p(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e));return u}function k(t,e,n){if(null==t)return t;var r=[],i=0;return T(t,r,"","",(function(t){return e.call(n,t,i++)})),r}function M(t){if(-1===t._status){var e=t._result;e=e(),t._status=0,t._result=e,e.then((function(e){0===t._status&&(e=e.default,t._status=1,t._result=e)}),(function(e){0===t._status&&(t._status=2,t._result=e)}))}if(1===t._status)return t._result;throw t._result}var P={current:null};function I(){var t=P.current;if(null===t)throw Error(p(321));return t}var O={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:b,IsSomeRendererActing:{current:!1},assign:r};e.Children={map:k,forEach:function(t,e,n){k(t,(function(){e.apply(this,arguments)}),n)},count:function(t){var e=0;return k(t,(function(){e++})),e},toArray:function(t){return k(t,(function(t){return t}))||[]},only:function(t){if(!S(t))throw Error(p(143));return t}},e.Component=v,e.PureComponent=y,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,e.cloneElement=function(t,e,n){if(null==t)throw Error(p(267,t));var o=r({},t.props),a=t.key,s=t.ref,u=t._owner;if(null!=e){if(void 0!==e.ref&&(s=e.ref,u=b.current),void 0!==e.key&&(a=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)x.call(e,c)&&!w.hasOwnProperty(c)&&(o[c]=void 0===e[c]&&void 0!==l?l[c]:e[c])}var c=arguments.length-2;if(1===c)o.children=n;else if(1<c){l=Array(c);for(var h=0;h<c;h++)l[h]=arguments[h+2];o.children=l}return{$$typeof:i,type:t.type,key:a,ref:s,props:o,_owner:u}},e.createContext=function(t,e){return void 0===e&&(e=null),(t={$$typeof:s,_calculateChangedBits:e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:a,_context:t},t.Consumer=t},e.createElement=E,e.createFactory=function(t){var e=E.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:u,render:t}},e.isValidElement=S,e.lazy=function(t){return{$$typeof:c,_payload:{_status:-1,_result:t},_init:M}},e.memo=function(t,e){return{$$typeof:l,type:t,compare:void 0===e?null:e}},e.useCallback=function(t,e){return I().useCallback(t,e)},e.useContext=function(t,e){return I().useContext(t,e)},e.useDebugValue=function(){},e.useEffect=function(t,e){return I().useEffect(t,e)},e.useImperativeHandle=function(t,e,n){return I().useImperativeHandle(t,e,n)},e.useLayoutEffect=function(t,e){return I().useLayoutEffect(t,e)},e.useMemo=function(t,e){return I().useMemo(t,e)},e.useReducer=function(t,e,n){return I().useReducer(t,e,n)},e.useRef=function(t){return I().useRef(t)},e.useState=function(t){return I().useState(t)},e.version="17.0.2"},7294:(t,e,n)=>{"use strict";t.exports=n(2408)},8660:(t,e,n)=>{var r;!function(t){!function(e){var r="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=o(t);function o(t,e){return function(n,r){"function"!=typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}void 0===r.Reflect?r.Reflect=t:i=o(r.Reflect,i),function(t){var e=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!o&&!a,u={create:o?function(){return D(Object.create(null))}:a?function(){return D({__proto__:null})}:function(){return D({})},has:s?function(t,n){return e.call(t,n)}:function(t,e){return e in t},get:s?function(t,n){return e.call(t,n)?t[n]:void 0}:function(t,e){return t[e]}},l=Object.getPrototypeOf(Function),c="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=c||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[i]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,r)},e.prototype.values=function(){return new n(this._keys,this._values,o)},e.prototype.entries=function(){return new n(this._keys,this._values,a)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[i]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function o(t,e){return e}function a(t,e){return[t,e]}}():Map,f=c||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new h}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[i]=function(){return this.keys()},t}():Set,p=new(c||"function"!=typeof WeakMap?function(){var t=u.create(),n=r();return function(){function t(){this._key=r()}return t.prototype.has=function(t){var e=i(t,!1);return void 0!==e&&u.has(e,this._key)},t.prototype.get=function(t){var e=i(t,!1);return void 0!==e?u.get(e,this._key):void 0},t.prototype.set=function(t,e){return i(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=i(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=r()},t}();function r(){var e;do{e="@@WeakMap@@"+a()}while(u.has(t,e));return t[e]=!0,e}function i(t,r){if(!e.call(t,n)){if(!r)return;Object.defineProperty(t,n,{value:u.create()})}return t[n]}function o(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function a(){var t,e=(t=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):o(new Uint8Array(t),t):o(new Array(t),t));e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",r=0;r<16;++r){var i=e[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function d(t,e,n){var r=p.get(t);if(E(r)){if(!n)return;r=new h,p.set(t,r)}var i=r.get(e);if(E(i)){if(!n)return;i=new h,r.set(e,i)}return i}function g(t,e,n){if(v(t,e,n))return!0;var r=L(e);return!S(r)&&g(t,r,n)}function v(t,e,n){var r=d(e,n,!1);return!E(r)&&!!r.has(t)}function m(t,e,n){if(v(t,e,n))return y(t,e,n);var r=L(e);return S(r)?void 0:m(t,r,n)}function y(t,e,n){var r=d(e,n,!1);if(!E(r))return r.get(t)}function _(t,e,n,r){d(n,r,!0).set(t,e)}function b(t,e){var n=x(t,e),r=L(t);if(null===r)return n;var i=b(r,e);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new f,a=[],s=0,u=n;s<u.length;s++){var l=u[s];o.has(l)||(o.add(l),a.push(l))}for(var c=0,h=i;c<h.length;c++)l=h[c],o.has(l)||(o.add(l),a.push(l));return a}function x(t,e){var n=[],r=d(t,e,!1);if(E(r))return n;for(var o=function(t){var e=I(t,i);if(!M(e))throw new TypeError;var n=e.call(t);if(!C(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=O(o);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(t){try{R(o)}finally{throw t}}a++}}function w(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function E(t){return void 0===t}function S(t){return null===t}function C(t){return"object"==typeof t?null!==t:"function"==typeof t}function A(t,e){switch(w(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",i=I(t,r);if(void 0!==i){var o=i.call(t,n);if(C(o))throw new TypeError;return o}return function(t,e){if("string"===e){var n=t.toString;if(M(n)&&!C(i=n.call(t)))return i;if(M(r=t.valueOf)&&!C(i=r.call(t)))return i}else{var r;if(M(r=t.valueOf)&&!C(i=r.call(t)))return i;var i,o=t.toString;if(M(o)&&!C(i=o.call(t)))return i}throw new TypeError}(t,"default"===n?"number":n)}function T(t){var e=A(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function k(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function M(t){return"function"==typeof t}function P(t){return"function"==typeof t}function I(t,e){var n=t[e];if(null!=n){if(!M(n))throw new TypeError;return n}}function O(t){var e=t.next();return!e.done&&e}function R(t){var e=t.return;e&&e.call(t)}function L(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===l)return e;if(e!==l)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!=typeof i||i===t?e:i}function D(t){return t.__=void 0,delete t.__,t}t("decorate",(function(t,e,n,r){if(E(n)){if(!k(t))throw new TypeError;if(!P(e))throw new TypeError;return function(t,e){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e);if(!E(r)&&!S(r)){if(!P(r))throw new TypeError;e=r}}return e}(t,e)}if(!k(t))throw new TypeError;if(!C(e))throw new TypeError;if(!C(r)&&!E(r)&&!S(r))throw new TypeError;return S(r)&&(r=void 0),function(t,e,n,r){for(var i=t.length-1;i>=0;--i){var o=(0,t[i])(e,n,r);if(!E(o)&&!S(o)){if(!C(o))throw new TypeError;r=o}}return r}(t,e,n=T(n),r)})),t("metadata",(function(t,e){return function(n,r){if(!C(n))throw new TypeError;if(!E(r)&&!function(t){switch(w(t)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;_(t,e,n,r)}})),t("defineMetadata",(function(t,e,n,r){if(!C(n))throw new TypeError;return E(r)||(r=T(r)),_(t,e,n,r)})),t("hasMetadata",(function(t,e,n){if(!C(e))throw new TypeError;return E(n)||(n=T(n)),g(t,e,n)})),t("hasOwnMetadata",(function(t,e,n){if(!C(e))throw new TypeError;return E(n)||(n=T(n)),v(t,e,n)})),t("getMetadata",(function(t,e,n){if(!C(e))throw new TypeError;return E(n)||(n=T(n)),m(t,e,n)})),t("getOwnMetadata",(function(t,e,n){if(!C(e))throw new TypeError;return E(n)||(n=T(n)),y(t,e,n)})),t("getMetadataKeys",(function(t,e){if(!C(t))throw new TypeError;return E(e)||(e=T(e)),b(t,e)})),t("getOwnMetadataKeys",(function(t,e){if(!C(t))throw new TypeError;return E(e)||(e=T(e)),x(t,e)})),t("deleteMetadata",(function(t,e,n){if(!C(e))throw new TypeError;E(n)||(n=T(n));var r=d(e,n,!1);if(E(r))return!1;if(!r.delete(t))return!1;if(r.size>0)return!0;var i=p.get(e);return i.delete(n),i.size>0||p.delete(e),!0}))}(i)}()}(r||(r={}))},5666:t=>{var e=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,o=Object.create(i.prototype),a=new k(r||[]);return o._invoke=function(t,e,n){var r=h;return function(i,o){if(r===p)throw new Error("Generator is already running");if(r===d){if("throw"===i)throw o;return P()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=C(a,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var u=c(t,e,n);if("normal"===u.type){if(r=n.done?d:f,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=d,n.method="throw",n.arg=u.arg)}}}(t,n,a),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var h="suspendedStart",f="suspendedYield",p="executing",d="completed",g={};function v(){}function m(){}function y(){}var _={};u(_,o,(function(){return this}));var b=Object.getPrototypeOf,x=b&&b(b(M([])));x&&x!==n&&r.call(x,o)&&(_=x);var w=y.prototype=v.prototype=Object.create(_);function E(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function n(i,o,a,s){var u=c(t[i],t,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==typeof h&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function C(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method))return g;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var i=c(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function M(t){if(t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}return{next:P}}function P(){return{value:e,done:!0}}return m.prototype=y,u(w,"constructor",y),u(y,"constructor",m),m.displayName=u(y,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,s,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},E(S.prototype),u(S.prototype,a,(function(){return this})),t.AsyncIterator=S,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new S(l(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(w),u(w,s,"Generator"),u(w,o,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=M,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:M(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}},1550:function(t){t.exports=function(){"use strict";var t=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},e=function(t,e){for(var n=Object.keys(e),r=0;r<n.length;++r)t[n[r]]=e[n[r]];return t},n="\n";function r(t){var e=new Error("(regl) "+t);throw console.error(e),e}function i(t,e){t||r(e)}function o(t){return t?": "+t:""}function a(t,e){switch(e){case"number":return"number"==typeof t;case"object":return"object"==typeof t;case"string":return"string"==typeof t;case"boolean":return"boolean"==typeof t;case"function":return"function"==typeof t;case"undefined":return void 0===t;case"symbol":return"symbol"==typeof t}}function s(t,e,n){e.indexOf(t)<0&&r("invalid value"+o(n)+". must be one of: "+e)}var u=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function l(t,e){for(t+="";t.length<e;)t=" "+t;return t}function c(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function h(t,e){this.number=t,this.line=e,this.errors=[]}function f(t,e,n){this.file=t,this.line=e,this.message=n}function p(){var t=new Error,e=(t.stack||t).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(e);return r?r[1]:"unknown"}function d(){var t=new Error,e=(t.stack||t).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(e);return r?r[1]:"unknown"}function g(t,e){var n,r=t.split("\n"),i=1,o=0,a={unknown:new c,0:new c};a.unknown.name=a[0].name=e||p(),a.unknown.lines.push(new h(0,""));for(var s=0;s<r.length;++s){var u=r[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var f=/(\d+)(\s+\d+)?/.exec(l[2]);f&&(i=0|f[1],f[2]&&((o=0|f[2])in a||(a[o]=new c)));break;case"define":var d=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);d&&(a[o].name=d[1]?(n=d[2],"undefined"!=typeof atob?atob(n):"base64:"+n):d[2])}a[o].lines.push(new h(i++,u))}return Object.keys(a).forEach((function(t){var e=a[t];e.lines.forEach((function(t){e.index[t.number]=t}))})),a}function v(t){t._commandRef=p()}function m(t,e){var n=d();r(t+" in command "+(e||p())+("unknown"===n?"":" called from "+n))}function y(t,e,n,r){a(t,e)||m("invalid parameter type"+o(n)+". expected "+e+", got "+typeof t,r||p())}var _=33071,b={};function x(t,e){return 32820===t||32819===t||33635===t?2:34042===t?4:b[t]*e}function w(t){return!(t&t-1||!t)}b[5120]=b[5121]=1,b[5122]=b[5123]=b[36193]=b[33635]=b[32819]=b[32820]=2,b[5124]=b[5125]=b[5126]=b[34042]=4;var E=e(i,{optional:function(t){t()},raise:r,commandRaise:m,command:function(t,e,n){t||m(e,n||p())},parameter:function(t,e,n){t in e||r("unknown parameter ("+t+")"+o(n)+". possible values: "+Object.keys(e).join())},commandParameter:function(t,e,n,r){t in e||m("unknown parameter ("+t+")"+o(n)+". possible values: "+Object.keys(e).join(),r||p())},constructor:function(t){Object.keys(t).forEach((function(t){u.indexOf(t)<0&&r('invalid regl constructor argument "'+t+'". must be one of '+u)}))},type:function(t,e,n){a(t,e)||r("invalid parameter type"+o(n)+". expected "+e+", got "+typeof t)},commandType:y,isTypedArray:function(e,n){t(e)||r("invalid parameter type"+o(n)+". must be a typed array")},nni:function(t,e){t>=0&&(0|t)===t||r("invalid parameter type, ("+t+")"+o(e)+". must be a nonnegative integer")},oneOf:s,shaderError:function(t,e,r,o,a){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var s=t.getShaderInfoLog(e),u=o===t.FRAGMENT_SHADER?"fragment":"vertex";y(r,"string",u+" shader source must be a string",a);var c=g(r,a),h=function(t){var e=[];return t.split("\n").forEach((function(t){if(!(t.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);n?e.push(new f(0|n[1],0|n[2],n[3].trim())):t.length>0&&e.push(new f("unknown",0,t))}})),e}(s);(function(t,e){e.forEach((function(e){var n=t[e.file];if(n){var r=n.index[e.line];if(r)return r.errors.push(e),void(n.hasErrors=!0)}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(e)}))})(c,h),Object.keys(c).forEach((function(t){var e=c[t];if(e.hasErrors){var r=[""],i=[""];o("file number "+t+": "+e.name+"\n","color:red;text-decoration:underline;font-weight:bold"),e.lines.forEach((function(t){if(t.errors.length>0){o(l(t.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(t.line+n,"color:red; background-color:yellow; font-weight:bold");var e=0;t.errors.forEach((function(r){var i=r.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];i=a[2],"assign"===s&&(s="="),e=Math.max(t.line.indexOf(s,e),0)}else e=0;o(l("| ",6)),o(l("^^^",e+3)+n,"font-weight:bold"),o(l("| ",6)),o(i+n,"font-weight:bold")})),o(l("| ",6)+n)}else o(l(t.number,4)+"|  "),o(t.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function o(t,e){r.push(t),i.push(e||"")}})),i.raise("Error compiling "+u+" shader, "+c[0].name)}},linkError:function(t,e,r,o,a){if(!t.getProgramParameter(e,t.LINK_STATUS)){var s=t.getProgramInfoLog(e),u=g(r,a),l='Error linking program with vertex shader, "'+g(o,a)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+l+"\n%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(l+n+s),i.raise(l)}},callSite:d,saveCommandRef:v,saveDrawInfo:function(t,e,n,r){function i(t){return t?r.id(t):0}function o(t,e){Object.keys(e).forEach((function(e){t[r.id(e)]=!0}))}v(t),t._fragId=i(t.static.frag),t._vertId=i(t.static.vert);var a=t._uniformSet={};o(a,e.static),o(a,e.dynamic);var s=t._attributeSet={};o(s,n.static),o(s,n.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic},framebufferFormat:function(t,e,n){t.texture?s(t.texture._texture.internalformat,e,"unsupported texture format for attachment"):s(t.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:p,texture2D:function(t,e,n){var r,o=e.width,a=e.height,s=e.channels;i(o>0&&o<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),t.wrapS===_&&t.wrapT===_||i(w(o)&&w(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===e.mipmask?1!==o&&1!==a&&i(9984!==t.minFilter&&9986!==t.minFilter&&9985!==t.minFilter&&9987!==t.minFilter,"min filter requires mipmap"):(i(w(o)&&w(a),"texture must be a square power of 2 to support mipmapping"),i(e.mipmask===(o<<1)-1,"missing or incomplete mipmap data")),5126===e.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&i(9728===t.minFilter&&9728===t.magFilter,"filter not supported, must enable oes_texture_float_linear"),i(!t.genMipmaps,"mipmap generation not supported with float textures"));var u=e.images;for(r=0;r<16;++r)if(u[r]){var l=o>>r,c=a>>r;i(e.mipmask&1<<r,"missing mipmap data");var h=u[r];if(i(h.width===l&&h.height===c,"invalid shape for mip images"),i(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed);else if(h.data){var f=Math.ceil(x(h.type,s)*l/h.unpackAlignment)*h.unpackAlignment;i(h.data.byteLength===f*c,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else t.genMipmaps||i(0==(e.mipmask&1<<r),"extra mipmap data");e.compressed&&i(!t.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(t,e,n,r){var o=t.width,a=t.height,s=t.channels;i(o>0&&o<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),i(o===a,"cube map must be square"),i(e.wrapS===_&&e.wrapT===_,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];i(l.width===o&&l.height===a,"inconsistent cube map face shape"),e.genMipmaps&&(i(!l.compressed,"can not generate mipmap for compressed textures"),i(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,h=0;h<16;++h){var f=c[h];if(f){var p=o>>h,d=a>>h;i(l.mipmask&1<<h,"missing mipmap data"),i(f.width===p&&f.height===d,"invalid shape for mip images"),i(f.format===t.format&&f.internalformat===t.internalformat&&f.type===t.type,"incompatible type for mip image"),f.compressed||(f.data?i(f.data.byteLength===p*d*Math.max(x(f.type,s),f.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):f.element||f.copy)}}}}}),S=0;function C(t,e){this.id=S++,this.type=t,this.data=e}function A(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function T(t){if(0===t.length)return[];var e=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&e===n&&('"'===e||"'"===e))return['"'+A(t.substr(1,t.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(r)return T(t.substr(0,r.index)).concat(T(r[1])).concat(T(t.substr(r.index+r[0].length)));var i=t.split(".");if(1===i.length)return['"'+A(t)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(T(i[a]));return o}function k(t){return"["+T(t).join("][")+"]"}var M={DynamicVariable:C,define:function(t,e){return new C(t,k(e+""))},isDynamic:function(t){return"function"==typeof t&&!t._reglType||t instanceof C},unbox:function t(e,n){return"function"==typeof e?new C(0,e):"number"==typeof e||"boolean"==typeof e?new C(5,e):Array.isArray(e)?new C(6,e.map(((e,r)=>t(e,n+"["+r+"]")))):e instanceof C?e:void E(!1,"invalid option type in uniform "+n)},accessor:k},P={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},I="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function O(t){return"string"==typeof t?t.split():(E(Array.isArray(t),"invalid extension array"),t)}function R(t){return"string"==typeof t?(E("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(t)):t}function L(t){var n,r,i,o,a,s=t||{},u={},l=[],c=[],h="undefined"==typeof window?1:window.devicePixelRatio,f=!1,p=function(t){t&&E.raise(t)},d=function(){};if("string"==typeof s?(E("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(s),E(n,"invalid query string for element")):"object"==typeof s?"string"==typeof(a=s).nodeName&&"function"==typeof a.appendChild&&"function"==typeof a.getBoundingClientRect?n=s:function(t){return"function"==typeof t.drawArrays||"function"==typeof t.drawElements}(s)?i=(o=s).canvas:(E.constructor(s),"gl"in s?o=s.gl:"canvas"in s?i=R(s.canvas):"container"in s&&(r=R(s.container)),"attributes"in s&&(u=s.attributes,E.type(u,"object","invalid context attributes")),"extensions"in s&&(l=O(s.extensions)),"optionalExtensions"in s&&(c=O(s.optionalExtensions)),"onDone"in s&&(E.type(s.onDone,"function","invalid or missing onDone callback"),p=s.onDone),"profile"in s&&(f=!!s.profile),"pixelRatio"in s&&(h=+s.pixelRatio,E(h>0,"invalid pixel ratio"))):E.raise("invalid arguments to regl"),n&&("canvas"===n.nodeName.toLowerCase()?i=n:r=n),!o){if(!i){E("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var g=function(t,n,r){var i,o=document.createElement("canvas");function a(){var n=window.innerWidth,i=window.innerHeight;if(t!==document.body){var a=t.getBoundingClientRect();n=a.right-a.left,i=a.bottom-a.top}o.width=r*n,o.height=r*i,e(o.style,{width:n+"px",height:i+"px"})}return e(o.style,{border:0,margin:0,padding:0,top:0,left:0}),t.appendChild(o),t===document.body&&(o.style.position="absolute",e(t.style,{margin:0,padding:0})),t!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(t):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),t.removeChild(o)}}}(r||document.body,0,h);if(!g)return null;i=g.canvas,d=g.onDestroy}void 0===u.premultipliedAlpha&&(u.premultipliedAlpha=!0),o=function(t,e){function n(n){try{return t.getContext(n,e)}catch(t){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,u)}return o?{gl:o,canvas:i,container:r,extensions:l,optionalExtensions:c,pixelRatio:h,profile:f,onDone:p,onDestroy:d}:(d(),p("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function D(t,e){for(var n=Array(t),r=0;r<t;++r)n[r]=e(r);return n}function N(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function B(){var t=D(8,(function(){return[]}));function e(e){var n=function(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}(e),r=t[N(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(e){t[N(e.byteLength)>>2].push(e)}return{alloc:e,free:n,allocType:function(t,n){var r=null;switch(t){case 5120:r=new Int8Array(e(n),0,n);break;case 5121:r=new Uint8Array(e(n),0,n);break;case 5122:r=new Int16Array(e(2*n),0,n);break;case 5123:r=new Uint16Array(e(2*n),0,n);break;case 5124:r=new Int32Array(e(4*n),0,n);break;case 5125:r=new Uint32Array(e(4*n),0,n);break;case 5126:r=new Float32Array(e(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(t){n(t.buffer)}}}var z=B();z.zero=B();var F=3553,Z=6408,j=5126,U=36160;function G(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||t(e.data))}var V=function(t){return Object.keys(t).map((function(e){return t[e]}))},W={shape:function(t){for(var e=[],n=t;n.length;n=n[0])e.push(n.length);return e},flatten:function(t,e,n,r){var i=1;if(e.length)for(var o=0;o<e.length;++o)i*=e[o];else i=0;var a=r||z.allocType(n,i);switch(e.length){case 0:break;case 1:!function(t,e,n){for(var r=0;r<e;++r)n[r]=t[r]}(t,e[0],a);break;case 2:!function(t,e,n,r){for(var i=0,o=0;o<e;++o)for(var a=t[o],s=0;s<n;++s)r[i++]=a[s]}(t,e[0],e[1],a);break;case 3:H(t,e[0],e[1],e[2],a,0);break;default:X(t,e,0,a,0)}return a}};function H(t,e,n,r,i,o){for(var a=o,s=0;s<e;++s)for(var u=t[s],l=0;l<n;++l)for(var c=u[l],h=0;h<r;++h)i[a++]=c[h]}function X(t,e,n,r,i){for(var o=1,a=n+1;a<e.length;++a)o*=e[a];var s=e[n];if(e.length-n==4){var u=e[n+1],l=e[n+2],c=e[n+3];for(a=0;a<s;++a)H(t[a],u,l,c,r,i),i+=o}else for(a=0;a<s;++a)X(t[a],e,n+1,r,i),i+=o}var Y={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},q={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},K={dynamic:35048,stream:35040,static:35044},Q=W.flatten,J=W.shape,$=5121,tt=5126,et=[];function nt(t){return 0|Y[Object.prototype.toString.call(t)]}function rt(t,e){for(var n=0;n<e.length;++n)t[n]=e[n]}function it(t,e,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)t[s++]=e[i*u+o*l+a]}et[5120]=1,et[5122]=2,et[5124]=4,et[5121]=1,et[5123]=2,et[5125]=4,et[5126]=4;var ot={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},at=5121,st=5123,ut=5125,lt=34963;var ct=new Float32Array(1),ht=new Uint32Array(ct.buffer);function ft(t){for(var e=z.allocType(5123,t.length),n=0;n<t.length;++n)if(isNaN(t[n]))e[n]=65535;else if(t[n]===1/0)e[n]=31744;else if(t[n]===-1/0)e[n]=64512;else{ct[0]=t[n];var r=ht[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)e[n]=i;else if(o<-14){var s=-14-o;e[n]=i+(a+1024>>s)}else e[n]=o>15?i+31744:i+(o+15<<10)+a}return e}function pt(e){return Array.isArray(e)||t(e)}var dt=function(t){return!(t&t-1||!t)},gt=3553,vt=34067,mt=34069,yt=6408,_t=6406,bt=6407,xt=6409,wt=6410,Et=32855,St=6402,Ct=34041,At=35904,Tt=35906,kt=36193,Mt=33776,Pt=33777,It=33778,Ot=33779,Rt=5121,Lt=5123,Dt=5125,Nt=5126,Bt=33071,zt=9728,Ft=9984,Zt=9987,jt=4352,Ut=33984,Gt=[Ft,9986,9985,Zt],Vt=[0,xt,wt,bt,yt],Wt={};function Ht(t){return"[object "+t+"]"}Wt[6409]=Wt[6406]=Wt[6402]=1,Wt[34041]=Wt[6410]=2,Wt[6407]=Wt[35904]=3,Wt[6408]=Wt[35906]=4;var Xt=Ht("HTMLCanvasElement"),Yt=Ht("OffscreenCanvas"),qt=Ht("CanvasRenderingContext2D"),Kt=Ht("ImageBitmap"),Qt=Ht("HTMLImageElement"),Jt=Ht("HTMLVideoElement"),$t=Object.keys(Y).concat([Xt,Yt,qt,Kt,Qt,Jt]),te=[];te[5121]=1,te[5126]=4,te[36193]=2,te[5123]=2,te[5125]=4;var ee=[];function ne(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function re(t){return!!Array.isArray(t)&&!(0===t.length||!pt(t[0]))}function ie(t){return Object.prototype.toString.call(t)}function oe(t){return ie(t)===Xt}function ae(t){return ie(t)===Yt}function se(t){if(!t)return!1;var e=ie(t);return $t.indexOf(e)>=0||ne(t)||re(t)||G(t)}function ue(t){return 0|Y[Object.prototype.toString.call(t)]}function le(t,e){return z.allocType(t.type===kt?Nt:t.type,e)}function ce(t,e){t.type===kt?(t.data=ft(e),z.freeType(e)):t.data=e}function he(t,e,n,r,i,o){var a;if(a=void 0!==ee[t]?ee[t]:Wt[t]*te[e],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function fe(n,r,i,o,a,s,u){var l={"don't care":jt,"dont care":jt,nice:4354,fast:4353},c={repeat:10497,clamp:Bt,mirror:33648},h={nearest:zt,linear:9729},f=e({mipmap:Zt,"nearest mipmap nearest":Ft,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":Zt},h),p={none:0,browser:37444},d={uint8:Rt,rgba4:32819,rgb565:33635,"rgb5 a1":32820},g={alpha:_t,luminance:xt,"luminance alpha":wt,rgb:bt,rgba:yt,rgba4:32854,"rgb5 a1":Et,rgb565:36194},v={};r.ext_srgb&&(g.srgb=At,g.srgba=Tt),r.oes_texture_float&&(d.float32=d.float=Nt),r.oes_texture_half_float&&(d.float16=d["half float"]=kt),r.webgl_depth_texture&&(e(g,{depth:St,"depth stencil":Ct}),e(d,{uint16:Lt,uint32:Dt,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&e(v,{"rgb s3tc dxt1":Mt,"rgba s3tc dxt1":Pt,"rgba s3tc dxt3":It,"rgba s3tc dxt5":Ot}),r.webgl_compressed_texture_atc&&e(v,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&e(v,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(v["rgb etc1"]=36196);var m=Array.prototype.slice.call(n.getParameter(34467));Object.keys(v).forEach((function(t){var e=v[t];m.indexOf(e)>=0&&(g[t]=e)}));var y=Object.keys(g);i.textureFormats=y;var _=[];Object.keys(g).forEach((function(t){var e=g[t];_[e]=t}));var b=[];Object.keys(d).forEach((function(t){var e=d[t];b[e]=t}));var x=[];Object.keys(h).forEach((function(t){x[h[t]]=t}));var w=[];Object.keys(f).forEach((function(t){var e=f[t];w[e]=t}));var S=[];Object.keys(c).forEach((function(t){S[c[t]]=t}));var C=y.reduce((function(t,e){var n=g[e];return n===xt||n===_t||n===xt||n===wt||n===St||n===Ct||r.ext_srgb&&(n===At||n===Tt)?t[n]=n:n===Et||e.indexOf("rgba")>=0?t[n]=yt:t[n]=bt,t}),{});function A(){this.internalformat=yt,this.format=yt,this.type=Rt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function T(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function k(t,e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(E.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(E.type(e.flipY,"boolean","invalid texture flip"),t.flipY=e.flipY),"alignment"in e&&(E.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),t.unpackAlignment=e.alignment),"colorSpace"in e&&(E.parameter(e.colorSpace,p,"invalid colorSpace"),t.colorSpace=p[e.colorSpace]),"type"in e){var n=e.type;E(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),E(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),E(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),E.parameter(n,d,"invalid texture type"),t.type=d[n]}var o=t.width,a=t.height,s=t.channels,u=!1;"shape"in e?(E(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),o=e.shape[0],a=e.shape[1],3===e.shape.length&&(s=e.shape[2],E(s>0&&s<=4,"invalid number of channels"),u=!0),E(o>=0&&o<=i.maxTextureSize,"invalid width"),E(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in e&&(o=a=e.radius,E(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in e&&(o=e.width,E(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in e&&(a=e.height,E(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in e&&(s=e.channels,E(s>0&&s<=4,"invalid number of channels"),u=!0)),t.width=0|o,t.height=0|a,t.channels=0|s;var l=!1;if("format"in e){var c=e.format;E(r.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),E.parameter(c,g,"invalid texture format");var h=t.internalformat=g[c];t.format=C[h],c in d&&("type"in e||(t.type=d[c])),c in v&&(t.compressed=!0),l=!0}!u&&l?t.channels=Wt[t.format]:u&&!l?t.channels!==Vt[t.format]&&(t.format=t.internalformat=Vt[t.channels]):l&&u&&E(t.channels===Wt[t.format],"number of channels inconsistent with specified format")}}function M(t){n.pixelStorei(37440,t.flipY),n.pixelStorei(37441,t.premultiplyAlpha),n.pixelStorei(37443,t.colorSpace),n.pixelStorei(3317,t.unpackAlignment)}function P(){A.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function I(e,n){var r=null;if(se(n)?r=n:n&&(E.type(n,"object","invalid pixel data type"),k(e,n),"x"in n&&(e.xOffset=0|n.x),"y"in n&&(e.yOffset=0|n.y),se(n.data)&&(r=n.data)),E(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){E(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;e.width=e.width||o-e.xOffset,e.height=e.height||s-e.yOffset,e.needsCopy=!0,E(e.xOffset>=0&&e.xOffset<o&&e.yOffset>=0&&e.yOffset<s&&e.width>0&&e.width<=o&&e.height>0&&e.height<=s,"copy texture read out of bounds")}else if(r){if(t(r))e.channels=e.channels||4,e.data=r,"type"in n||e.type!==Rt||(e.type=ue(r));else if(ne(r))e.channels=e.channels||4,function(t,e){var n=e.length;switch(t.type){case Rt:case Lt:case Dt:case Nt:var r=z.allocType(t.type,n);r.set(e),t.data=r;break;case kt:t.data=ft(e);break;default:E.raise("unsupported texture type, must specify a typed array")}}(e,r),e.alignment=1,e.needsFree=!0;else if(G(r)){var u=r.data;Array.isArray(u)||e.type!==Rt||(e.type=ue(u));var l,c,h,f,p,d,g=r.shape,v=r.stride;3===g.length?(h=g[2],d=v[2]):(E(2===g.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,d=1),l=g[0],c=g[1],f=v[0],p=v[1],e.alignment=1,e.width=l,e.height=c,e.channels=h,e.format=e.internalformat=Vt[h],e.needsFree=!0,function(t,e,n,r,i,o){for(var a=t.width,s=t.height,u=t.channels,l=le(t,a*s*u),c=0,h=0;h<s;++h)for(var f=0;f<a;++f)for(var p=0;p<u;++p)l[c++]=e[n*f+r*h+i*p+o];ce(t,l)}(e,u,f,p,d,r.offset)}else if(oe(r)||ae(r)||ie(r)===qt)oe(r)||ae(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(function(t){return ie(t)===Kt}(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(function(t){return ie(t)===Qt}(r))e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(function(t){return ie(t)===Jt}(r))e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(re(r)){var m=e.width||r[0].length,y=e.height||r.length,_=e.channels;_=pt(r[0][0])?_||r[0][0].length:_||1;for(var b=W.shape(r),x=1,w=0;w<b.length;++w)x*=b[w];var S=le(e,x);W.flatten(r,b,"",S),ce(e,S),e.alignment=1,e.width=m,e.height=y,e.channels=_,e.format=e.internalformat=Vt[_],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;e.type===Nt?E(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):e.type===kt&&E(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function O(t,e,r){var i=t.element,a=t.data,s=t.internalformat,u=t.format,l=t.type,c=t.width,h=t.height;M(t),i?n.texImage2D(e,r,u,u,l,i):t.compressed?n.compressedTexImage2D(e,r,s,c,h,0,a):t.needsCopy?(o(),n.copyTexImage2D(e,r,u,t.xOffset,t.yOffset,c,h,0)):n.texImage2D(e,r,u,c,h,0,u,l,a||null)}function R(t,e,r,i,a){var s=t.element,u=t.data,l=t.internalformat,c=t.format,h=t.type,f=t.width,p=t.height;M(t),s?n.texSubImage2D(e,a,r,i,c,h,s):t.compressed?n.compressedTexSubImage2D(e,a,r,i,l,f,p,u):t.needsCopy?(o(),n.copyTexSubImage2D(e,a,r,i,t.xOffset,t.yOffset,f,p)):n.texSubImage2D(e,a,r,i,f,p,c,h,u)}var L=[];function D(){return L.pop()||new P}function N(t){t.needsFree&&z.freeType(t.data),P.call(t),L.push(t)}function B(){A.call(this),this.genMipmaps=!1,this.mipmapHint=jt,this.mipmask=0,this.images=Array(16)}function F(t,e,n){var r=t.images[0]=D();t.mipmask=1,r.width=t.width=e,r.height=t.height=n,r.channels=t.channels=4}function Z(t,e){var n=null;if(se(e))T(n=t.images[0]=D(),t),I(n,e),t.mipmask=1;else if(k(t,e),Array.isArray(e.mipmap))for(var r=e.mipmap,i=0;i<r.length;++i)T(n=t.images[i]=D(),t),n.width>>=i,n.height>>=i,I(n,r[i]),t.mipmask|=1<<i;else T(n=t.images[0]=D(),t),I(n,e),t.mipmask=1;T(t,t.images[0]),!t.compressed||t.internalformat!==Mt&&t.internalformat!==Pt&&t.internalformat!==It&&t.internalformat!==Ot||E(t.width%4==0&&t.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function j(t,e){for(var n=t.images,r=0;r<n.length;++r){if(!n[r])return;O(n[r],e,r)}}var U=[];function H(){var t=U.pop()||new B;A.call(t),t.mipmask=0;for(var e=0;e<16;++e)t.images[e]=null;return t}function X(t){for(var e=t.images,n=0;n<e.length;++n)e[n]&&N(e[n]),e[n]=null;U.push(t)}function Y(){this.minFilter=zt,this.magFilter=zt,this.wrapS=Bt,this.wrapT=Bt,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=jt}function q(t,e){if("min"in e){var n=e.min;E.parameter(n,f),t.minFilter=f[n],Gt.indexOf(t.minFilter)>=0&&!("faces"in e)&&(t.genMipmaps=!0)}if("mag"in e){var r=e.mag;E.parameter(r,h),t.magFilter=h[r]}var o=t.wrapS,a=t.wrapT;if("wrap"in e){var s=e.wrap;"string"==typeof s?(E.parameter(s,c),o=a=c[s]):Array.isArray(s)&&(E.parameter(s[0],c),E.parameter(s[1],c),o=c[s[0]],a=c[s[1]])}else{if("wrapS"in e){var u=e.wrapS;E.parameter(u,c),o=c[u]}if("wrapT"in e){var p=e.wrapT;E.parameter(p,c),a=c[p]}}if(t.wrapS=o,t.wrapT=a,"anisotropic"in e){var d=e.anisotropic;E("number"==typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),t.anisotropic=e.anisotropic}if("mipmap"in e){var g=!1;switch(typeof e.mipmap){case"string":E.parameter(e.mipmap,l,"invalid mipmap hint"),t.mipmapHint=l[e.mipmap],t.genMipmaps=!0,g=!0;break;case"boolean":g=t.genMipmaps=e.mipmap;break;case"object":E(Array.isArray(e.mipmap),"invalid mipmap type"),t.genMipmaps=!1,g=!0;break;default:E.raise("invalid mipmap type")}g&&!("min"in e)&&(t.minFilter=Ft)}}function K(t,e){n.texParameteri(e,10241,t.minFilter),n.texParameteri(e,10240,t.magFilter),n.texParameteri(e,10242,t.wrapS),n.texParameteri(e,10243,t.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(e,34046,t.anisotropic),t.genMipmaps&&(n.hint(33170,t.mipmapHint),n.generateMipmap(e))}var Q=0,J={},$=i.maxTextureUnits,tt=Array($).map((function(){return null}));function et(t){A.call(this),this.mipmask=0,this.internalformat=yt,this.id=Q++,this.refCount=1,this.target=t,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Y,u.profile&&(this.stats={size:0})}function nt(t){n.activeTexture(Ut),n.bindTexture(t.target,t.texture)}function rt(){var t=tt[0];t?n.bindTexture(t.target,t.texture):n.bindTexture(gt,null)}function it(t){var e=t.texture;E(e,"must not double destroy texture");var r=t.unit,i=t.target;r>=0&&(n.activeTexture(Ut+r),n.bindTexture(i,null),tt[r]=null),n.deleteTexture(e),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete J[t.id],s.textureCount--}return e(et.prototype,{bind:function(){var t=this;t.bindCount+=1;var e=t.unit;if(e<0){for(var r=0;r<$;++r){var i=tt[r];if(i){if(i.bindCount>0)continue;i.unit=-1}tt[r]=t,e=r;break}e>=$&&E.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<e+1&&(s.maxTextureUnits=e+1),t.unit=e,n.activeTexture(Ut+e),n.bindTexture(t.target,t.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&it(this)}}),u.profile&&(s.getTotalTextureSize=function(){var t=0;return Object.keys(J).forEach((function(e){t+=J[e].stats.size})),t}),{create2D:function(t,e){var r=new et(gt);function o(t,e){var n=r.texInfo;Y.call(n);var a=H();return"number"==typeof t?F(a,0|t,"number"==typeof e?0|e:0|t):t?(E.type(t,"object","invalid arguments to regl.texture"),q(n,t),Z(a,t)):F(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,T(r,a),E.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,nt(r),j(a,gt),K(n,gt),rt(),X(a),u.profile&&(r.stats.size=he(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=_[r.internalformat],o.type=b[r.type],o.mag=x[n.magFilter],o.min=w[n.minFilter],o.wrapS=S[n.wrapS],o.wrapT=S[n.wrapT],o}return J[r.id]=r,s.textureCount++,o(t,e),o.subimage=function(t,e,n,i){E(!!t,"must specify image data");var a=0|e,s=0|n,u=0|i,l=D();return T(l,r),l.width=0,l.height=0,I(l,t),l.width=l.width||(r.width>>u)-a,l.height=l.height||(r.height>>u)-s,E(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),E(a>=0&&s>=0&&a+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),E(r.mipmask&1<<u,"missing mipmap data"),E(l.data||l.element||l.needsCopy,"missing image data"),nt(r),R(l,gt,a,s,u),rt(),N(l),o},o.resize=function(t,e){var i=0|t,a=0|e||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,nt(r);for(var s=0;r.mipmask>>s;++s){var l=i>>s,c=a>>s;if(!l||!c)break;n.texImage2D(gt,s,r.format,l,c,0,r.format,r.type,null)}return rt(),u.profile&&(r.stats.size=he(r.internalformat,r.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(t,e,r,o,a,l){var c=new et(vt);J[c.id]=c,s.cubeCount++;var h=new Array(6);function f(t,e,n,r,o,a){var s,l=c.texInfo;for(Y.call(l),s=0;s<6;++s)h[s]=H();if("number"!=typeof t&&t)if("object"==typeof t)if(e)Z(h[0],t),Z(h[1],e),Z(h[2],n),Z(h[3],r),Z(h[4],o),Z(h[5],a);else if(q(l,t),k(c,t),"faces"in t){var p=t.faces;for(E(Array.isArray(p)&&6===p.length,"cube faces must be a length 6 array"),s=0;s<6;++s)E("object"==typeof p[s]&&!!p[s],"invalid input for cube map face"),T(h[s],c),Z(h[s],p[s])}else for(s=0;s<6;++s)Z(h[s],t);else E.raise("invalid arguments to cube map");else{var d=0|t||1;for(s=0;s<6;++s)F(h[s],d,d)}for(T(c,h[0]),i.npotTextureCube||E(dt(c.width)&&dt(c.height),"your browser does not support non power or two texture dimensions"),l.genMipmaps?c.mipmask=(h[0].width<<1)-1:c.mipmask=h[0].mipmask,E.textureCube(c,l,h,i),c.internalformat=h[0].internalformat,f.width=h[0].width,f.height=h[0].height,nt(c),s=0;s<6;++s)j(h[s],mt+s);for(K(l,vt),rt(),u.profile&&(c.stats.size=he(c.internalformat,c.type,f.width,f.height,l.genMipmaps,!0)),f.format=_[c.internalformat],f.type=b[c.type],f.mag=x[l.magFilter],f.min=w[l.minFilter],f.wrapS=S[l.wrapS],f.wrapT=S[l.wrapT],s=0;s<6;++s)X(h[s]);return f}return f(t,e,r,o,a,l),f.subimage=function(t,e,n,r,i){E(!!e,"must specify image data"),E("number"==typeof t&&t===(0|t)&&t>=0&&t<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=D();return T(u,c),u.width=0,u.height=0,I(u,e),u.width=u.width||(c.width>>s)-o,u.height=u.height||(c.height>>s)-a,E(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),E(o>=0&&a>=0&&o+u.width<=c.width&&a+u.height<=c.height,"texture.subimage write out of bounds"),E(c.mipmask&1<<s,"missing mipmap data"),E(u.data||u.element||u.needsCopy,"missing image data"),nt(c),R(u,mt+t,o,a,s),rt(),N(u),f},f.resize=function(t){var e=0|t;if(e!==c.width){f.width=c.width=e,f.height=c.height=e,nt(c);for(var r=0;r<6;++r)for(var i=0;c.mipmask>>i;++i)n.texImage2D(mt+r,i,c.format,e>>i,e>>i,0,c.format,c.type,null);return rt(),u.profile&&(c.stats.size=he(c.internalformat,c.type,f.width,f.height,!1,!0)),f}},f._reglType="textureCube",f._texture=c,u.profile&&(f.stats=c.stats),f.destroy=function(){c.decRef()},f},clear:function(){for(var t=0;t<$;++t)n.activeTexture(Ut+t),n.bindTexture(gt,null),tt[t]=null;V(J).forEach(it),s.cubeCount=0,s.textureCount=0},getTexture:function(t){return null},restore:function(){for(var t=0;t<$;++t){var e=tt[t];e&&(e.bindCount=0,e.unit=-1,tt[t]=null)}V(J).forEach((function(t){t.texture=n.createTexture(),n.bindTexture(t.target,t.texture);for(var e=0;e<32;++e)if(0!=(t.mipmask&1<<e))if(t.target===gt)n.texImage2D(gt,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);else for(var r=0;r<6;++r)n.texImage2D(mt+r,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);K(t.texInfo,t.target)}))},refresh:function(){for(var t=0;t<$;++t){var e=tt[t];e&&(e.bindCount=0,e.unit=-1,tt[t]=null),n.activeTexture(Ut+t),n.bindTexture(gt,null),n.bindTexture(vt,null)}}}}ee[32854]=2,ee[32855]=2,ee[36194]=2,ee[34041]=4,ee[33776]=.5,ee[33777]=.5,ee[33778]=1,ee[33779]=1,ee[35986]=.5,ee[35987]=1,ee[34798]=1,ee[35840]=.5,ee[35841]=.25,ee[35842]=.5,ee[35843]=.25,ee[36196]=.5;var pe=36161,de=32854,ge=[];function ve(t,e,n){return ge[t]*e*n}ge[32854]=2,ge[32855]=2,ge[36194]=2,ge[33189]=2,ge[36168]=1,ge[34041]=4,ge[35907]=4,ge[34836]=16,ge[34842]=8,ge[34843]=6;var me=36160,ye=36161,_e=3553,be=34069,xe=[6407,6408],we=[];we[6408]=4,we[6407]=3;var Ee=[];Ee[5121]=1,Ee[5126]=4,Ee[36193]=2;var Se=[32854,32855,36194,35907,34842,34843,34836],Ce={};Ce[36053]="complete",Ce[36054]="incomplete attachment",Ce[36057]="incomplete dimensions",Ce[36055]="incomplete, missing attachment",Ce[36061]="unsupported";function Ae(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}var Te=5121,ke=5126;function Me(e,n,r,i,o,a,s){function u(u){var l;null===n.next?(E(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=Te):(E(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(E(l===Te||l===ke,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),l===ke&&E(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):E(l===Te,"Reading from a framebuffer is only allowed for the type 'uint8'"));var c=0,h=0,f=i.framebufferWidth,p=i.framebufferHeight,d=null;t(u)?d=u:u&&(E.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,h=0|u.y,E(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),E(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),f=0|(u.width||i.framebufferWidth-c),p=0|(u.height||i.framebufferHeight-h),d=u.data||null),d&&(l===Te?E(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):l===ke&&E(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),E(f>0&&f+c<=i.framebufferWidth,"invalid width for read pixels"),E(p>0&&p+h<=i.framebufferHeight,"invalid height for read pixels"),r();var g=f*p*4;return d||(l===Te?d=new Uint8Array(g):l===ke&&(d=d||new Float32Array(g))),E.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),E(d.byteLength>=g,"data buffer for regl.read() too small"),e.pixelStorei(3333,4),e.readPixels(c,h,f,p,6408,l,d),d}return function(t){return t&&"framebuffer"in t?function(t){var e;return n.setFBO({framebuffer:t.framebuffer},(function(){e=u(t)})),e}(t):u(t)}}function Pe(t){return Array.prototype.slice.call(t)}function Ie(t){return Pe(t).join("")}var Oe="xyzw".split(""),Re="dither",Le="blend.enable",De="blend.color",Ne="blend.equation",Be="blend.func",ze="depth.enable",Fe="depth.func",Ze="depth.range",je="depth.mask",Ue="colorMask",Ge="cull.enable",Ve="cull.face",We="frontFace",He="lineWidth",Xe="polygonOffset.enable",Ye="polygonOffset.offset",qe="sample.alpha",Ke="sample.enable",Qe="sample.coverage",Je="stencil.enable",$e="stencil.mask",tn="stencil.func",en="stencil.opFront",nn="stencil.opBack",rn="scissor.enable",on="scissor.box",an="viewport",sn="profile",un="framebuffer",ln="vert",cn="frag",hn="elements",fn="primitive",pn="count",dn="offset",gn="instances",vn="vao",mn="Width",yn="Height",_n=un+mn,bn=un+yn,xn="drawingBufferWidth",wn="drawingBufferHeight",En=[Be,Ne,tn,en,nn,Qe,an,on,Ye],Sn=34962,Cn=5126,An=35664,Tn=35665,kn=35666,Mn=5124,Pn=35667,In=35668,On=35669,Rn=35670,Ln=35671,Dn=35672,Nn=35673,Bn=35674,zn=35675,Fn=35676,Zn=35678,jn=35680,Un=1028,Gn=1029,Vn=2305,Wn=7680,Hn={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Xn=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Yn={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},qn={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Kn={frag:35632,vert:35633},Qn={cw:2304,ccw:Vn};function Jn(e){return Array.isArray(e)||t(e)||G(e)}function $n(t){return t.sort((function(t,e){return t===an?-1:e===an?1:t<e?-1:1}))}function tr(t,e,n,r){this.thisDep=t,this.contextDep=e,this.propDep=n,this.append=r}function er(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function nr(t){return new tr(!1,!1,!1,t)}function rr(t,e){var n=t.type;if(0===n){var r=t.data.length;return new tr(!0,r>=1,r>=2,e)}if(4===n){var i=t.data;return new tr(i.thisDep,i.contextDep,i.propDep,e)}if(5===n)return new tr(!1,!1,!1,e);if(6===n){for(var o=!1,a=!1,s=!1,u=0;u<t.data.length;++u){var l=t.data[u];if(1===l.type)s=!0;else if(2===l.type)a=!0;else if(3===l.type)o=!0;else if(0===l.type){o=!0;var c=l.data;c>=1&&(a=!0),c>=2&&(s=!0)}else 4===l.type&&(o=o||l.data.thisDep,a=a||l.data.contextDep,s=s||l.data.propDep)}return new tr(o,a,s,e)}return new tr(3===n,2===n,1===n,e)}var ir=new tr(!1,!1,!1,(function(){}));function or(t,n,r,i,o,a,s,u,l,c,h,f,p,d,g){var v=c.Record,m={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(m.min=32775,m.max=32776);var y=r.angle_instanced_arrays,_=r.webgl_draw_buffers,b={dirty:!0,profile:g.profile},x={},w=[],S={},C={};function A(t){return t.replace(".","_")}function T(t,e,n){var r=A(t);w.push(t),x[r]=b[r]=!!n,S[r]=e}function k(t,e,n){var r=A(t);w.push(t),Array.isArray(n)?(b[r]=n.slice(),x[r]=n.slice()):b[r]=x[r]=n,C[r]=e}T(Re,3024),T(Le,3042),k(De,"blendColor",[0,0,0,0]),k(Ne,"blendEquationSeparate",[32774,32774]),k(Be,"blendFuncSeparate",[1,0,1,0]),T(ze,2929,!0),k(Fe,"depthFunc",513),k(Ze,"depthRange",[0,1]),k(je,"depthMask",!0),k(Ue,Ue,[!0,!0,!0,!0]),T(Ge,2884),k(Ve,"cullFace",Gn),k(We,We,Vn),k(He,He,1),T(Xe,32823),k(Ye,"polygonOffset",[0,0]),T(qe,32926),T(Ke,32928),k(Qe,"sampleCoverage",[1,!1]),T(Je,2960),k($e,"stencilMask",-1),k(tn,"stencilFunc",[519,0,-1]),k(en,"stencilOpSeparate",[Un,Wn,Wn,Wn]),k(nn,"stencilOpSeparate",[Gn,Wn,Wn,Wn]),T(rn,3089),k(on,"scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),k(an,an,[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var P={gl:t,context:p,strings:n,next:x,current:b,draw:f,elements:a,buffer:o,shader:h,attributes:c.state,vao:c,uniforms:l,framebuffer:u,extensions:r,timer:d,isBufferArgs:Jn},I={primTypes:ot,compareFuncs:Yn,blendFuncs:Hn,blendEquations:m,stencilOps:qn,glTypes:q,orientationType:Qn};E.optional((function(){P.isArrayLike=pt})),_&&(I.backBuffer=[Gn],I.drawBuffer=D(i.maxDrawbuffers,(function(t){return 0===t?[0]:D(t,(function(t){return 36064+t}))})));var O=0;function R(){var t=function(){var t=0,n=[],r=[];function i(){var n=[],r=[];return e((function(){n.push.apply(n,Pe(arguments))}),{def:function(){var e="v"+t++;return r.push(e),arguments.length>0&&(n.push(e,"="),n.push.apply(n,Pe(arguments)),n.push(";")),e},toString:function(){return Ie([r.length>0?"var "+r.join(",")+";":"",Ie(n)])}})}function o(){var t=i(),n=i(),r=t.toString,o=n.toString;function a(e,r){n(e,r,"=",t.def(e,r),";")}return e((function(){t.apply(t,Pe(arguments))}),{def:t.def,entry:t,exit:n,save:a,set:function(e,n,r){a(e,n),t(e,n,"=",r,";")},toString:function(){return r()+o()}})}var a=i(),s={};return{global:a,link:function(e){for(var i=0;i<r.length;++i)if(r[i]===e)return n[i];var o="g"+t++;return n.push(o),r.push(e),o},block:i,proc:function(t,n){var r=[];function i(){var t="a"+r.length;return r.push(t),t}n=n||0;for(var a=0;a<n;++a)i();var u=o(),l=u.toString;return s[t]=e(u,{arg:i,toString:function(){return Ie(["function(",r.join(),"){",l(),"}"])}})},scope:o,cond:function(){var t=Ie(arguments),n=o(),r=o(),i=n.toString,a=r.toString;return e(n,{then:function(){return n.apply(n,Pe(arguments)),this},else:function(){return r.apply(r,Pe(arguments)),this},toString:function(){var e=a();return e&&(e="else{"+e+"}"),Ie(["if(",t,"){",i(),"}",e])}})},compile:function(){var t=['"use strict";',a,"return {"];Object.keys(s).forEach((function(e){t.push('"',e,'":',s[e].toString(),",")})),t.push("}");var e=Ie(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(e)).apply(null,r)}}}(),r=t.link,i=t.global;t.id=O++,t.batchId="0";var o=r(P),a=t.shared={props:"a0"};Object.keys(P).forEach((function(t){a[t]=i.def(o,".",t)})),E.optional((function(){t.CHECK=r(E),t.commandStr=E.guessCommand(),t.command=r(t.commandStr),t.assert=function(t,e,n){t("if(!(",e,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},I.invalidBlendCombinations=Xn}));var s=t.next={},u=t.current={};Object.keys(C).forEach((function(t){Array.isArray(b[t])&&(s[t]=i.def(a.next,".",t),u[t]=i.def(a.current,".",t))}));var l=t.constants={};Object.keys(I).forEach((function(t){l[t]=i.def(JSON.stringify(I[t]))})),t.invoke=function(e,n){switch(n.type){case 0:var i=["this",a.context,a.props,t.batchId];return e.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case 1:return e.def(a.props,n.data);case 2:return e.def(a.context,n.data);case 3:return e.def("this",n.data);case 4:return n.data.append(t,e),n.data.ref;case 5:return n.data.toString();case 6:return n.data.map((function(n){return t.invoke(e,n)}))}},t.attribCache={};var h={};return t.scopeAttrib=function(t){var e=n.id(t);if(e in h)return h[e];var i=c.scope[e];return i||(i=c.scope[e]=new v),h[e]=r(i)},t}function L(t,e,s,l,f){var p=t.static,d=t.dynamic;E.optional((function(){var t=[un,ln,cn,hn,fn,dn,pn,gn,sn,vn].concat(w);function e(e){Object.keys(e).forEach((function(e){E.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',f.commandStr)}))}e(p),e(d)}));var g=function(t,e){var n=t.static;if("string"==typeof n[cn]&&"string"==typeof n[ln]){if(Object.keys(e.dynamic).length>0)return null;var r=e.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)E("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(t,e),_=function(t,e){var n=t.static,r=t.dynamic;if(un in n){var i=n[un];return i?(i=u.getFramebuffer(i),E.command(i,"invalid framebuffer object"),nr((function(t,e){var n=t.link(i),r=t.shared;e.set(r.framebuffer,".next",n);var o=r.context;return e.set(o,"."+_n,n+".width"),e.set(o,"."+bn,n+".height"),n}))):nr((function(t,e){var n=t.shared;e.set(n.framebuffer,".next","null");var r=n.context;return e.set(r,"."+_n,r+"."+xn),e.set(r,"."+bn,r+"."+wn),"null"}))}if(un in r){var o=r[un];return rr(o,(function(t,e){var n=t.invoke(e,o),r=t.shared,i=r.framebuffer,a=e.def(i,".getFramebuffer(",n,")");E.optional((function(){t.assert(e,"!"+n+"||"+a,"invalid framebuffer object")})),e.set(i,".next",a);var s=r.context;return e.set(s,"."+_n,a+"?"+a+".width:"+s+"."+xn),e.set(s,"."+bn,a+"?"+a+".height:"+s+"."+wn),a}))}return null}(t),b=function(t,e,n){var r=t.static,i=t.dynamic;function o(t){if(t in r){var o=r[t];E.commandType(o,"object","invalid "+t,n.commandStr);var a,s,u=!0,l=0|o.x,c=0|o.y;return"width"in o?(a=0|o.width,E.command(a>=0,"invalid "+t,n.commandStr)):u=!1,"height"in o?(s=0|o.height,E.command(s>=0,"invalid "+t,n.commandStr)):u=!1,new tr(!u&&e&&e.thisDep,!u&&e&&e.contextDep,!u&&e&&e.propDep,(function(t,e){var n=t.shared.context,r=a;"width"in o||(r=e.def(n,".",_n,"-",l));var i=s;return"height"in o||(i=e.def(n,".",bn,"-",c)),[l,c,r,i]}))}if(t in i){var h=i[t],f=rr(h,(function(e,n){var r=e.invoke(n,h);E.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)}));var i=e.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",_n,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",bn,"-",a,")");return E.optional((function(){e.assert(n,s+">=0&&"+u+">=0","invalid "+t)})),[o,a,s,u]}));return e&&(f.thisDep=f.thisDep||e.thisDep,f.contextDep=f.contextDep||e.contextDep,f.propDep=f.propDep||e.propDep),f}return e?new tr(e.thisDep,e.contextDep,e.propDep,(function(t,e){var n=t.shared.context;return[0,0,e.def(n,".",_n),e.def(n,".",bn)]})):null}var a=o(an);if(a){var s=a;a=new tr(a.thisDep,a.contextDep,a.propDep,(function(t,e){var n=s.append(t,e),r=t.shared.context;return e.set(r,".viewportWidth",n[2]),e.set(r,".viewportHeight",n[3]),n}))}return{viewport:a,scissor_box:o(on)}}(t,_,f),x=function(t,e){var n=t.static,r=t.dynamic,i=function(){if(hn in n){var t=n[hn];Jn(t)?t=a.getElements(a.create(t,!0)):t&&(t=a.getElements(t),E.command(t,"invalid elements",e.commandStr));var i=nr((function(e,n){if(t){var r=e.link(t);return e.ELEMENTS=r,r}return e.ELEMENTS=null,null}));return i.value=t,i}if(hn in r){var o=r[hn];return rr(o,(function(t,e){var n=t.shared,r=n.isBufferArgs,i=n.elements,a=t.invoke(e,o),s=e.def("null"),u=e.def(r,"(",a,")"),l=t.cond(u).then(s,"=",i,".createStream(",a,");").else(s,"=",i,".getElements(",a,");");return E.optional((function(){t.assert(l.else,"!"+a+"||"+s,"invalid elements")})),e.entry(l),e.exit(t.cond(u).then(i,".destroyStream(",s,");")),t.ELEMENTS=s,s}))}return null}();function o(t,o){if(t in n){var a=0|n[t];return E.command(!o||a>=0,"invalid "+t,e.commandStr),nr((function(t,e){return o&&(t.OFFSET=a),a}))}if(t in r){var s=r[t];return rr(s,(function(e,n){var r=e.invoke(n,s);return o&&(e.OFFSET=r,E.optional((function(){e.assert(n,r+">=0","invalid "+t)}))),r}))}return o&&i?nr((function(t,e){return t.OFFSET="0",0})):null}var s=o(dn,!0);return{elements:i,primitive:function(){if(fn in n){var t=n[fn];return E.commandParameter(t,ot,"invalid primitve",e.commandStr),nr((function(e,n){return ot[t]}))}if(fn in r){var o=r[fn];return rr(o,(function(t,e){var n=t.constants.primTypes,r=t.invoke(e,o);return E.optional((function(){t.assert(e,r+" in "+n,"invalid primitive, must be one of "+Object.keys(ot))})),e.def(n,"[",r,"]")}))}return i?er(i)?i.value?nr((function(t,e){return e.def(t.ELEMENTS,".primType")})):nr((function(){return 4})):new tr(i.thisDep,i.contextDep,i.propDep,(function(t,e){var n=t.ELEMENTS;return e.def(n,"?",n,".primType:",4)})):null}(),count:function(){if(pn in n){var t=0|n[pn];return E.command("number"==typeof t&&t>=0,"invalid vertex count",e.commandStr),nr((function(){return t}))}if(pn in r){var o=r[pn];return rr(o,(function(t,e){var n=t.invoke(e,o);return E.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(i){if(er(i)){if(i)return s?new tr(s.thisDep,s.contextDep,s.propDep,(function(t,e){var n=e.def(t.ELEMENTS,".vertCount-",t.OFFSET);return E.optional((function(){t.assert(e,n+">=0","invalid vertex offset/element buffer too small")})),n})):nr((function(t,e){return e.def(t.ELEMENTS,".vertCount")}));var a=nr((function(){return-1}));return E.optional((function(){a.MISSING=!0})),a}var u=new tr(i.thisDep||s.thisDep,i.contextDep||s.contextDep,i.propDep||s.propDep,(function(t,e){var n=t.ELEMENTS;return t.OFFSET?e.def(n,"?",n,".vertCount-",t.OFFSET,":-1"):e.def(n,"?",n,".vertCount:-1")}));return E.optional((function(){u.DYNAMIC=!0})),u}return null}(),instances:o(gn,!1),offset:s}}(t,f),S=function(t,e){var n=t.static,r=t.dynamic,o={};return w.forEach((function(t){var a=A(t);function s(e,i){if(t in n){var s=e(n[t]);o[a]=nr((function(){return s}))}else if(t in r){var u=r[t];o[a]=rr(u,(function(t,e){return i(t,e,t.invoke(e,u))}))}}switch(t){case Ge:case Le:case Re:case Je:case ze:case rn:case Xe:case qe:case Ke:case je:return s((function(n){return E.commandType(n,"boolean",t,e.commandStr),n}),(function(e,n,r){return E.optional((function(){e.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+t,e.commandStr)})),r}));case Fe:return s((function(n){return E.commandParameter(n,Yn,"invalid "+t,e.commandStr),Yn[n]}),(function(e,n,r){var i=e.constants.compareFuncs;return E.optional((function(){e.assert(n,r+" in "+i,"invalid "+t+", must be one of "+Object.keys(Yn))})),n.def(i,"[",r,"]")}));case Ze:return s((function(t){return E.command(pt(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&t[0]<=t[1],"depth range is 2d array",e.commandStr),t}),(function(t,e,n){return E.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[e.def("+",n,"[0]"),e.def("+",n,"[1]")]}));case Be:return s((function(t){E.commandType(t,"object","blend.func",e.commandStr);var n="srcRGB"in t?t.srcRGB:t.src,r="srcAlpha"in t?t.srcAlpha:t.src,i="dstRGB"in t?t.dstRGB:t.dst,o="dstAlpha"in t?t.dstAlpha:t.dst;return E.commandParameter(n,Hn,a+".srcRGB",e.commandStr),E.commandParameter(r,Hn,a+".srcAlpha",e.commandStr),E.commandParameter(i,Hn,a+".dstRGB",e.commandStr),E.commandParameter(o,Hn,a+".dstAlpha",e.commandStr),E.command(-1===Xn.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",e.commandStr),[Hn[n],Hn[i],Hn[r],Hn[o]]}),(function(e,n,r){var i=e.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return E.optional((function(){e.assert(n,s+" in "+i,"invalid "+t+"."+o+a+", must be one of "+Object.keys(Hn))})),s}E.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");E.optional((function(){var t=e.constants.invalidBlendCombinations;e.assert(n,t+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),l=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),l,n.def(i,"[",o("dst","Alpha"),"]")]}));case Ne:return s((function(n){return"string"==typeof n?(E.commandParameter(n,m,"invalid "+t,e.commandStr),[m[n],m[n]]):"object"==typeof n?(E.commandParameter(n.rgb,m,t+".rgb",e.commandStr),E.commandParameter(n.alpha,m,t+".alpha",e.commandStr),[m[n.rgb],m[n.alpha]]):void E.commandRaise("invalid blend.equation",e.commandStr)}),(function(e,n,r){var i=e.constants.blendEquations,o=n.def(),a=n.def(),s=e.cond("typeof ",r,'==="string"');return E.optional((function(){function n(t,n,r){e.assert(t,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(m))}n(s.then,t,r),e.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+t),n(s.else,t+".rgb",r+".rgb"),n(s.else,t+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case De:return s((function(t){return E.command(pt(t)&&4===t.length,"blend.color must be a 4d array",e.commandStr),D(4,(function(e){return+t[e]}))}),(function(t,e,n){return E.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),D(4,(function(t){return e.def("+",n,"[",t,"]")}))}));case $e:return s((function(t){return E.commandType(t,"number",a,e.commandStr),0|t}),(function(t,e,n){return E.optional((function(){t.assert(e,"typeof "+n+'==="number"',"invalid stencil.mask")})),e.def(n,"|0")}));case tn:return s((function(n){E.commandType(n,"object",a,e.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return E.commandParameter(r,Yn,t+".cmp",e.commandStr),E.commandType(i,"number",t+".ref",e.commandStr),E.commandType(o,"number",t+".mask",e.commandStr),[Yn[r],i,o]}),(function(t,e,n){var r=t.constants.compareFuncs;return E.optional((function(){function i(){t.assert(e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[e.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Wn),e.def(n,".ref|0"),e.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case en:case nn:return s((function(n){E.commandType(n,"object",a,e.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return E.commandParameter(r,qn,t+".fail",e.commandStr),E.commandParameter(i,qn,t+".zfail",e.commandStr),E.commandParameter(o,qn,t+".zpass",e.commandStr),[t===nn?Gn:Un,qn[r],qn[i],qn[o]]}),(function(e,n,r){var i=e.constants.stencilOps;function o(o){return E.optional((function(){e.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+t+"."+o+", must be one of "+Object.keys(qn))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",Wn)}return E.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[t===nn?Gn:Un,o("fail"),o("zfail"),o("zpass")]}));case Ye:return s((function(t){E.commandType(t,"object",a,e.commandStr);var n=0|t.factor,r=0|t.units;return E.commandType(n,"number",a+".factor",e.commandStr),E.commandType(r,"number",a+".units",e.commandStr),[n,r]}),(function(e,n,r){return E.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Ve:return s((function(t){var n=0;return"front"===t?n=Un:"back"===t&&(n=Gn),E.command(!!n,a,e.commandStr),n}),(function(t,e,n){return E.optional((function(){t.assert(e,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),e.def(n,'==="front"?',Un,":",Gn)}));case He:return s((function(t){return E.command("number"==typeof t&&t>=i.lineWidthDims[0]&&t<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],e.commandStr),t}),(function(t,e,n){return E.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case We:return s((function(t){return E.commandParameter(t,Qn,a,e.commandStr),Qn[t]}),(function(t,e,n){return E.optional((function(){t.assert(e,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),e.def(n+'==="cw"?2304:'+Vn)}));case Ue:return s((function(t){return E.command(pt(t)&&4===t.length,"color.mask must be length 4 array",e.commandStr),t.map((function(t){return!!t}))}),(function(t,e,n){return E.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),D(4,(function(t){return"!!"+n+"["+t+"]"}))}));case Qe:return s((function(t){E.command("object"==typeof t&&t,a,e.commandStr);var n="value"in t?t.value:1,r=!!t.invert;return E.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",e.commandStr),[n,r]}),(function(t,e,n){return E.optional((function(){t.assert(e,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[e.def('"value" in ',n,"?+",n,".value:1"),e.def("!!",n,".invert")]}))}})),o}(t,f),C=function(t,e,r){var i=t.static,o=t.dynamic;function a(t){if(t in i){var e=n.id(i[t]);E.optional((function(){h.shader(Kn[t],e,E.guessCommand())}));var r=nr((function(){return e}));return r.id=e,r}if(t in o){var a=o[t];return rr(a,(function(e,n){var r=e.invoke(n,a),i=n.def(e.shared.strings,".id(",r,")");return E.optional((function(){n(e.shared.shader,".shader(",Kn[t],",",i,",",e.command,");")})),i}))}return null}var s,u=a(cn),l=a(ln),c=null;return er(u)&&er(l)?(c=h.program(l.id,u.id,null,r),s=nr((function(t,e){return t.link(c)}))):s=new tr(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(t,e){var n,r=t.shared.shader;n=u?u.append(t,e):e.def(r,".",cn);var i=r+".program("+(l?l.append(t,e):e.def(r,".",ln))+","+n;return E.optional((function(){i+=","+t.command})),e.def(i+")")})),{frag:u,vert:l,progVar:s,program:c}}(t,0,g);function T(t){var e=b[t];e&&(S[t]=e)}T(an),T(A(on));var k=Object.keys(S).length>0,M={framebuffer:_,draw:x,shader:C,state:S,dirty:k,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(M.profile=function(t){var e,n=t.static,r=t.dynamic;if(sn in n){var i=!!n[sn];(e=nr((function(t,e){return i}))).enable=i}else if(sn in r){var o=r[sn];e=rr(o,(function(t,e){return t.invoke(e,o)}))}return e}(t),M.uniforms=function(t,e){var n=t.static,r=t.dynamic,i={};return Object.keys(n).forEach((function(t){var r,o=n[t];if("number"==typeof o||"boolean"==typeof o)r=nr((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=nr((function(t){return t.link(o)})):"framebuffer"===a||"framebufferCube"===a?(E.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',e.commandStr),r=nr((function(t){return t.link(o.color[0])}))):E.commandRaise('invalid data for uniform "'+t+'"',e.commandStr)}else pt(o)?r=nr((function(e){return e.global.def("[",D(o.length,(function(n){return E.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+t,e.commandStr),o[n]})),"]")})):E.commandRaise('invalid or missing data for uniform "'+t+'"',e.commandStr);r.value=o,i[t]=r})),Object.keys(r).forEach((function(t){var e=r[t];i[t]=rr(e,(function(t,n){return t.invoke(n,e)}))})),i}(s,f),M.drawVAO=M.scopeVAO=function(t,e){var n=t.static,r=t.dynamic;if(vn in n){var i=n[vn];return null!==i&&null===c.getVAO(i)&&(i=c.createVAO(i)),nr((function(t){return t.link(c.getVAO(i))}))}if(vn in r){var o=r[vn];return rr(o,(function(t,e){var n=t.invoke(e,o);return e.def(t.shared.vao+".getVAO("+n+")")}))}return null}(t),!M.drawVAO&&C.program&&!g&&r.angle_instanced_arrays){var P=!0,I=C.program.attributes.map((function(t){var n=e.static[t];return P=P&&!!n,n}));if(P&&I.length>0){var O=c.getVAO(c.createVAO(I));M.drawVAO=new tr(null,null,null,(function(t,e){return t.link(O)})),M.useVAO=!0}}return g?M.useVAO=!0:M.attributes=function(t,e){var r=t.static,i=t.dynamic,a={};return Object.keys(r).forEach((function(t){var i=r[t],s=n.id(t),u=new v;if(Jn(i))u.state=1,u.buffer=o.getBuffer(o.create(i,Sn,!1,!0)),u.type=0;else{var l=o.getBuffer(i);if(l)u.state=1,u.buffer=l,u.type=0;else if(E.command("object"==typeof i&&i,"invalid data for attribute "+t,e.commandStr),"constant"in i){var c=i.constant;u.buffer="null",u.state=2,"number"==typeof c?u.x=c:(E.command(pt(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+t,e.commandStr),Oe.forEach((function(t,e){e<c.length&&(u[t]=c[e])})))}else{l=Jn(i.buffer)?o.getBuffer(o.create(i.buffer,Sn,!1,!0)):o.getBuffer(i.buffer),E.command(!!l,'missing buffer for attribute "'+t+'"',e.commandStr);var h=0|i.offset;E.command(h>=0,'invalid offset for attribute "'+t+'"',e.commandStr);var f=0|i.stride;E.command(f>=0&&f<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',e.commandStr);var p=0|i.size;E.command(!("size"in i)||p>0&&p<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',e.commandStr);var d=!!i.normalized,g=0;"type"in i&&(E.commandParameter(i.type,q,"invalid type for attribute "+t,e.commandStr),g=q[i.type]);var m=0|i.divisor;"divisor"in i&&(E.command(0===m||y,'cannot specify divisor for attribute "'+t+'", instancing not supported',e.commandStr),E.command(m>=0,'invalid divisor for attribute "'+t+'"',e.commandStr)),E.optional((function(){var n=e.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(e){E.command(r.indexOf(e)>=0,'unknown parameter "'+e+'" for attribute pointer "'+t+'" (valid parameters are '+r+")",n)}))})),u.buffer=l,u.state=1,u.size=p,u.normalized=d,u.type=g||l.dtype,u.offset=h,u.stride=f,u.divisor=m}}a[t]=nr((function(t,e){var n=t.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(t){r[t]=u[t]})),u.buffer&&(r.buffer=t.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(t){var e=i[t];a[t]=rr(e,(function(n,r){var i=n.invoke(r,e),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;E.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+t+'"')}));var l={isStream:r.def(!1)},c=new v;c.state=1,Object.keys(c).forEach((function(t){l[t]=r.def(""+c[t])}));var h=l.buffer,f=l.type;function p(t){r(l[t],"=",i,".",t,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",h,"=",u,".createStream(",Sn,",",i,");",f,"=",h,".dtype;","}else{",h,"=",u,".getBuffer(",i,");","if(",h,"){",f,"=",h,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",2,";","if(typeof "+i+'.constant === "number"){',l[Oe[0]],"=",i,".constant;",Oe.slice(1).map((function(t){return l[t]})).join("="),"=0;","}else{",Oe.map((function(t,e){return l[t]+"="+i+".constant.length>"+e+"?"+i+".constant["+e+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",h,"=",u,".createStream(",Sn,",",i,".buffer);","}else{",h,"=",u,".getBuffer(",i,".buffer);","}",f,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",h,".dtype;",l.normalized,"=!!",i,".normalized;"),p("size"),p("offset"),p("stride"),p("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",h,");","}"),l}))})),a}(e,f),M.context=function(t){var e=t.static,n=t.dynamic,r={};return Object.keys(e).forEach((function(t){var n=e[t];r[t]=nr((function(t,e){return"number"==typeof n||"boolean"==typeof n?""+n:t.link(n)}))})),Object.keys(n).forEach((function(t){var e=n[t];r[t]=rr(e,(function(t,n){return t.invoke(n,e)}))})),r}(l),M}function N(t,e,n){var r=t.shared.context,i=t.scope();Object.keys(n).forEach((function(o){e.save(r,"."+o);var a=n[o].append(t,e);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),e(i)}function B(t,e,n,r){var i,o=t.shared,a=o.gl,s=o.framebuffer;_&&(i=e.def(o.extensions,".webgl_draw_buffers"));var u,l=t.constants,c=l.drawBuffer,h=l.backBuffer;u=n?n.append(t,e):e.def(s,".next"),r||e("if(",u,"!==",s,".cur){"),e("if(",u,"){",a,".bindFramebuffer(",36160,",",u,".framebuffer);"),_&&e(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),e("}else{",a,".bindFramebuffer(",36160,",null);"),_&&e(i,".drawBuffersWEBGL(",h,");"),e("}",s,".cur=",u,";"),r||e("}")}function z(t,e,n){var r=t.shared,i=r.gl,o=t.current,a=t.next,s=r.current,u=r.next,l=t.cond(s,".dirty");w.forEach((function(e){var r,c,h=A(e);if(!(h in n.state))if(h in a){r=a[h],c=o[h];var f=D(b[h].length,(function(t){return l.def(r,"[",t,"]")}));l(t.cond(f.map((function(t,e){return t+"!=="+c+"["+e+"]"})).join("||")).then(i,".",C[h],"(",f,");",f.map((function(t,e){return c+"["+e+"]="+t})).join(";"),";"))}else{r=l.def(u,".",h);var p=t.cond(r,"!==",s,".",h);l(p),h in S?p(t.cond(r).then(i,".enable(",S[h],");").else(i,".disable(",S[h],");"),s,".",h,"=",r,";"):p(i,".",C[h],"(",r,");",s,".",h,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),e(l)}function F(t,e,n,r){var i=t.shared,o=t.current,a=i.current,s=i.gl;$n(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(t,e);if(S[i]){var c=S[i];er(u)?e(s,l?".enable(":".disable(",c,");"):e(t.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),e(a,".",i,"=",l,";")}else if(pt(l)){var h=o[i];e(s,".",C[i],"(",l,");",l.map((function(t,e){return h+"["+e+"]="+t})).join(";"),";")}else e(s,".",C[i],"(",l,");",a,".",i,"=",l,";")}}))}function Z(t,e){y&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function j(t,e,n,r,i){var o,a,s,u=t.shared,l=t.stats,c=u.current,h=u.timer,f=n.profile;function p(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function g(t){t(o=e.def(),"=",p(),";"),"string"==typeof i?t(l,".count+=",i,";"):t(l,".count++;"),d&&(r?t(a=e.def(),"=",h,".getNumPendingQueries();"):t(h,".beginQuery(",l,");"))}function v(t){t(l,".cpuTime+=",p(),"-",o,";"),d&&(r?t(h,".pushScopeStats(",a,",",h,".getNumPendingQueries(),",l,");"):t(h,".endQuery();"))}function m(t){var n=e.def(c,".profile");e(c,".profile=",t,";"),e.exit(c,".profile=",n,";")}if(f){if(er(f))return void(f.enable?(g(e),v(e.exit),m("true")):m("false"));m(s=f.append(t,e))}else s=e.def(c,".profile");var y=t.block();g(y),e("if(",s,"){",y,"}");var _=t.block();v(_),e.exit("if(",s,"){",_,"}")}function U(t,e,n,r,i){var o=t.shared;r.forEach((function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(t,e)}else{if(!i(ir))return;var l=t.scopeAttrib(s);E.optional((function(){t.assert(e,l+".state","missing attribute "+s)})),a={},Object.keys(new v).forEach((function(t){a[t]=e.def(l,".",t)}))}!function(n,r,i){var a=o.gl,s=e.def(n,".location"),u=e.def(o.attributes,"[",s,"]"),l=i.state,c=i.buffer,h=[i.x,i.y,i.z,i.w],f=["buffer","normalized","offset","stride"];function p(){e("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?e.def(i.size,"||",r):r,e("if(",u,".type!==",o,"||",u,".size!==",n,"||",f.map((function(t){return u+"."+t+"!=="+i[t]})).join("||"),"){",a,".bindBuffer(",Sn,",",c,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",f.map((function(t){return u+"."+t+"="+i[t]+";"})).join(""),"}"),y){var l=i.divisor;e("if(",u,".divisor!==",l,"){",t.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function d(){e("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",Oe.map((function(t,e){return u+"."+t+"!=="+h[e]})).join("||"),"){",a,".vertexAttrib4f(",s,",",h,");",Oe.map((function(t,e){return u+"."+t+"="+h[e]+";"})).join(""),"}")}1===l?p():2===l?d():(e("if(",l,"===",1,"){"),p(),e("}else{"),d(),e("}"))}(t.link(r),function(t){switch(t){case An:case Pn:case Ln:return 2;case Tn:case In:case Dn:return 3;case kn:case On:case Nn:return 4;default:return 1}}(r.info.type),a)}))}function G(t,e,r,i,o){for(var a,s=t.shared,u=s.gl,l=0;l<i.length;++l){var c,h=i[l],f=h.name,p=h.info.type,d=r.uniforms[f],g=t.link(h)+".location";if(d){if(!o(d))continue;if(er(d)){var v=d.value;if(E.command(null!=v,'missing uniform "'+f+'"',t.commandStr),p===Zn||p===jn){E.command("function"==typeof v&&(p===Zn&&("texture2d"===v._reglType||"framebuffer"===v._reglType)||p===jn&&("textureCube"===v._reglType||"framebufferCube"===v._reglType)),"invalid texture for uniform "+f,t.commandStr);var m=t.link(v._texture||v.color[0]._texture);e(u,".uniform1i(",g,",",m+".bind());"),e.exit(m,".unbind();")}else if(p===Bn||p===zn||p===Fn){E.optional((function(){E.command(pt(v),"invalid matrix for uniform "+f,t.commandStr),E.command(p===Bn&&4===v.length||p===zn&&9===v.length||p===Fn&&16===v.length,"invalid length for matrix uniform "+f,t.commandStr)}));var y=t.global.def("new Float32Array(["+Array.prototype.slice.call(v)+"])"),_=2;p===zn?_=3:p===Fn&&(_=4),e(u,".uniformMatrix",_,"fv(",g,",false,",y,");")}else{switch(p){case Cn:E.commandType(v,"number","uniform "+f,t.commandStr),a="1f";break;case An:E.command(pt(v)&&2===v.length,"uniform "+f,t.commandStr),a="2f";break;case Tn:E.command(pt(v)&&3===v.length,"uniform "+f,t.commandStr),a="3f";break;case kn:E.command(pt(v)&&4===v.length,"uniform "+f,t.commandStr),a="4f";break;case Rn:E.commandType(v,"boolean","uniform "+f,t.commandStr),a="1i";break;case Mn:E.commandType(v,"number","uniform "+f,t.commandStr),a="1i";break;case Ln:case Pn:E.command(pt(v)&&2===v.length,"uniform "+f,t.commandStr),a="2i";break;case Dn:case In:E.command(pt(v)&&3===v.length,"uniform "+f,t.commandStr),a="3i";break;case Nn:case On:E.command(pt(v)&&4===v.length,"uniform "+f,t.commandStr),a="4i"}e(u,".uniform",a,"(",g,",",pt(v)?Array.prototype.slice.call(v):v,");")}continue}c=d.append(t,e)}else{if(!o(ir))continue;c=e.def(s.uniforms,"[",n.id(f),"]")}p===Zn?(E(!Array.isArray(c),"must specify a scalar prop for textures"),e("if(",c,"&&",c,'._reglType==="framebuffer"){',c,"=",c,".color[0];","}")):p===jn&&(E(!Array.isArray(c),"must specify a scalar prop for cube maps"),e("if(",c,"&&",c,'._reglType==="framebufferCube"){',c,"=",c,".color[0];","}")),E.optional((function(){function n(n,r){t.assert(e,n,'bad data or missing for uniform "'+f+'".  '+r)}function r(t){E(!Array.isArray(c),"must not specify an array type for uniform"),n("typeof "+c+'==="'+t+'"',"invalid type, expected "+t)}function i(e,r){Array.isArray(c)?E(c.length===e,"must have length "+e):n(s.isArrayLike+"("+c+")&&"+c+".length==="+e,"invalid vector, should have length "+e,t.commandStr)}function o(e){E(!Array.isArray(c),"must not specify a value type"),n("typeof "+c+'==="function"&&'+c+'._reglType==="texture'+(3553===e?"2d":"Cube")+'"',"invalid texture type",t.commandStr)}switch(p){case Mn:r("number");break;case Pn:i(2);break;case In:i(3);break;case On:i(4);break;case Cn:r("number");break;case An:i(2);break;case Tn:i(3);break;case kn:i(4);break;case Rn:r("boolean");break;case Ln:i(2);break;case Dn:i(3);break;case Nn:case Bn:i(4);break;case zn:i(9);break;case Fn:i(16);break;case Zn:o(3553);break;case jn:o(34067)}}));var b=1;switch(p){case Zn:case jn:var x=e.def(c,"._texture");e(u,".uniform1i(",g,",",x,".bind());"),e.exit(x,".unbind();");continue;case Mn:case Rn:a="1i";break;case Pn:case Ln:a="2i",b=2;break;case In:case Dn:a="3i",b=3;break;case On:case Nn:a="4i",b=4;break;case Cn:a="1f";break;case An:a="2f",b=2;break;case Tn:a="3f",b=3;break;case kn:a="4f",b=4;break;case Bn:a="Matrix2fv";break;case zn:a="Matrix3fv";break;case Fn:a="Matrix4fv"}if(e(u,".uniform",a,"(",g,","),"M"===a.charAt(0)){var w=Math.pow(p-Bn+2,2),S=t.global.def("new Float32Array(",w,")");Array.isArray(c)?e("false,(",D(w,(function(t){return S+"["+t+"]="+c[t]})),",",S,")"):e("false,(Array.isArray(",c,")||",c," instanceof Float32Array)?",c,":(",D(w,(function(t){return S+"["+t+"]="+c+"["+t+"]"})),",",S,")")}else b>1?e(D(b,(function(t){return Array.isArray(c)?c[t]:c+"["+t+"]"}))):(E(!Array.isArray(c),"uniform value must not be an array"),e(c));e(");")}}function V(t,e,n,r){var i=t.shared,o=i.gl,a=i.draw,s=r.draw;var u=function(){var i,u=s.elements,l=e;return u?((u.contextDep&&r.contextDynamic||u.propDep)&&(l=n),i=u.append(t,l)):i=l.def(a,".",hn),i&&l("if("+i+")"+o+".bindBuffer(34963,"+i+".buffer.buffer);"),i}();function l(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(t,n):o.append(t,e):e.def(a,".",i)}var c,h,f=l(fn),p=l(dn),d=function(){var i,o=s.count,u=e;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(t,u),E.optional((function(){o.MISSING&&t.assert(e,"false","missing vertex count"),o.DYNAMIC&&t.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",pn),E.optional((function(){t.assert(u,i+">=0","missing vertex count")}))),i}();if("number"==typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");y&&(c=l(gn),h=t.instancing);var g=u+".type",v=s.elements&&er(s.elements);function m(){function t(){n(h,".drawElementsInstancedANGLE(",[f,d,g,p+"<<(("+g+"-5121)>>1)",c],");")}function e(){n(h,".drawArraysInstancedANGLE(",[f,p,d,c],");")}u?v?t():(n("if(",u,"){"),t(),n("}else{"),e(),n("}")):e()}function _(){function t(){n(o+".drawElements("+[f,d,g,p+"<<(("+g+"-5121)>>1)"]+");")}function e(){n(o+".drawArrays("+[f,p,d]+");")}u?v?t():(n("if(",u,"){"),t(),n("}else{"),e(),n("}")):e()}y&&("number"!=typeof c||c>=0)?"string"==typeof c?(n("if(",c,">0){"),m(),n("}else if(",c,"<0){"),_(),n("}")):m():_()}function W(t,e,n,r,i){var o=R(),a=o.proc("body",i);return E.optional((function(){o.commandStr=e.commandStr,o.command=o.link(e.commandStr)})),y&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),t(o,a,n,r),o.compile().body}function H(t,e,n,r){Z(t,e),n.useVAO?n.drawVAO?e(t.shared.vao,".setVAO(",n.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),U(t,e,n,r.attributes,(function(){return!0}))),G(t,e,n,r.uniforms,(function(){return!0})),V(t,e,e,n)}function X(t,e,n,r){function i(){return!0}t.batchId="a1",Z(t,e),U(t,e,n,r.attributes,i),G(t,e,n,r.uniforms,i),V(t,e,e,n)}function Y(t,e,n,r){Z(t,e);var i=n.contextDep,o=e.def(),a=e.def();t.shared.props=a,t.batchId=o;var s=t.scope(),u=t.scope();function l(t){return t.contextDep&&i||t.propDep}function c(t){return!l(t)}if(e(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",u,"}",s.exit),n.needsContext&&N(t,u,n.context),n.needsFramebuffer&&B(t,u,n.framebuffer),F(t,u,n.state,l),n.profile&&l(n.profile)&&j(t,u,n,!1,!0),r)n.useVAO?n.drawVAO?l(n.drawVAO)?u(t.shared.vao,".setVAO(",n.drawVAO.append(t,u),");"):s(t.shared.vao,".setVAO(",n.drawVAO.append(t,s),");"):s(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(s(t.shared.vao,".setVAO(null);"),U(t,s,n,r.attributes,c),U(t,u,n,r.attributes,l)),G(t,s,n,r.uniforms,c),G(t,u,n,r.uniforms,l),V(t,s,u,n);else{var h=t.global.def("{}"),f=n.shader.progVar.append(t,u),p=u.def(f,".id"),d=u.def(h,"[",p,"]");u(t.shared.gl,".useProgram(",f,".program);","if(!",d,"){",d,"=",h,"[",p,"]=",t.link((function(e){return W(X,t,n,e,2)})),"(",f,");}",d,".call(this,a0[",o,"],",o,");")}}function K(t,e,n){var r=e.static[n];if(r&&function(t){if("object"==typeof t&&!pt(t)){for(var e=Object.keys(t),n=0;n<e.length;++n)if(M.isDynamic(t[e[n]]))return!0;return!1}}(r)){var i=t.global,o=Object.keys(r),a=!1,s=!1,u=!1,l=t.global.def("{}");o.forEach((function(e){var n=r[e];if(M.isDynamic(n)){"function"==typeof n&&(n=r[e]=M.unbox(n));var o=rr(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(l,".",e,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(t.link(n))}i(";")}})),e.dynamic[n]=new M.DynamicVariable(4,{thisDep:a,contextDep:s,propDep:u,ref:l,append:function(t,e){o.forEach((function(n){var i=r[n];if(M.isDynamic(i)){var o=t.invoke(e,i);e(l,".",n,"=",o,";")}}))}}),delete e.static[n]}}return{next:x,current:b,procs:function(){var t=R(),e=t.proc("poll"),n=t.proc("refresh"),o=t.block();e(o),n(o);var a,s=t.shared,u=s.gl,l=s.next,c=s.current;o(c,".dirty=false;"),B(t,e),B(t,n,null,!0),y&&(a=t.link(y)),r.oes_vertex_array_object&&n(t.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var h=0;h<i.maxAttributes;++h){var f=n.def(s.attributes,"[",h,"]"),p=t.cond(f,".buffer");p.then(u,".enableVertexAttribArray(",h,");",u,".bindBuffer(",Sn,",",f,".buffer.buffer);",u,".vertexAttribPointer(",h,",",f,".size,",f,".type,",f,".normalized,",f,".stride,",f,".offset);").else(u,".disableVertexAttribArray(",h,");",u,".vertexAttrib4f(",h,",",f,".x,",f,".y,",f,".z,",f,".w);",f,".buffer=null;"),n(p),y&&n(a,".vertexAttribDivisorANGLE(",h,",",f,".divisor);")}return n(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(S).forEach((function(r){var i=S[r],a=o.def(l,".",r),s=t.block();s("if(",a,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",c,".",r,"=",a,";"),n(s),e("if(",a,"!==",c,".",r,"){",s,"}")})),Object.keys(C).forEach((function(r){var i,a,s=C[r],h=b[r],f=t.block();if(f(u,".",s,"("),pt(h)){var p=h.length;i=t.global.def(l,".",r),a=t.global.def(c,".",r),f(D(p,(function(t){return i+"["+t+"]"})),");",D(p,(function(t){return a+"["+t+"]="+i+"["+t+"];"})).join("")),e("if(",D(p,(function(t){return i+"["+t+"]!=="+a+"["+t+"]"})).join("||"),"){",f,"}")}else i=o.def(l,".",r),a=o.def(c,".",r),f(i,");",c,".",r,"=",i,";"),e("if(",i,"!==",a,"){",f,"}");n(f)})),t.compile()}(),compile:function(t,r,i,o,a){var s=R();s.stats=s.link(a),Object.keys(r.static).forEach((function(t){K(s,r,t)})),En.forEach((function(e){K(s,t,e)}));var u=L(t,r,i,o,s);return function(t,e){var n=t.proc("draw",1);Z(t,n),N(t,n,e.context),B(t,n,e.framebuffer),z(t,n,e),F(t,n,e.state),j(t,n,e,!1,!0);var r=e.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",r,".program);"),e.shader.program)H(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var i=t.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(t.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",t.link((function(n){return W(H,t,e,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;")}(s,u),function(t,e){var r=t.proc("scope",3);t.batchId="a2";var i=t.shared,o=i.current;function a(n){var o=e.shader[n];o&&r.set(i.shader,"."+n,o.append(t,r))}N(t,r,e.context),e.framebuffer&&e.framebuffer.append(t,r),$n(Object.keys(e.state)).forEach((function(n){var o=e.state[n].append(t,r);pt(o)?o.forEach((function(e,i){r.set(t.next[n],"["+i+"]",e)})):r.set(i.next,"."+n,o)})),j(t,r,e,!0,!0),[hn,dn,pn,gn,fn].forEach((function(n){var o=e.draw[n];o&&r.set(i.draw,"."+n,""+o.append(t,r))})),Object.keys(e.uniforms).forEach((function(o){var a=e.uniforms[o].append(t,r);Array.isArray(a)&&(a="["+a.join()+"]"),r.set(i.uniforms,"["+n.id(o)+"]",a)})),Object.keys(e.attributes).forEach((function(n){var i=e.attributes[n].append(t,r),o=t.scopeAttrib(n);Object.keys(new v).forEach((function(t){r.set(o,"."+t,i[t])}))})),e.scopeVAO&&r.set(i.vao,".targetVAO",e.scopeVAO.append(t,r)),a(ln),a(cn),Object.keys(e.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",t.shared.context,",a0,",t.batchId,");")}(s,u),function(t,e){var n=t.proc("batch",2);t.batchId="0",Z(t,n);var r=!1,i=!0;Object.keys(e.context).forEach((function(t){r=r||e.context[t].propDep})),r||(N(t,n,e.context),i=!1);var o=e.framebuffer,a=!1;function s(t){return t.contextDep&&r||t.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||B(t,n,o)):B(t,n,null),e.state.viewport&&e.state.viewport.propDep&&(r=!0),z(t,n,e),F(t,n,e.state,(function(t){return!s(t)})),e.profile&&s(e.profile)||j(t,n,e,!1,"a1"),e.contextDep=r,e.needsContext=i,e.needsFramebuffer=a;var u=e.shader.progVar;if(u.contextDep&&r||u.propDep)Y(t,n,e,null);else{var l=u.append(t,n);if(n(t.shared.gl,".useProgram(",l,".program);"),e.shader.program)Y(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var c=t.global.def("{}"),h=n.def(l,".id"),f=n.def(c,"[",h,"]");n(t.cond(f).then(f,".call(this,a0,a1);").else(f,"=",c,"[",h,"]=",t.link((function(n){return W(Y,t,e,n,2)})),"(",l,");",f,".call(this,a0,a1);"))}}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;")}(s,u),e(s.compile(),{destroy:function(){u.shader.program.destroy()}})}}}var ar=function(t,e){if(!e.ext_disjoint_timer_query)return null;var n=[];function r(t){n.push(t)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(t){a.push(t)}var u=[];function l(t,e,n){var r=a.pop()||new o;r.startQueryIndex=t,r.endQueryIndex=e,r.sum=0,r.stats=n,u.push(r)}var c=[],h=[];return{beginQuery:function(t){var r=n.pop()||e.ext_disjoint_timer_query.createQueryEXT();e.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),l(i.length-1,i.length,t)},endQuery:function(){e.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:l,update:function(){var t,n,o=i.length;if(0!==o){h.length=Math.max(h.length,o+1),c.length=Math.max(c.length,o+1),c[0]=0,h[0]=0;var a=0;for(t=0,n=0;n<i.length;++n){var l=i[n];e.ext_disjoint_timer_query.getQueryObjectEXT(l,34919)?(a+=e.ext_disjoint_timer_query.getQueryObjectEXT(l,34918),r(l)):i[t++]=l,c[n+1]=a,h[n+1]=t}for(i.length=t,t=0,n=0;n<u.length;++n){var f=u[n],p=f.startQueryIndex,d=f.endQueryIndex;f.sum+=c[d]-c[p];var g=h[p],v=h[d];v===g?(f.stats.gpuTime+=f.sum/1e6,s(f)):(f.startQueryIndex=g,f.endQueryIndex=v,u[t++]=f)}u.length=t}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var t=0;t<n.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(n[t]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},sr="webglcontextlost",ur="webglcontextrestored";function lr(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}return function(n){var r=L(n);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),a=i.isContextLost(),s=function(t,e){var n={};function r(e){E.type(e,"string","extension name must be string");var r,i=e.toLowerCase();try{r=n[i]=t.getExtension(i)}catch(t){}return!!r}for(var i=0;i<e.extensions.length;++i){var o=e.extensions[i];if(!r(o))return e.onDestroy(),e.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(t){if(n[t]&&!r(t))throw new Error("(regl): error restoring extension "+t)}))}}}(i,r);if(!s)return null;var u,l,c=(u={"":0},l=[""],{id:function(t){var e=u[t];return e||(e=u[t]=l.length,l.push(t),e)},str:function(t){return l[t]}}),h={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},f=s.extensions,p=ar(0,f),d=I(),g=i.drawingBufferWidth,v=i.drawingBufferHeight,m={tick:0,time:0,viewportWidth:g,viewportHeight:v,framebufferWidth:g,framebufferHeight:v,drawingBufferWidth:g,drawingBufferHeight:v,pixelRatio:r.pixelRatio},y=function(t,e){var n=1;e.ext_texture_filter_anisotropic&&(n=t.getParameter(34047));var r=1,i=1;e.webgl_draw_buffers&&(r=t.getParameter(34852),i=t.getParameter(36063));var o=!!e.oes_texture_float;if(o){var a=t.createTexture();t.bindTexture(F,a),t.texImage2D(F,0,Z,1,1,0,Z,j,null);var s=t.createFramebuffer();if(t.bindFramebuffer(U,s),t.framebufferTexture2D(U,36064,F,a,0),t.bindTexture(F,null),36053!==t.checkFramebufferStatus(U))o=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(16384);var u=z.allocType(j,4);t.readPixels(0,0,1,1,Z,j,u),t.getError()?o=!1:(t.deleteFramebuffer(s),t.deleteTexture(a),o=1===u[0]),z.freeType(u)}}var l=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=t.createTexture(),h=z.allocType(5121,36);t.activeTexture(33984),t.bindTexture(34067,c),t.texImage2D(34069,0,Z,3,3,0,Z,5121,h),z.freeType(h),t.bindTexture(34067,null),t.deleteTexture(c),l=!t.getError()}return{colorBits:[t.getParameter(3410),t.getParameter(3411),t.getParameter(3412),t.getParameter(3413)],depthBits:t.getParameter(3414),stencilBits:t.getParameter(3415),subpixelBits:t.getParameter(3408),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:t.getParameter(33901),lineWidthDims:t.getParameter(33902),maxViewportDims:t.getParameter(3386),maxCombinedTextureUnits:t.getParameter(35661),maxCubeMapSize:t.getParameter(34076),maxRenderbufferSize:t.getParameter(34024),maxTextureUnits:t.getParameter(34930),maxTextureSize:t.getParameter(3379),maxAttributes:t.getParameter(34921),maxVertexUniforms:t.getParameter(36347),maxVertexTextureUnits:t.getParameter(35660),maxVaryingVectors:t.getParameter(36348),maxFragmentUniforms:t.getParameter(36349),glsl:t.getParameter(35724),renderer:t.getParameter(7937),vendor:t.getParameter(7936),version:t.getParameter(7938),readFloat:o,npotTextureCube:l}}(i,f),_=function(e,n,r,i){var o=0,a={};function s(t){this.id=o++,this.buffer=e.createBuffer(),this.type=t,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=$,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){h(this)};var u=[];function l(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function c(e,n,r,i,o,a){var s,u;if(e.usage=r,Array.isArray(n)){if(e.dtype=i||tt,n.length>0)if(Array.isArray(n[0])){s=J(n);for(var c=1,h=1;h<s.length;++h)c*=s[h];e.dimension=c,l(e,u=Q(n,s,e.dtype),r),a?e.persistentData=u:z.freeType(u)}else if("number"==typeof n[0]){e.dimension=o;var f=z.allocType(e.dtype,n.length);rt(f,n),l(e,f,r),a?e.persistentData=f:z.freeType(f)}else t(n[0])?(e.dimension=n[0].length,e.dtype=i||nt(n[0])||tt,l(e,u=Q(n,[n.length,n[0].length],e.dtype),r),a?e.persistentData=u:z.freeType(u)):E.raise("invalid buffer data")}else if(t(n))e.dtype=i||nt(n),e.dimension=o,l(e,n,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(G(n)){s=n.shape;var p=n.stride,d=n.offset,g=0,v=0,m=0,y=0;1===s.length?(g=s[0],v=1,m=p[0],y=0):2===s.length?(g=s[0],v=s[1],m=p[0],y=p[1]):E.raise("invalid shape"),e.dtype=i||nt(n.data)||tt,e.dimension=v;var _=z.allocType(e.dtype,g*v);it(_,n.data,g,v,m,y,d),l(e,_,r),a?e.persistentData=_:z.freeType(_)}else n instanceof ArrayBuffer?(e.dtype=$,e.dimension=o,l(e,n,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(n)))):E.raise("invalid buffer data")}function h(t){n.bufferCount--,i(t);var r=t.buffer;E(r,"buffer must not be deleted already"),e.deleteBuffer(r),t.buffer=null,delete a[t.id]}return r.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(a).forEach((function(e){t+=a[e].stats.size})),t}),{create:function(i,o,u,l){n.bufferCount++;var f=new s(o);function p(n){var i=35044,o=null,a=0,s=0,u=1;return Array.isArray(n)||t(n)||G(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(E.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(E(null===o||Array.isArray(o)||t(o)||G(o),"invalid data for buffer"),o=n.data),"usage"in n&&(E.parameter(n.usage,K,"invalid buffer usage"),i=K[n.usage]),"type"in n&&(E.parameter(n.type,q,"invalid buffer type"),s=q[n.type]),"dimension"in n&&(E.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(E.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),f.bind(),o?c(f,o,i,s,u,l):(a&&e.bufferData(f.type,a,i),f.dtype=s||$,f.usage=i,f.dimension=u,f.byteLength=a),r.profile&&(f.stats.size=f.byteLength*et[f.dtype]),p}function d(t,n){E(n+t.byteLength<=f.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+f.byteLength),e.bufferSubData(f.type,n,t)}return a[f.id]=f,u||p(i),p._reglType="buffer",p._buffer=f,p.subdata=function(e,n){var r,i=0|(n||0);if(f.bind(),t(e)||e instanceof ArrayBuffer)d(e,i);else if(Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var o=z.allocType(f.dtype,e.length);rt(o,e),d(o,i),z.freeType(o)}else if(Array.isArray(e[0])||t(e[0])){r=J(e);var a=Q(e,r,f.dtype);d(a,i),z.freeType(a)}else E.raise("invalid buffer data")}else if(G(e)){r=e.shape;var s=e.stride,u=0,l=0,c=0,h=0;1===r.length?(u=r[0],l=1,c=s[0],h=0):2===r.length?(u=r[0],l=r[1],c=s[0],h=s[1]):E.raise("invalid shape");var g=Array.isArray(e.data)?f.dtype:nt(e.data),v=z.allocType(g,u*l);it(v,e.data,u,l,c,h,e.offset),d(v,i),z.freeType(v)}else E.raise("invalid data for buffer subdata");return p},r.profile&&(p.stats=f.stats),p.destroy=function(){h(f)},p},createStream:function(t,e){var n=u.pop();return n||(n=new s(t)),n.bind(),c(n,e,35040,0,1,!1),n},destroyStream:function(t){u.push(t)},clear:function(){V(a).forEach(h),u.forEach(h)},getBuffer:function(t){return t&&t._buffer instanceof s?t._buffer:null},restore:function(){V(a).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))},_initBuffer:c}}(i,h,r,(function(t){return b.destroyBuffer(t)})),b=function(e,n,r,i,o){for(var a=r.maxAttributes,s=new Array(a),u=0;u<a;++u)s[u]=new Ae;var l=0,c={},h={Record:Ae,scope:{},state:s,currentVAO:null,targetVAO:null,restore:f()?function(){f()&&V(c).forEach((function(t){t.refresh()}))}:function(){},createVAO:function(e){var r=new d;function s(e){E(Array.isArray(e),"arguments to vertex array constructor must be an array"),E(e.length<a,"too many attributes"),E(e.length>0,"must specify at least one attribute");var i={},u=r.attributes;u.length=e.length;for(var l=0;l<e.length;++l){var c,h=e[l],f=u[l]=new Ae,p=h.data||h;Array.isArray(p)||t(p)||G(p)?(r.buffers[l]&&(c=r.buffers[l],t(p)&&c._buffer.byteLength>=p.byteLength?c.subdata(p):(c.destroy(),r.buffers[l]=null)),r.buffers[l]||(c=r.buffers[l]=o.create(h,34962,!1,!0)),f.buffer=o.getBuffer(c),f.size=0|f.buffer.dimension,f.normalized=!1,f.type=f.buffer.dtype,f.offset=0,f.stride=0,f.divisor=0,f.state=1,i[l]=1):o.getBuffer(h)?(f.buffer=o.getBuffer(h),f.size=0|f.buffer.dimension,f.normalized=!1,f.type=f.buffer.dtype,f.offset=0,f.stride=0,f.divisor=0,f.state=1):o.getBuffer(h.buffer)?(f.buffer=o.getBuffer(h.buffer),f.size=0|(+h.size||f.buffer.dimension),f.normalized=!!h.normalized||!1,"type"in h?(E.parameter(h.type,q,"invalid buffer type"),f.type=q[h.type]):f.type=f.buffer.dtype,f.offset=0|(h.offset||0),f.stride=0|(h.stride||0),f.divisor=0|(h.divisor||0),f.state=1,E(f.size>=1&&f.size<=4,"size must be between 1 and 4"),E(f.offset>=0,"invalid offset"),E(f.stride>=0&&f.stride<=255,"stride must be between 0 and 255"),E(f.divisor>=0,"divisor must be positive"),E(!f.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in h?(E(l>0,"first attribute must not be a constant"),f.x=+h.x||0,f.y=+h.y||0,f.z=+h.z||0,f.w=+h.w||0,f.state=2):E(!1,"invalid attribute spec for location "+l)}for(var d=0;d<r.buffers.length;++d)!i[d]&&r.buffers[d]&&(r.buffers[d].destroy(),r.buffers[d]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var t=0;t<r.buffers.length;++t)r.buffers[t]&&r.buffers[t].destroy();r.buffers.length=0,r.destroy()},s._vao=r,s._reglType="vao",s(e)},getVAO:function(t){return"function"==typeof t&&t._vao?t._vao:null},destroyBuffer:function(t){for(var n=0;n<s.length;++n){var r=s[n];r.buffer===t&&(e.disableVertexAttribArray(n),r.buffer=null)}},setVAO:f()?function(t){if(t!==h.currentVAO){var e=f();t?e.bindVertexArrayOES(t.vao):e.bindVertexArrayOES(null),h.currentVAO=t}}:function(t){if(t!==h.currentVAO){if(t)t.bindAttrs();else for(var n=p(),r=0;r<s.length;++r){var i=s[r];i.buffer?(e.enableVertexAttribArray(r),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}h.currentVAO=t}},clear:f()?function(){V(c).forEach((function(t){t.destroy()}))}:function(){}};function f(){return n.oes_vertex_array_object}function p(){return n.angle_instanced_arrays}function d(){this.id=++l,this.attributes=[];var t=f();this.vao=t?t.createVertexArrayOES():null,c[this.id]=this,this.buffers=[]}return d.prototype.bindAttrs=function(){for(var t=p(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(e.enableVertexAttribArray(r),e.bindBuffer(34962,i.buffer.buffer),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),t&&i.divisor&&t.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<a;++o)e.disableVertexAttribArray(o)},d.prototype.refresh=function(){var t=f();t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),h.currentVAO=this)},d.prototype.destroy=function(){if(this.vao){var t=f();this===h.currentVAO&&(h.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}c[this.id]&&(delete c[this.id],i.vaoCount-=1)},h}(i,f,y,h,_),x=function(e,n,r,i){var o={},a=0,s={uint8:at,uint16:st};function u(t){this.id=a++,o[this.id]=this,this.buffer=t,this.primType=4,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=ut),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(i,o,a,s,u,l,c){var h;if(i.buffer.bind(),o){var f=c;c||t(o)&&(!G(o)||t(o.data))||(f=n.oes_element_index_uint?ut:st),r._initBuffer(i.buffer,o,a,f,3)}else e.bufferData(lt,l,a),i.buffer.dtype=h||at,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=l;if(h=c,!c){switch(i.buffer.dtype){case at:case 5120:h=at;break;case st:case 5122:h=st;break;case ut:case 5124:h=ut;break;default:E.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,E(h!==ut||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=u;p<0&&(p=i.buffer.byteLength,h===st?p>>=1:h===ut&&(p>>=2)),i.vertCount=p;var d=s;if(s<0){d=4;var g=i.buffer.dimension;1===g&&(d=0),2===g&&(d=1),3===g&&(d=4)}i.primType=d}function h(t){i.elementsCount--,E(null!==t.buffer,"must not double destroy elements"),delete o[t.id],t.buffer.destroy(),t.buffer=null}return{create:function(e,n){var o=r.create(null,lt,!0),a=new u(o._buffer);function l(e){if(e)if("number"==typeof e)o(e),a.primType=4,a.vertCount=0|e,a.type=at;else{var n=null,r=35044,i=-1,u=-1,h=0,f=0;Array.isArray(e)||t(e)||G(e)?n=e:(E.type(e,"object","invalid arguments for elements"),"data"in e&&(n=e.data,E(Array.isArray(n)||t(n)||G(n),"invalid data for element buffer")),"usage"in e&&(E.parameter(e.usage,K,"invalid element buffer usage"),r=K[e.usage]),"primitive"in e&&(E.parameter(e.primitive,ot,"invalid element buffer primitive"),i=ot[e.primitive]),"count"in e&&(E("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),u=0|e.count),"type"in e&&(E.parameter(e.type,s,"invalid buffer type"),f=s[e.type]),"length"in e?h=0|e.length:(h=u,f===st||5122===f?h*=2:f!==ut&&5124!==f||(h*=4))),c(a,n,r,i,u,h,f)}else o(),a.primType=4,a.vertCount=0,a.type=at;return l}return i.elementsCount++,l(e),l._reglType="elements",l._elements=a,l.subdata=function(t,e){return o.subdata(t,e),l},l.destroy=function(){h(a)},l},createStream:function(t){var e=l.pop();return e||(e=new u(r.create(null,lt,!0,!1)._buffer)),c(e,t,35040,-1,-1,0,0),e},destroyStream:function(t){l.push(t)},getElements:function(t){return"function"==typeof t&&t._elements instanceof u?t._elements:null},clear:function(){V(o).forEach(h)}}}(i,f,_,h),w=function(t,n,r,i){var o={},a={};function s(t,e,n,r){this.name=t,this.id=e,this.location=n,this.info=r}function u(t,e){for(var n=0;n<t.length;++n)if(t[n].id===e.id)return void(t[n].location=e.location);t.push(e)}function l(e,r,i){var s=35632===e?o:a,u=s[r];if(!u){var l=n.str(r);u=t.createShader(e),t.shaderSource(u,l),t.compileShader(u),E.shaderError(t,u,l,e,i),s[r]=u}return u}var c={},h=[],f=0;function p(t,e){this.id=f++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(e,r,o){var a,c,h=l(35632,e.fragId),f=l(35633,e.vertId),p=e.program=t.createProgram();if(t.attachShader(p,h),t.attachShader(p,f),o)for(a=0;a<o.length;++a){var d=o[a];t.bindAttribLocation(p,d[0],d[1])}t.linkProgram(p),E.linkError(t,p,n.str(e.fragId),n.str(e.vertId),r);var g=t.getProgramParameter(p,35718);i.profile&&(e.stats.uniformsCount=g);var v=e.uniforms;for(a=0;a<g;++a)if(c=t.getActiveUniform(p,a))if(c.size>1)for(var m=0;m<c.size;++m){var y=c.name.replace("[0]","["+m+"]");u(v,new s(y,n.id(y),t.getUniformLocation(p,y),c))}else u(v,new s(c.name,n.id(c.name),t.getUniformLocation(p,c.name),c));var _=t.getProgramParameter(p,35721);i.profile&&(e.stats.attributesCount=_);var b=e.attributes;for(a=0;a<_;++a)(c=t.getActiveAttrib(p,a))&&u(b,new s(c.name,n.id(c.name),t.getAttribLocation(p,c.name),c))}return i.profile&&(r.getMaxUniformsCount=function(){var t=0;return h.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},r.getMaxAttributesCount=function(){var t=0;return h.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);V(o).forEach(e),o={},V(a).forEach(e),a={},h.forEach((function(e){t.deleteProgram(e.program)})),h.length=0,c={},r.shaderCount=0},program:function(n,i,s,u){E.command(n>=0,"missing vertex shader",s),E.command(i>=0,"missing fragment shader",s);var l=c[i];l||(l=c[i]={});var f=l[n];if(f&&(f.refCount++,!u))return f;var g=new p(i,n);return r.shaderCount++,d(g,s,u),f||(l[n]=g),h.push(g),e(g,{destroy:function(){if(g.refCount--,g.refCount<=0){t.deleteProgram(g.program);var e=h.indexOf(g);h.splice(e,1),r.shaderCount--}l[g.vertId].refCount<=0&&(t.deleteShader(a[g.vertId]),delete a[g.vertId],delete c[g.fragId][g.vertId]),Object.keys(c[g.fragId]).length||(t.deleteShader(o[g.fragId]),delete o[g.fragId],delete c[g.fragId])}})},restore:function(){o={},a={};for(var t=0;t<h.length;++t)d(h[t],null,h[t].attributes.map((function(t){return[t.location,t.name]})))},shader:l,frag:-1,vert:-1}}(i,c,h,r),S=fe(i,f,y,(function(){T.procs.poll()}),m,h,r),C=function(t,e,n,r,i){var o={rgba4:de,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};e.ext_srgb&&(o.srgba=35907),e.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),e.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach((function(t){var e=o[t];a[e]=t}));var s=0,u={};function l(t){this.id=s++,this.refCount=1,this.renderbuffer=t,this.format=de,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function c(e){var n=e.renderbuffer;E(n,"must not double destroy renderbuffer"),t.bindRenderbuffer(pe,null),t.deleteRenderbuffer(n),e.renderbuffer=null,e.refCount=0,delete u[e.id],r.renderbufferCount--}return l.prototype.decRef=function(){--this.refCount<=0&&c(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(u).forEach((function(e){t+=u[e].stats.size})),t}),{create:function(e,s){var c=new l(t.createRenderbuffer());function h(e,r){var s=0,u=0,l=de;if("object"==typeof e&&e){var f=e;if("shape"in f){var p=f.shape;E(Array.isArray(p)&&p.length>=2,"invalid renderbuffer shape"),s=0|p[0],u=0|p[1]}else"radius"in f&&(s=u=0|f.radius),"width"in f&&(s=0|f.width),"height"in f&&(u=0|f.height);"format"in f&&(E.parameter(f.format,o,"invalid renderbuffer format"),l=o[f.format])}else"number"==typeof e?(s=0|e,u="number"==typeof r?0|r:s):e?E.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(E(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||u!==c.height||l!==c.format)return h.width=c.width=s,h.height=c.height=u,c.format=l,t.bindRenderbuffer(pe,c.renderbuffer),t.renderbufferStorage(pe,l,s,u),E(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=ve(c.format,c.width,c.height)),h.format=a[c.format],h}return u[c.id]=c,r.renderbufferCount++,h(e,s),h.resize=function(e,r){var o=0|e,a=0|r||o;return o===c.width&&a===c.height||(E(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),h.width=c.width=o,h.height=c.height=a,t.bindRenderbuffer(pe,c.renderbuffer),t.renderbufferStorage(pe,c.format,o,a),E(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=ve(c.format,c.width,c.height))),h},h._reglType="renderbuffer",h._renderbuffer=c,i.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h},clear:function(){V(u).forEach(c)},restore:function(){V(u).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(pe,e.renderbuffer),t.renderbufferStorage(pe,e.format,e.width,e.height)})),t.bindRenderbuffer(pe,null)}}}(i,f,y,h,r),A=function(t,n,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],l=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&l.push("srgba"),n.ext_color_buffer_half_float&&l.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&l.push("rgba32f");var c=["uint8"];function h(t,e,n){this.target=t,this.texture=e,this.renderbuffer=n;var r=0,i=0;e?(r=e.width,i=e.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function f(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function p(t,e,n){if(t)if(t.texture){var r=t.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);E(i===e&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=t.renderbuffer._renderbuffer;E(a.width===e&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function d(e,n){n&&(n.texture?t.framebufferTexture2D(me,e,n.target,n.texture._texture.texture,0):t.framebufferRenderbuffer(me,e,ye,n.renderbuffer._renderbuffer.renderbuffer))}function g(t){var e=_e,n=null,r=null,i=t;"object"==typeof t&&(i=t.data,"target"in t&&(e=0|t.target)),E.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,E(e===_e)):"textureCube"===o?(n=i,E(e>=be&&e<34075,"invalid cube map target")):"renderbuffer"===o?(r=i,e=ye):E.raise("invalid regl object for attachment"),new h(e,n,r)}function v(t,e,n,r,a){if(n){var s=i.create2D({width:t,height:e,format:r,type:a});return s._texture.refCount=0,new h(_e,s,null)}var u=o.create({width:t,height:e,format:r});return u._renderbuffer.refCount=0,new h(ye,null,u)}function m(t){return t&&(t.texture||t.renderbuffer)}function y(t,e,n){t&&(t.texture?t.texture.resize(e,n):t.renderbuffer&&t.renderbuffer.resize(e,n),t.width=e,t.height=n)}n.oes_texture_half_float&&c.push("half float","float16"),n.oes_texture_float&&c.push("float","float32");var _=0,b={};function x(){this.id=_++,b[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function w(t){t.colorAttachments.forEach(f),f(t.depthAttachment),f(t.stencilAttachment),f(t.depthStencilAttachment)}function S(e){var n=e.framebuffer;E(n,"must not double destroy framebuffer"),t.deleteFramebuffer(n),e.framebuffer=null,a.framebufferCount--,delete b[e.id]}function C(e){var n;t.bindFramebuffer(me,e.framebuffer);var i=e.colorAttachments;for(n=0;n<i.length;++n)d(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)t.framebufferTexture2D(me,36064+n,_e,null,0);t.framebufferTexture2D(me,33306,_e,null,0),t.framebufferTexture2D(me,36096,_e,null,0),t.framebufferTexture2D(me,36128,_e,null,0),d(36096,e.depthAttachment),d(36128,e.stencilAttachment),d(33306,e.depthStencilAttachment);var o=t.checkFramebufferStatus(me);t.isContextLost()||36053===o||E.raise("framebuffer configuration not supported, status = "+Ce[o]),t.bindFramebuffer(me,s.next?s.next.framebuffer:null),s.cur=s.next,t.getError()}function A(t,i){var o=new x;function h(t,e){var i;E(s.next!==o,"can not update framebuffer which is currently in use");var a=0,f=0,d=!0,y=!0,_=null,b=!0,x="rgba",S="uint8",A=1,T=null,k=null,M=null,P=!1;if("number"==typeof t)a=0|t,f=0|e||a;else if(t){E.type(t,"object","invalid arguments for framebuffer");var I=t;if("shape"in I){var O=I.shape;E(Array.isArray(O)&&O.length>=2,"invalid shape for framebuffer"),a=O[0],f=O[1]}else"radius"in I&&(a=f=I.radius),"width"in I&&(a=I.width),"height"in I&&(f=I.height);("color"in I||"colors"in I)&&(_=I.color||I.colors,Array.isArray(_)&&E(1===_.length||n.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in I&&(A=0|I.colorCount,E(A>0,"invalid color buffer count")),"colorTexture"in I&&(b=!!I.colorTexture,x="rgba4"),"colorType"in I&&(S=I.colorType,b?(E(n.oes_texture_float||!("float"===S||"float32"===S),"you must enable OES_texture_float in order to use floating point framebuffer objects"),E(n.oes_texture_half_float||!("half float"===S||"float16"===S),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===S||"float16"===S?(E(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f"):"float"!==S&&"float32"!==S||(E(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f"),E.oneOf(S,c,"invalid color type")),"colorFormat"in I&&(x=I.colorFormat,u.indexOf(x)>=0?b=!0:l.indexOf(x)>=0?b=!1:b?E.oneOf(I.colorFormat,u,"invalid color format for texture"):E.oneOf(I.colorFormat,l,"invalid color format for renderbuffer"))),("depthTexture"in I||"depthStencilTexture"in I)&&(P=!(!I.depthTexture&&!I.depthStencilTexture),E(!P||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in I&&("boolean"==typeof I.depth?d=I.depth:(T=I.depth,y=!1)),"stencil"in I&&("boolean"==typeof I.stencil?y=I.stencil:(k=I.stencil,d=!1)),"depthStencil"in I&&("boolean"==typeof I.depthStencil?d=y=I.depthStencil:(M=I.depthStencil,d=!1,y=!1))}else a=f=1;var R=null,L=null,D=null,N=null;if(Array.isArray(_))R=_.map(g);else if(_)R=[g(_)];else for(R=new Array(A),i=0;i<A;++i)R[i]=v(a,f,b,x,S);E(n.webgl_draw_buffers||R.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),E(R.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||R[0].width,f=f||R[0].height,T?L=g(T):d&&!y&&(L=v(a,f,P,"depth","uint32")),k?D=g(k):y&&!d&&(D=v(a,f,!1,"stencil","uint8")),M?N=g(M):!T&&!k&&y&&d&&(N=v(a,f,P,"depth stencil","depth stencil")),E(!!T+!!k+!!M<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var B=null;for(i=0;i<R.length;++i)if(p(R[i],a,f),E(!R[i]||R[i].texture&&xe.indexOf(R[i].texture._texture.format)>=0||R[i].renderbuffer&&Se.indexOf(R[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),R[i]&&R[i].texture){var z=we[R[i].texture._texture.format]*Ee[R[i].texture._texture.type];null===B?B=z:E(B===z,"all color attachments much have the same number of bits per pixel.")}return p(L,a,f),E(!L||L.texture&&6402===L.texture._texture.format||L.renderbuffer&&33189===L.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),p(D,a,f),E(!D||D.renderbuffer&&36168===D.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),p(N,a,f),E(!N||N.texture&&34041===N.texture._texture.format||N.renderbuffer&&34041===N.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),w(o),o.width=a,o.height=f,o.colorAttachments=R,o.depthAttachment=L,o.stencilAttachment=D,o.depthStencilAttachment=N,h.color=R.map(m),h.depth=m(L),h.stencil=m(D),h.depthStencil=m(N),h.width=o.width,h.height=o.height,C(o),h}return a.framebufferCount++,h(t,i),e(h,{resize:function(t,e){E(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|t,1),r=Math.max(0|e||n,1);if(n===o.width&&r===o.height)return h;for(var i=o.colorAttachments,a=0;a<i.length;++a)y(i[a],n,r);return y(o.depthAttachment,n,r),y(o.stencilAttachment,n,r),y(o.depthStencilAttachment,n,r),o.width=h.width=n,o.height=h.height=r,C(o),h},_reglType:"framebuffer",_framebuffer:o,destroy:function(){S(o),w(o)},use:function(t){s.setFBO({framebuffer:h},t)}})}return e(s,{getFramebuffer:function(t){if("function"==typeof t&&"framebuffer"===t._reglType){var e=t._framebuffer;if(e instanceof x)return e}return null},create:A,createCube:function(t){var o=Array(6);function a(t){var r;E(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var l,h={color:null},f=0,p=null,d="rgba",g="uint8",v=1;if("number"==typeof t)f=0|t;else if(t){E.type(t,"object","invalid arguments for framebuffer");var m=t;if("shape"in m){var y=m.shape;E(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),E(y[0]===y[1],"cube framebuffer must be square"),f=y[0]}else"radius"in m&&(f=0|m.radius),"width"in m?(f=0|m.width,"height"in m&&E(m.height===f,"must be square")):"height"in m&&(f=0|m.height);("color"in m||"colors"in m)&&(p=m.color||m.colors,Array.isArray(p)&&E(1===p.length||n.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in m&&(v=0|m.colorCount,E(v>0,"invalid color buffer count")),"colorType"in m&&(E.oneOf(m.colorType,c,"invalid color type"),g=m.colorType),"colorFormat"in m&&(d=m.colorFormat,E.oneOf(m.colorFormat,u,"invalid color format for texture"))),"depth"in m&&(h.depth=m.depth),"stencil"in m&&(h.stencil=m.stencil),"depthStencil"in m&&(h.depthStencil=m.depthStencil)}else f=1;if(p)if(Array.isArray(p))for(l=[],r=0;r<p.length;++r)l[r]=p[r];else l=[p];else{l=Array(v);var _={radius:f,format:d,type:g};for(r=0;r<v;++r)l[r]=i.createCube(_)}for(h.color=Array(l.length),r=0;r<l.length;++r){var b=l[r];E("function"==typeof b&&"textureCube"===b._reglType,"invalid cube map"),f=f||b.width,E(b.width===f&&b.height===f,"invalid cube map shape"),h.color[r]={target:be,data:l[r]}}for(r=0;r<6;++r){for(var x=0;x<l.length;++x)h.color[x].target=be+r;r>0&&(h.depth=o[0].depth,h.stencil=o[0].stencil,h.depthStencil=o[0].depthStencil),o[r]?o[r](h):o[r]=A(h)}return e(a,{width:f,height:f,color:l})}return a(t),e(a,{faces:o,resize:function(t){var e,n=0|t;if(E(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(e=0;e<i.length;++e)i[e].resize(n);for(e=0;e<6;++e)o[e].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(t){t.destroy()}))}})},clear:function(){V(b).forEach(S)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,V(b).forEach((function(e){e.framebuffer=t.createFramebuffer(),C(e)}))}})}(i,f,y,S,C,h),T=or(i,c,f,y,_,x,0,A,{},b,w,{elements:null,primitive:4,count:-1,offset:0,instances:-1},m,p,r),k=Me(i,A,T.procs.poll,m,o,f,y),O=T.next,R=i.canvas,D=[],N=[],B=[],W=[r.onDestroy],H=null;function X(){if(0===D.length)return p&&p.update(),void(H=null);H=P.next(X),yt();for(var t=D.length-1;t>=0;--t){var e=D[t];e&&e(m,null,0)}i.flush(),p&&p.update()}function Y(){!H&&D.length>0&&(H=P.next(X))}function ct(){H&&(P.cancel(X),H=null)}function ht(t){t.preventDefault(),a=!0,ct(),N.forEach((function(t){t()}))}function ft(t){i.getError(),a=!1,s.restore(),w.restore(),_.restore(),S.restore(),C.restore(),A.restore(),b.restore(),p&&p.restore(),T.procs.refresh(),Y(),B.forEach((function(t){t()}))}function pt(t){function n(t,e){var n={},r={};return Object.keys(t).forEach((function(i){var o=t[i];if(M.isDynamic(o))r[i]=M.unbox(o,i);else{if(e&&Array.isArray(o))for(var a=0;a<o.length;++a)if(M.isDynamic(o[a]))return void(r[i]=M.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}E(!!t,"invalid args to regl({...})"),E.type(t,"object","invalid args to regl({...})");var r=n(t.context||{},!0),i=n(t.uniforms||{},!0),o=n(t.attributes||{},!1),s=n(function(t){var n=e({},t);function r(t){if(t in n){var e=n[t];delete n[t],Object.keys(e).forEach((function(r){n[t+"."+r]=e[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in t&&(n.vao=t.vao),n}(t),!1),u={gpuTime:0,cpuTime:0,count:0},l=T.compile(s,o,i,r,u),c=l.draw,h=l.batch,f=l.scope,p=[];return e((function(t,e){var n;if(a&&E.raise("context lost"),"function"==typeof t)return f.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(n=0;n<t;++n)f.call(this,null,e,n);else{if(!Array.isArray(t))return f.call(this,t,e,0);for(n=0;n<t.length;++n)f.call(this,t[n],e,n)}else if("number"==typeof t){if(t>0)return h.call(this,function(t){for(;p.length<t;)p.push(null);return p}(0|t),0|t)}else{if(!Array.isArray(t))return c.call(this,t);if(t.length)return h.call(this,t,t.length)}}),{stats:u,destroy:function(){l.destroy()}})}R&&(R.addEventListener(sr,ht,!1),R.addEventListener(ur,ft,!1));var dt=A.setFBO=pt({framebuffer:M.define.call(null,1,"framebuffer")});function gt(t,e){var n=0;T.procs.poll();var r=e.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in e&&(i.clearDepth(+e.depth),n|=256),"stencil"in e&&(i.clearStencil(0|e.stencil),n|=1024),E(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function vt(t){return E.type(t,"function","regl.frame() callback must be a function"),D.push(t),Y(),{cancel:function(){var e=lr(D,t);E(e>=0,"cannot cancel a frame twice"),D[e]=function t(){var e=lr(D,t);D[e]=D[D.length-1],D.length-=1,D.length<=0&&ct()}}}}function mt(){var t=O.viewport,e=O.scissor_box;t[0]=t[1]=e[0]=e[1]=0,m.viewportWidth=m.framebufferWidth=m.drawingBufferWidth=t[2]=e[2]=i.drawingBufferWidth,m.viewportHeight=m.framebufferHeight=m.drawingBufferHeight=t[3]=e[3]=i.drawingBufferHeight}function yt(){m.tick+=1,m.time=bt(),mt(),T.procs.poll()}function _t(){S.refresh(),mt(),T.procs.refresh(),p&&p.update()}function bt(){return(I()-d)/1e3}_t();var xt=e(pt,{clear:function(t){if(E("object"==typeof t&&t,"regl.clear() takes an object as input"),"framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var n=0;n<6;++n)dt(e({framebuffer:t.framebuffer.faces[n]},t),gt);else dt(t,gt);else gt(0,t)},prop:M.define.bind(null,1),context:M.define.bind(null,2),this:M.define.bind(null,3),draw:pt({}),buffer:function(t){return _.create(t,34962,!1,!1)},elements:function(t){return x.create(t,!1)},texture:S.create2D,cube:S.createCube,renderbuffer:C.create,framebuffer:A.create,framebufferCube:A.createCube,vao:b.createVAO,attributes:o,frame:vt,on:function(t,e){var n;switch(E.type(e,"function","listener callback must be a function"),t){case"frame":return vt(e);case"lost":n=N;break;case"restore":n=B;break;case"destroy":n=W;break;default:E.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(e),{cancel:function(){for(var t=0;t<n.length;++t)if(n[t]===e)return n[t]=n[n.length-1],void n.pop()}}},limits:y,hasExtension:function(t){return y.extensions.indexOf(t.toLowerCase())>=0},read:k,destroy:function(){D.length=0,ct(),R&&(R.removeEventListener(sr,ht),R.removeEventListener(ur,ft)),w.clear(),A.clear(),C.clear(),S.clear(),x.clear(),_.clear(),b.clear(),p&&p.clear(),W.forEach((function(t){t()}))},_gl:i,_refresh:_t,poll:function(){yt(),p&&p.update()},now:bt,stats:h});return r.onDone(null,xt),xt}}()},53:(t,e)=>{"use strict";var n,r,i,o;if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var s=Date,u=s.now();e.unstable_now=function(){return s.now()-u}}if("undefined"==typeof window||"function"!=typeof MessageChannel){var l=null,c=null,h=function(){if(null!==l)try{var t=e.unstable_now();l(!0,t),l=null}catch(t){throw setTimeout(h,0),t}};n=function(t){null!==l?setTimeout(n,0,t):(l=t,setTimeout(h,0))},r=function(t,e){c=setTimeout(t,e)},i=function(){clearTimeout(c)},e.unstable_shouldYield=function(){return!1},o=e.unstable_forceFrameRate=function(){}}else{var f=window.setTimeout,p=window.clearTimeout;if("undefined"!=typeof console){var d=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!=typeof d&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var g=!1,v=null,m=-1,y=5,_=0;e.unstable_shouldYield=function(){return e.unstable_now()>=_},o=function(){},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):y=0<t?Math.floor(1e3/t):5};var b=new MessageChannel,x=b.port2;b.port1.onmessage=function(){if(null!==v){var t=e.unstable_now();_=t+y;try{v(!0,t)?x.postMessage(null):(g=!1,v=null)}catch(t){throw x.postMessage(null),t}}else g=!1},n=function(t){v=t,g||(g=!0,x.postMessage(null))},r=function(t,n){m=f((function(){t(e.unstable_now())}),n)},i=function(){p(m),m=-1}}function w(t,e){var n=t.length;t.push(e);t:for(;;){var r=n-1>>>1,i=t[r];if(!(void 0!==i&&0<C(i,e)))break t;t[r]=e,t[n]=i,n=r}}function E(t){return void 0===(t=t[0])?null:t}function S(t){var e=t[0];if(void 0!==e){var n=t.pop();if(n!==e){t[0]=n;t:for(var r=0,i=t.length;r<i;){var o=2*(r+1)-1,a=t[o],s=o+1,u=t[s];if(void 0!==a&&0>C(a,n))void 0!==u&&0>C(u,a)?(t[r]=u,t[s]=n,r=s):(t[r]=a,t[o]=n,r=o);else{if(!(void 0!==u&&0>C(u,n)))break t;t[r]=u,t[s]=n,r=s}}}return e}return null}function C(t,e){var n=t.sortIndex-e.sortIndex;return 0!==n?n:t.id-e.id}var A=[],T=[],k=1,M=null,P=3,I=!1,O=!1,R=!1;function L(t){for(var e=E(T);null!==e;){if(null===e.callback)S(T);else{if(!(e.startTime<=t))break;S(T),e.sortIndex=e.expirationTime,w(A,e)}e=E(T)}}function D(t){if(R=!1,L(t),!O)if(null!==E(A))O=!0,n(N);else{var e=E(T);null!==e&&r(D,e.startTime-t)}}function N(t,n){O=!1,R&&(R=!1,i()),I=!0;var o=P;try{for(L(n),M=E(A);null!==M&&(!(M.expirationTime>n)||t&&!e.unstable_shouldYield());){var a=M.callback;if("function"==typeof a){M.callback=null,P=M.priorityLevel;var s=a(M.expirationTime<=n);n=e.unstable_now(),"function"==typeof s?M.callback=s:M===E(A)&&S(A),L(n)}else S(A);M=E(A)}if(null!==M)var u=!0;else{var l=E(T);null!==l&&r(D,l.startTime-n),u=!1}return u}finally{M=null,P=o,I=!1}}var B=o;e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){O||I||(O=!0,n(N))},e.unstable_getCurrentPriorityLevel=function(){return P},e.unstable_getFirstCallbackNode=function(){return E(A)},e.unstable_next=function(t){switch(P){case 1:case 2:case 3:var e=3;break;default:e=P}var n=P;P=e;try{return t()}finally{P=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=B,e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=P;P=t;try{return e()}finally{P=n}},e.unstable_scheduleCallback=function(t,o,a){var s=e.unstable_now();switch(a="object"==typeof a&&null!==a&&"number"==typeof(a=a.delay)&&0<a?s+a:s,t){case 1:var u=-1;break;case 2:u=250;break;case 5:u=1073741823;break;case 4:u=1e4;break;default:u=5e3}return t={id:k++,callback:o,priorityLevel:t,startTime:a,expirationTime:u=a+u,sortIndex:-1},a>s?(t.sortIndex=a,w(T,t),null===E(A)&&t===E(T)&&(R?i():R=!0,r(D,a-s))):(t.sortIndex=u,w(A,t),O||I||(O=!0,n(N))),t},e.unstable_wrapCallback=function(t){var e=P;return function(){var n=P;P=e;try{return t.apply(this,arguments)}finally{P=n}}}},3840:(t,e,n)=>{"use strict";t.exports=n(53)},6851:(t,e,n)=>{"use strict";var r=n(9594),i=Array.prototype.concat,o=Array.prototype.slice,a=t.exports=function(t){for(var e=[],n=0,a=t.length;n<a;n++){var s=t[n];r(s)?e=i.call(e,o.call(s)):e.push(s)}return e};a.wrap=function(t){return function(){return t(a(arguments))}}},9594:t=>{t.exports=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))}},9848:function(t){t.exports=function(){"use strict";function t(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;e(n,r,u,o,a,s%2),t(n,r,i,o,u-1,s+1),t(n,r,i,u+1,a,s+1)}}function e(t,r,i,o,a,s){for(;a>o;){if(a-o>600){var u=a-o+1,l=i-o+1,c=Math.log(u),h=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*h*(u-h)/u)*(l-u/2<0?-1:1);e(t,r,i,Math.max(o,Math.floor(i-l*h/u+f)),Math.min(a,Math.floor(i+(u-l)*h/u+f)),s)}var p=r[2*i+s],d=o,g=a;for(n(t,r,o,i),r[2*a+s]>p&&n(t,r,o,a);d<g;){for(n(t,r,d,g),d++,g--;r[2*d+s]<p;)d++;for(;r[2*g+s]>p;)g--}r[2*o+s]===p?n(t,r,o,g):n(t,r,++g,a),g<=i&&(o=g+1),i<=g&&(a=g-1)}}function n(t,e,n,i){r(t,n,i),r(e,2*n,2*i),r(e,2*n+1,2*i+1)}function r(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function i(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}var o=function(t){return t[0]},a=function(t){return t[1]},s=function(e,n,r,i,s){void 0===n&&(n=o),void 0===r&&(r=a),void 0===i&&(i=64),void 0===s&&(s=Float64Array),this.nodeSize=i,this.points=e;for(var u=e.length<65536?Uint16Array:Uint32Array,l=this.ids=new u(e.length),c=this.coords=new s(2*e.length),h=0;h<e.length;h++)l[h]=h,c[2*h]=n(e[h]),c[2*h+1]=r(e[h]);t(l,c,i,0,l.length-1,0)};s.prototype.range=function(t,e,n,r){return function(t,e,n,r,i,o,a){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var h=l.pop(),f=l.pop(),p=l.pop();if(f-p<=a)for(var d=p;d<=f;d++)s=e[2*d],u=e[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(t[d]);else{var g=Math.floor((p+f)/2);s=e[2*g],u=e[2*g+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(t[g]);var v=(h+1)%2;(0===h?n<=s:r<=u)&&(l.push(p),l.push(g-1),l.push(v)),(0===h?i>=s:o>=u)&&(l.push(g+1),l.push(f),l.push(v))}}return c}(this.ids,this.coords,t,e,n,r,this.nodeSize)},s.prototype.within=function(t,e,n){return function(t,e,n,r,o,a){for(var s=[0,t.length-1,0],u=[],l=o*o;s.length;){var c=s.pop(),h=s.pop(),f=s.pop();if(h-f<=a)for(var p=f;p<=h;p++)i(e[2*p],e[2*p+1],n,r)<=l&&u.push(t[p]);else{var d=Math.floor((f+h)/2),g=e[2*d],v=e[2*d+1];i(g,v,n,r)<=l&&u.push(t[d]);var m=(c+1)%2;(0===c?n-o<=g:r-o<=v)&&(s.push(f),s.push(d-1),s.push(m)),(0===c?n+o>=g:r+o>=v)&&(s.push(d+1),s.push(h),s.push(m))}}return u}(this.ids,this.coords,t,e,n,this.nodeSize)};var u,l={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},c=Math.fround||(u=new Float32Array(1),function(t){return u[0]=+t,u[0]}),h=function(t){this.options=y(Object.create(l),t),this.trees=new Array(this.options.maxZoom+1)};function f(t,e,n,r,i){return{x:c(t),y:c(e),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function p(t,e){var n=t.geometry.coordinates,r=n[0],i=n[1];return{x:c(v(r)),y:c(m(i)),zoom:1/0,index:e,parentId:-1}}function d(t){return{type:"Feature",id:t.id,properties:g(t),geometry:{type:"Point",coordinates:[(r=t.x,360*(r-.5)),(e=t.y,n=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var e,n,r}function g(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return y(y({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function v(t){return t/360+.5}function m(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function y(t,e){for(var n in e)t[n]=e[n];return t}function _(t){return t.x}function b(t){return t.y}return h.prototype.load=function(t){var e=this.options,n=e.log,r=e.minZoom,i=e.maxZoom,o=e.nodeSize;n&&console.time("total time");var a="prepare "+t.length+" points";n&&console.time(a),this.points=t;for(var u=[],l=0;l<t.length;l++)t[l].geometry&&u.push(p(t[l],l));this.trees[i+1]=new s(u,_,b,o,Float32Array),n&&console.timeEnd(a);for(var c=i;c>=r;c--){var h=+Date.now();u=this._cluster(u,c),this.trees[c]=new s(u,_,b,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",c,u.length,+Date.now()-h)}return n&&console.timeEnd("total time"),this},h.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,h=u.range(v(n),m(o),v(i),m(r));c<h.length;c+=1){var f=h[c],p=u.points[f];l.push(p.numPoints?d(p):this.points[p.index])}return l},h.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[e];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=l[u],h=i.points[c];h.parentId===t&&s.push(h.numPoints?d(h):this.points[h.index])}if(0===s.length)throw new Error(r);return s},h.prototype.getLeaves=function(t,e,n){e=e||10,n=n||0;var r=[];return this._appendLeaves(r,t,e,n,0),r},h.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,l=(n+1+s)/i,c={features:[]};return this._addTileFeatures(r.range((e-s)/i,u,(e+1+s)/i,l),r.points,e,n,i,c),0===e&&this._addTileFeatures(r.range(1-s/i,u,1,l),r.points,i,n,i,c),e===i-1&&this._addTileFeatures(r.range(0,u,s/i,l),r.points,-1,n,i,c),c.features.length?c:null},h.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},h.prototype._appendLeaves=function(t,e,n,r,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,n,r,i):i<r?i++:t.push(s),t.length===n)break}return i},h.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],l=u.numPoints,c=void 0,h=void 0,f=void 0;if(l)c=g(u),h=u.x,f=u.y;else{var p=this.points[u.index];c=p.properties,h=v(p.geometry.coordinates[0]),f=m(p.geometry.coordinates[1])}var d={type:1,geometry:[[Math.round(this.options.extent*(h*i-n)),Math.round(this.options.extent*(f*i-r))]],tags:c},y=void 0;l?y=u.id:this.options.generateId?y=u.index:this.points[u.index].id&&(y=this.points[u.index].id),void 0!==y&&(d.id=y),o.features.push(d)}},h.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},h.prototype._cluster=function(t,e){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,u=i/(o*Math.pow(2,e)),l=0;l<t.length;l++){var c=t[l];if(!(c.zoom<=e)){c.zoom=e;for(var h=this.trees[e+1],p=h.within(c.x,c.y,u),d=c.numPoints||1,g=d,v=0,m=p;v<m.length;v+=1){var y=m[v],_=h.points[y];_.zoom>e&&(g+=_.numPoints||1)}if(g>d&&g>=s){for(var b=c.x*d,x=c.y*d,w=a&&d>1?this._map(c,!0):null,E=(l<<5)+(e+1)+this.points.length,S=0,C=p;S<C.length;S+=1){var A=C[S],T=h.points[A];if(!(T.zoom<=e)){T.zoom=e;var k=T.numPoints||1;b+=T.x*k,x+=T.y*k,T.parentId=E,a&&(w||(w=this._map(c,!0)),a(w,this._map(T)))}}c.parentId=E,n.push(f(b/g,x/g,E,g,w))}else if(n.push(c),g>1)for(var M=0,P=p;M<P.length;M+=1){var I=P[M],O=h.points[I];O.zoom<=e||(O.zoom=e,n.push(O))}}}return n},h.prototype._getOriginId=function(t){return t-this.points.length>>5},h.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},h.prototype._map=function(t,e){if(t.numPoints)return e?y({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?y({},r):r},h}()},7621:(t,e,n)=>{var r;!function(i){var o=/^\s+/,a=/\s+$/,s=0,u=i.round,l=i.min,c=i.max,h=i.random;function f(t,e){if(e=e||{},(t=t||"")instanceof f)return t;if(!(this instanceof f))return new f(t,e);var n=function(t){var e,n,r,s={r:0,g:0,b:0},u=1,h=null,f=null,p=null,d=!1,g=!1;return"string"==typeof t&&(t=function(t){t=t.replace(o,"").replace(a,"").toLowerCase();var e,n=!1;if(P[t])t=P[t],n=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};return(e=G.rgb.exec(t))?{r:e[1],g:e[2],b:e[3]}:(e=G.rgba.exec(t))?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=G.hsl.exec(t))?{h:e[1],s:e[2],l:e[3]}:(e=G.hsla.exec(t))?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=G.hsv.exec(t))?{h:e[1],s:e[2],v:e[3]}:(e=G.hsva.exec(t))?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=G.hex8.exec(t))?{r:D(e[1]),g:D(e[2]),b:D(e[3]),a:F(e[4]),format:n?"name":"hex8"}:(e=G.hex6.exec(t))?{r:D(e[1]),g:D(e[2]),b:D(e[3]),format:n?"name":"hex"}:(e=G.hex4.exec(t))?{r:D(e[1]+""+e[1]),g:D(e[2]+""+e[2]),b:D(e[3]+""+e[3]),a:F(e[4]+""+e[4]),format:n?"name":"hex8"}:!!(e=G.hex3.exec(t))&&{r:D(e[1]+""+e[1]),g:D(e[2]+""+e[2]),b:D(e[3]+""+e[3]),format:n?"name":"hex"}}(t)),"object"==typeof t&&(V(t.r)&&V(t.g)&&V(t.b)?(e=t.r,n=t.g,r=t.b,s={r:255*R(e,255),g:255*R(n,255),b:255*R(r,255)},d=!0,g="%"===String(t.r).substr(-1)?"prgb":"rgb"):V(t.h)&&V(t.s)&&V(t.v)?(h=B(t.s),f=B(t.v),s=function(t,e,n){t=6*R(t,360),e=R(e,100),n=R(n,100);var r=i.floor(t),o=t-r,a=n*(1-e),s=n*(1-o*e),u=n*(1-(1-o)*e),l=r%6;return{r:255*[n,s,a,a,u,n][l],g:255*[u,n,n,s,a,a][l],b:255*[a,a,u,n,n,s][l]}}(t.h,h,f),d=!0,g="hsv"):V(t.h)&&V(t.s)&&V(t.l)&&(h=B(t.s),p=B(t.l),s=function(t,e,n){var r,i,o;function a(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}if(t=R(t,360),e=R(e,100),n=R(n,100),0===e)r=i=o=n;else{var s=n<.5?n*(1+e):n+e-n*e,u=2*n-s;r=a(u,s,t+1/3),i=a(u,s,t),o=a(u,s,t-1/3)}return{r:255*r,g:255*i,b:255*o}}(t.h,h,p),d=!0,g="hsl"),t.hasOwnProperty("a")&&(u=t.a)),u=O(u),{ok:d,format:t.format||g,r:l(255,c(s.r,0)),g:l(255,c(s.g,0)),b:l(255,c(s.b,0)),a:u}}(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=u(100*this._a)/100,this._format=e.format||n.format,this._gradientType=e.gradientType,this._r<1&&(this._r=u(this._r)),this._g<1&&(this._g=u(this._g)),this._b<1&&(this._b=u(this._b)),this._ok=n.ok,this._tc_id=s++}function p(t,e,n){t=R(t,255),e=R(e,255),n=R(n,255);var r,i,o=c(t,e,n),a=l(t,e,n),s=(o+a)/2;if(o==a)r=i=0;else{var u=o-a;switch(i=s>.5?u/(2-o-a):u/(o+a),o){case t:r=(e-n)/u+(e<n?6:0);break;case e:r=(n-t)/u+2;break;case n:r=(t-e)/u+4}r/=6}return{h:r,s:i,l:s}}function d(t,e,n){t=R(t,255),e=R(e,255),n=R(n,255);var r,i,o=c(t,e,n),a=l(t,e,n),s=o,u=o-a;if(i=0===o?0:u/o,o==a)r=0;else{switch(o){case t:r=(e-n)/u+(e<n?6:0);break;case e:r=(n-t)/u+2;break;case n:r=(t-e)/u+4}r/=6}return{h:r,s:i,v:s}}function g(t,e,n,r){var i=[N(u(t).toString(16)),N(u(e).toString(16)),N(u(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function v(t,e,n,r){return[N(z(r)),N(u(t).toString(16)),N(u(e).toString(16)),N(u(n).toString(16))].join("")}function m(t,e){e=0===e?0:e||10;var n=f(t).toHsl();return n.s-=e/100,n.s=L(n.s),f(n)}function y(t,e){e=0===e?0:e||10;var n=f(t).toHsl();return n.s+=e/100,n.s=L(n.s),f(n)}function _(t){return f(t).desaturate(100)}function b(t,e){e=0===e?0:e||10;var n=f(t).toHsl();return n.l+=e/100,n.l=L(n.l),f(n)}function x(t,e){e=0===e?0:e||10;var n=f(t).toRgb();return n.r=c(0,l(255,n.r-u(-e/100*255))),n.g=c(0,l(255,n.g-u(-e/100*255))),n.b=c(0,l(255,n.b-u(-e/100*255))),f(n)}function w(t,e){e=0===e?0:e||10;var n=f(t).toHsl();return n.l-=e/100,n.l=L(n.l),f(n)}function E(t,e){var n=f(t).toHsl(),r=(n.h+e)%360;return n.h=r<0?360+r:r,f(n)}function S(t){var e=f(t).toHsl();return e.h=(e.h+180)%360,f(e)}function C(t){var e=f(t).toHsl(),n=e.h;return[f(t),f({h:(n+120)%360,s:e.s,l:e.l}),f({h:(n+240)%360,s:e.s,l:e.l})]}function A(t){var e=f(t).toHsl(),n=e.h;return[f(t),f({h:(n+90)%360,s:e.s,l:e.l}),f({h:(n+180)%360,s:e.s,l:e.l}),f({h:(n+270)%360,s:e.s,l:e.l})]}function T(t){var e=f(t).toHsl(),n=e.h;return[f(t),f({h:(n+72)%360,s:e.s,l:e.l}),f({h:(n+216)%360,s:e.s,l:e.l})]}function k(t,e,n){e=e||6,n=n||30;var r=f(t).toHsl(),i=360/n,o=[f(t)];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,o.push(f(r));return o}function M(t,e){e=e||6;for(var n=f(t).toHsv(),r=n.h,i=n.s,o=n.v,a=[],s=1/e;e--;)a.push(f({h:r,s:i,v:o})),o=(o+s)%1;return a}f.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,e,n,r=this.toRgb();return t=r.r/255,e=r.g/255,n=r.b/255,.2126*(t<=.03928?t/12.92:i.pow((t+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:i.pow((e+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:i.pow((n+.055)/1.055,2.4))},setAlpha:function(t){return this._a=O(t),this._roundA=u(100*this._a)/100,this},toHsv:function(){var t=d(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=d(this._r,this._g,this._b),e=u(360*t.h),n=u(100*t.s),r=u(100*t.v);return 1==this._a?"hsv("+e+", "+n+"%, "+r+"%)":"hsva("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var t=p(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=p(this._r,this._g,this._b),e=u(360*t.h),n=u(100*t.s),r=u(100*t.l);return 1==this._a?"hsl("+e+", "+n+"%, "+r+"%)":"hsla("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(t){return g(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return function(t,e,n,r,i){var o=[N(u(t).toString(16)),N(u(e).toString(16)),N(u(n).toString(16)),N(z(r))];return i&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:u(this._r),g:u(this._g),b:u(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+u(this._r)+", "+u(this._g)+", "+u(this._b)+")":"rgba("+u(this._r)+", "+u(this._g)+", "+u(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:u(100*R(this._r,255))+"%",g:u(100*R(this._g,255))+"%",b:u(100*R(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+u(100*R(this._r,255))+"%, "+u(100*R(this._g,255))+"%, "+u(100*R(this._b,255))+"%)":"rgba("+u(100*R(this._r,255))+"%, "+u(100*R(this._g,255))+"%, "+u(100*R(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(I[g(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+v(this._r,this._g,this._b,this._a),n=e,r=this._gradientType?"GradientType = 1, ":"";if(t){var i=f(t);n="#"+v(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+e+",endColorstr="+n+")"},toString:function(t){var e=!!t;t=t||this._format;var n=!1,r=this._a<1&&this._a>=0;return e||!r||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"hex4"!==t&&"hex8"!==t&&"name"!==t?("rgb"===t&&(n=this.toRgbString()),"prgb"===t&&(n=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(n=this.toHexString()),"hex3"===t&&(n=this.toHexString(!0)),"hex4"===t&&(n=this.toHex8String(!0)),"hex8"===t&&(n=this.toHex8String()),"name"===t&&(n=this.toName()),"hsl"===t&&(n=this.toHslString()),"hsv"===t&&(n=this.toHsvString()),n||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},clone:function(){return f(this.toString())},_applyModification:function(t,e){var n=t.apply(null,[this].concat([].slice.call(e)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(b,arguments)},brighten:function(){return this._applyModification(x,arguments)},darken:function(){return this._applyModification(w,arguments)},desaturate:function(){return this._applyModification(m,arguments)},saturate:function(){return this._applyModification(y,arguments)},greyscale:function(){return this._applyModification(_,arguments)},spin:function(){return this._applyModification(E,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(k,arguments)},complement:function(){return this._applyCombination(S,arguments)},monochromatic:function(){return this._applyCombination(M,arguments)},splitcomplement:function(){return this._applyCombination(T,arguments)},triad:function(){return this._applyCombination(C,arguments)},tetrad:function(){return this._applyCombination(A,arguments)}},f.fromRatio=function(t,e){if("object"==typeof t){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]="a"===r?t[r]:B(t[r]));t=n}return f(t,e)},f.equals=function(t,e){return!(!t||!e)&&f(t).toRgbString()==f(e).toRgbString()},f.random=function(){return f.fromRatio({r:h(),g:h(),b:h()})},f.mix=function(t,e,n){n=0===n?0:n||50;var r=f(t).toRgb(),i=f(e).toRgb(),o=n/100;return f({r:(i.r-r.r)*o+r.r,g:(i.g-r.g)*o+r.g,b:(i.b-r.b)*o+r.b,a:(i.a-r.a)*o+r.a})},f.readability=function(t,e){var n=f(t),r=f(e);return(i.max(n.getLuminance(),r.getLuminance())+.05)/(i.min(n.getLuminance(),r.getLuminance())+.05)},f.isReadable=function(t,e,n){var r,i,o,a,s,u=f.readability(t,e);switch(i=!1,(o=n,"AA"!==(a=((o=o||{level:"AA",size:"small"}).level||"AA").toUpperCase())&&"AAA"!==a&&(a="AA"),"small"!==(s=(o.size||"small").toLowerCase())&&"large"!==s&&(s="small"),r={level:a,size:s}).level+r.size){case"AAsmall":case"AAAlarge":i=u>=4.5;break;case"AAlarge":i=u>=3;break;case"AAAsmall":i=u>=7}return i},f.mostReadable=function(t,e,n){var r,i,o,a,s=null,u=0;i=(n=n||{}).includeFallbackColors,o=n.level,a=n.size;for(var l=0;l<e.length;l++)(r=f.readability(t,e[l]))>u&&(u=r,s=f(e[l]));return f.isReadable(t,s,{level:o,size:a})||!i?s:(n.includeFallbackColors=!1,f.mostReadable(t,["#fff","#000"],n))};var P=f.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},I=f.hexNames=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}(P);function O(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function R(t,e){(function(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)})(t)&&(t="100%");var n=function(t){return"string"==typeof t&&-1!=t.indexOf("%")}(t);return t=l(e,c(0,parseFloat(t))),n&&(t=parseInt(t*e,10)/100),i.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function L(t){return l(1,c(0,t))}function D(t){return parseInt(t,16)}function N(t){return 1==t.length?"0"+t:""+t}function B(t){return t<=1&&(t=100*t+"%"),t}function z(t){return i.round(255*parseFloat(t)).toString(16)}function F(t){return D(t)/255}var Z,j,U,G=(j="[\\s|\\(]+("+(Z="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+Z+")[,|\\s]+("+Z+")\\s*\\)?",U="[\\s|\\(]+("+Z+")[,|\\s]+("+Z+")[,|\\s]+("+Z+")[,|\\s]+("+Z+")\\s*\\)?",{CSS_UNIT:new RegExp(Z),rgb:new RegExp("rgb"+j),rgba:new RegExp("rgba"+U),hsl:new RegExp("hsl"+j),hsla:new RegExp("hsla"+U),hsv:new RegExp("hsv"+j),hsva:new RegExp("hsva"+U),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function V(t){return!!G.CSS_UNIT.exec(t)}t.exports?t.exports=f:void 0===(r=function(){return f}.call(e,n,e,t))||(t.exports=r)}(Math)},655:(t,e,n)=>{"use strict";n.r(e),n.d(e,{__extends:()=>i,__assign:()=>o,__rest:()=>a,__decorate:()=>s,__param:()=>u,__metadata:()=>l,__awaiter:()=>c,__generator:()=>h,__createBinding:()=>f,__exportStar:()=>p,__values:()=>d,__read:()=>g,__spread:()=>v,__spreadArrays:()=>m,__spreadArray:()=>y,__await:()=>_,__asyncGenerator:()=>b,__asyncDelegator:()=>x,__asyncValues:()=>w,__makeTemplateObject:()=>E,__importStar:()=>C,__importDefault:()=>A,__classPrivateFieldGet:()=>T,__classPrivateFieldSet:()=>k});var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)};function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},o.apply(this,arguments)};function a(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function s(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function u(t,e){return function(n,r){e(n,r,t)}}function l(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function h(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var f=Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]};function p(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||f(e,t,n)}function d(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function v(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(g(arguments[e]));return t}function m(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function y(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function _(t){return this instanceof _?(this.v=t,this):new _(t)}function b(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){o.push([t,e,n,r])>1||s(t,e)}))})}function s(t,e){try{(n=i[t](e)).value instanceof _?Promise.resolve(n.value.v).then(u,l):c(o[0][2],n)}catch(t){c(o[0][3],t)}var n}function u(t){s("next",t)}function l(t){s("throw",t)}function c(t,e){t(e),o.shift(),o.length&&s(o[0][0],o[0][1])}}function x(t){var e,n;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,i){e[r]=t[r]?function(e){return(n=!n)?{value:_(t[r](e)),done:"return"===r}:i?i(e):e}:i}}function w(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=d(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){!function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)}(r,i,(e=t[n](e)).done,e.value)}))}}}function E(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var S=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e};function C(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&f(e,t,n);return S(e,t),e}function A(t){return t&&t.__esModule?t:{default:t}}function T(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)}function k(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n}},5752:t=>{t.exports.RADIUS=6378137,t.exports.FLATTENING=1/298.257223563,t.exports.POLAR_RADIUS=6356752.3142},2575:(t,e,n)=>{t.exports=n},3229:(t,e,n)=>{"use strict";function r(t,e,n,r,i){var o={};return Object.keys(r).forEach((function(t){o[t]=r[t]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(t,e,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(t,e,o),o=null),o}n.d(e,{Z:()=>r})},907:(t,e,n)=>{"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}n.d(e,{Z:()=>r})},7326:(t,e,n)=>{"use strict";function r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.d(e,{Z:()=>r})},5861:(t,e,n)=>{"use strict";function r(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function i(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var a=t.apply(e,n);function s(t){r(a,i,o,s,u,"next",t)}function u(t){r(a,i,o,s,u,"throw",t)}s(void 0)}))}}n.d(e,{Z:()=>i})},5671:(t,e,n)=>{"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,{Z:()=>r})},3144:(t,e,n)=>{"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}n.d(e,{Z:()=>i})},4942:(t,e,n)=>{"use strict";function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,{Z:()=>r})},1120:(t,e,n)=>{"use strict";function r(t){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(t)}n.d(e,{Z:()=>r})},136:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(9611);function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&(0,r.Z)(t,e)}},3269:(t,e,n)=>{"use strict";function r(t,e,n,r){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}n.d(e,{Z:()=>r})},2963:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var r=n(1002),i=n(7326);function o(t,e){if(e&&("object"===(0,r.Z)(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return(0,i.Z)(t)}},9611:(t,e,n)=>{"use strict";function r(t,e){return r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(t,e)}n.d(e,{Z:()=>r})},885:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(181);function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(t,e)||(0,r.Z)(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},2982:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var r=n(907),i=n(181);function o(t){return function(t){if(Array.isArray(t))return(0,r.Z)(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||(0,i.Z)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},1002:(t,e,n)=>{"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}n.d(e,{Z:()=>r})},181:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(907);function i(t,e){if(t){if("string"==typeof t)return(0,r.Z)(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(t,e):void 0}}}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={id:r,loaded:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var r=n(2575);Vendor_dll=r})();